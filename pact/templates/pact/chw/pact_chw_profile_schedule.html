{% extends "pact/chw/pact_chw_profile_base.html" %}
{#{% load patient_lookup %}#}

{% block actor-tab-container %}
    <h3>Submission Schedule {{ end_date|date:"m/d/Y" }} - {{ start_date|date:"m/d/Y" }}</h3>
   <div class="row-fluid">
        <div class="span4">
            {% if total_scheduled == total_visited %}
                <div class="alert alert-success">
                    <strong>Scheduled Visits: </strong> {{ total_visited }} / {{ total_scheduled }}
                </div>
            {% else %}
                <div class="alert alert-error">
                    <strong>Scheduled Visits: </strong> {{ total_visited }} / {{ total_scheduled }}
                </div>
            {% endif %}
        </div>
        <div class="span8 pull-right" style="text-align:right;">
            <a href="{{ request.path }}?interval=1">Today</a> &nbsp;
            <a href="{{ request.path }}?interval={% now "w" %}">Week to date</a> &nbsp;
            <a href="{{ request.path }}?interval=7">7 days</a> &nbsp;
            <a href="{{ request.path }}?interval={% now "j" %}">Month to date</a> &nbsp;
            <a href="{{ request.path }}?interval=30">30 days</a>
            <br>
            <a href="{{ request.path }}?getcsv&interval=7">CSV 7</a>
            <a href="{{ request.path }}?getcsv&interval={% now "j" %}">CSV MTD</a>&nbsp;
            <a href="{{ request.path }}?getcsv&interval=30">CSV 30</a>
        </div>
    </div> <!-- end top row -->
    <div class="row-fluid">
        <div class="span2"><h3>Date</h3></div>
        <div class="span3"><h3>Patient Scheduled</h3></div>
        <div class="span7"><h3>Visits</h3></div>
    </div>

    {% for visit_date, patient_visits in date_arr %}
        {% if patient_visits %}
            {% for cpatient, visit in patient_visits %}
                <div class="row-fluid">
                    {% if forloop.counter0 == 0 %}
                        <div class="span2">
                            <h4>{{ visit_date|date:"D N j, Y" }}</h4>
                        </div>
                    {% else %}
                        <div class="span2">&nbsp;</div>
                    {% endif %}
                    <div class="span3">
                        <div class="alert alert-success">
                            <h4>
{#                                <a href="{% url view_pactpatient cpatient.get_id '' %}">{{ cpatient.first_name }} {{ cpatient.last_name }} ({{ cpatient.pact_id }})</a> #}
                                <a href="#">({{ cpatient.pactid }}) {{ cpatient.name }}</a>
                            </h4>
                        </div>
                    </div>
                    <div class="span7">
                        {% if visit %}
                                <table class="table table-condensed">
                                    <thead>
                                    <th>Scheduled</th>
                                    <th>Visit Kept</th>
                                    <th>Type</th>
                                    <th>Contact</th>
                                    <th>by</th>
                                    <th>Observed ART</th>
                                    <th>Pillbox Check</th>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>
                                            <div class="alert alert-info">
                                            <h4>
                                            {% if visit.scheduled == "yes" %}
                                                Scheduled
                                            {% else %}
                                                Unscheduled
                                            {% endif %}
                                                &nbsp;<small><a href="{% url render_form_data domain visit.doc_id %}">View</a></small>
                                            </h4>
                                            </div>

                                        </td>
                                        <td>
                                            {% if visit.visit_kept == "yes" %}
                                            {# No – Client told PACT they’d miss it#}
                                                Yes
                                            {% endif %}
                                            {% if visit.visit_kept == "notice" %}
    {#                                            No – Client told PACT they’d miss it#}
                                                No - Notice given
                                            {% endif %}
                                            {% if visit.scheduled == "pchanged" %}
                                                Changed by PACT
                                            {% endif %}

                                            {% if visit.scheduled == "pcancelled" %}
                                                Cancelled
                                            {% endif %}
                                        </td>
                                        <td>
                                            {{ visit.visit_type|title }}
                                        </td>
                                        <td>
                                            {{ visit.contact_type|title }}
                                        </td>
                                        <td>
                                            {% if visit.form.meta.username == username %}
                                                <strong>{{ visit.username }}</strong>
                                            {% else %}
                                                <em>{{ visit.username }}</em>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {{ visit.observed_art }}
                                        </td>
                                        <td>
                                            {{ visit.has_pillbox_check }}
                                        </td>
                                    </tr>

                                    </tbody>
                                </table>
                        {% else %}
                            <div class="alert alert-error"><h4>No Visit</h4></div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="row-fluid">
                <div class="span2">
                    <strong>{{ visit_date|date:"D N j, Y" }}</strong>
                </div>
                <div class="span3">
                    -- No Patients Scheduled --
                </div>
                <div class="span7">
                    <div class="span9" style="padding:.8em;margin-bottom:1em;border:2px solid #fff;">
                    </div>
                </div>
            </div>
        {% endif %}
    {% endfor %}
    </div>
{% endblock actor-tab-container %}

