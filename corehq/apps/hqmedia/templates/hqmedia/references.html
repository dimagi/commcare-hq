{% extends "hqmedia/uploader_base.html" %}
{% load hq_shared_tags %}
{% load i18n %}

{% block stylesheets %}{{ block.super }}
  <style type="text/css">
    .media-type-icon,
    .media-status-icon {
      font-size: 22px;
    }
  </style>
{% endblock %}

{% block js %} {{ block.super }}
  <script src="{% static 'hqmedia/js/media_reference_models.js' %}"></script>
  <script src="{% static 'hqmedia/js/references_main.js' %}"></script>
  <script src="{% static 'app_manager/js/download_async_modal.js' %}"></script>
{% endblock %}

{% block page_content %}
  {% initial_page_data 'sessionid' request.COOKIES.sessionid %}
  {% initial_page_data 'swfURL' 'hqmedia/MediaUploader/flashuploader.swf'|static %}
  {% initial_page_data 'uploaders' uploaders_js %}
  {% registerurl 'hqmedia_references' app.domain app.id %}
  {% registerurl 'view_module' app.domain app.id '---' %}
  {% registerurl 'form_source' app.domain app.id '---' %}

  <p class="lead">{{ current_page.page_name }}</p>

  <div id="multimedia-reference-checker" class="ko-template">
    <div class="alert alert-info" data-bind="visible: isInitialLoad()">
      {% blocktrans %}
        <i class="fa fa-spin fa-spinner"></i>
        Loading...
      {% endblocktrans %}
    </div>
    <div class="row">
      <div class="col-sm-7">
        <div data-bind="visible: totals().length">
          <p>
            {% blocktrans %}
              You can manage multimedia by uploading files individually below.
            {% endblocktrans %}
          </p>
          {% if multimedia_state.has_form_errors or multimedia_state.has_missing_refs %}
            <p>
              <a href="#" class="btn btn-default" data-bind="click: toggleMissingRefs, text: toggleRefsText"></a>
            </p>
          {% endif %}
        </div>
        <div data-bind="visible: !isInitialLoad() && !totals().length">
          <div class="alert alert-info">
            {% blocktrans %}This application references no multimedia.{% endblocktrans %}
          </div>
        </div>
      </div>
      <div class="col-sm-5" data-bind="visible: totals().length">
        <div class="well">
          {% include "hqmedia/partials/multimedia_zip_notice.html" with include_modal=True %}
          <ul class="list-unstyled" data-bind="foreach: totals">
            <li class="media-totals" data-bind="event: {refMediaAdded: $parent.incrementTotals}">
              <i data-bind="attr: {class: icon_class}"></i>
              <span data-bind="text: matched"></span>/<span data-bind="text: totals"></span>
              <span data-bind="text: media_type"></span> {% trans 'References' %}
            </li>
          </ul>
        </div>
      </div>
    </div>

    {% include "hqmedia/partials/reference_table.html" %}

    <script type="text/html" id="image-preview-template">
      <a target="_blank" data-bind="attr: { href: url }">
        <img class="preview-media"
             data-bind="attr: { src: thumb_url }"
             data-toggle="tooltip"
             data-title="{% trans 'Open image in new tab' %}." />
      </a>
    </script>

    <script type="text/html" id="audio-preview-template">
      <a target="_blank"
         class="btn btn-default preview-media"
         data-bind="attr: { href: url }"
         data-toggle="tooltip" data-title="{% trans 'Open file in new tab' %}.">{% trans 'Listen to Audio' %}</a>
    </script>

    <script type="text/html" id="video-preview-template">
      <a target="_blank"
         class="btn btn-default preview-media"
         data-bind="attr: { href: url }"
         data-toggle="tooltip" data-title="{% trans 'Open file in new tab' %}.">{% trans 'Watch Video' %}</a>
    </script>

    {% for uploader in uploaders %}
      {% include 'hqmedia/partials/multimedia_uploader.html' %}
    {% endfor %}

  </div>

{% endblock %}
