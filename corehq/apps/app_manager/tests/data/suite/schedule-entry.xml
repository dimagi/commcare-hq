<partial>
    <detail id="m1_case_short">
        <title>
            <text>
                <locale id="m1.case_short.title"/>
            </text>
        </title>
        <variables>
            <date_opened function="date_opened"/>
            <anchor_हिन्दी function="edd"/>
            <last_visit_number_हिन्दी function="last_visit_number_हिन्दी"/>
            <last_visit_date_हिन्दी function="last_visit_date_हिन्दी"/>
            <next_हिन्दी function="if(current_schedule_phase = '' and $anchor_हिन्दी != '' and (today() &gt;= (date($anchor_हिन्दी) + int(instance('schedule:m1:p1:f0')/schedule/@starts)) and (instance('schedule:m1:p1:f0')/schedule/@expires = '' or today() &lt;= (date($anchor_हिन्दी) + int(instance('schedule:m1:p1:f0')/schedule/@expires)))), date($anchor_हिन्दी) + int(coalesce(instance('schedule:m1:p1:f0')/schedule/visit[if(@repeats = 'True', @expires = '' or today() &lt;= (date($last_visit_date_हिन्दी) + int(@increment) + int(@expires)), @expires = '' or today() &lt;= (date($anchor_हिन्दी) + int(@due) + int(@expires)))][1]/@due, 2147483647)), if(current_schedule_phase = 1 and $anchor_हिन्दी != '' and (today() &gt;= (date($anchor_हिन्दी) + int(instance('schedule:m1:p1:f0')/schedule/@starts)) and (instance('schedule:m1:p1:f0')/schedule/@expires = '' or today() &lt;= (date($anchor_हिन्दी) + int(instance('schedule:m1:p1:f0')/schedule/@expires)))), date($anchor_हिन्दी) + int(coalesce(instance('schedule:m1:p1:f0')/schedule/visit[$last_visit_number_हिन्दी = '' or @id &gt; $last_visit_number_हिन्दी][if(@repeats = 'True', @expires = '' or today() &lt;= (date($last_visit_date_हिन्दी) + int(@increment) + int(@expires)), @expires = '' or today() &lt;= (date($anchor_हिन्दी) + int(@due) + int(@expires)))][1]/@due, 2147483647)), 2147483647))"/>
            <anchor_a983e9 function="edd"/>
            <last_visit_number_a983e9 function="last_visit_number_a983e9"/>
            <last_visit_date_a983e9 function="last_visit_date_a983e9"/>
            <next_a983e9 function="if(current_schedule_phase = '' and $anchor_a983e9 != '' and (today() &gt;= (date($anchor_a983e9) + int(instance('schedule:m1:p1:f1')/schedule/@starts)) and (instance('schedule:m1:p1:f1')/schedule/@expires = '' or today() &lt;= (date($anchor_a983e9) + int(instance('schedule:m1:p1:f1')/schedule/@expires)))), date($anchor_a983e9) + int(coalesce(instance('schedule:m1:p1:f1')/schedule/visit[if(@repeats = 'True', @expires = '' or today() &lt;= (date($last_visit_date_a983e9) + int(@increment) + int(@expires)), @expires = '' or today() &lt;= (date($anchor_a983e9) + int(@due) + int(@expires)))][1]/@due, 2147483647)), if(current_schedule_phase = 1 and $anchor_a983e9 != '' and (today() &gt;= (date($anchor_a983e9) + int(instance('schedule:m1:p1:f1')/schedule/@starts)) and (instance('schedule:m1:p1:f1')/schedule/@expires = '' or today() &lt;= (date($anchor_a983e9) + int(instance('schedule:m1:p1:f1')/schedule/@expires)))), date($anchor_a983e9) + int(coalesce(instance('schedule:m1:p1:f1')/schedule/visit[$last_visit_number_a983e9 = '' or @id &gt; $last_visit_number_a983e9][if(@repeats = 'True', @expires = '' or today() &lt;= (date($last_visit_date_a983e9) + int(@increment) + int(@expires)), @expires = '' or today() &lt;= (date($anchor_a983e9) + int(@due) + int(@expires)))][1]/@due, 2147483647)), 2147483647))"/>
            <anchor_39f0ea function="dob"/>
            <last_visit_number_39f0ea function="last_visit_number_39f0ea"/>
            <last_visit_date_39f0ea function="last_visit_date_39f0ea"/>
            <next_39f0ea function="if(current_schedule_phase = 2 and $anchor_39f0ea != '' and (today() &gt;= (date($anchor_39f0ea) + int(instance('schedule:m1:p2:f0')/schedule/@starts)) and (instance('schedule:m1:p2:f0')/schedule/@expires = '' or today() &lt;= (date($anchor_39f0ea) + int(instance('schedule:m1:p2:f0')/schedule/@expires)))), date($anchor_39f0ea) + int(coalesce(instance('schedule:m1:p2:f0')/schedule/visit[$last_visit_number_39f0ea = '' or @id &gt; $last_visit_number_39f0ea][if(@repeats = 'True', @expires = '' or today() &lt;= (date($last_visit_date_39f0ea) + int(@increment) + int(@expires)), @expires = '' or today() &lt;= (date($anchor_39f0ea) + int(@due) + int(@expires)))][1]/@due, 2147483647)), 2147483647)"/>
            <next_visit_date function="date(min($next_हिन्दी,$next_a983e9,$next_39f0ea))"/>
            <next_due function="if($next_visit_date &lt; today() and (current_schedule_phase = '' or ($last_visit_date_हिन्दी = '' and $last_visit_date_a983e9 = '' and $last_visit_date_39f0ea = '')), $date_opened, $next_visit_date)"/>
            <is_late function="$next_due &lt; today()"/>
        </variables>
        <field>
            <header>
                <text>
                    <locale id="m1.case_short.case_name_1.header"/>
                </text>
            </header>
            <template>
                <text>
                    <xpath function="case_name"/>
                </text>
            </template>
            <sort type="string" order="1" direction="ascending">
                <text>
                    <xpath function="case_name"/>
                </text>
            </sort>
        </field>
        <field>
            <header>
                <text>
                    <locale id="m1.case_short.case_schedule:nextdue_2.header"/>
                </text>
            </header>
            <template>
                <text>
                    <xpath function="$nextdue"/>
                </text>
            </template>
        </field>
    </detail>
</partial>
