{% extends "app_manager/v2/managed_app.html" %}
{% load xforms_extras %}
{% load hq_shared_tags %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block head %}{{ block.super }}
  {% include 'analytics/fullstory.html' %}
{% endblock %}

{% block js %}{{  block.super }}
  <script src="{% static 'app_manager/js/app_manager_utils.js' %}"></script>
  <script src="{% static 'app_manager/js/download_async_modal.js' %}"></script>
  <script src="{% static 'app_manager/js/releases.js' %}"></script>
  <script src="{% static 'app_manager/js/language-profiles.js' %}"></script>
  <script src="{% static "jsdiff/diff.js" %}"></script>
  <script src="{% static 'app_manager/js/app_diff.js' %}"></script>
  <script src="{% static 'hqwebapp/js/bulk_upload_file.js' %}"></script>
  <script src="{% static 'app_manager/js/supported-languages.js' %}"></script>
  <script src="{% static 'app_manager/js/password_setter.jquery.js' %}"></script>
  <script src="{% static "hqmedia/js/hqmediauploaders.js" %}"></script>
  <script src="{% static 'hqmedia/js/hqmedia.reference_controller.js' %}"></script>
  <script src="{% static 'app_manager/js/app_view.js' %}"></script>
  {% if app.get_doc_type == "Application" %}
      <script src="{% static 'app_manager/js/app_view_application.js' %}"></script>
      <script src="{% static 'translations/js/translations.js' %}"></script>
  {% endif %}
{% endblock js %}

{% block pre_form_content %}
  <div class="appmanager-page-actions">
      {% if can_preview_form %}
        {% include 'app_manager/v2/partials/app_preview_toggle.html' %}
      {% endif %}
      <a href="{% url "app_summary" domain app.id %}" class="btn btn-default">
          <i class="fa fa-list-alt"></i>
          {% trans "App Summary" %}
      </a>
  </div>

  <div class="appmanager-edit-title">
    <inline-edit params="
        value: '{{ app.name|escapejs }}',
        containerClass: 'h3 app-title',
        url: '{% url "edit_app_attr" domain app.id 'name' %}',
        placeholder: '{% trans "Untitled App"|escapejs %}',
        postSave: function(data) { return hqImport('app_manager/js/app_manager.js').updateDOM(data.update); },
        rows: 1,
        saveValueName: 'name',
        nodeName: 'input',
    "></inline-edit>
  </div>

  <div class="appmanager-edit-description">
    <inline-edit params="
        value: '{{ app.short_comment|escapejs }}',
        url: '{% url "edit_app_attr" domain app.id 'comment' %}',
        placeholder: '{% trans "Enter app description here"|escapejs %}',
        saveValueName: 'comment',
        containerClass: 'app-comment',
        cols: 50,
    "></inline-edit>
  </div>
{% endblock %}

{% block form-view %}
  {# release page URLs #}
  {% registerurl "paginate_releases" domain app.id %}
  {% registerurl "delete_copy" domain app.id %}
  {% registerurl "download_jad" domain '---' %}
  {% registerurl "download_jar" domain '---' %}
  {% registerurl "odk_install" domain '---' %}
  {% registerurl "odk_media_install" domain '---' %}
  {% registerurl "download_index" domain '---' %}
  {% registerurl "release_build" domain app.id '---' %}
  {% registerurl "save_copy" domain app.id %}
  {% registerurl "revert_to_copy" domain app.id %}
  {% registerurl "current_app_version" domain app.id %}
  {% registerurl "hubspot_click_deploy" %}
  {% registerurl "download_ccz" app.domain '---' %}
  {% registerurl "download_multimedia_zip" app.domain '---' %}
  {% registerurl "project_report_dispatcher" app.domain 'application_error' %}

  <div class="appmanager-tabs-container">
  {% block app_view_tabs %}{% endblock app_view_tabs %}
  </div>
{% endblock %}

{% block modals %}{{ block.super }}
{% for uploader in uploaders %}
{% include 'hqmedia/partials/multimedia_uploader.html' %}
{% endfor %}
{% include 'app_manager/v2/partials/password_setter_modal.html' %}
{% include 'app_manager/v2/partials/toggle_diff_modal.html' %}
{% endblock %}
