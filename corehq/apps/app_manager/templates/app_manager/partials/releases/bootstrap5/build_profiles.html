{% load i18n %}
{% load hq_shared_tags %}

<div data-bind="saveButton: saveButton"></div>
<div class="card">
  <div class="card-header pt-3">
    <h5>
      {% trans "Current Profiles" %}
    </h5>
  </div>
  <div class="card-body">
    {% if app.is_remote_app %}
      <div class="alert alert-danger" data-bind="visible: app_profiles().length > 1">
        {% blocktrans %}
          Remote applications only support one build profile. Please remove all but one profile before saving.
        {% endblocktrans %}
      </div>
    {% endif %}
    <div class="help-block">
      {% blocktrans %}
        Application profiles let you install the same application with different languages
        and options on different phones. Application profiles will appear in <em>new</em> versions
        of the application.
      {% endblocktrans %}
      {% if can_edit_apps and request|toggle_enabled:"RELEASE_BUILDS_PER_PROFILE" %}
        <a href="{% url 'manage_releases_by_app_profile' domain %}">{% trans "Manage application profiles here."%}</a>
      {% endif %}
      {% blocktrans %}
        Learn more about Application Profiles on our <a href='https://confluence.dimagi.com/display/commcarepublic/Application+Profiles'>Help Site</a>
      {% endblocktrans %}
    </div>
    <table class="table table-profiles">
      <thead>
        <tr>
          <th>{% trans "Profile Name" %}</th>
          <th>{% trans "Languages" %}</th>
          <th>{% trans "Default Language" %}</th>
          <th>{% trans "Practice Mobile Worker" %}
            <div class="text-warning"  data-bind="visible: !$data.enable_practice_users">
              <i class="fa fa-arrow-down"></i>
              {% trans "Upgrade to CommCare 2.30!" %}
            </div>
          </th>
          <th></th>
        </tr>
      </thead>
      <tbody data-bind="foreach: app_profiles">
      <tr>
        <td class="w-25">
          <input class="form-control" data-bind="value: $data.name"/>
          {% if request|toggle_enabled:"RELEASE_BUILDS_PER_PROFILE" %}
            <div data-bind="visible: $data.latestEnabledVersion">
              <b>{% trans "Latest Enabled Version:" %}
              <span data-bind="text: $data.latestEnabledVersion"></span>
              </b>
            </div>
          {% endif %}
        </td>
        <td class="w-25">
          <select class="language-select form-select"
                  multiple="true"
                  data-bind="options: $root.app_langs, selectedOptions: langs, attr: {id: 'profile-' + $index()}">
          </select>
        </td>
        <td class="w-25">
          <select class="form-select" data-bind="value: defaultLang, options: langs"></select>
        </td>
        <td class="w-25">
          <select
            class="practice-user form-select"
            data-bind="
              foreach: $root.practice_users,
              attr: { id: 'practice-user-' + $index() },
              value: $data.practiceUser,
              enable: $root.enable_practice_users"
          ><option data-bind="value: $data.id, text: $data.text"></option>
          </select>
        </td>
        <td>
          <button class="btn btn-outline-danger" data-bind="click: $root.removeProfile">
            <i class="fa fa-remove"></i>
          </button>
        </td>
        <input type="hidden" data-bind="value: id"/>
      </tr>
      </tbody>
    </table>
    <button class="btn btn-outline-primary" data-bind="click: newProfile">
      <i class="fa fa-plus"></i>
      {% trans "Add Profile" %}
    </button>
  </div>
</div>

