{% load i18n %}
{% load hq_shared_tags %}

{% if all_add_ons_enabled %}

  <div class="alert alert-info">
    <p>
      {% blocktrans %}
        All add-ons have been enabled for this app using the
        "Enable All Application Add-Ons" project setting.
      {% endblocktrans %}
    </p>
  </div>

{% else %}

  <form>

    <div data-bind="saveButton: saveButton"></div>

    {% if request|request_has_privilege:"SHOW_ENABLE_ALL_ADD_ONS" %}
    <button
      type="button"
      class="btn btn-outline-primary float-end"
      data-bind="click: enableAll"
    >
      {% trans "Enable All Add-Ons" %}
    </button>
    {% endif %}

    <p class="lead">
      {% blocktrans %}
        <strong>Add-ons</strong> enable you to build more complex applications.
      {% endblocktrans %}
    </p>

    <div class="accordion" data-bind="foreach: sections">
      <div
        class="accordion-item"
        data-bind="attr: {'data-slug': slug}"
      >
        <button
          class="accordion-button collapsed"
          type="button"
          data-bs-toggle="collapse"
          data-bind="attr: { 'data-bs-target': '#collapse-' + slug }"
        >
          <h5 class="accordion-header">
            <span data-bind="text: name"></span> &nbsp;
            <small data-bind="text: description"></small>
          </h5>
        </button>
        <div
          class="accordion-body accordion-collapse collapse"
          data-bind="
            foreach: add_ons,
            attr: { 'id': 'collapse-' + slug }"
        >
          <div class="form-check">
            <input
              type="checkbox"
              class="form-check-input"
              data-bind="
                attr: {
                  name: slug,
                  id: 'check-' + slug,
                },
                disable: show_upgrade,
                checked: $root.addOns[slug]"
              />
            <label data-bind="attr: { 'for': 'check-' + slug }" class="form-check-label">
              <span data-bind="text: name" class="clickable"></span>
              <div class="help-block">
                <span data-bind="text: description"></span>
                <a target="_blank" data-bind="if: help_link, attr:{href: help_link}">{% trans "Learn more." %}</a>
              </div>
            </label>
            <!-- ko if: show_upgrade -->
              <div class="alert alert-info">
                <i class="fa fa-info-circle"></i>
                <span data-bind="text: upgrade_text"></span>
                {% include 'hqwebapp/partials/generic_feature_upgrade.html' %}

                <!-- ko if: $root.addOns[slug] -->
                  {% blocktrans %}
                    You have previously enabled this feature in your app, but have since lost access
                    to it.
                  {% endblocktrans %}
                  <br />
                  {% blocktrans %}
                    Your application will continue to function in places that utilized this feature, but
                    you will not be able to edit any related functionality until you upgrade.
                  {% endblocktrans %}
                <!-- /ko -->
              </div>
            <!-- /ko -->
          </div>
        </div>
      </div>
    </div>

  </form>

{% endif %}
