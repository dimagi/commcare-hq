{% load i18n %}
{% load hq_shared_tags %}

{% if all_add_ons_enabled %}

  <div class="alert alert-info">
    <p>
      {% blocktrans %}
        All add-ons have been enabled for this app using the
        "Enable All Application Add-Ons" project setting.
      {% endblocktrans %}
    </p>
  </div>

{% else %}

  <form>

    <div data-bind="saveButton: saveButton"></div>

    {% if request|request_has_privilege:"SHOW_ENABLE_ALL_ADD_ONS" %}
    <button
      type="button"
      class="btn btn-outline-primary float-end"
      data-bind="click: enableAll"
    >
      {% trans "Enable All Add-Ons" %}
    </button>
    {% endif %}

    <p class="lead">
      {% blocktrans %}
        <strong>Add-ons</strong> enable you to build more complex applications.
      {% endblocktrans %}
    </p>

    <div data-bind="foreach: sections">
      <div
        class="card panel-appmanager"  {# todo B5: css-panel #}
        data-bind="attr: {'data-slug': slug}"
      >
        <div
          class="card-header"
          style="cursor: pointer;"  {# todo B5: inline-style #}
          data-bind="click: $root.toggleSection"
        >
          <h4 class="card-title">
            <i
              class="fa"
              data-bind="css: {
                'fa-chevron-down': !collapse(),
                'fa-chevron-right': collapse()
              }"
            ></i>
            <span data-bind="text: name"></span> &nbsp;
            <small data-bind="text: description"></small>
          </h4>
        </div>
        <div
          class="card-body"
          data-bind="foreach: add_ons, visible: !collapse()"
        >
          <div class="checkbox">  {# todo B5: css-checkbox #}
            <label>
              <input type="checkbox"  {# todo B5: css-checkbox #}
                     data-bind="attr: {
                                  name: slug,
                                  id: 'check-' + slug,
                                },
                                disable: show_upgrade,
                                checked: $root.addOns[slug]" />
              <span data-bind="text: name, attr: {for: 'check-' + slug}" class="clickable"></span>
              <div class="help-block">
                <span data-bind="text: description"></span>
                <a target="_blank" data-bind="if: help_link, attr:{href: help_link}">{% trans "Learn more." %}</a>
              </div>
              <!-- ko if: show_upgrade -->
                <div class="card well-sm">  {# todo B5: css-well #}
                  <p>
                    <i class="fa fa-info-circle"></i>
                    <span data-bind="text: upgrade_text"></span>
                    {% include 'hqwebapp/partials/generic_feature_upgrade.html' %}
                  </p>

                  <!-- ko if: $root.addOns[slug] -->
                    <p>
                      {% blocktrans %}
                        You have previously enabled this feature in your app, but have since lost access
                        to it.
                      {% endblocktrans %}
                      <br />
                      {% blocktrans %}
                        Your application will continue to function in places that utilized this feature, but
                        you will not be able to edit any related functionality until you upgrade.
                      {% endblocktrans %}
                    </p>
                  <!-- /ko -->
                </div>
              <!-- /ko -->
            </label>
          </div>
        </div>
      </div>
    </div>

  </form>

{% endif %}
