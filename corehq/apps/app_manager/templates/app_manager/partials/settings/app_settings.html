{% load i18n %}
{% load hq_shared_tags %}
{% load xforms_extras %}
{% load crispy_forms_tags %}

<script type="text/html" id="CommcareSettings.widgets.select">
  <span>
    <span data-bind="if: valueIsLegal()">
      <select class="col-sm-3 form-control" data-bind="
          options: options,
          value: selectedOption,
          optionsText: 'label',
          attr: {disabled: !enabled(), id: inputId}
      "></select>
    </span>
    <span data-bind="if: !valueIsLegal()" >
      <select class="col-sm-3 form-control error" data-bind="
          options: options,
          value: writeSelectedOption,
          optionsText: 'label',
          attr: {disabled: !enabled(), id: inputId},
          optionsCaption: value()
      "></select>
    </span>
  </span>
</script>

<script type="text/html" id="CommcareSettings.widgets.bool">
  <span class="col-sm-3">
        <input type="checkbox"
               data-bind="checked: boolValue, attr: {disabled: !enabled(), id: inputId}"/>
    </span>
</script>

<script type="text/html" id="CommcareSettings.widgets.customProperty">
  <div class="row">
    <div class="col-sm-5">
      <input placeholder="Key" type="text" data-bind="value: key" class="form-control" autocomplete="off"/>
    </div>
    <div class="col-sm-1 text-center">
      <i class="fa fa-arrow-right"></i>
    </div>
    <div class="col-sm-5">
      <input placeholder="Value" type="text" data-bind="value: value" class="form-control" autocomplete="off"/>
    </div>
    <div class="col-sm-1">
      <button class="btn btn-danger" data-bind="click: $parent.onDestroyCustomProperty">
        <i class="fa fa-trash"></i>
      </button>
    </div>
  </div>
</script>

<script type="text/html" id="CommcareSettings.widgets.image_uploader">
  <a data-bind="visible: url(), attr: {href: url()}" target="_blank">
    <img data-bind="
            attr: {
                src: thumb_url()
            }
        "/>
  </a>
  <a data-toggle="modal"
     class="btn btn-default"
     data-bind="
        attr: {
            'data-hqmediapath': path,
            href: href
        },
        click: triggerUpload,
        event: {
            mediaUploadComplete: uploadComplete
        }
    ">
    <i class="fa fa-cloud-upload"></i>
    <span data-bind="visible: url()">
            {% trans "Replace Logo" %}
        </span>
    <span data-bind="visible: !url()">
            {% trans "Upload Logo" %}
        </span>
  </a>
  <a class="btn btn-danger"
     data-bind="
           visible: url(),
           click: removeLogo
    ">
    <i class="fa fa-remove"></i>
  </a>
</script>

{% include 'hqmedia/partials/multimedia_js.html' %}

<script type="text/html" id="CommcareSettings.widgets.text">
  <span>
        <input type="text" class="col-sm-6 form-control" autocomplete="off" data-bind="
            value: visibleValue,
            valueUpdate: 'textchange',
            attr: {disabled: !enabled(), id: inputId}
        " />
    </span>
</script>

<script type="text/html" id="CommcareSettings.widgets.number">
  <span>
        <input type="number" class="col-sm-3 form-control" data-bind="
            value: visibleValue,
            valueUpdate: 'textchange',
            attr: {disabled: !enabled(), id: inputId}
        " />
    </span>
</script>

<script type="text/html" id="CommcareSettings.widgets.textarea">
  <span>
        <textarea type="text" data-bind="value: value, attr: {id: inputId}" class="form-control" />
    </span>
</script>

<script type="text/html" id="CommcareSettings.widgets.password">
  <span>
        <input type="password" data-bind="passwordSetter: visibleValue" class="form-control" />
    </span>
</script>

<script type="text/html" id="CommcareSettings.widgets.text_input">
  <span data-bind="template: 'CommcareSettings.widgets.select'"></span>
  <aside id="custom-keys-help" data-bind="visible: visibleValue() === 'custom-keys'">
        <span>Customize through
            <a href="#" data-bind="click: function () {$('#custom-keys-example').slideToggle()}">{% trans "User Interface Translations" %}</a>.
        </span>
    <div id="custom-keys-example" style="display: none;">
      <h6>Example:</h6>
      <div class="row">
        <div class="col-sm-9">polish.TextField.charactersKey1</div><div class="col-sm-3">.,</div>
        <div class="col-sm-9">polish.TextField.charactersKey2</div><div class="col-sm-3">abc2</div>
        <div class="col-sm-9">polish.TextField.charactersKey3</div><div class="col-sm-3">def3</div>
        <div class="col-sm-9">polish.TextField.charactersKey4</div><div class="col-sm-3">ghi4</div>
        <div class="col-sm-9">polish.TextField.charactersKey5</div><div class="col-sm-3">jkl5</div>
        <div class="col-sm-9">polish.TextField.charactersKey6</div><div class="col-sm-3">mno6</div>
        <div class="col-sm-9">polish.TextField.charactersKey7</div><div class="col-sm-3">pqrs7</div>
        <div class="col-sm-9">polish.TextField.charactersKey8</div><div class="col-sm-3">tuv8</div>
        <div class="col-sm-9">polish.TextField.charactersKey9</div><div class="col-sm-3">wxyz9</div>
        <div class="col-sm-9">polish.TextField.charactersKey0</div><div class="col-sm-3"> 0</div>
      </div>
    </div>
  </aside>
</script>

{% if request|ui_notify_enabled:"APP_BUILDER_ADD_ONS" %}
  <div class="alert alert-ui-notify alert-dismissible helpbubble helpbubble-primary helpbubble-no-arrow fade in"
       data-slug="{{ "APP_BUILDER_ADD_ONS"|ui_notify_slug }}"
       role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
    <p class="lead">{% trans 'New Add-ons tab' %}</p>
    <p>
      {% blocktrans %}
        Intermediate functionality, such as child cases, can now be enabled or disabled using the
        <strong>Add-Ons</strong> tab below. Several feature previews, such as icons in the case list,
        are also now accessible in this tab.
      {% endblocktrans %}
    </p>
  </div>
{% endif %}

<div class="tabbable">
  <ul class="nav nav-tabs sticky-tabs">
    {% if app.get_doc_type == 'LinkedApplication' %}
      <li><a href="#linked-app" data-toggle="tab">{% trans "Linked Application" %}</a></li>
      <li><a href="#languages" data-toggle="tab">{% trans "Languages" %}</a></li>
      <li><a href="#actions" data-toggle="tab">{% trans "Actions" %}</a></li>
    {% else %}
      <li><a href="#languages" data-toggle="tab">{% trans "Languages" %}</a></li>
      {% if app.get_doc_type == 'Application' %}
        <li><a href="#multimedia-tab" data-toggle="tab">{% trans "Multimedia" %}</a></li>
      {% endif %}
      <li><a href="#actions" data-toggle="tab">{% trans "Actions" %}</a></li>
      <li><a href="#add-ons" data-toggle="tab">{% trans "Add-ons" %}</a></li>
    {% endif %}
    <li><a href="#commcare-settings" data-toggle="tab">{% trans "Advanced Settings" %}</a></li>
  </ul>
  <div class="tab-content appmanager-tab-content">
    {% if app.get_doc_type == 'LinkedApplication' %}
      <div class="tab-pane" id="linked-app">
        <div class="panel panel-appmanager panel-appmanager-form">
          <form action="{% url "pull_master_app" domain app.id %}" method="POST">
            {% csrf_token %}
            <legend>
              {% trans "Update from master application" %}
            </legend>
            <div class="panel-body">
              <p>
                {% blocktrans with master_name=pulled_from_master_brief.name master_version=app.pulled_from_master_version %}
                  Your app was last pulled from
                  <a href='{{ pulled_from_master_url }}'>{{ master_name }}</a>,
                  version {{ master_version }}.
                {% endblocktrans %}
              </p>
              <div class="form-horizontal">
                <div class="form-group">
                  <div class="{% css_field_class %}">
                    <select name="master_app_id" class="form-control hqwebapp-select2"
                            data-placeholder="{% trans_html_attr "Select a master app to pull" %}">
                      <option value="">{% trans "Select a master app to pull" %}</option>
                      {% for brief in master_briefs %}
                        <option value="{{ brief.id }}">
                          {{ brief.name }}
                          {% for id, version in master_versions_by_id.items %}
                            {% if id == brief.id %}
                              ({% blocktrans with v=version %}version {{ v }}{% endblocktrans %})
                            {% endif %}
                          {% endfor %}
                        </option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <div class="{% css_field_class %}">
                    <div class="checkbox">
                      <label>
                        <input type="checkbox" name="notify">
                        {% trans "Email when finished (recommended for large applications)" %}
                      </label>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <div class="{% css_field_class %}">
                    <button type="submit" class="btn btn-primary">
                      <i class="fa fa-arrow-up"></i>
                      {% trans "Update" %}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    {% endif %}
    {% if app.get_doc_type == 'Application' %}
      <div class="tab-pane" id="multimedia-tab">
        <div data-bind="if: load_state() === 'loading'">
          <i class="fa fa-spin fa-spinner"></i>
          {% trans "Loading ..." %}
        </div>
        <div data-bind="html: multimedia_page_html"></div>
        <div data-bind="if: load_state() === 'error'">
          <button class="btn btn-default"
                  data-bind="click: load_if_necessary">{% trans "Try again" %}</button>
        </div>
      </div>
    {% endif %}
    <div class="tab-pane" id="languages">
      {% include 'app_manager/languages.html' %}
    </div>
    <div class="tab-pane" id="actions">
      {% if app.get_doc_type != 'LinkedApplication' %}
        {% if copy_app_form %}
          <div class="panel panel-appmanager panel-appmanager-form" id="copy-app-form">
            <form class="form form-horizontal" method="post" action="{% url "copy_app" domain %}">
              {% crispy copy_app_form %}
            </form>
          </div>
        {% endif %}
        {% if linked_domains_enabled %}
          <div id="linked-whitelist" class="panel panel-appmanager panel-appmanager-form" data-bind="visible: linkedDomains().length > 0">
            <legend>{% trans 'Linked Project Whitelist' %}</legend>
            <div class="tab-pane panel-body">
              <div class="help-block">
                {% blocktrans %}
                  Project spaces on this list are able to update linked applications
                  with new changes to this application. Project spaces are automatically added to
                  this list when this application is copied as a linked application to that project
                  space. If you would like to prevent a project from making future updates,
                  you can remove them from the list here.
                {% endblocktrans %}
              </div>
              <div data-bind="saveButton: saveButton"></div>
              <table class="table">
                <thead>
                <tr class="row">
                  <th></th>
                  <th>{% trans "Project Space" %}</th>
                </tr>
                </thead>
                <tbody data-bind="foreach: linkedDomains">
                <tr class="row">
                  <td class="col-sm-1"><a href="#"><i class="fa fa-remove"
                                                      data-bind="click: $root.removeDomain"></i></a></td>
                  <td class="col-sm-11"><span data-bind="text: $data"></span></td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        {% endif %}
        {{ request|toggle_tag_info:"EXPORT_ZIPPED_APPS" }}
        {% if request|toggle_enabled:"EXPORT_ZIPPED_APPS" %}
          <div class="panel panel-appmanager panel-appmanager-form panel-appmanager-form-danger">
            <form action="{% url "gzip_app" domain app.id %}" method="POST">
              {% csrf_token %}
              <legend>Export compressed application</legend>
              <div class="panel-body">
                <button type="submit" class="btn btn-primary">
                  <i class="fa fa-arrow-down"></i>
                  {% trans "Download" %}
                </button>
              </div>
            </form>
          </div>
        {% endif %}
      {% endif %}
      <div class="panel panel-appmanager panel-appmanager-form panel-appmanager-form-danger">
        <legend>{% trans "Delete Application" %}</legend>
        <div class="panel-body">
          <a href="#delete-app-modal" class="btn btn-danger" data-toggle="modal">
            <i class="fa fa-trash"></i>
            {% trans "Delete this application" %}
          </a>
        </div>
      </div>
    </div>
    <div class="tab-pane" id="add-ons">
      {% include 'app_manager/partials/settings/add_ons.html' %}
    </div>
    <div class="tab-pane" id="commcare-settings">
      {% include 'app_manager/partials/settings/commcare_settings.html' %}
    </div>
  </div>
</div>
