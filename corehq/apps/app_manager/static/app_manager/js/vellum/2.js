"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[2],{4002:(t,e,n)=>{var a=n(1134),s=n(8324),o=n.n(s),i=n(561),r=n.n(i),l=n(4523),c=n(2295);const u='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4BE1309B-ABCF-4184-8175-9E381F3E0DD7" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance id="casedb" src="jr://instance/casedb" />\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t\t<itemset nodeset="instance(\'casedb\')/casedb/case[@case_type=\'mother\']">\n\t\t\t\t<label ref="case_name" />\n\t\t\t\t<value ref="@case_id" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>\n',m='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4BE1309B-ABCF-4184-8175-9E381F3E0DD7" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance id="casedb" src="jr://instance/casedb" />\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" constraint="1 = 1" jr:constraintMsg="jr:itext(\'question1-constraintMsg\')"/>\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="question1-constraintMsg">\n\t\t\t\t\t\t<value>constraint</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/question1" ref="/data/question1" appearance="minimal">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t\t<alert ref="jr:itext(\'question1-constraintMsg\')" />\n\t\t\t<itemset nodeset="instance(\'casedb\')/casedb/case[@case_type=\'mother\']">\n\t\t\t\t<label ref="case_name" />\n\t\t\t\t<value ref="@case_id" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>\n';var d=n(3220);const f='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/77F64702-954B-42B8-B670-6D962CD20846" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<select />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance src="jr://fixture/item-list:some-fixture" id="some-fixture" />\n\t\t\t<bind vellum:nodeset="#form/select" nodeset="/data/select" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="" />\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/select" ref="/data/select">\n\t\t\t<itemset nodeset="instance(\'some-fixture\')/some-fixture_list/some-fixture">\n\t\t\t\t<label ref="name" />\n\t\t\t\t<value ref="@id" />\n\t\t\t\t<sort ref="inner-attribute" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>',h='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4BE1309B-ABCF-4184-8175-9E381F3E0DD7" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question2 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance id="some-fixture" src="jr://fixture/item-list:some-fixture" />\n\t\t\t<bind vellum:nodeset="#form/question2" nodeset="/data/question2" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question2-label">\n\t\t\t\t\t\t<value>question2</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/question2" ref="/data/question2">\n\t\t\t<label ref="jr:itext(\'question2-label\')" />\n            <itemset nodeset="instance(\'some-fixture\')/some-fixture_list/some-fixture">\n\t\t\t\t<label ref="name" />\n\t\t\t\t<value ref="@id" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>\n',p='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="undefined" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<state />\n\t\t\t\t\t<district />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance src="jr://fixture/item-list:some-fixture" id="some-fixture" />\n\t\t\t<bind vellum:nodeset="#form/state" nodeset="/data/state" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/district" nodeset="/data/district" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default=""/>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/state" ref="/data/state"/>\n\t\t<select1 vellum:ref="#form/district" ref="/data/district">\n\t\t\t<itemset vellum:nodeset="instance(\'some-fixture\')/some-fixture_list/some-fixture[name = #form/state]" nodeset="instance(\'some-fixture\')/some-fixture_list/some-fixture[name = /data/state]">\n\t\t\t\t<label ref="name" />\n\t\t\t\t<value ref="@id" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>\n';var x=o().assert,g=a.A.call,v=a.A.clickQuestion,b=l.Ay.union(a.A.options.options.plugins||[],["itemset"]);describe("The Dynamic Itemset plugin",(function(){function t(t){a.A.init({plugins:b,javaRosa:{langs:["en"]},core:{onReady:function(){e=this,t()}},features:{lookup_tables:!0,advanced_itemsets:!1}})}var e;before(t),beforeEach((function(){e.datasources.reset()})),it("adds a new instance to the form",(function(){a.A.loadXML(c),a.A.getMug("question1/itemset").p.itemsetData={instance:{id:"somefixture",src:"jr://somefixture"},nodeset:"instance('somefixture')/some/items",labelRef:"label",valueRef:"value"};var t=g("createXML"),e=a.A.parseXML(t);x(e.find("instance[id=somefixture]").length,"somefixture instance not found:\n"+t)})),it("changes instance when nodeset changes",(function(){var t=a.A.loadXML(c),e=a.A.getMug("question1/itemset");t.updateKnownInstances({foo:"jr://foo"}),e.p.itemsetData={nodeset:"instance('foo')/some/items",labelRef:"label",valueRef:"value"};var n=g("createXML"),s=a.A.parseXML(n);x(s.find("instance[id=foo]").length,"foo instance not found:\n"+n),x.equal(s.find("instance[id=casedb]").length,0,"somefixture instance not found:\n"+n)})),it("renames instance on add itemset with matching instance",(function(){a.A.loadXML(c),a.A.addQuestion("SelectDynamic","select2");var t=a.A.getMug("select2/itemset");t.p.itemsetData={instance:{id:"cases",src:"jr://instance/casedb"},nodeset:"instance('cases')/cases/case[@case_id > 2]",labelRef:"label",valueRef:"value"};var e=t.p.itemsetData;x.equal(e.instance.id,"casedb"),x.equal(e.instance.src,"jr://instance/casedb"),x.equal(e.nodeset,"instance('casedb')/cases/case[@case_id > 2]");var n=g("createXML"),s=a.A.parseXML(n);x(s.find("instance[id=casedb]").length,"casedb instance not found:\n"+n),x(0===s.find("instance[id=cases]").length,"cases instance should have been renamed/merged:\n"+n)})),it("should select first lookup table for new itemset",(function(){a.A.loadXML(""),a.A.addQuestion("SelectDynamic","select"),a.A.clickQuestion("select/itemset");var t=a.A.getMug("select/itemset");t.validate(),x.equal(a.A.getMessages(t),"")})),it("should populate itemset nodeset and refs on add single select",(function(){a.A.loadXML(""),a.A.addQuestion("SelectDynamic","select");var t=g("createXML"),e=a.A.parseXML(t).find("itemset");x.equal(e.attr("nodeset"),"instance('some-fixture')/some-fixture_list/some-fixture"),x(e.find("label").attr("ref"),"name"),x(e.find("value").attr("ref"),"@id")})),it("should add sort element when sort field has a value",(function(){a.A.loadXML(""),a.A.addQuestion("SelectDynamic","select"),v("select/itemset");var t=a.A.getMug("select/itemset");r()("[name=property-sortRef]").val("@id").change(),x.equal(t.p.sortRef,"@id");var e=g("createXML"),n=a.A.parseXML(e).find("itemset");x.equal(n.find("sort").attr("ref"),"@id")})),it("should load dynamic select with sort element",(function(){a.A.loadXML(f);var t=a.A.getMug("select/itemset");x.equal(t.p.sortRef,"inner-attribute"),v("select/itemset"),x.equal(r()("[name=property-sortRef]").val(),"inner-attribute"),a.A.assertXmlEqual(g("createXML"),f,{normalize_xmlns:!0})})),it("should load dynamic select without errors",(function(){a.A.loadXML(c);var t=a.A.getMug("question1/itemset");t.validate(),x.equal(a.A.getMessages(t),"")})),it("should not trigger change on click itemset",(function(){a.A.loadXML(c),a.A.saveButtonEnabled(!1),v("question1/itemset"),x(!a.A.saveButtonEnabled(),"save button should not be enabled")})),it("should save the hashtag format correctly",(function(){a.A.loadXML(""),a.A.addQuestion("Text","state"),a.A.addQuestion("SelectDynamic","district"),a.A.clickQuestion("district/itemset");var t=a.A.getMug("district/itemset");t.p.itemsetData={instance:t.p.itemsetData.instance,nodeset:t.p.itemsetData.nodeset+"[name = /data/state]",labelRef:"name",valueRef:"@id"},a.A.assertXmlEqual(g("createXML"),p,{normalize_xmlns:!0})})),it("should include filter usage in logic manager",(function(){var t=a.A.loadXML(p);x.deepEqual(t.findUsages(),{"#form/state":{"#form/district":"Filter"}})})),it("should update sortRef on paste dynamic select with sorted itemset",(function(){a.A.loadXML(""),a.A.paste([["id","type","labelItext:en-default","instances","itemsetData"],["/select","SelectDynamic","select",'{"foo":{"src":"jr://foo"}}','[{"instance":{"id":"foo","src":"jr://foo"},"nodeset":"instance(\'foo\')/foo/items","labelRef":"@name","valueRef":"@id","sortRef":"name"}]']]),x.equal(a.A.getMug("select/itemset").p.sortRef,"name")})),describe("without access to lookup tables",(function(){before((function(t){a.A.init({plugins:b,javaRosa:{langs:["en"]},core:{onReady:function(){t()}},features:{lookup_tables:!1,advanced_itemsets:!1,rich_text:!1}})})),it("should display an error on an itemset",(function(){a.A.loadXML(c);var t=a.A.getMug("question1/itemset");x.notStrictEqual(t.spec.itemsetData.validationFunc(t),"pass")}))})),describe("parsing and serializing",(function(){before(t),it("preserves XML with itemsets in <select>s",(function(){x(-1!==c.indexOf("select1")),a.A.loadXML(c),a.A.assertXmlEqual(g("createXML"),c)})),it("preserves XML with itemsets in <select1>s",(function(){var t=c.replace(/select1/g,"select");a.A.loadXML(t),a.A.assertXmlEqual(g("createXML"),t)})),it("preserves XML with a constraint",(function(){a.A.loadXML(u),a.A.assertXmlEqual(g("createXML"),u)})),it("preserves XML with an appearance",(function(){a.A.loadXML(m),a.A.assertXmlEqual(g("createXML"),m)}))})),describe("UI",(function(){it("preserves inner filters if you never change the data source",(function(){a.A.loadXML(d),v("question2/itemset"),r()("[name=property-labelRef]").val("dummy").change(),a.A.assertXmlEqual(d.replace("case_name","dummy"),g("createXML"))})),it("correctly parses filter with reference to case property",(function(){a.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/45D58D8B-834F-495E-8439-0190233678CA" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<lookup />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance src="jr://instance/casedb" id="casedb" />\n\t\t\t<instance src="jr://instance/session" id="commcaresession" />\n\t\t\t<instance src="jr://fixture/item-list:some-fixture" id="some-fixture" />\n\t\t\t<bind vellum:nodeset="#form/lookup" nodeset="/data/lookup" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="lookup-label">\n\t\t\t\t\t\t<value>lookup</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t\t<vellum:hashtags>{&quot;#case/dob&quot;:null}</vellum:hashtags>\n\t\t<vellum:hashtagTransforms>{&quot;prefixes&quot;:{&quot;#case/grandparent/&quot;:&quot;instance(\'casedb\')/cases/case[@case_id = instance(\'casedb\')/cases/case[@case_id = instance(\'casedb\')/cases/case[@case_id = instance(\'commcaresession\')/session/data/case_id]/index/parent]/index/parent]/&quot;,&quot;#case/parent/&quot;:&quot;instance(\'casedb\')/cases/case[@case_id = instance(\'casedb\')/cases/case[@case_id = instance(\'commcaresession\')/session/data/case_id]/index/parent]/&quot;,&quot;#case/&quot;:&quot;instance(\'casedb\')/cases/case[@case_id = instance(\'commcaresession\')/session/data/case_id]/&quot;,&quot;#user/&quot;:&quot;instance(\'casedb\')/cases/case[@case_type = \'commcare-user\'][hq_user_id = instance(\'commcaresession\')/session/context/userid]/&quot;}}</vellum:hashtagTransforms>\n\t</h:head>\n\t<h:body>\n\t\t<select vellum:ref="#form/lookup" ref="/data/lookup">\n\t\t\t<label ref="jr:itext(\'lookup-label\')" />\n\t\t\t<itemset vellum:nodeset="instance(\'some-fixture\')/some-fixture_list/some-fixture[name = #case/dob]" nodeset="instance(\'some-fixture\')/some-fixture_list/some-fixture[name = instance(\'casedb\')/cases/case[@case_id = instance(\'commcaresession\')/session/data/case_id]/dob]">\n\t\t\t\t<label ref="name" />\n\t\t\t\t<value ref="@id" />\n\t\t\t\t<sort ref="inner-attribute" />\n\t\t\t</itemset>\n\t\t</select>\n\t</h:body>\n</h:html>');var t=a.A.getMug("lookup/itemset");x.equal(t.p.filter,"name = #case/dob")})),it("uses a dropdown when the nodeset is known",(function(){a.A.loadXML(h),v("question2/itemset"),x(r()("[name=property-itemsetData]").is("select"))})),describe("with a /data/ fixture",(function(){it("doesn't warn on no src",(function(){a.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/1D568275-1D19-46DB-8C54-2C9765DF6335" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<itemset />\n\t\t\t\t\t<hidden />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/itemset" nodeset="/data/itemset" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="itemset-label">\n\t\t\t\t\t\t<value>itemset</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/itemset" ref="/data/itemset">\n\t\t\t<label ref="jr:itext(\'itemset-label\')" />\n\t\t\t<itemset nodeset="/data/hidden[final_age &gt; 16][sex = \'F\']">\n\t\t\t\t<label ref="label" />\n\t\t\t\t<value ref="value" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>\n');var t=a.A.getMug("/data/itemset/itemset");x.strictEqual(t.spec.itemsetData.validationFunc(t),"pass")}))})),describe("with a custom fixture",(function(){it("should not warn on unrecognized values and labels",(function(){a.A.loadXML(h);var t=a.A.getMug("/data/question2/itemset");x.strictEqual(t.spec.itemsetData.validationFunc(t),"pass"),t.p.itemsetData.instance.src="blah",x.strictEqual(t.spec.itemsetData.validationFunc(t),"pass")}))})),describe("with recognized fixture",(function(){it("should warn on unrecognized values and labels",(function(){a.A.loadXML(h);var t=a.A.getMug("/data/question2/itemset");x.strictEqual(t.spec.itemsetData.validationFunc(t),"pass"),v("question2/itemset"),r()("[name=property-valueRef]").val("blah").change(),x.notStrictEqual(t.spec.valueRef.validationFunc(t),"pass")})),it("should not warn on values with a filter attached",(function(){a.A.loadXML(h);var t=a.A.getMug("/data/question2/itemset");x.strictEqual(t.spec.itemsetData.validationFunc(t),"pass"),v("question2/itemset");var e=r()("[name=property-valueRef]");e.val(e.val()+"[filter]").change(),x.strictEqual(t.spec.valueRef.validationFunc(t),"pass")})),it("should not warn on labels with a filter attached",(function(){a.A.loadXML(h);var t=a.A.getMug("/data/question2/itemset");x.strictEqual(t.spec.itemsetData.validationFunc(t),"pass"),v("question2/itemset");var e=r()("[name=property-labelRef]");e.val(e.val()+"[filter]").change(),x.strictEqual(t.spec.labelRef.validationFunc(t),"pass")})),it("should not warn on inner filters",(function(){a.A.loadXML(h);var t=a.A.getMug("/data/question2/itemset");x.strictEqual(t.spec.itemsetData.validationFunc(t),"pass"),v("question2/itemset"),r()("[name=property-labelRef]").val("inner-attribute[filter1]/extra-inner-attribute[filter2]").change(),x.strictEqual(t.spec.labelRef.validationFunc(t),"pass")}))}))}))})),describe("The Dynamic Itemset plugin with no fixtures",(function(){var t,e=[{id:"ignored",uri:"jr://not-a-fixture"}];before((function(n){a.A.init({plugins:b,javaRosa:{langs:["en"]},core:{dataSourcesEndpoint:function(t){t(e)},onReady:function(){t=this,n()}},features:{lookup_tables:!0}})})),beforeEach((function(){t.datasources.reset()})),it("should be able to configure Lookup Table Data",(function(){a.A.addQuestion("SelectDynamic","select"),a.A.clickQuestion("select/itemset"),x.equal(r()("[name=property-itemsetData]").length,1)}))}))},1134:(t,e,n)=>{n.d(e,{A:()=>D});var a=n(8449),s=n(8324),o=n.n(s),i=n(6848),r=n.n(i),l=n(3794),c=n(4523),u=n(561),m=n.n(u),d=n(1437),f=n.n(d),h=n(3809),p=n.n(h),x=n(705),g=n.n(x),v=n(7229),b=n.n(v),w=(n(1460),n(8803),o().assert),q=["Form Builder clip","version 1"];function A(t,e,n){if((n=c.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var a=b().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+a+'"')}var s,o,i,l,u=(s=t,o=e,i=r().xml(s),l=r().xml(o),r().isEquivalent(i,l,{element_order:!0}));n.not&&(u=!u),u||y(t=j(t),e=j(e),"XML "+(n.not?"should not be equivalent":"mismatch"))}function y(t,e,n){if(t!==e){var a=(0,l.createPatch)("",t,e,"actual","expected");a=a.replace(/^Index:/,n||"Not equal:"),w(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(a))}}function j(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function M(t){return L("getCurrentMugInput",t)}function X(t){var e=m()("#vellum").vellum("get"),n=c.Ay.isString(t)?m()("[name="+t+"]"):t;return g().util.getWidget(n,e)}function L(){var t=Array.prototype.slice.call(arguments),e=m()("#vellum");return e.vellum.apply(e,t)}function _(){var t=[],e=c.Ay.map(arguments,(function(e){var n=c.Ay.isString(e)?F(e):e;if(!n||!n.ufid)throw new Error("mug not found: "+e);return t.push(n),n.ufid}));return L("jstree","deselect_all",!0),L("jstree","select_node",e),m()(".collapse-toggle.collapsed").click(),t}function F(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=L("getMugByPath",t);if(!e){var n=t.split("/"),a=L("getMugByPath",n.slice(0,-1).join("/"));if(a&&a.__className.indexOf("Select")>-1){var s=L("getData").core.form.getChildren(a),o=n[n.length-1];if(1===s.length&&"itemset"===o&&"itemset"===s[0].options.tagName)return s[0];for(var i=0;i<s.length;i++)if(s[i].p.nodeID===o)return s[i]}}return e}w.equal=w.strictEqual,w.notEqual=w.notStrictEqual;const D={options:a.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=m().extend(!0,{},a.A.options,t),n=m().fn.animate;m().fn.animate=function(t,e,a,s){n.apply(this,[t,0,a,s])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=c.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&c.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var s=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,s(t)};var o=m()("#vellum"),i=o.vellum("get");i&&(i.destroy(),m()("body > div.modal, body > div.modal-backdrop").remove()),o.empty().vellum(e)},call:L,loadXML:function(t,e,n,a,s=!0){var o=[],i=L("getData");return a||window.history.replaceState(null,null," "),i.core.parseWarnings=[],L("loadXML",t,e||{},{reset:s}),n?c.Ay.isRegExp(n)&&(o=c.Ay.filter(i.core.parseWarnings,(function(t){return!n.test(t)}))):o=i.core.parseWarnings,w(!o.length,"unexpected parse warnings:\n- "+o.join("\n- ")),delete i.core.parseWarnings,i.core.form},saveAndReload:function(t){L("loadXFormOrError",L("createXML"),t)},getMug:F,getInput:M,getWidget:X,getMediaUploader:function(t){var e,n={},a=X(t);if(!a)throw new Error("media uploader widget not found");if(c.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(e=t.closest(n)).length})),!e)throw new Error("media uploader element not found");return n.upload=function(t){var n={ref:{path:a.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",n)},n},assertEqual:y,assertInputCount:function(t,e,n){c.Ay.isString(t)?(n=" for "+(n?n+" ":"")+t,t=M(t)):n=n?" for "+n:"",w.equal(t.length,e,"wrong number of inputs"+n)},assertXmlEqual:A,assertXmlNotEqual:function(t,e,n){(n=n||{}).not=!0,A(t,e,n)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";y(function t(e,n){var a,s,o,i=[];for("#"===e.id?n=-1:i.push(Array(2*n+1).join(" ")+e.text),a=0,s=e.children.length;a<s;a++)o=L("jstree","get_node",e.children[a]),i.push(t(o,n+1));return i.join("\n")}(L("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";y(function t(e,n){var a,s,o,i=[];for(e.isRootNode?n=-1:i.push(Array(2*n+1).join(" ")+e.value.p.nodeID),a=0,s=e.children.length;a<s;a++)o=e.children[a],i.push(t(o,n+1));return i.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,n){n=c.Ay.extend({},n),this.prevId&&_(this.prevId);var a=L("addQuestion",t);return e||a.p.nodeID||(e=L("nodeIDFromLabel",a)),e&&(w(c.Ay.isUndefined(n.nodeID),"unexpected attribute for "+t+"["+e+"]"),a.p.labelItext&&a.p.labelItext.set(a.getLabelValue()),a.p.nodeID=e,"Choice"!==t||n.hasOwnProperty("labelItext")||(n.labelItext=e)),c.Ay.each(n,(function(t,e){c.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?a.p[e].set(t):a.p[e]=t})),c.Ay.each(L("getSections",a),(function(t){L("collapseSection",t.slug,!1)})),a},paste:function(t,e,n){c.Ay.isString(t)||(t=p().tabDelimit([q].concat(t))),n&&window.console.log(t),w.deepEqual(f().paste(t),e||[])},clickQuestion:_,selectAll:function(){L("jstree","select_all")},deleteQuestion:function(){var t=c.Ay.map(arguments,(function(t){var e=F(t);return w(e,"mug not found: "+t),e}));L("getData").core.form.removeMugsFromForm(t),c.Ay.each(arguments,(function(t){w(!F(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=L("getData").core.saveButton;if(!c.Ay.isUndefined(t)){var n=t?"save":"saved";e.setStateWhenReady(n),w.equal(e.state,n,"sanity check failed")}return"save"===e.state},expandGroup:function(t){L("jstree","open_node",t.ufid),L("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){L("jstree","close_node",t.ufid),L("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],n=null;if(c.Ay.isString(t)){var a=t;t=F(a),w(t,"mug not found: "+a)}return t.messages.each((function(t,a){a!==n&&(e.push(a+":"),n=a),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,n){if(c.Ay.isString(e)){var a=e;e=function(t){return t.text===a}}return function n(a){var s,o,i;if(e(a))return a;for(s=0,o=a.children.length;s<o;s++)if(i=n(t.get_node(a.children[s])))return i;return null}(n||t.get_node("#"))},isTreeNodeValid:function(t){if(c.Ay.isString(t)){var e=t;t=F(e),w(t,"mug not found: "+e)}return 0===m()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return m()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:b().parseXML}},3220:t=>{t.exports='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4BE1309B-ABCF-4184-8175-9E381F3E0DD7" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question2 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance id="somefixture" src="jr://fixture/some-fixture" />\n\t\t\t<bind vellum:nodeset="#form/question2" nodeset="/data/question2" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question2-label">\n\t\t\t\t\t\t<value>question2</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/question2" ref="/data/question2">\n\t\t\t<label ref="jr:itext(\'question2-label\')" />\n\t\t\t<itemset nodeset="instance(\'somefixture\')/foos/foo[@foo_type=\'woo\'][1=2]/bar[@bar_type=\'eggs\']">\n\t\t\t\t<label ref="case_name" />\n\t\t\t\t<value ref="@case_id" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>\n'},2295:t=>{t.exports='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4BE1309B-ABCF-4184-8175-9E381F3E0DD7" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance id="casedb" src="jr://instance/casedb" />\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" constraint="1 = 1" jr:constraintMsg="jr:itext(\'question1-constraintMsg\')"/>\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="question1-constraintMsg">\n\t\t\t\t\t\t<value>constraint</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t\t<alert ref="jr:itext(\'question1-constraintMsg\')" />\n\t\t\t<itemset nodeset="instance(\'casedb\')/casedb/case[@case_type=\'mother\']">\n\t\t\t\t<label ref="case_name" />\n\t\t\t\t<value ref="@case_id" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>\n'}}]);