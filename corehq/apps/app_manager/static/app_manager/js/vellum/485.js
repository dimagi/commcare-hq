(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[485],{5641:(t,e,n)=>{"use strict";n.d(e,{A:()=>l});var a=n(1601),o=n.n(a),i=n(6314),s=n.n(i)()(o());s.push([t.id,'.clearfix {\n  *zoom: 1;\n}\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: "";\n  line-height: 0;\n}\n.clearfix:after {\n  clear: both;\n}\n.hide-text {\n  font: 0/0 a;\n  color: transparent;\n  text-shadow: none;\n  background-color: transparent;\n  border: 0;\n}\n.input-block-level {\n  display: block;\n  width: 100%;\n  min-height: 30px;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n}\n.fd-xpath-editor .fd-xpath-editor-content {\n  padding: 20px;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset {\n  position: relative;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend {\n  *zoom: 1;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend:before,\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend:after {\n  display: table;\n  content: "";\n  line-height: 0;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend:after {\n  clear: both;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend button {\n  margin-bottom: 5px;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset .fd-xpath-editor-expressions .xpath-expression-group:last-child {\n  margin-bottom: 0;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset .fd-xpath-editor-expressions .xpath-expression-group .validation-results {\n  display: inline-block;\n  padding: 5px 25px;\n  margin-bottom: 0;\n}\n',""]);const l=s},4618:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>m});var a=n(5072),o=n.n(a),i=n(7825),s=n.n(i),l=n(7659),d=n.n(l),r=n(5056),c=n.n(r),p=n(540),f=n.n(p),h=n(1113),u=n.n(h),x=n(5641),g={};g.styleTagTransform=u(),g.setAttributes=c(),g.insert=d().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=f(),o()(x.A,g);const m=x.A&&x.A.locals?x.A.locals:void 0},4485:(t,e,n)=>{var a,o;a=[n(561),n(3946),n(2183),n(939),n(4459),n(3578),n(5881),n(8598),n(5261),n(4618)],void 0===(o=function(t,e,n,a,o,i,s,l,d){function r(t,e){if(e){o.isInvalid(e)&&(e=o.unescapeXPath(e,t));try{return[!0,t.xpath.parse(e)]}catch(t){return[!1,t]}}return[!0,null]}return{showXPathEditor:function(c,p){var f,h=c,u={isExpression:!0},x=p.mug.form,g=e.partial(r,x);p=e.defaults(p,{leftPlaceholder:gettext("Drag question here"),rightPlaceholder:gettext("Drag question here")});var m=function(){f.removeClass("btn-default disabled").addClass("btn-success"),p.change()},v={},b=[],y=x.xpath.models.XPathExpressionTypeEnum,C={toString:function(t,e,n){return"("+e+") "+x.xpath.models.expressionTypeEnumToXPathLiteral(t)+" ("+n+")"},typeLeftRight:function(t){return t}};function E(t,e,n){e=x.xpath.models.expressionTypeEnumToXPathLiteral(e),v[e]=t,b.push([n,e])}E(C,y.EQ,gettext("is equal to")),E(C,y.NEQ,gettext("is not equal to")),E(C,y.LT,gettext("is less than")),E(C,y.LTE,gettext("is less than or equal to")),E(C,y.GT,gettext("is greater than")),E(C,y.GTE,gettext("is greater than or equal to")),E({toString:function(t,e,n){return t+"("+e+", "+n+")"},typeLeftRight:function(t){return 2===t.args.length&&{type:t.id,left:t.args[0],right:t.args[1]}}},"selected",gettext("has selected value"));var T=function(){return c.find(".fd-xpath-editor-text")},P=function(t,e){p.mug.form.richText?o.editor(t,x,u).setValue(e):t.val(e)},w=function(t){return p.mug.form.richText?o.editor(t,x,u).getValue():t.val()},k=function(){return c.find(".fd-xpath-validation-summary")},A=function(){return c.find(".fd-xpath-editor-expressions")},L=function(){return t(h.find(".top-level-join-select")[0])},q=function(t,n){n?(e.isFunction(n)&&(n=n()),a.autocomplete(t,p.mug,{choices:n})):a.autocomplete(t,p.mug,{property:p.path,useRichText:p.mug.form.richText})},X=function(){var e=A(),n=[],a=L().val();e.children().each((function(){var e=w(t(this).find(".left-question")),a=w(t(this).find(".right-question"));if(""!==e||""!==a){var o=t(t(this).find(".op-select")[0]).val(),i=v[o].toString(o,e,a);n.push(i)}}));var o=n.join(" "+a+" "),i=g(o);return i[0]&&i[1]?i[1].toXPath():o},S=function(e,a){e&&p.DEBUG_MODE&&n.log("trying to add",e.toString());var i,s,d,r,c=function(e){var a="input",i="";p.mug.form.richText&&(a="div",i='contenteditable="true"');var s=t(l({operationOpts:b,leftPlaceholder:p.leftPlaceholder,rightPlaceholder:p.rightPlaceholder,tag:a,tagArgs:i}));p.mug.form.richText&&s.find(".fd-input").each((function(){o.editor(t(this),x,u)}));var d=function(){return t(s.find(".left-question")[0])},r=function(){return t(s.find(".right-question")[0])},c=function(t){m();var e=w(d()),n=w(r());s.find(".validation-results").addClass("hide"),e&&g(e)[0]&&n&&g(n)[0]?s.find(".validation-results.alert-success").removeClass("hide"):s.find(".validation-results.alert-danger").removeClass("hide")},f=function(t,e,n){P(t,e.toXPath())};if(p.mug.form.richText?s.find(".xpath-edit-node").each((function(){o.editor(t(this),x,u).on("change",c)})):s.find(".xpath-edit-node").on("keyup change",c),s.find(".op-select").on("change",c),s.find(".xpath-delete-expression").click((function(){s.remove(),m()})),e){if(p.DEBUG_MODE&&n.log("populating",e.toString()),v.hasOwnProperty(e.id)&&!(e=v[e.id].typeLeftRight(e)))return!1;f(d(),e.left),s.find(".op-select").val(x.xpath.models.expressionTypeEnumToXPathLiteral(e.type)),f(r(),e.right,e.left)}return q(d(),p.leftAutocompleteChoices),q(r(),p.rightAutocompleteChoices),s},f=function(){return A().empty(),p.DEBUG_MODE&&n.log("fail",e),!1},h=A();return e?(r=e)instanceof x.xpath.models.XPathCmpExpr||r instanceof x.xpath.models.XPathEqExpr||v.hasOwnProperty(r.id)?(i=c(e))?i.appendTo(h):f():function(t){return t instanceof x.xpath.models.XPathBoolExpr}(e)?a&&e.type!==a?f():(s=S(e.left,e.type),d=S(e.right,e.type),s&&d?(s.appendTo(h),d.appendTo(h),L().val(e.type),d):f()):f():(i=c()).appendTo(h)},D=function(t,e){P(T(),t),q(T()),A().empty(),c.find(".xpath-advanced").removeClass("hide"),c.find(".xpath-simple").addClass("hide"),c.find(".fd-xpath-actions").removeClass("form-actions-condensed"),e?(c.find(".xpath-advanced-notice").removeClass("hide"),c.find(".fd-xpath-show-simple-button").addClass("hide")):(c.find(".xpath-advanced-notice").addClass("hide"),c.find(".fd-xpath-show-simple-button").removeClass("hide"))},O=function(t){c.find(".xpath-simple").removeClass("hide"),c.find(".fd-xpath-actions").addClass("form-actions-condensed"),c.find(".xpath-advanced").addClass("hide"),A().empty(),t&&function(t){p.DEBUG_MODE&&n.log("setting ui for",t);var e=g(t);if(e[0]){var a=e[1];S(a)||D(a.toXPath(),!0)}else D(t,!0)}(t)},M=function(){var e="textarea",n='rows="5"';p.mug.form.richText&&(e="div",n='contenteditable="true"');var a=t(d({topLevelJoinOpts:[[gettext("True when ALL of the expressions are true."),y.AND],[gettext("True when ANY of the expressions are true."),y.OR]],tag:e,tagArgs:n}));h.html(a),f=a.find(".fd-xpath-save-button"),a.find(".fd-xpath-show-advanced-button").click((function(){i.fbUsage("Edit Expression","Show Advanced Mode"),D(X())})),a.find(".fd-xpath-show-simple-button").click((function(){O(w(T()))})),a.find(".fd-add-exp").click((function(){S()}));var l=a.find(".fd-xpath-editor-text");p.mug.form.richText?o.editor(l,x,u).on("change",m):l.on("change keyup",m),L().change(m);var r=function(t){p.done(t),h.empty()};return f.addClass("disabled").click((function(){var e=c.find(".xpath-simple").hasClass("hide")?w(T()):X();P(T(),e);var n=g(e);n[0]?r(e):k().html(t(s({errors:n[1].message}))).removeClass("hide")})),a.find(".fd-xpath-cancel-button").click((function(){r(!1)})),a}();!function(t){k().text("").addClass("hide"),A().empty(),"bool"===t.xpathType?(O(t.value),t.value||S()):t.mug.form.richText?D(t.value):D(x.normalizeXPath(t.value))}(p),p.onLoad&&p.onLoad(M)},validateXPath:r}}.apply(e,a))||(t.exports=o)},5261:(t,e,n)=>{const a=n(3946);t.exports=a.template('<div class="fd-xpath-editor-container form form-horizontal">\n\n    <fieldset class="xpath-advanced hide">\n        <legend> \n            <i class="fa fa-cog"></i> <%=gettext("Edit <span class=\'property-name\'>Expression</span> (Advanced)")%>\n            <button type="button" class="btn btn-default fd-xpath-show-simple-button pull-right xpath-mode-toggle">\n                <%-gettext("Show Simple Mode")%>\n            </button>\n        </legend>\n        <div class="alert alert-info xpath-advanced-notice hide">\n            <i class="fa fa-info-circle"></i>\n            <%-gettext("You are currently in Advanced Mode because your logic is too complicated for Simple Mode.")%>\n        </div>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("XPath Expression")%>\n            </label>\n            <div class="col-sm-10">\n                <<%= tag %> <%= tagArgs %>\n                          class="fd-textarea form-control fd-xpath-editor-text jstree-drop"></<%= tag %>>\n                <p class="help-block"><%-gettext("You can drag a question into the box.")%></p>\n                <p class="help-block">\n                    <a target="_blank"\n                       href="https://help.commcarehq.org/display/commcarepublic/Common+Logic+and+Calculations">\n                        <i class="fa fa-info-circle"></i> <%-gettext("Guide to Common Logic and Calculations")%>\n                    </a>\n                </p>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset class="xpath-simple hide fieldset-condensed">\n        <legend>\n            <%=gettext("Edit <span class=\'property-name\'>Expression</span>")%>\n            <button type="button" class="btn btn-default pull-right xpath-mode-toggle fd-xpath-show-advanced-button">\n                <i class="fa fa-cog"></i> <%-gettext("Show Advanced Mode")%>\n            </button>\n        </legend>\n        <div class="form-group">\n            <label class="control-label col-sm-2"><%-gettext("Result is")%></label>\n            <div class="col-sm-10">\n                <select class="form-control top-level-join-select">\n                    <% _.each(topLevelJoinOpts, function (opt) { %>\n                    <option value="<%=opt[1]%>"><%=opt[0]%></option>\n                    <% }); %>\n                </select>\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="control-label col-sm-2"><%-gettext("Expression")%></label>\n            <div class="col-sm-10">\n                <div class="fd-xpath-editor-expressions well"></div>\n                <p class="help-block pull-right">\n                    <a target="_blank"\n                       href="https://help.commcarehq.org/display/commcarepublic/Common+Logic+and+Calculations">\n                        <i class="fa fa-info-circle"></i> <%-gettext("Guide to Common Logic and Calculations")%>\n                    </a>\n                </p>\n                <p>\n                    <button type="button" class="btn btn-default fd-add-exp">\n                        <i class="fa fa-plus"></i> <%-gettext("Add Expression")%>\n                    </button>\n                </p>\n            </div>\n        </div>\n    </fieldset>\n\n    <div class="fd-xpath-validation-summary hide"></div>\n\n    <div class="form-actions form-actions-condensed fd-xpath-actions">\n        <div class="col-sm-2"></div>\n        <div class="col-sm-10">\n            <button type="button" class="btn btn-default fd-xpath-save-button"><%-gettext("Save")%></button>\n            <button type="button" class="btn btn-default fd-xpath-cancel-button"><%-gettext("Cancel")%></button>\n        </div>\n    </div>\n</div>\n')},8598:(t,e,n)=>{const a=n(3946);t.exports=a.template('<div class="form-group xpath-expression-group">\n    <div class="xpath-expression-row">\n        <div class="col-sm-3">\n            <<%=tag%> <%=tagArgs%> class="fd-input form-control left-question xpath-edit-node jstree-drop"\n                   type="text" placeholder="<%= leftPlaceholder %>" ></<%=tag%>>\n        </div>\n        <div class="col-sm-3">\n            <select class="form-control op-select">\n                <% _.each(operationOpts, function (opt) { %>\n                <option value="<%=opt[1]%>"><%=opt[0]%></option>\n                <% }); %>\n            </select>\n        </div>\n        <div class="col-sm-3">\n            <<%=tag%> <%=tagArgs%> class="fd-input form-control right-question xpath-edit-node jstree-drop"\n                   type="text" placeholder="<%= rightPlaceholder %>" ></<%=tag%>>\n        </div>\n        <div class="col-sm-3">\n            <button type="button" class="btn btn-danger xpath-delete-expression pull-right">\n                <i class="fa fa-remove"></i>\n            </button>\n            <div class="validation-result-container">\n                <p class="validation-results alert alert-success hide">\n                    <i class="fa fa-check"></i>\n                </p>\n                <p class="validation-results alert alert-danger hide">\n                    <i class="fa fa-warning"></i>\n                </p>\n            </div>\n        </div>\n    </div>\n</div>\n')},5881:(t,e,n)=>{const a=n(3946);t.exports=a.template('<div class="alert alert-danger">\n    <h4><i class="fa fa-warning"></i> <%-gettext("Validation Failed")%></h4>\n    <p><%-gettext("Please fix the error before leaving this page:")%></p>\n    <pre>\n      <%=errors%>\n    </pre>\n</div>\n')}}]);