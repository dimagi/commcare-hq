"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[460],{5460:(t,n,e)=>{var a=e(1134),o=e(8094),r=e.n(o),l=e(8324),i=e.n(l),s=e(561),d=e.n(s);const m='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/565C9D13-E3BE-4055-B272-5A5C69688FAD" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<markdown_question />\n\t\t\t\t\t<no_markdown />\n\t\t\t\t\t<markdown_but_not />\n\t\t\t\t\t<escaped_markdown />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind nodeset="/data/markdown_question" type="xsd:string" />\n\t\t\t<bind nodeset="/data/no_markdown" type="xsd:string" />\n\t\t\t<bind nodeset="/data/markdown_but_not" type="xsd:string" />\n\t\t\t<bind nodeset="/data/escaped_markdown" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>some markdown</value>\n\t\t\t\t\t\t<value form="markdown">**some markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="no_markdown-label">\n\t\t\t\t\t\t<value>just text</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="markdown_but_not-label">\n\t\t\t\t\t\t<value>**no markdown here**</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="escaped_markdown-label">\n\t\t\t\t\t\t<value>**no markdown here either**</value>\n\t\t\t\t\t\t<value form="markdown">**\\*\\*no markdown here either\\*\\***</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>some markdown</value>\n\t\t\t\t\t\t<value form="markdown">**some markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="no_markdown-label">\n\t\t\t\t\t\t<value>just text</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="markdown_but_not-label">\n\t\t\t\t\t\t<value>**no markdown here**</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="escaped_markdown-label">\n\t\t\t\t\t\t<value>**no markdown here either**</value>\n\t\t\t\t\t\t<value form="markdown">**\\*\\*no markdown here either\\*\\***</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input ref="/data/markdown_question">\n\t\t\t<label ref="jr:itext(\'markdown_question-label\')" />\n\t\t</input>\n\t\t<input ref="/data/no_markdown">\n\t\t\t<label ref="jr:itext(\'no_markdown-label\')" />\n\t\t</input>\n\t\t<input ref="/data/markdown_but_not">\n\t\t\t<label ref="jr:itext(\'markdown_but_not-label\')" />\n\t\t</input>\n\t\t<input ref="/data/escaped_markdown">\n\t\t\t<label ref="jr:itext(\'escaped_markdown-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',u='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/565C9D13-E3BE-4055-B272-5A5C69688FAD" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<markdown_question />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind nodeset="/data/markdown_question" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>**some markdown**</value>\n\t\t\t\t\t\t<value form="markdown">**some markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>**some markdown**</value>\n\t\t\t\t\t\t<value form="markdown">**some markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input ref="/data/markdown_question">\n\t\t\t<label ref="jr:itext(\'markdown_question-label\')" />\n\t\t</input>\n\t</h:body>\n\t<case_mappings />\n</h:html>\n',h='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum" vellum:ignore="markdown">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/565C9D13-E3BE-4055-B272-5A5C69688FAD" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<markdown_question />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind nodeset="/data/markdown_question" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>**some markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>**some markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input ref="/data/markdown_question">\n\t\t\t<label ref="jr:itext(\'markdown_question-label\')" />\n\t\t</input>\n\t</h:body>\n\t<case_mappings />\n</h:html>\n';var w=i().assert,c=a.A.call,x=a.A.markdownVisible;function p(){d()(".markdown-trigger").first().click()}describe("The markdown widget",(function(){before((function(t){a.A.init({javaRosa:{langs:["en","hin"]},core:{onReady:function(){t()}},features:{rich_text:!1}})})),it("should parse form that has markdown",(function(){a.A.loadXML(m);var t=a.A.getMug("/data/markdown_question");w(t.p.labelItext.hasMarkdown)})),it("should use the markdown form when there are conflicting strings",(function(){a.A.loadXML(m);var t=a.A.getMug("/data/markdown_question");w.strictEqual(t.p.labelItext.get(),"**some markdown**")})),describe("when a user has not defined markdown usage",(function(){it("should not show markdown with nothing in the text",(function(){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),w(!x())})),it("should allow turning off markdown if markdown characters are input",(function(){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),d()("[name=itext-en-label]").val("**markdown**").change(),w(x()),d()(".markdown-trigger").first().click(),w(!x())})),it("should not show markdown if non markdown characters are not input",(function(){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),w(!x()),d()("[name=itext-en-label]").val("no markdown here").change(),w(!x())})),it("should write any markdown if markdown characters are input",(function(){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),d()("[name=itext-en-label]").val("**some markdown**").change(),a.A.assertXmlEqual(c("createXML"),u,{normalize_xmlns:!0})})),it("should not write any markdown if markdown characters are not input",(function(){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),d()("[name=itext-en-label]").val("no markdown").change(),a.A.assertXmlEqual(c("createXML"),'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/AB0BB100-747E-474C-B3A0-B965AEF2CA55" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<markdown_question />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind nodeset="/data/markdown_question" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>no markdown</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>no markdown</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input ref="/data/markdown_question">\n\t\t\t<label ref="jr:itext(\'markdown_question-label\')" />\n\t\t</input>\n\t</h:body>\n\t<case_mappings />\n</h:html>\n',{normalize_xmlns:!0})})),it("should support ordered list with parens",(function(){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),d()("[name=itext-en-label]").val("1) first\n 2) second").change(),w(x())})),it("should write /data/ to output value",(function(){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),d()("[name=itext-en-label]").val("**some markdown**").change(),a.A.addQuestion("Text","question1"),d()("[name=itext-en-label]").val("* ").change();var t=d()("[name=itext-en-label]"),n=d()(".fd-question-tree").jstree(!0);r().setCaretPosition(t[0],2),a.A.findNode(n,"**some markdown**").data.handleDrop(t),a.A.assertXmlEqual(c("createXML"),'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/565C9D13-E3BE-4055-B272-5A5C69688FAD" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<markdown_question />\n\t\t\t\t\t<question1 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind nodeset="/data/markdown_question" type="xsd:string" />\n\t\t\t<bind nodeset="/data/question1" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>**some markdown**</value>\n\t\t\t\t\t\t<value form="markdown">**some markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>* <output value="/data/markdown_question" /></value>\n\t\t\t\t\t\t<value form="markdown">* <output value="/data/markdown_question" /></value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>**some markdown**</value>\n\t\t\t\t\t\t<value form="markdown">**some markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>* <output value="/data/markdown_question" /></value>\n\t\t\t\t\t\t<value form="markdown">* <output value="/data/markdown_question" /></value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input ref="/data/markdown_question">\n\t\t\t<label ref="jr:itext(\'markdown_question-label\')" />\n\t\t</input>\n\t\t<input ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t</input>\n\t</h:body>\n\t<case_mappings />\n</h:html>\n',{normalize_xmlns:!0})}))})),describe("when a user explicitly wants no markdown",(function(){beforeEach((function(t){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),d()("[name=itext-en-label]").val("**no markdown**").change(),p(),t()})),it("should not show markdown when there are markdown characters",(function(){w(!x()),d()("[name=itext-en-label]").val("~~more markdown~~").change(),w(!x())})),it("should allow re-enabling markdown",(function(){p(),w(x())})),it("should not write any markdown",(function(){a.A.assertXmlEqual(c("createXML"),'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/AB0BB100-747E-474C-B3A0-B965AEF2CA55" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<markdown_question />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind nodeset="/data/markdown_question" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>**no markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>**no markdown**</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input ref="/data/markdown_question">\n\t\t\t<label ref="jr:itext(\'markdown_question-label\')" />\n\t\t</input>\n\t</h:body>\n\t<case_mappings />\n</h:html>\n',{normalize_xmlns:!0})})),it("should activate the save button",(function(){w(a.A.saveButtonEnabled(),"save button is disabled")}))})),describe("when a user explicitly wants markdown",(function(){beforeEach((function(t){a.A.loadXML(""),a.A.addQuestion("Text","markdown_question"),d()("[name=itext-en-label]").val("**some markdown**").change(),p(),p(),t()})),it("should show markdown when there are no markdown characters",(function(){d()("[name=itext-en-label]").val("some markdown").change(),w(x())})),it("should allow turning off markdown",(function(){w(x()),p(),w(!x())})),it("should write markdown even if there are no markdown characters",(function(){d()("[name=itext-en-label]").val("some markdown").change(),a.A.assertXmlEqual(c("createXML"),'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/565C9D13-E3BE-4055-B272-5A5C69688FAD" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<markdown_question />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind nodeset="/data/markdown_question" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>some markdown</value>\n\t\t\t\t\t\t<value form="markdown">some markdown</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="markdown_question-label">\n\t\t\t\t\t\t<value>some markdown</value>\n\t\t\t\t\t\t<value form="markdown">some markdown</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input ref="/data/markdown_question">\n\t\t\t<label ref="jr:itext(\'markdown_question-label\')" />\n\t\t</input>\n\t</h:body>\n\t<case_mappings />\n</h:html>\n',{normalize_xmlns:!0})})),it("should activate the save button",(function(){w(a.A.saveButtonEnabled(),"save button is disabled")}))})),it("should not include markdown with vellum:ignore='markdown'",(function(){a.A.loadXML(h),a.A.assertXmlEqual(c("createXML"),h)})),it("should remove markdown when no markdown is specified",(function(){a.A.loadXML(u).noMarkdown=!0,a.A.assertXmlEqual(c("createXML"),h)}))}))},1134:(t,n,e)=>{e.d(n,{A:()=>F});var a=e(8449),o=e(8324),r=e.n(o),l=e(6848),i=e.n(l),s=e(3794),d=e.n(s),m=e(4523),u=e(561),h=e.n(u),w=e(1437),c=e.n(w),x=e(3809),p=e.n(x),f=e(705),g=e.n(f),v=e(7229),k=e.n(v),b=(e(1460),e(8803),r().assert),_=["Form Builder clip","version 1"];function q(t,n,e){if((e=m.Ay.defaults(e||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var a=k().parseXML(n).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+a+'"')}var o,r,l,s,d=(o=t,r=n,l=i().xml(o),s=i().xml(r),i().isEquivalent(l,s,{element_order:!0}));e.not&&(d=!d),d||A(t=y(t),n=y(n),"XML "+(e.not?"should not be equivalent":"mismatch"))}function A(t,n,e){if(t!==n){var a=d().createPatch("",t,n,"actual","expected");a=a.replace(/^Index:/,e||"Not equal:"),b(!1,function(t){var n={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(n[t[0]]||0)+"m"+t+"[0m"}))}(a))}}function y(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function j(t){return X("getCurrentMugInput",t)}function M(t){var n=h()("#vellum").vellum("get"),e=m.Ay.isString(t)?h()("[name="+t+"]"):t;return g().util.getWidget(e,n)}function X(){var t=Array.prototype.slice.call(arguments),n=h()("#vellum");return n.vellum.apply(n,t)}function E(){var t=[],n=m.Ay.map(arguments,(function(n){var e=m.Ay.isString(n)?L(n):n;if(!e||!e.ufid)throw new Error("mug not found: "+n);return t.push(e),e.ufid}));return X("jstree","deselect_all",!0),X("jstree","select_node",n),h()(".collapse-toggle.collapsed").click(),t}function L(t){0!==t.indexOf("/")&&(t="/data/"+t);var n=X("getMugByPath",t);if(!n){var e=t.split("/"),a=X("getMugByPath",e.slice(0,-1).join("/"));if(a&&a.__className.indexOf("Select")>-1){var o=X("getData").core.form.getChildren(a),r=e[e.length-1];if(1===o.length&&"itemset"===r&&"itemset"===o[0].options.tagName)return o[0];for(var l=0;l<o.length;l++)if(o[l].p.nodeID===r)return o[l]}}return n}b.equal=b.strictEqual,b.notEqual=b.notStrictEqual;const F={options:a.A,asyncatch:function(t){return function(){try{var n=Array.prototype.slice.call(arguments);return t.apply(this,n)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var n=h().extend(!0,{},a.A.options,t),e=h().fn.animate;h().fn.animate=function(t,n,a,o){e.apply(this,[t,0,a,o])},t.javaRosa&&t.javaRosa.langs&&(n.javaRosa.langs=t.javaRosa.langs),n.plugins=m.Ay.without(n.plugins,"atwho"),t.plugins&&(n.plugins=t.plugins),n&&n.features&&m.Ay.isUndefined(n.features.disable_popovers)&&(n.features.disable_popovers=!0),n.core=n.core||{};var o=n.core.saveUrl||function(){};n.core.saveUrl=function(t){return t.xform,o(t)};var r=h()("#vellum"),l=r.vellum("get");l&&(l.destroy(),h()("body > div.modal, body > div.modal-backdrop").remove()),r.empty().vellum(n)},call:X,loadXML:function(t,n,e,a,o=!0){var r=[],l=X("getData");return a||window.history.replaceState(null,null," "),l.core.parseWarnings=[],X("loadXML",t,n||{},{reset:o}),e?m.Ay.isRegExp(e)&&(r=m.Ay.filter(l.core.parseWarnings,(function(t){return!e.test(t)}))):r=l.core.parseWarnings,b(!r.length,"unexpected parse warnings:\n- "+r.join("\n- ")),delete l.core.parseWarnings,l.core.form},saveAndReload:function(t){X("loadXFormOrError",X("createXML"),t)},getMug:L,getInput:j,getWidget:M,getMediaUploader:function(t){var n,e={},a=M(t);if(!a)throw new Error("media uploader widget not found");if(m.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(e){return(n=t.closest(e)).length})),!n)throw new Error("media uploader element not found");return e.upload=function(t){var e={ref:{path:a.getRandomizedMediaPath(t)},errors:[]};n.trigger("mediaUploadComplete",e)},e},assertEqual:A,assertInputCount:function(t,n,e){m.Ay.isString(t)?(e=" for "+(e?e+" ":"")+t,t=j(t)):e=e?" for "+e:"",b.equal(t.length,n,"wrong number of inputs"+e)},assertXmlEqual:q,assertXmlNotEqual:function(t,n,e){(e=e||{}).not=!0,q(t,n,e)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";A(function t(n,e){var a,o,r,l=[];for("#"===n.id?e=-1:l.push(Array(2*e+1).join(" ")+n.text),a=0,o=n.children.length;a<o;a++)r=X("jstree","get_node",n.children[a]),l.push(t(r,e+1));return l.join("\n")}(X("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var n=Array.prototype.slice.call(arguments,1).join("\n")+"\n";A(function t(n,e){var a,o,r,l=[];for(n.isRootNode?e=-1:l.push(Array(2*e+1).join(" ")+n.value.p.nodeID),a=0,o=n.children.length;a<o;a++)r=n.children[a],l.push(t(r,e+1));return l.join("\n")}(t.rootNode,0)+"\n",n,"Unexpected tree state")},addQuestion:function(t,n,e){e=m.Ay.extend({},e),this.prevId&&E(this.prevId);var a=X("addQuestion",t);return n||a.p.nodeID||(n=X("nodeIDFromLabel",a)),n&&(b(m.Ay.isUndefined(e.nodeID),"unexpected attribute for "+t+"["+n+"]"),a.p.labelItext&&a.p.labelItext.set(a.getLabelValue()),a.p.nodeID=n,"Choice"!==t||e.hasOwnProperty("labelItext")||(e.labelItext=n)),m.Ay.each(e,(function(t,n){m.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(n)?a.p[n].set(t):a.p[n]=t})),m.Ay.each(X("getSections",a),(function(t){X("collapseSection",t.slug,!1)})),a},paste:function(t,n,e){m.Ay.isString(t)||(t=p().tabDelimit([_].concat(t))),e&&window.console.log(t),b.deepEqual(c().paste(t),n||[])},clickQuestion:E,selectAll:function(){X("jstree","select_all")},deleteQuestion:function(){var t=m.Ay.map(arguments,(function(t){var n=L(t);return b(n,"mug not found: "+t),n}));X("getData").core.form.removeMugsFromForm(t),m.Ay.each(arguments,(function(t){b(!L(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var n=X("getData").core.saveButton;if(!m.Ay.isUndefined(t)){var e=t?"save":"saved";n.setStateWhenReady(e),b.equal(n.state,e,"sanity check failed")}return"save"===n.state},expandGroup:function(t){X("jstree","open_node",t.ufid),X("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){X("jstree","close_node",t.ufid),X("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var n=[],e=null;if(m.Ay.isString(t)){var a=t;t=L(a),b(t,"mug not found: "+a)}return t.messages.each((function(t,a){a!==e&&(n.push(a+":"),e=a),n.push("  - "+t.message)})),n.join("\n")},findNode:function(t,n,e){if(m.Ay.isString(n)){var a=n;n=function(t){return t.text===a}}return function e(a){var o,r,l;if(n(a))return a;for(o=0,r=a.children.length;o<r;o++)if(l=e(t.get_node(a.children[o])))return l;return null}(e||t.get_node("#"))},isTreeNodeValid:function(t){if(m.Ay.isString(t)){var n=t;t=L(n),b(t,"mug not found: "+n)}return 0===h()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return h()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:k().parseXML}}}]);