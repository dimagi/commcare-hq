"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[730],{4730:(t,e,n)=>{var a=n(8324),r=n.n(a),o=n(4523),l=n(1134);const d='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/960D6510-6982-48D9-BDB0-A70E352F8A57" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<parent>\n\t\t\t\t\t\t<normal-child />\n\t\t\t\t\t\t<different-child />\n\t\t\t\t\t</parent>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/parent" nodeset="/data/parent" />\n\t\t\t<bind vellum:nodeset="#form/parent/normal-child" nodeset="/data/parent/normal-child" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/parent/different-child" nodeset="/data/parent/different-child" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="different-child-label">\n\t\t\t\t\t\t<value>different-child</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="parent-label">\n\t\t\t\t\t\t<value>parent</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="normal-child-label">\n\t\t\t\t\t\t<value>normal-child</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/parent/different-child" ref="/data/parent/different-child">\n\t\t\t<label ref="jr:itext(\'different-child-label\')" />\n\t\t</input>\n\t\t<group vellum:ref="#form/parent" ref="/data/parent">\n\t\t\t<label ref="jr:itext(\'parent-label\')" />\n\t\t\t<input vellum:ref="#form/parent/normal-child" ref="/data/parent/normal-child">\n\t\t\t\t<label ref="jr:itext(\'normal-child-label\')" />\n\t\t\t</input>\n\t\t</group>\n\t</h:body>\n</h:html>\n',i='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/960D6510-6982-48D9-BDB0-A70E352F8A57" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<group />\n\t\t\t\t\t<text />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<bind vellum:nodeset="#form/text" nodeset="/data/text" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="group-label">\n\t\t\t\t\t\t<value>group</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="text-label">\n\t\t\t\t\t\t<value>text</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group vellum:ref="#form/group" ref="/data/group">\n\t\t\t<label ref="jr:itext(\'group-label\')" />\n\t\t\t<input vellum:ref="#form/text" ref="/data/text">\n\t\t\t\t<label ref="jr:itext(\'text-label\')" />\n\t\t\t</input>\n\t\t</group>\n\t</h:body>\n</h:html>\n',u='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/960D6510-6982-48D9-BDB0-A70E352F8A57" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<before-child />\n\t\t\t\t\t<parent>\n\t\t\t\t\t\t<child />\n\t\t\t\t\t</parent>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/before-child" nodeset="/data/before-child" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/parent" nodeset="/data/parent" />\n\t\t\t<bind vellum:nodeset="#form/parent/child" nodeset="/data/parent/child" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="before-child-label">\n\t\t\t\t\t\t<value>before-child</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="child-label">\n\t\t\t\t\t\t<value>child</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="parent-label">\n\t\t\t\t\t\t<value>parent</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/before-child" ref="/data/before-child">\n\t\t\t<label ref="jr:itext(\'before-child-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/parent/child" ref="/data/parent/child">\n\t\t\t<label ref="jr:itext(\'child-label\')" />\n\t\t</input>\n\t\t<group vellum:ref="#form/parent" ref="/data/parent">\n\t\t\t<label ref="jr:itext(\'parent-label\')" />\n\t\t</group>\n\t</h:body>\n</h:html>\n',s='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/960D6510-6982-48D9-BDB0-A70E352F8A57" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<after-child />\n\t\t\t\t\t<parent>\n\t\t\t\t\t\t<child />\n\t\t\t\t\t</parent>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/after-child" nodeset="/data/after-child" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/parent" nodeset="/data/parent" />\n\t\t\t<bind vellum:nodeset="#form/parent/child" nodeset="/data/parent/child" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="child-label">\n\t\t\t\t\t\t<value>child</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="after-child-label">\n\t\t\t\t\t\t<value>after-child</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="parent-label">\n\t\t\t\t\t\t<value>parent</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/parent/child" ref="/data/parent/child">\n\t\t\t<label ref="jr:itext(\'child-label\')" />\n\t\t</input>\n        <input vellum:ref="#form/after-child" ref="/data/after-child">\n            <label ref="jr:itext(\'after-child-label\')" />\n        </input>\n\t\t<group vellum:ref="#form/parent" ref="/data/parent">\n\t\t\t<label ref="jr:itext(\'parent-label\')" />\n\t\t</group>\n\t</h:body>\n</h:html>\n',p='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/960D6510-6982-48D9-BDB0-A70E352F8A57" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<before-child />\n\t\t\t\t\t<after-child />\n\t\t\t\t\t<parent>\n\t\t\t\t\t\t<child />\n\t\t\t\t\t</parent>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/before-child" nodeset="/data/before-child" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/after-child" nodeset="/data/after-child" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/parent" nodeset="/data/parent" />\n\t\t\t<bind vellum:nodeset="#form/parent/child" nodeset="/data/parent/child" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="before-child-label">\n\t\t\t\t\t\t<value>before-child</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="child-label">\n\t\t\t\t\t\t<value>child</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="after-child-label">\n\t\t\t\t\t\t<value>after-child</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="parent-label">\n\t\t\t\t\t\t<value>parent</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/before-child" ref="/data/before-child">\n\t\t\t<label ref="jr:itext(\'before-child-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/parent/child" ref="/data/parent/child">\n\t\t\t<label ref="jr:itext(\'child-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/after-child" ref="/data/after-child">\n\t\t\t<label ref="jr:itext(\'after-child-label\')" />\n\t\t</input>\n\t\t<group vellum:ref="#form/parent" ref="/data/parent">\n\t\t\t<label ref="jr:itext(\'parent-label\')" />\n\t\t</group>\n\t</h:body>\n</h:html>\n';var m=r().assert,f=l.A.call;describe("Control elements with different data parents",(function(){before((function(t){l.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t()}}})})),it("should not allow repeat group children to have data parent outside of the repeat",(function(){l.A.loadXML("");var t=l.A.addQuestion("Repeat","repeat1"),e=l.A.addQuestion.bind({prevId:t.p.nodeID})("Text","text1"),n=l.A.addQuestion.bind({prevId:t.p.nodeID})("Text","text2");n.p.dataParent="#form",m(l.A.isTreeNodeValid(e),"text1 should be valid"),m(!l.A.isTreeNodeValid(n),"text2 should not be valid")})),it("should allow repeat group children to have data parent (in) the same repeat",(function(){l.A.loadXML("");var t=l.A.addQuestion("Repeat","repeat"),e=l.A.addQuestion.bind({prevId:"repeat"})("Group","group"),n=l.A.addQuestion.bind({prevId:"repeat/group"})("Text","text");n.p.dataParent=t.hashtagPath,m.equal(e,n.parentMug,"group should be control parent of text"),m(l.A.isTreeNodeValid(n),"text should be valid")})),it("should not allow nested repeat group children to have data parent in an outer repeat",(function(){l.A.loadXML("");var t=l.A.addQuestion("Repeat","repeat1"),e=l.A.addQuestion.bind({prevId:"repeat1"})("Repeat","repeat2"),n=l.A.addQuestion.bind({prevId:"repeat1/repeat2"})("Text","text");n.p.dataParent=t.hashtagPath,m.equal(e,n.parentMug,"repeat2 should be control parent of text"),m.match(l.A.getMessages(n),/Data parent of question in repeat group must be .... the same repeat group/)})),it("should not allow a data parent to be an input",(function(){l.A.loadXML("");var t=l.A.addQuestion("Text","text1"),e=l.A.addQuestion("Text","text2");e.p.dataParent="#form/text1",m(l.A.isTreeNodeValid(t),"text1 should be valid"),m(!l.A.isTreeNodeValid(e),"text2 should not be valid")})),it("should keep the same data parent after a move",(function(){l.A.loadXML("");var t=l.A.addQuestion("Text","text1"),e=l.A.addQuestion("Text","text2"),n=f("getData").core.form;l.A.addQuestion("Group","group1"),e.p.dataParent="#form/group1",n.moveMug(e,"before",t),m.equal(e.p.dataParent,"#form/group1")})),it("should update data tree after a change to data parent",(function(){l.A.loadXML("");var t=l.A.addQuestion("Text","text1"),e=l.A.addQuestion("Group","group1"),n=l.A.addQuestion.bind({prevId:t.p.nodeID})("Group","group2"),a=f("getData").core.form;t.p.dataParent="#form/group1",m.equal(t.p.dataParent,"#form/group1"),a.moveMug(e,"into",n),m.equal(t.p.dataParent,"#form/group2/group1")})),it("should clear the data parent when moving to a repeat group",(function(){l.A.loadXML("");var t=l.A.addQuestion("Text","text1");l.A.addQuestion("Group","group1");var e=l.A.addQuestion.bind({prevId:t.p.nodeID})("Repeat","repeat1"),n=f("getData").core.form;t.p.dataParent="#form/group1",n.moveMug(t,"into",e),m(l.A.isTreeNodeValid(t),t.getErrors().join("\n")),m.isUndefined(t.p.dataParent)})),it("should not clear the data parent when moving within a repeat group",(function(){var t=l.A.loadXML(""),e=l.A.addQuestion("Repeat","repeat1"),n=l.A.addQuestion.bind({prevId:"repeat1"})("Group","group1"),a=l.A.addQuestion.bind({prevId:"repeat1"})("Text","text1");a.p.dataParent="#form/repeat1",m.equal(a.parentMug,e,"repeat1 should be control parent of text"),t.moveMug(a,"into",n),m(l.A.isTreeNodeValid(a),a.getErrors().join("\n")),m.equal(a.p.dataParent,e.hashtagPath),m.equal(a.parentMug,n,"group should be control parent of text")})),it("should clear the data parent when moving into a nested repeat group",(function(){var t=l.A.loadXML(""),e=l.A.addQuestion("Repeat","repeat1");l.A.addQuestion.bind({prevId:"repeat1"})("Repeat","repeat2");var n=l.A.addQuestion.bind({prevId:"repeat1/repeat2"})("Group","group1"),a=l.A.addQuestion.bind({prevId:"repeat1"})("Text","text1");a.p.dataParent="#form/repeat1",m.equal(a.parentMug,e,"repeat1 should be control parent of text"),t.moveMug(a,"into",n),m(l.A.isTreeNodeValid(a),a.getErrors().join("\n")),m.isUndefined(a.p.dataParent),m.equal(a.parentMug,n,"group should be control parent of text")})),it("should have proper data parent after reloading the form",(function(){l.A.loadXML("");var t=l.A.addQuestion("Text","text1"),e=f("getData").core.form;l.A.addQuestion("Group","group1"),t.p.dataParent="#form/group1",l.A.loadXML(f("createXML")),m.equal(t.p.dataParent,"#form/group1"),l.A.assertTreeState(e.dataTree(),"group1","  text1")})),it("should update mug path mapping on set data parent",(function(){var t=l.A.loadXML(""),e=l.A.addQuestion("Text","text");l.A.addQuestion("Group","group"),e.p.dataParent="#form/group";var n=JSON.stringify(o.Ay.object(o.Ay.map(t.mugMap,(function(t,e){return e.startsWith("/")?[e,t.__className]:["",void 0]}))));m(l.A.getMug("/data/group/text"),'cannot find "#form/group/text" in '+n)})),it("should parse and write XML to have the same order",(function(){l.A.loadXML(d),l.A.assertXmlEqual(f("createXML"),d)})),it("should have proper data parent after being loaded from xml",(function(){l.A.loadXML(d);var t=l.A.getMug("/data/parent/different-child");m.equal(t.p.dataParent,"#form/parent"),l.A.assertJSTreeState("different-child","parent","  normal-child")})),it("should use the control parent when inserting after a mug with different data parent",(function(){l.A.loadXML("");var t=f("getData").core.form,e=l.A.addQuestion("Text","text1");l.A.addQuestion("Group","group"),l.A.addQuestion("Text","text2"),e.p.dataParent="#form/group",l.A.addQuestion.bind({prevId:e.absolutePath})("Text","text3"),l.A.assertTreeState(t.dataTree(),"text3","group","  text2","  text1"),l.A.assertJSTreeState("text1","text3","group","  text2")})),it("should properly load group before sibling/child",(function(){l.A.loadXML(i);var t=l.A.getMug("/data/text");m.equal(t.p.dataParent,"#form"),l.A.assertJSTreeState("group","  text"),l.A.assertXmlEqual(f("createXML"),i)})),it("should properly load mug after other mugs",(function(){l.A.loadXML(u);var t=l.A.getMug("/data/parent/child");m.equal(t.p.dataParent,"#form/parent"),l.A.assertJSTreeState("before-child","child","parent"),l.A.assertXmlEqual(f("createXML"),u)})),it("should properly load mug before other mugs",(function(){l.A.loadXML(s);var t=l.A.getMug("/data/parent/child");m.equal(t.p.dataParent,"#form/parent"),l.A.assertJSTreeState("child","after-child","parent"),l.A.assertXmlEqual(f("createXML"),s)})),it("should properly load mug in between other mugs",(function(){l.A.loadXML(p);var t=l.A.getMug("/data/parent/child");m.equal(t.p.dataParent,"#form/parent"),l.A.assertJSTreeState("before-child","child","after-child","parent"),l.A.assertXmlEqual(f("createXML"),p)})),it("should error on recursive data parent",(function(){l.A.loadXML("");var t=l.A.addQuestion("Text","mug");m.equal(t.absolutePath,"/data/mug"),t.p.dataParent="#form/mug",m.deepEqual(t.getErrors(),[gettext("{path} is not a valid data parent").replace("{path}","#form/mug")])}))}))},1134:(t,e,n)=>{n.d(e,{A:()=>D});var a=n(8449),r=n(8324),o=n.n(r),l=n(6848),d=n.n(l),i=n(3794),u=n.n(i),s=n(4523),p=n(561),m=n.n(p),f=n(1437),h=n.n(f),c=n(3809),g=n.n(c),x=n(705),v=n.n(x),b=n(7229),A=n.n(b),w=(n(1460),n(8803),o().assert),y=["Form Builder clip","version 1"];function j(t,e,n){if((n=s.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var a=A().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+a+'"')}var r,o,l,i,u=(r=t,o=e,l=d().xml(r),i=d().xml(o),d().isEquivalent(l,i,{element_order:!0}));n.not&&(u=!u),u||M(t=q(t),e=q(e),"XML "+(n.not?"should not be equivalent":"mismatch"))}function M(t,e,n){if(t!==e){var a=u().createPatch("",t,e,"actual","expected");a=a.replace(/^Index:/,n||"Not equal:"),w(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(a))}}function q(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function X(t){return L("getCurrentMugInput",t)}function T(t){var e=m()("#vellum").vellum("get"),n=s.Ay.isString(t)?m()("[name="+t+"]"):t;return v().util.getWidget(n,e)}function L(){var t=Array.prototype.slice.call(arguments),e=m()("#vellum");return e.vellum.apply(e,t)}function Q(){var t=[],e=s.Ay.map(arguments,(function(e){var n=s.Ay.isString(e)?S(e):e;if(!n||!n.ufid)throw new Error("mug not found: "+e);return t.push(n),n.ufid}));return L("jstree","deselect_all",!0),L("jstree","select_node",e),m()(".collapse-toggle.collapsed").click(),t}function S(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=L("getMugByPath",t);if(!e){var n=t.split("/"),a=L("getMugByPath",n.slice(0,-1).join("/"));if(a&&a.__className.indexOf("Select")>-1){var r=L("getData").core.form.getChildren(a),o=n[n.length-1];if(1===r.length&&"itemset"===o&&"itemset"===r[0].options.tagName)return r[0];for(var l=0;l<r.length;l++)if(r[l].p.nodeID===o)return r[l]}}return e}w.equal=w.strictEqual,w.notEqual=w.notStrictEqual;const D={options:a.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=m().extend(!0,{},a.A.options,t),n=m().fn.animate;m().fn.animate=function(t,e,a,r){n.apply(this,[t,0,a,r])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=s.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&s.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var r=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,r(t)};var o=m()("#vellum"),l=o.vellum("get");l&&(l.destroy(),m()("body > div.modal, body > div.modal-backdrop").remove()),o.empty().vellum(e)},call:L,loadXML:function(t,e,n,a){var r=[],o=L("getData");return a||window.history.replaceState(null,null," "),o.core.parseWarnings=[],L("loadXML",t,e||{}),n?s.Ay.isRegExp(n)&&(r=s.Ay.filter(o.core.parseWarnings,(function(t){return!n.test(t)}))):r=o.core.parseWarnings,w(!r.length,"unexpected parse warnings:\n- "+r.join("\n- ")),delete o.core.parseWarnings,o.core.form},saveAndReload:function(t){L("loadXFormOrError",L("createXML"),t)},getMug:S,getInput:X,getWidget:T,getMediaUploader:function(t){var e,n={},a=T(t);if(!a)throw new Error("media uploader widget not found");if(s.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(e=t.closest(n)).length})),!e)throw new Error("media uploader element not found");return n.upload=function(t){var n={ref:{path:a.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",n)},n},assertEqual:M,assertInputCount:function(t,e,n){s.Ay.isString(t)?(n=" for "+(n?n+" ":"")+t,t=X(t)):n=n?" for "+n:"",w.equal(t.length,e,"wrong number of inputs"+n)},assertXmlEqual:j,assertXmlNotEqual:function(t,e,n){(n=n||{}).not=!0,j(t,e,n)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";M(function t(e,n){var a,r,o,l=[];for("#"===e.id?n=-1:l.push(Array(2*n+1).join(" ")+e.text),a=0,r=e.children.length;a<r;a++)o=L("jstree","get_node",e.children[a]),l.push(t(o,n+1));return l.join("\n")}(L("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";M(function t(e,n){var a,r,o,l=[];for(e.isRootNode?n=-1:l.push(Array(2*n+1).join(" ")+e.value.p.nodeID),a=0,r=e.children.length;a<r;a++)o=e.children[a],l.push(t(o,n+1));return l.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,n){n=s.Ay.extend({},n),this.prevId&&Q(this.prevId);var a=L("addQuestion",t);return e||a.p.nodeID||(e=L("nodeIDFromLabel",a)),e&&(w(s.Ay.isUndefined(n.nodeID),"unexpected attribute for "+t+"["+e+"]"),a.p.labelItext&&a.p.labelItext.set(a.getLabelValue()),a.p.nodeID=e,"Choice"!==t||n.hasOwnProperty("labelItext")||(n.labelItext=e)),s.Ay.each(n,(function(t,e){s.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?a.p[e].set(t):a.p[e]=t})),s.Ay.each(L("getSections",a),(function(t){L("collapseSection",t.slug,!1)})),a},paste:function(t,e,n){s.Ay.isString(t)||(t=g().tabDelimit([y].concat(t))),n&&window.console.log(t),w.deepEqual(h().paste(t),e||[])},clickQuestion:Q,selectAll:function(){L("jstree","select_all")},deleteQuestion:function(){var t=s.Ay.map(arguments,(function(t){var e=S(t);return w(e,"mug not found: "+t),e}));L("getData").core.form.removeMugsFromForm(t),s.Ay.each(arguments,(function(t){w(!S(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=L("getData").core.saveButton;if(!s.Ay.isUndefined(t)){var n=t?"save":"saved";e.setStateWhenReady(n),w.equal(e.state,n,"sanity check failed")}return"save"===e.state},expandGroup:function(t){L("jstree","open_node",t.ufid),L("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){L("jstree","close_node",t.ufid),L("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],n=null;if(s.Ay.isString(t)){var a=t;t=S(a),w(t,"mug not found: "+a)}return t.messages.each((function(t,a){a!==n&&(e.push(a+":"),n=a),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,n){if(s.Ay.isString(e)){var a=e;e=function(t){return t.text===a}}return function n(a){var r,o,l;if(e(a))return a;for(r=0,o=a.children.length;r<o;r++)if(l=n(t.get_node(a.children[r])))return l;return null}(n||t.get_node("#"))},isTreeNodeValid:function(t){if(s.Ay.isString(t)){var e=t;t=S(e),w(t,"mug not found: "+e)}return 0===m()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return m()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:A().parseXML}}}]);