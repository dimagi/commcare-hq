"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[832],{3832:(t,e,n)=>{var o=n(8324),a=n.n(o),i=n(561),s=n.n(i),l=n(4523),r=n(1134),u=n(7229),d=n.n(u);const p='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4128D4E3-FED2-4A94-98F1-8E0BD8AFB9B0" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t</input>\n\t</h:body>\n\t<vellum:case_mappings>\n\t\t<mapping property="one">\n\t\t\t<question question_path="/data/question1" />\n\t\t</mapping>\n\t</vellum:case_mappings>\n</h:html>',m='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4128D4E3-FED2-4A94-98F1-8E0BD8AFB9B0" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>',c='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4128D4E3-FED2-4A94-98F1-8E0BD8AFB9B0" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t\t<question2 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/question2" nodeset="/data/question2" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="question2-label">\n\t\t\t\t\t\t<value>Question2</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="question2-label">\n\t\t\t\t\t\t<value>Question2</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/question2" ref="/data/question2">\n\t\t\t<label ref="jr:itext(\'question2-label\')" />\n\t\t</input>\n\t</h:body>\n\t<vellum:case_mappings>\n\t\t<mapping property="one">\n\t\t\t<question question_path="/data/question1" />\n            <question question_path="/data/question2" />\n\t\t</mapping>\n\t</vellum:case_mappings>\n</h:html>',g='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/6BB69EBD-38A4-40F8-9D9C-2907ED310E9B" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<q3 />\n\t\t\t\t\t<group1>\n\t\t\t\t\t\t<q1 />\n\t\t\t\t\t\t<q2 />\n\t\t\t\t\t</group1>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/q3" nodeset="/data/q3" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/group1" nodeset="/data/group1" />\n\t\t\t<bind vellum:nodeset="#form/group1/q1" nodeset="/data/group1/q1" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/group1/q2" nodeset="/data/group1/q2" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="q3-label">\n\t\t\t\t\t\t<value>Q3</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group1-label">\n\t\t\t\t\t\t<value>Group1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group1/q1-label">\n\t\t\t\t\t\t<value>Q1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group1/q2-label">\n\t\t\t\t\t\t<value>Q2</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="q3-label">\n\t\t\t\t\t\t<value>Q3</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group1-label">\n\t\t\t\t\t\t<value>Group1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group1/q1-label">\n\t\t\t\t\t\t<value>Q1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group1/q2-label">\n\t\t\t\t\t\t<value>Q2</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/q3" ref="/data/q3">\n\t\t\t<label ref="jr:itext(\'q3-label\')" />\n\t\t</input>\n\t\t<group vellum:ref="#form/group1" ref="/data/group1">\n\t\t\t<label ref="jr:itext(\'group1-label\')" />\n\t\t\t<input vellum:ref="#form/group1/q1" ref="/data/group1/q1">\n\t\t\t\t<label ref="jr:itext(\'group1/q1-label\')" />\n\t\t\t</input>\n\t\t\t<input vellum:ref="#form/group1/q2" ref="/data/group1/q2">\n\t\t\t\t<label ref="jr:itext(\'group1/q2-label\')" />\n\t\t\t</input>\n\t\t</group>\n\t</h:body>\n\t<vellum:case_mappings>\n\t\t<mapping property="one">\n\t\t\t<question question_path="/data/group1/q1" />\n\t\t</mapping>\n\t\t<mapping property="two">\n\t\t\t<question question_path="/data/group1/q2" />\n\t\t</mapping>\n\t\t<mapping property="three">\n\t\t\t<question question_path="/data/q3" />\n\t\t</mapping>\n\t</vellum:case_mappings>\n</h:html>',h=a().assert,f=r.A.call;function x(t){const e=d().parseXML(t).find("vellum\\:case_mappings > mapping"),n=e.find("question");return[e,n]}function v(){return s()(".fd-content-right").find('fieldset[data-slug="caseManagement"]')}const q="select";describe("The Case Management plugin",(function(){before((function(t){r.A.init({features:{},core:{onReady:function(){h(this.isPluginEnabled("caseManagement"),"caseManagement plugin should be enabled"),t()}}})})),it("preserves case mapping between loading and writing XML",(function(){r.A.loadXML(p);const t=f("createXML",!0);r.A.assertXmlEqual(t,p)})),it("outputs an empty mapping block if form lacks mappings data",(function(){r.A.loadXML(m);const t=f("createXML",!0),e=d().parseXML(t).find("vellum\\:case_mappings");h.equal(e.length,1),h.equal(e.children().length,0)})),it("should display the case management section for generic fields",(function(){r.A.loadXML(""),r.A.addQuestion("Text","text");const t=v();h.exists(t[0])})),it("should hide the case management section for labels",(function(){r.A.loadXML(""),r.A.addQuestion("Trigger","label"),h.notExists(v()[0])})),it("should hide the case management section for normal groups",(function(){r.A.loadXML(""),r.A.addQuestion("Group","normal_group"),h.notExists(v()[0])})),it("should hide the case management section for repeat groups",(function(){r.A.loadXML(""),r.A.addQuestion("Repeat","repeat_group"),h.notExists(v()[0])})),it("should hide the case management section for question lists",(function(){r.A.loadXML(""),r.A.addQuestion("FieldList","question_list"),h.notExists(v()[0])})),it("should show the saved case property data",(function(){r.A.loadXML(p);const t=f("getMugByPath","/data/question1");r.A.clickQuestion(t);const e=v().find(q);h.equal(e.val(),"one")})),it("should show the first property when multiple exist",(function(){r.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4128D4E3-FED2-4A94-98F1-8E0BD8AFB9B0" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t\t<question2 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/question2" nodeset="/data/question2" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="question2-label">\n\t\t\t\t\t\t<value>Question2</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="question2-label">\n\t\t\t\t\t\t<value>Question2</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/question2" ref="/data/question2">\n\t\t\t<label ref="jr:itext(\'question2-label\')" />\n\t\t</input>\n\t</h:body>\n\t<vellum:case_mappings>\n\t\t<mapping property="one">\n\t\t\t<question question_path="/data/question1" />\n\t\t</mapping>\n        <mapping property="two">\n            <question question_path="/data/question1" />\n        </mapping>\n\t</vellum:case_mappings>\n</h:html>');const t=f("getMugByPath","/data/question1");r.A.clickQuestion(t);const e=v().find(q),n=e.find("option:checked"),o=e.find("~ .messages");h.isTrue(e.prop("disabled")),h.equal(n.val(),"one"),h.include(o.text(),"This question is used to update multiple case properties"),h.isTrue(r.A.isTreeNodeValid(t))})),it("should save the case property to the XML",(function(){r.A.loadXML(""),r.A.addQuestion("Text","question"),v().find(q).val("one").trigger("change");const t=f("createXML",!0),[e,n]=x(t);h.equal(e.length,1),h.equal(e.attr("property"),"one"),h.equal(n.length,1),h.equal(n.attr("question_path"),"/data/question")})),it("should modify the existing mapping",(function(){r.A.loadXML(p);const t=f("getMugByPath","/data/question1");r.A.clickQuestion(t),v().find(q).val("two").trigger("change");const e=f("createXML",!0),[n,o]=x(e);h.equal(n.length,1),h.equal(n.attr("property"),"two"),h.equal(o.length,1),h.equal(o.attr("question_path"),"/data/question1")})),it("should preserve additional question attributes",(function(){r.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4128D4E3-FED2-4A94-98F1-8E0BD8AFB9B0" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t</input>\n\t</h:body>\n\t<vellum:case_mappings>\n\t\t<mapping property="one">\n\t\t\t<question question_path="/data/question1" update_mode="edit" />\n\t\t</mapping>\n\t</vellum:case_mappings>\n</h:html>');const t=f("getMugByPath","/data/question1");r.A.clickQuestion(t),v().find(q).val("two").trigger("change");const e=f("createXML",!0),[n,o]=x(e);h.equal(n.length,1),h.equal(n.attr("property"),"two"),h.equal(o.length,1),h.equal(o.attr("question_path"),"/data/question1"),h.equal(o.attr("update_mode"),"edit")})),it("should display a dropdown of potential case management properties",(function(){r.A.loadXML(""),r.A.addQuestion("Text","question1");const t=v().find(q),e=[];s().each(t.prop("options"),(function(t){const n=s()(this);e.push(n.text())})),h.deepEqual(e,["one","two","three",""])})),it("should display a warning when multiple questions are saving to the same case property",(function(){r.A.loadXML("");const t=r.A.addQuestion("Text","question1"),e=r.A.addQuestion("Text","question2");r.A.clickQuestion(t);let n=v(),o=n.find(q);o.val("one").trigger("change"),h.isTrue(r.A.isTreeNodeValid(t)),r.A.clickQuestion(e),n=v(),o=n.find(q),o.val("one").trigger("change");let a=o.find("~ .messages");h.isFalse(r.A.isTreeNodeValid(t)),h.isFalse(r.A.isTreeNodeValid(e));const i='"one" is assigned by another question. You can still save the form, but will need to have only one question for any case property in order to build the application';h.include(a.text(),i),r.A.clickQuestion(t),a=o.find("~ .messages"),h.include(a.text(),i),h.isFalse(r.A.isTreeNodeValid(t))})),it("should display a warning when loading xml with a property conflict",(function(){r.A.loadXML(c);const t=f("getMugByPath","/data/question1"),e=f("getMugByPath","/data/question2");h.isFalse(r.A.isTreeNodeValid(t)),h.isFalse(r.A.isTreeNodeValid(e)),r.A.clickQuestion(t);const n=v().find(q).find("~ .messages");h.equal(n.children().length,1)})),it("should clear the conflict warning when one of the affected questions changes its property",(function(){r.A.loadXML("");const t=r.A.addQuestion("Text","question1"),e=r.A.addQuestion("Text","question2");r.A.clickQuestion(t);let n=v(),o=n.find(q);o.val("one").trigger("change"),r.A.clickQuestion(e),n=v(),o=n.find(q),o.val("one").trigger("change"),r.A.clickQuestion(t),n=v(),o=n.find(q),o.val("two").trigger("change");const a=o.find("~ .messages");h.equal(a.children().length,0),h.isTrue(r.A.isTreeNodeValid(t)),h.isTrue(r.A.isTreeNodeValid(e))})),it("should preserve mappings when a question is renamed",(function(){r.A.loadXML(c),f("getMugByPath","/data/question1").p.nodeID="question3";const t=s()("#vellum").vellum("get").data.caseManagement,e=t.caseMappings.one.map((t=>t.question_path));h.sameOrderedMembers(e,["/data/question3","/data/question2"]),h.sameOrderedMembers(t.caseMappingsByQuestion["/data/question3"],["one"]),h.notExists(t.caseMappingsByQuestion["/data/question1"])})),it("should add custom options to future dropdowns",(function(){r.A.loadXML();const t=r.A.addQuestion("Text","question1");let e=v(),n=e.find(q);const o=new Option("newCaseProperty","newCaseProperty",!0,!0);n.append(o).trigger("change");const a=r.A.addQuestion("Text","question2");e=v(),n=e.find(q);let i=[];s().each(n.prop("options"),(function(t){const e=s()(this);i.push(e.text())})),h.deepEqual(i,["one","two","three","newCaseProperty",""]),r.A.clickQuestion(t),e=v(),n=e.find(q),n.val(null).trigger("change"),r.A.clickQuestion(a),e=v(),n=e.find(q),i=[],s().each(n.prop("options"),(function(t){const e=s()(this);i.push(e.text())})),h.deepEqual(i,["one","two","three",""])})),it("should remove child mappings when parent group is deleted",(function(){r.A.loadXML(g);const t=f("getMugByPath","/data/group1");t.form.removeMugsFromForm([t]);const e=s()("#vellum").vellum("get"),n=Object.keys(e.data.caseManagement.caseMappings);h.notInclude(n,"one"),h.notInclude(n,"two")})),it("should restore mappings when a deletion is undone",(function(){r.A.loadXML(g);const t=f("getMugByPath","/data/group1"),e=t.form;e.removeMugsFromForm([t]),e.undo();const n=s()("#vellum").vellum("get"),o=Object.keys(n.data.caseManagement.caseMappings);h.include(o,"one"),h.include(o,"two")})),it("should preserve child group mappings when the parent is renamed",(function(){r.A.loadXML(g),f("getMugByPath","/data/group1").p.nodeID="group2";const t=s()("#vellum").vellum("get").data.caseManagement,e=t.caseMappings.one.map((t=>t.question_path));h.sameOrderedMembers(e,["/data/group2/q1"]);const n=t.caseMappings.two.map((t=>t.question_path));h.sameOrderedMembers(n,["/data/group2/q2"])})),it("should clear warnings when deleting a question",(function(){r.A.loadXML(c);const t=f("getMugByPath","/data/question2");t.form.removeMugsFromForm([t]);const e=f("getMugByPath","/data/question1").messages.get("caseProperty","mug-caseProperty-conflict");h.isNull(e)})),it("should remove invalid mappings",(function(){r.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/4128D4E3-FED2-4A94-98F1-8E0BD8AFB9B0" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>Question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t</input>\n\t</h:body>\n\t<vellum:case_mappings>\n\t\t<mapping property="one">\n\t\t\t<question question_path="/data/question2" />\n\t\t</mapping>\n\t</vellum:case_mappings>\n</h:html>');const t=s()("#vellum").vellum("get").data.caseManagement;h.deepEqual(t.caseMappings,{})})),it("should preserve mappings for xml loaded without case mapping information",(function(){r.A.loadXML(p),r.A.loadXML(m,void 0,void 0,void 0,!1);const t=s()("#vellum").vellum("get").data.caseManagement.caseMappings.one.map((t=>t.question_path));h.sameOrderedMembers(t,["/data/question1"])})),it("should override existing mappings",(function(){r.A.loadXML(m),r.A.loadXML(p,void 0,void 0,void 0,!1);const t=s()("#vellum").vellum("get").data.caseManagement.caseMappings.one.map((t=>t.question_path));h.sameOrderedMembers(t,["/data/question1"])})),it("should replace case property spaces with underscores",(function(){r.A.loadXML(p);const t=f("getMugByPath","/data/question1");r.A.clickQuestion(t);const e=v().find(q);var n=new Option("hello world","hello world",!1,!1);e.append(n),e.val("hello world").trigger("change");const o=s()("#vellum").vellum("get").data.caseManagement.caseMappingsByQuestion["/data/question1"];h.sameOrderedMembers(o,["hello_world"])})),it("should show an error for reserved case properties",(function(){r.A.loadXML("");const t=r.A.addQuestion("Text","question1");let e=v().find(q);const n=new Option("case_id","case_id",!0,!0);e.append(n).trigger("change");const o=e.find("~ .messages");h.include(o.text(),"case_id is a reserved word"),h.isFalse(r.A.isTreeNodeValid(t))})),describe("with case management disabled",(function(){const t=r.A.options.options.plugins||[];before((function(e){r.A.init({plugins:(0,l.Ay)(t).without("caseManagement"),core:{onReady:function(){h(!this.isPluginEnabled("caseManagement"),"caseManagement plugin should not be enabled"),e()}}})})),it("should exclude case mappings from XML",(function(){r.A.loadXML(p);const t=f("createXML",!0),e=d().parseXML(t).find("vellum\\:case_mappings");h.equal(e.length,0)})),it("should hide the case management section",(function(){r.A.loadXML(""),r.A.addQuestion("Text","text");const t=v();h.notExists(t[0])}))}))}))},1134:(t,e,n)=>{n.d(e,{A:()=>Q});var o=n(8449),a=n(8324),i=n.n(a),s=n(6848),l=n.n(s),r=n(3794),u=n(4523),d=n(561),p=n.n(d),m=n(1437),c=n.n(m),g=n(3809),h=n.n(g),f=n(705),x=n.n(f),v=n(7229),q=n.n(v),w=(n(1460),n(8803),i().assert),y=["Form Builder clip","version 1"];function b(t,e,n){if((n=u.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var o=q().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+o+'"')}var a,i,s,r,d=(a=t,i=e,s=l().xml(a),r=l().xml(i),l().isEquivalent(s,r,{element_order:!0}));n.not&&(d=!d),d||A(t=M(t),e=M(e),"XML "+(n.not?"should not be equivalent":"mismatch"))}function A(t,e,n){if(t!==e){var o=(0,r.createPatch)("",t,e,"actual","expected");o=o.replace(/^Index:/,n||"Not equal:"),w(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(o))}}function M(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function j(t){return L("getCurrentMugInput",t)}function X(t){var e=p()("#vellum").vellum("get"),n=u.Ay.isString(t)?p()("[name="+t+"]"):t;return x().util.getWidget(n,e)}function L(){var t=Array.prototype.slice.call(arguments),e=p()("#vellum");return e.vellum.apply(e,t)}function _(){var t=[],e=u.Ay.map(arguments,(function(e){var n=u.Ay.isString(e)?F(e):e;if(!n||!n.ufid)throw new Error("mug not found: "+e);return t.push(n),n.ufid}));return L("jstree","deselect_all",!0),L("jstree","select_node",e),p()(".collapse-toggle.collapsed").click(),t}function F(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=L("getMugByPath",t);if(!e){var n=t.split("/"),o=L("getMugByPath",n.slice(0,-1).join("/"));if(o&&o.__className.indexOf("Select")>-1){var a=L("getData").core.form.getChildren(o),i=n[n.length-1];if(1===a.length&&"itemset"===i&&"itemset"===a[0].options.tagName)return a[0];for(var s=0;s<a.length;s++)if(a[s].p.nodeID===i)return a[s]}}return e}w.equal=w.strictEqual,w.notEqual=w.notStrictEqual;const Q={options:o.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=p().extend(!0,{},o.A.options,t),n=p().fn.animate;p().fn.animate=function(t,e,o,a){n.apply(this,[t,0,o,a])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=u.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&u.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var a=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,a(t)};var i=p()("#vellum"),s=i.vellum("get");s&&(s.destroy(),p()("body > div.modal, body > div.modal-backdrop").remove()),i.empty().vellum(e)},call:L,loadXML:function(t,e,n,o,a=!0){var i=[],s=L("getData");return o||window.history.replaceState(null,null," "),s.core.parseWarnings=[],L("loadXML",t,e||{},{reset:a}),n?u.Ay.isRegExp(n)&&(i=u.Ay.filter(s.core.parseWarnings,(function(t){return!n.test(t)}))):i=s.core.parseWarnings,w(!i.length,"unexpected parse warnings:\n- "+i.join("\n- ")),delete s.core.parseWarnings,s.core.form},saveAndReload:function(t){L("loadXFormOrError",L("createXML"),t)},getMug:F,getInput:j,getWidget:X,getMediaUploader:function(t){var e,n={},o=X(t);if(!o)throw new Error("media uploader widget not found");if(u.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(e=t.closest(n)).length})),!e)throw new Error("media uploader element not found");return n.upload=function(t){var n={ref:{path:o.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",n)},n},assertEqual:A,assertInputCount:function(t,e,n){u.Ay.isString(t)?(n=" for "+(n?n+" ":"")+t,t=j(t)):n=n?" for "+n:"",w.equal(t.length,e,"wrong number of inputs"+n)},assertXmlEqual:b,assertXmlNotEqual:function(t,e,n){(n=n||{}).not=!0,b(t,e,n)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";A(function t(e,n){var o,a,i,s=[];for("#"===e.id?n=-1:s.push(Array(2*n+1).join(" ")+e.text),o=0,a=e.children.length;o<a;o++)i=L("jstree","get_node",e.children[o]),s.push(t(i,n+1));return s.join("\n")}(L("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";A(function t(e,n){var o,a,i,s=[];for(e.isRootNode?n=-1:s.push(Array(2*n+1).join(" ")+e.value.p.nodeID),o=0,a=e.children.length;o<a;o++)i=e.children[o],s.push(t(i,n+1));return s.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,n){n=u.Ay.extend({},n),this.prevId&&_(this.prevId);var o=L("addQuestion",t);return e||o.p.nodeID||(e=L("nodeIDFromLabel",o)),e&&(w(u.Ay.isUndefined(n.nodeID),"unexpected attribute for "+t+"["+e+"]"),o.p.labelItext&&o.p.labelItext.set(o.getLabelValue()),o.p.nodeID=e,"Choice"!==t||n.hasOwnProperty("labelItext")||(n.labelItext=e)),u.Ay.each(n,(function(t,e){u.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?o.p[e].set(t):o.p[e]=t})),u.Ay.each(L("getSections",o),(function(t){L("collapseSection",t.slug,!1)})),o},paste:function(t,e,n){u.Ay.isString(t)||(t=h().tabDelimit([y].concat(t))),n&&window.console.log(t),w.deepEqual(c().paste(t),e||[])},clickQuestion:_,selectAll:function(){L("jstree","select_all")},deleteQuestion:function(){var t=u.Ay.map(arguments,(function(t){var e=F(t);return w(e,"mug not found: "+t),e}));L("getData").core.form.removeMugsFromForm(t),u.Ay.each(arguments,(function(t){w(!F(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=L("getData").core.saveButton;if(!u.Ay.isUndefined(t)){var n=t?"save":"saved";e.setStateWhenReady(n),w.equal(e.state,n,"sanity check failed")}return"save"===e.state},expandGroup:function(t){L("jstree","open_node",t.ufid),L("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){L("jstree","close_node",t.ufid),L("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],n=null;if(u.Ay.isString(t)){var o=t;t=F(o),w(t,"mug not found: "+o)}return t.messages.each((function(t,o){o!==n&&(e.push(o+":"),n=o),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,n){if(u.Ay.isString(e)){var o=e;e=function(t){return t.text===o}}return function n(o){var a,i,s;if(e(o))return o;for(a=0,i=o.children.length;a<i;a++)if(s=n(t.get_node(o.children[a])))return s;return null}(n||t.get_node("#"))},isTreeNodeValid:function(t){if(u.Ay.isString(t)){var e=t;t=F(e),w(t,"mug not found: "+e)}return 0===p()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return p()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:q().parseXML}}}]);