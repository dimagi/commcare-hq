"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[29],{6029:(t,e,a)=>{var n=a(1134),s=a(8324),o=a.n(s),r=a(561),l=a.n(r),d=a(4523);const c='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<name />\n\t\t\t\t\t<save_to_case vellum:role="SaveToCase" vellum:case_type="" >\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<create>\n\t\t\t\t\t\t\t\t<case_type />\n\t\t\t\t\t\t\t\t<case_name />\n\t\t\t\t\t\t\t\t<owner_id />\n\t\t\t\t\t\t\t</create>\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</save_to_case>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/name" nodeset="/data/name" type="xsd:string" />\n\t\t\t<bind nodeset="/data/save_to_case/case/create/case_type" calculate="caseType" />\n\t\t\t<bind nodeset="/data/save_to_case/case/create/case_name" vellum:calculate="#form/name" calculate="/data/name" />\n\t\t\t<bind nodeset="/data/save_to_case/case/create/owner_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@user_id" calculate="/data/meta/userID" />\n\t\t\t<setvalue event="xforms-ready" ref="/data/save_to_case/case/@case_id" value="uuid()" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="name-label">\n\t\t\t\t\t\t<value>name</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/name" ref="/data/name">\n\t\t\t<label ref="jr:itext(\'name-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',i='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<name />\n\t\t\t\t\t<save_to_case vellum:role="SaveToCase" vellum:case_type="" >\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<close />\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</save_to_case>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/name" nodeset="/data/name" type="xsd:string" />\n\t\t\t<bind nodeset="/data/save_to_case/case/close" relevant="1=1" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@user_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@case_id" calculate="/data/meta/caseID" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="name-label">\n\t\t\t\t\t\t<value>name</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/name" ref="/data/name">\n\t\t\t<label ref="jr:itext(\'name-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',m='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<name />\n\t\t\t\t\t<save_to_case vellum:role="SaveToCase" vellum:case_type="" >\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<update>\n\t\t\t\t\t\t\t\t<name />\n\t\t\t\t\t\t\t\t<dash-dash />\n\t\t\t\t\t\t\t</update>\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</save_to_case>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/name" nodeset="/data/name" type="xsd:string" />\n\t\t\t<bind nodeset="/data/save_to_case/case/update/name" vellum:relevant="#form/name != \'\'" vellum:calculate="#form/name" relevant="/data/name != \'\'" calculate="/data/name" />\n\t\t\t<bind nodeset="/data/save_to_case/case/update/dash-dash" calculate="\'-\'" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@user_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@case_id" calculate="/data/meta/caseID" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="name-label">\n\t\t\t\t\t\t<value>name</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/name" ref="/data/name">\n\t\t\t<label ref="jr:itext(\'name-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',u='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<name />\n\t\t\t\t\t<save_to_case vellum:role="SaveToCase" vellum:case_type="" >\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<index>\n\t\t\t\t\t\t\t\t<extension case_type="extension_case" relationship="extension" />\n\t\t\t\t\t\t\t</index>\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</save_to_case>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/name" nodeset="/data/name" type="xsd:string" />\n\t\t\t<bind nodeset="/data/save_to_case/case/index/extension" calculate="/data/meta/caseID" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@user_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@case_id" calculate="/data/meta/caseID" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="name-label">\n\t\t\t\t\t\t<value>name</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/name" ref="/data/name">\n\t\t\t<label ref="jr:itext(\'name-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',p='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/2F7E3113-5827-455B-B5E0-2E8856FE23E8" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t\t<save_to_case vellum:role="SaveToCase" vellum:case_type="" >\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<attachment>\n\t\t\t\t\t\t\t\t<attach from="local" name="name" />\n\t\t\t\t\t\t\t</attachment>\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</save_to_case>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="binary" />\n\t\t\t<bind nodeset="/data/save_to_case/case/attachment/attach/@src" vellum:calculate="#form/question1" calculate="/data/question1" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@user_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@case_id" calculate="/data/meta/caseID" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question1-label">\n\t\t\t\t\t\t<value>question1</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<upload mediatype="image/*" vellum:ref="#form/question1" ref="/data/question1">\n\t\t\t<label ref="jr:itext(\'question1-label\')" />\n\t\t</upload>\n\t</h:body>\n</h:html>\n',h='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<name />\n\t\t\t\t\t<save_to_case vellum:role="SaveToCase" vellum:case_type="household" >\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<close />\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</save_to_case>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/name" nodeset="/data/name" type="xsd:string" />\n\t\t\t<bind nodeset="/data/save_to_case/case/close" relevant="1=1" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@user_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/save_to_case/case/@case_id" calculate="/data/meta/caseID" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="name-label">\n\t\t\t\t\t\t<value>name</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/name" ref="/data/name">\n\t\t\t<label ref="jr:itext(\'name-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',v='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<name />\n\t\t\t\t\t<create1 vellum:role="SaveToCase" vellum:case_type="" >\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<create>\n\t\t\t\t\t\t\t\t<case_type />\n\t\t\t\t\t\t\t\t<case_name />\n\t\t\t\t\t\t\t\t<owner_id />\n\t\t\t\t\t\t\t</create>\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</create1>\n\t\t\t\t\t<create2 vellum:role="SaveToCase" vellum:case_type="" >\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<create>\n\t\t\t\t\t\t\t\t<case_type />\n\t\t\t\t\t\t\t\t<case_name />\n\t\t\t\t\t\t\t\t<owner_id />\n\t\t\t\t\t\t\t</create>\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</create2>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/name" nodeset="/data/name" type="xsd:string" />\n\t\t\t<bind nodeset="/data/create1/case/create/case_type" calculate="caseType" />\n\t\t\t<bind nodeset="/data/create1/case/create/case_name" vellum:calculate="#form/name" calculate="/data/name" />\n\t\t\t<bind nodeset="/data/create1/case/create/owner_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/create1/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/create1/case/@user_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/create2/case/create/case_type" calculate="caseType" />\n\t\t\t<bind nodeset="/data/create2/case/create/case_name" vellum:calculate="#form/name" calculate="/data/name" />\n\t\t\t<bind nodeset="/data/create2/case/create/owner_id" calculate="/data/meta/userID" />\n\t\t\t<bind nodeset="/data/create2/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/create2/case/@user_id" calculate="/data/meta/userID" />\n\t\t\t<setvalue event="xforms-ready" ref="/data/create1/case/@case_id" value="1" />\n\t\t\t<setvalue event="xforms-ready" ref="/data/create2/case/@case_id" value="1" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="name-label">\n\t\t\t\t\t\t<value>name</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/name" ref="/data/name">\n\t\t\t<label ref="jr:itext(\'name-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n';var _=o().assert,f=n.A.call;describe("The SaveToCase module",(function(){before((function(t){n.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t()}}})})),it("should load and save a create property",(function(){n.A.loadXML(c);var t=n.A.getMug("save_to_case"),e=t.p.createProperty;_.equal(e.case_type.calculate,"caseType"),_.equal(e.case_name.calculate,"/data/name"),_.equal(t.p.useCreate,!0),_.equal(e.owner_id.calculate,"/data/meta/userID"),_.equal(t.p.date_modified,"/data/meta/timeEnd"),_.equal(t.p.user_id,"/data/meta/userID"),n.A.assertXmlEqual(f("createXML"),c)})),it("should load and save a close property",(function(){n.A.loadXML(i);var t=n.A.getMug("save_to_case");_.equal(t.p.useClose,!0),_.equal(t.p.closeCondition,"1=1"),_.equal(t.p.date_modified,"/data/meta/timeEnd"),_.equal(t.p.user_id,"/data/meta/userID"),_.equal(t.p.case_id,"/data/meta/caseID"),n.A.assertXmlEqual(f("createXML"),i)})),it("should load and save a update property",(function(){n.A.loadXML(m);var t=n.A.getMug("save_to_case");_.equal(t.p.useUpdate,!0),_(d.Ay.isEqual(t.p.updateProperty,{name:{relevant:"/data/name != ''",calculate:"/data/name"},"dash-dash":{calculate:"'-'"}})),_.equal(t.p.date_modified,"/data/meta/timeEnd"),_.equal(t.p.user_id,"/data/meta/userID"),_.equal(t.p.case_id,"/data/meta/caseID"),n.A.assertXmlEqual(f("createXML"),m)})),it("should load and save a index property",(function(){n.A.loadXML(u);var t=n.A.getMug("save_to_case");_.equal(t.p.useIndex,!0),_(d.Ay.isEqual(t.p.indexProperty,{extension:{calculate:"/data/meta/caseID",case_type:"extension_case",relationship:"extension"}})),n.A.clickQuestion("save_to_case"),_.strictEqual(t.spec.indexProperty.validationFunc(t),"pass"),_.equal(t.p.date_modified,"/data/meta/timeEnd"),_.equal(t.p.user_id,"/data/meta/userID"),_.equal(t.p.case_id,"/data/meta/caseID"),n.A.assertXmlEqual(f("createXML"),u)})),it("should load and save a attachment property",(function(){n.A.loadXML(p);var t=n.A.getMug("save_to_case");_.equal(t.p.useAttachment,!0),_(d.Ay.isEqual(t.p.attachmentProperty,{attach:{calculate:"/data/question1",from:"local",name:"name"}})),_.equal(t.p.date_modified,"/data/meta/timeEnd"),_.equal(t.p.user_id,"/data/meta/userID"),_.equal(t.p.case_id,"/data/meta/caseID"),n.A.assertXmlEqual(f("createXML"),p)})),it("should load and save the case type property",(function(){n.A.loadXML(h);var t=n.A.getMug("save_to_case");_.isOk(t,"save_to_case mug should exist"),n.A.assertXmlEqual(f("createXML"),h)})),it("should support two questions with same name",(function(){n.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/45D58D8B-834F-495E-8439-0190233678CA" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<one>\n\t\t\t\t\t\t<save vellum:role="SaveToCase" vellum:case_type="case">\n\t\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t\t<create>\n\t\t\t\t\t\t\t\t\t<case_type />\n\t\t\t\t\t\t\t\t\t<case_name />\n\t\t\t\t\t\t\t\t</create>\n\t\t\t\t\t\t\t</case>\n\t\t\t\t\t\t</save>\n\t\t\t\t\t</one>\n\t\t\t\t\t<two>\n\t\t\t\t\t\t<save vellum:role="SaveToCase" vellum:case_type="case">\n\t\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t\t<create>\n\t\t\t\t\t\t\t\t\t<case_type />\n\t\t\t\t\t\t\t\t\t<case_name />\n\t\t\t\t\t\t\t\t</create>\n\t\t\t\t\t\t\t</case>\n\t\t\t\t\t\t</save>\n\t\t\t\t\t</two>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/one" nodeset="/data/one" />\n\t\t\t<bind nodeset="/data/one/save/case/create/case_type" calculate="\'case\'" />\n\t\t\t<bind nodeset="/data/one/save/case/create/case_name" calculate="\'name\'" />\n\t\t\t<bind nodeset="/data/one/save/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/one/save/case/@user_id" calculate="instance(\'commcaresession\')/session/context/userid" />\n\t\t\t<bind vellum:nodeset="#form/two" nodeset="/data/two" />\n\t\t\t<bind nodeset="/data/two/save/case/create/case_type" calculate="\'case\'" />\n\t\t\t<bind nodeset="/data/two/save/case/create/case_name" calculate="\'name\'" />\n\t\t\t<bind nodeset="/data/two/save/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/two/save/case/@user_id" calculate="instance(\'commcaresession\')/session/context/userid" />\n\t\t\t<setvalue event="xforms-ready" ref="/data/one/save/case/@case_id" value="uuid()" />\n\t\t\t<setvalue event="xforms-ready" ref="/data/two/save/case/@case_id" value="uuid()" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="one-label">\n\t\t\t\t\t\t<value>one</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="two-label">\n\t\t\t\t\t\t<value>two</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group vellum:ref="#form/one" ref="/data/one">\n\t\t\t<label ref="jr:itext(\'one-label\')" />\n\t\t</group>\n\t\t<group vellum:ref="#form/two" ref="/data/two">\n\t\t\t<label ref="jr:itext(\'two-label\')" />\n\t\t</group>\n\t</h:body>\n</h:html>');var t=n.A.getMug("one/save"),e=n.A.getMug("two/save");_.equal(t.p.case_id,"uuid()","one"),_.equal(e.p.case_id,"uuid()","two")})),describe("should not allow",(function(){var t,e;before((function(a){n.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t=n.A.addQuestion("SaveToCase","mug"),e=t.spec.attachmentProperty,a()}}})})),d.Ay.each({"inline attachments with no name":{inline_prop:{calculate:"/data/question1",from:"inline"}},"invalid from strings":{from_strings:{calculate:"/data/question1",from:"blah"}}},(function(a,n){it("should validate "+n,(function(){t.p.useAttachment=!0,t.p.attachmentProperty=a,_.notEqual(e.validationFunc(t),"pass")}))}))})),describe("should allow",(function(){var t,e;before((function(a){n.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t=n.A.addQuestion("SaveToCase","mug"),e=t.spec.attachmentProperty,a()}}})})),d.Ay.each({"inline attachments":{inline_prop:{calculate:"/data/question1",from:"inline",name:"test"}},"from strings":{from_strings:{calculate:"/data/question1",from:"local"}},"hyphenated properties":{"hyphen-props":{calculate:"/data/question1",from:"local"}}},(function(a,n){it("should validate "+n,(function(){t.p.useAttachment=!0,t.p.attachmentProperty=a,_.equal(e.validationFunc(t),"pass")}))}))})),it("should load 2 create setvalues",(function(){n.A.loadXML(v);var t=n.A.getMug("create1"),e=n.A.getMug("create2");_.equal(t.p.case_id,"1"),_.equal(e.p.case_id,"1"),n.A.assertXmlEqual(f("createXML"),v)})),it("should load and save a index property",(function(){n.A.loadXML(u),n.A.clickQuestion("save_to_case"),l()("#fd-question-edit-update").find(".fd-add-property").click(),n.A.assertXmlEqual(f("createXML"),u)})),it("should have @case_id in bind for create when in repeat",(function(){n.A.loadXML(""),n.A.addQuestion("Repeat","repeat");var t=n.A.addQuestion("SaveToCase","case",{case_id:"uuid()",user_id:"uuid()",useCreate:!0,createProperty:{case_type:"type",case_name:"name"}});_.deepInclude(t.options.getBindList(t),{nodeset:t.absolutePath+"/case/@case_id",calculate:"uuid()"})})),it("should remove case_id setvalue when removing create property",(function(){n.A.loadXML(c),n.A.deleteQuestion("/data/save_to_case");var t=f("createXML");_.equal(l()(t).find("setvalue").length,0)})),it("should remove case_id setvalue when removing newly created mug",(function(){n.A.loadXML(""),_.equal(l()(f("createXML")).find("setvalue").length,0),n.A.addQuestion("SaveToCase","case",{case_id:"uuid()",user_id:"uuid()",useCreate:!0}).p.createProperty={case_type:{calculate:"type"},case_name:{calculate:"name"}},_.equal(l()(f("createXML")).find("setvalue").length,1),n.A.deleteQuestion("/data/case"),_.equal(l()(f("createXML")).find("setvalue").length,0)})),it("should only allow extension and child as relationship",(function(){n.A.loadXML("");var t=n.A.addQuestion("SaveToCase","mug");t.p.useIndex=!0,t.p.indexProperty={casename:{calculate:"/data/question1",case_type:"type",relationship:"notchildorextension"}},_.strictEqual(t.spec.indexProperty.validationFunc(t),"Relationship must be child or extension")})),it("should only not error on empty extension ref",(function(){n.A.loadXML("");var t=n.A.addQuestion("SaveToCase","mug");t.p.useIndex=!0,t.p.indexProperty={casename:{calculate:"/data/question1",case_type:"type",relationship:"child"},"":{calculate:"",case_type:"",relationship:""}},_.strictEqual(t.spec.indexProperty.validationFunc(t),"pass")})),it("should provide case references to the logic manager",(function(){var t=n.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/080C5E4A-0EA8-4AFD-92F1-75B79B5FC627" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<save_to_case_create vellum:case_type="mother" vellum:role="SaveToCase">\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<create>\n\t\t\t\t\t\t\t\t<case_name />\n\t\t\t\t\t\t\t\t<case_type />\n\t\t\t\t\t\t\t</create>\n\t\t\t\t\t\t\t<update>\n\t\t\t\t\t\t\t\t<p1 />\n\t\t\t\t\t\t\t\t<p2 />\n\t\t\t\t\t\t\t</update>\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</save_to_case_create>\n\t\t\t\t\t<save_to_case_close vellum:case_type="close_case" vellum:role="SaveToCase">\n\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t<close />\n\t\t\t\t\t\t</case>\n\t\t\t\t\t</save_to_case_close>\n\t\t\t\t\t<group>\n\t\t\t\t\t\t<save_to_case_in_group vellum:case_type="child" vellum:role="SaveToCase">\n\t\t\t\t\t\t\t<case xmlns="http://commcarehq.org/case/transaction/v2" case_id="" date_modified="" user_id="">\n\t\t\t\t\t\t\t\t<update>\n\t\t\t\t\t\t\t\t\t<p1 />\n\t\t\t\t\t\t\t\t\t<p3 />\n\t\t\t\t\t\t\t\t</update>\n\t\t\t\t\t\t\t</case>\n\t\t\t\t\t\t</save_to_case_in_group>\n\t\t\t\t\t</group>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind nodeset="/data/save_to_case_create/case/create/case_name" calculate="\'name\'" />\n\t\t\t<bind nodeset="/data/save_to_case_create/case/create/case_type" calculate="\'mother\'" />\n\t\t\t<bind nodeset="/data/save_to_case_create/case/update/p1" calculate="\'property 1\'" />\n\t\t\t<bind nodeset="/data/save_to_case_create/case/update/p2" calculate="\'property 2\'" />\n\t\t\t<bind nodeset="/data/save_to_case_create/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/save_to_case_create/case/@user_id" calculate="\'user_id\'" />\n\t\t\t<bind nodeset="/data/save_to_case_close/case/close" />\n\t\t\t<bind nodeset="/data/save_to_case_close/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/save_to_case_close/case/@user_id" calculate="\'user_id\'" />\n\t\t\t<bind nodeset="/data/save_to_case_close/case/@case_id" calculate="\'case_id_close\'" />\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<bind nodeset="/data/group/save_to_case_in_group/case/update/p1" calculate="\'property 1\'" />\n\t\t\t<bind nodeset="/data/group/save_to_case_in_group/case/update/p3" calculate="\'property 3\'" />\n\t\t\t<bind nodeset="/data/group/save_to_case_in_group/case/@date_modified" calculate="/data/meta/timeEnd" type="xsd:dateTime" />\n\t\t\t<bind nodeset="/data/group/save_to_case_in_group/case/@user_id" calculate="\'user_id\'" />\n\t\t\t<bind nodeset="/data/group/save_to_case_in_group/case/@case_id" calculate="\'case_id_in_group\'" />\n\t\t\t<setvalue event="xforms-ready" ref="/data/save_to_case_create/case/@case_id" value="\'case_id_normal\'" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="" />\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group vellum:ref="#form/group" ref="/data/group" />\n\t</h:body>\n</h:html>\n')._logicManager;_.deepEqual(t.caseReferences(),{load:{},save:{"/data/group/save_to_case_in_group":{case_type:"child",close:!1,create:!1,properties:["p1","p3"]},"/data/save_to_case_create":{case_type:"mother",close:!1,create:!0,properties:["case_name","case_type","p1","p2"]},"/data/save_to_case_close":{case_type:"close_case",close:!0,create:!1,properties:[]}}})}))}))},1134:(t,e,a)=>{a.d(e,{A:()=>T});var n=a(8449),s=a(8324),o=a.n(s),r=a(6848),l=a.n(r),d=a(3794),c=a(4523),i=a(561),m=a.n(i),u=a(1437),p=a.n(u),h=a(3809),v=a.n(h),_=a(705),f=a.n(_),x=a(7229),g=a.n(x),y=(a(1460),a(8803),o().assert),w=["Form Builder clip","version 1"];function b(t,e,a){if((a=c.Ay.defaults(a||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var n=g().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+n+'"')}var s,o,r,d,i=(s=t,o=e,r=l().xml(s),d=l().xml(o),l().isEquivalent(r,d,{element_order:!0}));a.not&&(i=!i),i||q(t=A(t),e=A(e),"XML "+(a.not?"should not be equivalent":"mismatch"))}function q(t,e,a){if(t!==e){var n=(0,d.createPatch)("",t,e,"actual","expected");n=n.replace(/^Index:/,a||"Not equal:"),y(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(n))}}function A(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function j(t){return M("getCurrentMugInput",t)}function E(t){var e=m()("#vellum").vellum("get"),a=c.Ay.isString(t)?m()("[name="+t+"]"):t;return f().util.getWidget(a,e)}function M(){var t=Array.prototype.slice.call(arguments),e=m()("#vellum");return e.vellum.apply(e,t)}function D(){var t=[],e=c.Ay.map(arguments,(function(e){var a=c.Ay.isString(e)?X(e):e;if(!a||!a.ufid)throw new Error("mug not found: "+e);return t.push(a),a.ufid}));return M("jstree","deselect_all",!0),M("jstree","select_node",e),m()(".collapse-toggle.collapsed").click(),t}function X(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=M("getMugByPath",t);if(!e){var a=t.split("/"),n=M("getMugByPath",a.slice(0,-1).join("/"));if(n&&n.__className.indexOf("Select")>-1){var s=M("getData").core.form.getChildren(n),o=a[a.length-1];if(1===s.length&&"itemset"===o&&"itemset"===s[0].options.tagName)return s[0];for(var r=0;r<s.length;r++)if(s[r].p.nodeID===o)return s[r]}}return e}y.equal=y.strictEqual,y.notEqual=y.notStrictEqual;const T={options:n.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=m().extend(!0,{},n.A.options,t),a=m().fn.animate;m().fn.animate=function(t,e,n,s){a.apply(this,[t,0,n,s])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=c.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&c.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var s=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,s(t)};var o=m()("#vellum"),r=o.vellum("get");r&&(r.destroy(),m()("body > div.modal, body > div.modal-backdrop").remove()),o.empty().vellum(e)},call:M,loadXML:function(t,e,a,n,s=!0){var o=[],r=M("getData");return n||window.history.replaceState(null,null," "),r.core.parseWarnings=[],M("loadXML",t,e||{},{reset:s}),a?c.Ay.isRegExp(a)&&(o=c.Ay.filter(r.core.parseWarnings,(function(t){return!a.test(t)}))):o=r.core.parseWarnings,y(!o.length,"unexpected parse warnings:\n- "+o.join("\n- ")),delete r.core.parseWarnings,r.core.form},saveAndReload:function(t){M("loadXFormOrError",M("createXML"),t)},getMug:X,getInput:j,getWidget:E,getMediaUploader:function(t){var e,a={},n=E(t);if(!n)throw new Error("media uploader widget not found");if(c.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(a){return(e=t.closest(a)).length})),!e)throw new Error("media uploader element not found");return a.upload=function(t){var a={ref:{path:n.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",a)},a},assertEqual:q,assertInputCount:function(t,e,a){c.Ay.isString(t)?(a=" for "+(a?a+" ":"")+t,t=j(t)):a=a?" for "+a:"",y.equal(t.length,e,"wrong number of inputs"+a)},assertXmlEqual:b,assertXmlNotEqual:function(t,e,a){(a=a||{}).not=!0,b(t,e,a)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";q(function t(e,a){var n,s,o,r=[];for("#"===e.id?a=-1:r.push(Array(2*a+1).join(" ")+e.text),n=0,s=e.children.length;n<s;n++)o=M("jstree","get_node",e.children[n]),r.push(t(o,a+1));return r.join("\n")}(M("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";q(function t(e,a){var n,s,o,r=[];for(e.isRootNode?a=-1:r.push(Array(2*a+1).join(" ")+e.value.p.nodeID),n=0,s=e.children.length;n<s;n++)o=e.children[n],r.push(t(o,a+1));return r.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,a){a=c.Ay.extend({},a),this.prevId&&D(this.prevId);var n=M("addQuestion",t);return e||n.p.nodeID||(e=M("nodeIDFromLabel",n)),e&&(y(c.Ay.isUndefined(a.nodeID),"unexpected attribute for "+t+"["+e+"]"),n.p.labelItext&&n.p.labelItext.set(n.getLabelValue()),n.p.nodeID=e,"Choice"!==t||a.hasOwnProperty("labelItext")||(a.labelItext=e)),c.Ay.each(a,(function(t,e){c.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?n.p[e].set(t):n.p[e]=t})),c.Ay.each(M("getSections",n),(function(t){M("collapseSection",t.slug,!1)})),n},paste:function(t,e,a){c.Ay.isString(t)||(t=v().tabDelimit([w].concat(t))),a&&window.console.log(t),y.deepEqual(p().paste(t),e||[])},clickQuestion:D,selectAll:function(){M("jstree","select_all")},deleteQuestion:function(){var t=c.Ay.map(arguments,(function(t){var e=X(t);return y(e,"mug not found: "+t),e}));M("getData").core.form.removeMugsFromForm(t),c.Ay.each(arguments,(function(t){y(!X(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=M("getData").core.saveButton;if(!c.Ay.isUndefined(t)){var a=t?"save":"saved";e.setStateWhenReady(a),y.equal(e.state,a,"sanity check failed")}return"save"===e.state},expandGroup:function(t){M("jstree","open_node",t.ufid),M("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){M("jstree","close_node",t.ufid),M("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],a=null;if(c.Ay.isString(t)){var n=t;t=X(n),y(t,"mug not found: "+n)}return t.messages.each((function(t,n){n!==a&&(e.push(n+":"),a=n),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,a){if(c.Ay.isString(e)){var n=e;e=function(t){return t.text===n}}return function a(n){var s,o,r;if(e(n))return n;for(s=0,o=n.children.length;s<o;s++)if(r=a(t.get_node(n.children[s])))return r;return null}(a||t.get_node("#"))},isTreeNodeValid:function(t){if(c.Ay.isString(t)){var e=t;t=X(e),y(t,"mug not found: "+e)}return 0===m()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return m()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:g().parseXML}}}]);