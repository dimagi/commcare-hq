(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[964],{9848:(e,t,n)=>{var i=n(561),a={init:function(e){var t={disabled:!1,csrftoken:e.csrftoken,$save:i("<span/>").text(a.message.SAVE).click((function(e){t.fire("save",e)})).addClass("btn btn-info"),$retry:i("<span/>").text(a.message.RETRY).click((function(e){t.fire("save",e)})).addClass("btn btn-info"),$saving:i("<span/>").text(a.message.SAVING).prepend('<i class="fa fa-refresh icon-spin"></i> ').addClass("btn btn-info disabled"),$saved:i("<span/>").text(a.message.SAVED).addClass("btn btn-info disabled"),ui:i("<div/>").addClass("pull-right"),setStateWhenReady:function(e){"saving"===this.state?this.nextState=e:this.setState(e)},setState:function(e){this.state!==e&&(this.state=e,this.$save.detach(),this.$saving.detach(),this.$saved.detach(),this.$retry.detach(),"save"===e?this.ui.append(this.$save):"saving"===e?this.ui.append(this.$saving):"saved"===e?this.ui.append(this.$saved):"retry"===e&&this.ui.append(this.$retry),this.fire("state:change"))},ajaxOptions:function(e){var t=(e=e||{}).beforeSend||function(){},n=e.success||function(){},i=e.error||function(){},r=this;return e.beforeSend=function(e){r.csrftoken&&!this.crossDomain&&e.setRequestHeader("X-CSRFToken",r.csrftoken),r.setState("saving"),r.nextState="saved",t.apply(this,arguments)},e.success=function(e){r.setState(r.nextState),n.apply(this,arguments)},e.error=function(e){r.nextState=null,r.setState("retry"),alert(a.message.ERROR_SAVING),i.apply(this,arguments)},e},ajax:function(e){if("function"==typeof(e=t.ajaxOptions(e)).url){e.beforeSend();var n=e.url(e.data);e.success(n||{})}else i.ajax(e)},beforeunload:function(){var n="html"==t.ui.parents()[t.ui.parents().length-1].tagName.toLowerCase();if("saved"!==t.state&&n)return e.unsavedMessage||""}};return r(t),t.setState("saved"),t.on("change",(function(){this.setStateWhenReady("save")})),t.on("disable",(function(){this.disabled=!0,this.$save.addClass("disabled"),this.$saving.addClass("disabled"),this.$retry.addClass("disabled")})),t.on("enable",(function(){this.disabled=!1,this.$save.removeClass("disabled"),this.$saving.removeClass("disabled"),this.$retry.removeClass("disabled")})),t.on("save",(function(n){if(!t.disabled)if(e.save)e.save(n);else if(e.saveRequest){var i=t.ajaxOptions();i.beforeSend(),e.saveRequest(n).success(i.success).error(i.error)}})),t},initForm:function(e,t){var n=e.attr("action"),i=a.init({unsavedMessage:t.unsavedMessage,save:function(){i.ajax({url:n,type:"POST",dataType:"json",data:e.serialize(),success:t.success})}}),r=function(){i.fire("change")};return e.find("*").change(r),e.find("input, textarea").bind("textchange",r),i},message:{SAVE:"Save",SAVING:"Saving",SAVED:"Saved",RETRY:"Try Again",ERROR_SAVING:"There was an error saving"}},r=function(e){"use strict";var t={};return e.on=function(n,i){return void 0===t[n]&&(t[n]=[]),t[n].push(i),e},e.fire=function(n,i){var a;if(void 0!==t[n])for(a=0;a<t[n].length;a+=1)t[n][a].apply(e,[i]);return e},e};t.init=a.init},5022:(e,t,n)=>{!function(e){if(void 0===e)throw Error("jQuery should be loaded before CKEditor jQuery adapter.");if("undefined"==typeof CKEDITOR)throw Error("CKEditor should be loaded before CKEditor jQuery adapter.");CKEDITOR.config.jqueryOverrideVal=void 0===CKEDITOR.config.jqueryOverrideVal||CKEDITOR.config.jqueryOverrideVal,e.extend(e.fn,{ckeditorGet:function(){var e=this.eq(0).data("ckeditorInstance");if(!e)throw"CKEditor is not initialized yet, use ckeditor() with a callback.";return e},ckeditor:function(t,n){if(!CKEDITOR.env.isCompatible)throw Error("The environment is incompatible.");if("function"!=typeof t){var i=n;n=t,t=i}var a=[];n=n||{},this.each((function(){var i=e(this),r=i.data("ckeditorInstance"),o=i.data("_ckeditorInstanceLock"),s=this,l=new e.Deferred;a.push(l.promise()),r&&!o?(t&&t.apply(r,[this]),l.resolve()):o?r.once("instanceReady",(function(){setTimeout((function e(){r.element?(r.element.$==s&&t&&t.apply(r,[s]),l.resolve()):setTimeout(e,100)}),0)}),null,null,9999):((n.autoUpdateElement||void 0===n.autoUpdateElement&&CKEDITOR.config.autoUpdateElement)&&(n.autoUpdateElementJquery=!0),n.autoUpdateElement=!1,i.data("_ckeditorInstanceLock",!0),r=e(this).is("textarea")?CKEDITOR.replace(s,n):CKEDITOR.inline(s,n),i.data("ckeditorInstance",r),r.on("instanceReady",(function(n){var a=n.editor;setTimeout((function r(){if(a.element){if(n.removeListener(),a.on("dataReady",(function(){i.trigger("dataReady.ckeditor",[a])})),a.on("setData",(function(e){i.trigger("setData.ckeditor",[a,e.data])})),a.on("getData",(function(e){i.trigger("getData.ckeditor",[a,e.data])}),999),a.on("destroy",(function(){i.trigger("destroy.ckeditor",[a])})),a.on("save",(function(){return e(s.form).trigger("submit"),!1}),null,null,20),a.config.autoUpdateElementJquery&&i.is("textarea")&&e(s.form).length){var o=function(){i.ckeditor((function(){a.updateElement()}))};e(s.form).on("submit",o),e(s.form).on("form-pre-serialize",o),i.on("destroy.ckeditor",(function(){e(s.form).off("submit",o),e(s.form).off("form-pre-serialize",o)}))}a.on("destroy",(function(){i.removeData("ckeditorInstance")})),i.removeData("_ckeditorInstanceLock"),i.trigger("instanceReady.ckeditor",[a]),t&&t.apply(a,[s]),l.resolve()}else setTimeout(r,100)}),0)}),null,null,9999))}));var r=new e.Deferred;return this.promise=r.promise(),e.when.apply(this,a).then((function(){r.resolve()})),this.editor=this.eq(0).data("ckeditorInstance"),this}}),CKEDITOR.config.jqueryOverrideVal&&(e.fn.val=CKEDITOR.tools.override(e.fn.val,(function(t){return function(n){if(arguments.length){var i=this,a=[],r=this.each((function(){var i=e(this),r=i.data("ckeditorInstance");if(i.is("textarea")&&r){var o=new e.Deferred;return r.setData(n,(function(){o.resolve()})),a.push(o.promise()),!0}return t.call(i,n)}));if(a.length){var o=new e.Deferred;return e.when.apply(this,a).done((function(){o.resolveWith(i)})),o.promise()}return r}var s=(r=e(this).eq(0)).data("ckeditorInstance");return r.is("textarea")&&s?s.getData():t.call(r)}})))}(n(561))},5311:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(1601),a=n.n(i),r=n(6314),o=n.n(r)()(a());o.push([e.id,'.clearfix {\n  *zoom: 1;\n}\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: "";\n  line-height: 0;\n}\n.clearfix:after {\n  clear: both;\n}\n.hide-text {\n  font: 0/0 a;\n  color: transparent;\n  text-shadow: none;\n  background-color: transparent;\n  border: 0;\n}\n.input-block-level {\n  display: block;\n  width: 100%;\n  min-height: 30px;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n}\n.atwho-view ul {\n  overflow: hidden;\n}\n.atwho-jrtext {\n  padding-left: 1em;\n  color: gray;\n}\n.cur > .atwho-jrtext {\n  padding-left: 1em;\n  color: white;\n}\n.dropdown-menu a > i {\n  display: inline-block;\n  width: 16px;\n}\n.checklist i.fa-check {\n  display: none;\n  width: auto;\n}\n.checklist .selected i.fa-check {\n  display: inline-block;\n  margin-left: -14px;\n  margin-right: 2px;\n}\n.dropdown-submenu {\n  position: relative;\n}\n.dropdown-submenu > a:after {\n  display: block;\n  content: " ";\n  float: right;\n  width: 0;\n  height: 0;\n  border-color: transparent transparent transparent #ccc;\n  border-style: solid;\n  border-width: 5px 0 5px 5px;\n  margin-top: 5px;\n  margin-right: -10px;\n}\n.dropdown-submenu > .dropdown-menu {\n  top: 0;\n  left: 100%;\n  margin-top: -6px;\n  margin-left: -1px;\n  border-radius: 0 6px 6px 6px;\n}\n.dropdown-submenu:hover > .dropdown-menu {\n  display: block;\n}\n.dropdown-submenu:hover > a:after {\n  border-left-color: #fff;\n}\n.fd-input {\n  -moz-appearance: textfield;\n  -webkit-appearance: textfield;\n  border: 1px solid #cccccc;\n  border-radius: 4px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -webkit-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -moz-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -o-transition: border linear 0.2s, box-shadow linear 0.2s;\n  transition: border linear 0.2s, box-shadow linear 0.2s;\n  height: 28px;\n  padding: 6px 12px;\n  font-size: 12px;\n  background: #ffffff;\n  vertical-align: middle;\n  color: #555555;\n  white-space: nowrap;\n  overflow: hidden;\n}\n.fd-input:focus {\n  border-color: rgba(82, 168, 236, 0.8);\n  outline: 0;\n  outline: thin dotted \\9;\n  /* IE6-9 */\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n}\n.fd-input p {\n  margin: 0;\n  /* CKEditor line spacing */\n}\n.fd-textarea {\n  -moz-appearance: textfield;\n  -webkit-appearance: textfield;\n  border: 1px solid #cccccc;\n  border-radius: 4px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -webkit-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -moz-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -o-transition: border linear 0.2s, box-shadow linear 0.2s;\n  transition: border linear 0.2s, box-shadow linear 0.2s;\n  height: 28px;\n  padding: 6px 12px;\n  font-size: 12px;\n  background: #ffffff;\n  vertical-align: middle;\n  color: #555555;\n  white-space: nowrap;\n  overflow: hidden;\n  -moz-appearance: textfield-multiline;\n  min-height: 4em;\n  height: 4.5em;\n  overflow: auto;\n  resize: both;\n  white-space: normal;\n  word-break: break-word;\n}\n.fd-textarea:focus {\n  border-color: rgba(82, 168, 236, 0.8);\n  outline: 0;\n  outline: thin dotted \\9;\n  /* IE6-9 */\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n}\n.fd-textarea p {\n  margin: 0;\n  /* CKEditor line spacing */\n}\n.fd-textarea.fd-xpath-editor-text {\n  height: 13em;\n  font-family: monospace;\n}\n.fd-search {\n  background-color: #f2f2f1;\n  margin-bottom: 5px;\n}\n.fd-search > .form-inline {\n  position: relative;\n  padding: 0px 12px;\n}\n.fd-search > .form-inline i {\n  line-height: 42px;\n}\n.fd-search .control-label {\n  padding-top: 0px;\n}\n.fd-search .fd-search-control {\n  position: absolute;\n  top: 5px;\n  margin-left: 18px;\n  width: 100%;\n}\n.fd-commander {\n  background-color: #f2f2f1;\n  padding: 5px;\n  display: flex;\n  align-items: center;\n}\n.fd-commander input {\n  border: 1px solid #d6d6d4;\n  height: 19px;\n  width: calc(100% - 15px);\n}\n.fd-commander .fd-commander-close {\n  background: none;\n  border: none;\n  color: #373534;\n  position: absolute;\n  right: 8px;\n  cursor: pointer;\n}\n.jstree-drop-active {\n  border: 2px solid #004ebc !important;\n  background: rgba(188, 222, 255, 0.3);\n  box-shadow: 0 0 8px 2px rgba(0, 78, 188, 0.4);\n  transition: box-shadow 0.2s, border 0.2s, background 0.2s;\n}\n.label-datanode {\n  text-shadow: none;\n  line-height: 16px;\n  padding: 0 2px;\n  margin: 0px 2px;\n  margin-bottom: 2px;\n  font-size: 12px;\n  border: 1px solid;\n  vertical-align: middle;\n  font-weight: 400;\n}\n.label-datanode:hover {\n  cursor: pointer;\n  color: #ffffff;\n}\n.label-datanode .close {\n  color: #00799a;\n  opacity: 0.4;\n  font-weight: 500;\n  line-height: 13px;\n  font-size: 18px;\n  padding: 0 5px;\n  padding-bottom: 3px;\n  margin-right: -3px;\n}\n.label-datanode .close:hover {\n  opacity: 0.9;\n}\n.label-datanode .fcc {\n  padding: 0 3px;\n  font-size: 0.8em;\n}\n.label-datanode-internal {\n  color: #00799a;\n  border-color: #88d0d2;\n  background-color: #d2edee;\n}\n.label-datanode-internal .close {\n  color: #00799a;\n}\n.label-datanode-internal:hover {\n  background-color: #1ea2a7;\n  border-color: #1a8d92;\n}\n.label-datanode-internal:hover .close {\n  color: #d2edee;\n}\n.label-datanode-external {\n  color: #373534;\n  border-color: #c1c1bc;\n  background-color: #e6e6e4;\n}\n.label-datanode-external .close {\n  color: #373534;\n}\n.label-datanode-external:hover {\n  background-color: #685c53;\n}\n.label-datanode-external:hover .close {\n  color: #d6d6d4;\n}\n.label-datanode-external-unknown {\n  color: #685300;\n  border-color: #eed161;\n  background-color: #f6e5a6;\n}\n.label-datanode-external-unknown .close {\n  color: #685300;\n}\n.label-datanode-external-unknown:hover {\n  background-color: #f9c700;\n}\n.label-datanode-external-unknown:hover .close {\n  color: #f8ecbd;\n}\n.label-datanode-unknown {\n  color: #812627;\n  border-color: #c6948e;\n  background-color: #e8d4d2;\n}\n.label-datanode-unknown .close {\n  color: #812627;\n}\n.label-datanode-unknown:hover {\n  background-color: #e53e30;\n}\n.label-datanode-unknown:hover .close {\n  color: #efcfcb;\n}\n.datanode-tree-bubble {\n  font-size: 11px;\n  color: #ffffff;\n  line-height: 18px;\n  display: inline-block;\n  padding: 0px 5px;\n  border-radius: 3px;\n}\n.datanode-tree-bubble .fcc {\n  font-size: 9px;\n}\n.datanode-tree-bubble-internal {\n  color: #00799a;\n  background-color: #ccf3f4;\n}\n.datanode-tree-bubble-external {\n  color: #373534;\n  background-color: #f2f2f1;\n}\n.datanode-tree-bubble-internal.on {\n  background-color: #00bdc5;\n  color: #ffffff;\n}\n.datanode-tree-bubble-external.on {\n  background-color: #685c53;\n  color: #ffffff;\n}\n.cke_widget_wrapper:hover > .label-datanode {\n  outline: none !important;\n  -webkit-box-shadow: 0px 0px 8px #004ebc;\n  -moz-box-shadow: 0px 0px 8px #004ebc;\n  box-shadow: 0px 0px 8px #004ebc;\n}\n.cke_widget_focused .label-datanode {\n  outline: none !important;\n  -webkit-box-shadow: 0px 0px 8px #002c5f;\n  -moz-box-shadow: 0px 0px 8px #002c5f;\n  box-shadow: 0px 0px 8px #002c5f;\n  border-color: #0073f8;\n}\n.cke_widget_drag_handler_container {\n  top: -2px !important;\n  background: transparent !important;\n}\n.cke_widget_drag_handler {\n  width: 100% !important;\n  height: 100% !important;\n}\n.itext-block-container.has-markdown .markdown-group {\n  display: block !important;\n}\n.itext-block-container.has-markdown .turn-markdown-off,\n.itext-block-container.has-markdown .markdown-output:not(:empty),\n.itext-block-container.has-markdown .fd-help {\n  display: inline-block !important;\n}\n.itext-block-container.has-markdown .turn-markdown-on {\n  display: none !important;\n}\n.itext-block-container:not(.has-markdown) .markdown-group,\n.itext-block-container:not(.has-markdown) .turn-markdown-off,\n.itext-block-container:not(.has-markdown) .markdown-output {\n  display: none !important;\n}\n.itext-block-container:not(.has-markdown) .turn-markdown-on,\n.itext-block-container:not(.has-markdown) .fd-help {\n  display: inline-block !important;\n}\n.itext-block-container.markdown-ignorant .turn-markdown-off,\n.itext-block-container.markdown-ignorant .turn-markdown-on,\n.itext-block-container.markdown-ignorant .markdown-output,\n.itext-block-container.markdown-ignorant .fd-help {\n  display: none !important;\n}\n.markdown-output {\n  width: 100%;\n  margin: 0;\n}\n.markdown-output table {\n  padding: 0;\n}\n.markdown-output table tr {\n  border-top: 1px solid #cccccc;\n  background-color: white;\n  margin: 0;\n  padding: 0;\n}\n.markdown-output table tr th {\n  font-weight: bold;\n  border: 1px solid #cccccc;\n  text-align: left;\n  margin: 0;\n  padding: 6px 13px;\n}\n.markdown-output table tr th:first-child {\n  margin-top: 0;\n}\n.markdown-output table tr th:last-child {\n  margin-bottom: 0;\n}\n.markdown-output table tr td {\n  border: 1px solid #cccccc;\n  text-align: left;\n  margin: 0;\n  padding: 6px 13px;\n}\n.markdown-output table tr td:first-child {\n  margin-top: 0;\n}\n.markdown-output table tr td:last-child {\n  margin-bottom: 0;\n}\n.markdown-output table tr:nth-child(2n) {\n  background-color: #f8f8f8;\n}\n.fd-valid-alert-icon {\n  color: #d83a2e;\n}\n.fd-form-saving {\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  opacity: 0.8;\n  background-color: #000;\n  z-index: 2000;\n}\n.fd-form-saving > div {\n  opacity: 1;\n  position: fixed;\n  top: calc(50% -  32px / 2);\n  left: calc(50% -  32px / 2);\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  width: 32px;\n  height: 32px;\n  -webkit-border-radius: 4px;\n  -moz-border-radius: 4px;\n  border-radius: 4px;\n  background-color: #fff;\n  font-size: 22px;\n  text-align: center;\n}\n.fd-full-screen-modal .modal-dialog {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  margin: 0;\n  width: auto;\n}\n.fd-full-screen-modal .modal-dialog .modal-content {\n  position: absolute;\n  top: 20px;\n  bottom: 20px;\n  left: 20px;\n  right: 20px;\n}\n.fd-full-screen-modal .modal-dialog .modal-content .modal-body {\n  overflow-y: auto;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container {\n  text-align: center;\n  width: 115px;\n  float: left;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container img,\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref {\n  border: 1px solid #eee;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container img {\n  padding: 0.5em;\n  background-color: #fff;\n  margin-bottom: 10px;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref {\n  color: #999;\n  background-color: #fff;\n  padding: 10px;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref i {\n  display: block;\n  font-size: 56px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container {\n  margin-left: 125px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container > .control-row {\n  margin: 0px 0px 10px 0;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container > .control-row:first-child {\n  height: 25px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container .fd-mm-path-input {\n  margin-right: 92px;\n}\n.rich-text-popover {\n  -webkit-border-radius: 3px;\n  -moz-border-radius: 3px;\n  border-radius: 3px;\n  word-wrap: break-word;\n  min-width: 236px;\n  max-width: 276px;\n}\n.rich-text-popover .popover-title h3 {\n  font-weight: 600;\n  font-size: 14px;\n  margin: 0;\n}\n.rich-text-popover .popover-title .text-muted {\n  margin-top: 5px;\n  line-height: 1.3em;\n}\n.rich-text-popover.top,\n.rich-text-popover.right,\n.rich-text-popover.bottom,\n.rich-text-popover.left {\n  margin: 0;\n}\n.rich-text-popover.bottom {\n  margin-top: 5px;\n}\n.rich-text-popover.top {\n  margin-bottom: -10px;\n}\n.rich-text-popover.right {\n  margin-left: 5px;\n}\n.rich-text-popover .arrow,\n.rich-text-popover .arrow:after {\n  display: none;\n}\n.popover-content .alert {\n  margin-bottom: 0;\n}\n.formdesigner .fd-ui-container .fd-props-toolbar {\n  margin-bottom: 5px;\n  border-bottom: 1px solid #F4F4F4;\n  padding: 12px;\n}\n.formdesigner .fd-ui-container .fd-props-toolbar .fd-question-comment {\n  margin-top: 10px;\n  white-space: pre-line;\n}\n.formdesigner .fd-ui-container .fd-props-content {\n  padding: 0 12px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-help {\n  width: 25px;\n  font-size: 21px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-help a:hover {\n  text-decoration: none;\n  color: #46a546;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-copy-paste-help .row {\n  padding: 0 2em;\n  margin-bottom: 2em;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-copy-paste-help .copy-paste-box textarea {\n  width: 100%;\n  height: 100px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset {\n  position: relative;\n  min-width: 0px;\n  /* for chrome */\n  display: table-column;\n  /* for firefox */\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset:first-child {\n  margin-top: 20px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset:first-child legend {\n  display: none;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset legend {\n  min-height: 30px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset legend .fd-help {\n  right: 0;\n  top: 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .control-label .fd-help {\n  position: relative;\n  top: -8px;\n  height: 15px;\n  display: inline-block;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .control-label label {\n  vertical-align: top;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .messages .alert {\n  margin: 10px 0 0 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .itext-block-container .btn-danger {\n  margin: 10px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-itextID-checkbox-container {\n  width: 55px;\n  padding: 0 5px;\n  background-color: #f1f9f1;\n  -webkit-border-radius: 5px;\n  -moz-border-radius: 5px;\n  border-radius: 5px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv {\n  margin-bottom: 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv .fd-kv-arrow {\n  text-align: center;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv .fd-kv-arrow i {\n  margin-top: 8px;\n}\nbody.vellum-full-screen {\n  overflow-y: hidden;\n}\n.formdesigner .fd-ui-container {\n  top: 0;\n  width: 100%;\n  background-color: white;\n}\n.formdesigner .fd-ui-container.full-screen {\n  z-index: 1031;\n}\n.formdesigner .fd-ui-container .fd-content {\n  float: left;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left {\n  width: 30%;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left .fd-add-question {\n  max-width: 140px;\n  width: 90%;\n  margin: 10px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left .fd-accessory-pane {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-head {\n  height: 31px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-head h2 {\n  line-height: 30px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .well {\n  padding: 10px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .well .col-sm-1 {\n  padding: 0;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-form-actions {\n  background-color: #004ebc !important;\n  padding: 5px 8px 8px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-default-panel {\n  padding-left: 12px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head {\n  color: #fff;\n  background-color: #002c5f;\n  font-size: 17px;\n  height: 25px;\n  position: relative;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-max-indicator {\n  position: absolute;\n  right: 10px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-max-indicator i {\n  color: #d6d6d4;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head:hover .fd-head-max-indicator i {\n  color: #fff;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head > h2 {\n  font-size: 12.6px;\n  padding: 1px 12px 0;\n  margin: 0;\n  font-weight: normal;\n  line-height: 23px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  position: absolute;\n  left: 0;\n  right: 38px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container {\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  line-height: 23px;\n  font-size: 12.6px;\n  min-width: 50px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-toggle {\n  color: #fff;\n  cursor: pointer;\n  display: block;\n  padding: 0 12px;\n  text-decoration: none;\n  background-color: #002c5f;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-toggle:hover {\n  text-decoration: none;\n  background-color: #004ebc;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-menu a {\n  min-width: 170px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-menu a > .hotkey {\n  float: right;\n}\n.formdesigner .fd-ui-container .fd-content-vertical-divider {\n  width: 5px;\n  background: #004ebc;\n}\n.formdesigner .fd-ui-container .fd-content-horizontal-divider {\n  height: 10px;\n  margin: 1px 0;\n  background: #F4F4F4;\n  text-align: center;\n  font-size: 16px;\n  color: #777;\n  position: relative;\n}\n.formdesigner .fd-ui-container .fd-content-horizontal-divider i {\n  display: inline-block;\n  position: absolute;\n}\n.formdesigner .fd-ui-container .fd-messages {\n  position: fixed;\n  bottom: 40px;\n  left: 0;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-messages .alert {\n  -webkit-box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  -moz-box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  margin: 20px;\n  height: auto;\n  overflow: auto;\n  max-height: 200px;\n}\n.formdesigner .fd-ui-container .fd-scrollable,\n.formdesigner .fd-ui-container .fd-scrollable-minimal {\n  overflow-x: hidden;\n  overflow-y: auto;\n  transform: translate3d(0, 0, 0);\n}\n.formdesigner .fd-ui-container .fd-scrollable {\n  height: 606px;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-scrollable-minimal {\n  max-height: 606px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor {\n  color: #37475d;\n  line-height: 27px;\n  height: 26px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-hovered,\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-clicked {\n  border: none;\n  background: #eaeff5;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-clicked {\n  -webkit-box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n  -moz-box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n  box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor > .jstree-icon,\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:before {\n  background: none;\n  font-size: 0.85em;\n  color: #004ebc;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice {\n  display: block;\n  margin-left: 50px;\n  cursor: pointer;\n  padding: 0 5px;\n  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n  line-height: 24px;\n  height: 24px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:before {\n  margin-right: 6px;\n  font: normal normal normal 14px/1 FontAwesome;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:hover {\n  border: none;\n  background-color: #eaeff5;\n  width: 95px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node.jstree-closed .add_choice {\n  display: none;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .fd-valid-alert-icon {\n  margin-right: 3px;\n  margin-left: -3px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head {\n  height: 46px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head h2 {\n  line-height: 46px;\n  font-size: 14px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head .fd-head-menu-container {\n  line-height: 46px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-scrollable {\n  overflow-x: auto;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-scrollable .jstree {\n  margin: 5px 0;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-undo-delete {\n  margin-bottom: 0px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-head.fd-head-external-sources {\n  cursor: pointer;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-head.fd-head-external-sources h2 {\n  font-size: 12px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search {\n  background-color: #f2f2f1;\n  margin-bottom: 5px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search > form {\n  position: relative;\n  padding: 0px 12px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search > form i {\n  line-height: 42px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search .fd-search-control {\n  position: absolute;\n  top: 5px;\n  margin-left: 18px;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor {\n  color: #373534;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor.jstree-clicked {\n  background-color: #f2f2f1;\n  -webkit-box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n  -moz-box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n  box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor > .jstree-icon {\n  color: #685c53;\n}\n.formdesigner .fd-ui-container .fd-undo-delete p {\n  margin-top: 1em;\n}\n#jstree-dnd {\n  max-width: 300px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n',""]);const s=o},612:e=>{var t,n,i;window.CKEDITOR&&window.CKEDITOR.dom||(window.CKEDITOR||(window.CKEDITOR=function(){var e=/(^|.*[\\\/])ckeditor\.js(?:\?.*|;.*)?$/i,t={timestamp:"N2U9",version:"4.21.0 DEV",revision:"5d9709a2f5",rnd:Math.floor(900*Math.random())+100,_:{pending:[],basePathSrcPattern:e},status:"unloaded",basePath:function(){var t=window.CKEDITOR_BASEPATH||"";if(!t)for(var n=document.getElementsByTagName("script"),i=0;i<n.length;i++){var a=n[i].src.match(e);if(a){t=a[1];break}}if(-1==t.indexOf(":/")&&"//"!=t.slice(0,2)&&(t=0===t.indexOf("/")?location.href.match(/^.*?:\/\/[^\/]*/)[0]+t:location.href.match(/^[^\?]*\/(?:)/)[0]+t),!t)throw'The CKEditor installation path could not be automatically detected. Please set the global variable "CKEDITOR_BASEPATH" before creating editor instances.';return t}(),getUrl:function(e){return-1==e.indexOf(":/")&&0!==e.indexOf("/")&&(e=this.basePath+e),this.appendTimestamp(e)},appendTimestamp:function(e){if(!this.timestamp||"/"===e.charAt(e.length-1)||/[&?]t=/.test(e))return e;var t=0<=e.indexOf("?")?"&":"?";return e+t+"t="+this.timestamp},domReady:function(){function e(){try{document.addEventListener?(document.removeEventListener("DOMContentLoaded",e,!1),window.removeEventListener("load",e,!1),t()):document.attachEvent&&"complete"===document.readyState&&(document.detachEvent("onreadystatechange",e),window.detachEvent("onload",e),t())}catch(e){}}function t(){for(var e;e=n.shift();)e()}var n=[];return function(t){if(n.push(t),"complete"===document.readyState&&setTimeout(e,1),1==n.length)if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1);else if(document.attachEvent){document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e),t=!1;try{t=!window.frameElement}catch(e){}document.documentElement.doScroll&&t&&function t(){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(t,1)}e()}()}}}()},n=window.CKEDITOR_GETURL;if(n){var i=t.getUrl;t.getUrl=function(e){return n.call(t,e)||i.call(t,e)}}return t}()),i={},CKEDITOR.event||(CKEDITOR.event=function(){},CKEDITOR.event.implementOn=function(e){var t,n=CKEDITOR.event.prototype;for(t in n)null==e[t]&&(e[t]=n[t])},CKEDITOR.event.prototype=function(){function e(e){var i=t(this);return i[e]||(i[e]=new n(e))}var t=function(e){return(e=e.getPrivate&&e.getPrivate()||e._||(e._={})).events||(e.events={})},n=function(e){this.name=e,this.listeners=[]};return n.prototype={getListenerIndex:function(e){for(var t=0,n=this.listeners;t<n.length;t++)if(n[t].fn==e)return t;return-1}},{define:function(t,n){var i=e.call(this,t);CKEDITOR.tools.extend(i,n,!0)},on:function(t,n,a,r,o){function s(e,o,s,d){return e={name:t,sender:this,editor:e,data:o,listenerData:r,stop:s,cancel:d,removeListener:l},!1===n.call(a,e)?i:e.data}function l(){d.removeListener(t,n)}var d=this,c=e.call(this,t);if(0>c.getListenerIndex(n)){c=c.listeners,a||(a=this),isNaN(o)&&(o=10),s.fn=n,s.priority=o;for(var u=c.length-1;0<=u;u--)if(c[u].priority<=o)return c.splice(u+1,0,s),{removeListener:l};c.unshift(s)}return{removeListener:l}},once:function(){var e=Array.prototype.slice.call(arguments),t=e[1];return e[1]=function(e){return e.removeListener(),t.apply(this,arguments)},this.on.apply(this,e)},capture:function(){CKEDITOR.event.useCapture=1;var e=this.on.apply(this,arguments);return CKEDITOR.event.useCapture=0,e},fire:function(){var e=0,n=function(){e=1},a=0,r=function(){a=1};return function(o,s,l){var d=t(this)[o];o=e;var c=a;if(e=a=0,d&&(f=d.listeners).length)for(var u,f=f.slice(0),h=0;h<f.length;h++){if(d.errorProof)try{u=f[h].call(this,l,s,n,r)}catch(e){}else u=f[h].call(this,l,s,n,r);if(u===i?a=1:void 0!==u&&(s=u),e||a)break}return s=!a&&(void 0===s||s),e=o,a=c,s}}(),fireOnce:function(e,n,i){return n=this.fire(e,n,i),delete t(this)[e],n},removeListener:function(e,n){var i=t(this)[e];if(i){var a=i.getListenerIndex(n);0<=a&&i.listeners.splice(a,1)}},removeAllListeners:function(){var e,n=t(this);for(e in n)delete n[e]},hasListeners:function(e){return(e=t(this)[e])&&0<e.listeners.length}}}()),CKEDITOR.editor||(CKEDITOR.editor=function(){CKEDITOR._.pending.push([this,arguments]),CKEDITOR.event.call(this)},CKEDITOR.editor.prototype.fire=function(e,t){return e in{instanceReady:1,loaded:1}&&(this[e]=!0),CKEDITOR.event.prototype.fire.call(this,e,t,this)},CKEDITOR.editor.prototype.fireOnce=function(e,t){return e in{instanceReady:1,loaded:1}&&(this[e]=!0),CKEDITOR.event.prototype.fireOnce.call(this,e,t,this)},CKEDITOR.event.implementOn(CKEDITOR.editor.prototype)),CKEDITOR.env||(CKEDITOR.env=function(){var e=navigator.userAgent.toLowerCase(),t=e.match(/edge[ \/](\d+.?\d*)/),n=-1<e.indexOf("trident/");(n={ie:n=!(!t&&!n),edge:!!t,webkit:!n&&-1<e.indexOf(" applewebkit/"),air:-1<e.indexOf(" adobeair/"),mac:-1<e.indexOf("macintosh"),quirks:"BackCompat"==document.compatMode&&(!document.documentMode||10>document.documentMode),mobile:-1<e.indexOf("mobile"),iOS:/(ipad|iphone|ipod)/.test(e),isCustomDomain:function(){if(!this.ie)return!1;var e=document.domain,t=window.location.hostname;return e!=t&&e!="["+t+"]"},secure:"https:"==location.protocol}).gecko="Gecko"==navigator.product&&!n.webkit&&!n.ie,n.webkit&&(-1<e.indexOf("chrome")?n.chrome=!0:n.safari=!0);var i=0;return n.ie&&(i=t?parseFloat(t[1]):n.quirks||!document.documentMode?parseFloat(e.match(/msie (\d+)/)[1]):document.documentMode,n.ie9Compat=9==i,n.ie8Compat=8==i,n.ie7Compat=7==i,n.ie6Compat=7>i||n.quirks),n.gecko&&(t=e.match(/rv:([\d\.]+)/))&&(i=1e4*(t=t[1].split("."))[0]+100*(t[1]||0)+1*(t[2]||0)),n.air&&(i=parseFloat(e.match(/ adobeair\/(\d+)/)[1])),n.webkit&&(i=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),n.version=i,n.isCompatible=!(n.ie&&7>i||n.gecko&&4e4>i||n.webkit&&534>i),n.hidpi=2<=window.devicePixelRatio,n.needsBrFiller=n.gecko||n.webkit||n.ie&&10<i,n.needsNbspFiller=n.ie&&11>i,n.cssClass="cke_browser_"+(n.ie?"ie":n.gecko?"gecko":n.webkit?"webkit":"unknown"),n.quirks&&(n.cssClass+=" cke_browser_quirks"),n.ie&&(n.cssClass+=" cke_browser_ie"+(n.quirks?"6 cke_browser_iequirks":n.version)),n.air&&(n.cssClass+=" cke_browser_air"),n.iOS&&(n.cssClass+=" cke_browser_ios"),n.hidpi&&(n.cssClass+=" cke_hidpi"),n}()),"unloaded"==CKEDITOR.status&&(CKEDITOR.event.implementOn(CKEDITOR),CKEDITOR.loadFullCore=function(){if("basic_ready"!=CKEDITOR.status)CKEDITOR.loadFullCore._load=1;else{delete CKEDITOR.loadFullCore;var e=document.createElement("script");e.type="text/javascript",e.src=CKEDITOR.basePath+"ckeditor.js",document.getElementsByTagName("head")[0].appendChild(e)}},CKEDITOR.loadFullCoreTimeout=0,CKEDITOR.add=function(e){(this._.pending||(this._.pending=[])).push(e)},CKEDITOR.domReady((function(){var e=CKEDITOR.loadFullCore,t=CKEDITOR.loadFullCoreTimeout;e&&(CKEDITOR.status="basic_ready",e&&e._load?e():t&&setTimeout((function(){CKEDITOR.loadFullCore&&CKEDITOR.loadFullCore()}),1e3*t))})),CKEDITOR.status="basic_loaded"),CKEDITOR.VERBOSITY_WARN=1,CKEDITOR.VERBOSITY_ERROR=2,CKEDITOR.verbosity=CKEDITOR.VERBOSITY_WARN|CKEDITOR.VERBOSITY_ERROR,CKEDITOR.warn=function(e,t){CKEDITOR.verbosity&CKEDITOR.VERBOSITY_WARN&&CKEDITOR.fire("log",{type:"warn",errorCode:e,additionalData:t})},CKEDITOR.error=function(e,t){CKEDITOR.verbosity&CKEDITOR.VERBOSITY_ERROR&&CKEDITOR.fire("log",{type:"error",errorCode:e,additionalData:t})},CKEDITOR.on("log",(function(e){if(window.console&&window.console.log){var t=console[e.data.type]?e.data.type:"log",n=e.data.errorCode;(e=e.data.additionalData)?console[t]("[CKEDITOR] Error code: "+n+".",e):console[t]("[CKEDITOR] Error code: "+n+"."),console[t]("[CKEDITOR] For more information about this error go to https://ckeditor.com/docs/ckeditor4/latest/guide/dev_errors.html#"+n)}}),null,null,999),CKEDITOR.dom={},function(){function e(e,t,n){this._minInterval=e,this._context=n,this._lastOutput=this._scheduledTimer=0,this._output=CKEDITOR.tools.bind(t,n||{});var i=this;this.input=function(){function e(){i._lastOutput=(new Date).getTime(),i._scheduledTimer=0,i._call()}if(!i._scheduledTimer||!1!==i._reschedule()){var t=(new Date).getTime()-i._lastOutput;t<i._minInterval?i._scheduledTimer=setTimeout(e,i._minInterval-t):e()}}}function t(t,n,i){e.call(this,t,n,i),this._args=[];var a=this;this.input=CKEDITOR.tools.override(this.input,(function(e){return function(){a._args=Array.prototype.slice.call(arguments),e.call(this)}}))}var n=[],i=CKEDITOR.env.gecko?"-moz-":CKEDITOR.env.webkit?"-webkit-":CKEDITOR.env.ie?"-ms-":"",a=/&/g,r=/>/g,o=/</g,s=/"/g,l=/&(lt|gt|amp|quot|nbsp|shy|#\d{1,5});/g,d={lt:"<",gt:">",amp:"&",quot:'"',nbsp:" ",shy:"­"},c=function(e,t){return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1),10)):d[t]};CKEDITOR.on("reset",(function(){n=[]})),CKEDITOR.tools={arrayCompare:function(e,t){if(!e&&!t)return!0;if(!e||!t||e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0},getIndex:function(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1},clone:function(e){var t;if(e&&e instanceof Array){t=[];for(var n=0;n<e.length;n++)t[n]=CKEDITOR.tools.clone(e[n]);return t}if(null===e||"object"!=typeof e||e instanceof String||e instanceof Number||e instanceof Boolean||e instanceof Date||e instanceof RegExp||e.nodeType||e.window===e)return e;for(n in t=new e.constructor,e)t[n]=CKEDITOR.tools.clone(e[n]);return t},capitalize:function(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())},extend:function(e){var t,n,i=arguments.length;"boolean"==typeof(t=arguments[i-1])?i--:"boolean"==typeof(t=arguments[i-2])&&(n=arguments[i-1],i-=2);for(var a=1;a<i;a++){var r=arguments[a]||{};CKEDITOR.tools.array.forEach(CKEDITOR.tools.object.keys(r),(function(i){!0!==t&&null!=e[i]||n&&!(i in n)||(e[i]=r[i])}))}return e},prototypedCopy:function(e){var t=function(){};return t.prototype=e,new t},copy:function(e){var t,n={};for(t in e)n[t]=e[t];return n},isArray:function(e){return"[object Array]"==Object.prototype.toString.call(e)},isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},cssVendorPrefix:function(e,t,n){return n?i+e+":"+t+";"+e+":"+t:((n={})[e]=t,n[i+e]=t,n)},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t=void 0!==e.cssFloat?"cssFloat":void 0!==e.styleFloat?"styleFloat":"float";return function(e){return"float"==e?t:e.replace(/-./g,(function(e){return e.substr(1).toUpperCase()}))}}(),buildStyleHtml:function(e){e=[].concat(e);for(var t,n=[],i=0;i<e.length;i++)(t=e[i])&&(/@import|[{}]/.test(t)?n.push("<style>"+t+"</style>"):(t=CKEDITOR.appendTimestamp(t),n.push('<link type="text/css" rel=stylesheet href="'+t+'">')));return n.join("")},htmlEncode:function(e){return null==e?"":String(e).replace(a,"&amp;").replace(r,"&gt;").replace(o,"&lt;")},htmlDecode:function(e){return e.replace(l,c)},htmlEncodeAttr:function(e){return CKEDITOR.tools.htmlEncode(e).replace(s,"&quot;")},htmlDecodeAttr:function(e){return CKEDITOR.tools.htmlDecode(e)},transformPlainTextToHtml:function(e,t){var n=t==CKEDITOR.ENTER_BR,i=(i=this.htmlEncode(e.replace(/\r\n/g,"\n"))).replace(/\t/g,"&nbsp;&nbsp; &nbsp;"),a=t==CKEDITOR.ENTER_P?"p":"div";if(!n){var r=/\n{2}/g;if(r.test(i)){var o="<"+a+">",s="</"+a+">";i=o+i.replace(r,(function(){return s+o}))+s}}return i=i.replace(/\n/g,"<br>"),n||(i=i.replace(new RegExp("<br>(?=</"+a+">)"),(function(e){return CKEDITOR.tools.repeat(e,2)}))),(i=i.replace(/^ | $/g,"&nbsp;")).replace(/(>|\s) /g,(function(e,t){return t+"&nbsp;"})).replace(/ (?=<)/g,"&nbsp;")},getNextNumber:function(){var e=0;return function(){return++e}}(),getNextId:function(){return"cke_"+this.getNextNumber()},getUniqueId:function(){for(var e="e",t=0;8>t;t++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e},override:function(e,t){var n=t(e);return n.prototype=e.prototype,n},setTimeout:function(e,t,n,i,a){return a||(a=window),n||(n=a),a.setTimeout((function(){i?e.apply(n,[].concat(i)):e.apply(n)}),t||0)},debounce:function(e,t){var n;return function(){var i=this,a=arguments;clearTimeout(n),n=setTimeout((function(){n=null,e.apply(i,a)}),t)}},throttle:function(e,t,n){return new this.buffers.throttle(e,t,n)},trim:function(){var e=/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g;return function(t){return t.replace(e,"")}}(),ltrim:function(){var e=/^[ \t\n\r]+/g;return function(t){return t.replace(e,"")}}(),rtrim:function(){var e=/[ \t\n\r]+$/g;return function(t){return t.replace(e,"")}}(),indexOf:function(e,t){if("function"==typeof t){for(var n=0,i=e.length;n<i;n++)if(t(e[n]))return n}else{if(e.indexOf)return e.indexOf(t);for(n=0,i=e.length;n<i;n++)if(e[n]===t)return n}return-1},search:function(e,t){var n=CKEDITOR.tools.indexOf(e,t);return 0<=n?e[n]:null},bind:function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,n.concat(Array.prototype.slice.call(arguments)))}},createClass:function(e){var t=e.$,n=e.base,i=e.privates||e._,a=e.proto;if(e=e.statics,!t&&(t=function(){n&&this.base.apply(this,arguments)}),i){var r=t;t=function(){var e,t=this._||(this._={});for(e in i){var n=i[e];t[e]="function"==typeof n?CKEDITOR.tools.bind(n,this):n}r.apply(this,arguments)}}return n&&(t.prototype=this.prototypedCopy(n.prototype),t.prototype.constructor=t,t.base=n,t.baseProto=n.prototype,t.prototype.base=function e(){this.base=n.prototype.base,n.apply(this,arguments),this.base=e}),a&&this.extend(t.prototype,a,!0),e&&this.extend(t,e,!0),t},addFunction:function(e,t){return n.push((function(){return e.apply(t||this,arguments)}))-1},removeFunction:function(e){n[e]=null},callFunction:function(e){var t=n[e];return t&&t.apply(window,Array.prototype.slice.call(arguments,1))},cssLength:function(){var e,t=/^-?\d+\.?\d*px$/;return function(n){return e=CKEDITOR.tools.trim(n+"")+"px",t.test(e)?e:n||""}}(),convertToPx:function(){var e,t;return function(n){if(e&&!e.isDetached()||(e=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;margin:0px;padding:0px;border:0px;"></div>',CKEDITOR.document),CKEDITOR.document.getBody().append(e)),!/%$/.test(n)){var i=0>parseFloat(n);return i&&(n=n.replace("-","")),e.setStyle("width",n),t=e.getClientRect(),n=Math.round(t.width),i?-n:n}return n}}(),repeat:function(e,t){return Array(t+1).join(e)},tryThese:function(){for(var e,t=0,n=arguments.length;t<n;t++){var i=arguments[t];try{e=i();break}catch(e){}}return e},genKey:function(){return Array.prototype.slice.call(arguments).join("-")},defer:function(e){return function(){var t=arguments,n=this;window.setTimeout((function(){e.apply(n,t)}),0)}},normalizeCssText:function(e,t){var n,i=[],a=CKEDITOR.tools.parseCssText(e,!0,t);for(n in a)i.push(n+":"+a[n]);return i.sort(),i.length?i.join(";")+";":""},convertRgbToHex:function(e){return e.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,(function(e,t,n,i){for(e=[t,n,i],t=0;3>t;t++)e[t]=("0"+parseInt(e[t],10).toString(16)).slice(-2);return"#"+e.join("")}))},normalizeHex:function(e){return e.replace(/#(([0-9a-f]{3}){1,2})($|;|\s+)/gi,(function(e,t,n,i){return 3==(e=t.toLowerCase()).length&&(e=[(e=e.split(""))[0],e[0],e[1],e[1],e[2],e[2]].join("")),"#"+e+i}))},_isValidColorFormat:function(e){return!!e&&(e=e.replace(/\s+/g,""),/^[a-z0-9()#%,./]+$/i.test(e))},parseCssText:function(e,t,n){var i={};return n&&(e=new CKEDITOR.dom.element("span").setAttribute("style",e).getAttribute("style")||""),e&&(e=CKEDITOR.tools.normalizeHex(CKEDITOR.tools.convertRgbToHex(e))),e&&";"!=e?(e.replace(/&quot;/g,'"').replace(/\s*([^:;\s]+)\s*:\s*([^;]+)\s*(?=;|$)/g,(function(e,n,a){t&&("font-family"==(n=n.toLowerCase())&&(a=a.replace(/\s*,\s*/g,",")),a=CKEDITOR.tools.trim(a)),i[n]=a})),i):i},writeCssText:function(e,t){var n,i=[];for(n in e)i.push(n+":"+e[n]);return t&&i.sort(),i.join("; ")},objectCompare:function(e,t,n){var i;if(!e&&!t)return!0;if(!e||!t)return!1;for(i in e)if(e[i]!=t[i])return!1;if(!n)for(i in t)if(e[i]!=t[i])return!1;return!0},objectKeys:function(e){return CKEDITOR.tools.object.keys(e)},convertArrayToObject:function(e,t){var n={};1==arguments.length&&(t=!0);for(var i=0,a=e.length;i<a;++i)n[e[i]]=t;return n},getStyledSpans:function(e,t){var n=CKEDITOR.env.ie&&8==CKEDITOR.env.version?e.toUpperCase():e;return n=t.find("span[style*="+n+"]").toArray(),CKEDITOR.tools.array.filter(n,(function(t){return!!t.getStyle(e)}))},fixDomain:function(){for(var e;;)try{e=window.parent.document.domain;break}catch(t){if(!(e=e?e.replace(/.+?(?:\.|$)/,""):document.domain))break;document.domain=e}return!!e},eventsBuffer:function(e,t,n){return new this.buffers.event(e,t,n)},enableHtml5Elements:function(e,t){for(var n,i="abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup main mark meter nav output progress section summary time video".split(" "),a=i.length;a--;)n=e.createElement(i[a]),t&&e.appendChild(n)},checkIfAnyArrayItemMatches:function(e,t){for(var n=0,i=e.length;n<i;++n)if(e[n].match(t))return!0;return!1},checkIfAnyObjectPropertyMatches:function(e,t){for(var n in e)if(n.match(t))return!0;return!1},keystrokeToString:function(e,t){var n=this.keystrokeToArray(e,t);return n.display=n.display.join("+"),n.aria=n.aria.join("+"),n},keystrokeToArray:function(e,t){var n=16711680&t,i=65535&t,a=CKEDITOR.env.mac,r=[],o=[];return n&CKEDITOR.CTRL&&(r.push(a?"⌘":e[17]),o.push(a?e[224]:e[17])),n&CKEDITOR.ALT&&(r.push(a?"⌥":e[18]),o.push(e[18])),n&CKEDITOR.SHIFT&&(r.push(a?"⇧":e[16]),o.push(e[16])),i&&(e[i]?(r.push(e[i]),o.push(e[i])):(r.push(String.fromCharCode(i)),o.push(String.fromCharCode(i)))),{display:r,aria:o}},transparentImageData:"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==",getCookie:function(e){e=e.toLowerCase();for(var t,n=document.cookie.split(";"),i=0;i<n.length;i++)if(t=n[i].split("="),decodeURIComponent(CKEDITOR.tools.trim(t[0]).toLowerCase())===e)return decodeURIComponent(1<t.length?t[1]:"");return null},setCookie:function(e,t){document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+";path=/"},getCsrfToken:function(){if(!(e=CKEDITOR.tools.getCookie("ckCsrfToken"))||40!=e.length){var e=[],t="";if(window.crypto&&window.crypto.getRandomValues)e=new Uint8Array(40),window.crypto.getRandomValues(e);else for(var n=0;40>n;n++)e.push(Math.floor(256*Math.random()));for(n=0;n<e.length;n++){var i="abcdefghijklmnopqrstuvwxyz0123456789".charAt(e[n]%36);t+=.5<Math.random()?i.toUpperCase():i}e=t,CKEDITOR.tools.setCookie("ckCsrfToken",e)}return e},escapeCss:function(e){if(e)if(window.CSS&&CSS.escape)e=CSS.escape(e);else{for(var t,n=(e=String(e)).length,i=-1,a="",r=e.charCodeAt(0);++i<n;)a=0==(t=e.charCodeAt(i))?a+"�":127==t||1<=t&&31>=t||0==i&&48<=t&&57>=t||1==i&&48<=t&&57>=t&&45==r?a+"\\"+t.toString(16)+" ":0==i&&1==n&&45==t?a+"\\"+e.charAt(i):128<=t||45==t||95==t||48<=t&&57>=t||65<=t&&90>=t||97<=t&&122>=t?a+e.charAt(i):a+"\\"+e.charAt(i);e=a}else e="";return e},getMouseButton:function(e){return!!(e=e&&e.data?e.data.$:e)&&CKEDITOR.tools.normalizeMouseButton(e.button)},normalizeMouseButton:function(e,t){if(!CKEDITOR.env.ie||9<=CKEDITOR.env.version&&!CKEDITOR.env.ie6Compat)return e;for(var n=[[CKEDITOR.MOUSE_BUTTON_LEFT,1],[CKEDITOR.MOUSE_BUTTON_MIDDLE,4],[CKEDITOR.MOUSE_BUTTON_RIGHT,2]],i=0;i<n.length;i++){var a=n[i];if(a[0]===e&&t)return a[1];if(!t&&a[1]===e)return a[0]}},convertHexStringToBytes:function(e){var t,n=[],i=e.length/2;for(t=0;t<i;t++)n.push(parseInt(e.substr(2*t,2),16));return n},convertBytesToBase64:function(e){var t,n="",i=e.length;for(t=0;t<i;t+=3){var a,r=e.slice(t,t+3),o=r.length,s=[];if(3>o)for(a=o;3>a;a++)r[a]=0;for(s[0]=(252&r[0])>>2,s[1]=(3&r[0])<<4|r[1]>>4,s[2]=(15&r[1])<<2|(192&r[2])>>6,s[3]=63&r[2],a=0;4>a;a++)n=a<=o?n+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(s[a]):n+"="}return n},style:{parse:{_borderStyle:"none hidden dotted dashed solid double groove ridge inset outset".split(" "),_widthRegExp:/^(thin|medium|thick|[\+-]?\d+(\.\d+)?[a-z%]+|[\+-]?0+(\.0+)?|\.\d+[a-z%]+)$/,_rgbaRegExp:/rgba?\(\s*\d+%?\s*,\s*\d+%?\s*,\s*\d+%?\s*(?:,\s*[0-9.]+\s*)?\)/gi,_hslaRegExp:/hsla?\(\s*[0-9.]+\s*,\s*\d+%\s*,\s*\d+%\s*(?:,\s*[0-9.]+\s*)?\)/gi,background:function(e){var t={},n=this._findColor(e);return n.length&&(t.color=n[0],CKEDITOR.tools.array.forEach(n,(function(t){e=e.replace(t,"")}))),(e=CKEDITOR.tools.trim(e))&&(t.unprocessed=e),t},margin:function(e){return CKEDITOR.tools.style.parse.sideShorthand(e,(function(e){return e.match(/(?:\-?[\.\d]+(?:%|\w*)|auto|inherit|initial|unset|revert)/g)||["0px"]}))},sideShorthand:function(e,t){function n(e){i.top=a[e[0]],i.right=a[e[1]],i.bottom=a[e[2]],i.left=a[e[3]]}var i={},a=t?t(e):e.split(/\s+/);switch(a.length){case 1:n([0,0,0,0]);break;case 2:n([0,1,0,1]);break;case 3:n([0,1,2,1]);break;case 4:n([0,1,2,3])}return i},border:function(e){return CKEDITOR.tools.style.border.fromCssRule(e)},_findColor:function(e){var t=[],n=CKEDITOR.tools.array;return(t=(t=t.concat(e.match(this._rgbaRegExp)||[])).concat(e.match(this._hslaRegExp)||[])).concat(n.filter(e.split(/\s+/),(function(e){return!!e.match(/^\#[a-f0-9]{3}(?:[a-f0-9]{3})?$/gi)||e.toLowerCase()in CKEDITOR.tools.style.parse._colors})))}}},array:{filter:function(e,t,n){var i=[];return this.forEach(e,(function(a,r){t.call(n,a,r,e)&&i.push(a)})),i},find:function(e,t,n){for(var i=e.length,a=0;a<i;){if(t.call(n,e[a],a,e))return e[a];a++}},forEach:function(e,t,n){var i,a=e.length;for(i=0;i<a;i++)t.call(n,e[i],i,e)},map:function(e,t,n){for(var i=[],a=0;a<e.length;a++)i.push(t.call(n,e[a],a,e));return i},reduce:function(e,t,n,i){for(var a=0;a<e.length;a++)n=t.call(i,n,e[a],a,e);return n},every:function(e,t,n){return!e.length||(t=this.filter(e,t,n),e.length===t.length)},some:function(e,t,n){for(var i=0;i<e.length;i++)if(t.call(n,e[i],i,e))return!0;return!1},zip:function(e,t){return CKEDITOR.tools.array.map(e,(function(e,n){return[e,t[n]]}))},unique:function(e){return this.filter(e,(function(t,n){return n===CKEDITOR.tools.array.indexOf(e,t)}))}},object:{DONT_ENUMS:"toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),entries:function(e){return CKEDITOR.tools.array.map(CKEDITOR.tools.object.keys(e),(function(t){return[t,e[t]]}))},values:function(e){return CKEDITOR.tools.array.map(CKEDITOR.tools.object.keys(e),(function(t){return e[t]}))},keys:function(e){var t=Object.prototype.hasOwnProperty,n=[],i=CKEDITOR.tools.object.DONT_ENUMS;if(CKEDITOR.env.ie&&9>CKEDITOR.env.version&&(!e||"object"!=typeof e)){if(t=[],"string"==typeof e)for(n=0;n<e.length;n++)t.push(String(n));return t}for(var a in e)n.push(a);if(CKEDITOR.env.ie&&9>CKEDITOR.env.version)for(a=0;a<i.length;a++)t.call(e,i[a])&&n.push(i[a]);return n},findKey:function(e,t){if("object"!=typeof e)return null;for(var n in e)if(e[n]===t)return n;return null},merge:function(e,t){var n=CKEDITOR.tools,i=n.clone(e),a=n.clone(t);return n.array.forEach(n.object.keys(a),(function(e){i[e]="object"==typeof a[e]&&"object"==typeof i[e]?n.object.merge(i[e],a[e]):a[e]})),i}},getAbsoluteRectPosition:function(e,t){var n=CKEDITOR.tools.copy(t);!function e(t){if(t){var i=t.getClientRect();n.top+=i.top,n.left+=i.left,"x"in n&&"y"in n&&(n.x+=i.x,n.y+=i.y),e(t.getWindow().getFrame())}}(e.getFrame());var i=CKEDITOR.document.getWindow().getScrollPosition();return n.top+=i.y,n.left+=i.x,"x"in n&&"y"in n&&(n.y+=i.y,n.x+=i.x),n.right=n.left+n.width,n.bottom=n.top+n.height,n}},e.prototype={reset:function(){this._lastOutput=0,this._clearTimer()},_reschedule:function(){return!1},_call:function(){this._output()},_clearTimer:function(){this._scheduledTimer&&clearTimeout(this._scheduledTimer),this._scheduledTimer=0}},t.prototype=CKEDITOR.tools.prototypedCopy(e.prototype),t.prototype._reschedule=function(){this._scheduledTimer&&this._clearTimer()},t.prototype._call=function(){this._output.apply(this._context,this._args)},CKEDITOR.tools.buffers={},CKEDITOR.tools.buffers.event=e,CKEDITOR.tools.buffers.throttle=t,CKEDITOR.tools.style.border=CKEDITOR.tools.createClass({$:function(e){e=e||{},this.width=e.width,this.style=e.style,this.color=e.color,this._.normalize()},_:{normalizeMap:{color:[[/windowtext/g,"black"]]},normalize:function(){for(var e in this._.normalizeMap){var t=this[e];t&&(this[e]=CKEDITOR.tools.array.reduce(this._.normalizeMap[e],(function(e,t){return e.replace(t[0],t[1])}),t))}}},proto:{toString:function(){return CKEDITOR.tools.array.filter([this.width,this.style,this.color],(function(e){return!!e})).join(" ")}},statics:{fromCssRule:function(e){var t={},n=e.split(/\s+/g);return(e=CKEDITOR.tools.style.parse._findColor(e)).length&&(t.color=e[0]),CKEDITOR.tools.array.forEach(n,(function(e){t.style||-1===CKEDITOR.tools.indexOf(CKEDITOR.tools.style.parse._borderStyle,e)?!t.width&&CKEDITOR.tools.style.parse._widthRegExp.test(e)&&(t.width=e):t.style=e})),new CKEDITOR.tools.style.border(t)},splitCssValues:function(e,t){t=t||{};var n=CKEDITOR.tools.array.reduce(["width","style","color"],(function(n,i){var a=e["border-"+i]||t[i];return n[i]=a?CKEDITOR.tools.style.parse.sideShorthand(a):null,n}),{});return CKEDITOR.tools.array.reduce(["top","right","bottom","left"],(function(t,i){var a,r={};for(a in n){var o=e["border-"+i+"-"+a];r[a]=o||n[a]&&n[a][i]}return t["border-"+i]=new CKEDITOR.tools.style.border(r),t}),{})}}}),CKEDITOR.tools.array.indexOf=CKEDITOR.tools.indexOf,CKEDITOR.tools.array.isArray=CKEDITOR.tools.isArray,CKEDITOR.MOUSE_BUTTON_LEFT=0,CKEDITOR.MOUSE_BUTTON_MIDDLE=1,CKEDITOR.MOUSE_BUTTON_RIGHT=2}(),CKEDITOR.dtd=function(){var e=CKEDITOR.tools.extend,t=function(e,t){for(var n=CKEDITOR.tools.clone(e),i=1;i<arguments.length;i++)for(var a in t=arguments[i])delete n[a];return n},n={},i={},a={address:1,article:1,aside:1,blockquote:1,details:1,div:1,dl:1,fieldset:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,menu:1,nav:1,ol:1,p:1,pre:1,section:1,table:1,ul:1},r={command:1,link:1,meta:1,noscript:1,script:1,style:1},o={},s={"#":1},l={center:1,dir:1,noframes:1};return e(n,{a:1,abbr:1,area:1,audio:1,b:1,bdi:1,bdo:1,br:1,button:1,canvas:1,cite:1,code:1,command:1,datalist:1,del:1,dfn:1,em:1,embed:1,i:1,iframe:1,img:1,input:1,ins:1,kbd:1,keygen:1,label:1,map:1,mark:1,meter:1,noscript:1,object:1,output:1,progress:1,q:1,ruby:1,s:1,samp:1,script:1,select:1,small:1,span:1,strong:1,sub:1,sup:1,textarea:1,time:1,u:1,var:1,video:1,wbr:1},s,{acronym:1,applet:1,basefont:1,big:1,font:1,isindex:1,strike:1,style:1,tt:1}),e(i,a,n,l),t={a:t(n,{a:1,button:1}),abbr:n,address:i,area:o,article:i,aside:i,audio:e({source:1,track:1},i),b:n,base:o,bdi:n,bdo:n,blockquote:i,body:i,br:o,button:t(n,{a:1,button:1}),canvas:n,caption:i,cite:n,code:n,col:o,colgroup:{col:1},command:o,datalist:e({option:1},n),dd:i,del:n,details:e({summary:1},i),dfn:n,div:i,dl:{dt:1,dd:1},dt:i,em:n,embed:o,fieldset:e({legend:1},i),figcaption:i,figure:e({figcaption:1},i),footer:i,form:i,h1:n,h2:n,h3:n,h4:n,h5:n,h6:n,head:e({title:1,base:1},r),header:i,hgroup:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},hr:o,html:e({head:1,body:1},i,r),i:n,iframe:s,img:o,input:o,ins:n,kbd:n,keygen:o,label:n,legend:n,li:i,link:o,main:i,map:i,mark:n,menu:e({li:1},i),meta:o,meter:t(n,{meter:1}),nav:i,noscript:e({link:1,meta:1,style:1},n),object:e({param:1},n),ol:{li:1},optgroup:{option:1},option:s,output:n,p:n,param:o,pre:n,progress:t(n,{progress:1}),q:n,rp:n,rt:n,ruby:e({rp:1,rt:1},n),s:n,samp:n,script:s,section:i,select:{optgroup:1,option:1},small:n,source:o,span:n,strong:n,style:s,sub:n,summary:e({h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},n),sup:n,table:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1},tbody:{tr:1},td:i,textarea:s,tfoot:{tr:1},th:i,thead:{tr:1},time:t(n,{time:1}),title:s,tr:{th:1,td:1},track:o,u:n,ul:{li:1},var:n,video:e({source:1,track:1},i),wbr:o,acronym:n,applet:e({param:1},i),basefont:o,big:n,center:i,dialog:o,dir:{li:1},font:n,isindex:o,noframes:i,strike:n,tt:n},e(t,{$block:e({audio:1,dd:1,dt:1,figcaption:1,li:1,video:1},a,l),$blockLimit:{article:1,aside:1,audio:1,body:1,caption:1,details:1,dir:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,header:1,hgroup:1,main:1,menu:1,nav:1,ol:1,section:1,table:1,td:1,th:1,tr:1,ul:1,video:1},$cdata:{script:1,style:1},$editable:{address:1,article:1,aside:1,blockquote:1,body:1,details:1,div:1,fieldset:1,figcaption:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,main:1,nav:1,p:1,pre:1,section:1},$empty:{area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1},$inline:n,$list:{dl:1,ol:1,ul:1},$listItem:{dd:1,dt:1,li:1},$nonBodyContent:e({body:1,head:1,html:1},t.head),$nonEditable:{applet:1,audio:1,button:1,embed:1,iframe:1,map:1,object:1,option:1,param:1,script:1,textarea:1,video:1},$object:{applet:1,audio:1,button:1,hr:1,iframe:1,img:1,input:1,object:1,select:1,table:1,textarea:1,video:1},$removeEmpty:{abbr:1,acronym:1,b:1,bdi:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,mark:1,meter:1,output:1,q:1,ruby:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,time:1,tt:1,u:1,var:1},$tabIndex:{a:1,area:1,button:1,input:1,object:1,select:1,textarea:1},$tableContent:{caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1},$transparent:{a:1,audio:1,canvas:1,del:1,ins:1,map:1,noscript:1,object:1,video:1},$intermediate:{caption:1,colgroup:1,dd:1,dt:1,figcaption:1,legend:1,li:1,optgroup:1,option:1,rp:1,rt:1,summary:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1}}),t}(),CKEDITOR.dom.event=function(e){this.$=e},CKEDITOR.dom.event.prototype={getKey:function(){return this.$.keyCode||this.$.which},getKeystroke:function(){var e=this.getKey();return(this.$.ctrlKey||this.$.metaKey)&&(e+=CKEDITOR.CTRL),this.$.shiftKey&&(e+=CKEDITOR.SHIFT),this.$.altKey&&(e+=CKEDITOR.ALT),e},preventDefault:function(e){var t=this.$;t.preventDefault?t.preventDefault():t.returnValue=!1,e&&this.stopPropagation()},stopPropagation:function(){var e=this.$;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},getTarget:function(){var e=this.$.target||this.$.srcElement;return e?new CKEDITOR.dom.node(e):null},getPhase:function(){return this.$.eventPhase||2},getPageOffset:function(){var e=this.getTarget().getDocument().$;return{x:this.$.pageX||this.$.clientX+(e.documentElement.scrollLeft||e.body.scrollLeft),y:this.$.pageY||this.$.clientY+(e.documentElement.scrollTop||e.body.scrollTop)}}},CKEDITOR.CTRL=1114112,CKEDITOR.SHIFT=2228224,CKEDITOR.ALT=4456448,CKEDITOR.EVENT_PHASE_CAPTURING=1,CKEDITOR.EVENT_PHASE_AT_TARGET=2,CKEDITOR.EVENT_PHASE_BUBBLING=3,CKEDITOR.HISTORY_NATIVE=1,CKEDITOR.HISTORY_HASH=2,CKEDITOR.HISTORY_OFF=0,CKEDITOR.dom.domObject=function(e){e&&(this.$=e)},CKEDITOR.dom.domObject.prototype={getPrivate:function(){var e;return(e=this.getCustomData("_"))||this.setCustomData("_",e={}),e},on:function(e){var t=this.getCustomData("_cke_nativeListeners");return t||(t={},this.setCustomData("_cke_nativeListeners",t)),t[e]||(t=t[e]=function(e,t){return function(n){"undefined"!=typeof CKEDITOR&&e.fire(t,new CKEDITOR.dom.event(n))}}(this,e),this.$.addEventListener?this.$.addEventListener(e,t,!!CKEDITOR.event.useCapture):this.$.attachEvent&&this.$.attachEvent("on"+e,t)),CKEDITOR.event.prototype.on.apply(this,arguments)},removeListener:function(e){if(CKEDITOR.event.prototype.removeListener.apply(this,arguments),!this.hasListeners(e)){var t=this.getCustomData("_cke_nativeListeners"),n=t&&t[e];n&&(this.$.removeEventListener?this.$.removeEventListener(e,n,!1):this.$.detachEvent&&this.$.detachEvent("on"+e,n),delete t[e])}},removeAllListeners:function(){try{var e,t=this.getCustomData("_cke_nativeListeners");for(e in t){var n=t[e];this.$.detachEvent?this.$.detachEvent("on"+e,n):this.$.removeEventListener&&this.$.removeEventListener(e,n,!1),delete t[e]}}catch(e){if(!CKEDITOR.env.edge||-2146828218!==e.number)throw e}CKEDITOR.event.prototype.removeAllListeners.call(this)}},function(e){var t={};CKEDITOR.on("reset",(function(){t={}})),e.equals=function(e){try{return e&&e.$===this.$}catch(e){return!1}},e.setCustomData=function(e,n){var i=this.getUniqueId();return(t[i]||(t[i]={}))[e]=n,this},e.getCustomData=function(e){var n=this.$["data-cke-expando"];return(n=n&&t[n])&&e in n?n[e]:null},e.removeCustomData=function(e){var n,i,a;return(n=(n=this.$["data-cke-expando"])&&t[n])&&(i=n[e],a=e in n,delete n[e]),a?i:null},e.clearCustomData=function(){this.removeAllListeners();var e=this.getUniqueId();e&&delete t[e]},e.getUniqueId=function(){return this.$["data-cke-expando"]||(this.$["data-cke-expando"]=CKEDITOR.tools.getNextNumber())},CKEDITOR.event.implementOn(e)}(CKEDITOR.dom.domObject.prototype),CKEDITOR.dom.node=function(e){return e?new CKEDITOR.dom[e.nodeType==CKEDITOR.NODE_DOCUMENT?"document":e.nodeType==CKEDITOR.NODE_ELEMENT?"element":e.nodeType==CKEDITOR.NODE_TEXT?"text":e.nodeType==CKEDITOR.NODE_COMMENT?"comment":e.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT?"documentFragment":"domObject"](e):this},CKEDITOR.dom.node.prototype=new CKEDITOR.dom.domObject,CKEDITOR.NODE_ELEMENT=1,CKEDITOR.NODE_DOCUMENT=9,CKEDITOR.NODE_TEXT=3,CKEDITOR.NODE_COMMENT=8,CKEDITOR.NODE_DOCUMENT_FRAGMENT=11,CKEDITOR.POSITION_IDENTICAL=0,CKEDITOR.POSITION_DISCONNECTED=1,CKEDITOR.POSITION_FOLLOWING=2,CKEDITOR.POSITION_PRECEDING=4,CKEDITOR.POSITION_IS_CONTAINED=8,CKEDITOR.POSITION_CONTAINS=16,CKEDITOR.tools.extend(CKEDITOR.dom.node.prototype,{appendTo:function(e,t){return e.append(this,t),e},clone:function(e,t){var n=this.$.cloneNode(e);return function n(i){if(i["data-cke-expando"]&&(i["data-cke-expando"]=!1),(i.nodeType==CKEDITOR.NODE_ELEMENT||i.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT)&&(t||i.nodeType!=CKEDITOR.NODE_ELEMENT||i.removeAttribute("id",!1),e)){i=i.childNodes;for(var a=0;a<i.length;a++)n(i[a])}}(n),n=new CKEDITOR.dom.node(n),CKEDITOR.env.ie&&9>CKEDITOR.env.version&&(this.type==CKEDITOR.NODE_ELEMENT||this.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)&&function t(n){if(n.type==CKEDITOR.NODE_ELEMENT||n.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT){if(n.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var i=n.getName();":"==i[0]&&n.renameNode(i.substring(1))}if(e)for(i=0;i<n.getChildCount();i++)t(n.getChild(i))}}(n),n},hasPrevious:function(){return!!this.$.previousSibling},hasNext:function(){return!!this.$.nextSibling},insertAfter:function(e){return e.$.parentNode.insertBefore(this.$,e.$.nextSibling),e},insertBefore:function(e){return e.$.parentNode.insertBefore(this.$,e.$),e},insertBeforeMe:function(e){return this.$.parentNode.insertBefore(e.$,this.$),e},getAddress:function(e){for(var t=[],n=this.getDocument().$.documentElement,i=this;i&&i!=n;){var a=i.getParent();a&&t.unshift(this.getIndex.call(i,e)),i=a}return t},getDocument:function(){return new CKEDITOR.dom.document(this.$.ownerDocument||this.$.parentNode.ownerDocument)},getIndex:function(e){function t(e,n){var i=n?e.getNext():e.getPrevious();return i&&i.type==CKEDITOR.NODE_TEXT?i.isEmpty()?t(i,n):i:null}var n,i=this,a=-1;if(!this.getParent()||e&&i.type==CKEDITOR.NODE_TEXT&&i.isEmpty()&&!t(i)&&!t(i,!0))return-1;do{e&&!i.equals(this)&&i.type==CKEDITOR.NODE_TEXT&&(n||i.isEmpty())||(a++,n=i.type==CKEDITOR.NODE_TEXT)}while(i=i.getPrevious());return a},getNextSourceNode:function(e,t,n){if(n&&!n.call){var i=n;n=function(e){return!e.equals(i)}}var a;if(!(e=!e&&this.getFirst&&this.getFirst())){if(this.type==CKEDITOR.NODE_ELEMENT&&n&&!1===n(this,!0))return null;e=this.getNext()}for(;!e&&(a=(a||this).getParent());){if(n&&!1===n(a,!0))return null;e=a.getNext()}return!e||n&&!1===n(e)?null:t&&t!=e.type?e.getNextSourceNode(!1,t,n):e},getPreviousSourceNode:function(e,t,n){if(n&&!n.call){var i=n;n=function(e){return!e.equals(i)}}var a;if(!(e=!e&&this.getLast&&this.getLast())){if(this.type==CKEDITOR.NODE_ELEMENT&&n&&!1===n(this,!0))return null;e=this.getPrevious()}for(;!e&&(a=(a||this).getParent());){if(n&&!1===n(a,!0))return null;e=a.getPrevious()}return!e||n&&!1===n(e)?null:t&&e.type!=t?e.getPreviousSourceNode(!1,t,n):e},getPrevious:function(e){var t,n=this.$;do{t=(n=n.previousSibling)&&10!=n.nodeType&&new CKEDITOR.dom.node(n)}while(t&&e&&!e(t));return t},getNext:function(e){var t,n=this.$;do{t=(n=n.nextSibling)&&new CKEDITOR.dom.node(n)}while(t&&e&&!e(t));return t},getParent:function(e){var t=this.$.parentNode;return t&&(t.nodeType==CKEDITOR.NODE_ELEMENT||e&&t.nodeType==CKEDITOR.NODE_DOCUMENT_FRAGMENT)?new CKEDITOR.dom.node(t):null},getParents:function(e){var t=this,n=[];do{n[e?"push":"unshift"](t)}while(t=t.getParent());return n},getCommonAncestor:function(e){if(e.equals(this))return this;if(e.contains&&e.contains(this))return e;var t=this.contains?this:this.getParent();do{if(t.contains(e))return t}while(t=t.getParent());return null},getPosition:function(e){var t=this.$,n=e.$;if(t.compareDocumentPosition)return t.compareDocumentPosition(n);if(t==n)return CKEDITOR.POSITION_IDENTICAL;if(this.type==CKEDITOR.NODE_ELEMENT&&e.type==CKEDITOR.NODE_ELEMENT){if(t.contains){if(t.contains(n))return CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING;if(n.contains(t))return CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING}if("sourceIndex"in t)return 0>t.sourceIndex||0>n.sourceIndex?CKEDITOR.POSITION_DISCONNECTED:t.sourceIndex<n.sourceIndex?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING}t=this.getAddress(),e=e.getAddress(),n=Math.min(t.length,e.length);for(var i=0;i<n;i++)if(t[i]!=e[i])return t[i]<e[i]?CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_FOLLOWING;return t.length<e.length?CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_PRECEDING:CKEDITOR.POSITION_IS_CONTAINED+CKEDITOR.POSITION_FOLLOWING},getAscendant:function(e,t){var n,i,a=this.$;for(t||(a=a.parentNode),"function"==typeof e?(i=!0,n=e):(i=!1,n=function(t){return t="string"==typeof t.nodeName?t.nodeName.toLowerCase():"","string"==typeof e?t==e:t in e});a;){if(n(i?new CKEDITOR.dom.node(a):a))return new CKEDITOR.dom.node(a);try{a=a.parentNode}catch(e){a=null}}return null},hasAscendant:function(e,t){var n=this.$;for(t||(n=n.parentNode);n;){if(n.nodeName&&n.nodeName.toLowerCase()==e)return!0;n=n.parentNode}return!1},move:function(e,t){e.append(this.remove(),t)},remove:function(e){var t=this.$,n=t.parentNode;if(n){if(e)for(;e=t.firstChild;)n.insertBefore(t.removeChild(e),t);n.removeChild(t)}return this},replace:function(e){this.insertBefore(e),e.remove()},trim:function(){this.ltrim(),this.rtrim()},ltrim:function(){for(var e;this.getFirst&&(e=this.getFirst());){if(e.type==CKEDITOR.NODE_TEXT){var t=CKEDITOR.tools.ltrim(e.getText()),n=e.getLength();if(!t){e.remove();continue}t.length<n&&(e.split(n-t.length),this.$.removeChild(this.$.firstChild))}break}},rtrim:function(){for(var e;this.getLast&&(e=this.getLast());){if(e.type==CKEDITOR.NODE_TEXT){var t=CKEDITOR.tools.rtrim(e.getText()),n=e.getLength();if(!t){e.remove();continue}t.length<n&&(e.split(t.length),this.$.lastChild.parentNode.removeChild(this.$.lastChild))}break}CKEDITOR.env.needsBrFiller&&(e=this.$.lastChild)&&1==e.type&&"br"==e.nodeName.toLowerCase()&&e.parentNode.removeChild(e)},isReadOnly:function(e){var t=this;if(this.type!=CKEDITOR.NODE_ELEMENT&&(t=this.getParent()),CKEDITOR.env.edge&&t&&t.is("textarea","input")&&(e=!0),!e&&t&&void 0!==t.$.isContentEditable)return!(t.$.isContentEditable||t.data("cke-editable"));for(;t;){if(t.data("cke-editable"))return!1;if(t.hasAttribute("contenteditable"))return"false"==t.getAttribute("contenteditable");t=t.getParent()}return!0}}),CKEDITOR.dom.window=function(e){CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.window.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.window.prototype,{focus:function(){this.$.focus()},getViewPaneSize:function(){var e=this.$.document,t="CSS1Compat"==e.compatMode;return{width:(t?e.documentElement.clientWidth:e.body.clientWidth)||0,height:(t?e.documentElement.clientHeight:e.body.clientHeight)||0}},getScrollPosition:function(){var e=this.$;return"pageXOffset"in e?{x:e.pageXOffset||0,y:e.pageYOffset||0}:{x:(e=e.document).documentElement.scrollLeft||e.body.scrollLeft||0,y:e.documentElement.scrollTop||e.body.scrollTop||0}},getFrame:function(){var e=this.$.frameElement;return e?new CKEDITOR.dom.element.get(e):null}}),CKEDITOR.dom.document=function(e){CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.document.prototype=new CKEDITOR.dom.domObject,CKEDITOR.tools.extend(CKEDITOR.dom.document.prototype,{type:CKEDITOR.NODE_DOCUMENT,appendStyleSheet:function(e){if(e=CKEDITOR.appendTimestamp(e),this.$.createStyleSheet)this.$.createStyleSheet(e);else{var t=new CKEDITOR.dom.element("link");t.setAttributes({rel:"stylesheet",type:"text/css",href:e}),this.getHead().append(t)}},appendStyleText:function(e){if(this.$.createStyleSheet){var t=this.$.createStyleSheet("");t.cssText=e}else{var n=new CKEDITOR.dom.element("style",this);n.append(new CKEDITOR.dom.text(e,this)),this.getHead().append(n)}return t||n.$.sheet},createElement:function(e,t){var n=new CKEDITOR.dom.element(e,this);return t&&(t.attributes&&n.setAttributes(t.attributes),t.styles&&n.setStyles(t.styles)),n},createText:function(e){return new CKEDITOR.dom.text(e,this)},focus:function(){this.getWindow().focus()},getActive:function(){var e;try{e=this.$.activeElement}catch(e){return null}return new CKEDITOR.dom.element(e)},getById:function(e){return(e=this.$.getElementById(e))?new CKEDITOR.dom.element(e):null},getByAddress:function(e,t){for(var n=this.$.documentElement,i=0;n&&i<e.length;i++){var a=e[i];if(t)for(var r=-1,o=0;o<n.childNodes.length;o++){var s=n.childNodes[o];if((!0!==t||3!=s.nodeType||!s.previousSibling||3!=s.previousSibling.nodeType)&&++r==a){n=s;break}}else n=n.childNodes[a]}return n?new CKEDITOR.dom.node(n):null},getElementsByTag:function(e,t){return CKEDITOR.env.ie&&8>=document.documentMode||!t||(e=t+":"+e),new CKEDITOR.dom.nodeList(this.$.getElementsByTagName(e))},getHead:function(){var e=this.$.getElementsByTagName("head")[0];return e?new CKEDITOR.dom.element(e):this.getDocumentElement().append(new CKEDITOR.dom.element("head"),!0)},getBody:function(){return new CKEDITOR.dom.element(this.$.body)},getDocumentElement:function(){return new CKEDITOR.dom.element(this.$.documentElement)},getWindow:function(){return new CKEDITOR.dom.window(this.$.parentWindow||this.$.defaultView)},write:function(e){this.$.open("text/html","replace"),CKEDITOR.env.ie&&(e=e.replace(/(?:^\s*<!DOCTYPE[^>]*?>)|^/i,'$&\n<script data-cke-temp="1">('+CKEDITOR.tools.fixDomain+")();<\/script>")),this.$.write(e),this.$.close()},find:function(e){return new CKEDITOR.dom.nodeList(this.$.querySelectorAll(e))},findOne:function(e){return(e=this.$.querySelector(e))?new CKEDITOR.dom.element(e):null},_getHtml5ShivFrag:function(){var e=this.getCustomData("html5ShivFrag");return e||(e=this.$.createDocumentFragment(),CKEDITOR.tools.enableHtml5Elements(e,!0),this.setCustomData("html5ShivFrag",e)),e}}),CKEDITOR.dom.nodeList=function(e){this.$=e},CKEDITOR.dom.nodeList.prototype={count:function(){return this.$.length},getItem:function(e){return 0>e||e>=this.$.length?null:(e=this.$[e])?new CKEDITOR.dom.node(e):null},toArray:function(){return CKEDITOR.tools.array.map(this.$,(function(e){return new CKEDITOR.dom.node(e)}))}},CKEDITOR.dom.element=function(e,t){"string"==typeof e&&(e=(t?t.$:document).createElement(e)),CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.element.get=function(e){return(e="string"==typeof e?document.getElementById(e)||document.getElementsByName(e)[0]:e)&&(e.$?e:new CKEDITOR.dom.element(e))},CKEDITOR.dom.element.prototype=new CKEDITOR.dom.node,CKEDITOR.dom.element.createFromHtml=function(e,t){var n=new CKEDITOR.dom.element("div",t);return n.setHtml(e),n.getFirst().remove()},CKEDITOR.dom.element.setMarker=function(e,t,n,i){var a=t.getCustomData("list_marker_id")||t.setCustomData("list_marker_id",CKEDITOR.tools.getNextNumber()).getCustomData("list_marker_id"),r=t.getCustomData("list_marker_names")||t.setCustomData("list_marker_names",{}).getCustomData("list_marker_names");return e[a]=t,r[n]=1,t.setCustomData(n,i)},CKEDITOR.dom.element.clearAllMarkers=function(e){for(var t in e)CKEDITOR.dom.element.clearMarkers(e,e[t],1)},CKEDITOR.dom.element.clearMarkers=function(e,t,n){var i,a=t.getCustomData("list_marker_names"),r=t.getCustomData("list_marker_id");for(i in a)t.removeCustomData(i);t.removeCustomData("list_marker_names"),n&&(t.removeCustomData("list_marker_id"),delete e[r])},function(){function e(e,t){return-1<(" "+e+" ").replace(r," ").indexOf(" "+t+" ")}function t(e){var t=!0;return e.$.id||(e.$.id="cke_tmp_"+CKEDITOR.tools.getNextNumber(),t=!1),function(){t||e.removeAttribute("id")}}function n(e,t){var n=CKEDITOR.tools.escapeCss(e.$.id);return"#"+n+" "+t.split(/,\s*/).join(", #"+n+" ")}function i(e){for(var t=0,n=0,i=o[e].length;n<i;n++)t+=parseFloat(this.getComputedStyle(o[e][n])||0,10)||0;return t}var a=void 0!==(a=document.createElement("_").classList)&&null!==String(a.add).match(/\[Native code\]/gi),r=/[\n\t\r]/g;CKEDITOR.tools.extend(CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_ELEMENT,addClass:a?function(e){return this.$.classList.add(e),this}:function(t){var n=this.$.className;return n&&(e(n,t)||(n+=" "+t)),this.$.className=n||t,this},removeClass:a?function(e){var t=this.$;return t.classList.remove(e),t.className||t.removeAttribute("class"),this}:function(t){var n=this.getAttribute("class");return n&&e(n,t)&&((n=n.replace(new RegExp("(?:^|\\s+)"+t+"(?=\\s|$)"),"").replace(/^\s+/,""))?this.setAttribute("class",n):this.removeAttribute("class")),this},hasClass:function(t){return e(this.$.className,t)},append:function(e,t){return"string"==typeof e&&(e=this.getDocument().createElement(e)),t?this.$.insertBefore(e.$,this.$.firstChild):this.$.appendChild(e.$),e},appendHtml:function(e){if(this.$.childNodes.length){var t=new CKEDITOR.dom.element("div",this.getDocument());t.setHtml(e),t.moveChildren(this)}else this.setHtml(e)},appendText:function(e){null!=this.$.text&&CKEDITOR.env.ie&&9>CKEDITOR.env.version?this.$.text+=e:this.append(new CKEDITOR.dom.text(e))},appendBogus:function(e){if(e||CKEDITOR.env.needsBrFiller){for(e=this.getLast();e&&e.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.rtrim(e.getText());)e=e.getPrevious();e&&e.is&&e.is("br")||(e=this.getDocument().createElement("br"),CKEDITOR.env.gecko&&e.setAttribute("type","_moz"),this.append(e))}},breakParent:function(e,t){var n=new CKEDITOR.dom.range(this.getDocument());n.setStartAfter(this),n.setEndAfter(e);var i,a=n.extractContents(!1,t||!1);if(n.insertNode(this.remove()),CKEDITOR.env.ie&&!CKEDITOR.env.edge){for(n=new CKEDITOR.dom.element("div");i=a.getFirst();)i.$.style.backgroundColor&&(i.$.style.backgroundColor=i.$.style.backgroundColor),n.append(i);n.insertAfter(this),n.remove(!0)}else a.insertAfterNode(this)},contains:document.compareDocumentPosition?function(e){return!!(16&this.$.compareDocumentPosition(e.$))}:function(e){var t=this.$;return e.type!=CKEDITOR.NODE_ELEMENT?t.contains(e.getParent().$):t!=e.$&&t.contains(e.$)},focus:function(){function e(){try{this.$.focus()}catch(e){}}return function(t){t?CKEDITOR.tools.setTimeout(e,100,this):e.call(this)}}(),getHtml:function(){var e=this.$.innerHTML;return CKEDITOR.env.ie?e.replace(/<\?[^>]*>/g,""):e},getOuterHtml:function(){if(this.$.outerHTML)return this.$.outerHTML.replace(/<\?[^>]*>/,"");var e=this.$.ownerDocument.createElement("div");return e.appendChild(this.$.cloneNode(!0)),e.innerHTML},getClientRect:function(e){var t=CKEDITOR.tools.extend({},this.$.getBoundingClientRect());return!t.width&&(t.width=t.right-t.left),!t.height&&(t.height=t.bottom-t.top),e?CKEDITOR.tools.getAbsoluteRectPosition(this.getWindow(),t):t},setHtml:CKEDITOR.env.ie&&9>CKEDITOR.env.version?function(e){try{var t=this.$;if(this.getParent())return t.innerHTML=e;var n=this.getDocument()._getHtml5ShivFrag();return n.appendChild(t),t.innerHTML=e,n.removeChild(t),e}catch(n){for(this.$.innerHTML="",(t=new CKEDITOR.dom.element("body",this.getDocument())).$.innerHTML=e,t=t.getChildren();t.count();)this.append(t.getItem(0));return e}}:function(e){return this.$.innerHTML=e},setText:function(){var e=document.createElement("p");return e.innerHTML="x",e=e.textContent,function(t){this.$[e?"textContent":"innerText"]=t}}(),getAttribute:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(e){switch(e){case"class":e="className";break;case"http-equiv":e="httpEquiv";break;case"name":return this.$.name;case"tabindex":return 0!==(e=this.$.getAttribute(e,2))&&0===this.$.tabIndex&&(e=null),e;case"checked":return((e=this.$.attributes.getNamedItem(e)).specified?e.nodeValue:this.$.checked)?"checked":null;case"hspace":case"value":return this.$[e];case"style":return this.$.style.cssText;case"contenteditable":case"contentEditable":return this.$.attributes.getNamedItem("contentEditable").specified?this.$.getAttribute("contentEditable"):null}return this.$.getAttribute(e,2)}:function(e){return this.$.getAttribute(e,2)},getAttributes:function(e){var t,n={},i=this.$.attributes;for(e=CKEDITOR.tools.isArray(e)?e:[],t=0;t<i.length;t++)-1===CKEDITOR.tools.indexOf(e,i[t].name)&&(n[i[t].name]=i[t].value);return n},getChildren:function(){return new CKEDITOR.dom.nodeList(this.$.childNodes)},getClientSize:function(){return{width:this.$.clientWidth,height:this.$.clientHeight}},getComputedStyle:document.defaultView&&document.defaultView.getComputedStyle?function(e){var t=this.getWindow().$.getComputedStyle(this.$,null);return t?t.getPropertyValue(e):""}:function(e){return this.$.currentStyle[CKEDITOR.tools.cssStyleToDomStyle(e)]},getDtd:function(){var e=CKEDITOR.dtd[this.getName()];return this.getDtd=function(){return e},e},getElementsByTag:CKEDITOR.dom.document.prototype.getElementsByTag,getTabIndex:function(){var e=this.$.tabIndex;return 0!==e||CKEDITOR.dtd.$tabIndex[this.getName()]||0===parseInt(this.getAttribute("tabindex"),10)?e:-1},getText:function(){return this.$.textContent||this.$.innerText||""},getWindow:function(){return this.getDocument().getWindow()},getId:function(){return this.$.id||null},getNameAtt:function(){return this.$.name||null},getName:function(){var e=this.$.nodeName.toLowerCase();if(CKEDITOR.env.ie&&8>=document.documentMode){var t=this.$.scopeName;"HTML"!=t&&(e=t.toLowerCase()+":"+e)}return this.getName=function(){return e},this.getName()},getValue:function(){return this.$.value},getFirst:function(e){var t=this.$.firstChild;return(t=t&&new CKEDITOR.dom.node(t))&&e&&!e(t)&&(t=t.getNext(e)),t},getLast:function(e){var t=this.$.lastChild;return(t=t&&new CKEDITOR.dom.node(t))&&e&&!e(t)&&(t=t.getPrevious(e)),t},getStyle:function(e){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(e)]},is:function(){var e=this.getName();if("object"==typeof arguments[0])return!!arguments[0][e];for(var t=0;t<arguments.length;t++)if(arguments[t]==e)return!0;return!1},isEditable:function(e){var t=this.getName();return!(this.isReadOnly()||"none"==this.getComputedStyle("display")||"hidden"==this.getComputedStyle("visibility")||CKEDITOR.dtd.$nonEditable[t]||CKEDITOR.dtd.$empty[t]||this.is("a")&&(this.data("cke-saved-name")||this.hasAttribute("name"))&&!this.getChildCount()||!1!==e&&(!(e=CKEDITOR.dtd[t]||CKEDITOR.dtd.span)||!e["#"]))},isIdentical:function(e){var t=this.clone(0,1);if(e=e.clone(0,1),t.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),e.removeAttributes(["_moz_dirty","data-cke-expando","data-cke-saved-href","data-cke-saved-name"]),t.$.isEqualNode)return t.$.style.cssText=CKEDITOR.tools.normalizeCssText(t.$.style.cssText),e.$.style.cssText=CKEDITOR.tools.normalizeCssText(e.$.style.cssText),t.$.isEqualNode(e.$);if(t=t.getOuterHtml(),e=e.getOuterHtml(),CKEDITOR.env.ie&&9>CKEDITOR.env.version&&this.is("a")){var n=this.getParent();n.type==CKEDITOR.NODE_ELEMENT&&((n=n.clone()).setHtml(t),t=n.getHtml(),n.setHtml(e),e=n.getHtml())}return t==e},isVisible:function(){var e,t,n=(this.$.offsetHeight||this.$.offsetWidth)&&"hidden"!=this.getComputedStyle("visibility");return n&&CKEDITOR.env.webkit&&!(e=this.getWindow()).equals(CKEDITOR.document.getWindow())&&(t=e.$.frameElement)&&(n=new CKEDITOR.dom.element(t).isVisible()),!!n},isEmptyInlineRemoveable:function(){if(!CKEDITOR.dtd.$removeEmpty[this.getName()])return!1;for(var e=this.getChildren(),t=0,n=e.count();t<n;t++){var i=e.getItem(t);if((i.type!=CKEDITOR.NODE_ELEMENT||!i.data("cke-bookmark"))&&(i.type==CKEDITOR.NODE_ELEMENT&&!i.isEmptyInlineRemoveable()||i.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(i.getText())))return!1}return!0},hasAttributes:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(){for(var e=this.$.attributes,t=0;t<e.length;t++){var n=e[t];switch(n.nodeName){case"class":if(this.getAttribute("class"))return!0;case"data-cke-expando":continue;default:if(n.specified)return!0}}return!1}:function(){var e=this.$.attributes,t=e.length,n={"data-cke-expando":1,_moz_dirty:1};return 0<t&&(2<t||!n[e[0].nodeName]||2==t&&!n[e[1].nodeName])},hasAttribute:function(){function e(e){var t=this.$.attributes.getNamedItem(e);if("input"==this.getName())switch(e){case"class":return 0<this.$.className.length;case"checked":return!!this.$.checked;case"value":return"checkbox"==(e=this.getAttribute("type"))||"radio"==e?"on"!=this.$.value:!!this.$.value}return!!t&&t.specified}return CKEDITOR.env.ie?8>CKEDITOR.env.version?function(t){return"name"==t?!!this.$.name:e.call(this,t)}:e:function(e){return!!this.$.attributes.getNamedItem(e)}}(),hide:function(){this.setStyle("display","none")},moveChildren:function(e,t){var n,i=this.$;if(i!=(e=e.$))if(t)for(;n=i.lastChild;)e.insertBefore(i.removeChild(n),e.firstChild);else for(;n=i.firstChild;)e.appendChild(i.removeChild(n))},mergeSiblings:function(){function e(e,t,n){if(t&&t.type==CKEDITOR.NODE_ELEMENT){for(var i=[];t.data("cke-bookmark")||t.isEmptyInlineRemoveable();)if(i.push(t),!(t=n?t.getNext():t.getPrevious())||t.type!=CKEDITOR.NODE_ELEMENT)return;if(e.isIdentical(t)){for(var a=n?e.getLast():e.getFirst();i.length;)i.shift().move(e,!n);t.moveChildren(e,!n),t.remove(),a&&a.type==CKEDITOR.NODE_ELEMENT&&a.mergeSiblings()}}}return function(t){(!1===t||CKEDITOR.dtd.$removeEmpty[this.getName()]||this.is("a"))&&(e(this,this.getNext(),!0),e(this,this.getPrevious()))}}(),show:function(){this.setStyles({display:"",visibility:""})},setAttribute:function(){var e=function(e,t){return this.$.setAttribute(e,t),this};return CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(t,n){return"class"==t?this.$.className=n:"style"==t?this.$.style.cssText=n:"tabindex"==t?this.$.tabIndex=n:"checked"==t?this.$.checked=n:"contenteditable"==t?e.call(this,"contentEditable",n):e.apply(this,arguments),this}:CKEDITOR.env.ie8Compat&&CKEDITOR.env.secure?function(t,n){if("src"==t&&n.match(/^http:\/\//))try{e.apply(this,arguments)}catch(e){}else e.apply(this,arguments);return this}:e}(),setAttributes:function(e){for(var t in e)this.setAttribute(t,e[t]);return this},setValue:function(e){return this.$.value=e,this},removeAttribute:CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)?function(e){"class"==e?e="className":"tabindex"==e?e="tabIndex":"contenteditable"==e&&(e="contentEditable"),this.$.removeAttribute(e)}:function(e){this.$.removeAttribute(e)},removeAttributes:function(e){if(CKEDITOR.tools.isArray(e))for(var t=0;t<e.length;t++)this.removeAttribute(e[t]);else for(t in e=e||this.getAttributes())e.hasOwnProperty(t)&&this.removeAttribute(t)},removeStyle:function(e){if((i=this.$.style).removeProperty||"border"!=e&&"margin"!=e&&"padding"!=e)i.removeProperty?i.removeProperty(e):i.removeAttribute(CKEDITOR.tools.cssStyleToDomStyle(e)),this.$.style.cssText||this.removeAttribute("style");else{var t,n=["top","left","right","bottom"];"border"==e&&(t=["color","style","width"]);for(var i=[],a=0;a<n.length;a++)if(t)for(var r=0;r<t.length;r++)i.push([e,n[a],t[r]].join("-"));else i.push([e,n[a]].join("-"));for(e=0;e<i.length;e++)this.removeStyle(i[e])}},setStyle:function(e,t){return this.$.style[CKEDITOR.tools.cssStyleToDomStyle(e)]=t,this},setStyles:function(e){for(var t in e)this.setStyle(t,e[t]);return this},setOpacity:function(e){CKEDITOR.env.ie&&9>CKEDITOR.env.version?(e=Math.round(100*e),this.setStyle("filter",100<=e?"":"progid:DXImageTransform.Microsoft.Alpha(opacity="+e+")")):this.setStyle("opacity",e)},unselectable:function(){if(this.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","none")),CKEDITOR.env.ie){this.setAttribute("unselectable","on");for(var e=this.getElementsByTag("*"),t=0,n=e.count();t<n;t++)e.getItem(t).setAttribute("unselectable","on")}},getPositionedAncestor:function(){for(var e=this;"html"!=e.getName();){if("static"!=e.getComputedStyle("position"))return e;e=e.getParent()}return null},getDocumentPosition:function(e){var t=0,n=0,i=this.getDocument(),a=i.getBody(),r="BackCompat"==i.$.compatMode;if(!document.documentElement.getBoundingClientRect||CKEDITOR.env.ie&&8===CKEDITOR.env.version)for(l=this,d=null;l&&"body"!=l.getName()&&"html"!=l.getName();){for(t+=l.$.offsetLeft-l.$.scrollLeft,n+=l.$.offsetTop-l.$.scrollTop,l.equals(this)||(t+=l.$.clientLeft||0,n+=l.$.clientTop||0);d&&!d.equals(l);)t-=d.$.scrollLeft,n-=d.$.scrollTop,d=d.getParent();d=l,l=(o=l.$.offsetParent)?new CKEDITOR.dom.element(o):null}else{var o=this.$.getBoundingClientRect(),s=i.$.documentElement,l=s.clientTop||a.$.clientTop||0,d=s.clientLeft||a.$.clientLeft||0,c=!0;CKEDITOR.env.ie&&(c=i.getDocumentElement().contains(this),i=i.getBody().contains(this),c=r&&i||!r&&c),c&&(CKEDITOR.env.webkit||CKEDITOR.env.ie&&12<=CKEDITOR.env.version?(t=a.$.scrollLeft||s.scrollLeft,n=a.$.scrollTop||s.scrollTop):(t=(n=r?a.$:s).scrollLeft,n=n.scrollTop),t=o.left+t-d,n=o.top+n-l)}return e&&(o=this.getWindow(),l=e.getWindow(),!o.equals(l)&&o.$.frameElement&&(t+=(e=new CKEDITOR.dom.element(o.$.frameElement).getDocumentPosition(e)).x,n+=e.y)),document.documentElement.getBoundingClientRect||!CKEDITOR.env.gecko||r||(t+=this.$.clientLeft?1:0,n+=this.$.clientTop?1:0),{x:t,y:n}},scrollIntoView:function(e){var t=this.getParent();if(t)do{if((t.$.clientWidth&&t.$.clientWidth<t.$.scrollWidth||t.$.clientHeight&&t.$.clientHeight<t.$.scrollHeight)&&!t.is("body")&&this.scrollIntoParent(t,e,1),t.is("html")){var n=t.getWindow();try{var i=n.$.frameElement;i&&(t=new CKEDITOR.dom.element(i))}catch(e){}}}while(t=t.getParent())},scrollIntoParent:function(e,t,n){var i,a,r,o;function s(t,n){/body|html/.test(e.getName())?e.getWindow().$.scrollBy(t,n):(e.$.scrollLeft+=t,e.$.scrollTop+=n)}function l(e,t){var n={x:0,y:0};if(!e.is(c?"body":"html")){var i=e.$.getBoundingClientRect();n.x=i.left,n.y=i.top}return(i=e.getWindow()).equals(t)||(i=l(CKEDITOR.dom.element.get(i.$.frameElement),t),n.x+=i.x,n.y+=i.y),n}function d(e,t){return parseInt(e.getComputedStyle("margin-"+t)||0,10)||0}!e&&(e=this.getWindow());var c="BackCompat"==(r=e.getDocument()).$.compatMode;e instanceof CKEDITOR.dom.window&&(e=c?r.getBody():r.getDocumentElement()),CKEDITOR.env.webkit&&(r=this.getEditor(!1))&&(r._.previousScrollTop=null),a=l(this,r=e.getWindow());var u=l(e,r),f=this.$.offsetHeight;i=this.$.offsetWidth;var h=e.$.clientHeight,p=e.$.clientWidth;r=a.x-d(this,"left")-u.x||0,o=a.y-d(this,"top")-u.y||0,i=a.x+i+d(this,"right")-(u.x+p)||0,a=a.y+f+d(this,"bottom")-(u.y+h)||0,(0>o||0<a)&&s(0,!0===t?o:!1===t?a:0>o?o:a),n&&(0>r||0<i)&&s(0>r?r:i,0)},setState:function(e,t,n){switch(t=t||"cke",e){case CKEDITOR.TRISTATE_ON:this.addClass(t+"_on"),this.removeClass(t+"_off"),this.removeClass(t+"_disabled"),n&&this.setAttribute("aria-pressed",!0),n&&this.removeAttribute("aria-disabled");break;case CKEDITOR.TRISTATE_DISABLED:this.addClass(t+"_disabled"),this.removeClass(t+"_off"),this.removeClass(t+"_on"),n&&this.setAttribute("aria-disabled",!0),n&&this.removeAttribute("aria-pressed");break;default:this.addClass(t+"_off"),this.removeClass(t+"_on"),this.removeClass(t+"_disabled"),n&&this.removeAttribute("aria-pressed"),n&&this.removeAttribute("aria-disabled")}},getFrameDocument:function(){var e=this.$;try{e.contentWindow.document}catch(t){e.src=e.src}return e&&new CKEDITOR.dom.document(e.contentWindow.document)},copyAttributes:function(e,t){var n=this.$.attributes;t=t||{};for(var i=0;i<n.length;i++){var a,r=n[i],o=r.nodeName.toLowerCase();o in t||("checked"==o&&(a=this.getAttribute(o))?e.setAttribute(o,a):CKEDITOR.env.ie&&!this.hasAttribute(o)||(null===(a=this.getAttribute(o))&&(a=r.nodeValue),e.setAttribute(o,a)))}""!==this.$.style.cssText&&(e.$.style.cssText=this.$.style.cssText)},renameNode:function(e){if(this.getName()!=e){var t=this.getDocument();e=new CKEDITOR.dom.element(e,t),this.copyAttributes(e),this.moveChildren(e),this.getParent(!0)&&this.$.parentNode.replaceChild(e.$,this.$),e.$["data-cke-expando"]=this.$["data-cke-expando"],this.$=e.$,delete this.getName}},getChild:function(){function e(e,t){var n=e.childNodes;if(0<=t&&t<n.length)return n[t]}return function(t){var n=this.$;if(t.slice)for(t=t.slice();0<t.length&&n;)n=e(n,t.shift());else n=e(n,t);return n?new CKEDITOR.dom.node(n):null}}(),getChildCount:function(){return this.$.childNodes.length},disableContextMenu:function(){function e(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_enable_context_menu")}this.on("contextmenu",(function(t){t.data.getTarget().getAscendant(e,!0)||t.data.preventDefault()}))},getDirection:function(e){return e?this.getComputedStyle("direction")||this.getDirection()||this.getParent()&&this.getParent().getDirection(1)||this.getDocument().$.dir||"ltr":this.getStyle("direction")||this.getAttribute("dir")},data:function(e,t){return e="data-"+e,void 0===t?this.getAttribute(e):(!1===t?this.removeAttribute(e):this.setAttribute(e,t),null)},getEditor:function(e){var t,n,i,a=CKEDITOR.instances;for(t in e=e||void 0===e,a)if((n=a[t]).element.equals(this)&&n.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO||!e&&(i=n.editable())&&(i.equals(this)||i.contains(this)))return n;return null},find:function(e){var i=t(this);return e=new CKEDITOR.dom.nodeList(this.$.querySelectorAll(n(this,e))),i(),e},findOne:function(e){var i=t(this);return e=this.$.querySelector(n(this,e)),i(),e?new CKEDITOR.dom.element(e):null},forEach:function(e,t,n){if(!(n||t&&this.type!=t))var i=e(this);if(!1!==i){n=this.getChildren();for(var a=0;a<n.count();a++)(i=n.getItem(a)).type==CKEDITOR.NODE_ELEMENT?i.forEach(e,t):t&&i.type!=t||e(i)}},fireEventHandler:function(e,t){var n="on"+e,i=this.$;if(CKEDITOR.env.ie&&9>CKEDITOR.env.version){var a,r=i.ownerDocument.createEventObject();for(a in t)r[a]=t[a];i.fireEvent(n,r)}else i[i[e]?e:n](t)},isDetached:function(){var e=this.getDocument(),t=e.getDocumentElement();return!t.equals(this)&&!t.contains(this)||(!CKEDITOR.env.ie||8<CKEDITOR.env.version&&!CKEDITOR.env.quirks)&&!e.$.defaultView}});var o={width:["border-left-width","border-right-width","padding-left","padding-right"],height:["border-top-width","border-bottom-width","padding-top","padding-bottom"]};CKEDITOR.dom.element.prototype.setSize=function(e,t,n){"number"==typeof t&&(!n||CKEDITOR.env.ie&&CKEDITOR.env.quirks||(t-=i.call(this,e)),this.setStyle(e,t+"px"))},CKEDITOR.dom.element.prototype.getSize=function(e,t){var n=Math.max(this.$["offset"+CKEDITOR.tools.capitalize(e)],this.$["client"+CKEDITOR.tools.capitalize(e)])||0;return t&&(n-=i.call(this,e)),n}}(),CKEDITOR.dom.documentFragment=function(e){e=e||CKEDITOR.document,this.$=e.type==CKEDITOR.NODE_DOCUMENT?e.$.createDocumentFragment():e},CKEDITOR.tools.extend(CKEDITOR.dom.documentFragment.prototype,CKEDITOR.dom.element.prototype,{type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,insertAfterNode:function(e){(e=e.$).parentNode.insertBefore(this.$,e.nextSibling)},getHtml:function(){var e=new CKEDITOR.dom.element("div");return this.clone(1,1).appendTo(e),e.getHtml().replace(/\s*data-cke-expando=".*?"/g,"")}},!0,{append:1,appendBogus:1,clone:1,getFirst:1,getHtml:1,getLast:1,getParent:1,getNext:1,getPrevious:1,appendTo:1,moveChildren:1,insertBefore:1,insertAfterNode:1,replace:1,trim:1,type:1,ltrim:1,rtrim:1,getDocument:1,getChildCount:1,getChild:1,getChildren:1}),CKEDITOR.tools.extend(CKEDITOR.dom.documentFragment.prototype,CKEDITOR.dom.document.prototype,!0,{find:1,findOne:1}),function(){function e(e,t){var n=this.range;if(this._.end)return null;if(!this._.start){if(this._.start=1,n.collapsed)return this.end(),null;n.optimize()}var i,a=n.startContainer;i=n.endContainer;var r,o=n.startOffset,s=n.endOffset,l=this.guard,d=this.type,c=e?"getPreviousSourceNode":"getNextSourceNode";if(!e&&!this._.guardLTR){var u=i.type==CKEDITOR.NODE_ELEMENT?i:i.getParent(),f=i.type==CKEDITOR.NODE_ELEMENT?i.getChild(s):i.getNext();this._.guardLTR=function(e,t){return!(t&&u.equals(e)||f&&e.equals(f)||e.type==CKEDITOR.NODE_ELEMENT&&t&&e.equals(n.root))}}if(e&&!this._.guardRTL){var h=a.type==CKEDITOR.NODE_ELEMENT?a:a.getParent(),p=a.type==CKEDITOR.NODE_ELEMENT?o?a.getChild(o-1):null:a.getPrevious();this._.guardRTL=function(e,t){return!(t&&h.equals(e)||p&&e.equals(p)||e.type==CKEDITOR.NODE_ELEMENT&&t&&e.equals(n.root))}}var g=e?this._.guardRTL:this._.guardLTR;for(r=l?function(e,t){return!1!==g(e,t)&&l(e,t)}:g,this.current?i=this.current[c](!1,d,r):(e?i.type==CKEDITOR.NODE_ELEMENT&&(i=0<s?i.getChild(s-1):!1===r(i,!0)?null:i.getPreviousSourceNode(!0,d,r)):(i=a).type==CKEDITOR.NODE_ELEMENT&&((i=i.getChild(o))||(i=!1===r(a,!0)?null:a.getNextSourceNode(!0,d,r))),i&&!1===r(i)&&(i=null));i&&!this._.end;){if(this.current=i,this.evaluator&&!1===this.evaluator(i)){if(t&&this.evaluator)return!1}else if(!t)return i;i=i[c](!1,d,r)}return this.end(),this.current=null}function t(t){for(var n,i=null;n=e.call(this,t);)i=n;return i}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(e){this.range=e,this._={}},proto:{end:function(){this._.end=1},next:function(){return e.call(this)},previous:function(){return e.call(this,1)},checkForward:function(){return!1!==e.call(this,0,1)},checkBackward:function(){return!1!==e.call(this,1,1)},lastForward:function(){return t.call(this)},lastBackward:function(){return t.call(this,1)},reset:function(){delete this.current,this._={}}}});var n={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},i={absolute:1,fixed:1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(e){return!("none"!=this.getComputedStyle("float")||this.getComputedStyle("position")in i||!n[this.getComputedStyle("display")])||!!(this.is(CKEDITOR.dtd.$block)||e&&this.is(e))},CKEDITOR.dom.walker.blockBoundary=function(e){return function(t){return!(t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary(e))}},CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})},CKEDITOR.dom.walker.bookmark=function(e,t){function n(e){return e&&e.getName&&"span"==e.getName()&&e.data("cke-bookmark")}return function(i){var a,r;return a=i&&i.type!=CKEDITOR.NODE_ELEMENT&&(r=i.getParent())&&n(r),a=e?a:a||n(i),!!(t^a)}},CKEDITOR.dom.walker.whitespaces=function(e){return function(t){var n;return t&&t.type==CKEDITOR.NODE_TEXT&&(n=!CKEDITOR.tools.trim(t.getText())||CKEDITOR.env.webkit&&t.getText()==CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE),!!(e^n)}},CKEDITOR.dom.walker.invisible=function(e){var t=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.env.webkit?1:0;return function(i){return t(i)?i=1:(i.type==CKEDITOR.NODE_TEXT&&(i=i.getParent()),i=i.$.offsetWidth<=n),!!(e^i)}},CKEDITOR.dom.walker.nodeType=function(e,t){return function(n){return!!(t^n.type==e)}},CKEDITOR.dom.walker.bogus=function(e){function t(e){return!r(e)&&!o(e)}return function(n){var i=CKEDITOR.env.needsBrFiller?n.is&&n.is("br"):n.getText&&a.test(n.getText());return i&&(i=n.getParent(),n=n.getNext(t),i=i.isBlockBoundary()&&(!n||n.type==CKEDITOR.NODE_ELEMENT&&n.isBlockBoundary())),!!(e^i)}},CKEDITOR.dom.walker.temp=function(e){return function(t){return t.type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent()),t=t&&t.hasAttribute("data-cke-temp"),!!(e^t)}};var a=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,r=CKEDITOR.dom.walker.whitespaces(),o=CKEDITOR.dom.walker.bookmark(),s=CKEDITOR.dom.walker.temp(),l=function(e){return o(e)||r(e)||e.type==CKEDITOR.NODE_ELEMENT&&e.is(CKEDITOR.dtd.$inline)&&!e.is(CKEDITOR.dtd.$empty)};CKEDITOR.dom.walker.ignored=function(e){return function(t){return t=r(t)||o(t)||s(t),!!(e^t)}};var d=CKEDITOR.dom.walker.ignored();CKEDITOR.dom.walker.empty=function(e){return function(t){for(var n=0,i=t.getChildCount();n<i;++n)if(!d(t.getChild(n)))return!!e;return!e}};var c=CKEDITOR.dom.walker.empty(),u=CKEDITOR.dom.walker.validEmptyBlockContainers=CKEDITOR.tools.extend(function(e){var t,n={};for(t in e)CKEDITOR.dtd[t]["#"]&&(n[t]=1);return n}(CKEDITOR.dtd.$block),{caption:1,td:1,th:1});CKEDITOR.dom.walker.editable=function(e){return function(t){return t=!d(t)&&!!(t.type==CKEDITOR.NODE_TEXT||t.type==CKEDITOR.NODE_ELEMENT&&(t.is(CKEDITOR.dtd.$inline)||t.is("hr")||"false"==t.getAttribute("contenteditable")||!CKEDITOR.env.needsBrFiller&&t.is(u)&&c(t))),!!(e^t)}},CKEDITOR.dom.element.prototype.getBogus=function(){var e=this;do{e=e.getPreviousSourceNode()}while(l(e));return!(!e||!(CKEDITOR.env.needsBrFiller?e.is&&e.is("br"):e.getText&&a.test(e.getText())))&&e}}(),CKEDITOR.dom.range=function(e){this.endOffset=this.endContainer=this.startOffset=this.startContainer=null,this.collapsed=!0;var t=e instanceof CKEDITOR.dom.document;this.document=t?e:e.getDocument(),this.root=t?e.getBody():e},function(){function e(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer.equals(e.endContainer)&&e.startOffset==e.endOffset}function t(e,t,n,i,a){function r(e,t,n,i){var r=n?e.getPrevious():e.getNext();return i&&o||(l||i?t.append(e.clone(!0,a),n):(e.remove(),s&&t.append(e,n))),r}e.optimizeBookmark();var o=0===t,s=1==t,l=2==t;t=l||s;var d,c,u,f,h,p,g=e.startContainer,m=e.endContainer,v=e.startOffset,E=e.endOffset;if(l&&m.type==CKEDITOR.NODE_TEXT&&(g.equals(m)||g.type===CKEDITOR.NODE_ELEMENT&&g.getFirst().equals(m)))n.append(e.document.createText(m.substring(v,E)));else{m.type==CKEDITOR.NODE_TEXT?l?p=!0:m=m.split(E):0<m.getChildCount()?E>=m.getChildCount()?(m=m.getChild(E-1),c=!0):m=m.getChild(E):f=c=!0,g.type==CKEDITOR.NODE_TEXT?l?h=!0:g.split(v):0<g.getChildCount()?0===v?(g=g.getChild(v),d=!0):g=g.getChild(v-1):u=d=!0;for(var T,C,I,b=g.getParents(),y=m.getParents(),D=function(){var e,t,n,i=Math.min(b.length,y.length);for(e=0;e<i;e++)if(t=b[e],n=y[e],!t.equals(n))return e;return e-1}(),O=b.length-1,R=y.length-1,_=n,x=-1,w=D;w<=O;w++){for(I=(C=b[w]).getNext(),w!=O||C.equals(y[w])&&O<R?t&&(T=_.append(C.clone(0,a))):d?r(C,_,!1,u):h&&_.append(e.document.createText(C.substring(v)));I;){if(I.equals(y[w])){x=w;break}I=r(I,_)}_=T}for(_=n,w=D;w<=R;w++)if(I=(n=y[w]).getPrevious(),n.equals(b[w]))t&&(_=_.getChild(0));else{if(w!=R||n.equals(b[w])&&R<O?t&&(T=_.append(n.clone(0,a))):c?r(n,_,!1,f):p&&_.append(e.document.createText(n.substring(0,E))),w>x)for(;I;)I=r(I,_,!0);_=T}l||function(){var t=D-1,n=u&&f&&!g.equals(m);t<O-1||t<R-1||n?(n?e.moveToPosition(m,CKEDITOR.POSITION_BEFORE_START):R==t+1&&c?e.moveToPosition(y[t],CKEDITOR.POSITION_BEFORE_END):e.moveToPosition(y[t+1],CKEDITOR.POSITION_BEFORE_START),i&&(t=b[t+1])&&t.type==CKEDITOR.NODE_ELEMENT&&((n=CKEDITOR.dom.element.createFromHtml('<span data-cke-bookmark="1" style="display:none">&nbsp;</span>',e.document)).insertAfter(t),t.mergeSiblings(!1),e.moveToBookmark({startNode:n}))):e.collapse(!0)}()}}function n(){var e=!1,t=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(!0),i=CKEDITOR.dom.walker.bogus();return function(r){return!(!n(r)&&!t(r))||(i(r)&&!e?e=!0:!(r.type==CKEDITOR.NODE_TEXT&&(r.hasAscendant("pre")||CKEDITOR.tools.trim(r.getText()).length)||r.type==CKEDITOR.NODE_ELEMENT&&!r.is(a)))}}function i(e){return function(){var t;return this[e?"getPreviousNode":"getNextNode"]((function(e){return!t&&l(e)&&(t=e),s(e)&&!(r(e)&&e.equals(t))}))}}var a={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1},r=CKEDITOR.dom.walker.bogus(),o=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,s=CKEDITOR.dom.walker.editable(),l=CKEDITOR.dom.walker.ignored(!0);CKEDITOR.dom.range.prototype={clone:function(){var e=new CKEDITOR.dom.range(this.root);return e._setStartContainer(this.startContainer),e.startOffset=this.startOffset,e._setEndContainer(this.endContainer),e.endOffset=this.endOffset,e.collapsed=this.collapsed,e},collapse:function(e){e?(this._setEndContainer(this.startContainer),this.endOffset=this.startOffset):(this._setStartContainer(this.endContainer),this.startOffset=this.endOffset),this.collapsed=!0},cloneContents:function(e){var n=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||t(this,2,n,!1,void 0===e||e),n},deleteContents:function(e){this.collapsed||t(this,0,null,e)},extractContents:function(e,n){var i=new CKEDITOR.dom.documentFragment(this.document);return this.collapsed||t(this,1,i,e,void 0===n||n),i},equals:function(e){return this.startOffset===e.startOffset&&this.endOffset===e.endOffset&&this.startContainer.equals(e.startContainer)&&this.endContainer.equals(e.endContainer)},createBookmark:function(e){function t(e){return e.getAscendant((function(e){var t;return(t=e.data&&e.data("cke-temp"))&&(t=-1===CKEDITOR.tools.array.indexOf(["cke_copybin","cke_pastebin"],e.getAttribute("id"))),t}),!0)}var n,i,a,r,o=this.startContainer,s=this.endContainer,l=this.collapsed;return(n=this.document.createElement("span")).data("cke-bookmark",1),n.setStyle("display","none"),n.setHtml("&nbsp;"),e&&(a="cke_bm_"+CKEDITOR.tools.getNextNumber(),n.setAttribute("id",a+(l?"C":"S"))),l||((i=n.clone()).setHtml("&nbsp;"),e&&i.setAttribute("id",a+"E"),r=this.clone(),t(s)&&(s=t(s),r.moveToPosition(s,CKEDITOR.POSITION_AFTER_END)),r.collapse(),r.insertNode(i)),r=this.clone(),t(o)&&(s=t(o),r.moveToPosition(s,CKEDITOR.POSITION_BEFORE_START)),r.collapse(!0),r.insertNode(n),i?(this.setStartAfter(n),this.setEndBefore(i)):this.moveToPosition(n,CKEDITOR.POSITION_AFTER_END),{startNode:e?a+(l?"C":"S"):n,endNode:e?a+"E":i,serializable:e,collapsed:l}},createBookmark2:function(){function e(e){var t,i=e.container,a=e.offset,r=a;if((t=(t=i).type!=CKEDITOR.NODE_ELEMENT||0===r||r==t.getChildCount()?0:t.getChild(r-1).type==CKEDITOR.NODE_TEXT&&t.getChild(r).type==CKEDITOR.NODE_TEXT)&&(a=(i=i.getChild(a-1)).getLength()),i.type==CKEDITOR.NODE_ELEMENT&&0<a){e:{for(t=i;a--;)if(0<=(r=t.getChild(a).getIndex(!0))){a=r;break e}a=-1}a+=1}if(i.type==CKEDITOR.NODE_TEXT){for(t=i,r=0;(t=t.getPrevious())&&t.type==CKEDITOR.NODE_TEXT;)r+=t.getText().replace(CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE,"").length;t=r,i.isEmpty()?(r=i.getPrevious(n),t?(a=t,i=r?r.getNext():i.getParent().getFirst()):(i=i.getParent(),a=r?r.getIndex(!0)+1:0)):a+=t}e.container=i,e.offset=a}function t(e,t){var n=t.getCustomData("cke-fillingChar");if(n){var i=e.container;n.equals(i)&&(e.offset-=CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE.length,0>=e.offset&&(e.offset=i.getIndex(),e.container=i.getParent()))}}var n=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_TEXT,!0);return function(n){var i=this.collapsed,a={container:this.startContainer,offset:this.startOffset},r={container:this.endContainer,offset:this.endOffset};return n&&(e(a),t(a,this.root),i||(e(r),t(r,this.root))),{start:a.container.getAddress(n),end:i?null:r.container.getAddress(n),startOffset:a.offset,endOffset:r.offset,normalized:n,collapsed:i,is2:!0}}}(),moveToBookmark:function(e){if(e.is2){var t=this.document.getByAddress(e.start,e.normalized),n=e.startOffset,i=e.end&&this.document.getByAddress(e.end,e.normalized);e=e.endOffset,this.setStart(t,n),i?this.setEnd(i,e):this.collapse(!0)}else t=(n=e.serializable)?this.document.getById(e.startNode):e.startNode,e=n?this.document.getById(e.endNode):e.endNode,this.setStartBefore(t),t.remove(),e?(this.setEndBefore(e),e.remove()):this.collapse(!0)},getBoundaryNodes:function(){var e,t=this.startContainer,n=this.endContainer,i=this.startOffset,a=this.endOffset;if(t.type==CKEDITOR.NODE_ELEMENT)if((e=t.getChildCount())>i)t=t.getChild(i);else if(1>e)t=t.getPreviousSourceNode();else{for(t=t.$;t.lastChild;)t=t.lastChild;t=(t=new CKEDITOR.dom.node(t)).getNextSourceNode()||t}if(n.type==CKEDITOR.NODE_ELEMENT)if((e=n.getChildCount())>a)n=n.getChild(a).getPreviousSourceNode(!0);else if(1>e)n=n.getPreviousSourceNode();else{for(n=n.$;n.lastChild;)n=n.lastChild;n=new CKEDITOR.dom.node(n)}return t.getPosition(n)&CKEDITOR.POSITION_FOLLOWING&&(t=n),{startNode:t,endNode:n}},getCommonAncestor:function(e,t){var n=this.startContainer,i=this.endContainer;return n=n.equals(i)?e&&n.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?n.getChild(this.startOffset):n:n.getCommonAncestor(i),t&&!n.is?n.getParent():n},optimize:function(){var e=this.startContainer,t=this.startOffset;e.type!=CKEDITOR.NODE_ELEMENT&&(t?t>=e.getLength()&&this.setStartAfter(e):this.setStartBefore(e)),e=this.endContainer,t=this.endOffset,e.type!=CKEDITOR.NODE_ELEMENT&&(t?t>=e.getLength()&&this.setEndAfter(e):this.setEndBefore(e))},optimizeBookmark:function(){var e=this.startContainer,t=this.endContainer;e.is&&e.is("span")&&e.data("cke-bookmark")&&this.setStartAt(e,CKEDITOR.POSITION_BEFORE_START),t&&t.is&&t.is("span")&&t.data("cke-bookmark")&&this.setEndAt(t,CKEDITOR.POSITION_AFTER_END)},trim:function(e,t){var n=this.startContainer,i=this.startOffset,a=this.collapsed;if((!e||a)&&n&&n.type==CKEDITOR.NODE_TEXT){if(i)if(i>=n.getLength())i=n.getIndex()+1,n=n.getParent();else{var r=n.split(i);i=n.getIndex()+1,n=n.getParent(),this.startContainer.equals(this.endContainer)?this.setEnd(r,this.endOffset-this.startOffset):n.equals(this.endContainer)&&(this.endOffset+=1)}else i=n.getIndex(),n=n.getParent();if(this.setStart(n,i),a)return void this.collapse(!0)}n=this.endContainer,i=this.endOffset,t||a||!n||n.type!=CKEDITOR.NODE_TEXT||(i?(i>=n.getLength()||n.split(i),i=n.getIndex()+1):i=n.getIndex(),n=n.getParent(),this.setEnd(n,i))},enlarge:function(e,t){function n(e){return e&&e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("contenteditable")?null:e}function i(e,t,n){var i=new CKEDITOR.dom.range(n);for(i.setStart(e,t),i.setEndAt(n,CKEDITOR.POSITION_BEFORE_END),(n=new CKEDITOR.dom.walker(i)).guard=function(e){return!(e.type==CKEDITOR.NODE_ELEMENT&&e.isBlockBoundary())};i=n.next();){if(i.type!=CKEDITOR.NODE_TEXT)return!1;if(a=i!=e?i.getText():i.substring(t),o.test(a))return!1}return!0}var a,r,o=new RegExp(/[^\s\ufeff]/);switch(e){case CKEDITOR.ENLARGE_INLINE:var s=1;case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)break;var l=this.getCommonAncestor();r=this.root;var d,c,u,f,h,p,g=!1;p=this.startContainer;var m=this.startOffset;for(p.type==CKEDITOR.NODE_TEXT?(m&&(g=!!(p=!CKEDITOR.tools.trim(p.substring(0,m)).length&&p)),p&&((f=p.getPrevious())||(u=p.getParent()))):(m&&(f=p.getChild(m-1)||p.getLast()),f||(u=p)),u=n(u);u||f;){if(u&&!f){if(!h&&u.equals(l)&&(h=!0),s?u.isBlockBoundary():!r.contains(u))break;g&&"inline"==u.getComputedStyle("display")||(g=!1,h?d=u:this.setStartBefore(u)),f=u.getPrevious()}for(;f;)if(p=!1,f.type==CKEDITOR.NODE_COMMENT)f=f.getPrevious();else{if(f.type==CKEDITOR.NODE_TEXT)a=f.getText(),o.test(a)&&(f=null),p=/[\s\ufeff]$/.test(a);else if((f.$.offsetWidth>(CKEDITOR.env.webkit?1:0)||t&&f.is("br"))&&!f.data("cke-bookmark"))if(g&&CKEDITOR.dtd.$removeEmpty[f.getName()]){if(a=f.getText(),o.test(a))f=null;else{m=f.$.getElementsByTagName("*");for(var v,E=0;v=m[E++];)if(!CKEDITOR.dtd.$removeEmpty[v.nodeName.toLowerCase()]){f=null;break}}f&&(p=!!a.length)}else f=null;if(p&&(g?h?d=u:u&&this.setStartBefore(u):g=!0),f){if(p=f.getPrevious(),!u&&!p){u=f,f=null;break}f=p}else u=null}u&&(u=n(u.getParent()))}for(p=this.endContainer,m=this.endOffset,u=f=null,h=g=!1,p.type==CKEDITOR.NODE_TEXT?CKEDITOR.tools.trim(p.substring(m)).length?g=!0:(g=!p.getLength(),m==p.getLength()?(f=p.getNext())||(u=p.getParent()):i(p,m,r)&&(u=p.getParent())):(f=p.getChild(m))||(u=p);u||f;){if(u&&!f){if(!h&&u.equals(l)&&(h=!0),s?u.isBlockBoundary():!r.contains(u))break;g&&"inline"==u.getComputedStyle("display")||(g=!1,h?c=u:u&&this.setEndAfter(u)),f=u.getNext()}for(;f;){if(p=!1,f.type==CKEDITOR.NODE_TEXT)a=f.getText(),i(f,0,r)||(f=null),p=/^[\s\ufeff]/.test(a);else if(f.type==CKEDITOR.NODE_ELEMENT){if((0<f.$.offsetWidth||t&&f.is("br"))&&!f.data("cke-bookmark"))if(g&&CKEDITOR.dtd.$removeEmpty[f.getName()]){if(a=f.getText(),o.test(a))f=null;else for(m=f.$.getElementsByTagName("*"),E=0;v=m[E++];)if(!CKEDITOR.dtd.$removeEmpty[v.nodeName.toLowerCase()]){f=null;break}f&&(p=!!a.length)}else f=null}else p=1;if(p&&g&&(h?c=u:this.setEndAfter(u)),f){if(p=f.getNext(),!u&&!p){u=f,f=null;break}f=p}else u=null}u&&(u=n(u.getParent()))}d&&c&&(l=d.contains(c)?c:d,this.setStartBefore(l),this.setEndAfter(l));break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:u=new CKEDITOR.dom.range(this.root),r=this.root,u.setStartAt(r,CKEDITOR.POSITION_AFTER_START),u.setEnd(this.startContainer,this.startOffset),u=new CKEDITOR.dom.walker(u);var T,C,I=CKEDITOR.dom.walker.blockBoundary(e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),b=null,y=function(e){if(e.type==CKEDITOR.NODE_ELEMENT&&"false"==e.getAttribute("contenteditable"))if(b){if(b.equals(e))return void(b=null)}else b=e;else if(b)return;var t=I(e);return t||(T=e),t};if(s=function(e){var t=y(e);return!t&&e.is&&e.is("br")&&(C=e),t},u.guard=y,u=u.lastBackward(),T=T||r,this.setStartAt(T,!T.is("br")&&(!u&&this.checkStartOfBlock()||u&&T.contains(u))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END),e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){u=this.clone(),u=new CKEDITOR.dom.walker(u);var D=CKEDITOR.dom.walker.whitespaces(),O=CKEDITOR.dom.walker.bookmark();if(u.evaluator=function(e){return!D(e)&&!O(e)},(u=u.previous())&&u.type==CKEDITOR.NODE_ELEMENT&&u.is("br"))break}(u=this.clone()).collapse(),u.setEndAt(r,CKEDITOR.POSITION_BEFORE_END),(u=new CKEDITOR.dom.walker(u)).guard=e==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?s:y,T=b=C=null,u=u.lastForward(),T=T||r,this.setEndAt(T,!u&&this.checkEndOfBlock()||u&&T.contains(u)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START),C&&this.setEndAfter(C)}},shrink:function(e,t,n){var i="boolean"==typeof n?n:!n||"boolean"!=typeof n.shrinkOnBlockBoundary||n.shrinkOnBlockBoundary,a=n&&n.skipBogus;if(!this.collapsed){e=e||CKEDITOR.SHRINK_TEXT;var r=this.clone(),o=this.startContainer,s=this.endContainer,l=this.startOffset,d=this.endOffset,c=n=1;o&&o.type==CKEDITOR.NODE_TEXT&&(l?l>=o.getLength()?r.setStartAfter(o):(r.setStartBefore(o),n=0):r.setStartBefore(o)),s&&s.type==CKEDITOR.NODE_TEXT&&(d?d>=s.getLength()?r.setEndAfter(s):(r.setEndAfter(s),c=0):r.setEndBefore(s)),r=new CKEDITOR.dom.walker(r);var u,f=CKEDITOR.dom.walker.bookmark(),h=CKEDITOR.dom.walker.bogus();return r.evaluator=function(t){return t.type==(e==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)},r.guard=function(t,n){return!!(a&&h(t)||f(t))||!(e==CKEDITOR.SHRINK_ELEMENT&&t.type==CKEDITOR.NODE_TEXT||n&&t.equals(u)||!1===i&&t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary()||t.type==CKEDITOR.NODE_ELEMENT&&t.hasAttribute("contenteditable"))&&(n||t.type!=CKEDITOR.NODE_ELEMENT||(u=t),!0)},n&&(o=r[e==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(o,t?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START),c&&(r.reset(),(r=r[e==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(r,t?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)),!(!n&&!c)}},insertNode:function(e){this.optimizeBookmark(),this.trim(!1,!0);var t=this.startContainer,n=t.getChild(this.startOffset);n?e.insertBefore(n):t.append(e),e.getParent()&&e.getParent().equals(this.endContainer)&&this.endOffset++,this.setStartBefore(e)},moveToPosition:function(e,t){this.setStartAt(e,t),this.collapse(!0)},moveToRange:function(e){this.setStart(e.startContainer,e.startOffset),this.setEnd(e.endContainer,e.endOffset)},selectNodeContents:function(e){this.setStart(e,0),this.setEnd(e,e.type==CKEDITOR.NODE_TEXT?e.getLength():e.getChildCount())},setStart:function(t,n){t.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[t.getName()]&&(n=t.getIndex(),t=t.getParent()),this._setStartContainer(t),this.startOffset=n,this.endContainer||(this._setEndContainer(t),this.endOffset=n),e(this)},setEnd:function(t,n){t.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[t.getName()]&&(n=t.getIndex()+1,t=t.getParent()),this._setEndContainer(t),this.endOffset=n,this.startContainer||(this._setStartContainer(t),this.startOffset=n),e(this)},setStartAfter:function(e){this.setStart(e.getParent(),e.getIndex()+1)},setStartBefore:function(e){this.setStart(e.getParent(),e.getIndex())},setEndAfter:function(e){this.setEnd(e.getParent(),e.getIndex()+1)},setEndBefore:function(e){this.setEnd(e.getParent(),e.getIndex())},setStartAt:function(t,n){switch(n){case CKEDITOR.POSITION_AFTER_START:this.setStart(t,0);break;case CKEDITOR.POSITION_BEFORE_END:t.type==CKEDITOR.NODE_TEXT?this.setStart(t,t.getLength()):this.setStart(t,t.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(t);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(t)}e(this)},setEndAt:function(t,n){switch(n){case CKEDITOR.POSITION_AFTER_START:this.setEnd(t,0);break;case CKEDITOR.POSITION_BEFORE_END:t.type==CKEDITOR.NODE_TEXT?this.setEnd(t,t.getLength()):this.setEnd(t,t.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(t);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(t)}e(this)},fixBlock:function(e,t){var n=this.createBookmark(),i=this.document.createElement(t);this.collapse(e),this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),this.extractContents().appendTo(i),i.trim(),this.insertNode(i);var a=i.getBogus();return a&&a.remove(),i.appendBogus(),this.moveToBookmark(n),i},splitBlock:function(e,t){var n=new CKEDITOR.dom.elementPath(this.startContainer,this.root),i=new CKEDITOR.dom.elementPath(this.endContainer,this.root),a=n.block,r=i.block,o=null;return n.blockLimit.equals(i.blockLimit)?("br"!=e&&(a||(a=this.fixBlock(!0,e),r=new CKEDITOR.dom.elementPath(this.endContainer,this.root).block),r||(r=this.fixBlock(!1,e))),n=a&&this.checkStartOfBlock(),i=r&&this.checkEndOfBlock(),this.deleteContents(),a&&a.equals(r)&&(i?(o=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(r,CKEDITOR.POSITION_AFTER_END),r=null):n?(o=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(a,CKEDITOR.POSITION_BEFORE_START),a=null):(r=this.splitElement(a,t||!1),a.is("ul","ol")||a.appendBogus())),{previousBlock:a,nextBlock:r,wasStartOfBlock:n,wasEndOfBlock:i,elementPath:o}):null},splitElement:function(e,t){if(!this.collapsed)return null;this.setEndAt(e,CKEDITOR.POSITION_BEFORE_END);var n=this.extractContents(!1,t||!1),i=e.clone(!1,t||!1);return n.appendTo(i),i.insertAfter(e),this.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),i},removeEmptyBlocksAtEnd:function(){function e(e){return function(i){return!(t(i)||n(i)||i.type==CKEDITOR.NODE_ELEMENT&&i.isEmptyInlineRemoveable()||e.is("table")&&i.is("caption"))}}var t=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(!1);return function(t){for(var n,i=this.createBookmark(),a=this[t?"endPath":"startPath"](),r=a.block||a.blockLimit;r&&!r.equals(a.root)&&!r.getFirst(e(r));)n=r.getParent(),this[t?"setEndAt":"setStartAt"](r,CKEDITOR.POSITION_AFTER_END),r.remove(1),r=n;this.moveToBookmark(i)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,this.root)},checkBoundaryOfElement:function(e,t){var n=t==CKEDITOR.START,i=this.clone();return i.collapse(n),i[n?"setStartAt":"setEndAt"](e,n?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),(i=new CKEDITOR.dom.walker(i)).evaluator=function(e){var t=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(1);return function(i){return!(!n(i)&&!t(i))||!e&&r(i)||i.type==CKEDITOR.NODE_ELEMENT&&i.is(CKEDITOR.dtd.$removeEmpty)}}(n),i[n?"checkBackward":"checkForward"]()},checkStartOfBlock:function(e){var t=this.startContainer,i=this.startOffset;return CKEDITOR.env.ie&&i&&t.type==CKEDITOR.NODE_TEXT&&(t=CKEDITOR.tools.ltrim(t.substring(0,i)),o.test(t)&&this.trim(0,1)),e||this.trim(),e=new CKEDITOR.dom.elementPath(this.startContainer,this.root),(t=this.clone()).collapse(!0),t.setStartAt(e.block||e.blockLimit,CKEDITOR.POSITION_AFTER_START),(e=new CKEDITOR.dom.walker(t)).evaluator=n(),e.checkBackward()},checkEndOfBlock:function(e){var t=this.endContainer,i=this.endOffset;return CKEDITOR.env.ie&&t.type==CKEDITOR.NODE_TEXT&&(t=CKEDITOR.tools.rtrim(t.substring(i)),o.test(t)&&this.trim(1,0)),e||this.trim(),e=new CKEDITOR.dom.elementPath(this.endContainer,this.root),(t=this.clone()).collapse(!1),t.setEndAt(e.block||e.blockLimit,CKEDITOR.POSITION_BEFORE_END),(e=new CKEDITOR.dom.walker(t)).evaluator=n(),e.checkForward()},getPreviousNode:function(e,t,n){var i=this.clone();return i.collapse(1),i.setStartAt(n||this.root,CKEDITOR.POSITION_AFTER_START),(n=new CKEDITOR.dom.walker(i)).evaluator=e,n.guard=t,n.previous()},getNextNode:function(e,t,n){var i=this.clone();return i.collapse(),i.setEndAt(n||this.root,CKEDITOR.POSITION_BEFORE_END),(n=new CKEDITOR.dom.walker(i)).evaluator=e,n.guard=t,n.next()},checkReadOnly:function(){function e(e,t){for(;e;){if(e.type==CKEDITOR.NODE_ELEMENT){if("false"==e.getAttribute("contentEditable")&&!e.data("cke-editable"))return 0;if(e.is("html")||"true"==e.getAttribute("contentEditable")&&(e.contains(t)||e.equals(t)))break}e=e.getParent()}return 1}return function(){var t=this.startContainer,n=this.endContainer;return!(e(t,n)&&e(n,t))}}(),moveToElementEditablePosition:function(e,t){if(e.type==CKEDITOR.NODE_ELEMENT&&!e.isEditable(!1))return this.moveToPosition(e,t?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),!0;for(var n=0;e;){if(e.type==CKEDITOR.NODE_TEXT){t&&this.endContainer&&this.checkEndOfBlock()&&o.test(e.getText())?this.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(e,t?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),n=1;break}if(e.type==CKEDITOR.NODE_ELEMENT)if(e.isEditable())this.moveToPosition(e,t?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START),n=1;else if(t&&e.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START);else if("false"==e.getAttribute("contenteditable")&&e.is(CKEDITOR.dtd.$block))return this.setStartBefore(e),this.setEndAfter(e),!0;var i=e,a=n,r=void 0;i.type==CKEDITOR.NODE_ELEMENT&&i.isEditable(!1)&&(r=i[t?"getLast":"getFirst"](l)),a||r||(r=i[t?"getPrevious":"getNext"](l)),e=r}return!!n},moveToClosestEditablePosition:function(e,t){var n,i,a,r=0,o=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];return e?(n=new CKEDITOR.dom.range(this.root)).moveToPosition(e,o[t?0:1]):n=this.clone(),e&&!e.is(CKEDITOR.dtd.$block)?r=1:(i=n[t?"getNextEditableNode":"getPreviousEditableNode"]())&&(r=1,(a=i.type==CKEDITOR.NODE_ELEMENT)&&i.is(CKEDITOR.dtd.$block)&&"false"==i.getAttribute("contenteditable")?(n.setStartAt(i,CKEDITOR.POSITION_BEFORE_START),n.setEndAt(i,CKEDITOR.POSITION_AFTER_END)):!CKEDITOR.env.needsBrFiller&&a&&i.is(CKEDITOR.dom.walker.validEmptyBlockContainers)?(n.setEnd(i,0),n.collapse()):n.moveToPosition(i,o[t?1:0])),r&&this.moveToRange(n),!!r},moveToElementEditStart:function(e){return this.moveToElementEditablePosition(e)},moveToElementEditEnd:function(e){return this.moveToElementEditablePosition(e,!0)},getEnclosedNode:function(){if((e=this.clone()).optimize(),e.startContainer.type!=CKEDITOR.NODE_ELEMENT||e.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var e=new CKEDITOR.dom.walker(e),t=CKEDITOR.dom.walker.bookmark(!1,!0),n=CKEDITOR.dom.walker.whitespaces(!0);e.evaluator=function(e){return n(e)&&t(e)};var i=e.next();return e.reset(),i&&i.equals(e.previous())?i:null},getTouchedStartNode:function(){var e=this.startContainer;return this.collapsed||e.type!=CKEDITOR.NODE_ELEMENT?e:e.getChild(this.startOffset)||e},getTouchedEndNode:function(){var e=this.endContainer;return this.collapsed||e.type!=CKEDITOR.NODE_ELEMENT?e:e.getChild(this.endOffset-1)||e},getNextEditableNode:i(),getPreviousEditableNode:i(1),_getTableElement:function(e){e=e||{td:1,th:1,tr:1,tbody:1,thead:1,tfoot:1,table:1};var t=this.getTouchedStartNode(),n=this.getTouchedEndNode(),i=t.getAscendant("table",!0);return n=n.getAscendant("table",!0),i&&!this.root.contains(i)?null:this.getEnclosedNode()?this.getEnclosedNode().getAscendant(e,!0):i&&n&&(i.equals(n)||i.contains(n)||n.contains(i))?t.getAscendant(e,!0):null},scrollIntoView:function(){var e,t,n,i=new CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",this.document),a=this.clone();a.optimize(),(n=a.startContainer.type==CKEDITOR.NODE_TEXT)?(t=a.startContainer.getText(),e=a.startContainer.split(a.startOffset),i.insertAfter(a.startContainer)):a.insertNode(i),i.scrollIntoView(),n&&(a.startContainer.setText(t),e.remove()),i.remove()},getClientRects:function(){function e(e,t,i){var a;return t.collapsed?i.startContainer instanceof CKEDITOR.dom.element?(e=i.checkStartOfBlock(),a=new CKEDITOR.dom.text("​"),e?i.startContainer.append(a,!0):0===i.startOffset?a.insertBefore(i.startContainer.getFirst()):(i=i.startContainer.getChildren().getItem(i.startOffset-1),a.insertAfter(i)),t.setStart(a.$,0),t.setEnd(a.$,0),e=t.getClientRects(),a.remove()):i.startContainer instanceof CKEDITOR.dom.text&&(""===i.startContainer.getText()?(i.startContainer.setText("​"),e=t.getClientRects(),i.startContainer.setText("")):e=[n(i.createBookmark())]):e=[n(i.createBookmark())],e}function t(e,t,n){return e=CKEDITOR.tools.extend({},e),t&&(e=CKEDITOR.tools.getAbsoluteRectPosition(n.document.getWindow(),e)),!e.width&&(e.width=e.right-e.left),!e.height&&(e.height=e.bottom-e.top),e}function n(e){var t,n=e.startNode;return e=e.endNode,n.setText("​"),n.removeStyle("display"),e?(e.setText("​"),e.removeStyle("display"),t=[n.getClientRect(),e.getClientRect()],e.remove()):t=[n.getClientRect(),n.getClientRect()],n.remove(),{right:Math.max(t[0].right,t[1].right),bottom:Math.max(t[0].bottom,t[1].bottom),left:Math.min(t[0].left,t[1].left),top:Math.min(t[0].top,t[1].top),width:Math.abs(t[0].left-t[1].left),height:Math.max(t[0].bottom,t[1].bottom)-Math.min(t[0].top,t[1].top)}}return void 0!==document.getSelection?function(n){var i,a=this.root.getDocument().$.createRange();return a.setStart(this.startContainer.$,this.startOffset),a.setEnd(this.endContainer.$,this.endOffset),i=function(e,t){var n,i,a,r=CKEDITOR.tools.array.map(e,(function(e){return e})),o=new CKEDITOR.dom.range(t.root);if(t.startContainer instanceof CKEDITOR.dom.element&&(i=0===t.startOffset&&t.startContainer.hasAttribute("data-widget")),t.endContainer instanceof CKEDITOR.dom.element&&(a=(a=t.endOffset===(t.endContainer.getChildCount?t.endContainer.getChildCount():t.endContainer.length))&&t.endContainer.hasAttribute("data-widget")),i&&o.setStart(t.startContainer.getParent(),t.startContainer.getIndex()),a&&o.setEnd(t.endContainer.getParent(),t.endContainer.getIndex()+1),(i||a)&&(t=o),o=t.cloneContents().find("[data-cke-widget-id]").toArray(),o=CKEDITOR.tools.array.map(o,(function(e){var n=t.root.editor;return e=e.getAttribute("data-cke-widget-id"),n.widgets.instances[e].element})))return o=CKEDITOR.tools.array.map(o,(function(e){var t;return t=e.getParent().hasClass("cke_widget_wrapper")?e.getParent():e,(n=this.root.getDocument().$.createRange()).setStart(t.getParent().$,t.getIndex()),n.setEnd(t.getParent().$,t.getIndex()+1),(t=n.getClientRects()).widgetRect=e.getClientRect(),t}),t),CKEDITOR.tools.array.forEach(o,(function(e){var t;!function n(i){CKEDITOR.tools.array.forEach(r,(function(n,a){var o=CKEDITOR.tools.objectCompare(e[i],n);o||(o=CKEDITOR.tools.objectCompare(e.widgetRect,n)),o&&(Array.prototype.splice.call(r,a,e.length-i,e.widgetRect),t=!0)})),t||(i<r.length-1?n(i+1):r.push(e.widgetRect))}(0)})),r}(i=a.getClientRects(),this),i.length||(i=e(i,a,this)),CKEDITOR.tools.array.map(i,(function(e){return t(e,n,this)}),this)}:function(e){return[t(n(this.createBookmark()),e,this)]}}(),_setStartContainer:function(e){this.startContainer=e},_setEndContainer:function(e){this.endContainer=e},_find:function(e,t){var n,i,a,r,o=this.getCommonAncestor(),s=this.getBoundaryNodes(),l=[];if(o&&o.find)for(i=o.find(e),n=0;n<i.count();n++)o=i.getItem(n),(t||!o.isReadOnly())&&(a=o.getPosition(s.startNode)&CKEDITOR.POSITION_FOLLOWING||s.startNode.equals(o),r=o.getPosition(s.endNode)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_IS_CONTAINED||s.endNode.equals(o),a&&r&&l.push(o));return l}},CKEDITOR.dom.range.mergeRanges=function(e){return CKEDITOR.tools.array.reduce(e,(function(e,t){var n=e[e.length-1],i=!1;if((t=t.clone()).enlarge(CKEDITOR.ENLARGE_ELEMENT),n){var a=new CKEDITOR.dom.range(t.root),r=(i=new CKEDITOR.dom.walker(a),CKEDITOR.dom.walker.whitespaces());for(a.setStart(n.endContainer,n.endOffset),a.setEnd(t.startContainer,t.startOffset),a=i.next();r(a)||t.endContainer.equals(a);)a=i.next();i=!a}return i?n.setEnd(t.endContainer,t.endOffset):e.push(t),e}),[])}}(),CKEDITOR.POSITION_AFTER_START=1,CKEDITOR.POSITION_BEFORE_END=2,CKEDITOR.POSITION_BEFORE_START=3,CKEDITOR.POSITION_AFTER_END=4,CKEDITOR.ENLARGE_ELEMENT=1,CKEDITOR.ENLARGE_BLOCK_CONTENTS=2,CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3,CKEDITOR.ENLARGE_INLINE=4,CKEDITOR.START=1,CKEDITOR.END=2,CKEDITOR.SHRINK_ELEMENT=1,CKEDITOR.SHRINK_TEXT=2,function(){function e(e){1>arguments.length||(this.range=e,this.forceBrBreak=0,this.enlargeBr=1,this.enforceRealBlocks=0,this._||(this._={}))}function t(e,n,i,a){e:{null==a&&(a=function(e){var t=[];return e.forEach((function(e){if("true"==e.getAttribute("contenteditable"))return t.push(e),!1}),CKEDITOR.NODE_ELEMENT,!0),t}(i));for(var r;r=a.shift();)if(r.getDtd().p){a={element:r,remaining:a};break e}a=null}return a?(r=CKEDITOR.filter.instances[a.element.data("cke-filter")])&&!r.check(n)?t(e,n,i,a.remaining):((n=new CKEDITOR.dom.range(a.element)).selectNodeContents(a.element),(n=n.createIterator()).enlargeBr=e.enlargeBr,n.enforceRealBlocks=e.enforceRealBlocks,n.activeFilter=n.filter=r,e._.nestedEditable={element:a.element,container:i,remaining:a.remaining,iterator:n},1):0}function n(e,t,n){return!!t&&((e=e.clone()).collapse(!n),e.checkBoundaryOfElement(t,n?CKEDITOR.START:CKEDITOR.END))}var i=/^[\r\n\t ]+$/,a=CKEDITOR.dom.walker.bookmark(!1,!0),r=CKEDITOR.dom.walker.whitespaces(!0),o=function(e){return a(e)&&r(e)},s={dd:1,dt:1,li:1};e.prototype={getNextParagraph:function(e){var r,l,d,c,u;if(e=e||"p",this._.nestedEditable){if(r=this._.nestedEditable.iterator.getNextParagraph(e))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,r;if(this.activeFilter=this.filter,t(this,e,this._.nestedEditable.container,this._.nestedEditable.remaining))return this.activeFilter=this._.nestedEditable.iterator.activeFilter,this._.nestedEditable.iterator.getNextParagraph(e);this._.nestedEditable=null}if(!this.range.root.getDtd()[e])return null;if(!this._.started){var f=this.range.clone();l=f.startPath();var h=f.endPath(),p=!f.collapsed&&n(f,l.block),g=!f.collapsed&&n(f,h.block,1);f.shrink(CKEDITOR.SHRINK_ELEMENT,!0),p&&f.setStartAt(l.block,CKEDITOR.POSITION_BEFORE_END),g&&f.setEndAt(h.block,CKEDITOR.POSITION_AFTER_START),l=f.endContainer.hasAscendant("pre",!0)||f.startContainer.hasAscendant("pre",!0),f.enlarge(this.forceBrBreak&&!l||!this.enlargeBr?CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:CKEDITOR.ENLARGE_BLOCK_CONTENTS),f.collapsed||(l=new CKEDITOR.dom.walker(f.clone()),h=CKEDITOR.dom.walker.bookmark(!0,!0),l.evaluator=h,this._.nextNode=l.next(),(l=new CKEDITOR.dom.walker(f.clone())).evaluator=h,l=l.previous(),this._.lastNode=l.getNextSourceNode(!0,null,f.root),this._.lastNode&&this._.lastNode.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(this._.lastNode.getText())&&this._.lastNode.getParent().isBlockBoundary()&&((h=this.range.clone()).moveToPosition(this._.lastNode,CKEDITOR.POSITION_AFTER_END),h.checkEndOfBlock()&&(h=new CKEDITOR.dom.elementPath(h.endContainer,h.root),this._.lastNode=(h.block||h.blockLimit).getNextSourceNode(!0))),this._.lastNode&&f.root.contains(this._.lastNode)||(this._.lastNode=this._.docEndMarker=f.document.createText(""),this._.lastNode.insertAfter(l)),f=null),this._.started=1,l=f}for(h=this._.nextNode,f=this._.lastNode,this._.nextNode=null;h;){p=0,g=h.hasAscendant("pre");var m=h.type!=CKEDITOR.NODE_ELEMENT,v=0;if(m)h.type==CKEDITOR.NODE_TEXT&&i.test(h.getText())&&(m=0);else{var E=h.getName();if(CKEDITOR.dtd.$block[E]&&"false"==h.getAttribute("contenteditable")){t(this,e,r=h);break}if(h.isBlockBoundary(this.forceBrBreak&&!g&&{br:1})){if("br"==E)m=1;else if(!l&&!h.getChildCount()&&"hr"!=E){r=h,d=h.equals(f);break}l&&(l.setEndAt(h,CKEDITOR.POSITION_BEFORE_START),"br"!=E&&(this._.nextNode=h)),p=1}else{if(h.getFirst()){l||(l=this.range.clone()).setStartAt(h,CKEDITOR.POSITION_BEFORE_START),h=h.getFirst();continue}m=1}}if(m&&!l&&(l=this.range.clone()).setStartAt(h,CKEDITOR.POSITION_BEFORE_START),d=(!p||m)&&h.equals(f),l&&!p)for(;!h.getNext(o)&&!d;){if((E=h.getParent()).isBlockBoundary(this.forceBrBreak&&!g&&{br:1})){p=1,m=0,d||E.equals(f),l.setEndAt(E,CKEDITOR.POSITION_BEFORE_END);break}m=1,d=(h=E).equals(f),v=1}if(m&&l.setEndAt(h,CKEDITOR.POSITION_AFTER_END),(d=!(h=this._getNextSourceNode(h,v,f)))||p&&l)break}if(!r){if(!l)return this._.docEndMarker&&this._.docEndMarker.remove(),this._.nextNode=null;h=(r=new CKEDITOR.dom.elementPath(l.startContainer,l.root)).blockLimit,p={div:1,th:1,td:1},!(r=r.block)&&h&&!this.enforceRealBlocks&&p[h.getName()]&&l.checkStartOfBlock()&&l.checkEndOfBlock()&&!h.equals(l.root)?r=h:!r||this.enforceRealBlocks&&r.is(s)?(r=this.range.document.createElement(e),l.extractContents().appendTo(r),r.trim(),l.insertNode(r),c=u=!0):"li"!=r.getName()?l.checkStartOfBlock()&&l.checkEndOfBlock()||(r=r.clone(!1),l.extractContents().appendTo(r),r.trim(),c=!(u=l.splitBlock()).wasStartOfBlock,u=!u.wasEndOfBlock,l.insertNode(r)):d||(this._.nextNode=r.equals(f)?null:this._getNextSourceNode(l.getBoundaryNodes().endNode,1,f))}return c&&(c=r.getPrevious())&&c.type==CKEDITOR.NODE_ELEMENT&&("br"==c.getName()?c.remove():c.getLast()&&"br"==c.getLast().$.nodeName.toLowerCase()&&c.getLast().remove()),u&&(c=r.getLast())&&c.type==CKEDITOR.NODE_ELEMENT&&"br"==c.getName()&&(!CKEDITOR.env.needsBrFiller||c.getPrevious(a)||c.getNext(a))&&c.remove(),this._.nextNode||(this._.nextNode=d||r.equals(f)||!f?null:this._getNextSourceNode(r,1,f)),r},_getNextSourceNode:function(e,t,n){function i(e){return!(e.equals(n)||e.equals(r))}var r=this.range.root;for(e=e.getNextSourceNode(t,null,i);!a(e);)e=e.getNextSourceNode(t,null,i);return e}},CKEDITOR.dom.range.prototype.createIterator=function(){return new e(this)}}(),CKEDITOR.command=function(e,t){var n;this.uiItems=[],this.exec=function(n){return!(this.state==CKEDITOR.TRISTATE_DISABLED||!this.checkAllowed())&&(this.editorFocus&&e.focus(),!1===this.fire("exec")||!1!==t.exec.call(this,e,n))},this.refresh=function(e,n){return!(this.readOnly||!e.readOnly)||(this.context&&!n.isContextFor(this.context)||!this.checkAllowed(!0)?(this.disable(),!0):(this.startDisabled||this.enable(),this.modes&&!this.modes[e.mode]&&this.disable(),!1===this.fire("refresh",{editor:e,path:n})||t.refresh&&!1!==t.refresh.apply(this,arguments)))},this.checkAllowed=function(t){return t||"boolean"!=typeof n?n=e.activeFilter.checkFeature(this):n},CKEDITOR.tools.extend(this,t,{modes:{wysiwyg:1},editorFocus:1,contextSensitive:!!t.context,state:CKEDITOR.TRISTATE_DISABLED}),CKEDITOR.event.call(this)},CKEDITOR.command.prototype={enable:function(){this.state==CKEDITOR.TRISTATE_DISABLED&&this.checkAllowed()&&this.setState(this.preserveState&&void 0!==this.previousState?this.previousState:CKEDITOR.TRISTATE_OFF)},disable:function(){this.setState(CKEDITOR.TRISTATE_DISABLED)},setState:function(e){return!(this.state==e||e!=CKEDITOR.TRISTATE_DISABLED&&!this.checkAllowed()||(this.previousState=this.state,this.state=e,this.fire("state"),0))},toggleState:function(){this.state==CKEDITOR.TRISTATE_OFF?this.setState(CKEDITOR.TRISTATE_ON):this.state==CKEDITOR.TRISTATE_ON&&this.setState(CKEDITOR.TRISTATE_OFF)}},CKEDITOR.event.implementOn(CKEDITOR.command.prototype),CKEDITOR.ENTER_P=1,CKEDITOR.ENTER_BR=2,CKEDITOR.ENTER_DIV=3,CKEDITOR.config={customConfig:"config.js",autoUpdateElement:!0,language:"",defaultLanguage:"en",contentsLangDirection:"",enterMode:CKEDITOR.ENTER_P,forceEnterMode:!1,shiftEnterMode:CKEDITOR.ENTER_BR,docType:"<!DOCTYPE html>",bodyId:"",bodyClass:"",fullPage:!1,height:200,contentsCss:CKEDITOR.getUrl("contents.css"),extraPlugins:"",removePlugins:"",protectedSource:[],tabIndex:0,useComputedState:!0,width:"",baseFloatZIndex:1e4,blockedKeystrokes:[CKEDITOR.CTRL+66,CKEDITOR.CTRL+73,CKEDITOR.CTRL+85]},function(){function e(e,t,n,i,a){var r,s,l;for(r in e=[],t){s="boolean"==typeof(s=t[r])?{}:"function"==typeof s?{match:s}:R(s),"$"!=r.charAt(0)&&(s.elements=r),n&&(s.featureName=n.toLowerCase());var d=s;d.elements=o(d.elements,/\s+/)||null,d.propertiesOnly=d.propertiesOnly||!0===d.elements;var c=/\s*,\s*/,u=void 0;for(u in k){d[u]=o(d[u],c)||null;var f=d,h=K[u],p=o(d[K[u]],c),g=d[u],v=[],E=!0,T=void 0;for(T in p?E=!1:p={},g)"!"==T.charAt(0)&&(T=T.slice(1),v.push(T),p[T]=!0,E=!1);for(;T=v.pop();)g[T]=g["!"+T],delete g["!"+T];f[h]=!E&&p||null}d.match=d.match||null,i.push(s),e.push(s)}for(t=a.elements,a=a.generic,n=0,i=e.length;n<i;++n){for(c in s=!0===(r=R(e[n])).classes||!0===r.styles||!0===r.attributes,d=r,u=h=c=void 0,k)d[c]=m(d[c]);for(u in f=!0,K){for(g in p=[],g=void 0,h=d[c=K[u]])-1<g.indexOf("*")?p.push(new RegExp("^"+g.replace(/\*/g,".*")+"$")):p.push(g);(h=p).length&&(d[c]=h,f=!1)}if(d.nothingRequired=f,d.noProperties=!(d.attributes||d.classes||d.styles),!0===r.elements||null===r.elements)a[s?"unshift":"push"](r);else for(l in d=r.elements,delete r.elements,d)t[l]?t[l][s?"unshift":"push"](r):t[l]=[r]}}function t(e,t,i,a){if((!e.match||e.match(t))&&(a||s(e,t))&&(e.propertiesOnly||(i.valid=!0),i.allAttributes||(i.allAttributes=n(e.attributes,t.attributes,i.validAttributes)),i.allStyles||(i.allStyles=n(e.styles,t.styles,i.validStyles)),!i.allClasses)){if(e=e.classes,t=t.classes,a=i.validClasses,e)if(!0===e)e=!0;else{for(var r,o=0,l=t.length;o<l;++o)a[r=t[o]]||(a[r]=e(r));e=!1}else e=!1;i.allClasses=e}}function n(e,t,n){if(!e)return!1;if(!0===e)return!0;for(var i in t)n[i]||(n[i]=e(i));return!1}function i(e,t,n){if(!e.match||e.match(t)){if(e.noProperties)return!1;if(n.hadInvalidAttribute=a(e.attributes,t.attributes)||n.hadInvalidAttribute,n.hadInvalidStyle=a(e.styles,t.styles)||n.hadInvalidStyle,e=e.classes,t=t.classes,e){for(var i=!1,r=!0===e,o=t.length;o--;)(r||e(t[o]))&&(t.splice(o,1),i=!0);e=i}else e=!1;n.hadInvalidClass=e||n.hadInvalidClass}}function a(e,t){if(!e)return!1;var n,i=!1,a=!0===e;for(n in t)(a||e(n))&&(delete t[n],i=!0);return i}function r(e,t,n){return!(e.disabled||e.customConfig&&!n||!t||(e._.cachedChecks={},0))}function o(e,t){if(!e)return!1;if(!0===e)return e;if("string"==typeof e)return"*"==(e=_(e))||CKEDITOR.tools.convertArrayToObject(e.split(t));if(CKEDITOR.tools.isArray(e))return!!e.length&&CKEDITOR.tools.convertArrayToObject(e);var n,i={},a=0;for(n in e)i[n]=e[n],a++;return!!a&&i}function s(e,t){if(e.nothingRequired)return!0;var n,i,a,r;if(a=e.requiredClasses)for(r=t.classes,n=0;n<a.length;++n)if("string"==typeof(i=a[n])){if(-1==CKEDITOR.tools.indexOf(r,i))return!1}else if(!CKEDITOR.tools.checkIfAnyArrayItemMatches(r,i))return!1;return l(t.styles,e.requiredStyles)&&l(t.attributes,e.requiredAttributes)}function l(e,t){if(!t)return!0;for(var n,i=0;i<t.length;++i)if("string"==typeof(n=t[i])){if(!(n in e))return!1}else if(!CKEDITOR.tools.checkIfAnyObjectPropertyMatches(e,n))return!1;return!0}function d(e){if(!e)return{};e=e.split(/\s*,\s*/).sort();for(var t={};e.length;)t[e.shift()]="cke-test";return t}function c(e){var t,n,i,a,r={},o=1;for(e=_(e);t=e.match(N);)(n=t[2])?(i=u(n,"styles"),a=u(n,"attrs"),n=u(n,"classes")):i=a=n=null,r["$"+o++]={elements:t[1],classes:n,styles:i,attributes:a},e=e.slice(t[0].length);return r}function u(e,t){var n=e.match(S[t]);return n?_(n[1]):null}function f(e){var t=e.styleBackup=e.attributes.style,n=e.classBackup=e.attributes.class;e.styles||(e.styles=CKEDITOR.tools.parseCssText(t||"",1)),e.classes||(e.classes=n?n.split(/\s+/):[])}function h(e,n,a,r){var o,s=0;if(r.toHtml&&(n.name=n.name.replace(A,"$1")),r.doCallbacks&&e.elementCallbacks){e:{for(var l,d=0,c=(o=e.elementCallbacks).length;d<c;++d)if(l=o[d](n)){o=l;break e}o=void 0}if(o)return o}if(r.doTransform&&(o=e._.transformations[n.name])){for(f(n),d=0;d<o.length;++d)C(e,n,o[d]);p(n)}if(r.doFilter){e:{d=n.name,e=(c=e._).allowedRules.elements[d],o=c.allowedRules.generic,d=c.disallowedRules.elements[d],c=c.disallowedRules.generic,l=r.skipRequired;var u,h,m={valid:!1,validAttributes:{},validClasses:{},validStyles:{},allAttributes:!1,allClasses:!1,allStyles:!1,hadInvalidAttribute:!1,hadInvalidClass:!1,hadInvalidStyle:!1};if(e||o){if(f(n),d)for(u=0,h=d.length;u<h;++u)if(!1===i(d[u],n,m)){e=null;break e}if(c)for(u=0,h=c.length;u<h;++u)i(c[u],n,m);if(e)for(u=0,h=e.length;u<h;++u)t(e[u],n,m,l);if(o)for(u=0,h=o.length;u<h;++u)t(o[u],n,m,l);e=m}else e=null}if(!e||!e.valid)return a.push(n),1;h=e.validAttributes;var v=e.validStyles;o=e.validClasses,d=n.attributes;var E=n.styles;c=n.classes,l=n.classBackup;var T,I,b=n.styleBackup,y=[],D=(m=[],/^data-cke-/);if(u=!1,delete d.style,delete d.class,delete n.classBackup,delete n.styleBackup,!e.allAttributes)for(T in d)h[T]||D.test(T)&&(T==(I=T.replace(/^data-cke-saved-/,""))||h[I])||(delete d[T],u=!0);if(!e.allStyles||e.hadInvalidStyle){for(T in E)e.allStyles||v[T]?y.push(T+":"+E[T]):u=!0;y.length&&(d.style=y.sort().join("; "))}else b&&(d.style=b);if(!e.allClasses||e.hadInvalidClass){for(T=0;T<c.length;++T)(e.allClasses||o[c[T]])&&m.push(c[T]);m.length&&(d.class=m.sort().join(" ")),l&&m.length<l.split(/\s+/).length&&(u=!0)}else l&&(d.class=l);if(u&&(s=1),!r.skipFinalValidation&&!g(n))return a.push(n),1}return r.toHtml&&(n.name=n.name.replace(M,"cke:$1")),s}function p(e){var t,n=e.attributes;delete n.style,delete n.class,(t=CKEDITOR.tools.writeCssText(e.styles,!0))&&(n.style=t),e.classes.length&&(n.class=e.classes.sort().join(" "))}function g(e){switch(e.name){case"a":if(!(e.children.length||e.attributes.name||e.attributes.id))return!1;break;case"img":if(!e.attributes.src)return!1}return!0}function m(e){if(!e)return!1;if(!0===e)return!0;var t=function(e){var t,n=[];for(t in e)-1<t.indexOf("*")&&n.push(t.replace(/\*/g,".*"));return n.length?new RegExp("^(?:"+n.join("|")+")$"):null}(e);return function(n){return n in e||t&&n.match(t)}}function v(){return new CKEDITOR.htmlParser.element("br")}function E(e){return e.type==CKEDITOR.NODE_ELEMENT&&("br"==e.name||O.$block[e.name])}function T(e,t,n){var i=e.name;if(O.$empty[i]||!e.children.length)"hr"==i&&"br"==t?e.replaceWith(v()):(e.parent&&n.push({check:"it",el:e.parent}),e.remove());else if(O.$block[i]||"tr"==i)if("br"==t)e.previous&&!E(e.previous)&&(t=v()).insertBefore(e),e.next&&!E(e.next)&&(t=v()).insertAfter(e),e.replaceWithChildren();else{var a;i=e.children;e:{a=O[t];for(var r,o=0,s=i.length;o<s;++o)if((r=i[o]).type==CKEDITOR.NODE_ELEMENT&&!a[r.name]){a=!1;break e}a=!0}if(a)e.name=t,e.attributes={},n.push({check:"parent-down",el:e});else{var l,d;for(o=(a=e.parent).type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||"body"==a.name,s=i.length;0<s;)r=i[--s],o&&(r.type==CKEDITOR.NODE_TEXT||r.type==CKEDITOR.NODE_ELEMENT&&O.$inline[r.name])?(l||((l=new CKEDITOR.htmlParser.element(t)).insertAfter(e),n.push({check:"parent-down",el:l})),l.add(r,0)):(l=null,d=O[a.name]||O.span,r.insertAfter(e),a.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||r.type!=CKEDITOR.NODE_ELEMENT||d[r.name]||n.push({check:"el-up",el:r}));e.remove()}}else i in{style:1,script:1}?e.remove():(e.parent&&n.push({check:"it",el:e.parent}),e.replaceWithChildren())}function C(e,t,n){var i,a;for(i=0;i<n.length;++i)if(!((a=n[i]).check&&!e.check(a.check,!1)||a.left&&!a.left(t))){a.right(t,w);break}}function I(e,t){var n,i,a,r,o=t.getDefinition(),s=o.attributes,l=o.styles;if(e.name!=o.element)return!1;for(n in s)if("class"==n){for(o=s[n].split(/\s+/),a=e.classes.join("|");r=o.pop();)if(-1==a.indexOf(r))return!1}else if(e.attributes[n]!=s[n])return!1;for(i in l)if(e.styles[i]!=l[i])return!1;return!0}function b(e,t){var n,i;return"string"==typeof e?n=e:e instanceof CKEDITOR.style?i=e:(n=e[0],i=e[1]),[{element:n,left:i,right:function(e,n){n.transform(e,t)}}]}function y(e){return function(t){return I(t,e)}}function D(e){return function(t,n){n[e](t)}}var O=CKEDITOR.dtd,R=CKEDITOR.tools.copy,_=CKEDITOR.tools.trim,x=["","p","br","div"];CKEDITOR.FILTER_SKIP_TREE=2,CKEDITOR.filter=function(e,t){this.allowedContent=[],this.disallowedContent=[],this.elementCallbacks=null,this.disabled=!1,this.editor=null,this.id=CKEDITOR.tools.getNextNumber(),this._={allowedRules:{elements:{},generic:[]},disallowedRules:{elements:{},generic:[]},transformations:{},cachedTests:{},cachedChecks:{}},CKEDITOR.filter.instances[this.id]=this;var n=this.editor=e instanceof CKEDITOR.editor?e:null;if(n&&!t){this.customConfig=!0;var i=n.config.allowedContent;!0===i?this.disabled=!0:(i||(this.customConfig=!1),this.allow(i,"config",1),this.allow(n.config.extraAllowedContent,"extra",1),this.allow(x[n.enterMode]+" "+x[n.shiftEnterMode],"default",1),this.disallow(n.config.disallowedContent))}else this.customConfig=!1,this.allow(t||e,"default",1)},CKEDITOR.filter.instances={},CKEDITOR.filter.prototype={allow:function(t,n,i){if(!r(this,t,i))return!1;var a,o;if("string"==typeof t)t=c(t);else if(t instanceof CKEDITOR.style){if(t.toAllowedContentRules)return this.allow(t.toAllowedContentRules(this.editor),n,i);a=t.getDefinition(),t={},i=a.attributes,t[a.element]=a={styles:a.styles,requiredStyles:a.styles&&CKEDITOR.tools.object.keys(a.styles)},i&&(i=R(i),a.classes=i.class?i.class.split(/\s+/):null,a.requiredClasses=a.classes,delete i.class,a.attributes=i,a.requiredAttributes=i&&CKEDITOR.tools.object.keys(i))}else if(CKEDITOR.tools.isArray(t)){for(a=0;a<t.length;++a)o=this.allow(t[a],n,i);return o}return e(this,t,n,this.allowedContent,this._.allowedRules),!0},applyTo:function(e,t,n,i){if(this.disabled)return!1;var a,r,o,s=this,l=[],d=this.editor&&this.editor.config.protectedSource,c=!1,u={doFilter:!n,doTransform:!0,doCallbacks:!0,toHtml:t};for(e.forEach((function(e){if(e.type==CKEDITOR.NODE_ELEMENT){if("off"==e.attributes["data-cke-filter"])return!1;if(!t||"span"!=e.name||!~CKEDITOR.tools.object.keys(e.attributes).join("|").indexOf("data-cke-"))if(1&(a=h(s,e,l,u)))c=!0;else if(2&a)return!1}else if(e.type==CKEDITOR.NODE_COMMENT&&e.value.match(/^\{cke_protected\}(?!\{C\})/)){var n;e:{var i,r,o,f=decodeURIComponent(e.value.replace(/^\{cke_protected\}/,""));if(n=[],d)for(r=0;r<d.length;++r)if((o=f.match(d[r]))&&o[0].length==f.length){n=!0;break e}1==(f=CKEDITOR.htmlParser.fragment.fromHtml(f)).children.length&&(i=f.children[0]).type==CKEDITOR.NODE_ELEMENT&&h(s,i,n,u),n=!n.length}n||l.push(e)}}),null,!0),l.length&&(c=!0),e=[],i=x[i||(this.editor?this.editor.enterMode:CKEDITOR.ENTER_P)];n=l.pop();)n.type==CKEDITOR.NODE_ELEMENT?T(n,i,e):n.remove();for(;r=e.pop();)if((n=r.el).parent)switch(o=O[n.parent.name]||O.span,r.check){case"it":O.$removeEmpty[n.name]&&!n.children.length?T(n,i,e):g(n)||T(n,i,e);break;case"el-up":n.parent.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||o[n.name]||T(n,i,e);break;case"parent-down":n.parent.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||o[n.name]||T(n.parent,i,e)}return c},checkFeature:function(e){return!(!this.disabled&&e)||(e.toFeature&&(e=e.toFeature(this.editor)),!e.requiredContent||this.check(e.requiredContent))},disable:function(){this.disabled=!0},disallow:function(t){return!!r(this,t,!0)&&("string"==typeof t&&(t=c(t)),e(this,t,null,this.disallowedContent,this._.disallowedRules),!0)},addContentForms:function(e){if(!this.disabled&&e){var t,n,i,a=[];for(t=0;t<e.length&&!i;++t)("string"==typeof(n=e[t])||n instanceof CKEDITOR.style)&&this.check(n)&&(i=n);if(i){for(t=0;t<e.length;++t)a.push(b(e[t],i));this.addTransformations(a)}}},addElementCallback:function(e){this.elementCallbacks||(this.elementCallbacks=[]),this.elementCallbacks.push(e)},addFeature:function(e){return!(!this.disabled&&e)||(e.toFeature&&(e=e.toFeature(this.editor)),this.allow(e.allowedContent,e.name),this.addTransformations(e.contentTransformations),this.addContentForms(e.contentForms),!e.requiredContent||!this.customConfig&&!this.disallowedContent.length||this.check(e.requiredContent))},addTransformations:function(e){var t,n;if(!this.disabled&&e){var i,a=this._.transformations;for(i=0;i<e.length;++i){t=e[i];var r=void 0,o=void 0,s=void 0,l=void 0,d=void 0,c=void 0;for(n=[],o=0;o<t.length;++o)"string"==typeof(s=t[o])?(l=(s=s.split(/\s*:\s*/))[0],d=null,c=s[1]):(l=s.check,d=s.left,c=s.right),r||(r=(r=s).element?r.element:l?l.match(/^([a-z0-9]+)/i)[0]:r.left.getDefinition().element),d instanceof CKEDITOR.style&&(d=y(d)),n.push({check:l==r?null:l,left:d,right:"string"==typeof c?D(c):c});a[t=r]||(a[t]=[]),a[t].push(n)}}},check:function(e,t,n){if(this.disabled)return!0;if(CKEDITOR.tools.isArray(e)){for(var i=e.length;i--;)if(this.check(e[i],t,n))return!0;return!1}var a,r;if("string"==typeof e){if((r=e+"<"+(!1===t?"0":"1")+(n?"1":"0")+">")in this._.cachedChecks)return this._.cachedChecks[r];var o=(a=c(e).$1).styles;i=a.classes,a.name=a.elements,a.classes=i=i?i.split(/\s*,\s*/):[],a.styles=d(o),a.attributes=d(a.attributes),a.children=[],i.length&&(a.attributes.class=i.join(" ")),o&&(a.attributes.style=CKEDITOR.tools.writeCssText(a.styles))}else o=(a=e.getDefinition()).styles,i=a.attributes||{},o&&!CKEDITOR.tools.isEmpty(o)?(o=R(o),i.style=CKEDITOR.tools.writeCssText(o,!0)):o={},a={name:a.element,attributes:i,classes:i.class?i.class.split(/\s+/):[],styles:o,children:[]};o=CKEDITOR.tools.clone(a);var s,l=[];if(!1!==t&&(s=this._.transformations[a.name])){for(i=0;i<s.length;++i)C(this,a,s[i]);p(a)}return h(this,o,l,{doFilter:!0,doTransform:!1!==t,skipRequired:!n,skipFinalValidation:!n}),0<l.length?n=!1:((t=a.attributes.class)&&(a.attributes.class=a.attributes.class.split(" ").sort().join(" ")),n=CKEDITOR.tools.objectCompare(a.attributes,o.attributes,!0),t&&(a.attributes.class=t)),"string"==typeof e&&(this._.cachedChecks[r]=n),n},getAllowedEnterMode:function(){var e=["p","div","br"],t={p:CKEDITOR.ENTER_P,div:CKEDITOR.ENTER_DIV,br:CKEDITOR.ENTER_BR};return function(n,i){var a,r=e.slice();if(this.check(x[n]))return n;for(i||(r=r.reverse());a=r.pop();)if(this.check(a))return t[a];return CKEDITOR.ENTER_BR}}(),clone:function(){var e=new CKEDITOR.filter,t=CKEDITOR.tools.clone;return e.allowedContent=t(this.allowedContent),e._.allowedRules=t(this._.allowedRules),e.disallowedContent=t(this.disallowedContent),e._.disallowedRules=t(this._.disallowedRules),e._.transformations=t(this._.transformations),e.disabled=this.disabled,e.editor=this.editor,e},destroy:function(){delete CKEDITOR.filter.instances[this.id],delete this._,delete this.allowedContent,delete this.disallowedContent}};var w,k={styles:1,attributes:1,classes:1},K={styles:"requiredStyles",attributes:"requiredAttributes",classes:"requiredClasses"},N=/^([a-z0-9\-*\s]+)((?:\s*\{[!\w\-,\s\*]+\}\s*|\s*\[[!\w\-,\s\*]+\]\s*|\s*\([!\w\-,\s\*]+\)\s*){0,3})(?:;\s*|$)/i,S={styles:/{([^}]+)}/,attrs:/\[([^\]]+)\]/,classes:/\(([^\)]+)\)/},A=/^cke:(object|embed|param)$/,M=/^(object|embed|param)$/;w=CKEDITOR.filter.transformationsTools={sizeToStyle:function(e){this.lengthToStyle(e,"width"),this.lengthToStyle(e,"height")},sizeToAttribute:function(e){this.lengthToAttribute(e,"width"),this.lengthToAttribute(e,"height")},lengthToStyle:function(e,t,n){if(!((n=n||t)in e.styles)){var i=e.attributes[t];i&&(/^\d+$/.test(i)&&(i+="px"),e.styles[n]=i)}delete e.attributes[t]},lengthToAttribute:function(e,t,n){if(!((n=n||t)in e.attributes)){var i=e.styles[t],a=i&&i.match(/^(\d+)(?:\.\d*)?px$/);a?e.attributes[n]=a[1]:"cke-test"==i&&(e.attributes[n]="cke-test")}delete e.styles[t]},alignmentToStyle:function(e){if(!("float"in e.styles)){var t=e.attributes.align;"left"!=t&&"right"!=t||(e.styles.float=t)}delete e.attributes.align},alignmentToAttribute:function(e){if(!("align"in e.attributes)){var t=e.styles.float;"left"!=t&&"right"!=t||(e.attributes.align=t)}delete e.styles.float},splitBorderShorthand:function(e){if(e.styles.border){var t=CKEDITOR.tools.style.parse.border(e.styles.border);t.color&&(e.styles["border-color"]=t.color),t.style&&(e.styles["border-style"]=t.style),t.width&&(e.styles["border-width"]=t.width),delete e.styles.border}},listTypeToStyle:function(e){if(e.attributes.type)switch(e.attributes.type){case"a":e.styles["list-style-type"]="lower-alpha";break;case"A":e.styles["list-style-type"]="upper-alpha";break;case"i":e.styles["list-style-type"]="lower-roman";break;case"I":e.styles["list-style-type"]="upper-roman";break;case"1":e.styles["list-style-type"]="decimal";break;default:e.styles["list-style-type"]=e.attributes.type}},splitMarginShorthand:function(e){function t(t){e.styles["margin-top"]=n[t[0]],e.styles["margin-right"]=n[t[1]],e.styles["margin-bottom"]=n[t[2]],e.styles["margin-left"]=n[t[3]]}if(e.styles.margin){var n=e.styles.margin.match(/(auto|0|(?:\-?[\.\d]+(?:\w+|%)))/g)||["0px"];switch(n.length){case 1:t([0,0,0,0]);break;case 2:t([0,1,0,1]);break;case 3:t([0,1,2,1]);break;case 4:t([0,1,2,3])}delete e.styles.margin}},matchesStyle:I,transform:function(e,t){if("string"==typeof t)e.name=t;else{var n,i,a,r,o=t.getDefinition(),s=o.styles,l=o.attributes;for(n in e.name=o.element,l)if("class"==n)for(o=e.classes.join("|"),a=l[n].split(/\s+/);r=a.pop();)-1==o.indexOf(r)&&e.classes.push(r);else e.attributes[n]=l[n];for(i in s)e.styles[i]=s[i]}}}}(),CKEDITOR.focusManager=function(e){return e.focusManager?e.focusManager:(this.hasFocus=!1,this.currentActive=null,this._={editor:e},this)},CKEDITOR.focusManager._={blurDelay:200},CKEDITOR.focusManager.prototype={focus:function(e){this._.timer&&clearTimeout(this._.timer),e&&(this.currentActive=e),this.hasFocus||this._.locked||((e=CKEDITOR.currentInstance)&&e.focusManager.blur(1),this.hasFocus=!0,(e=this._.editor.container)&&e.addClass("cke_focus"),this._.editor.fire("focus"))},lock:function(){this._.locked=1},unlock:function(){delete this._.locked},blur:function(e){function t(){if(this.hasFocus){this.hasFocus=!1;var e=this._.editor.container;e&&e.removeClass("cke_focus"),this._.editor.fire("blur")}}if(!this._.locked){this._.timer&&clearTimeout(this._.timer);var n=CKEDITOR.focusManager._.blurDelay;e||!n?t.call(this):this._.timer=CKEDITOR.tools.setTimeout((function(){delete this._.timer,t.call(this)}),n,this)}},add:function(e,t){if(!(n=e.getCustomData("focusmanager"))||n!=this){n&&n.remove(e);var n="focus",i="blur";t&&(CKEDITOR.env.ie?(n="focusin",i="focusout"):CKEDITOR.event.useCapture=1);var a={blur:function(){e.equals(this.currentActive)&&this.blur()},focus:function(){this.focus(e)}};e.on(n,a.focus,this),e.on(i,a.blur,this),t&&(CKEDITOR.event.useCapture=0),e.setCustomData("focusmanager",this),e.setCustomData("focusmanager_handlers",a)}},remove:function(e){e.removeCustomData("focusmanager");var t=e.removeCustomData("focusmanager_handlers");e.removeListener("blur",t.blur),e.removeListener("focus",t.focus)}},CKEDITOR.keystrokeHandler=function(e){return e.keystrokeHandler?e.keystrokeHandler:(this.keystrokes={},this.blockedKeystrokes={},this._={editor:e},this)},function(){var e,t=function(t){var n=(t=t.data).getKeystroke(),i=this.keystrokes[n],a=this._.editor;return(e=!1===a.fire("key",{keyCode:n,domEvent:t}))||(i&&(e=!1!==a.execCommand(i,{from:"keystrokeHandler"})),e||(e=!!this.blockedKeystrokes[n])),e&&t.preventDefault(!0),!e},n=function(t){e&&(e=!1,t.data.preventDefault(!0))};CKEDITOR.keystrokeHandler.prototype={attach:function(e){e.on("keydown",t,this),CKEDITOR.env.gecko&&CKEDITOR.env.mac&&e.on("keypress",n,this)}}}(),CKEDITOR.lang={languages:{af:1,ar:1,az:1,bg:1,bn:1,bs:1,ca:1,cs:1,cy:1,da:1,de:1,"de-ch":1,el:1,"en-au":1,"en-ca":1,"en-gb":1,en:1,eo:1,es:1,"es-mx":1,et:1,eu:1,fa:1,fi:1,fo:1,"fr-ca":1,fr:1,gl:1,gu:1,he:1,hi:1,hr:1,hu:1,id:1,is:1,it:1,ja:1,ka:1,km:1,ko:1,ku:1,lt:1,lv:1,mk:1,mn:1,ms:1,nb:1,nl:1,no:1,oc:1,pl:1,"pt-br":1,pt:1,ro:1,ru:1,si:1,sk:1,sl:1,sq:1,"sr-latn":1,sr:1,sv:1,th:1,tr:1,tt:1,ug:1,uk:1,vi:1,"zh-cn":1,zh:1},rtl:{ar:1,fa:1,he:1,ku:1,ug:1},load:function(e,t,n){e&&CKEDITOR.lang.languages[e]||(e=this.detect(t,e));var i=this;t=function(){i[e].dir=i.rtl[e]?"rtl":"ltr",n(e,i[e])},this[e]?t():CKEDITOR.scriptLoader.load(CKEDITOR.getUrl("lang/"+e+".js"),t,this)},detect:function(e,t){var n=this.languages,i=(a=(t=t||navigator.userLanguage||navigator.language||e).toLowerCase().match(/([a-z]+)(?:-([a-z]+))?/))[1],a=a[2];return n[i+"-"+a]?i=i+"-"+a:n[i]||(i=null),CKEDITOR.lang.detect=i?function(){return i}:function(e){return e},i||e}},CKEDITOR.scriptLoader=function(){var e={},t={};return{load:function(n,i,a,r){var o="string"==typeof n;o&&(n=[n]),a||(a=CKEDITOR);var s=n.length,l=s,d=[],c=[],u=function(e){i&&(o?i.call(a,e):i.call(a,d,c))};if(0===l)u(!0);else{var f=function(e,t){(t?d:c).push(e),0>=--l&&(r&&CKEDITOR.document.getDocumentElement().removeStyle("cursor"),u(t))},h=function(n,i){e[n]=1;var a=t[n];delete t[n];for(var r=0;r<a.length;r++)a[r](n,i)},p=function(n){if(e[n])f(n,!0);else{var a=t[n]||(t[n]=[]);if(a.push(f),!(1<a.length)){var r=new CKEDITOR.dom.element("script");r.setAttributes({type:"text/javascript",src:n}),i&&(CKEDITOR.env.ie&&(8>=CKEDITOR.env.version||CKEDITOR.env.ie9Compat)?r.$.onreadystatechange=function(){"loaded"!=r.$.readyState&&"complete"!=r.$.readyState||(r.$.onreadystatechange=null,h(n,!0))}:(r.$.onload=function(){setTimeout((function(){r.$.onload=null,r.$.onerror=null,h(n,!0)}),0)},r.$.onerror=function(){r.$.onload=null,r.$.onerror=null,h(n,!1)})),r.appendTo(CKEDITOR.document.getHead())}}};r&&CKEDITOR.document.getDocumentElement().setStyle("cursor","wait");for(var g=0;g<s;g++)p(n[g])}},queue:function(){function e(){var e;(e=t[0])&&this.load(e.scriptUrl,e.callback,CKEDITOR,0)}var t=[];return function(n,i){var a=this;t.push({scriptUrl:n,callback:function(){i&&i.apply(this,arguments),t.shift(),e.call(a)}}),1==t.length&&e.call(this)}}()}}(),CKEDITOR.resourceManager=function(e,t){this.basePath=e,this.fileName=t,this.registered={},this.loaded={},this.externals={},this._={waitingList:{}}},CKEDITOR.resourceManager.prototype={add:function(e,t){if(this.registered[e])throw Error('[CKEDITOR.resourceManager.add] The resource name "'+e+'" is already registered.');var n=this.registered[e]=t||{};return n.name=e,n.path=this.getPath(e),CKEDITOR.fire(e+CKEDITOR.tools.capitalize(this.fileName)+"Ready",n),this.get(e)},get:function(e){return this.registered[e]||null},getPath:function(e){var t=this.externals[e];return CKEDITOR.getUrl(t&&t.dir||this.basePath+e+"/")},getFilePath:function(e){var t=this.externals[e];return CKEDITOR.getUrl(this.getPath(e)+(t?t.file:this.fileName+".js"))},addExternal:function(e,t,n){n||(t=t.replace(/[^\/]+$/,(function(e){return n=e,""}))),n=n||this.fileName+".js",e=e.split(",");for(var i=0;i<e.length;i++)this.externals[e[i]]={dir:t,file:n}},load:function(e,t,n){CKEDITOR.tools.isArray(e)||(e=e?[e]:[]);for(var i=this.loaded,a=this.registered,r=[],o={},s={},l=0;l<e.length;l++){var d=e[l];if(d)if(i[d]||a[d])s[d]=this.get(d);else{var c=this.getFilePath(d);r.push(c),c in o||(o[c]=[]),o[c].push(d)}}CKEDITOR.scriptLoader.load(r,(function(e,a){if(a.length)throw Error('[CKEDITOR.resourceManager.load] Resource name "'+o[a[0]].join(",")+'" was not found at "'+a[0]+'".');for(var r=0;r<e.length;r++)for(var l=o[e[r]],d=0;d<l.length;d++){var c=l[d];s[c]=this.get(c),i[c]=1}t.call(n,s)}),this)}},CKEDITOR.plugins=new CKEDITOR.resourceManager("plugins/","plugin"),CKEDITOR.plugins.load=CKEDITOR.tools.override(CKEDITOR.plugins.load,(function(e){var t={};return function(n,i,a){var r={},o=function(n){e.call(this,n,(function(e){CKEDITOR.tools.extend(r,e);var n,s=[];for(n in e){var l=e[n],d=l&&l.requires;if(!t[n]){if(l.icons)for(var c=l.icons.split(","),u=c.length;u--;)CKEDITOR.skin.addIcon(c[u],l.path+"icons/"+(CKEDITOR.env.hidpi&&l.hidpi?"hidpi/":"")+c[u]+".png");l.isSupportedEnvironment=l.isSupportedEnvironment||function(){return!0},t[n]=1}if(d)for(d.split&&(d=d.split(",")),l=0;l<d.length;l++)r[d[l]]||s.push(d[l])}if(s.length)o.call(this,s);else{for(n in r)(l=r[n]).onLoad&&!l.onLoad._called&&(!1===l.onLoad()&&delete r[n],l.onLoad._called=1);i&&i.call(a||window,r)}}),this)};o.call(this,n)}})),CKEDITOR.plugins.setLang=function(e,t,n){var i=this.get(e);e=i.langEntries||(i.langEntries={}),(i=i.lang||(i.lang=[])).split&&(i=i.split(",")),-1==CKEDITOR.tools.indexOf(i,t)&&i.push(t),e[t]=n},CKEDITOR.ui=function(e){return e.ui?e.ui:(this.items={},this.instances={},this.editor=e,this._={handlers:{}},this)},CKEDITOR.ui.prototype={add:function(e,t,n){n.name=e.toLowerCase();var i=this.items[e]={type:t,command:n.command||null,args:Array.prototype.slice.call(arguments,2)};CKEDITOR.tools.extend(i,n)},get:function(e){return this.instances[e]},create:function(e){var t=this.items[e],n=t&&this._.handlers[t.type],i=t&&t.command&&this.editor.getCommand(t.command);return n=n&&n.create.apply(this,t.args),this.instances[e]=n,i&&i.uiItems.push(n),n&&!n.type&&(n.type=t.type),n},addHandler:function(e,t){this._.handlers[e]=t},space:function(e){return CKEDITOR.document.getById(this.spaceId(e))},spaceId:function(e){return this.editor.id+"_"+e}},CKEDITOR.event.implementOn(CKEDITOR.ui),function(){function e(e,n,a){if(CKEDITOR.event.call(this),e=e&&CKEDITOR.tools.clone(e),void 0!==n){if(!(n instanceof CKEDITOR.dom.element))throw Error("Expect element of type CKEDITOR.dom.element.");if(!a)throw Error("One of the element modes must be specified.");if(CKEDITOR.env.ie&&CKEDITOR.env.quirks&&a==CKEDITOR.ELEMENT_MODE_INLINE)throw Error("Inline element mode is not supported on IE quirks.");if(!function(e,t){return t==CKEDITOR.ELEMENT_MODE_INLINE?e.is(CKEDITOR.dtd.$editable)||e.is("textarea"):t==CKEDITOR.ELEMENT_MODE_REPLACE?!e.is(CKEDITOR.dtd.$nonBodyContent):1}(n,a))throw Error('The specified element mode is not supported on element: "'+n.getName()+'".');this.element=n,this.elementMode=a,this.name=this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO&&(n.getId()||n.getNameAtt())}else this.elementMode=CKEDITOR.ELEMENT_MODE_NONE;this._={},this.commands={},this.templates={},this.name=this.name||function(){do{var e="editor"+ ++s}while(CKEDITOR.instances[e]);return e}(),this.id=CKEDITOR.tools.getNextId(),this.status="unloaded",this.config=CKEDITOR.tools.prototypedCopy(CKEDITOR.config),this.ui=new CKEDITOR.ui(this),this.focusManager=new CKEDITOR.focusManager(this),this.keystrokeHandler=new CKEDITOR.keystrokeHandler(this),this.on("readOnly",t),this.on("selectionChange",(function(e){i(this,e.data.path)})),this.on("activeFilterChange",(function(){i(this,this.elementPath(),!0)})),this.on("mode",t),CKEDITOR.dom.selection.setupEditorOptimization(this),this.on("instanceReady",(function(){if(this.config.startupFocus){if("end"===this.config.startupFocus){var e=this.createRange();e.selectNodeContents(this.editable()),e.shrink(CKEDITOR.SHRINK_ELEMENT,!0),e.collapse(),this.getSelection().selectRanges([e])}this.focus()}})),CKEDITOR.fire("instanceCreated",null,this),CKEDITOR.add(this),CKEDITOR.tools.setTimeout((function(){this.isDestroyed()||this.isDetached()||r(this,e)}),0,this)}function t(){var e,t=this.commands;for(e in t)n(this,t[e])}function n(e,t){t[t.startDisabled||e.readOnly&&!t.readOnly?"disable":t.modes[e.mode]?"enable":"disable"]()}function i(e,t,n){if(t){var i,a,r=e.commands;for(a in r)i=r[a],(n||i.contextSensitive)&&i.refresh(e,t)}}function a(e){if(!(t=e.config.customConfig))return!1;var t=CKEDITOR.getUrl(t),n=l[t]||(l[t]={});return n.fn?(n.fn.call(e,e.config),CKEDITOR.getUrl(e.config.customConfig)!=t&&a(e)||e.fireOnce("customConfigLoaded")):CKEDITOR.scriptLoader.queue(t,(function(){n.fn=n.fn||CKEDITOR.editorConfig||function(){},a(e)})),!0}function r(e,t){e.on("customConfigLoaded",(function(){if(t){if(t.on)for(var n in t.on)e.on(n,t.on[n]);CKEDITOR.tools.extend(e.config,t,!0),delete e.config.on}n=e.config,e.readOnly=!!n.readOnly||(e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.element.is("textarea")?e.element.hasAttribute("disabled")||e.element.hasAttribute("readonly"):e.element.isReadOnly():e.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(e.element.hasAttribute("disabled")||e.element.hasAttribute("readonly"))),e.blockless=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&!(e.element.is("textarea")||CKEDITOR.dtd[e.element.getName()].p),e.tabIndex=n.tabIndex||e.element&&e.element.getAttribute("tabindex")||0,e.activeEnterMode=e.enterMode=e.blockless?CKEDITOR.ENTER_BR:n.enterMode,e.activeShiftEnterMode=e.shiftEnterMode=e.blockless?CKEDITOR.ENTER_BR:n.shiftEnterMode,n.skin&&(CKEDITOR.skinName=n.skin),e.fireOnce("configLoaded"),e.dataProcessor=new CKEDITOR.htmlDataProcessor(e),e.filter=e.activeFilter=new CKEDITOR.filter(e),function(e){CKEDITOR.skin.loadPart("editor",(function(){!function(e){CKEDITOR.lang.load(e.config.language,e.config.defaultLanguage,(function(t,n){var i=e.config.title,a=e.config.applicationTitle;e.langCode=t,e.lang=CKEDITOR.tools.prototypedCopy(n),e.title="string"==typeof i||!1===i?i:[e.lang.editor,e.name].join(", "),e.applicationTitle="string"==typeof a||!1===a?a:[e.lang.application,e.name].join(", "),e.config.contentsLangDirection||(e.config.contentsLangDirection=e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?e.element.getDirection(1):e.lang.dir),e.fire("langLoaded"),function(e){e.getStylesSet((function(t){e.once("loaded",(function(){e.fire("stylesSet",{styles:t})}),null,null,1),function(e){function t(e){return e?(CKEDITOR.tools.isArray(e)&&(e=e.join(",")),e.replace(/\s/g,"")):""}var n=e.config,i=t(n.plugins),a=t(n.extraPlugins),r=t(n.removePlugins);if(a){var o=new RegExp("(?:^|,)(?:"+a.replace(/,/g,"|")+")(?=,|$)","g");i=(i=i.replace(o,""))+","+a}if(r){var s=new RegExp("(?:^|,)(?:"+r.replace(/,/g,"|")+")(?=,|$)","g");i=i.replace(s,"")}CKEDITOR.env.air&&(i+=",adobeair"),CKEDITOR.plugins.load(i.split(","),(function(t){var i=[],a=[],r=[];for(var o in e.plugins=CKEDITOR.tools.extend({},e.plugins,t),t){var l,d=t[o],c=d.lang,u=null,f=d.requires;if(CKEDITOR.tools.isArray(f)&&(f=f.join(",")),f&&(l=f.match(s)))for(;f=l.pop();)CKEDITOR.error("editor-plugin-required",{plugin:f.replace(",",""),requiredBy:o});c&&!e.lang[o]&&(c.split&&(c=c.split(",")),u=0<=CKEDITOR.tools.indexOf(c,e.langCode)?e.langCode:(u=e.langCode.replace(/-.*/,""))!=e.langCode&&0<=CKEDITOR.tools.indexOf(c,u)?u:0<=CKEDITOR.tools.indexOf(c,"en")?"en":c[0],d.langEntries&&d.langEntries[u]?(e.lang[o]=d.langEntries[u],u=null):r.push(CKEDITOR.getUrl(d.path+"lang/"+u+".js"))),a.push(u),i.push(d)}CKEDITOR.scriptLoader.load(r,(function(){if(!e.isDestroyed()&&!e.isDetached()){for(var t=["beforeInit","init","afterInit"],r=0;r<t.length;r++)for(var o=0;o<i.length;o++){var s=i[o];0===r&&a[o]&&s.lang&&s.langEntries&&(e.lang[s.name]=s.langEntries[a[o]]),s[t[r]]&&s[t[r]](e)}for(e.fireOnce("pluginsLoaded"),n.keystrokes&&e.setKeystroke(e.config.keystrokes),o=0;o<e.config.blockedKeystrokes.length;o++)e.keystrokeHandler.blockedKeystrokes[e.config.blockedKeystrokes[o]]=1;e.status="loaded",e.fireOnce("loaded"),CKEDITOR.fire("instanceLoaded",null,e)}}))}))}(e)}))}(e)}))}(e)}))}(e)})),t&&null!=t.customConfig&&(e.config.customConfig=t.customConfig),a(e)||e.fireOnce("customConfigLoaded")}function o(){var e=this.element;if(e&&this.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO){var t=this.getData();return this.config.htmlEncodeOutput&&(t=CKEDITOR.tools.htmlEncode(t)),e.is("textarea")?e.setValue(t):e.setHtml(t),!0}return!1}e.prototype=CKEDITOR.editor.prototype,CKEDITOR.editor=e;var s=0,l={};CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{plugins:{detectConflict:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(this[i])return CKEDITOR.warn("editor-plugin-conflict",{plugin:e,replacedWith:i}),!0}return!1}},addCommand:function(e,t){t.name=e.toLowerCase();var i=t instanceof CKEDITOR.command?t:new CKEDITOR.command(this,t);return this.mode&&n(this,i),this.commands[e]=i},_attachToForm:function(){function e(e){t.updateElement(),t._.required&&!n.getValue()&&!1===t.fire("required")&&e.data.preventDefault()}var t=this,n=t.element,i=new CKEDITOR.dom.element(n.$.form);n.is("textarea")&&i&&(i.on("submit",e),function(e){return!!(e&&e.call&&e.apply)}(i.$.submit)&&(i.$.submit=CKEDITOR.tools.override(i.$.submit,(function(t){return function(){e(),t.apply?t.apply(this):t()}}))),t.on("destroy",(function(){i.removeListener("submit",e)})))},destroy:function(e){var t=CKEDITOR.filter.instances,n=this;this.fire("beforeDestroy"),!e&&o.call(this),this.editable(null),this.filter&&delete this.filter,CKEDITOR.tools.array.forEach(CKEDITOR.tools.object.keys(t),(function(e){e=t[e],n===e.editor&&e.destroy()})),delete this.activeFilter,this.status="destroyed",this.fire("destroy"),this.removeAllListeners(),CKEDITOR.remove(this),CKEDITOR.fire("instanceDestroyed",null,this)},elementPath:function(e){if(!e){if(!(e=this.getSelection()))return null;e=e.getStartElement()}return e?new CKEDITOR.dom.elementPath(e,this.editable()):null},createRange:function(){var e=this.editable();return e?new CKEDITOR.dom.range(e):null},execCommand:function(e,t){var n=this.getCommand(e),i={name:e,commandData:t||{},command:n};return!(!n||n.state==CKEDITOR.TRISTATE_DISABLED||!1===this.fire("beforeCommandExec",i)||(i.returnValue=n.exec(i.commandData),n.async||!1===this.fire("afterCommandExec",i)))&&i.returnValue},getCommand:function(e){return this.commands[e]},getData:function(e){!e&&this.fire("beforeGetData");var t=this._.data;return"string"!=typeof t&&(t=(t=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?t.is("textarea")?t.getValue():t.getHtml():""),t={dataValue:t},!e&&this.fire("getData",t),t.dataValue},getSnapshot:function(){var e=this.fire("getSnapshot");return"string"!=typeof e&&(e=(e=this.element)&&this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE?e.is("textarea")?e.getValue():e.getHtml():""),e},loadSnapshot:function(e){this.fire("loadSnapshot",e)},setData:function(e,t,n){var i=!0,a=t;t&&"object"==typeof t&&(n=t.internal,a=t.callback,i=!t.noSnapshot),!n&&i&&this.fire("saveSnapshot"),!a&&n||this.once("dataReady",(function(e){!n&&i&&this.fire("saveSnapshot"),a&&a.call(e.editor)})),e={dataValue:e},!n&&this.fire("setData",e),this._.data=e.dataValue,!n&&this.fire("afterSetData",e)},setReadOnly:function(e){e=null==e||e,this.readOnly!=e&&(this.readOnly=e,this.keystrokeHandler.blockedKeystrokes[8]=+e,this.editable().setReadOnly(e),this.fire("readOnly"))},insertHtml:function(e,t,n){this.fire("insertHtml",{dataValue:e,mode:t,range:n})},insertText:function(e){this.fire("insertText",e)},insertElement:function(e){this.fire("insertElement",e)},getSelectedHtml:function(e){var t=this.editable(),n=(n=this.getSelection())&&n.getRanges();return t&&n&&0!==n.length?(t=function(e,t){function n(e){var t=e.startContainer,n=e.endContainer,i=t.is&&t.is("tr"),a=t.is&&t.is("td");return e=a&&t.equals(n)&&e.endOffset===t.getChildCount(),t=a&&1===t.getChildCount()&&"img"===t.getChildren().getItem(0).getName(),!!(i||e&&!t)}function i(e){var t=e.startContainer;return t.is("tr")?e.cloneContents():t.clone(!0)}for(var a,r,o,s=new CKEDITOR.dom.documentFragment,l=0;l<e.length;l++){var d=e[l],c=d.startContainer.getAscendant("tr",!0);n(d)?(a||((a=c.getAscendant("table").clone()).append(c.getAscendant({thead:1,tbody:1,tfoot:1}).clone()),s.append(a),a=a.findOne("thead, tbody, tfoot")),r&&r.equals(c)||(r=c,o=c.clone(),a.append(o)),o.append(i(d))):s.append(d.cloneContents())}return a?s:t.getHtmlFromRange(e[0])}(n,t),e?t.getHtml():t):null},extractSelectedHtml:function(e,t){var n,i=this.editable(),a=this.getSelection().getRanges(),r=new CKEDITOR.dom.documentFragment;if(!i||0===a.length)return null;for(n=0;n<a.length;n++)r.append(i.extractHtmlFromRange(a[n],t));return t||this.getSelection().selectRanges([a[0]]),e?r.getHtml():r},focus:function(){this.fire("beforeFocus")},checkDirty:function(){return"ready"==this.status&&this._.previousValue!==this.getSnapshot()},resetDirty:function(){this._.previousValue=this.getSnapshot()},updateElement:function(){return o.call(this)},setKeystroke:function(){for(var e,t,n=this.keystrokeHandler.keystrokes,i=CKEDITOR.tools.isArray(arguments[0])?arguments[0]:[[].slice.call(arguments,0)],a=i.length;a--;)e=i[a],t=0,CKEDITOR.tools.isArray(e)&&(t=e[1],e=e[0]),t?n[e]=t:delete n[e]},getCommandKeystroke:function(e,t){var n="string"==typeof e?this.getCommand(e):e,i=[];if(n){var a=CKEDITOR.tools.object.findKey(this.commands,n),r=this.keystrokeHandler.keystrokes;if(n.fakeKeystroke)i.push(n.fakeKeystroke);else for(var o in r)r[o]===a&&i.push(o)}return t?i:i[0]||null},addFeature:function(e){return this.filter.addFeature(e)},setActiveFilter:function(e){e||(e=this.filter),this.activeFilter!==e&&(this.activeFilter=e,this.fire("activeFilterChange"),e===this.filter?this.setActiveEnterMode(null,null):this.setActiveEnterMode(e.getAllowedEnterMode(this.enterMode),e.getAllowedEnterMode(this.shiftEnterMode,!0)))},setActiveEnterMode:function(e,t){e=e?this.blockless?CKEDITOR.ENTER_BR:e:this.enterMode,t=t?this.blockless?CKEDITOR.ENTER_BR:t:this.shiftEnterMode,this.activeEnterMode==e&&this.activeShiftEnterMode==t||(this.activeEnterMode=e,this.activeShiftEnterMode=t,this.fire("activeEnterModeChange"))},showNotification:function(e){alert(e)},isDetached:function(){return!!this.container&&this.container.isDetached()},isDestroyed:function(){return"destroyed"===this.status}}),CKEDITOR.editor._getEditorElement=function(e){if(!CKEDITOR.env.isCompatible)return null;var t=CKEDITOR.dom.element.get(e);return t?t.getEditor()?(CKEDITOR.error("editor-element-conflict",{editorName:t.getEditor().name}),null):t:(CKEDITOR.error("editor-incorrect-element",{element:e}),null)},CKEDITOR.editor.initializeDelayedEditorCreation=function(e,t,n){if(t.delayIfDetached_callback)return CKEDITOR.warn("editor-delayed-creation",{method:"callback"}),t.delayIfDetached_callback((function(){CKEDITOR[n](e,t),CKEDITOR.warn("editor-delayed-creation-success",{method:"callback"})})),null;var i=void 0===t.delayIfDetached_interval?CKEDITOR.config.delayIfDetached_interval:t.delayIfDetached_interval;CKEDITOR.warn("editor-delayed-creation",{method:"interval - "+i+" ms"});var a=setInterval((function(){e.isDetached()||(clearInterval(a),CKEDITOR[n](e,t),CKEDITOR.warn("editor-delayed-creation-success",{method:"interval - "+i+" ms"}))}),i);return function(){clearInterval(a)}},CKEDITOR.editor.shouldDelayEditorCreation=function(e,t){return CKEDITOR.editor.mergeDelayedCreationConfigs(t),t&&t.delayIfDetached&&e.isDetached()},CKEDITOR.editor.mergeDelayedCreationConfigs=function(e){e&&(e.delayIfDetached="boolean"==typeof e.delayIfDetached?e.delayIfDetached:CKEDITOR.config.delayIfDetached,e.delayIfDetached_interval=isNaN(e.delayIfDetached_interval)?CKEDITOR.config.delayIfDetached_interval:e.delayIfDetached_interval,e.delayIfDetached_callback=e.delayIfDetached_callback||CKEDITOR.config.delayIfDetached_callback)}}(),CKEDITOR.ELEMENT_MODE_NONE=0,CKEDITOR.ELEMENT_MODE_REPLACE=1,CKEDITOR.ELEMENT_MODE_APPENDTO=2,CKEDITOR.ELEMENT_MODE_INLINE=3,CKEDITOR.config.delayIfDetached=!1,CKEDITOR.config.delayIfDetached_callback=void 0,CKEDITOR.config.delayIfDetached_interval=50,CKEDITOR.htmlParser=function(){this._={htmlPartsRegex:/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)--!?>)|(?:([^\/\s>]+)((?:\s+[\w\-:.]+(?:\s*=\s*?(?:(?:"[^"]*")|(?:'[^']*')|[^\s"'\/>]+))?)*)[\S\s]*?(\/?)>))/g}},function(){var e=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,t={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1};CKEDITOR.htmlParser.prototype={onTagOpen:function(){},onTagClose:function(){},onText:function(){},onCDATA:function(){},onComment:function(){},parse:function(n){for(var i,a,r,o=0;i=this._.htmlPartsRegex.exec(n);)if((a=i.index)>o&&(o=n.substring(o,a),r?r.push(o):this.onText(o)),o=this._.htmlPartsRegex.lastIndex,!(a=i[1])||(a=a.toLowerCase(),r&&CKEDITOR.dtd.$cdata[a]&&(this.onCDATA(r.join("")),r=null),r))if(r)r.push(i[0]);else if(a=i[3]){if(a=a.toLowerCase(),!/="/.test(a)){var s,l={},d=i[4];if(i=!!i[5],d)for(;s=e.exec(d);){var c=s[1].toLowerCase();s=s[2]||s[3]||s[4]||"",l[c]=!s&&t[c]?c:CKEDITOR.tools.htmlDecodeAttr(s)}this.onTagOpen(a,l,i),!r&&CKEDITOR.dtd.$cdata[a]&&(r=[])}}else(a=i[2])&&this.onComment(a);else this.onTagClose(a);n.length>o&&this.onText(n.substring(o,n.length))}}}(),CKEDITOR.htmlParser.basicWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[]}},proto:{openTag:function(e){this._.output.push("<",e)},openTagClose:function(e,t){t?this._.output.push(" />"):this._.output.push(">")},attribute:function(e,t){"string"==typeof t&&(t=CKEDITOR.tools.htmlEncodeAttr(t)),this._.output.push(" ",e,'="',t,'"')},closeTag:function(e){this._.output.push("</",e,">")},text:function(e){this._.output.push(e)},comment:function(e){this._.output.push("\x3c!--",e,"--\x3e")},write:function(e){this._.output.push(e)},reset:function(){this._.output=[],this._.indent=!1},getHtml:function(e){var t=this._.output.join("");return e&&this.reset(),t}}}),CKEDITOR.htmlParser.node=function(){},CKEDITOR.htmlParser.node.prototype={remove:function(){var e=this.parent.children,t=CKEDITOR.tools.indexOf(e,this),n=this.previous,i=this.next;n&&(n.next=i),i&&(i.previous=n),e.splice(t,1),this.parent=null},replaceWith:function(e){var t=this.parent.children,n=CKEDITOR.tools.indexOf(t,this),i=e.previous=this.previous,a=e.next=this.next;i&&(i.next=e),a&&(a.previous=e),t[n]=e,e.parent=this.parent,this.parent=null},insertAfter:function(e){var t=e.parent.children,n=CKEDITOR.tools.indexOf(t,e),i=e.next;t.splice(n+1,0,this),this.next=e.next,this.previous=e,e.next=this,i&&(i.previous=this),this.parent=e.parent},insertBefore:function(e){var t=e.parent.children,n=CKEDITOR.tools.indexOf(t,e);t.splice(n,0,this),this.next=e,(this.previous=e.previous)&&(e.previous.next=this),e.previous=this,this.parent=e.parent},getAscendant:function(e){for(var t="function"==typeof e?e:"string"==typeof e?function(t){return t.name==e}:function(t){return t.name in e},n=this.parent;n&&n.type==CKEDITOR.NODE_ELEMENT;){if(t(n))return n;n=n.parent}return null},wrapWith:function(e){return this.replaceWith(e),e.add(this),e},getIndex:function(){return CKEDITOR.tools.indexOf(this.parent.children,this)},getFilterContext:function(e){return e||{}}},CKEDITOR.htmlParser.comment=function(e){this.value=e,this._={isBlockLike:!1}},CKEDITOR.htmlParser.comment.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_COMMENT,filter:function(e,t){var n=this.value;return(n=e.onComment(t,n,this))?"string"!=typeof n?(this.replaceWith(n),!1):(this.value=n,!0):(this.remove(),!1)},writeHtml:function(e,t){t&&this.filter(t),e.comment(this.value)}}),CKEDITOR.htmlParser.text=function(e){this.value=e,this._={isBlockLike:!1}},CKEDITOR.htmlParser.text.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(e,t){if(!(this.value=e.onText(t,this.value,this)))return this.remove(),!1},writeHtml:function(e,t){t&&this.filter(t),e.text(this.value)}}),CKEDITOR.htmlParser.cdata=function(e){this.value=e},CKEDITOR.htmlParser.cdata.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_TEXT,filter:function(e){if((t=this.getAscendant("style"))&&t.getAscendant({math:1,svg:1})){var t=CKEDITOR.htmlParser.fragment.fromHtml(this.value),n=new CKEDITOR.htmlParser.basicWriter;e.applyTo(t),t.writeHtml(n),this.value=n.getHtml()}},writeHtml:function(e){e.write(this.value)}}),CKEDITOR.htmlParser.fragment=function(){this.children=[],this.parent=null,this._={isBlockLike:!0,hasInlineStarted:!1}},function(){function e(e){return!e.attributes["data-cke-survive"]&&("a"==e.name&&e.attributes.href||CKEDITOR.dtd.$removeEmpty[e.name])}var t=CKEDITOR.tools.extend({table:1,ul:1,ol:1,dl:1},CKEDITOR.dtd.table,CKEDITOR.dtd.ul,CKEDITOR.dtd.ol,CKEDITOR.dtd.dl),n={ol:1,ul:1},i=CKEDITOR.tools.extend({},{html:1},CKEDITOR.dtd.html,CKEDITOR.dtd.body,CKEDITOR.dtd.head,{style:1,script:1}),a={ul:"li",ol:"li",dl:"dd",table:"tbody",tbody:"tr",thead:"tr",tfoot:"tr",tr:"td"};CKEDITOR.htmlParser.fragment.fromHtml=function(r,o,s){function l(e){var t;if(0<m.length)for(var n=0;n<m.length;n++){var i=m[n],a=i.name,r=CKEDITOR.dtd[a],o=E.name&&CKEDITOR.dtd[E.name];o&&!o[a]||e&&r&&!r[e]&&CKEDITOR.dtd[e]?a==E.name&&(u(E,E.parent,1),n--):(t||(d(),t=1),(i=i.clone()).parent=E,E=i,m.splice(n,1),n--)}}function d(){for(;v.length;)u(v.shift(),E)}function c(e){if(e._.isBlockLike&&"pre"!=e.name&&"textarea"!=e.name){var t,n=e.children.length,i=e.children[n-1];i&&i.type==CKEDITOR.NODE_TEXT&&((t=CKEDITOR.tools.rtrim(i.value))?i.value=t:e.children.length=n-1)}}function u(t,n,i){n=n||E||g;var a=E;void 0===t.previous&&(f(n,t)&&(E=n,p.onTagOpen(s,{}),t.returnPoint=n=E),c(t),e(t)&&!t.children.length||n.add(t),"pre"==t.name&&(C=!1),"textarea"==t.name&&(T=!1)),t.returnPoint?(E=t.returnPoint,delete t.returnPoint):E=i?n:a}function f(e,t){var n,i;if((e==g||"body"==e.name)&&s&&(!e.name||CKEDITOR.dtd[e.name][s]))return(n=t.attributes&&(i=t.attributes["data-cke-real-element-type"])?i:t.name)&&n in CKEDITOR.dtd.$inline&&!(n in CKEDITOR.dtd.head)&&!t.isOrphan||t.type==CKEDITOR.NODE_TEXT}function h(e,t){return(e in CKEDITOR.dtd.$listItem||e in CKEDITOR.dtd.$tableContent)&&(e==t||"dt"==e&&"dd"==t||"dd"==e&&"dt"==t)}var p=new CKEDITOR.htmlParser,g=o instanceof CKEDITOR.htmlParser.element?o:"string"==typeof o?new CKEDITOR.htmlParser.element(o):new CKEDITOR.htmlParser.fragment,m=[],v=[],E=g,T="textarea"==g.name,C="pre"==g.name;for(p.onTagOpen=function(a,r,o,s){if((r=new CKEDITOR.htmlParser.element(a,r)).isUnknown&&o&&(r.isEmpty=!0),r.isOptionalClose=s,e(r))m.push(r);else{if("pre"==a)C=!0;else{if("br"==a&&C)return void E.add(new CKEDITOR.htmlParser.text("\n"));"textarea"==a&&(T=!0)}if("br"==a)v.push(r);else{for(;s=(o=E.name)?CKEDITOR.dtd[o]||(E._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):i,!(r.isUnknown||E.isUnknown||s[a]);)if(E.isOptionalClose)p.onTagClose(o);else if(a in n&&o in n)(o=(o=E.children)[o.length-1])&&"li"==o.name||u(o=new CKEDITOR.htmlParser.element("li"),E),!r.returnPoint&&(r.returnPoint=E),E=o;else if(a in CKEDITOR.dtd.$listItem&&!h(a,o))p.onTagOpen("li"==a?"ul":"dl",{},0,1);else if(o in t&&!h(a,o))!r.returnPoint&&(r.returnPoint=E),E=E.parent;else{if(o in CKEDITOR.dtd.$inline&&m.unshift(E),!E.parent){r.isOrphan=1;break}u(E,E.parent,1)}l(a),d(),r.parent=E,r.isEmpty?u(r):E=r}}},p.onTagClose=function(e){for(var t=m.length-1;0<=t;t--)if(e==m[t].name)return void m.splice(t,1);for(var n=[],i=[],a=E;a!=g&&a.name!=e;)a._.isBlockLike||i.unshift(a),n.push(a),a=a.returnPoint||a.parent;if(a!=g){for(t=0;t<n.length;t++){var r=n[t];u(r,r.parent)}E=a,a._.isBlockLike?d():!0!==(t=CKEDITOR.config.shiftLineBreaks)&&v.length&&("function"!=typeof t?d():!0!==(t=t(v[v.length-1]))&&(d(),t instanceof CKEDITOR.htmlParser.text&&E.add(t),t instanceof CKEDITOR.htmlParser.element&&u(t,E))),u(a,a.parent),a==E&&(E=E.parent),m=m.concat(i)}"body"==e&&(s=!1)},p.onText=function(e){if(E._.hasInlineStarted&&!v.length||C||T||0!==(e=CKEDITOR.tools.ltrim(e)).length){var n=E.name,r=n?CKEDITOR.dtd[n]||(E._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span):i;T||r["#"]||!(n in t)?(d(),l(),C||T||(e=e.replace(/[\t\r\n ]{2,}|[\t\r\n]/g," ")),e=new CKEDITOR.htmlParser.text(e),f(E,e)&&this.onTagOpen(s,{},0,1),E.add(e)):(p.onTagOpen(a[n]||""),p.onText(e))}},p.onCDATA=function(e){E.add(new CKEDITOR.htmlParser.cdata(e))},p.onComment=function(e){d(),l(),E.add(new CKEDITOR.htmlParser.comment(e))},p.parse(r),d();E!=g;)u(E,E.parent,1);return c(g),g},CKEDITOR.htmlParser.fragment.prototype={type:CKEDITOR.NODE_DOCUMENT_FRAGMENT,add:function(e,t){isNaN(t)&&(t=this.children.length);var n=0<t?this.children[t-1]:null;if(n){if(e._.isBlockLike&&n.type==CKEDITOR.NODE_TEXT&&(n.value=CKEDITOR.tools.rtrim(n.value),0===n.value.length))return this.children.pop(),void this.add(e);n.next=e}e.previous=n,e.parent=this,this.children.splice(t,0,e),this._.hasInlineStarted||(this._.hasInlineStarted=e.type==CKEDITOR.NODE_TEXT||e.type==CKEDITOR.NODE_ELEMENT&&!e._.isBlockLike)},filter:function(e,t){t=this.getFilterContext(t),e.onRoot(t,this),this.filterChildren(e,!1,t)},filterChildren:function(e,t,n){if(this.childrenFilteredBy!=e.id)for(n=this.getFilterContext(n),t&&!this.parent&&e.onRoot(n,this),this.childrenFilteredBy=e.id,t=0;t<this.children.length;t++)!1===this.children[t].filter(e,n)&&t--},writeHtml:function(e,t){t&&this.filter(t),this.writeChildrenHtml(e)},writeChildrenHtml:function(e,t,n){var i=this.getFilterContext();for(n&&!this.parent&&t&&t.onRoot(i,this),t&&this.filterChildren(t,!1,i),t=0,i=(n=this.children).length;t<i;t++)n[t].writeHtml(e)},forEach:function(e,t,n){if(!(n||t&&this.type!=t))var i=e(this);if(!1!==i){n=this.children;for(var a=0;a<n.length;a++)(i=n[a]).type==CKEDITOR.NODE_ELEMENT?i.forEach(e,t):t&&i.type!=t||e(i)}},getFilterContext:function(e){return e||{}}},CKEDITOR.config.shiftLineBreaks=!0}(),function(){function e(){this.rules=[]}function t(t,n,i,a){var r,o;for(r in n)(o=t[r])||(o=t[r]=new e),o.add(n[r],i,a)}CKEDITOR.htmlParser.filter=CKEDITOR.tools.createClass({$:function(t){this.id=CKEDITOR.tools.getNextNumber(),this.elementNameRules=new e,this.attributeNameRules=new e,this.elementsRules={},this.attributesRules={},this.textRules=new e,this.commentRules=new e,this.rootRules=new e,t&&this.addRules(t,10)},proto:{addRules:function(e,n){var i;"number"==typeof n?i=n:n&&"priority"in n&&(i=n.priority),"number"!=typeof i&&(i=10),"object"!=typeof n&&(n={}),e.elementNames&&this.elementNameRules.addMany(e.elementNames,i,n),e.attributeNames&&this.attributeNameRules.addMany(e.attributeNames,i,n),e.elements&&t(this.elementsRules,e.elements,i,n),e.attributes&&t(this.attributesRules,e.attributes,i,n),e.text&&this.textRules.add(e.text,i,n),e.comment&&this.commentRules.add(e.comment,i,n),e.root&&this.rootRules.add(e.root,i,n)},applyTo:function(e){e.filter(this)},onElementName:function(e,t){return this.elementNameRules.execOnName(e,t)},onAttributeName:function(e,t){return this.attributeNameRules.execOnName(e,t)},onText:function(e,t,n){return this.textRules.exec(e,t,n)},onComment:function(e,t,n){return this.commentRules.exec(e,t,n)},onRoot:function(e,t){return this.rootRules.exec(e,t)},onElement:function(e,t){for(var n,i=[this.elementsRules["^"],this.elementsRules[t.name],this.elementsRules.$],a=0;3>a;a++)if(n=i[a]){if(!1===(n=n.exec(e,t,this)))return null;if(n&&n!=t)return this.onNode(e,n);if(t.parent&&!t.name)break}return t},onNode:function(e,t){var n=t.type;return n==CKEDITOR.NODE_ELEMENT?this.onElement(e,t):n==CKEDITOR.NODE_TEXT?new CKEDITOR.htmlParser.text(this.onText(e,t.value,t)):n==CKEDITOR.NODE_COMMENT?new CKEDITOR.htmlParser.comment(this.onComment(e,t.value,t)):null},onAttribute:function(e,t,n,i){return(n=this.attributesRules[n])?n.exec(e,i,t,this):i}}}),CKEDITOR.htmlParser.filterRulesGroup=e,e.prototype={add:function(e,t,n){this.rules.splice(this.findIndex(t),0,{value:e,priority:t,options:n})},addMany:function(e,t,n){for(var i=[this.findIndex(t),0],a=0,r=e.length;a<r;a++)i.push({value:e[a],priority:t,options:n});this.rules.splice.apply(this.rules,i)},findIndex:function(e){for(var t=this.rules,n=t.length-1;0<=n&&e<t[n].priority;)n--;return n+1},exec:function(e,t){var n,i,a,r,o=t instanceof CKEDITOR.htmlParser.node||t instanceof CKEDITOR.htmlParser.fragment,s=Array.prototype.slice.call(arguments,1),l=this.rules,d=l.length;for(r=0;r<d;r++)if(o&&(n=t.type,i=t.name),a=l[r],!(e.nonEditable&&!a.options.applyToAll||e.nestedEditable&&a.options.excludeNestedEditable)){if(!1===(a=a.value.apply(null,s))||o&&a&&(a.name!=i||a.type!=n))return a;null!=a&&(s[0]=t=a)}return t},execOnName:function(e,t){for(var n,i=0,a=this.rules,r=a.length;t&&i<r;i++)n=a[i],e.nonEditable&&!n.options.applyToAll||e.nestedEditable&&n.options.excludeNestedEditable||(t=t.replace(n.value[0],n.value[1]));return t}}}(),function(){function e(e,t){function s(e){return e||CKEDITOR.env.needsNbspFiller?new CKEDITOR.htmlParser.text(" "):new CKEDITOR.htmlParser.element("br",{"data-cke-bogus":1})}function l(e,t){return function(a){if(a.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var o,l,c=[],u=n(a);if(u)for(d(u,1)&&c.push(u);u;)r(u)&&(o=i(u))&&d(o)&&((l=i(o))&&!r(l)?c.push(o):(s(f).insertAfter(o),o.remove())),u=u.previous;for(u=0;u<c.length;u++)c[u].remove();(c=!e||!1!==("function"==typeof t?t(a):t))&&(c=!(!f&&!CKEDITOR.env.needsBrFiller&&a.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT||!f&&!CKEDITOR.env.needsBrFiller&&(7<document.documentMode||a.name in CKEDITOR.dtd.tr||a.name in CKEDITOR.dtd.$listItem)||(c=n(a))&&("form"!=a.name||"input"!=c.name))),c&&a.add(s(e))}}}function d(e,t){return!(f&&!CKEDITOR.env.needsBrFiller||e.type!=CKEDITOR.NODE_ELEMENT||"br"!=e.name||e.attributes["data-cke-eol"])||!!(e.type==CKEDITOR.NODE_TEXT&&(n=e.value.match(p))&&(n.index&&(new CKEDITOR.htmlParser.text(e.value.substring(0,n.index)).insertBefore(e),e.value=n[0]),!CKEDITOR.env.needsBrFiller&&f&&(!t||e.parent.name in h)||!f&&((n=e.previous)&&"br"==n.name||!n||r(n))));var n}var c,u={elements:{}},f="html"==t,h=CKEDITOR.tools.extend({},E);for(c in h)"#"in m[c]||delete h[c];for(c in h)u.elements[c]=l(f,e.config.fillEmptyBlocks);return u.root=l(f,!1),u.elements.br=function(e){return function(t){if(t.parent.type!=CKEDITOR.NODE_DOCUMENT_FRAGMENT){var n=t.attributes;if("data-cke-bogus"in n||"data-cke-eol"in n)delete n["data-cke-bogus"];else{for(n=t.next;n&&a(n);)n=n.next;var l=i(t);!n&&r(t.parent)?o(t.parent,s(e)):r(n)&&l&&!r(l)&&s(e).insertBefore(n)}}}}(f),u}function t(e,t){return e!=CKEDITOR.ENTER_BR&&!1!==t&&(e==CKEDITOR.ENTER_DIV?"div":"p")}function n(e){for(e=e.children[e.children.length-1];e&&a(e);)e=e.previous;return e}function i(e){for(e=e.previous;e&&a(e);)e=e.previous;return e}function a(e){return e.type==CKEDITOR.NODE_TEXT&&!CKEDITOR.tools.trim(e.value)||e.type==CKEDITOR.NODE_ELEMENT&&e.attributes["data-cke-bookmark"]}function r(e){return e&&(e.type==CKEDITOR.NODE_ELEMENT&&e.name in E||e.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT)}function o(e,t){var n=e.children[e.children.length-1];e.children.push(t),t.parent=e,n&&(n.next=t,t.previous=n)}function s(e){"false"!=(e=e.attributes).contenteditable&&(e["data-cke-editable"]=e.contenteditable?"true":1),e.contenteditable="false"}function l(e){switch((e=e.attributes)["data-cke-editable"]){case"true":e.contenteditable="true";break;case"1":delete e.contenteditable}}function d(e,t){return e.replace(t,(function(e,t,n){return 0===e.indexOf("<textarea")&&(e=t+c(n).replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</textarea>"),"<cke:encoded>"+encodeURIComponent(e)+"</cke:encoded>"}))}function c(e){return e.replace(/\x3c!--\{cke_protected\}\{C\}([\s\S]+?)--\x3e/g,(function(e,t){return decodeURIComponent(t)}))}function u(e,t){var n=t._.dataStore;return e.replace(/\x3c!--\{cke_protected\}([\s\S]+?)--\x3e/g,(function(e,t){return decodeURIComponent(t)})).replace(/\{cke_protected_(\d+)\}/g,(function(e,t){return n&&n[t]||""}))}function f(e,t,n){var i=[],a=t.config.protectedSource,r=t._.dataStore||(t._.dataStore={id:1}),o=new RegExp("<\\!--\\{cke_temp_"+n+"(comment)?\\}(\\d*?)--\x3e","g");a=[/<script[\s\S]*?(<\/script>|$)/gi,/<noscript[\s\S]*?<\/noscript>/gi,/<meta[\s\S]*?\/?>/gi].concat(a),e=e.replace(/\x3c!--[\s\S]*?--\x3e/g,(function(e){return"\x3c!--{cke_temp_"+n+"comment}"+(i.push(e)-1)+"--\x3e"}));for(var s=0;s<a.length;s++)e=e.replace(a[s],(function(e){return e=e.replace(o,(function(e,t,n){return i[n]})),o.test(e)?e:"\x3c!--{cke_temp_"+n+"}"+(i.push(e)-1)+"--\x3e"}));return e=e.replace(o,(function(e,t,n){return"\x3c!--"+g+(t?"{C}":"")+encodeURIComponent(i[n]).replace(/--/g,"%2D%2D")+"--\x3e"})),e=e.replace(/<\w+(?:\s+(?:(?:[^\s=>]+\s*=\s*(?:[^'"\s>]+|'[^']*'|"[^"]*"))|[^\s=\/>]+))+\s*\/?>/g,(function(e){return e.replace(/\x3c!--\{cke_protected\}([^>]*)--\x3e/g,(function(e,t){return r[r.id]=decodeURIComponent(t),"{cke_protected_"+r.id+++"}"}))})),e.replace(/<(title|iframe|textarea)([^>]*)>([\s\S]*?)<\/\1>/g,(function(e,n,i,a){return"<"+n+i+">"+u(c(a),t)+"</"+n+">"}))}var h;CKEDITOR.htmlDataProcessor=function(n){var i,a,r=this;this.editor=n,this.dataFilter=i=new CKEDITOR.htmlParser.filter,this.htmlFilter=a=new CKEDITOR.htmlParser.filter,this.writer=new CKEDITOR.htmlParser.basicWriter,i.addRules(T),i.addRules(C,{applyToAll:!0}),i.addRules(e(n,"data"),{applyToAll:!0}),a.addRules(I),a.addRules(b,{applyToAll:!0}),a.addRules(e(n,"html"),{applyToAll:!0}),n.on("toHtml",(function(e){var i;i=(r=window.crypto||window.msCrypto)?r.getRandomValues(new Uint32Array(1))[0]:Math.floor(9e9*Math.random()+1e9);var a,r=(e=e.data).dataValue,o=(r=function(e,t){return e.replace(y,(function(e,n,i){return"<"+n+i.replace(D,(function(e,n){return O.test(n)&&-1==i.indexOf("data-cke-saved-"+n)?" data-cke-saved-"+e+" data-cke-"+t+"-"+e:e}))+">"}))}(r=d(r=f(r=h(r),n,i),_),i),r=(r=(r=(r=(r=d(r,R)).replace(w,"$1cke:$2")).replace(K,"<cke:$1$2></cke:$1>")).replace(/(<pre\b[^>]*>)(\r\n|\n)/g,"$1$2$2")).replace(/([^a-z0-9<\-])(on\w{3,})(?!>)/gi,"$1data-cke-"+i+"-$2"),e.context||n.editable().getName());CKEDITOR.env.ie&&9>CKEDITOR.env.version&&"pre"==o&&(o="div",r="<pre>"+r+"</pre>",a=1),(o=n.document.createElement(o)).setHtml("a"+r),r=(r=o.getHtml().substr(1)).replace(new RegExp("data-cke-"+i+"-","ig"),""),a&&(r=r.replace(/^<pre>|<\/pre>$/gi,"")),r=function(e){return e.replace(x,(function(e,t){return decodeURIComponent(t)}))}(r=r.replace(k,"$1$2")),r=c(r),i=!1!==e.fixForBody&&t(e.enterMode,n.config.autoParagraph),r=CKEDITOR.htmlParser.fragment.fromHtml(r,e.context,i),i&&!(a=r).children.length&&CKEDITOR.dtd[a.name][i]&&(i=new CKEDITOR.htmlParser.element(i),a.add(i)),e.dataValue=r}),null,null,5),n.on("toHtml",(function(e){e.data.filter.applyTo(e.data.dataValue,!0,e.data.dontFilter,e.data.enterMode)&&n.fire("dataFiltered")}),null,null,6),n.on("toHtml",(function(e){e.data.dataValue.filterChildren(r.dataFilter,!0)}),null,null,10),n.on("toHtml",(function(e){var t=(e=e.data).dataValue,n=new CKEDITOR.htmlParser.basicWriter;t.writeChildrenHtml(n),t=n.getHtml(!0),e.dataValue=function(e){return e.replace(/\x3c!--(?!{cke_protected})[\s\S]+?--\x3e/g,(function(e){return"\x3c!--"+g+"{C}"+encodeURIComponent(e).replace(/--/g,"%2D%2D")+"--\x3e"}))}(t)}),null,null,15),n.on("toDataFormat",(function(e){var i=e.data.dataValue;e.data.enterMode!=CKEDITOR.ENTER_BR&&(i=i.replace(/^<br *\/?>/i,"")),e.data.dataValue=CKEDITOR.htmlParser.fragment.fromHtml(i,e.data.context,t(e.data.enterMode,n.config.autoParagraph))}),null,null,5),n.on("toDataFormat",(function(e){e.data.dataValue.filterChildren(r.htmlFilter,!0)}),null,null,10),n.on("toDataFormat",(function(e){e.data.filter.applyTo(e.data.dataValue,!1,!0)}),null,null,11),n.on("toDataFormat",(function(e){var t=e.data.dataValue,i=r.writer;i.reset(),t.writeChildrenHtml(i),t=u(t=c(t=i.getHtml(!0)),n),e.data.dataValue=t}),null,null,15)},CKEDITOR.htmlDataProcessor.prototype={toHtml:function(e,t,n,i){var a,r,o,s,l=this.editor;return t&&"object"==typeof t?(a=t.context,n=t.fixForBody,i=t.dontFilter,r=t.filter,o=t.enterMode,s=t.protectedWhitespaces):a=t,a||null===a||(a=l.editable().getName()),l.fire("toHtml",{dataValue:e,context:a,fixForBody:n,dontFilter:i,filter:r||l.filter,enterMode:o||l.enterMode,protectedWhitespaces:s}).dataValue},toDataFormat:function(e,t){var n,i,a;return t&&(n=t.context,i=t.filter,a=t.enterMode),n||null===n||(n=this.editor.editable().getName()),this.editor.fire("toDataFormat",{dataValue:e,filter:i||this.editor.filter,context:n,enterMode:a||this.editor.enterMode}).dataValue},protectSource:function(e){return f(e,this.editor)},unprotectSource:function(e){return u(e,this.editor)},unprotectRealComments:function(e){return c(e)}};var p=/(?:&nbsp;|\xa0)$/,g="{cke_protected}",m=CKEDITOR.dtd,v="caption colgroup col thead tfoot tbody".split(" "),E=CKEDITOR.tools.extend({},m.$blockLimit,m.$block),T={elements:{input:s,textarea:s}},C={attributeNames:[[/^on/,"data-cke-pa-on"],[/^srcdoc/,"data-cke-pa-srcdoc"],[/^data-cke-expando$/,""]],elements:{iframe:function(e){if(e.attributes&&e.attributes.src){var t=e.attributes.src.toLowerCase().replace(/[^a-z]/gi,"");0!==t.indexOf("javascript")&&0!==t.indexOf("data")||(e.attributes["data-cke-pa-src"]=e.attributes.src,delete e.attributes.src)}}}},I={elements:{embed:function(e){if((n=e.parent)&&"object"==n.name){var t=n.attributes.width,n=n.attributes.height;t&&(e.attributes.width=t),n&&(e.attributes.height=n)}},a:function(e){var t=e.attributes;if(!(e.children.length||t.name||t.id||e.attributes["data-cke-saved-name"]))return!1}}},b={elementNames:[[/^cke:/,""],[/^\?xml:namespace$/,""]],attributeNames:[[/^data-cke-(saved|pa)-/,""],[/^data-cke-.*/,""],["hidefocus",""]],elements:{$:function(e){var t=e.attributes;if(t){if(t["data-cke-temp"])return!1;for(var n=["name","href","src"],i=0;i<n.length;i++)"data-cke-saved-"+n[i]in t&&delete t[n[i]]}return e},table:function(e){e.children.slice(0).sort((function(e,t){var n,i;return e.type==CKEDITOR.NODE_ELEMENT&&t.type==e.type&&(n=CKEDITOR.tools.indexOf(v,e.name),i=CKEDITOR.tools.indexOf(v,t.name)),-1<n&&-1<i&&n!=i||(n=e.parent?e.getIndex():-1,i=t.parent?t.getIndex():-1),n>i?1:-1}))},param:function(e){return e.children=[],e.isEmpty=!0,e},span:function(e){"Apple-style-span"==e.attributes.class&&delete e.name},html:function(e){delete e.attributes.contenteditable,delete e.attributes.class},body:function(e){delete e.attributes.spellcheck,delete e.attributes.contenteditable},style:function(e){var t=e.children[0];t&&t.value&&(t.value=CKEDITOR.tools.trim(t.value)),e.attributes.type||(e.attributes.type="text/css")},title:function(e){var t=e.children[0];!t&&o(e,t=new CKEDITOR.htmlParser.text),t.value=e.attributes["data-cke-title"]||""},input:l,textarea:l},attributes:{class:function(e){return CKEDITOR.tools.ltrim(e.replace(/(?:^|\s+)cke_[^\s]*/g,""))||!1}}};CKEDITOR.env.ie&&(b.attributes.style=function(e){return e.replace(/(^|;)([^\:]+)/g,(function(e){return e.toLowerCase()}))});var y=/<(a|area|img|input|source)\b([^>]*)>/gi,D=/([\w-:]+)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,O=/^(href|src|name)$/i,R=/(?:<style(?=[ >])[^>]*>[\s\S]*?<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,_=/(<textarea(?=[ >])[^>]*>)([\s\S]*?)(?:<\/textarea>)/gi,x=/<cke:encoded>([^<]*)<\/cke:encoded>/gi,w=/(<\/?)((?:object|embed|param|html|body|head|title)([\s][^>]*)?>)/gi,k=/(<\/?)cke:((?:html|body|head|title)[^>]*>)/gi,K=/<cke:(param|embed)([^>]*?)\/?>(?!\s*<\/cke:\1)/gi;h=function(){function e(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.lastIndex=0,i.test(t))return!0}return!1}function t(e){return CKEDITOR.tools.array.reduce(e.split(""),(function(e,t){var i=t.toLowerCase(),a=t.toUpperCase(),r=n(i);return i!==a&&(r+="|"+n(a)),e+"("+r+")"}),"")}function n(e){var t,n=(t=e.charCodeAt(0)).toString(16);for(var i in t={htmlCode:"&#"+t+";?",hex:"&#x0*"+n+";?",entity:{"<":"&lt;",">":"&gt;",":":"&colon;"}[e]})t[i]&&(e+="|"+t[i]);return e}var i=[new RegExp("("+t("<cke:encoded>")+"(.*?)"+t("</cke:encoded>")+")|("+t("<")+t("/")+"?"+t("cke:encoded>")+")","gi"),new RegExp("(("+t("{cke_protected")+")(_[0-9]*)?"+t("}")+")","gi"),/<!(?:\s*-\s*){2,3}!?\s*>/g];return function(t){for(;e(i,t);)for(var n=i,a=0;a<n.length;a++)t=t.replace(n[a],"");return t}}()}(),CKEDITOR.htmlParser.element=function(e,t){this.name=e,this.attributes=t||{},this.children=[];var n=e||"",i=n.match(/^cke:(.*)/);i&&(n=i[1]),n=!!(CKEDITOR.dtd.$nonBodyContent[n]||CKEDITOR.dtd.$block[n]||CKEDITOR.dtd.$listItem[n]||CKEDITOR.dtd.$tableContent[n]||CKEDITOR.dtd.$nonEditable[n]||"br"==n),this.isEmpty=!!CKEDITOR.dtd.$empty[e],this.isUnknown=!CKEDITOR.dtd[e],this._={isBlockLike:n,hasInlineStarted:this.isEmpty||!n}},CKEDITOR.htmlParser.cssStyle=function(e){var t={};return((e instanceof CKEDITOR.htmlParser.element?e.attributes.style:e)||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,(function(e,n,i){"font-family"==n&&(i=i.replace(/["']/g,"")),t[n.toLowerCase()]=i})),{rules:t,populate:function(e){var t=this.toString();t&&(e instanceof CKEDITOR.dom.element?e.setAttribute("style",t):e instanceof CKEDITOR.htmlParser.element?e.attributes.style=t:e.style=t)},toString:function(){var e,n=[];for(e in t)t[e]&&n.push(e,":",t[e],";");return n.join("")}}},t=function(e,t){return(e=e[0])<(t=t[0])?-1:e>t?1:0},n=CKEDITOR.htmlParser.fragment.prototype,CKEDITOR.htmlParser.element.prototype=CKEDITOR.tools.extend(new CKEDITOR.htmlParser.node,{type:CKEDITOR.NODE_ELEMENT,add:n.add,clone:function(){return new CKEDITOR.htmlParser.element(this.name,this.attributes)},filter:function(e,t){var n,i,a,r,o=this;for(t=o.getFilterContext(t),o.parent||e.onRoot(t,o);;){if(n=o.name,!(i=e.onElementName(t,n)))return this.remove(),!1;if(o.name=i,!(o=e.onElement(t,o)))return this.remove(),!1;if(o!==this)return this.replaceWith(o),!1;if(o.name==n)break;if(o.type!=CKEDITOR.NODE_ELEMENT)return this.replaceWith(o),!1;if(!o.name)return this.replaceWithChildren(),!1}for(a in n=o.attributes){for(i=n[a];;){if(!(r=e.onAttributeName(t,a))){delete n[a];break}if(r==a)break;delete n[a],a=r}r&&(!1===(i=e.onAttribute(t,o,r,i))?delete n[r]:n[r]=i)}return o.isEmpty||this.filterChildren(e,!1,t),!0},filterChildren:n.filterChildren,writeHtml:function(e,n){n&&this.filter(n);var i,a,r=this.name,o=[],s=this.attributes;for(i in e.openTag(r,s),s)o.push([i,s[i]]);for(e.sortAttributes&&o.sort(t),i=0,a=o.length;i<a;i++)s=o[i],e.attribute(s[0],s[1]);e.openTagClose(r,this.isEmpty),this.writeChildrenHtml(e),this.isEmpty||e.closeTag(r)},writeChildrenHtml:n.writeChildrenHtml,replaceWithChildren:function(){for(var e=this.children,t=e.length;t;)e[--t].insertAfter(this);this.remove()},forEach:n.forEach,getFirst:function(e){if(!e)return this.children.length?this.children[0]:null;"function"!=typeof e&&(e=function(e){return function(t){return t.type==CKEDITOR.NODE_ELEMENT&&("string"==typeof e?t.name==e:t.name in e)}}(e));for(var t=0,n=this.children.length;t<n;++t)if(e(this.children[t]))return this.children[t];return null},getHtml:function(){var e=new CKEDITOR.htmlParser.basicWriter;return this.writeChildrenHtml(e),e.getHtml()},setHtml:function(e){for(var t=0,n=(e=this.children=CKEDITOR.htmlParser.fragment.fromHtml(e).children).length;t<n;++t)e[t].parent=this},getOuterHtml:function(){var e=new CKEDITOR.htmlParser.basicWriter;return this.writeHtml(e),e.getHtml()},split:function(e){for(var t=this.children.splice(e,this.children.length-e),n=this.clone(),i=0;i<t.length;++i)t[i].parent=n;return n.children=t,t[0]&&(t[0].previous=null),0<e&&(this.children[e-1].next=null),this.parent.add(n,this.getIndex()+1),n},find:function(e,t){void 0===t&&(t=!1);var n,i=[];for(n=0;n<this.children.length;n++){var a=this.children[n];("function"==typeof e&&e(a)||"string"==typeof e&&a.name===e)&&i.push(a),t&&a.find&&(i=i.concat(a.find(e,t)))}return i},findOne:function(e,t){var n=null,i=CKEDITOR.tools.array.find(this.children,(function(i){var a="function"==typeof e?e(i):i.name===e;return a||!t?a:(i.children&&i.findOne&&(n=i.findOne(e,!0)),!!n)}));return n||i||null},addClass:function(e){if(!this.hasClass(e)){var t=this.attributes.class||"";this.attributes.class=t+(t?" ":"")+e}},removeClass:function(e){var t=this.attributes.class;t&&((t=CKEDITOR.tools.trim(t.replace(new RegExp("(?:\\s+|^)"+e+"(?:\\s+|$)")," ")))?this.attributes.class=t:delete this.attributes.class)},hasClass:function(e){var t=this.attributes.class;return!!t&&new RegExp("(?:^|\\s)"+e+"(?=\\s|$)").test(t)},getFilterContext:function(e){var t=[];if(e||(e={nonEditable:!1,nestedEditable:!1}),e.nonEditable||"false"!=this.attributes.contenteditable?e.nonEditable&&!e.nestedEditable&&"true"==this.attributes.contenteditable&&t.push("nestedEditable",!0):t.push("nonEditable",!0),t.length){e=CKEDITOR.tools.copy(e);for(var n=0;n<t.length;n+=2)e[t[n]]=t[n+1]}return e}},!0),function(){var e=/{([^}]+)}/g;CKEDITOR.template=function(e){this.source="function"==typeof e?e:String(e)},CKEDITOR.template.prototype.output=function(t,n){var i=("function"==typeof this.source?this.source(t):this.source).replace(e,(function(e,n){return void 0!==t[n]?t[n]:e}));return n?n.push(i):i}}(),delete CKEDITOR.loadFullCore,CKEDITOR.instances={},CKEDITOR.document=new CKEDITOR.dom.document(document),CKEDITOR.add=function(e){function t(){CKEDITOR.currentInstance==e&&(CKEDITOR.currentInstance=null,CKEDITOR.fire("currentInstance"))}CKEDITOR.instances[e.name]=e,e.on("focus",(function(){CKEDITOR.currentInstance!=e&&(CKEDITOR.currentInstance=e,CKEDITOR.fire("currentInstance"))})),e.on("blur",t),e.on("destroy",t),CKEDITOR.fire("instance",null,e)},CKEDITOR.remove=function(e){delete CKEDITOR.instances[e.name]},function(){var e={};CKEDITOR.addTemplate=function(t,n){var i=e[t];return i||(i={name:t,source:n},CKEDITOR.fire("template",i),e[t]=new CKEDITOR.template(i.source))},CKEDITOR.getTemplate=function(t){return e[t]}}(),function(){var e=[];CKEDITOR.addCss=function(t){e.push(t)},CKEDITOR.getCss=function(){return e.join("\n")}}(),CKEDITOR.on("instanceDestroyed",(function(){CKEDITOR.tools.isEmpty(this.instances)&&CKEDITOR.fire("reset")})),CKEDITOR.TRISTATE_ON=1,CKEDITOR.TRISTATE_OFF=2,CKEDITOR.TRISTATE_DISABLED=0,CKEDITOR.inline=function(e,t){if(!(e=CKEDITOR.editor._getEditorElement(e)))return null;if(CKEDITOR.editor.shouldDelayEditorCreation(e,t))return CKEDITOR.editor.initializeDelayedEditorCreation(e,t,"inline");var n=e.is("textarea")?e:null,i=n?n.getValue():e.getHtml(),a=new CKEDITOR.editor(t,e,CKEDITOR.ELEMENT_MODE_INLINE);return n?(a.setData(i,null,!0),(e=CKEDITOR.dom.element.createFromHtml('<div contenteditable="'+!!a.readOnly+'" class="cke_textarea_inline">'+n.getValue()+"</div>",CKEDITOR.document)).insertAfter(n),n.hide(),n.$.form&&a._attachToForm()):(t&&void 0!==t.readOnly&&!t.readOnly&&e.setAttribute("contenteditable","true"),a.setData(i,null,!0)),a.on("loaded",(function(){a.fire("uiReady"),a.editable(e),a.container=e,a.ui.contentsElement=e,a.setData(a.getData(1)),a.resetDirty(),a.fire("contentDom"),a.mode="wysiwyg",a.fire("mode"),a.status="ready",a.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,a)}),null,null,1e4),a.on("destroy",(function(){var e=a.container;n&&e&&(e.clearCustomData(),e.remove()),n&&n.show(),a.element.clearCustomData(),delete a.element})),a},CKEDITOR.inlineAll=function(){var e,t,n;for(n in CKEDITOR.dtd.$editable)for(var i=CKEDITOR.document.getElementsByTag(n),a=0,r=i.count();a<r;a++)"true"!=(e=i.getItem(a)).getAttribute("contenteditable")||e.getEditor()||(t={element:e,config:{}},!1!==CKEDITOR.fire("inline",t)&&CKEDITOR.inline(e,t.config))},CKEDITOR.domReady((function(){!CKEDITOR.disableAutoInline&&CKEDITOR.inlineAll()})),CKEDITOR.replaceClass="ckeditor",function(){function e(e,n,i,a){if(!(e=CKEDITOR.editor._getEditorElement(e)))return null;if(CKEDITOR.editor.shouldDelayEditorCreation(e,n))return CKEDITOR.editor.initializeDelayedEditorCreation(e,n,"replace");var r=new CKEDITOR.editor(n,e,a);return a==CKEDITOR.ELEMENT_MODE_REPLACE&&(e.setStyle("visibility","hidden"),r._.required=e.hasAttribute("required"),e.removeAttribute("required")),i&&r.setData(i,null,!0),r.on("loaded",(function(){r.isDestroyed()||r.isDetached()||(function(e){var t=e.name,n=e.element,i=e.elementMode,a=e.fire("uiSpace",{space:"top",html:""}).html,r=e.fire("uiSpace",{space:"bottom",html:""}).html,o=new CKEDITOR.template('<{outerEl} id="cke_{name}" class="{id} cke cke_reset cke_chrome cke_editor_{name} cke_{langDir} '+CKEDITOR.env.cssClass+'"  dir="{langDir}" lang="{langCode}" role="application"'+(e.applicationTitle?' aria-labelledby="cke_{name}_arialbl"':"")+">"+(e.applicationTitle?'<span id="cke_{name}_arialbl" class="cke_voice_label">{voiceLabel}</span>':"")+'<{outerEl} class="cke_inner cke_reset" role="presentation">{topHtml}<{outerEl} id="{contentId}" class="cke_contents cke_reset" role="presentation"></{outerEl}>{bottomHtml}</{outerEl}></{outerEl}>');t=CKEDITOR.dom.element.createFromHtml(o.output({id:e.id,name:t,langDir:e.lang.dir,langCode:e.langCode,voiceLabel:e.applicationTitle,topHtml:a?'<span id="'+e.ui.spaceId("top")+'" class="cke_top cke_reset_all" role="presentation" style="height:auto">'+a+"</span>":"",contentId:e.ui.spaceId("contents"),bottomHtml:r?'<span id="'+e.ui.spaceId("bottom")+'" class="cke_bottom cke_reset_all" role="presentation">'+r+"</span>":"",outerEl:CKEDITOR.env.ie?"span":"div"})),i==CKEDITOR.ELEMENT_MODE_REPLACE?(n.hide(),t.insertAfter(n)):n.append(t),e.container=t,e.ui.contentsElement=e.ui.space("contents"),a&&e.ui.space("top").unselectable(),r&&e.ui.space("bottom").unselectable(),n=e.config.width,i=e.config.height,n&&t.setStyle("width",CKEDITOR.tools.cssLength(n)),i&&e.ui.space("contents").setStyle("height",CKEDITOR.tools.cssLength(i)),t.disableContextMenu(),CKEDITOR.env.webkit&&t.on("focus",(function(){e.focus()})),e.fireOnce("uiReady")}(r),a==CKEDITOR.ELEMENT_MODE_REPLACE&&r.config.autoUpdateElement&&e.$.form&&r._attachToForm(),r.setMode(r.config.startupMode,(function(){r.resetDirty(),r.status="ready",r.fireOnce("instanceReady"),CKEDITOR.fire("instanceReady",null,r)})))})),r.on("destroy",t),r}function t(){var e=this.container,t=this.element;e&&(e.clearCustomData(),e.remove()),t&&(t.clearCustomData(),this.elementMode==CKEDITOR.ELEMENT_MODE_REPLACE&&(t.show(),this._.required&&t.setAttribute("required","required")),delete this.element)}CKEDITOR.replace=function(t,n){return e(t,n,null,CKEDITOR.ELEMENT_MODE_REPLACE)},CKEDITOR.appendTo=function(t,n,i){return e(t,n,i,CKEDITOR.ELEMENT_MODE_APPENDTO)},CKEDITOR.replaceAll=function(){for(var e=document.getElementsByTagName("textarea"),t=0;t<e.length;t++){var n=null,i=e[t];if(i.name||i.id){if("string"==typeof arguments[0]){if(!new RegExp("(?:^|\\s)"+arguments[0]+"(?:$|\\s)").test(i.className))continue}else if("function"==typeof arguments[0]&&!1===arguments[0](i,n={}))continue;this.replace(i,n)}}},CKEDITOR.editor.prototype.addMode=function(e,t){(this._.modes||(this._.modes={}))[e]=t},CKEDITOR.editor.prototype.setMode=function(e,t){var n=this,i=this._.modes;if(e!=n.mode&&i&&i[e]){if(n.fire("beforeSetMode",e),n.mode){var a,r=n.checkDirty(),o=(i=n._.previousModeData,0);n.fire("beforeModeUnload"),n.editable(0),n._.previousMode=n.mode,n._.previousModeData=a=n.getData(1),"source"==n.mode&&i==a&&(n.fire("lockSnapshot",{forceUpdate:!0}),o=1),n.ui.space("contents").setHtml(""),n.mode=""}else n._.previousModeData=n.getData(1);this._.modes[e]((function(){n.mode=e,void 0!==r&&!r&&n.resetDirty(),o?n.fire("unlockSnapshot"):"wysiwyg"==e&&n.fire("saveSnapshot"),setTimeout((function(){n.isDestroyed()||n.isDetached()||(n.fire("mode"),t&&t.call(n))}),0)}))}},CKEDITOR.editor.prototype.resize=function(e,t,n,i){var a=this.container,r=this.ui.space("contents"),o=CKEDITOR.env.webkit&&this.document&&this.document.getWindow().$.frameElement;i=i?this.container.getFirst((function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_inner")})):a,(e||0===e)&&(e=CKEDITOR.tools.convertToPx(CKEDITOR.tools.cssLength(e))),i.setSize("width",e,!0),o&&(o.style.width="1%"),t=CKEDITOR.tools.convertToPx(CKEDITOR.tools.cssLength(t));var s=(i.$.offsetHeight||0)-(r.$.clientHeight||0);a=Math.max(t-(n?0:s),0),t=n?t+s:t,r.setStyle("height",CKEDITOR.tools.cssLength(a)),o&&(o.style.width="100%"),this.fire("resize",{outerHeight:t,contentsHeight:a,outerWidth:e||i.getSize("width")})},CKEDITOR.editor.prototype.getResizable=function(e){return e?this.ui.space("contents"):this.container},CKEDITOR.domReady((function(){CKEDITOR.replaceClass&&CKEDITOR.replaceAll(CKEDITOR.replaceClass)}))}(),CKEDITOR.config.startupMode="wysiwyg",function(){function e(e){var t,i=e.editor,a=e.data.path,r=a.blockLimit,s=e.data.selection,l=s.getRanges()[0];(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller)&&(s=function(e,t){if(e.isFake)return 0;var i=t.block||t.blockLimit,a=i&&i.getLast(n);return!i||!i.isBlockBoundary()||a&&a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary()||i.is("pre")||i.getBogus()?void 0:i}(s,a))&&(s.appendBogus(),t=CKEDITOR.env.ie&&!CKEDITOR.env.edge||CKEDITOR.env.edge&&i._.previousActive),o(i,a.block,r)&&l.collapsed&&!l.getCommonAncestor().isReadOnly()&&((a=l.clone()).enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),(r=new CKEDITOR.dom.walker(a)).guard=function(e){return!n(e)||e.type==CKEDITOR.NODE_COMMENT||e.isReadOnly()},!r.checkForward()||a.checkStartOfBlock()&&a.checkEndOfBlock())&&(i=l.fixBlock(!0,i.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p"),CKEDITOR.env.needsBrFiller||(i=i.getFirst(n))&&i.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(i.getText()).match(/^(?:&nbsp;|\xa0)$/)&&i.remove(),t=1,e.cancel()),t&&l.select()}function t(e){var t=e.data.getTarget();t.is("input")&&("submit"!=(t=t.getAttribute("type"))&&"reset"!=t||e.data.preventDefault())}function n(e){return u(e)&&f(e)}function i(e){return!!e.getRanges()[0].startPath().contains({table:1,ul:1,ol:1,dl:1})}function a(e){function t(e){var t={table:1,ul:1,ol:1,dl:1};return function(i,r){if(r&&i.type==CKEDITOR.NODE_ELEMENT&&i.is(t)&&(a=i),!(r||!n(i)||e&&p(i)))return!1}}var a,r=e.getRanges()[0],o=e.root;return i(e)&&((e=r.clone()).collapse(1),e.setStartAt(o,CKEDITOR.POSITION_AFTER_START),(o=new CKEDITOR.dom.walker(e)).guard=t(),o.checkBackward(),a)?((e=r.clone()).collapse(),e.setEndAt(a,CKEDITOR.POSITION_AFTER_END),(o=new CKEDITOR.dom.walker(e)).guard=t(!0),a=!1,o.checkForward(),a):null}function r(e){return e.block.getParent().getChildCount()}function o(e,t,n){return!1!==e.config.autoParagraph&&e.activeEnterMode!=CKEDITOR.ENTER_BR&&(e.editable().equals(n)&&!t||t&&"true"==t.getAttribute("contenteditable"))}function s(e){return e.activeEnterMode!=CKEDITOR.ENTER_BR&&!1!==e.config.autoParagraph&&(e.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p")}function l(e){e&&e.isEmptyInlineRemoveable()&&e.remove()}function d(e){var t=e.editor;t.getSelection().scrollIntoView(),setTimeout((function(){t.fire("saveSnapshot")}),0)}function c(e,t,n){var i=e.getCommonAncestor(t);for(t=e=n?t:e;(e=e.getParent())&&!i.equals(e)&&1==e.getChildCount();)t=e;t.remove()}var u,f,h,p,g,m,v,E,T,C,I={ul:1,ol:1,dl:1};CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(e,t){this.base(t.$||t),this.editor=e,this.status="unloaded",this.hasFocus=!1,this.setup()},proto:{focus:function(){var e;if(CKEDITOR.env.webkit&&!this.hasFocus&&(e=this.editor._.previousActive||this.getDocument().getActive(),this.contains(e)))e.focus();else{CKEDITOR.env.edge&&14<CKEDITOR.env.version&&!this.hasFocus&&this.getDocument().equals(CKEDITOR.document)&&(this.editor._.previousScrollTop=this.$.scrollTop);try{if(!CKEDITOR.env.ie||CKEDITOR.env.edge&&14<CKEDITOR.env.version||!this.getDocument().equals(CKEDITOR.document))if(CKEDITOR.env.chrome){var t=this.$.scrollTop;this.$.focus(),this.$.scrollTop=t}else this.$.focus();else this.$.setActive()}catch(e){if(!CKEDITOR.env.ie)throw e}CKEDITOR.env.safari&&!this.isInline()&&((e=CKEDITOR.document.getActive()).equals(this.getWindow().getFrame())||this.getWindow().focus())}},on:function(e,t){var n=Array.prototype.slice.call(arguments,0);return CKEDITOR.env.ie&&/^focus|blur$/.exec(e)&&(e="focus"==e?"focusin":"focusout",t=function(e,t){return function(n){var i=n.data.$.toElement||n.data.$.fromElement||n.data.$.relatedTarget;(i=i&&i.nodeType==CKEDITOR.NODE_ELEMENT?new CKEDITOR.dom.element(i):null)&&(t.equals(i)||t.contains(i))||e.call(this,n)}}(t,this),n[0]=e,n[1]=t),CKEDITOR.dom.element.prototype.on.apply(this,n)},attachListener:function(e){!this._.listeners&&(this._.listeners=[]);var t=Array.prototype.slice.call(arguments,1);return t=e.on.apply(e,t),this._.listeners.push(t),t},clearListeners:function(){var e=this._.listeners;try{for(;e.length;)e.pop().removeListener()}catch(e){}},restoreAttrs:function(){var e,t,n=this._.attrChanges;for(t in n)n.hasOwnProperty(t)&&(null!==(e=n[t])?this.setAttribute(t,e):this.removeAttribute(t))},attachClass:function(e){var t=this.getCustomData("classes");this.hasClass(e)||(!t&&(t=[]),t.push(e),this.setCustomData("classes",t),this.addClass(e))},changeAttr:function(e,t){var n=this.getAttribute(e);t!==n&&(!this._.attrChanges&&(this._.attrChanges={}),e in this._.attrChanges||(this._.attrChanges[e]=n),this.setAttribute(e,t))},insertText:function(e){this.editor.focus(),this.insertHtml(this.transformPlainTextToHtml(e),"text")},transformPlainTextToHtml:function(e){var t=this.editor.getSelection().getStartElement().hasAscendant("pre",!0)?CKEDITOR.ENTER_BR:this.editor.activeEnterMode;return CKEDITOR.tools.transformPlainTextToHtml(e,t)},insertHtml:function(e,t,n){var i=this.editor;i.focus(),i.fire("saveSnapshot"),n||(n=i.getSelection().getRanges()[0]),m(this,t||"html",e,n),n.select(),d(this),this.editor.fire("afterInsertHtml",{})},insertHtmlIntoRange:function(e,t,n){m(this,n||"html",e,t),this.editor.fire("afterInsertHtml",{intoRange:t})},insertElement:function(e,t){(a=this.editor).focus(),a.fire("saveSnapshot");var i=a.activeEnterMode,a=a.getSelection(),r=e.getName();r=CKEDITOR.dtd.$block[r],t||(t=a.getRanges()[0]),this.insertElementIntoRange(e,t)&&(t.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),r&&((r=e.getNext((function(e){return n(e)&&!p(e)})))&&r.type==CKEDITOR.NODE_ELEMENT&&r.is(CKEDITOR.dtd.$block)?r.getDtd()["#"]?t.moveToElementEditStart(r):t.moveToElementEditEnd(e):r||i==CKEDITOR.ENTER_BR||(r=t.fixBlock(!0,i==CKEDITOR.ENTER_DIV?"div":"p"),t.moveToElementEditStart(r)))),a.selectRanges([t]),d(this)},insertElementIntoSelection:function(e){this.insertElement(e)},insertElementIntoRange:function(e,t){var n,i,a=this.editor,r=a.config.enterMode,o=e.getName(),s=CKEDITOR.dtd.$block[o];if(t.checkReadOnly())return!1;if(t.deleteContents(1),t.startContainer.type==CKEDITOR.NODE_ELEMENT&&(t.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})?v(t):t.startContainer.is(CKEDITOR.dtd.$list)&&E(t)),s)for(;(n=t.getCommonAncestor(0,1))&&(i=CKEDITOR.dtd[n.getName()])&&(!i||!i[o]);)if(n.getName()in CKEDITOR.dtd.span){s=t.splitElement(n);var d=t.createBookmark();l(n),l(s),t.moveToBookmark(d)}else t.checkStartOfBlock()&&t.checkEndOfBlock()?(t.setStartBefore(n),t.collapse(!0),n.remove()):t.splitBlock(r==CKEDITOR.ENTER_DIV?"div":"p",a.editable());return t.insertNode(e),!0},setData:function(e,t){t||(e=this.editor.dataProcessor.toHtml(e)),this.setHtml(e),this.fixInitialSelection(),"unloaded"==this.status&&(this.status="ready"),this.editor.fire("dataReady")},getData:function(e){var t=this.getHtml();return e||(t=this.editor.dataProcessor.toDataFormat(t)),t},setReadOnly:function(e){this.setAttribute("contenteditable",String(!e)),this.setAttribute("aria-readonly",String(e))},detach:function(){this.status="detached",this.editor.setData(this.editor.getData(),{internal:!0}),this.clearListeners();try{this._.cleanCustomData()}catch(e){if(!CKEDITOR.env.ie||-2146828218!==e.number)throw e}this.editor.fire("contentDomUnload"),delete this.editor.document,delete this.editor.window,delete this.editor},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},fixInitialSelection:function(){function e(){var e,n=t.getDocument().$,i=n.getSelection();e:if(i.anchorNode&&i.anchorNode==t.$)e=!0;else{if(CKEDITOR.env.webkit&&(e=t.getDocument().getActive())&&e.equals(t)&&!i.anchorNode){e=!0;break e}e=void 0}e&&((e=new CKEDITOR.dom.range(t)).moveToElementEditStart(t),(n=n.createRange()).setStart(e.startContainer.$,e.startOffset),n.collapse(!0),i.removeAllRanges(),i.addRange(n))}var t=this;CKEDITOR.env.ie&&(9>CKEDITOR.env.version||CKEDITOR.env.quirks)?this.hasFocus&&(this.focus(),function(){var e=t.getDocument().$,n=e.selection,i=t.getDocument().getActive();"None"==n.type&&i.equals(t)&&(n=new CKEDITOR.dom.range(t),e=e.body.createTextRange(),n.moveToElementEditStart(t),(n=n.startContainer).type!=CKEDITOR.NODE_ELEMENT&&(n=n.getParent()),e.moveToElementText(n.$),e.collapse(!0),e.select())}()):this.hasFocus?(this.focus(),e()):this.once("focus",(function(){e()}),null,null,-999)},getHtmlFromRange:function(e){return e.collapsed?new CKEDITOR.dom.documentFragment(e.document):(e={doc:this.getDocument(),range:e.clone()},T.eol.detect(e,this),T.bogus.exclude(e),T.cell.shrink(e),e.fragment=e.range.cloneContents(),T.tree.rebuild(e,this),T.eol.fix(e,this),new CKEDITOR.dom.documentFragment(e.fragment.$))},extractHtmlFromRange:function(e,t){var n=C,i={range:e,doc:e.document},a=this.getHtmlFromRange(e);if(e.collapsed)return e.optimize(),a;if(e.enlarge(CKEDITOR.ENLARGE_INLINE,1),n.table.detectPurge(i),i.bookmark=e.createBookmark(),delete i.range,(o=this.editor.createRange()).moveToPosition(i.bookmark.startNode,CKEDITOR.POSITION_BEFORE_START),i.targetBookmark=o.createBookmark(),n.list.detectMerge(i,this),n.table.detectRanges(i,this),n.block.detectMerge(i,this),i.tableContentsRanges?(n.table.deleteRanges(i),e.moveToBookmark(i.bookmark),i.range=e):(e.moveToBookmark(i.bookmark),i.range=e,e.extractContents(n.detectExtractMerge(i))),e.moveToBookmark(i.targetBookmark),e.optimize(),n.fixUneditableRangePosition(e),n.list.merge(i,this),n.table.purge(i,this),n.block.merge(i,this),t){if(n=e.startPath(),i=e.checkStartOfBlock()&&e.checkEndOfBlock()&&n.block&&!e.root.equals(n.block)){e:{var r,o=0;if(i=n.block.getElementsByTag("span"))for(;r=i.getItem(o++);)if(!f(r)){i=!0;break e}i=!1}i=!i}i&&(e.moveToPosition(n.block,CKEDITOR.POSITION_BEFORE_START),n.block.remove())}else n.autoParagraph(this.editor,e),h(e.startContainer)&&e.startContainer.appendBogus();return e.startContainer.mergeSiblings(),a},setup:function(){var e=this.editor;if(this.attachListener(e,"beforeGetData",(function(){var t=this.getData();this.is("textarea")||!1!==e.config.ignoreEmptyParagraph&&(t=t.replace(g,(function(e,t){return t}))),e.setData(t,null,1)}),this),this.attachListener(e,"getSnapshot",(function(e){e.data=this.getData(1)}),this),this.attachListener(e,"afterSetData",(function(){this.setData(e.getData(1))}),this),this.attachListener(e,"loadSnapshot",(function(e){this.setData(e.data,1)}),this),this.attachListener(e,"beforeFocus",(function(){var t=e.getSelection();(t=t&&t.getNative())&&"Control"==t.type||this.focus()}),this),this.attachListener(e,"insertHtml",(function(e){this.insertHtml(e.data.dataValue,e.data.mode,e.data.range)}),this),this.attachListener(e,"insertElement",(function(e){this.insertElement(e.data)}),this),this.attachListener(e,"insertText",(function(e){this.insertText(e.data)}),this),this.setReadOnly(e.readOnly),this.attachClass("cke_editable"),e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?this.attachClass("cke_editable_inline"):e.elementMode!=CKEDITOR.ELEMENT_MODE_REPLACE&&e.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO||this.attachClass("cke_editable_themed"),this.attachClass("cke_contents_"+e.config.contentsLangDirection),e.keystrokeHandler.blockedKeystrokes[8]=+e.readOnly,e.keystrokeHandler.attach(this),this.on("blur",(function(){this.hasFocus=!1}),null,null,-1),this.on("focus",(function(){this.hasFocus=!0}),null,null,-1),CKEDITOR.env.webkit&&this.on("scroll",(function(){e._.previousScrollTop=e.editable().$.scrollTop}),null,null,-1),CKEDITOR.env.edge&&14<CKEDITOR.env.version){var o=function(){var t=e.editable();null!=e._.previousScrollTop&&t.getDocument().equals(CKEDITOR.document)&&(t.$.scrollTop=e._.previousScrollTop,e._.previousScrollTop=null,this.removeListener("scroll",o))};this.on("scroll",o)}if(e.focusManager.add(this),this.equals(CKEDITOR.document.getActive())&&(this.hasFocus=!0,e.once("contentDom",(function(){e.focusManager.focus(this)}),this)),this.isInline()&&this.changeAttr("tabindex",e.tabIndex),!this.is("textarea")){e.document=this.getDocument(),e.window=this.getWindow();var s=e.document;this.changeAttr("spellcheck",!e.config.disableNativeSpellChecker);var l=e.config.contentsLangDirection;this.getDirection(1)!=l&&this.changeAttr("dir",l);var d=CKEDITOR.getCss();if(d){var f=(l=s.getHead()).getCustomData("stylesheet");f?d!=f.getText()&&(CKEDITOR.env.ie&&9>CKEDITOR.env.version?f.$.styleSheet.cssText=d:f.setText(d)):(d=s.appendStyleText(d),d=new CKEDITOR.dom.element(d.ownerNode||d.owningElement),l.setCustomData("stylesheet",d),d.data("cke-temp",1))}l=s.getCustomData("stylesheet_ref")||0,s.setCustomData("stylesheet_ref",l+1),this.setCustomData("cke_includeReadonly",!e.config.disableReadonlyStyling),this.attachListener(this,"click",(function(e){e=e.data;var t=new CKEDITOR.dom.elementPath(e.getTarget(),this).contains("a");t&&2!=e.$.button&&t.isReadOnly()&&e.preventDefault()}));var h={8:1,46:1};this.attachListener(e,"key",(function(t){if(e.readOnly)return!0;var n,o=t.data.domEvent.getKey(),s=e.getSelection();if(0!==s.getRanges().length){if(o in h){var l,d,c,f,p=(t=s.getRanges()[0]).startPath(),g=(o=8==o,!1);if(CKEDITOR.env.ie&&11>CKEDITOR.env.version&&s.getSelectedElement())l=s.getSelectedElement();else if(i(s)){var m,v=new CKEDITOR.dom.walker(t),E=t.collapsed?t.startContainer:v.next();if(g=!1,t.checkStartOfBlock()){var T=(m=t.startPath().block||t.startPath().blockLimit).getName();m=-1!==CKEDITOR.tools.array.indexOf(["dd","dt","li"],T)&&null===m.getPrevious()}else m=!1;if(m){for(;E&&!g;)g=E.$.nodeName.toLowerCase(),g=!!I[g],E=v.next();v=r(t.startPath()),E=r(t.endPath()),g=g||v!==E}else g=void 0;g||(l=a(s))}l||g?(e.fire("saveSnapshot"),g?((n=t.startContainer.getAscendant(I,!0))?(t.setStart(n,0),t.enlarge(CKEDITOR.ENLARGE_ELEMENT),l=t):l=null,l.deleteContents()):(t.moveToPosition(l,CKEDITOR.POSITION_BEFORE_START),l.remove()),t.select(),e.fire("saveSnapshot"),n=1):t.collapsed&&((d=p.block)&&(f=d[o?"getPrevious":"getNext"](u))&&f.type==CKEDITOR.NODE_ELEMENT&&f.is("table")&&t[o?"checkStartOfBlock":"checkEndOfBlock"]()?(e.fire("saveSnapshot"),t[o?"checkEndOfBlock":"checkStartOfBlock"]()&&d.remove(),t["moveToElementEdit"+(o?"End":"Start")](f),t.select(),e.fire("saveSnapshot"),n=1):p.blockLimit&&p.blockLimit.is("td")&&(c=p.blockLimit.getAscendant("table"))&&t.checkBoundaryOfElement(c,o?CKEDITOR.START:CKEDITOR.END)&&(f=c[o?"getPrevious":"getNext"](u))?(e.fire("saveSnapshot"),t["moveToElementEdit"+(o?"End":"Start")](f),t.checkStartOfBlock()&&t.checkEndOfBlock()?f.remove():t.select(),e.fire("saveSnapshot"),n=1):(c=p.contains(["td","th","caption"]))&&t.checkBoundaryOfElement(c,o?CKEDITOR.START:CKEDITOR.END)&&(n=1))}return!n}})),e.blockless&&CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller&&this.attachListener(this,"keyup",(function(t){t.data.getKeystroke()in h&&!this.getFirst(n)&&(this.appendBogus(),(t=e.createRange()).moveToPosition(this,CKEDITOR.POSITION_AFTER_START),t.select())})),this.attachListener(this,"dblclick",(function(t){if(e.readOnly)return!1;t={element:t.data.getTarget()},e.fire("doubleclick",t)})),CKEDITOR.env.ie&&this.attachListener(this,"click",t),CKEDITOR.env.ie&&!CKEDITOR.env.edge||this.attachListener(this,"mousedown",(function(t){var n=t.data.getTarget();n.is("img","hr","input","textarea","select")&&!n.isReadOnly()&&(e.getSelection().selectElement(n),n.is("input","textarea","select")&&t.data.preventDefault())})),CKEDITOR.env.edge&&this.attachListener(this,"mouseup",(function(t){(t=t.data.getTarget())&&t.is("img")&&!t.isReadOnly()&&e.getSelection().selectElement(t)})),CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",(function(t){if(2==t.data.$.button&&!(t=t.data.getTarget()).getAscendant("table")&&!t.getOuterHtml().replace(g,"")){var n=e.createRange();n.moveToElementEditStart(t),n.select(!0)}})),CKEDITOR.env.webkit&&(this.attachListener(this,"click",(function(e){e.data.getTarget().is("input","select")&&e.data.preventDefault()})),this.attachListener(this,"mouseup",(function(e){e.data.getTarget().is("input","textarea")&&e.data.preventDefault()}))),CKEDITOR.env.webkit&&this.attachListener(e,"key",(function(t){if(e.readOnly)return!0;if((n=t.data.domEvent.getKey())in h&&0!==(t=e.getSelection()).getRanges().length){var n=8==n,i=t.getRanges()[0];if(t=i.startPath(),i.collapsed)e:{var a=t.block;if(a&&i[n?"checkStartOfBlock":"checkEndOfBlock"](!0)&&i.moveToClosestEditablePosition(a,!n)&&i.collapsed){if(i.startContainer.type==CKEDITOR.NODE_ELEMENT){var r=i.startContainer.getChild(i.startOffset-(n?1:0));if(r&&r.type==CKEDITOR.NODE_ELEMENT&&r.is("hr")){e.fire("saveSnapshot"),r.remove(),t=!0;break e}}var o;!(i=i.startPath().block)||i&&i.contains(a)?t=void 0:(e.fire("saveSnapshot"),(o=(n?i:a).getBogus())&&o.remove(),r=(o=e.getSelection()).createBookmarks(),(n?a:i).moveChildren(n?i:a,!1),t.lastElement.mergeSiblings(),c(a,i,!n),o.selectBookmarks(r),t=!0)}else t=!1}else n=i,o=t.block,i=n.endPath().block,o&&i&&!o.equals(i)?(e.fire("saveSnapshot"),(a=o.getBogus())&&a.remove(),n.enlarge(CKEDITOR.ENLARGE_INLINE),n.deleteContents(),i.getParent()&&(i.moveChildren(o,!1),t.lastElement.mergeSiblings(),c(o,i,!0)),(n=e.getSelection().getRanges()[0]).collapse(1),n.optimize(),""===n.startContainer.getHtml()&&n.startContainer.appendBogus(),n.select(),t=!0):t=!1;if(!t)return;return e.getSelection().scrollIntoView(),e.fire("saveSnapshot"),!1}}),this,null,100)}},getUniqueId:function(){var e;try{this._.expandoNumber=e=CKEDITOR.dom.domObject.prototype.getUniqueId.call(this)}catch(t){e=this._&&this._.expandoNumber}return e}},_:{cleanCustomData:function(){this.removeClass("cke_editable"),this.restoreAttrs();for(var e=this.removeCustomData("classes");e&&e.length;)this.removeClass(e.pop());if(!this.is("textarea")){var t=(e=this.getDocument()).getHead();if(t.getCustomData("stylesheet")){var n=e.getCustomData("stylesheet_ref");--n?e.setCustomData("stylesheet_ref",n):(e.removeCustomData("stylesheet_ref"),t.removeCustomData("stylesheet").remove())}}}}}),CKEDITOR.editor.prototype.editable=function(e){var t=this._.editable;return t&&e?0:arguments.length?(e?t=e instanceof CKEDITOR.editable?e:new CKEDITOR.editable(this,e):(t&&t.detach(),t=null),this._.editable=t):t},CKEDITOR.on("instanceLoaded",(function(t){var n=t.editor;n.on("insertElement",(function(e){(e=e.data).type==CKEDITOR.NODE_ELEMENT&&(e.is("input")||e.is("textarea"))&&("false"!=e.getAttribute("contentEditable")&&e.data("cke-editable",e.hasAttribute("contenteditable")?"true":"1"),e.setAttribute("contentEditable",!1))})),n.on("selectionChange",(function(t){if(!n.readOnly){var i=n.getSelection();i&&!i.isLocked&&(i=n.checkDirty(),n.fire("lockSnapshot"),e(t),n.fire("unlockSnapshot"),!i&&n.resetDirty())}}))})),CKEDITOR.on("instanceCreated",(function(e){var t=e.editor;t.on("mode",(function(){var e=t.editable();if(e&&e.isInline()){var n=t.title;if(e.changeAttr("role","textbox"),e.changeAttr("aria-multiline","true"),n&&e.changeAttr("aria-label",n),n&&e.changeAttr("title",n),(a=t.fire("ariaEditorHelpLabel",{}).label)&&(n=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents"))){var i=CKEDITOR.tools.getNextId(),a=CKEDITOR.dom.element.createFromHtml('<span id="'+i+'" class="cke_voice_label">'+a+"</span>");n.append(a),e.changeAttr("aria-describedby",i)}}}))})),CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}"),u=CKEDITOR.dom.walker.whitespaces(!0),f=CKEDITOR.dom.walker.bookmark(!1,!0),h=CKEDITOR.dom.walker.empty(),p=CKEDITOR.dom.walker.bogus(),g=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,m=function(){function e(e){return e.type==CKEDITOR.NODE_ELEMENT}function t(n,i){var a,r,o,s,l=[],d=i.range.startContainer;a=i.range.startPath(),d=c[d.getName()];for(var u=0,f=n.getChildren(),h=f.count(),p=-1,g=-1,m=0,v=a.contains(c.$list);u<h;++u)e(a=f.getItem(u))?(o=a.getName(),v&&o in CKEDITOR.dtd.$list?l=l.concat(t(a,i)):(s=!!d[o],"br"!=o||!a.data("cke-eol")||u&&u!=h-1||(m=(r=u?l[u-1].node:f.getItem(u+1))&&(!e(r)||!r.is("br")),r=r&&e(r)&&c.$block[r.getName()]),-1!=p||s||(p=u),s||(g=u),l.push({isElement:1,isLineBreak:m,isBlock:a.isBlockBoundary(),hasBlockSibling:r,node:a,name:o,allowed:s}),r=m=0)):l.push({isElement:0,node:a,allowed:1});return-1<p&&(l[p].firstNotAllowed=1),-1<g&&(l[g].lastNotAllowed=1),l}function i(t,n){var a,r=[],o=t.getChildren(),s=o.count(),l=0,d=c[n],u=!t.is(c.$inline)||t.is("br");for(u&&r.push(" ");l<s;l++)e(a=o.getItem(l))&&!a.is(d)?r=r.concat(i(a,n)):r.push(a);return u&&r.push(" "),r}function a(t){return e(t.startContainer)&&t.startContainer.getChild(t.startOffset-1)}function r(t){return t&&e(t)&&(t.is(c.$removeEmpty)||t.is("a")&&!t.isBlockBoundary())}function d(t,n,i,a){var r,o,s=t.clone();s.setEndAt(n,CKEDITOR.POSITION_BEFORE_END),(r=new CKEDITOR.dom.walker(s).next())&&e(r)&&u[r.getName()]&&(o=r.getPrevious())&&e(o)&&!o.getParent().equals(t.startContainer)&&i.contains(o)&&a.contains(r)&&r.isIdentical(o)&&(r.moveChildren(o),r.remove(),d(t,n,i,a))}var c=CKEDITOR.dtd,u={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},f={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},h=CKEDITOR.tools.extend({},c.$inline);return delete h.br,function(u,p,m,v){var E,T=u.editor,C=!1;if("unfiltered_html"==p&&(p="html",C=!0),!v.checkReadOnly()){C=(p={type:p,dontFilter:C,editable:u,editor:T,range:v,blockLimit:_=new CKEDITOR.dom.elementPath(v.startContainer,v.root).blockLimit||v.root,mergeCandidates:[],zombies:[]}).range;var I,b,y,D,O,R,_=p.mergeCandidates,x="html"===p.type;if("text"==p.type&&C.shrink(CKEDITOR.SHRINK_ELEMENT,!0,!1)&&(b=CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",C.document),C.insertNode(b),C.setStartAfter(b)),y=new CKEDITOR.dom.elementPath(C.startContainer),p.endPath=D=new CKEDITOR.dom.elementPath(C.endContainer),!C.collapsed){I=D.block||D.blockLimit;var w=C.getCommonAncestor();I&&!I.equals(w)&&!I.contains(w)&&C.checkEndOfBlock()&&p.zombies.push(I),C.deleteContents()}for(;(O=a(C))&&e(O)&&O.isBlockBoundary()&&y.contains(O);)C.moveToPosition(O,CKEDITOR.POSITION_BEFORE_END);for(d(C,p.blockLimit,y,D),b&&(C.setEndBefore(b),C.collapse(),b.remove()),(I=(b=C.startPath()).contains(r,!1,1))&&(E=C.splitElement(I),p.inlineStylesRoot=I,p.inlineStylesPeak=b.lastElement),b=C.createBookmark(),x&&(l(I),l(E)),(I=b.startNode.getPrevious(n))&&e(I)&&r(I)&&_.push(I),(I=b.startNode.getNext(n))&&e(I)&&r(I)&&_.push(I),I=b.startNode;(I=I.getParent())&&r(I);)_.push(I);if(C.moveToBookmark(b),E=""===(E=u.getHtml())||E.match(g),T.enterMode===CKEDITOR.ENTER_DIV&&E&&((T=u.getFirst())&&T.remove(),v.setStartAt(u,CKEDITOR.POSITION_AFTER_START),v.collapse(!0)),u=m){if(u=p.range,"text"==p.type&&p.inlineStylesRoot){for(T=(v=p.inlineStylesPeak).getDocument().createText("{cke-peak}"),E=p.inlineStylesRoot.getParent();!v.equals(E);)T=T.appendTo(v.clone()),v=v.getParent();m=T.getOuterHtml().split("{cke-peak}").join(m)}if(v=p.blockLimit.getName(),/^\s+|\s+$/.test(m)&&"span"in CKEDITOR.dtd[v]&&(m=(P='<span data-cke-marker="1">&nbsp;</span>')+m+P),m=p.editor.dataProcessor.toHtml(m,{context:null,fixForBody:!1,protectedWhitespaces:!!P,dontFilter:p.dontFilter,filter:p.editor.activeFilter,enterMode:p.editor.activeEnterMode}),(v=u.document.createElement("body")).setHtml(m),P&&(v.getFirst().remove(),v.getLast().remove()),(P=u.startPath().block)&&(1!=P.getChildCount()||!P.getBogus()))e:{var k;if(1==v.getChildCount()&&e(k=v.getFirst())&&k.is(f)&&!k.hasAttribute("contenteditable")){for(u=0,E=(P=k.getElementsByTag("*")).count();u<E;u++)if(!(T=P.getItem(u)).is(h))break e;k.moveChildren(k.getParent(1)),k.remove()}}p.dataWrapper=v,u=m}if(u){u=(k=p.range).document,v=p.blockLimit,E=0;var K,N,S,A,M,P=[];for(m=b=0,T=k.startContainer,C=(O=p.endPath.elements[0]).getPosition(T),_=!(!O.getCommonAncestor(T)||C==CKEDITOR.POSITION_IDENTICAL||C&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED),T=t(p.dataWrapper,p),p.editor.enterMode!==CKEDITOR.ENTER_BR&&function(t,n){function i(t,n){if(n.isBlock&&n.isElement&&!n.node.is("br")&&e(t)&&t.is("br"))return t.remove(),1}var a=n.endContainer.getChild(n.endOffset),r=n.endContainer.getChild(n.endOffset-1);a&&i(a,t[t.length-1]),r&&i(r,t[0])&&(n.setEnd(n.endContainer,n.endOffset-1),n.collapse())}(T,k);E<T.length;E++)if((x=(C=T[E]).isLineBreak)&&(x=k,I=v,D=y=void 0,C.hasBlockSibling?x=1:(y=x.startContainer.getAscendant(c.$block,1))&&y.is({div:1,p:1})?(D=y.getPosition(I))==CKEDITOR.POSITION_IDENTICAL||D==CKEDITOR.POSITION_CONTAINS?x=0:(I=x.splitElement(y),x.moveToPosition(I,CKEDITOR.POSITION_AFTER_START),x=1):x=0),x)m=0<E;else{if(x=k.startPath(),!C.isBlock&&o(p.editor,x.block,x.blockLimit)&&(S=s(p.editor))&&((S=u.createElement(S)).appendBogus(),k.insertNode(S),CKEDITOR.env.needsBrFiller&&(K=S.getBogus())&&K.remove(),k.moveToPosition(S,CKEDITOR.POSITION_BEFORE_END)),(x=k.startPath().block)&&!x.equals(N)&&((K=x.getBogus())&&(K.remove(),P.push(x)),N=x),C.firstNotAllowed&&(b=1),b&&C.isElement){for(x=k.startContainer,I=null;x&&!c[x.getName()][C.name];){if(x.equals(v)){x=null;break}I=x,x=x.getParent()}if(x)I&&(A=k.splitElement(I),p.zombies.push(A),p.zombies.push(I));else{I=v.getName(),M=!E,x=E==T.length-1,y=[],D=(I=i(C.node,I)).length,w=0;for(var L=void 0,F=0,B=-1;w<D;w++)" "==(L=I[w])?(F||M&&!w||(y.push(new CKEDITOR.dom.text(" ")),B=y.length),F=1):(y.push(L),F=0);x&&B==y.length&&y.pop(),M=y}}if(M){for(;x=M.pop();)k.insertNode(x);M=0}else k.insertNode(C.node);C.lastNotAllowed&&E<T.length-1&&((A=_?O:A)&&k.setEndAt(A,CKEDITOR.POSITION_AFTER_START),b=0),k.collapse()}(K=1==T.length&&(K=T[0]).isElement&&"false"==K.node.getAttribute("contenteditable"))&&(m=!0,x=T[0].node,k.setStartAt(x,CKEDITOR.POSITION_BEFORE_START),k.setEndAt(x,CKEDITOR.POSITION_AFTER_END)),p.dontMoveCaret=m,p.bogusNeededBlocks=P}for(K=p.range,M=p.bogusNeededBlocks,N=K.createBookmark();S=p.zombies.pop();)S.getParent()&&((A=K.clone()).moveToElementEditStart(S),A.removeEmptyBlocksAtEnd());if(M)for(;S=M.pop();)CKEDITOR.env.needsBrFiller?S.appendBogus():S.append(K.document.createText(" "));for(;S=p.mergeCandidates.pop();)S.mergeSiblings();if(CKEDITOR.env.webkit&&K.startPath()&&((S=K.startPath()).block?S.block.$.normalize():S.blockLimit&&S.blockLimit.$.normalize()),K.moveToBookmark(N),!p.dontMoveCaret){for(S=a(K);S&&e(S)&&!S.is(c.$empty);){if(S.isBlockBoundary())K.moveToPosition(S,CKEDITOR.POSITION_BEFORE_END);else{if(r(S)&&S.getHtml().match(/(\s|&nbsp;)$/g)){R=null;break}(R=K.clone()).moveToPosition(S,CKEDITOR.POSITION_BEFORE_END)}S=S.getLast(n)}R&&K.moveToRange(R)}}}}(),v=function(){function e(e){return(e=new CKEDITOR.dom.walker(e)).guard=function(e,t){return!t&&(e.type==CKEDITOR.NODE_ELEMENT?e.is(CKEDITOR.dtd.$tableContent):void 0)},e.evaluator=function(e){return e.type==CKEDITOR.NODE_ELEMENT},e}function t(e,t,n){return t=e.getDocument().createElement(t),e.append(t,n),t}function n(e){for(var t,n=e.count();0<n--;)t=e.getItem(n),CKEDITOR.tools.trim(t.getHtml())||(t.appendBogus(),CKEDITOR.env.ie&&9>CKEDITOR.env.version&&t.getChildCount()&&t.getFirst().remove())}return function(i){var a=i.startContainer,r=a.getAscendant("table",1),o=!1;n(r.getElementsByTag("td")),n(r.getElementsByTag("th")),(r=i.clone()).setStart(a,0),(r=e(r).lastBackward())||((r=i.clone()).setEndAt(a,CKEDITOR.POSITION_BEFORE_END),r=e(r).lastForward(),o=!0),r||(r=a),r.is("table")?(i.setStartAt(r,CKEDITOR.POSITION_BEFORE_START),i.collapse(!0),r.remove()):(r.is({tbody:1,thead:1,tfoot:1})&&(r=t(r,"tr",o)),r.is("tr")&&(r=t(r,r.getParent().is("thead")?"th":"td",o)),(a=r.getBogus())&&a.remove(),i.moveToPosition(r,o?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END))}}(),E=function(){function e(e){return(e=new CKEDITOR.dom.walker(e)).guard=function(e,t){return!t&&(e.type==CKEDITOR.NODE_ELEMENT?e.is(CKEDITOR.dtd.$list)||e.is(CKEDITOR.dtd.$listItem):void 0)},e.evaluator=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is(CKEDITOR.dtd.$listItem)},e}return function(t){var n,i=t.startContainer,a=!1;(n=t.clone()).setStart(i,0),(n=e(n).lastBackward())||((n=t.clone()).setEndAt(i,CKEDITOR.POSITION_BEFORE_END),n=e(n).lastForward(),a=!0),n||(n=i),n.is(CKEDITOR.dtd.$list)?(t.setStartAt(n,CKEDITOR.POSITION_BEFORE_START),t.collapse(!0),n.remove()):((i=n.getBogus())&&i.remove(),t.moveToPosition(n,a?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),t.select())}}(),T={eol:{detect:function(e,t){var n=e.range,i=n.clone(),a=n.clone(),r=new CKEDITOR.dom.elementPath(n.startContainer,t),o=new CKEDITOR.dom.elementPath(n.endContainer,t);i.collapse(1),a.collapse(),r.block&&i.checkBoundaryOfElement(r.block,CKEDITOR.END)&&(n.setStartAfter(r.block),e.prependEolBr=1),o.block&&a.checkBoundaryOfElement(o.block,CKEDITOR.START)&&(n.setEndBefore(o.block),e.appendEolBr=1)},fix:function(e,t){var n,i=t.getDocument();e.appendEolBr&&(n=this.createEolBr(i),e.fragment.append(n)),!e.prependEolBr||n&&!n.getPrevious()||e.fragment.append(this.createEolBr(i),1)},createEolBr:function(e){return e.createElement("br",{attributes:{"data-cke-eol":1}})}},bogus:{exclude:function(e){var t,n=(t=e.range.getBoundaryNodes()).startNode;!(t=t.endNode)||!p(t)||n&&n.equals(t)||e.range.setEndBefore(t)}},tree:{rebuild:function(e,t){var n,i=(o=e.range).getCommonAncestor(),a=new CKEDITOR.dom.elementPath(i,t),r=new CKEDITOR.dom.elementPath(o.startContainer,t),o=new CKEDITOR.dom.elementPath(o.endContainer,t);if(i.type==CKEDITOR.NODE_TEXT&&(i=i.getParent()),a.blockLimit.is({tr:1,table:1})){var s=a.contains("table").getParent();n=function(e){return!e.equals(s)}}else if(a.block&&a.block.is(CKEDITOR.dtd.$listItem)&&(r=r.contains(CKEDITOR.dtd.$list),o=o.contains(CKEDITOR.dtd.$list),!r.equals(o))){var l=a.contains(CKEDITOR.dtd.$list).getParent();n=function(e){return!e.equals(l)}}n||(n=function(e){return!e.equals(a.block)&&!e.equals(a.blockLimit)}),this.rebuildFragment(e,t,i,n)},rebuildFragment:function(e,t,n,i){for(var a;n&&!n.equals(t)&&i(n);)a=n.clone(0,1),e.fragment.appendTo(a),e.fragment=a,n=n.getParent()}},cell:{shrink:function(e){var t=(e=e.range).startContainer,n=e.endContainer,i=e.startOffset,a=e.endOffset;t.type==CKEDITOR.NODE_ELEMENT&&t.equals(n)&&t.is("tr")&&++i==a&&e.shrink(CKEDITOR.SHRINK_TEXT)}}},C=function(){function e(e,t){var n=e.getParent();n.is(CKEDITOR.dtd.$inline)&&e[t?"insertBefore":"insertAfter"](n)}function t(t,n,i){e(n),e(i,1);for(var a;a=i.getNext();)a.insertAfter(n),n=a;h(t)&&t.remove()}function n(e,t){var n=new CKEDITOR.dom.range(e);return n.setStartAfter(t.startNode),n.setEndBefore(t.endNode),n}return{list:{detectMerge:function(e,t){var i=n(t,e.bookmark),a=i.startPath(),r=i.endPath(),o=a.contains(CKEDITOR.dtd.$list),s=r.contains(CKEDITOR.dtd.$list);e.mergeList=o&&s&&o.getParent().equals(s.getParent())&&!o.equals(s),e.mergeListItems=a.block&&r.block&&a.block.is(CKEDITOR.dtd.$listItem)&&r.block.is(CKEDITOR.dtd.$listItem),(e.mergeList||e.mergeListItems)&&((i=i.clone()).setStartBefore(e.bookmark.startNode),i.setEndAfter(e.bookmark.endNode),e.mergeListBookmark=i.createBookmark())},merge:function(e,n){if(e.mergeListBookmark){var i=e.mergeListBookmark.startNode,a=e.mergeListBookmark.endNode,r=new CKEDITOR.dom.elementPath(i,n),o=new CKEDITOR.dom.elementPath(a,n);if(e.mergeList){var s=r.contains(CKEDITOR.dtd.$list),l=o.contains(CKEDITOR.dtd.$list);s.equals(l)||(l.moveChildren(s),l.remove())}e.mergeListItems&&(r=r.contains(CKEDITOR.dtd.$listItem),o=o.contains(CKEDITOR.dtd.$listItem),r.equals(o)||t(o,i,a)),i.remove(),a.remove()}}},block:{detectMerge:function(e,t){if(!e.tableContentsRanges&&!e.mergeListBookmark){var n=new CKEDITOR.dom.range(t);n.setStartBefore(e.bookmark.startNode),n.setEndAfter(e.bookmark.endNode),e.mergeBlockBookmark=n.createBookmark()}},merge:function(e,n){if(e.mergeBlockBookmark&&!e.purgeTableBookmark){var i=e.mergeBlockBookmark.startNode,a=e.mergeBlockBookmark.endNode,r=new CKEDITOR.dom.elementPath(i,n),o=new CKEDITOR.dom.elementPath(a,n);r=r.block,o=o.block,r&&o&&!r.equals(o)&&t(o,i,a),i.remove(),a.remove()}}},table:function(){function e(e){var n,a=[],r=new CKEDITOR.dom.walker(e),o=e.startPath().contains(i),s=e.endPath().contains(i),l={};return r.guard=function(r,d){if(r.type==CKEDITOR.NODE_ELEMENT){var c="visited_"+(d?"out":"in");if(r.getCustomData(c))return;CKEDITOR.dom.element.setMarker(l,r,c,1)}if(d&&o&&r.equals(o))(n=e.clone()).setEndAt(o,CKEDITOR.POSITION_BEFORE_END),a.push(n);else if(!d&&s&&r.equals(s))(n=e.clone()).setStartAt(s,CKEDITOR.POSITION_AFTER_START),a.push(n);else{if((c=!d)&&(c=r.type==CKEDITOR.NODE_ELEMENT&&r.is(i)&&(!o||t(r,o))&&(!s||t(r,s))),!c&&(c=d))if(r.is(i)){c=o&&o.getAscendant("table",!0);var u=s&&s.getAscendant("table",!0),f=r.getAscendant("table",!0);c=c&&c.contains(f)||u&&u.contains(f)}else c=void 0;c&&((n=e.clone()).selectNodeContents(r),a.push(n))}},r.lastForward(),CKEDITOR.dom.element.clearAllMarkers(l),a}function t(e,t){var n=CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED,i=e.getPosition(t);return i!==CKEDITOR.POSITION_IDENTICAL&&!(i&n)}var i={td:1,th:1,caption:1};return{detectPurge:function(e){var t=e.range;(n=t.clone()).enlarge(CKEDITOR.ENLARGE_ELEMENT);var n=new CKEDITOR.dom.walker(n),a=0;if(n.evaluator=function(e){e.type==CKEDITOR.NODE_ELEMENT&&e.is(i)&&++a},n.checkForward(),1<a){n=t.startPath().contains("table");var r=t.endPath().contains("table");n&&r&&t.checkBoundaryOfElement(n,CKEDITOR.START)&&t.checkBoundaryOfElement(r,CKEDITOR.END)&&((t=e.range.clone()).setStartBefore(n),t.setEndAfter(r),e.purgeTableBookmark=t.createBookmark())}},detectRanges:function(a,r){var o,s,l=n(r,a.bookmark),d=l.clone(),c=l.getCommonAncestor();c.is(CKEDITOR.dtd.$tableContent)&&!c.is(i)&&(c=c.getAscendant("table",!0)),s=c,c=new CKEDITOR.dom.elementPath(l.startContainer,s),s=new CKEDITOR.dom.elementPath(l.endContainer,s),c=c.contains("table"),s=s.contains("table"),(c||s)&&(c&&s&&t(c,s)?(a.tableSurroundingRange=d,d.setStartAt(c,CKEDITOR.POSITION_AFTER_END),d.setEndAt(s,CKEDITOR.POSITION_BEFORE_START),(d=l.clone()).setEndAt(c,CKEDITOR.POSITION_AFTER_END),(o=l.clone()).setStartAt(s,CKEDITOR.POSITION_BEFORE_START),o=e(d).concat(e(o))):c?s||(a.tableSurroundingRange=d,d.setStartAt(c,CKEDITOR.POSITION_AFTER_END),l.setEndAt(c,CKEDITOR.POSITION_AFTER_END)):(a.tableSurroundingRange=d,d.setEndAt(s,CKEDITOR.POSITION_BEFORE_START),l.setStartAt(s,CKEDITOR.POSITION_AFTER_START)),a.tableContentsRanges=o||e(l))},deleteRanges:function(e){for(var t;t=e.tableContentsRanges.pop();)t.extractContents(),h(t.startContainer)&&t.startContainer.appendBogus();e.tableSurroundingRange&&e.tableSurroundingRange.extractContents()},purge:function(e){if(e.purgeTableBookmark){var t=e.doc,n=e.range.clone();(t=t.createElement("p")).insertBefore(e.purgeTableBookmark.startNode),n.moveToBookmark(e.purgeTableBookmark),n.deleteContents(),e.range.moveToPosition(t,CKEDITOR.POSITION_AFTER_START)}}}}(),detectExtractMerge:function(e){return!(e.range.startPath().contains(CKEDITOR.dtd.$listItem)&&e.range.endPath().contains(CKEDITOR.dtd.$listItem))},fixUneditableRangePosition:function(e){e.startContainer.getDtd()["#"]||e.moveToClosestEditablePosition(null,!0)},autoParagraph:function(e,t){var n,i=t.startPath();o(e,i.block,i.blockLimit)&&(n=s(e))&&((n=t.document.createElement(n)).appendBogus(),t.insertNode(n),t.moveToPosition(n,CKEDITOR.POSITION_AFTER_START))}}}()}(),function(){function e(e){return CKEDITOR.plugins.widget&&CKEDITOR.plugins.widget.isDomWidget(e)}function t(t,n){if(0===t.length||e(t[0].getEnclosedNode()))return!1;var i,a;if((i=!n&&1===t.length)&&!(i=t[0].collapsed)){var r=t[0];i=r.startContainer.getAscendant({td:1,th:1},!0);var o=r.endContainer.getAscendant({td:1,th:1},!0);a=CKEDITOR.tools.trim,i=!(!i||!i.equals(o)||i.findOne("td, th, tr, tbody, table")||(r=r.cloneContents()).getFirst()&&a(r.getFirst().getText())===a(i.getText()))}if(i)return!1;for(a=0;a<t.length;a++)if(!(i=t[a]._getTableElement()))return!1;return!0}function n(e){var t=this.root.editor,n=t.getSelection(1);this.reset(),f=!0,n.root.once("selectionchange",(function(e){e.cancel()}),null,null,0),n.selectRanges([e[0]]),(n=this._.cache).ranges=new CKEDITOR.dom.rangeList(e),n.type=CKEDITOR.SELECTION_TEXT,n.selectedElement=e[0]._getTableElement(),n.selectedText=function(e){e=function(e){function t(e){e=e.find("td, th");var t,n=[];for(t=0;t<e.count();t++)n.push(e.getItem(t));return n}var n,i,a=[];for(i=0;i<e.length;i++)(n=e[i]._getTableElement()).is&&n.is({td:1,th:1})?a.push(n):a=a.concat(t(n));return a}(e);var t,n,i="",a=[];for(n=0;n<e.length;n++)t&&!t.equals(e[n].getAscendant("tr"))?(i+=a.join("\t")+"\n",t=e[n].getAscendant("tr"),a=[]):0===n&&(t=e[n].getAscendant("tr")),a.push(e[n].getText());return i+a.join("\t")}(e),n.nativeSel=null,this.isFake=1,this.rev=m++,t._.fakeSelection=this,f=!1,this.root.fire("selectionchange")}function i(){var n,i=this._.fakeSelection;if(i){var a;if(!(a=!(n=this.getSelection(1)))&&(a=!n.isHidden())){a=i;var r=n.getRanges(),o=a.getRanges(),s=r.length&&r[0]._getTableElement()&&r[0]._getTableElement().getAscendant("table",!0),l=o.length&&o[0]._getTableElement()&&o[0]._getTableElement().getAscendant("table",!0),d=1===r.length&&r[0]._getTableElement()&&r[0]._getTableElement().is("table"),c=1===o.length&&o[0]._getTableElement()&&o[0]._getTableElement().is("table");if(e(a.getSelectedElement()))a=!1;else{var u=1===r.length&&r[0].collapsed;o=t(r,!!CKEDITOR.env.webkit)&&t(o),(s=!(!s||!l)&&(s.equals(l)||l.contains(s)))&&(u||o)?(d&&!c&&a.selectRanges(r),a=!0):a=!1}a=!a}a&&(i.reset(),i=0)}(i||(i=n||this.getSelection(1))&&i.getType()!=CKEDITOR.SELECTION_NONE)&&(this.fire("selectionCheck",i),(n=this.elementPath()).compare(this._.selectionPreviousPath)||(a=this._.selectionPreviousPath&&this._.selectionPreviousPath.blockLimit.equals(n.blockLimit),!CKEDITOR.env.webkit&&!CKEDITOR.env.gecko||a||(this._.previousActive=this.document.getActive()),this._.selectionPreviousPath=n,this.fire("selectionChange",{selection:i,path:n})))}function a(){p=!0,h||(r.call(this),h=CKEDITOR.tools.setTimeout(r,200,this))}function r(){h=null,p&&(CKEDITOR.tools.setTimeout(i,0,this),p=!1)}function o(e){return!(!T(e)&&(e.type!=CKEDITOR.NODE_ELEMENT||e.is(CKEDITOR.dtd.$empty)))}function s(e){function t(t,n){return!(!t||t.type==CKEDITOR.NODE_TEXT)&&e.clone()["moveToElementEdit"+(n?"End":"Start")](t)}if(!(e.root instanceof CKEDITOR.editable))return!1;var n=e.startContainer,i=e.getPreviousNode(o,null,n),a=e.getNextNode(o,null,n);return!(!t(i)&&!t(a,1)&&(i||a||n.type==CKEDITOR.NODE_ELEMENT&&n.isBlockBoundary()&&n.getBogus()))}function l(e){d(e,!1);var t=e.getDocument().createText(v);return e.setCustomData("cke-fillingChar",t),t}function d(e,t){var n=e&&e.removeCustomData("cke-fillingChar");if(n){if(!1!==t){var i=e.getDocument().getSelection().getNative(),a=i&&"None"!=i.type&&i.getRangeAt(0),r=v.length;if(n.getLength()>r&&a&&a.intersectsNode(n.$)){var o=[{node:i.anchorNode,offset:i.anchorOffset},{node:i.focusNode,offset:i.focusOffset}];i.anchorNode==n.$&&i.anchorOffset>r&&(o[0].offset-=r),i.focusNode==n.$&&i.focusOffset>r&&(o[1].offset-=r)}}n.setText(c(n.getText(),1)),o&&(i=(n=e.getDocument().$).getSelection(),(n=n.createRange()).setStart(o[0].node,o[0].offset),n.collapse(!0),i.removeAllRanges(),i.addRange(n),i.extend(o[1].node,o[1].offset))}}function c(e,t){return t?e.replace(E,(function(e,t){return t?" ":""})):e.replace(v,"")}function u(t){var n={35:1,36:1,2228259:1,2228260:1,2228261:1,2228262:1,2228263:1,2228264:1,1114149:1,1114151:1,3342373:1,3342375:1},i=CKEDITOR.tools.extend({8:1,37:1,39:1,46:1},n);return function(a){var r=a.data.getKeystroke();if(i[r]){var o=t.getSelection(),s=o.getRanges()[0];n[r]?o.isFake&&(r=a.data.getKey(),s.moveToClosestEditablePosition(a.selected,36===r||37===r||38==r),s.select()):o.isCollapsed()&&(s=s[38>r?"getPreviousEditableNode":"getNextEditableNode"]())&&s.type==CKEDITOR.NODE_ELEMENT&&"false"==s.getAttribute("contenteditable")&&(!(o=o.getStartElement()).isBlockBoundary()||""!==(void 0===o.$.textContent?o.$.innerText:o.$.textContent)||e(o.getFirst())||8!==r&&46!==r||(o.remove(),t.fire("saveSnapshot")),t.getSelection().fake(s),a.data.preventDefault(),a.cancel())}}}var f,h,p,g="function"!=typeof window.getSelection,m=1,v=CKEDITOR.tools.repeat("​",7),E=new RegExp(v+"( )?","g"),T=CKEDITOR.dom.walker.invisible(1),C=function(){function e(e){return function(t){var n=t.editor.createRange();return n.moveToClosestEditablePosition(t.selected,e)&&t.editor.getSelection().selectRanges([n]),!1}}function t(e){return function(t){var n,i=t.editor,a=i.createRange();if(!i.readOnly)return(n=a.moveToClosestEditablePosition(t.selected,e))||(n=a.moveToClosestEditablePosition(t.selected,!e)),n&&i.getSelection().selectRanges([a]),i.fire("saveSnapshot"),t.selected.remove(),n||(a.moveToElementEditablePosition(i.editable()),i.getSelection().selectRanges([a])),i.fire("saveSnapshot"),!1}}var n=e(),i=e(1);return{37:n,38:n,39:i,40:i,8:t(),46:t(1)}}();CKEDITOR.on("instanceCreated",(function(e){function t(){var e=n.getSelection();e&&e.removeAllRanges()}var n=e.editor;n.on("contentDom",(function(){function e(){(o=new CKEDITOR.dom.selection(n.getSelection())).lock()}function t(){p.removeListener("mouseup",t),E.removeListener("mouseup",t);var e=CKEDITOR.document.$.selection,n=e.createRange();"None"!=e.type&&n.parentElement()&&n.parentElement().ownerDocument==h.$&&n.select()}var r,o,s,l,c,f,h=n.document,p=CKEDITOR.document,m=n.editable(),v=h.getBody(),E=h.getDocumentElement(),T=m.isInline();CKEDITOR.env.gecko&&m.attachListener(m,"focus",(function(e){e.removeListener(),0!==r&&(e=n.getSelection().getNative())&&e.isCollapsed&&e.anchorNode==m.$&&((e=n.createRange()).moveToElementEditStart(m),e.select())}),null,null,-2),m.attachListener(m,CKEDITOR.env.webkit||CKEDITOR.env.gecko?"focusin":"focus",(function(){if(r&&(CKEDITOR.env.webkit||CKEDITOR.env.gecko)){r=n._.previousActive&&n._.previousActive.equals(h.getActive());var e=null!=n._.previousScrollTop&&n._.previousScrollTop!=m.$.scrollTop;CKEDITOR.env.webkit&&r&&e&&(m.$.scrollTop=n._.previousScrollTop)}n.unlockSelection(r),r=0}),null,null,-1),m.attachListener(m,"mousedown",(function(){r=0})),(CKEDITOR.env.ie||CKEDITOR.env.gecko||T)&&(g?m.attachListener(m,"beforedeactivate",e,null,null,-1):m.attachListener(n,"selectionCheck",e,null,null,-1),m.attachListener(m,CKEDITOR.env.webkit||CKEDITOR.env.gecko?"focusout":"blur",(function(){var e=o&&(o.isFake||2>o.getRanges().length);CKEDITOR.env.gecko&&!T&&e||(n.lockSelection(o),r=1)}),null,null,-1),m.attachListener(m,"mousedown",(function(){r=0}))),CKEDITOR.env.ie&&!T&&(m.attachListener(m,"mousedown",(function(e){2==e.data.$.button&&((e=n.document.getSelection())&&e.getType()!=CKEDITOR.SELECTION_NONE||(s=n.window.getScrollPosition()))})),m.attachListener(m,"mouseup",(function(e){2==e.data.$.button&&s&&(n.document.$.documentElement.scrollLeft=s.x,n.document.$.documentElement.scrollTop=s.y),s=null})),"BackCompat"!=h.$.compatMode)&&((CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&E.on("mousedown",(function(e){function t(e){if(e=e.data.$,c){var t=v.$.createTextRange();try{t.moveToPoint(e.clientX,e.clientY)}catch(e){}c.setEndPoint(0>f.compareEndPoints("StartToStart",t)?"EndToEnd":"StartToStart",t),c.select()}}function n(){E.removeListener("mousemove",t),p.removeListener("mouseup",n),E.removeListener("mouseup",n),c.select()}if((e=e.data).getTarget().is("html")&&e.$.y<E.$.clientHeight&&e.$.x<E.$.clientWidth){c=v.$.createTextRange();try{c.moveToPoint(e.$.clientX,e.$.clientY)}catch(e){}f=c.duplicate(),E.on("mousemove",t),p.on("mouseup",n),E.on("mouseup",n)}})),7<CKEDITOR.env.version&&11>CKEDITOR.env.version&&E.on("mousedown",(function(e){e.data.getTarget().is("html")&&(p.on("mouseup",t),E.on("mouseup",t))}))),m.attachListener(m,"selectionchange",i,n),m.attachListener(m,"keyup",a,n),m.attachListener(m,"touchstart",a,n),m.attachListener(m,"touchend",a,n),CKEDITOR.env.ie&&m.attachListener(m,"keydown",(function(e){var t,n;(t=!!(t=this.document.getActive())&&("input"===t.getName()||"textarea"===t.getName()))||(n=function(e){return(e=e.getRanges()[0])&&(e=e.startContainer.getAscendant((function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("contenteditable")}),!0))&&"false"===e.getAttribute("contenteditable")?e:null}(t=this.getSelection(1)))&&!n.equals(m)&&(t.selectElement(n),e.data.preventDefault())}),n),m.attachListener(m,CKEDITOR.env.webkit||CKEDITOR.env.gecko?"focusin":"focus",(function(){n.forceNextSelectionCheck(),n.selectionChange(1)})),T&&(CKEDITOR.env.webkit||CKEDITOR.env.gecko)?(m.attachListener(m,"mousedown",(function(){l=1})),m.attachListener(h.getDocumentElement(),"mouseup",(function(){l&&a.call(n),l=0}))):m.attachListener(CKEDITOR.env.ie?m:h.getDocumentElement(),"mouseup",a,n),CKEDITOR.env.webkit&&m.attachListener(h,"keydown",(function(e){switch(e.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:m.hasFocus&&d(m)}}),null,null,-1),m.attachListener(m,"keydown",u(n),null,null,-1)})),n.on("setData",(function(){n.unlockSelection(),CKEDITOR.env.webkit&&t()})),n.on("contentDomUnload",(function(){n.unlockSelection()})),CKEDITOR.env.ie9Compat&&n.on("beforeDestroy",t,null,null,9),n.on("dataReady",(function(){delete n._.fakeSelection,delete n._.hiddenSelectionContainer,n.selectionChange(1)})),n.on("loadSnapshot",(function(){var e=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT),t=n.editable().getLast(e);t&&t.hasAttribute("data-cke-hidden-sel")&&(t.remove(),CKEDITOR.env.gecko&&(e=n.editable().getFirst(e))&&e.is("br")&&e.getAttribute("_moz_editor_bogus_node")&&e.remove())}),null,null,100),n.on("key",(function(e){if("wysiwyg"==n.mode){var t=n.getSelection();if(t.isFake){var i=C[e.data.keyCode];if(i)return i({editor:n,selected:t.getSelectedElement(),selection:t,keyEvent:e})}}}))})),CKEDITOR.env.webkit&&CKEDITOR.on("instanceReady",(function(e){var t=e.editor;t.on("selectionChange",(function(){var e=t.editable(),n=e.getCustomData("cke-fillingChar");n&&(n.getCustomData("ready")?(d(e),e.editor.fire("selectionCheck")):n.setCustomData("ready",1))}),null,null,-1),t.on("beforeSetMode",(function(){d(t.editable())}),null,null,-1),t.on("getSnapshot",(function(e){e.data&&(e.data=c(e.data))}),t,null,20),t.on("toDataFormat",(function(e){e.data.dataValue=c(e.data.dataValue)}),null,null,0)})),CKEDITOR.editor.prototype.selectionChange=function(e){(e?i:a).call(this)},CKEDITOR.editor.prototype.getSelection=function(e){return!this._.savedSelection&&!this._.fakeSelection||e?(e=this.editable())&&"wysiwyg"==this.mode&&"recreating"!==this.status?new CKEDITOR.dom.selection(e):null:this._.savedSelection||this._.fakeSelection},CKEDITOR.editor.prototype.getSelectedRanges=function(e){var t=this.getSelection();return t&&t.getRanges(e)||[]},CKEDITOR.editor.prototype.lockSelection=function(e){return(e=e||this.getSelection(1)).getType()!=CKEDITOR.SELECTION_NONE&&(!e.isLocked&&e.lock(),this._.savedSelection=e,!0)},CKEDITOR.editor.prototype.unlockSelection=function(e){var t=this._.savedSelection;return!!t&&(t.unlock(e),delete this._.savedSelection,!0)},CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath},CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this)},CKEDITOR.dom.range.prototype.select=function(){var e=this.root instanceof CKEDITOR.editable?this.root.editor.getSelection():new CKEDITOR.dom.selection(this.root);return e.selectRanges([this]),e},CKEDITOR.SELECTION_NONE=1,CKEDITOR.SELECTION_TEXT=2,CKEDITOR.SELECTION_ELEMENT=3,CKEDITOR.dom.selection=function(e){if(e instanceof CKEDITOR.dom.selection){var t=e;e=e.root}var n,i,a=e instanceof CKEDITOR.dom.element;if(this.rev=t?t.rev:m++,this.document=e instanceof CKEDITOR.dom.document?e:e.getDocument(),this.root=a?e:this.document.getBody(),this.isLocked=0,this._={cache:{}},t)return CKEDITOR.tools.extend(this._.cache,t._.cache),this.isFake=t.isFake,this.isLocked=t.isLocked,this;if(e=this.getNative())if(e.getRangeAt)n=(i=e.rangeCount&&e.getRangeAt(0))&&new CKEDITOR.dom.node(i.commonAncestorContainer);else{try{i=e.createRange()}catch(e){}n=i&&CKEDITOR.dom.element.get(i.item&&i.item(0)||i.parentElement())}return(!n||n.type!=CKEDITOR.NODE_ELEMENT&&n.type!=CKEDITOR.NODE_TEXT||!this.root.equals(n)&&!this.root.contains(n))&&(this._.cache.type=CKEDITOR.SELECTION_NONE,this._.cache.startElement=null,this._.cache.selectedElement=null,this._.cache.selectedText="",this._.cache.ranges=new CKEDITOR.dom.rangeList),this};var I={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.tools.extend(CKEDITOR.dom.selection,{_removeFillingCharSequenceString:c,_createFillingCharSequenceNode:l,FILLING_CHAR_SEQUENCE:v}),CKEDITOR.dom.selection.prototype={getNative:function(){return void 0!==this._.cache.nativeSel?this._.cache.nativeSel:this._.cache.nativeSel=g?this.document.$.selection:this.document.getWindow().$.getSelection()},getType:g?function(){var e=this._.cache;if(e.type)return e.type;var t=CKEDITOR.SELECTION_NONE;try{var n=this.getNative(),i=n.type;"Text"==i&&(t=CKEDITOR.SELECTION_TEXT),"Control"==i&&(t=CKEDITOR.SELECTION_ELEMENT),n.createRange().parentElement()&&(t=CKEDITOR.SELECTION_TEXT)}catch(e){}return e.type=t}:function(){var e=this._.cache;if(e.type)return e.type;var t=CKEDITOR.SELECTION_TEXT;if((n=this.getNative())&&n.rangeCount){if(1==n.rangeCount){var n,i=(n=n.getRangeAt(0)).startContainer;i==n.endContainer&&1==i.nodeType&&1==n.endOffset-n.startOffset&&I[i.childNodes[n.startOffset].nodeName.toLowerCase()]&&(t=CKEDITOR.SELECTION_ELEMENT)}}else t=CKEDITOR.SELECTION_NONE;return e.type=t},getRanges:function(){var e=g?function(){function e(e){return new CKEDITOR.dom.node(e).getIndex()}var t=function(t,n){(t=t.duplicate()).collapse(n);var i=t.parentElement();if(!i.hasChildNodes())return{container:i,offset:0};for(var a,r,o,s,l=i.children,d=t.duplicate(),c=0,u=l.length-1,f=-1;c<=u;)if(a=l[f=Math.floor((c+u)/2)],d.moveToElementText(a),0<(o=d.compareEndPoints("StartToStart",t)))u=f-1;else{if(!(0>o))return{container:i,offset:e(a)};c=f+1}if(-1==f||f==l.length-1&&0>o){if(d.moveToElementText(i),d.setEndPoint("StartToStart",t),d=d.text.replace(/(\r\n|\r)/g,"\n").length,l=i.childNodes,!d)return(a=l[l.length-1]).nodeType!=CKEDITOR.NODE_TEXT?{container:i,offset:l.length}:{container:a,offset:a.nodeValue.length};for(i=l.length;0<d&&0<i;)(r=l[--i]).nodeType==CKEDITOR.NODE_TEXT&&(s=r,d-=r.nodeValue.length);return{container:s,offset:-d}}if(d.collapse(0<o),d.setEndPoint(0<o?"StartToStart":"EndToStart",t),!(d=d.text.replace(/(\r\n|\r)/g,"\n").length))return{container:i,offset:e(a)+(0<o?0:1)};for(;0<d;)try{(r=a[0<o?"previousSibling":"nextSibling"]).nodeType==CKEDITOR.NODE_TEXT&&(d-=r.nodeValue.length,s=r),a=r}catch(t){return{container:i,offset:e(a)}}return{container:s,offset:0<o?-d:s.nodeValue.length+d}};return function(){var e=(s=this.getNative())&&s.createRange(),n=this.getType();if(!s)return[];if(n==CKEDITOR.SELECTION_TEXT)return s=new CKEDITOR.dom.range(this.root),n=t(e,!0),s.setStart(new CKEDITOR.dom.node(n.container),n.offset),n=t(e),s.setEnd(new CKEDITOR.dom.node(n.container),n.offset),s.endContainer.getPosition(s.startContainer)&CKEDITOR.POSITION_PRECEDING&&s.endOffset<=s.startContainer.getIndex()&&s.collapse(),[s];if(n==CKEDITOR.SELECTION_ELEMENT){n=[];for(var i=0;i<e.length;i++){for(var a=e.item(i),r=a.parentNode,o=0,s=new CKEDITOR.dom.range(this.root);o<r.childNodes.length&&r.childNodes[o]!=a;o++);s.setStart(new CKEDITOR.dom.node(r),o),s.setEnd(new CKEDITOR.dom.node(r),o+1),n.push(s)}return n}return[]}}():function(){var e,t=[],n=this.getNative();if(!n)return t;for(var i=0;i<n.rangeCount;i++){var a=n.getRangeAt(i);(e=new CKEDITOR.dom.range(this.root)).setStart(new CKEDITOR.dom.node(a.startContainer),a.startOffset),e.setEnd(new CKEDITOR.dom.node(a.endContainer),a.endOffset),t.push(e)}return t};return function(t){var n=this._.cache,i=n.ranges;return i||(n.ranges=i=new CKEDITOR.dom.rangeList(e.call(this))),t?function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.getCommonAncestor().isReadOnly()&&e.splice(t,1),!n.collapsed){if(n.startContainer.isReadOnly())for(var i,a=n.startContainer;a&&!((i=a.type==CKEDITOR.NODE_ELEMENT)&&a.is("body")||!a.isReadOnly());)i&&"false"==a.getAttribute("contentEditable")&&n.setStartAfter(a),a=a.getParent();a=n.startContainer,i=n.endContainer;var r=n.startOffset,o=n.endOffset,s=n.clone();a&&a.type==CKEDITOR.NODE_TEXT&&(r>=a.getLength()?s.setStartAfter(a):s.setStartBefore(a)),i&&i.type==CKEDITOR.NODE_TEXT&&(o?s.setEndAfter(i):s.setEndBefore(i)),(a=new CKEDITOR.dom.walker(s)).evaluator=function(i){if(i.type==CKEDITOR.NODE_ELEMENT&&i.isReadOnly()){var a=n.clone();return n.setEndBefore(i),n.collapsed&&e.splice(t--,1),i.getPosition(s.endContainer)&CKEDITOR.POSITION_CONTAINS||(a.setStartAfter(i),a.collapsed||e.splice(t+1,0,a)),!0}return!1},a.next()}}return e}(new CKEDITOR.dom.rangeList(i.slice())):i}}(),getStartElement:function(){var e,t=this._.cache;if(void 0!==t.startElement)return t.startElement;switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var n=this.getRanges()[0];if(n){if(n.collapsed)(e=n.startContainer).type!=CKEDITOR.NODE_ELEMENT&&(e=e.getParent());else{for(n.optimize();e=n.startContainer,n.startOffset==(e.getChildCount?e.getChildCount():e.getLength())&&!e.isBlockBoundary();)n.setStartAfter(e);if((e=n.startContainer).type!=CKEDITOR.NODE_ELEMENT)return e.getParent();if((e=e.getChild(n.startOffset))&&e.type==CKEDITOR.NODE_ELEMENT)for(n=e.getFirst();n&&n.type==CKEDITOR.NODE_ELEMENT;)e=n,n=n.getFirst();else e=n.startContainer}e=e.$}}return t.startElement=e?new CKEDITOR.dom.element(e):null},getSelectedElement:function(){var e=this._.cache;if(void 0!==e.selectedElement)return e.selectedElement;var t=this,n=CKEDITOR.tools.tryThese((function(){return t.getNative().createRange().item(0)}),(function(){for(var e,n,i=t.getRanges()[0].clone(),a=2;a&&!((e=i.getEnclosedNode())&&e.type==CKEDITOR.NODE_ELEMENT&&I[e.getName()]&&(n=e));a--)i.shrink(CKEDITOR.SHRINK_ELEMENT);return n&&n.$}));return e.selectedElement=n?new CKEDITOR.dom.element(n):null},getSelectedText:function(){var e=this._.cache;if(void 0!==e.selectedText)return e.selectedText;var t=this.getNative();return t=g?"Control"==t.type?"":t.createRange().text:t.toString(),e.selectedText=t},lock:function(){this.getRanges(),this.getStartElement(),this.getSelectedElement(),this.getSelectedText(),this._.cache.nativeSel=null,this.isLocked=1},unlock:function(e){if(this.isLocked){if(e)var i=this.getSelectedElement(),a=this.getRanges(),r=this.isFake;this.isLocked=0,this.reset(),e&&(e=i||a[0]&&a[0].getCommonAncestor())&&e.getAscendant("body",1)&&((e=this.root.editor)&&e.plugins.tableselection&&e.plugins.tableselection.isSupportedEnvironment(e)&&t(a)?n.call(this,a):r?this.fake(i):i&&2>a.length?this.selectElement(i):this.selectRanges(a))}},reset:function(){this._.cache={},this.isFake=0;var e=this.root.editor;if(e&&e._.fakeSelection)if(this.rev==e._.fakeSelection.rev){delete e._.fakeSelection;var t=e._.hiddenSelectionContainer;if(t){var n=e.checkDirty();e.fire("lockSnapshot"),t.remove(),e.fire("unlockSnapshot"),!n&&e.resetDirty()}delete e._.hiddenSelectionContainer}else CKEDITOR.warn("selection-fake-reset");this.rev=m++},selectElement:function(e){var t=new CKEDITOR.dom.range(this.root);t.setStartBefore(e),t.setEndAfter(e),this.selectRanges([t])},selectRanges:function(e){var i=this.root.editor,a=i&&i._.hiddenSelectionContainer;if(this.reset(),a){a=this.root;for(var r,o=0;o<e.length;++o)(r=e[o]).endContainer.equals(a)&&(r.endOffset=Math.min(r.endOffset,a.getChildCount()))}if(e.length)if(this.isLocked){var c=CKEDITOR.document.getActive();this.unlock(),this.selectRanges(e),this.lock(),c&&!c.equals(this.root)&&c.focus()}else{var u,h,p;if(1==e.length&&!(p=e[0]).collapsed&&(u=p.getEnclosedNode())&&u.type==CKEDITOR.NODE_ELEMENT&&((p=p.clone()).shrink(CKEDITOR.SHRINK_ELEMENT,!0),(h=p.getEnclosedNode())&&h.type==CKEDITOR.NODE_ELEMENT&&(u=h),"false"==u.getAttribute("contenteditable"))||(u=void 0),u)this.fake(u);else if(i&&i.plugins.tableselection&&i.plugins.tableselection.isSupportedEnvironment(i)&&t(e)&&!f&&!e[0]._getTableElement({table:1}).hasAttribute("data-cke-tableselection-ignored"))n.call(this,e);else{if(g){var m,v,E;if(h=CKEDITOR.dom.walker.whitespaces(!0),u=/\ufeff|\u00a0/,p={table:1,tbody:1,tr:1},1<e.length&&(i=e[e.length-1],e[0].setEnd(i.endContainer,i.endOffset)),e=(i=e[0]).collapsed,(a=i.getEnclosedNode())&&a.type==CKEDITOR.NODE_ELEMENT&&a.getName()in I&&(!a.is("a")||!a.getText()))try{return(E=a.$.createControlRange()).addElement(a.$),void E.select()}catch(e){}(i.startContainer.type==CKEDITOR.NODE_ELEMENT&&i.startContainer.getName()in p||i.endContainer.type==CKEDITOR.NODE_ELEMENT&&i.endContainer.getName()in p)&&(i.shrink(CKEDITOR.NODE_ELEMENT,!0),e=i.collapsed),p=(E=i.createBookmark()).startNode,e||(c=E.endNode),(E=i.document.$.body.createTextRange()).moveToElementText(p.$),E.moveStart("character",1),c?((u=i.document.$.body.createTextRange()).moveToElementText(c.$),E.setEndPoint("EndToEnd",u),E.moveEnd("character",-1)):(m=p.getNext(h),v=p.hasAscendant("pre"),m=!(m&&m.getText&&m.getText().match(u))&&(v||!p.hasPrevious()||p.getPrevious().is&&p.getPrevious().is("br")),(v=i.document.createElement("span")).setHtml("&#65279;"),v.insertBefore(p),m&&i.document.createText("\ufeff").insertBefore(p)),i.setStartBefore(p),p.remove(),e?(m?(E.moveStart("character",-1),E.select(),i.document.$.selection.clear()):E.select(),i.moveToPosition(v,CKEDITOR.POSITION_BEFORE_START),v.remove()):(i.setEndBefore(c),c.remove(),E.select())}else{if(!(c=this.getNative()))return;for(this.removeAllRanges(),E=0;E<e.length;E++)if(E<e.length-1&&(m=e[E],v=e[E+1],(u=m.clone()).setStart(m.endContainer,m.endOffset),u.setEnd(v.startContainer,v.startOffset),!u.collapsed&&(u.shrink(CKEDITOR.NODE_ELEMENT,!0),i=u.getCommonAncestor(),u=u.getEnclosedNode(),i.isReadOnly()||u&&u.isReadOnly())))v.setStart(m.startContainer,m.startOffset),e.splice(E--,1);else{i=e[E],v=this.document.$.createRange(),i.collapsed&&CKEDITOR.env.webkit&&s(i)&&(u=l(this.root),i.insertNode(u),(m=u.getNext())&&!u.getPrevious()&&m.type==CKEDITOR.NODE_ELEMENT&&"br"==m.getName()?(d(this.root),i.moveToPosition(m,CKEDITOR.POSITION_BEFORE_START)):i.moveToPosition(u,CKEDITOR.POSITION_AFTER_END)),v.setStart(i.startContainer.$,i.startOffset);try{v.setEnd(i.endContainer.$,i.endOffset)}catch(e){if(!(0<=e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")))throw e;i.collapse(1),v.setEnd(i.endContainer.$,i.endOffset)}c.addRange(v)}}this.reset(),this.root.fire("selectionchange")}}},fake:function(e,t){var n=this.root.editor;void 0===t&&e.hasAttribute("aria-label")&&(t=e.getAttribute("aria-label")),this.reset(),function(e,t){var n=t&&CKEDITOR.tools.htmlEncode(t)||"&nbsp;";n=CKEDITOR.dom.element.createFromHtml('<div data-cke-hidden-sel="1" data-cke-temp="1" style="'+(CKEDITOR.env.ie&&14>CKEDITOR.env.version?"display:none":"position:fixed;top:0;left:-1000px;width:0;height:0;overflow:hidden;")+'">'+n+"</div>",e.document),e.fire("lockSnapshot"),e.editable().append(n);var i=e.getSelection(1),a=e.createRange(),r=i.root.on("selectionchange",(function(e){e.cancel()}),null,null,0);a.setStartAt(n,CKEDITOR.POSITION_AFTER_START),a.setEndAt(n,CKEDITOR.POSITION_BEFORE_END),i.selectRanges([a]),r.removeListener(),e.fire("unlockSnapshot"),e._.hiddenSelectionContainer=n}(n,t);var i=this._.cache,a=new CKEDITOR.dom.range(this.root);a.setStartBefore(e),a.setEndAfter(e),i.ranges=new CKEDITOR.dom.rangeList(a),i.selectedElement=i.startElement=e,i.type=CKEDITOR.SELECTION_ELEMENT,i.selectedText=i.nativeSel=null,this.isFake=1,this.rev=m++,n._.fakeSelection=this,this.root.fire("selectionchange")},isHidden:function(){var e=this.getCommonAncestor();return e&&e.type==CKEDITOR.NODE_TEXT&&(e=e.getParent()),!(!e||!e.data("cke-hidden-sel"))},isInTable:function(e){return t(this.getRanges(),e)},isCollapsed:function(){var e=this.getRanges();return 1===e.length&&e[0].collapsed},createBookmarks:function(e){return e=this.getRanges().createBookmarks(e),this.isFake&&(e.isFake=1),e},createBookmarks2:function(e){return e=this.getRanges().createBookmarks2(e),this.isFake&&(e.isFake=1),e},selectBookmarks:function(e){for(var n,i=[],a=0;a<e.length;a++){var r=new CKEDITOR.dom.range(this.root);r.moveToBookmark(e[a]),i.push(r)}return e.isFake&&((n=t(i)?i[0]._getTableElement():i[0].getEnclosedNode())&&n.type==CKEDITOR.NODE_ELEMENT||(CKEDITOR.warn("selection-not-fake"),e.isFake=0)),e.isFake&&!t(i)?this.fake(n):this.selectRanges(i),this},getCommonAncestor:function(){var e=this.getRanges();return e.length?e[0].startContainer.getCommonAncestor(e[e.length-1].endContainer):null},scrollIntoView:function(){this.getType()!=CKEDITOR.SELECTION_NONE&&this.getRanges()[0].scrollIntoView()},removeAllRanges:function(){if(this.getType()!=CKEDITOR.SELECTION_NONE){var e=this.getNative();try{e&&e[g?"empty":"removeAllRanges"]()}catch(e){}this.reset()}}}}(),CKEDITOR.STYLE_BLOCK=1,CKEDITOR.STYLE_INLINE=2,CKEDITOR.STYLE_OBJECT=3,function(){function e(e,t){for(var n,i;(e=e.getParent())&&!e.equals(t);)if(e.getAttribute("data-nostyle"))n=e;else if(!i){var a=e.getAttribute("contentEditable");"false"==a?n=e:"true"==a&&(i=1)}return n}function t(e,t,n,i){return(e.getPosition(t)|i)==i&&(!n.childRule||n.childRule(e))}function n(i){var r=i.document;if(i.collapsed)r=g(this,r),i.insertNode(r),i.moveToPosition(r,CKEDITOR.POSITION_BEFORE_END);else{var o,s=this.element,l=this._.definition,d=(E=l.ignoreReadonly)||l.includeReadonly;null==d&&(d=i.root.getCustomData("cke_includeReadonly"));var c=CKEDITOR.dtd[s];c||(o=!0,c=CKEDITOR.dtd.span),i.enlarge(CKEDITOR.ENLARGE_INLINE,1),i.trim();var u,h=i.createBookmark(),p=h.startNode,m=h.endNode,v=p;if(!E){var E=e(p,T=i.getCommonAncestor()),T=e(m,T);E&&(v=E.getNextSourceNode(!0)),T&&(m=T)}for(v.getPosition(m)==CKEDITOR.POSITION_FOLLOWING&&(v=0);v;){if(E=!1,v.equals(m))v=null,E=!0;else{T=(_=v.type==CKEDITOR.NODE_ELEMENT?v.getName():null)&&"false"==v.getAttribute("contentEditable");var C=_&&-1!==CKEDITOR.tools.array.indexOf(CKEDITOR.style.unstylableElements,_);if(C=_&&(v.getAttribute("data-nostyle")||C),_&&v.data("cke-bookmark")||v.type===CKEDITOR.NODE_COMMENT){v=v.getNextSourceNode(!0);continue}if(T&&d&&CKEDITOR.dtd.$block[_])for(var I=void 0,b=0,y=(A=(S=a(y=v)).length)&&new CKEDITOR.dom.range(y.getDocument());b<A;++b){I=S[b];var D=CKEDITOR.filter.instances[I.data("cke-filter")];D&&!D.check(this)||(y.selectNodeContents(I),n.call(this,y))}if(S=_?!c[_]||C||T&&!d?0:t(v,m,l,x):1){if(S=l,A=s,b=o,!(I=v.getParent())||!(I.getDtd()||CKEDITOR.dtd.span)[A]&&!b||S.parentRule&&!S.parentRule(I))E=!0;else if(u||_&&CKEDITOR.dtd.$removeEmpty[_]&&(v.getPosition(m)|x)!=x||(u=i.clone()).setStartBefore(v),(_=v.type)==CKEDITOR.NODE_TEXT||T||_==CKEDITOR.NODE_ELEMENT&&!v.getChildCount()){for(var O,_=v;(E=!_.getNext(R))&&c[(O=_.getParent()).getName()]&&t(O,p,l,w);)_=O;u.setEndAfter(_)}}else E=!0;v=v.getNextSourceNode(C||T)}if(E&&u&&!u.collapsed){T=(E=g(this,r)).hasAttributes(),C=u.getCommonAncestor(),_={};for(var k,K,N,S={},A=(I={},{});E&&C;){if(C.getName()==s){for(k in l.attributes)!A[k]&&(N=C.getAttribute(K))&&(E.getAttribute(k)==N?S[k]=1:A[k]=1);for(K in l.styles)!I[K]&&(N=C.getStyle(K))&&(E.getStyle(K)==N?_[K]=1:I[K]=1)}C=C.getParent()}for(k in S)E.removeAttribute(k);for(K in _)E.removeStyle(K);T&&!E.hasAttributes()&&(E=null),E?(u.extractContents().appendTo(E),u.insertNode(E),f.call(this,E),E.mergeSiblings(),CKEDITOR.env.ie||E.$.normalize()):(E=new CKEDITOR.dom.element("span"),u.extractContents().appendTo(E),u.insertNode(E),f.call(this,E),E.remove(!0)),u=null}}i.moveToBookmark(h),i.shrink(CKEDITOR.SHRINK_TEXT),i.shrink(CKEDITOR.NODE_ELEMENT,!0)}}function i(e){function t(){for(var e=new CKEDITOR.dom.elementPath(i.getParent()),t=new CKEDITOR.dom.elementPath(c.getParent()),n=null,a=null,r=0;r<e.elements.length;r++){var o=e.elements[r];if(o==e.block||o==e.blockLimit)break;f.checkElementRemovable(o,!0)&&(n=o)}for(r=0;r<t.elements.length&&(o=t.elements[r])!=t.block&&o!=t.blockLimit;r++)f.checkElementRemovable(o,!0)&&(a=o);a&&c.breakParent(a),n&&i.breakParent(n)}e.enlarge(CKEDITOR.ENLARGE_INLINE,1);var n=e.createBookmark(),i=n.startNode,a=this._.definition.alwaysRemoveElement;if(e.collapsed){for(var r,o,s=new CKEDITOR.dom.elementPath(i.getParent(),e.root),l=0;l<s.elements.length&&(o=s.elements[l])&&o!=s.block&&o!=s.blockLimit;l++)if(this.checkElementRemovable(o)){var d;!a&&e.collapsed&&(e.checkBoundaryOfElement(o,CKEDITOR.END)||(d=e.checkBoundaryOfElement(o,CKEDITOR.START)))?(r=o).match=d?"start":"end":(o.mergeSiblings(),o.is(this.element)?u.call(this,o):h(o,E(this)[o.getName()]))}if(r){for(a=i,l=0;!(o=s.elements[l]).equals(r);l++)o.match||((o=o.clone()).append(a),a=o);a["start"==r.match?"insertBefore":"insertAfter"](r)}}else{var c=n.endNode,f=this;for(t(),s=i;!s.equals(c);)r=s.getNextSourceNode(),s.type==CKEDITOR.NODE_ELEMENT&&this.checkElementRemovable(s)&&(s.getName()==this.element?u.call(this,s):h(s,E(this)[s.getName()]),r.type==CKEDITOR.NODE_ELEMENT&&r.contains(i)&&(t(),r=i.getNext())),s=r}e.moveToBookmark(n),e.shrink(CKEDITOR.NODE_ELEMENT,!0)}function a(e){var t=[];return e.forEach((function(e){if("true"==e.getAttribute("contenteditable"))return t.push(e),!1}),CKEDITOR.NODE_ELEMENT,!0),t}function r(e){var t=e.getEnclosedNode()||e.getCommonAncestor(!1,!0);(e=new CKEDITOR.dom.elementPath(t,e.root).contains(this.element,1))&&!e.isReadOnly()&&m(e,this)}function o(e){var t=e.getCommonAncestor(!0,!0);if(e=new CKEDITOR.dom.elementPath(t,e.root).contains(this.element,1)){var n=(t=this._.definition).attributes;if(n)for(var i in n)e.removeAttribute(i,n[i]);if(t.styles)for(var a in t.styles)t.styles.hasOwnProperty(a)&&e.removeStyle(a)}}function s(e){var t=e.createBookmark(!0),n=e.createIterator();n.enforceRealBlocks=!0,this._.enterMode&&(n.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR);for(var i,a=e.document;i=n.getNextParagraph();)!i.isReadOnly()&&(!n.activeFilter||n.activeFilter.check(this))&&d(i,g(this,a,i));e.moveToBookmark(t)}function l(e){var t,n,i=e.createBookmark(1),a=e.createIterator();for(a.enforceRealBlocks=!0,a.enlargeBr=this._.enterMode!=CKEDITOR.ENTER_BR;t=a.getNextParagraph();)this.checkElementRemovable(t)&&(t.is("pre")?((n=this._.enterMode==CKEDITOR.ENTER_BR?null:e.document.createElement(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))&&t.copyAttributes(n),d(t,n)):u.call(this,t));e.moveToBookmark(i)}function d(e,t){(n=!t)&&(t=e.getDocument().createElement("div"),e.copyAttributes(t));var n,i,a=t&&t.is("pre"),r=e.is("pre"),o=!a&&r;if(a&&!r){if(r=t,(o=e.getBogus())&&o.remove(),o=(o=(o=(o=c(o=e.getHtml(),/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,"")).replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1")).replace(/([ \t\n\r]+|&nbsp;)/g," ")).replace(/<br\b[^>]*>/gi,"\n"),CKEDITOR.env.ie){var s=e.getDocument().createElement("div");s.append(r),r.$.outerHTML="<pre>"+o+"</pre>",r.copyAttributes(s.getFirst()),r=s.getFirst().remove()}else r.setHtml(o);t=r}else o?t=function(e,t){var n;1<e.length&&(n=new CKEDITOR.dom.documentFragment(t.getDocument()));for(var i=0;i<e.length;i++){var a=c(a=(a=e[i]).replace(/(\r\n|\r)/g,"\n"),/^[ \t]*\n/,"");if(a=c(a,/\n$/,""),a=c(a,/^[ \t]+|[ \t]+$/g,(function(e,t){return 1==e.length?"&nbsp;":t?" "+CKEDITOR.tools.repeat("&nbsp;",e.length-1):CKEDITOR.tools.repeat("&nbsp;",e.length-1)+" "})),a=(a=a.replace(/\n/g,"<br>")).replace(/[ \t]{2,}/g,(function(e){return CKEDITOR.tools.repeat("&nbsp;",e.length-1)+" "})),n){var r=t.clone();r.setHtml(a),n.append(r)}else t.setHtml(a)}return n||t}(n?[e.getHtml()]:function(e){var t=[];return c(e.getOuterHtml(),/(\S\s*)\n(?:\s|(<span[^>]+data-cke-bookmark.*?\/span>))*\n(?!$)/gi,(function(e,t,n){return t+"</pre>"+n+"<pre>"})).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,(function(e,n){t.push(n)})),t}(e),t):e.moveChildren(t);t.replace(e),a?(i=(n=t).getPrevious(_))&&i.type==CKEDITOR.NODE_ELEMENT&&i.is("pre")&&(a=c(i.getHtml(),/\n$/,"")+"\n\n"+c(n.getHtml(),/^\n/,""),CKEDITOR.env.ie?n.$.outerHTML="<pre>"+a+"</pre>":n.setHtml(a),i.remove()):n&&p(t)}function c(e,t,n){var i="",a="";return e=e.replace(/(^<span[^>]+data-cke-bookmark.*?\/span>)|(<span[^>]+data-cke-bookmark.*?\/span>$)/gi,(function(e,t,n){return t&&(i=t),n&&(a=n),""})),i+e.replace(t,n)+a}function u(e,t){var n,i=(a=this._.definition).attributes,a=a.styles,r=E(this)[e.getName()],o=CKEDITOR.tools.isEmpty(i)&&CKEDITOR.tools.isEmpty(a);for(n in i)("class"!=n&&!this._.definition.fullMatch||e.getAttribute(n)==T(n,i[n]))&&(t&&"data-"==n.slice(0,5)||(o=e.hasAttribute(n),e.removeAttribute(n)));for(var s in a)this._.definition.fullMatch&&e.getStyle(s)!=T(s,a[s],!0)||(o=o||!!e.getStyle(s),e.removeStyle(s));h(e,r,b[e.getName()]),o&&(this._.definition.alwaysRemoveElement?p(e,1):!CKEDITOR.dtd.$block[e.getName()]||this._.enterMode==CKEDITOR.ENTER_BR&&!e.hasAttributes()?p(e):e.renameNode(this._.enterMode==CKEDITOR.ENTER_P?"p":"div"))}function f(e){for(var t,n=E(this),i=e.getElementsByTag(this.element),a=i.count();0<=--a;)(t=i.getItem(a)).isReadOnly()||u.call(this,t,!0);for(var r in n)if(r!=this.element)for(a=(i=e.getElementsByTag(r)).count()-1;0<=a;a--)(t=i.getItem(a)).isReadOnly()||h(t,n[r])}function h(e,t,n){if(t=t&&t.attributes)for(var i=0;i<t.length;i++){var a,r=t[i][0];if(a=e.getAttribute(r)){var o=t[i][1];(null===o||o.test&&o.test(a)||"string"==typeof o&&a==o)&&e.removeAttribute(r)}}n||p(e)}function p(e,t){if(!e.hasAttributes()||t)if(CKEDITOR.dtd.$block[e.getName()]){var n=e.getPrevious(_),i=e.getNext(_);!n||n.type!=CKEDITOR.NODE_TEXT&&n.isBlockBoundary({br:1})||e.append("br",1),!i||i.type!=CKEDITOR.NODE_TEXT&&i.isBlockBoundary({br:1})||e.append("br"),e.remove(!0)}else n=e.getFirst(),i=e.getLast(),e.remove(!0),n&&(n.type==CKEDITOR.NODE_ELEMENT&&n.mergeSiblings(),i&&!n.equals(i)&&i.type==CKEDITOR.NODE_ELEMENT&&i.mergeSiblings())}function g(e,t,n){var i;return"*"==(i=e.element)&&(i="span"),i=new CKEDITOR.dom.element(i,t),n&&n.copyAttributes(i),i=m(i,e),t.getCustomData("doc_processing_style")&&i.hasAttribute("id")?i.removeAttribute("id"):t.setCustomData("doc_processing_style",1),i}function m(e,t){var n=(i=t._.definition).attributes,i=CKEDITOR.style.getStyleText(i);if(n)for(var a in n)e.setAttribute(a,n[a]);return i&&e.setAttribute("style",i),e.getDocument().removeCustomData("doc_processing_style"),e}function v(e,t){for(var n in e)e[n]=e[n].replace(O,(function(e,n){return t[n]}))}function E(e){if(e._.overrides)return e._.overrides;var t=e._.overrides={},n=e._.definition.overrides;if(n){CKEDITOR.tools.isArray(n)||(n=[n]);for(var i=0;i<n.length;i++){var a,r;if("string"==typeof(s=n[i])?a=s.toLowerCase():(a=s.element?s.element.toLowerCase():e.element,r=s.attributes),s=t[a]||(t[a]={}),r){var o,s=s.attributes=s.attributes||[];for(o in r)s.push([o.toLowerCase(),r[o]])}}}return t}function T(e,t,n){var i=new CKEDITOR.dom.element("span");return i[n?"setStyle":"setAttribute"](e,t),i[n?"getStyle":"getAttribute"](e)}function C(e,t){function n(e,t){return"font-family"==t.toLowerCase()?e.replace(/["']/g,""):e}for(var i in"string"==typeof e&&(e=CKEDITOR.tools.parseCssText(e)),"string"==typeof t&&(t=CKEDITOR.tools.parseCssText(t,!0)),e)if(!(i in t)||n(t[i],i)!=n(e[i],i)&&"inherit"!=e[i]&&"inherit"!=t[i])return!1;return!0}function I(e,t,n){var i=e.getRanges();t=t?this.removeFromRange:this.applyToRange;for(var a,r=i.createIterator();a=r.getNextRange();)t.call(this,a,n);e.selectRanges(i)}var b={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,section:1,header:1,footer:1,nav:1,article:1,aside:1,figure:1,dialog:1,hgroup:1,time:1,meter:1,menu:1,command:1,keygen:1,output:1,progress:1,details:1,datagrid:1,datalist:1},y={a:1,blockquote:1,embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1,audio:1,video:1},D=/\s*(?:;\s*|$)/,O=/#\((.+?)\)/g,R=CKEDITOR.dom.walker.bookmark(0,1),_=CKEDITOR.dom.walker.whitespaces(1);CKEDITOR.style=function(e,t){if("string"==typeof e.type)return new CKEDITOR.style.customHandlers[e.type](e);var n=e.attributes;n&&n.style&&(e.styles=CKEDITOR.tools.extend({},e.styles,CKEDITOR.tools.parseCssText(n.style)),delete n.style),t&&(v((e=CKEDITOR.tools.clone(e)).attributes,t),v(e.styles,t)),n=this.element=e.element?"string"==typeof e.element?e.element.toLowerCase():e.element:"*",this.type=e.type||(b[n]?CKEDITOR.STYLE_BLOCK:y[n]?CKEDITOR.STYLE_OBJECT:CKEDITOR.STYLE_INLINE),"object"==typeof this.element&&(this.type=CKEDITOR.STYLE_OBJECT),this._={definition:e}},CKEDITOR.style.prototype={apply:function(e){if(e instanceof CKEDITOR.dom.document)return I.call(this,e.getSelection());if(this.checkApplicable(e.elementPath(),e)){var t=this._.enterMode;t||(this._.enterMode=e.activeEnterMode),I.call(this,e.getSelection(),0,e),this._.enterMode=t}},remove:function(e){if(e instanceof CKEDITOR.dom.document)return I.call(this,e.getSelection(),1);if(this.checkApplicable(e.elementPath(),e)){var t=this._.enterMode;t||(this._.enterMode=e.activeEnterMode),I.call(this,e.getSelection(),1,e),this._.enterMode=t}},applyToRange:function(e){return this.applyToRange=this.type==CKEDITOR.STYLE_INLINE?n:this.type==CKEDITOR.STYLE_BLOCK?s:this.type==CKEDITOR.STYLE_OBJECT?r:null,this.applyToRange(e)},removeFromRange:function(e){return this.removeFromRange=this.type==CKEDITOR.STYLE_INLINE?i:this.type==CKEDITOR.STYLE_BLOCK?l:this.type==CKEDITOR.STYLE_OBJECT?o:null,this.removeFromRange(e)},applyToObject:function(e){m(e,this)},checkActive:function(e,t){switch(this.type){case CKEDITOR.STYLE_BLOCK:return this.checkElementRemovable(e.block||e.blockLimit,!0,t);case CKEDITOR.STYLE_OBJECT:case CKEDITOR.STYLE_INLINE:for(var n,i=e.elements,a=0;a<i.length;a++)if(n=i[a],this.type!=CKEDITOR.STYLE_INLINE||n!=e.block&&n!=e.blockLimit){if(this.type==CKEDITOR.STYLE_OBJECT){var r=n.getName();if(!("string"==typeof this.element?r==this.element:r in this.element))continue}if(this.checkElementRemovable(n,!0,t))return!0}}return!1},checkApplicable:function(e,t,n){if(t&&t instanceof CKEDITOR.filter&&(n=t),n&&!n.check(this))return!1;switch(this.type){case CKEDITOR.STYLE_OBJECT:return!!e.contains(this.element);case CKEDITOR.STYLE_BLOCK:return!!e.blockLimit.getDtd()[this.element]}return!0},checkElementMatch:function(e,t){var n=this._.definition;if(!e||!n.ignoreReadonly&&e.isReadOnly())return!1;var i=e.getName();if("string"==typeof this.element?i==this.element:i in this.element){if(!t&&!e.hasAttributes())return!0;if(i=n._AC)n=i;else{i={};var a=0,r=n.attributes;if(r)for(var o in r)a++,i[o]=r[o];(o=CKEDITOR.style.getStyleText(n))&&(i.style||a++,i.style=o),i._length=a,n=n._AC=i}if(!n._length)return!0;for(var s in n)if("_length"!=s)if(i=e.getAttribute(s)||"","style"==s?C(n[s],i):n[s]==i){if(!t)return!0}else if(t)return!1;if(t)return!0}return!1},checkElementRemovable:function(e,t,n){if(this.checkElementMatch(e,t,n))return!0;if(t=E(this)[e.getName()]){var i;if(!(t=t.attributes))return!0;for(n=0;n<t.length;n++)if(i=t[n][0],i=e.getAttribute(i)){var a=t[n][1];if(null===a)return!0;if("string"==typeof a){if(i==a)return!0}else if(a.test(i))return!0}}return!1},buildPreview:function(e){var t=this._.definition,n=[],i=t.element;"bdo"==i&&(i="span"),n=["<",i];var a=t.attributes;if(a)for(var r in a)n.push(" ",r,'="',a[r],'"');return(a=CKEDITOR.style.getStyleText(t))&&n.push(' style="',a,'"'),n.push(">",e||t.name,"</",i,">"),n.join("")},getDefinition:function(){return this._.definition}},CKEDITOR.style.getStyleText=function(e){if(t=e._ST)return t;var t=e.styles,n=e.attributes&&e.attributes.style||"",i="";for(var a in n.length&&(n=n.replace(D,";")),t){var r=t[a],o=(a+":"+r).replace(D,";");"inherit"==r?i+=o:n+=o}return n.length&&(n=CKEDITOR.tools.normalizeCssText(n,!0)),e._ST=n+i},CKEDITOR.style.customHandlers={},CKEDITOR.style.unstylableElements=[],CKEDITOR.style.addCustomHandler=function(e){var t=function(e){this._={definition:e},this.setup&&this.setup(e)};return t.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.style.prototype),{assignedTo:CKEDITOR.STYLE_OBJECT},e,!0),this.customHandlers[e.type]=t};var x=CKEDITOR.POSITION_PRECEDING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED,w=CKEDITOR.POSITION_FOLLOWING|CKEDITOR.POSITION_IDENTICAL|CKEDITOR.POSITION_IS_CONTAINED}(),CKEDITOR.styleCommand=function(e,t){this.requiredContent=this.allowedContent=this.style=e,CKEDITOR.tools.extend(this,t,!0)},CKEDITOR.styleCommand.prototype.exec=function(e){e.focus(),this.state==CKEDITOR.TRISTATE_OFF?e.applyStyle(this.style):this.state==CKEDITOR.TRISTATE_ON&&e.removeStyle(this.style)},CKEDITOR.stylesSet=new CKEDITOR.resourceManager("","stylesSet"),CKEDITOR.addStylesSet=CKEDITOR.tools.bind(CKEDITOR.stylesSet.add,CKEDITOR.stylesSet),CKEDITOR.loadStylesSet=function(e,t,n){CKEDITOR.stylesSet.addExternal(e,t,""),CKEDITOR.stylesSet.load(e,n)},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{attachStyleStateChange:function(e,t){var n=this._.styleStateChangeCallbacks;n||(n=this._.styleStateChangeCallbacks=[],this.on("selectionChange",(function(e){for(var t=0;t<n.length;t++){var i=n[t],a=i.style.checkActive(e.data.path,this)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;i.fn.call(this,a)}}))),n.push({style:e,fn:t})},applyStyle:function(e){e.apply(this)},removeStyle:function(e){e.remove(this)},getStylesSet:function(e){if(this._.stylesDefinitions)e(this._.stylesDefinitions);else{var t=this;if(!1===(n=t.config.stylesCombo_stylesSet||t.config.stylesSet))e(null);else if(n instanceof Array)t._.stylesDefinitions=n,e(n);else{n||(n="default");var n,i=(n=n.split(":"))[0];CKEDITOR.stylesSet.addExternal(i,n[1]?n.slice(1).join(":"):CKEDITOR.getUrl("styles.js"),""),CKEDITOR.stylesSet.load(i,(function(n){t._.stylesDefinitions=n[i],e(t._.stylesDefinitions)}))}}}}),function(){if(window.Promise)CKEDITOR.tools.promise=Promise;else{var e=CKEDITOR.getUrl("vendor/promise.js");if("function"==typeof window.define&&window.define.amd&&"function"==typeof window.require)return window.require([e],(function(e){CKEDITOR.tools.promise=e}));CKEDITOR.scriptLoader.load(e,(function(t){return t?void 0!==window.ES6Promise?CKEDITOR.tools.promise=ES6Promise:void 0:CKEDITOR.error("no-vendor-lib",{path:e})}))}}(),function(){function e(e,i,a){e.once("selectionCheck",(function(e){if(!t){var r=e.data.getRanges()[0];a.equals(r)?e.cancel():i.equals(r)&&(n=!0)}}),null,null,-1)}var t=!0,n=!1;CKEDITOR.dom.selection.setupEditorOptimization=function(e){e.on("selectionCheck",(function(e){e.data&&!n&&e.data.optimizeInElementEnds(),n=!1})),e.on("contentDom",(function(){var t=e.editable();t&&(t.attachListener(t,"keydown",(function(e){this._.shiftPressed=e.data.$.shiftKey}),this),t.attachListener(t,"keyup",(function(e){this._.shiftPressed=e.data.$.shiftKey}),this))}))},CKEDITOR.dom.selection.prototype.optimizeInElementEnds=function(){var n,i=this.getRanges()[0],a=this.root.editor;if(this.root.editor._.shiftPressed||this.isFake||i.isCollapsed||i.startContainer.equals(i.endContainer)||(i.endContainer.is?i.endContainer.is("li"):i.endContainer.getParent().is&&i.endContainer.getParent().is("li")))n=!1;else if(0===i.endOffset)n=!0;else{n=i.startContainer.type===CKEDITOR.NODE_TEXT;var r=i.endContainer.type===CKEDITOR.NODE_TEXT,o=n?i.startContainer.getLength():i.startContainer.getChildCount();n=i.startOffset===o||n^r}n&&(n=i.clone(),i.shrink(CKEDITOR.SHRINK_TEXT,!1,{skipBogus:!CKEDITOR.env.webkit}),t=!1,e(a,i,n),i.select(),t=!0)}}(),function(){function e(e,t){return n(e)?e=Math.round(t*(parseFloat(e)/100)):("string"==typeof e&&e.match(/^\d+$/gm)||"string"==typeof e&&e.match(/^\d+(?:deg)?$/gm))&&(e=parseInt(e,10)),e}function t(e,t){return n(e)?e=t*(parseFloat(e)/100):"string"==typeof e&&e.match(/^\d?\.\d+/gm)&&(e=parseFloat(e)),e}function n(e){return"string"==typeof e&&e.match(/^((\d*\.\d+)|(\d+))%{1}$/gm)}function i(e,t,n){return!isNaN(e)&&e>=t&&e<=n}function a(e){return 1==(e=e.toString(16)).length?"0"+e:e}CKEDITOR.tools.color=CKEDITOR.tools.createClass({$:function(e,t){this._.initialColorCode=e,this._.defaultValue=t,this._.parseInput(e)},proto:{getHex:function(){if(!this._.isValidColor)return this._.defaultValue;var e=this._.blendAlphaColor(this._.red,this._.green,this._.blue,this._.alpha);return this._.formatHexString(e[0],e[1],e[2])},getHexWithAlpha:function(){if(!this._.isValidColor)return this._.defaultValue;var e=Math.round(this._.alpha*CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE);return this._.formatHexString(this._.red,this._.green,this._.blue,e)},getRgb:function(){if(!this._.isValidColor)return this._.defaultValue;var e=this._.blendAlphaColor(this._.red,this._.green,this._.blue,this._.alpha);return this._.formatRgbString("rgb",e[0],e[1],e[2])},getRgba:function(){return this._.isValidColor?this._.formatRgbString("rgba",this._.red,this._.green,this._.blue,this._.alpha):this._.defaultValue},getHsl:function(){var e=0===this._.alpha||1===this._.alpha;return this._.isValidColor?(this._.type===CKEDITOR.tools.color.TYPE_HSL&&e?e=[this._.hue,this._.saturation,this._.lightness]:(e=this._.blendAlphaColor(this._.red,this._.green,this._.blue,this._.alpha),e=this._.rgbToHsl(e[0],e[1],e[2])),this._.formatHslString("hsl",e[0],e[1],e[2])):this._.defaultValue},getHsla:function(){var e;return this._.isValidColor?(e=this._.type===CKEDITOR.tools.color.TYPE_HSL?[this._.hue,this._.saturation,this._.lightness]:this._.rgbToHsl(this._.red,this._.green,this._.blue),this._.formatHslString("hsla",e[0],e[1],e[2],this._.alpha)):this._.defaultValue},getInitialValue:function(){return this._.initialColorCode}},_:{initialColorCode:"",isValidColor:!0,type:0,hue:0,saturation:0,lightness:0,red:0,green:0,blue:0,alpha:1,blendAlphaColor:function(e,t,n,i){return CKEDITOR.tools.array.map([e,t,n],(function(e){return Math.round(CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE-i*(CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE-e))}))},formatHexString:function(e,t,n,i){return e="#"+a(e)+a(t)+a(n),void 0!==i&&(e+=a(i)),e.toUpperCase()},formatRgbString:function(e,t,n,i,a){return t=[t,n,i],void 0!==a&&t.push(a),e+"("+t.join(",")+")"},formatHslString:function(e,t,n,i,a){return e+"("+t+","+n+"%,"+i+"%"+(void 0!==a?","+a:"")+")"},parseInput:function(e){if("string"!=typeof e)this._.isValidColor=!1;else{e=CKEDITOR.tools.trim(e),(t=this._.matchStringToNamedColor(e))&&(e=t);var t=this._.extractColorChannelsFromHex(e),n=this._.extractColorChannelsFromRgba(e);e=this._.extractColorChannelsFromHsla(e),(e=t||n||e)?(this._.type=e.type,this._.red=e.red,this._.green=e.green,this._.blue=e.blue,this._.alpha=e.alpha,e.type===CKEDITOR.tools.color.TYPE_HSL&&(this._.hue=e.hue,this._.saturation=e.saturation,this._.lightness=e.lightness)):this._.isValidColor=!1}},matchStringToNamedColor:function(e){return CKEDITOR.tools.color.namedColors[e.toLowerCase()]||null},extractColorChannelsFromHex:function(e){if(-1===e.indexOf("#")&&(e="#"+e),e.match(CKEDITOR.tools.color.hex3CharsRegExp)&&(e=this._.hex3ToHex6(e)),e.match(CKEDITOR.tools.color.hex4CharsRegExp)&&(e=this._.hex4ToHex8(e)),!e.match(CKEDITOR.tools.color.hex6CharsRegExp)&&!e.match(CKEDITOR.tools.color.hex8CharsRegExp))return null;var t=1;return(e=e.split(""))[7]&&e[8]&&(t=parseInt(e[7]+e[8],16),t/=CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE,t=Number(t.toFixed(1))),{type:CKEDITOR.tools.color.TYPE_RGB,red:parseInt(e[1]+e[2],16),green:parseInt(e[3]+e[4],16),blue:parseInt(e[5]+e[6],16),alpha:t}},extractColorChannelsFromRgba:function(n){var i=this._.extractColorChannelsByPattern(n,CKEDITOR.tools.color.rgbRegExp);if(!i||3>i.length||4<i.length)return null;var a=4===i.length;n=e(i[0],CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE);var r=e(i[1],CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE),o=e(i[2],CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE),s=1;return a&&(s=t(i[3],CKEDITOR.tools.color.MAX_ALPHA_CHANNEL_VALUE)),i={type:CKEDITOR.tools.color.TYPE_RGB,red:n,green:r,blue:o,alpha:s},this._.areColorChannelsValid(n,r,o,s)?i:null},extractColorChannelsFromHsla:function(n){var i=this._.extractColorChannelsByPattern(n,CKEDITOR.tools.color.hslRegExp);if(!i||3>i.length||4<i.length)return null;var a=4===i.length,r=e(i[0],CKEDITOR.tools.color.MAX_HUE_CHANNEL_VALUE),o=t(i[1],CKEDITOR.tools.color.MAX_SATURATION_LIGHTNESS_CHANNEL_VALUE),s=t(i[2],CKEDITOR.tools.color.MAX_SATURATION_LIGHTNESS_CHANNEL_VALUE),l=1;return n=this._.hslToRgb(r,o,s),a&&(l=t(i[3],CKEDITOR.tools.color.MAX_ALPHA_CHANNEL_VALUE)),n.push(l),i={type:CKEDITOR.tools.color.TYPE_HSL,red:n[0],green:n[1],blue:n[2],alpha:n[3],hue:r,saturation:Math.round(100*o),lightness:Math.round(100*s)},this._.areColorChannelsValid(n[0],n[1],n[2],n[3])?i:null},hex3ToHex6:function(e){return"#"+(e=e.split(""))[1]+e[1]+e[2]+e[2]+e[3]+e[3]},hex4ToHex8:function(e){return this._.hex3ToHex6(e.substr(0,4))+CKEDITOR.tools.repeat(e[4],2)},extractColorChannelsByPattern:function(e,t){var n=e.match(t);if(!n)return null;var i=-1===n[1].indexOf(",")?/\s/:",";return i=n[1].split(i),i=CKEDITOR.tools.array.reduce(i,(function(e,t){var n=CKEDITOR.tools.trim(t);return 0===n.length?e:e.concat([n])}),[]),n[2]&&(n=CKEDITOR.tools.trim(n[2].replace(/[\/,]/,"")),i.push(n)),i},areColorChannelsValid:function(e,t,n,a){return i(e,0,CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE)&&i(t,0,CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE)&&i(n,0,CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE)&&i(a,0,CKEDITOR.tools.color.MAX_ALPHA_CHANNEL_VALUE)},hslToRgb:function(e,t,n){var i=function(i){var a=(i+e/30)%12;return i=t*Math.min(n,1-n),a=Math.min(a-3,9-a,1),a=Math.max(-1,a),Math.round((n-i*a)*CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE)};return[i(0),i(8),i(4)]},rgbToHsl:function(e,t,n){e/=CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE,t/=CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE;var i=n/CKEDITOR.tools.color.MAX_RGB_CHANNEL_VALUE,a=Math.max(e,t,i),r=Math.min(e,t,i);n=a-r;var o=0;switch(a){case e:o=(t-i)/n%6;break;case t:o=(i-e)/n+2;break;case i:o=(e-t)/n+4}return e=0===n?0:60*o,t=(a+r)/2,a=0,1!==t&&0!==t&&(a=n/(1-Math.abs(2*t-1))),[e=Math.round(e),a=Math.round(100*a),t=Math.round(100*t)]}},statics:{TYPE_RGB:1,TYPE_HSL:2,MAX_RGB_CHANNEL_VALUE:255,MAX_ALPHA_CHANNEL_VALUE:1,MAX_HUE_CHANNEL_VALUE:360,MAX_SATURATION_LIGHTNESS_CHANNEL_VALUE:1,hex3CharsRegExp:/#([0-9a-f]{3}$)/gim,hex4CharsRegExp:/#([0-9a-f]{4}$)/gim,hex6CharsRegExp:/#([0-9a-f]{6}$)/gim,hex8CharsRegExp:/#([0-9a-f]{8}$)/gim,rgbRegExp:/rgba?\(([.,\d\s%]*)(\s*\/\s*[\d.%]+)?\s*\)/i,hslRegExp:/hsla?\((\s*(?:[.\d]+(?:deg)?)(?:\s*,?\s*[.\d]+%){2})((?:(?:\s*\/\s*)|(?:\s*,\s*))[\d.]+%?)?\s*\)/i,namedColors:{aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgreen:"#006400",darkgrey:"#A9A9A9",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",green:"#008000",greenyellow:"#ADFF2F",grey:"#808080",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgreen:"#90EE90",lightgrey:"#D3D3D3",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",windowtext:"windowtext",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"}}}),CKEDITOR.tools.style.parse._colors=CKEDITOR.tools.color.namedColors}(),CKEDITOR.dom.comment=function(e,t){"string"==typeof e&&(e=(t?t.$:document).createComment(e)),CKEDITOR.dom.domObject.call(this,e)},CKEDITOR.dom.comment.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.comment.prototype,{type:CKEDITOR.NODE_COMMENT,getOuterHtml:function(){return"\x3c!--"+this.$.nodeValue+"--\x3e"}}),function(){var e,t={},n={};for(e in CKEDITOR.dtd.$blockLimit)e in CKEDITOR.dtd.$list||(t[e]=1);for(e in CKEDITOR.dtd.$block)e in CKEDITOR.dtd.$blockLimit||e in CKEDITOR.dtd.$empty||(n[e]=1);CKEDITOR.dom.elementPath=function(e,i){var a,r=null,o=null,s=[],l=e;i=i||e.getDocument().getBody(),l||(l=i);do{if(l.type==CKEDITOR.NODE_ELEMENT){if(s.push(l),!this.lastElement&&(this.lastElement=l,l.is(CKEDITOR.dtd.$object)||"false"==l.getAttribute("contenteditable")))continue;if(l.equals(i))break;if(!o&&(a=l.getName(),"true"==l.getAttribute("contenteditable")?o=l:!r&&n[a]&&(r=l),t[a])){if(a=!r&&"div"==a){e:{for(var d=0,c=(a=l.getChildren()).count();d<c;d++){var u=a.getItem(d);if(u.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$block[u.getName()]){a=!0;break e}}a=!1}a=!a}a?r=l:o=l}}}while(l=l.getParent());o||(o=i),this.block=r,this.blockLimit=o,this.root=i,this.elements=s}}(),CKEDITOR.dom.elementPath.prototype={compare:function(e){var t=this.elements;if(!(e=e&&e.elements)||t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0},contains:function(e,t,n){var i,a=0;"string"==typeof e&&(i=function(t){return t.getName()==e}),e instanceof CKEDITOR.dom.element?i=function(t){return t.equals(e)}:CKEDITOR.tools.isArray(e)?i=function(t){return-1<CKEDITOR.tools.indexOf(e,t.getName())}:"function"==typeof e?i=e:"object"==typeof e&&(i=function(t){return t.getName()in e});var r=this.elements,o=r.length;for(t&&(n?a+=1:--o),n&&(r=Array.prototype.slice.call(r,0)).reverse();a<o;a++)if(i(r[a]))return r[a];return null},isContextFor:function(e){return!(e in CKEDITOR.dtd.$block)||!!(this.contains(CKEDITOR.dtd.$intermediate)||this.root.equals(this.block)&&this.block||this.blockLimit).getDtd()[e]},direction:function(){return(this.block||this.blockLimit||this.root).getDirection(1)}},CKEDITOR.dom.text=function(e,t){"string"==typeof e&&(e=(t?t.$:document).createTextNode(e)),this.$=e},CKEDITOR.dom.text.prototype=new CKEDITOR.dom.node,CKEDITOR.tools.extend(CKEDITOR.dom.text.prototype,{type:CKEDITOR.NODE_TEXT,getLength:function(){return this.$.nodeValue.length},getText:function(){return this.$.nodeValue},setText:function(e){this.$.nodeValue=e},isEmpty:function(e){var t=this.getText();return e&&(t=CKEDITOR.tools.trim(t)),!t||t===CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE},split:function(e){var t=this.$.parentNode,n=t.childNodes.length,i=this.getLength(),a=this.getDocument(),r=new CKEDITOR.dom.text(this.$.splitText(e),a);return t.childNodes.length==n&&(e>=i?(r=a.createText("")).insertAfter(this):((e=a.createText("")).insertAfter(r),e.remove())),r},substring:function(e,t){return"number"!=typeof t?this.$.nodeValue.substr(e):this.$.nodeValue.substring(e,t)}}),function(){function e(e,t,n){var i=e.serializable,a=t[n?"endContainer":"startContainer"],r=n?"endOffset":"startOffset",o=i?t.document.getById(e.startNode):e.startNode;return e=i?t.document.getById(e.endNode):e.endNode,a.equals(o.getPrevious())?(t.startOffset=t.startOffset-a.getLength()-e.getPrevious().getLength(),a=e.getNext()):a.equals(e.getPrevious())&&(t.startOffset-=a.getLength(),a=e.getNext()),a.equals(o.getParent())&&t[r]++,a.equals(e.getParent())&&t[r]++,t[n?"endContainer":"startContainer"]=a,t}CKEDITOR.dom.rangeList=function(e){return e instanceof CKEDITOR.dom.rangeList?e:(e?e instanceof CKEDITOR.dom.range&&(e=[e]):e=[],CKEDITOR.tools.extend(e,t))};var t={createIterator:function(){var e,t=this,n=CKEDITOR.dom.walker.bookmark(),i=[];return{getNextRange:function(a){var r=t[e=void 0===e?0:e+1];if(r&&1<t.length){if(!e)for(var o=t.length-1;0<=o;o--)i.unshift(t[o].createBookmark(!0));if(a)for(var s=0;t[e+s+1];){var l=r.document;for(a=0,o=l.getById(i[s].endNode),l=l.getById(i[s+1].startNode);;){if(o=o.getNextSourceNode(!1),l.equals(o))a=1;else if(n(o)||o.type==CKEDITOR.NODE_ELEMENT&&o.isBlockBoundary())continue;break}if(!a)break;s++}for(r.moveToBookmark(i.shift());s--;)(o=t[++e]).moveToBookmark(i.shift()),r.setEnd(o.endContainer,o.endOffset)}return r}}},createBookmarks:function(t){for(var n,i=[],a=0;a<this.length;a++){i.push(n=this[a].createBookmark(t,!0));for(var r=a+1;r<this.length;r++)this[r]=e(n,this[r]),this[r]=e(n,this[r],!0)}return i},createBookmarks2:function(e){for(var t=[],n=0;n<this.length;n++)t.push(this[n].createBookmark2(e));return t},moveToBookmarks:function(e){for(var t=0;t<this.length;t++)this[t].moveToBookmark(e[t])}}}(),function(){function e(){return CKEDITOR.getUrl(CKEDITOR.skinName.split(",")[1]||"skins/"+CKEDITOR.skinName.split(",")[0]+"/")}function t(t){var n=CKEDITOR.skin["ua_"+t],i=CKEDITOR.env;if(n){n=n.split(",").sort((function(e,t){return e>t?-1:1}));for(var a,r=0;r<n.length;r++)if(a=n[r],i.ie&&(a.replace(/^ie/,"")==i.version||i.quirks&&"iequirks"==a)&&(a="ie"),i[a]){t+="_"+n[r];break}}return CKEDITOR.getUrl(e()+t+".css")}function n(e,n){r[e]||(CKEDITOR.document.appendStyleSheet(t(e)),r[e]=1),n&&n()}function i(e){var t=e.getById(o);return t||((t=e.getHead().append("style")).setAttribute("id",o),t.setAttribute("type","text/css")),t}function a(e,t,n){var i,a,r;if(CKEDITOR.env.webkit)for(t=t.split("}").slice(0,-1),a=0;a<t.length;a++)t[a]=t[a].split("{");for(var o=0;o<e.length;o++)if(CKEDITOR.env.webkit)for(a=0;a<t.length;a++){for(r=t[a][1],i=0;i<n.length;i++)r=r.replace(n[i][0],n[i][1]);e[o].$.sheet.addRule(t[a][0],r)}else{for(r=t,i=0;i<n.length;i++)r=r.replace(n[i][0],n[i][1]);CKEDITOR.env.ie&&11>CKEDITOR.env.version?e[o].$.styleSheet.cssText+=r:e[o].$.innerHTML+=r}}var r={};CKEDITOR.skin={path:e,loadPart:function(t,i){CKEDITOR.skin.name!=CKEDITOR.skinName.split(",")[0]?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(e()+"skin.js"),(function(){n(t,i)})):n(t,i)},getPath:function(e){return CKEDITOR.getUrl(t(e))},icons:{},addIcon:function(e,t,n,i){e=e.toLowerCase(),this.icons[e]||(this.icons[e]={path:t,offset:n||0,bgsize:i||"16px"})},getIconStyle:function(e,t,n,i,a){var r;return e&&(e=e.toLowerCase(),t&&(r=this.icons[e+"-rtl"]),r||(r=this.icons[e])),e=n||r&&r.path||"",i=i||r&&r.offset,a=a||r&&r.bgsize||"16px",e&&(e=e.replace(/'/g,"\\'")),e&&"background-image:url('"+CKEDITOR.getUrl(e)+"');background-position:0 "+i+"px;background-size:"+a+";"}},CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{getUiColor:function(){return this.uiColor},setUiColor:function(e){var t=i(CKEDITOR.document);return(this.setUiColor=function(e){this.uiColor=e;var n=CKEDITOR.skin.chameleon,i="",r="";"function"==typeof n&&(i=n(this,"editor"),r=n(this,"panel")),a([t],i,e=[[l,e]]),a(s,r,e)}).call(this,e)}});var o="cke_ui_color",s=[],l=/\$color/g;CKEDITOR.on("instanceLoaded",(function(e){if(!CKEDITOR.env.ie||!CKEDITOR.env.quirks){var t=e.editor;e=function(e){if(!(e=(e.data[0]||e.data).element.getElementsByTag("iframe").getItem(0).getFrameDocument()).getById("cke_ui_color")){var n=i(e);s.push(n),t.on("destroy",(function(){s=CKEDITOR.tools.array.filter(s,(function(e){return n!==e}))})),(e=t.getUiColor())&&a([n],CKEDITOR.skin.chameleon(t,"panel"),[[l,e]])}},t.on("panelShow",e),t.on("menuShow",e),t.config.uiColor&&t.setUiColor(t.config.uiColor)}}))}(),function(){var e=CKEDITOR.dom.element.createFromHtml('<div style="width:0;height:0;position:absolute;left:-10000px;border:1px solid;border-color:red blue"></div>',CKEDITOR.document);e.appendTo(CKEDITOR.document.getHead());try{var t=e.getComputedStyle("border-top-color"),n=e.getComputedStyle("border-right-color");CKEDITOR.env.hc=!(!t||t!=n)}catch(e){CKEDITOR.env.hc=!1}if(e.remove(),CKEDITOR.env.hc&&(CKEDITOR.env.cssClass+=" cke_hc"),CKEDITOR.document.appendStyleText(".cke{visibility:hidden;}"),CKEDITOR.status="loaded",CKEDITOR.fireOnce("loaded"),e=CKEDITOR._.pending)for(delete CKEDITOR._.pending,t=0;t<e.length;t++)CKEDITOR.editor.prototype.constructor.apply(e[t][0],e[t][1]),CKEDITOR.add(e[t][0])}(),CKEDITOR.skin.name="minimalist",CKEDITOR.skin.ua_editor="ie,iequirks,ie7,ie8,gecko",CKEDITOR.skin.ua_dialog="ie,iequirks,ie7,ie8",CKEDITOR.skin.chameleon=function(){var e=function(e,t){for(var n=e.match(/[^#]./g),i=0;3>i;i++){var a,r=n,o=i;a=parseInt(n[i],16),a=("0"+(0>t?0|a*(1+t):0|a+(255-a)*t).toString(16)).slice(-2),r[o]=a}return"#"+n.join("")},t=function(){var e=new CKEDITOR.template("background:#{to};background-image:-webkit-gradient(linear,lefttop,leftbottom,from({from}),to({to}));background-image:-moz-linear-gradient(top,{from},{to});background-image:-webkit-linear-gradient(top,{from},{to});background-image:-o-linear-gradient(top,{from},{to});background-image:-ms-linear-gradient(top,{from},{to});background-image:linear-gradient(top,{from},{to});filter:progid:DXImageTransform.Microsoft.gradient(gradientType=0,startColorstr='{from}',endColorstr='{to}');");return function(t,n){return e.output({from:t,to:n})}}(),n={editor:new CKEDITOR.template("{id}.cke_chrome [border-color:{defaultBorder};] {id} .cke_top [ {defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_bottom [{defaultGradient}border-top-color:{defaultBorder};] {id} .cke_resizer [border-right-color:{ckeResizer}] {id} .cke_dialog_title [{defaultGradient}border-bottom-color:{defaultBorder};] {id} .cke_dialog_footer [{defaultGradient}outline-color:{defaultBorder};border-top-color:{defaultBorder};] {id} .cke_dialog_tab [{lightGradient}border-color:{defaultBorder};] {id} .cke_dialog_tab:hover [{mediumGradient}] {id} .cke_dialog_contents [border-top-color:{defaultBorder};] {id} .cke_dialog_tab_selected, {id} .cke_dialog_tab_selected:hover [background:{dialogTabSelected};border-bottom-color:{dialogTabSelectedBorder};] {id} .cke_dialog_body [background:{dialogBody};border-color:{defaultBorder};] {id} .cke_toolgroup [{lightGradient}border-color:{defaultBorder};] {id} a.cke_button_off:hover, {id} a.cke_button_off:focus, {id} a.cke_button_off:active [{mediumGradient}] {id} .cke_button_on [{ckeButtonOn}] {id} .cke_toolbar_separator [background-color: {ckeToolbarSeparator};] {id} .cke_combo_button [border-color:{defaultBorder};{lightGradient}] {id} a.cke_combo_button:hover, {id} a.cke_combo_button:focus, {id} .cke_combo_on a.cke_combo_button [border-color:{defaultBorder};{mediumGradient}] {id} .cke_path_item [color:{elementsPathColor};] {id} a.cke_path_item:hover, {id} a.cke_path_item:focus, {id} a.cke_path_item:active [background-color:{elementsPathBg};] {id}.cke_panel [border-color:{defaultBorder};] "),panel:new CKEDITOR.template(".cke_panel_grouptitle [{lightGradient}border-color:{defaultBorder};] .cke_menubutton_icon [background-color:{menubuttonIcon};] .cke_menubutton:hover .cke_menubutton_icon, .cke_menubutton:focus .cke_menubutton_icon, .cke_menubutton:active .cke_menubutton_icon [background-color:{menubuttonIconHover};] .cke_menuseparator [background-color:{menubuttonIcon};] a:hover.cke_colorbox, a:focus.cke_colorbox, a:active.cke_colorbox [border-color:{defaultBorder};] a:hover.cke_colorauto, a:hover.cke_colormore, a:focus.cke_colorauto, a:focus.cke_colormore, a:active.cke_colorauto, a:active.cke_colormore [background-color:{ckeColorauto};border-color:{defaultBorder};] ")};return function(i,a){var r=i.uiColor;return r={id:"."+i.id,defaultBorder:e(r,-.1),defaultGradient:t(e(r,.9),r),lightGradient:t(e(r,1),e(r,.7)),mediumGradient:t(e(r,.8),e(r,.5)),ckeButtonOn:t(e(r,.6),e(r,.7)),ckeResizer:e(r,-.4),ckeToolbarSeparator:e(r,.5),ckeColorauto:e(r,.8),dialogBody:e(r,.7),dialogTabSelected:t("#FFFFFF","#FFFFFF"),dialogTabSelectedBorder:"#FFF",elementsPathColor:e(r,-.6),elementsPathBg:r,menubuttonIcon:e(r,.5),menubuttonIconHover:e(r,.3)},n[a].output(r).replace(/\[/g,"{").replace(/\]/g,"}")}}(),CKEDITOR.plugins.add("dialogui",{onLoad:function(){var e=function(e){this._||(this._={}),this._.default=this._.initValue=e.default||"",this._.required=e.required||!1;for(var t=[this._],n=1;n<arguments.length;n++)t.push(arguments[n]);return t.push(!0),CKEDITOR.tools.extend.apply(CKEDITOR.tools,t),this._},t={build:function(e,t,n){return new CKEDITOR.ui.dialog.textInput(e,t,n)}},n={build:function(e,t,n){return new CKEDITOR.ui.dialog[t.type](e,t,n)}},i={isChanged:function(){return this.getValue()!=this.getInitValue()},reset:function(e){this.setValue(this.getInitValue(),e)},setInitValue:function(){this._.initValue=this.getValue()},resetInitValue:function(){this._.initValue=this._.default},getInitValue:function(){return this._.initValue}},a=CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onChange:function(e,t){this._.domOnChangeRegistered||(e.on("load",(function(){this.getInputElement().on("change",(function(){e.parts.dialog.isVisible()&&this.fire("change",{value:this.getValue()})}),this)}),this),this._.domOnChangeRegistered=!0),this.on("change",t)}},!0),r=/^on([A-Z]\w+)/,o=function(e){for(var t in e)(r.test(t)||"title"==t||"type"==t)&&delete e[t];return e},s=function(e){(e=e.data.getKeystroke())==CKEDITOR.SHIFT+CKEDITOR.ALT+36?this.setDirectionMarker("ltr"):e==CKEDITOR.SHIFT+CKEDITOR.ALT+35&&this.setDirectionMarker("rtl")};CKEDITOR.tools.extend(CKEDITOR.ui.dialog,{labeledElement:function(t,n,i,a){if(!(4>arguments.length)){var r=e.call(this,n);r.labelId=CKEDITOR.tools.getNextId()+"_label",this._.children=[];var o={role:n.role||"presentation"};n.includeLabel&&(o["aria-labelledby"]=r.labelId),CKEDITOR.ui.dialog.uiElement.call(this,t,n,i,"div",null,o,(function(){var e=[],i=n.required?" cke_required":"";return"horizontal"!=n.labelLayout?e.push('<label class="cke_dialog_ui_labeled_label'+i+'" ',' id="'+r.labelId+'"',r.inputId?' for="'+r.inputId+'"':"",(n.labelStyle?' style="'+n.labelStyle+'"':"")+">",n.required?n.label+'<span class="cke_dialog_ui_labeled_required" aria-hidden="true">*</span>':n.label,"</label>",'<div class="cke_dialog_ui_labeled_content"',n.controlStyle?' style="'+n.controlStyle+'"':"",' role="presentation">',a.call(this,t,n),"</div>"):(i={type:"hbox",widths:n.widths,padding:0,children:[{type:"html",html:'<label class="cke_dialog_ui_labeled_label'+i+'" id="'+r.labelId+'" for="'+r.inputId+'"'+(n.labelStyle?' style="'+n.labelStyle+'"':"")+">"+CKEDITOR.tools.htmlEncode(n.label)+"</label>"},{type:"html",html:'<span class="cke_dialog_ui_labeled_content"'+(n.controlStyle?' style="'+n.controlStyle+'"':"")+">"+a.call(this,t,n)+"</span>"}]},CKEDITOR.dialog._.uiElementBuilders.hbox.build(t,i,e)),e.join("")}))}},textInput:function(t,n,i){if(!(3>arguments.length)){e.call(this,n);var a=this._.inputId=CKEDITOR.tools.getNextId()+"_textInput",r={class:"cke_dialog_ui_input_"+n.type,id:a,type:n.type};n.validate&&(this.validate=n.validate),n.maxLength&&(r.maxlength=n.maxLength),n.size&&(r.size=n.size),n.inputStyle&&(r.style=n.inputStyle);var o=this,l=!1;t.on("load",(function(){o.getInputElement().on("keydown",(function(e){13==e.data.getKeystroke()&&(l=!0)})),o.getInputElement().on("keyup",(function(e){13==e.data.getKeystroke()&&l&&(t.getButton("ok")&&setTimeout((function(){t.getButton("ok").click()}),0),l=!1),o.bidi&&s.call(o,e)}),null,null,1e3)})),CKEDITOR.ui.dialog.labeledElement.call(this,t,n,i,(function(){var e=['<div class="cke_dialog_ui_input_',n.type,'" role="presentation"'];for(var t in n.width&&e.push('style="width:'+n.width+'" '),e.push("><input "),r["aria-labelledby"]=this._.labelId,this._.required&&(r["aria-required"]=this._.required),r)e.push(t+'="'+r[t]+'" ');return e.push(" /></div>"),e.join("")}))}},textarea:function(t,n,i){if(!(3>arguments.length)){e.call(this,n);var a=this,r=this._.inputId=CKEDITOR.tools.getNextId()+"_textarea",o={};n.validate&&(this.validate=n.validate),o.rows=n.rows||5,o.cols=n.cols||20,o.class="cke_dialog_ui_input_textarea "+(n.class||""),void 0!==n.inputStyle&&(o.style=n.inputStyle),n.dir&&(o.dir=n.dir),a.bidi&&t.on("load",(function(){a.getInputElement().on("keyup",s)}),a),CKEDITOR.ui.dialog.labeledElement.call(this,t,n,i,(function(){o["aria-labelledby"]=this._.labelId,this._.required&&(o["aria-required"]=this._.required);var e,t=['<div class="cke_dialog_ui_input_textarea" role="presentation"><textarea id="',r,'" '];for(e in o)t.push(e+'="'+CKEDITOR.tools.htmlEncode(o[e])+'" ');return t.push(">",CKEDITOR.tools.htmlEncode(a._.default),"</textarea></div>"),t.join("")}))}},checkbox:function(t,n,i){if(!(3>arguments.length)){var a=e.call(this,n,{default:!!n.default});n.validate&&(this.validate=n.validate),CKEDITOR.ui.dialog.uiElement.call(this,t,n,i,"span",null,null,(function(){var e=CKEDITOR.tools.extend({},n,{id:n.id?n.id+"_checkbox":CKEDITOR.tools.getNextId()+"_checkbox"},!0),i=[],r=CKEDITOR.tools.getNextId()+"_label",s={class:"cke_dialog_ui_checkbox_input",type:"checkbox","aria-labelledby":r};return o(e),n.default&&(s.checked="checked"),void 0!==e.inputStyle&&(e.style=e.inputStyle),a.checkbox=new CKEDITOR.ui.dialog.uiElement(t,e,i,"input",null,s),i.push(' <label id="',r,'" for="',s.id,'"'+(n.labelStyle?' style="'+n.labelStyle+'"':"")+">",CKEDITOR.tools.htmlEncode(n.label),"</label>"),i.join("")}))}},radio:function(t,n,i){if(!(3>arguments.length)){e.call(this,n),this._.default||(this._.default=this._.initValue=n.items[0][1]),n.validate&&(this.validate=n.validate);var a=[],r=this;n.role="radiogroup",n.includeLabel=!0,CKEDITOR.ui.dialog.labeledElement.call(this,t,n,i,(function(){for(var e=[],i=[],s=(n.id?n.id:CKEDITOR.tools.getNextId())+"_radio",l=0;l<n.items.length;l++){var d=n.items[l],c=void 0!==d[2]?d[2]:d[0],u=void 0!==d[1]?d[1]:d[0],f=(h=CKEDITOR.tools.getNextId()+"_radio_input")+"_label",h=CKEDITOR.tools.extend({},n,{id:h,title:null,type:null},!0),p=(c=CKEDITOR.tools.extend({},h,{title:c},!0),{type:"radio",class:"cke_dialog_ui_radio_input",name:s,value:u,"aria-labelledby":f}),g=[];r._.default==u&&(p.checked="checked"),o(h),o(c),void 0!==h.inputStyle&&(h.style=h.inputStyle),(u=new CKEDITOR.ui.dialog.uiElement(t,h,g,"input",null,p)).on("focus",(function(){r.click()})),a.push(u),g.push(" "),new CKEDITOR.ui.dialog.uiElement(t,c,g,"label",null,{id:f,for:p.id},d[0]),e.push(g.join(""))}return new CKEDITOR.ui.dialog.hbox(t,a,e,i),i.join("")})),this._.children=a}},button:function(t,n,i){if(arguments.length){"function"==typeof n&&(n=n(t.getParentEditor())),e.call(this,n,{disabled:n.disabled||!1}),CKEDITOR.event.implementOn(this);var a=this;t.on("load",(function(){var e=this.getElement();e.on("click",(function(e){a.click(),e.data.preventDefault()})),e.on("keydown",(function(e){e.data.getKeystroke()in{32:1}&&(a.click(),e.data.preventDefault())})),e.unselectable()}),this);var r=CKEDITOR.tools.extend({},n);delete r.style;var o=CKEDITOR.tools.getNextId()+"_label";CKEDITOR.ui.dialog.uiElement.call(this,t,r,i,"a",null,{style:n.style,href:"javascript:void(0)",title:n.label,hidefocus:"true",class:n.class,role:"button","aria-labelledby":o},'<span id="'+o+'" class="cke_dialog_ui_button">'+CKEDITOR.tools.htmlEncode(n.label)+"</span>")}},select:function(t,n,i){if(!(3>arguments.length)){var a=e.call(this,n);n.validate&&(this.validate=n.validate),a.inputId=CKEDITOR.tools.getNextId()+"_select",CKEDITOR.ui.dialog.labeledElement.call(this,t,n,i,(function(){var e=CKEDITOR.tools.extend({},n,{id:n.id?n.id+"_select":CKEDITOR.tools.getNextId()+"_select"},!0),i=[],r=[],s={id:a.inputId,class:"cke_dialog_ui_input_select","aria-labelledby":this._.labelId};i.push('<div class="cke_dialog_ui_input_',n.type,'" role="presentation"'),n.width&&i.push('style="width:'+n.width+'" '),i.push(">"),void 0!==n.size&&(s.size=n.size),void 0!==n.multiple&&(s.multiple=n.multiple),o(e);for(var l,d=0;d<n.items.length&&(l=n.items[d]);d++)r.push('<option value="',CKEDITOR.tools.htmlEncode(void 0!==l[1]?l[1]:l[0]).replace(/"/g,"&quot;"),'" /> ',CKEDITOR.tools.htmlEncode(l[0]));return void 0!==e.inputStyle&&(e.style=e.inputStyle),a.select=new CKEDITOR.ui.dialog.uiElement(t,e,i,"select",null,s,r.join("")),i.push("</div>"),i.join("")}))}},file:function(t,n,i){if(!(3>arguments.length)){void 0===n.default&&(n.default="");var a=CKEDITOR.tools.extend(e.call(this,n),{definition:n,buttons:[]});n.validate&&(this.validate=n.validate),t.on("load",(function(){CKEDITOR.document.getById(a.frameId).getParent().addClass("cke_dialog_ui_input_file")})),CKEDITOR.ui.dialog.labeledElement.call(this,t,n,i,(function(){a.frameId=CKEDITOR.tools.getNextId()+"_fileInput";var e=['<iframe frameborder="0" allowtransparency="0" class="cke_dialog_ui_input_file" role="presentation" id="',a.frameId,'" title="',n.label,'" src="javascript:void('];return e.push(CKEDITOR.env.ie?"(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"})()":"0"),e.push(')"></iframe>'),e.join("")}))}},fileButton:function(t,n,i){var a=this;if(!(3>arguments.length)){e.call(this,n),n.validate&&(this.validate=n.validate);var r=CKEDITOR.tools.extend({},n),o=r.onClick;r.className=(r.className?r.className+" ":"")+"cke_dialog_ui_button",r.onClick=function(e){var i=n.for;!1!==(e=!!o&&o.call(this,e))&&("xhr"!==e&&t.getContentElement(i[0],i[1]).submit(),this.disable())},t.on("load",(function(){t.getContentElement(n.for[0],n.for[1])._.buttons.push(a)})),CKEDITOR.ui.dialog.button.call(this,t,r,i)}},html:function(){var e=/^\s*<[\w:]+\s+([^>]*)?>/,t=/^(\s*<[\w:]+(?:\s+[^>]*)?)((?:.|\r|\n)+)$/,n=/\/$/;return function(i,a,r){if(!(3>arguments.length)){var o=[],s=a.html;"<"!=s.charAt(0)&&(s="<span>"+s+"</span>");var l=a.focus;if(l){var d=this.focus;this.focus=function(){("function"==typeof l?l:d).call(this),this.fire("focus")},a.isFocusable&&(this.isFocusable=this.isFocusable),this.keyboardFocusable=!0}CKEDITOR.ui.dialog.uiElement.call(this,i,a,o,"span",null,null,""),o=o.join("").match(e),s=s.match(t)||["","",""],n.test(s[1])&&(s[1]=s[1].slice(0,-1),s[2]="/"+s[2]),r.push([s[1]," ",o[1]||"",s[2]].join(""))}}}(),fieldset:function(e,t,n,i,a){var r=a.label;this._={children:t},CKEDITOR.ui.dialog.uiElement.call(this,e,a,i,"fieldset",null,null,(function(){var e=[];r&&e.push("<legend"+(a.labelStyle?' style="'+a.labelStyle+'"':"")+">"+r+"</legend>");for(var t=0;t<n.length;t++)e.push(n[t]);return e.join("")}))}},!0),CKEDITOR.ui.dialog.html.prototype=new CKEDITOR.ui.dialog.uiElement,CKEDITOR.ui.dialog.labeledElement.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{setLabel:function(e){var t=CKEDITOR.document.getById(this._.labelId);return 1>t.getChildCount()?new CKEDITOR.dom.text(e,CKEDITOR.document).appendTo(t):t.getChild(0).$.nodeValue=e,this},getLabel:function(){var e=CKEDITOR.document.getById(this._.labelId);return!e||1>e.getChildCount()?"":e.getChild(0).getText()},eventProcessors:a},!0),CKEDITOR.ui.dialog.button.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{click:function(){return!this._.disabled&&this.fire("click",{dialog:this._.dialog})},enable:function(){this._.disabled=!1;var e=this.getElement();e&&e.removeClass("cke_disabled")},disable:function(){this._.disabled=!0,this.getElement().addClass("cke_disabled")},isVisible:function(){return this.getElement().getFirst().isVisible()},isEnabled:function(){return!this._.disabled},eventProcessors:CKEDITOR.tools.extend({},CKEDITOR.ui.dialog.uiElement.prototype.eventProcessors,{onClick:function(e,t){this.on("click",(function(){t.apply(this,arguments)}))}},!0),accessKeyUp:function(){this.click()},accessKeyDown:function(){this.focus()},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.textInput.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return CKEDITOR.document.getById(this._.inputId)},focus:function(){var e=this.selectParentTab();setTimeout((function(){var t=e.getInputElement();t&&t.$.focus()}),0)},select:function(){var e=this.selectParentTab();setTimeout((function(){var t=e.getInputElement();t&&(t.$.focus(),t.$.select())}),0)},accessKeyUp:function(){this.select()},setValue:function(e){if(this.bidi){var t=e&&e.charAt(0);(t="‪"==t?"ltr":"‫"==t?"rtl":null)&&(e=e.slice(1)),this.setDirectionMarker(t)}return e||(e=""),CKEDITOR.ui.dialog.uiElement.prototype.setValue.apply(this,arguments)},getValue:function(){var e=CKEDITOR.ui.dialog.uiElement.prototype.getValue.call(this);if(this.bidi&&e){var t=this.getDirectionMarker();t&&(e=("ltr"==t?"‪":"‫")+e)}return e},setDirectionMarker:function(e){var t=this.getInputElement();e?t.setAttributes({dir:e,"data-cke-dir-marker":e}):this.getDirectionMarker()&&t.removeAttributes(["dir","data-cke-dir-marker"])},getDirectionMarker:function(){return this.getInputElement().data("cke-dir-marker")},keyboardFocusable:!0},i,!0),CKEDITOR.ui.dialog.textarea.prototype=new CKEDITOR.ui.dialog.textInput,CKEDITOR.ui.dialog.select.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,{getInputElement:function(){return this._.select.getElement()},add:function(e,t,n){var i=new CKEDITOR.dom.element("option",this.getDialog().getParentEditor().document),a=this.getInputElement().$;return i.$.text=e,i.$.value=null==t?e:t,null==n?CKEDITOR.env.ie?a.add(i.$):a.add(i.$,null):a.add(i.$,n),this},remove:function(e){return this.getInputElement().$.remove(e),this},clear:function(){for(var e=this.getInputElement().$;0<e.length;)e.remove(0);return this},keyboardFocusable:!0},i,!0),CKEDITOR.ui.dialog.checkbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getInputElement:function(){return this._.checkbox.getElement()},setValue:function(e,t){return this.getInputElement().$.checked=e,!t&&this.fire("change",{value:e}),this},getValue:function(){return this.getInputElement().$.checked},accessKeyUp:function(){this.setValue(!this.getValue())},eventProcessors:{onChange:function(e,t){return!CKEDITOR.env.ie||8<CKEDITOR.env.version?a.onChange.apply(this,arguments):(e.on("load",(function(){var e=this._.checkbox.getElement();e.on("propertychange",(function(t){"checked"==(t=t.data.$).propertyName&&this.fire("change",{value:e.$.checked})}),this)}),this),this.on("change",t),null)}},keyboardFocusable:!0},i,!0),CKEDITOR.ui.dialog.radio.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{focus:function(){var e=this._.children,t=e[0],n=this._.dialog._,i=n.currentFocusIndex,a=i===n.focusList.length-1&&0===this.focusIndex;for(i>this.focusIndex&&!a&&(t=e[e.length-1]),n.currentFocusIndex=this.focusIndex,n=0;n<e.length;n++)if((i=e[n]).getInputElement().$.checked){t=i;break}t.focus()},setValue:function(e,t){for(var n,i=this._.children,a=0;a<i.length&&(n=i[a]);a++)n.getElement().$.checked=n.getValue()==e;return!t&&this.fire("change",{value:e}),this},getValue:function(){for(var e=this._.children,t=0;t<e.length;t++)if(e[t].getElement().$.checked)return e[t].getValue();return null},accessKeyUp:function(){var e,t=this._.children;for(e=0;e<t.length;e++)if(t[e].getElement().$.checked)return void t[e].getElement().focus();t[0].getElement().focus()},click:function(){this._.dialog._.currentFocusIndex=this.focusIndex},eventProcessors:{onChange:function(e,t){return!CKEDITOR.env.ie||8<CKEDITOR.env.version?a.onChange.apply(this,arguments):(e.on("load",(function(){for(var e=this._.children,t=this,n=0;n<e.length;n++)e[n].getElement().on("propertychange",(function(e){"checked"==(e=e.data.$).propertyName&&this.$.checked&&t.fire("change",{value:this.getAttribute("value")})}))}),this),this.on("change",t),null)}},keyboardFocusable:!0},i,!0),CKEDITOR.ui.dialog.file.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.labeledElement,i,{getInputElement:function(){var e=CKEDITOR.document.getById(this._.frameId).getFrameDocument();return 0<e.$.forms.length?new CKEDITOR.dom.element(e.$.forms[0].elements[0]):this.getElement()},submit:function(){return this.getInputElement().getParent().$.submit(),this},getAction:function(){return this.getInputElement().getParent().$.action},registerEvents:function(e){var t,n,i=/^on([A-Z]\w+)/,a=function(e,t,n,i){e.on("formLoaded",(function(){e.getInputElement().on(n,i,e)}))};for(n in e)(t=n.match(i))&&(this.eventProcessors[n]?this.eventProcessors[n].call(this,this._.dialog,e[n]):a(this,this._.dialog,t[1].toLowerCase(),e[n]));return this},reset:function(){function e(){n.$.open();var e="";i.size&&(e=i.size-(CKEDITOR.env.ie?7:0));var d=t.frameId+"_input";for(n.$.write(['<html dir="'+s+'" lang="'+l+'"><head><title></title></head><body style="margin: 0; overflow: hidden; background: transparent;">','<form enctype="multipart/form-data" method="POST" dir="'+s+'" lang="'+l+'" action="',CKEDITOR.tools.htmlEncode(i.action),'"><label id="',t.labelId,'" for="',d,'" style="display:none">',CKEDITOR.tools.htmlEncode(i.label),'</label><input style="width:100%" id="',d,'" aria-labelledby="',t.labelId,'" type="file" name="',CKEDITOR.tools.htmlEncode(i.id||"cke_upload"),'" size="',CKEDITOR.tools.htmlEncode(0<e?e:""),'" /></form></body></html><script>',CKEDITOR.env.ie?"("+CKEDITOR.tools.fixDomain+")();":"","window.parent.CKEDITOR.tools.callFunction("+r+");","window.onbeforeunload = function() {window.parent.CKEDITOR.tools.callFunction("+o+")}","<\/script>"].join("")),n.$.close(),e=0;e<a.length;e++)a[e].enable()}var t=this._,n=CKEDITOR.document.getById(t.frameId).getFrameDocument(),i=t.definition,a=t.buttons,r=this.formLoadedNumber,o=this.formUnloadNumber,s=t.dialog._.editor.lang.dir,l=t.dialog._.editor.langCode;r||(r=this.formLoadedNumber=CKEDITOR.tools.addFunction((function(){this.fire("formLoaded")}),this),o=this.formUnloadNumber=CKEDITOR.tools.addFunction((function(){this.getInputElement().clearCustomData()}),this),this.getDialog()._.editor.on("destroy",(function(){CKEDITOR.tools.removeFunction(r),CKEDITOR.tools.removeFunction(o)}))),CKEDITOR.env.gecko?setTimeout(e,500):e()},getValue:function(){return this.getInputElement().$.value||""},setInitValue:function(){this._.initValue=""},eventProcessors:{onChange:function(e,t){this._.domOnChangeRegistered||(this.on("formLoaded",(function(){this.getInputElement().on("change",(function(){this.fire("change",{value:this.getValue()})}),this)}),this),this._.domOnChangeRegistered=!0),this.on("change",t)}},keyboardFocusable:!0},!0),CKEDITOR.ui.dialog.fileButton.prototype=new CKEDITOR.ui.dialog.button,CKEDITOR.ui.dialog.fieldset.prototype=CKEDITOR.tools.clone(CKEDITOR.ui.dialog.hbox.prototype),CKEDITOR.dialog.addUIElement("text",t),CKEDITOR.dialog.addUIElement("password",t),CKEDITOR.dialog.addUIElement("tel",t),CKEDITOR.dialog.addUIElement("textarea",n),CKEDITOR.dialog.addUIElement("checkbox",n),CKEDITOR.dialog.addUIElement("radio",n),CKEDITOR.dialog.addUIElement("button",n),CKEDITOR.dialog.addUIElement("select",n),CKEDITOR.dialog.addUIElement("file",n),CKEDITOR.dialog.addUIElement("fileButton",n),CKEDITOR.dialog.addUIElement("html",n),CKEDITOR.dialog.addUIElement("fieldset",{build:function(e,t,n){for(var i,a=t.children,r=[],o=[],s=0;s<a.length&&(i=a[s]);s++){var l=[];r.push(l),o.push(CKEDITOR.dialog._.uiElementBuilders[i.type].build(e,i,l))}return new CKEDITOR.ui.dialog[t.type](e,o,r,n,t)}})}}),CKEDITOR.DIALOG_RESIZE_NONE=0,CKEDITOR.DIALOG_RESIZE_WIDTH=1,CKEDITOR.DIALOG_RESIZE_HEIGHT=2,CKEDITOR.DIALOG_RESIZE_BOTH=3,CKEDITOR.DIALOG_STATE_IDLE=1,CKEDITOR.DIALOG_STATE_BUSY=2,function(){function e(e){e._.tabBarMode=!0,e._.tabs[e._.currentTabId][0].focus(),e._.currentFocusIndex=-1}function t(){for(var e=this._.tabIdList.length,t=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId)+e,n=t-1;n>t-e;n--)if(this._.tabs[this._.tabIdList[n%e]][0].$.offsetHeight)return this._.tabIdList[n%e];return null}function n(){for(var e=this._.tabIdList.length,t=CKEDITOR.tools.indexOf(this._.tabIdList,this._.currentTabId),n=t+1;n<t+e;n++)if(this._.tabs[this._.tabIdList[n%e]][0].$.offsetHeight)return this._.tabIdList[n%e];return null}function i(e,t){for(var n=e.$.getElementsByTagName("input"),i=0,a=n.length;i<a;i++){var r=new CKEDITOR.dom.element(n[i]);"text"==r.getAttribute("type").toLowerCase()&&(t?(r.setAttribute("value",r.getCustomData("fake_value")||""),r.removeCustomData("fake_value")):(r.setCustomData("fake_value",r.getAttribute("value")),r.setAttribute("value","")))}}function a(e,t){var n=this.getInputElement();n&&(e?n.removeAttribute("aria-invalid"):n.setAttribute("aria-invalid",!0)),e||(this.select?this.select():this.focus()),t&&alert(t),this.fire("validated",{valid:e,msg:t})}function r(){var e=this.getInputElement();e&&e.removeAttribute("aria-invalid")}function o(e){var t=CKEDITOR.dom.element.createFromHtml(CKEDITOR.addTemplate("dialog",O).output({id:CKEDITOR.tools.getNextNumber(),editorId:e.id,langDir:e.lang.dir,langCode:e.langCode,editorDialogClass:"cke_editor_"+e.name.replace(/\./g,"\\.")+"_dialog",closeTitle:e.lang.common.close,hidpi:CKEDITOR.env.hidpi?"cke_hidpi":""})),n=t.getChild([0,0,0,0,0]),i=n.getChild(0),a=n.getChild(1);return e.plugins.clipboard&&CKEDITOR.plugins.clipboard.preventDefaultDropOnElement(n),!CKEDITOR.env.ie||CKEDITOR.env.quirks||CKEDITOR.env.edge||(e="javascript:void(function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.close();")+"}())",CKEDITOR.dom.element.createFromHtml('<iframe frameBorder="0" class="cke_iframe_shim" src="'+e+'" tabIndex="-1"></iframe>').appendTo(n.getParent())),i.unselectable(),a.unselectable(),{element:t,parts:{dialog:t.getChild(0),title:i,close:a,tabs:n.getChild(2),contents:n.getChild([3,0,0,0]),footer:n.getChild([3,0,1,0])}}}function s(e,t,n){this.element=t,this.focusIndex=n,this.tabIndex=0,this.isFocusable=function(){return!t.getAttribute("disabled")&&t.isVisible()},this.focus=function(){e._.currentFocusIndex=this.focusIndex,this.element.focus()},t.on("keydown",(function(e){e.data.getKeystroke()in{32:1,13:1}&&this.fire("click")})),t.on("focus",(function(){this.fire("mouseover")})),t.on("blur",(function(){this.fire("mouseout")}))}function l(e,t){this.dialog=e;for(var n,i=t.contents,a=0;n=i[a];a++)i[a]=n&&new d(e,n);CKEDITOR.tools.extend(this,t)}function d(e,t){this._={dialog:e},CKEDITOR.tools.extend(this,t)}function c(e){function t(t){var n="rtl"==f.lang.dir,c=d.width,h=d.height,p=c+(t.data.$.screenX-l.x)*(n?-1:1)*(e._.moved?1:2),g=h+(t.data.$.screenY-l.y)*(e._.moved?1:2),m=e._.element.getFirst(),v=(m=n&&parseInt(m.getComputedStyle("right"),10),e.getPosition());v.x=v.x||0,v.y=v.y||0,v.y+g>s.height&&(g=s.height-v.y),(n?m:v.x)+p>s.width&&(p=s.width-(n?m:v.x)),g=Math.floor(g),p=Math.floor(p),a!=CKEDITOR.DIALOG_RESIZE_WIDTH&&a!=CKEDITOR.DIALOG_RESIZE_BOTH||(c=Math.max(i.minWidth||0,p-r)),a!=CKEDITOR.DIALOG_RESIZE_HEIGHT&&a!=CKEDITOR.DIALOG_RESIZE_BOTH||(h=Math.max(i.minHeight||0,g-o)),e.resize(c,h),e._.moved&&u(e,e._.position.x,e._.position.y),e._.moved||e.layout(),t.data.preventDefault()}function n(){if(CKEDITOR.document.removeListener("mouseup",n),CKEDITOR.document.removeListener("mousemove",t),c&&(c.remove(),c=null),CKEDITOR.env.ie6Compat){var e=I.getChild(0).getFrameDocument();e.removeListener("mouseup",n),e.removeListener("mousemove",t)}}var i=e.definition,a=i.resizable;if(a!=CKEDITOR.DIALOG_RESIZE_NONE){var r,o,s,l,d,c,f=e.getParentEditor(),h=CKEDITOR.tools.addFunction((function(i){function a(e){return e.isVisible()}d=e.getSize();var u=e.parts.contents,f=u.$.getElementsByTagName("iframe").length,h=!(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.quirks);f&&(c=CKEDITOR.dom.element.createFromHtml('<div class="cke_dialog_resize_cover" style="height: 100%; position: absolute; width: 100%; left:0; top:0;"></div>'),u.append(c)),o=d.height-e.parts.contents.getFirst(a).getSize("height",h),r=d.width-e.parts.contents.getFirst(a).getSize("width",1),l={x:i.screenX,y:i.screenY},s=CKEDITOR.document.getWindow().getViewPaneSize(),CKEDITOR.document.on("mousemove",t),CKEDITOR.document.on("mouseup",n),CKEDITOR.env.ie6Compat&&((u=I.getChild(0).getFrameDocument()).on("mousemove",t),u.on("mouseup",n)),i.preventDefault&&i.preventDefault()}));e.on("load",(function(){var t="";a==CKEDITOR.DIALOG_RESIZE_WIDTH?t=" cke_resizer_horizontal":a==CKEDITOR.DIALOG_RESIZE_HEIGHT&&(t=" cke_resizer_vertical"),t=CKEDITOR.dom.element.createFromHtml('<div class="cke_resizer'+t+" cke_resizer_"+f.lang.dir+'" title="'+CKEDITOR.tools.htmlEncode(f.lang.common.resize)+'" onmousedown="CKEDITOR.tools.callFunction('+h+', event )">'+("ltr"==f.lang.dir?"◢":"◣")+"</div>"),e.parts.footer.append(t,1)})),f.on("destroy",(function(){CKEDITOR.tools.removeFunction(h)}))}}function u(e,t,n){var i=e.parts.dialog.getParent().getClientSize(),a=e.getSize(),r=e._.viewportRatio,o=Math.max(i.width-a.width,0);i=Math.max(i.height-a.height,0),r.width=o?t/o:r.width,r.height=i?n/i:r.height,e._.viewportRatio=r}function f(e){e.data.preventDefault(1)}function h(e){var t=e.config,n=CKEDITOR.skinName||e.config.skin,i=t.dialog_backgroundCoverColor||("moono-lisa"==n?"black":"white"),a=(n=t.dialog_backgroundCoverOpacity,t.baseFloatZIndex),r=(t=CKEDITOR.tools.genKey(i,n,a),w[t]);CKEDITOR.document.getBody().addClass("cke_dialog_open"),r?r.show():(a=['<div tabIndex="-1" style="position: ',CKEDITOR.env.ie6Compat?"absolute":"fixed","; z-index: ",a,"; top: 0px; left: 0px; ","; width: 100%; height: 100%;",CKEDITOR.env.ie6Compat?"":"background-color: "+i,'" class="cke_dialog_background_cover">'],CKEDITOR.env.ie6Compat&&(i="<html><body style=\\'background-color:"+i+";\\'></body></html>",a.push('<iframe hidefocus="true" frameborder="0" id="cke_dialog_background_iframe" src="javascript:'),a.push("void((function(){"+encodeURIComponent("document.open();("+CKEDITOR.tools.fixDomain+")();document.write( '"+i+"' );document.close();")+"})())"),a.push('" style="position:absolute;left:0;top:0;width:100%;height: 100%;filter: progid:DXImageTransform.Microsoft.Alpha(opacity=0)"></iframe>')),a.push("</div>"),(r=CKEDITOR.dom.element.createFromHtml(a.join(""))).setOpacity(void 0!==n?n:.5),r.on("keydown",f),r.on("keypress",f),r.on("keyup",f),r.appendTo(CKEDITOR.document.getBody()),w[t]=r),e.focusManager.add(r),I=r,CKEDITOR.env.mac&&CKEDITOR.env.webkit||r.focus()}function p(e){CKEDITOR.document.getBody().removeClass("cke_dialog_open"),I&&(e.focusManager.remove(I),I.hide())}function g(e){var t=e.data.$.ctrlKey||e.data.$.metaKey,n=e.data.$.altKey,i=e.data.$.shiftKey,a=String.fromCharCode(e.data.$.keyCode);(t=k[(t?"CTRL+":"")+(n?"ALT+":"")+(i?"SHIFT+":"")+a])&&t.length&&((t=t[t.length-1]).keydown&&t.keydown.call(t.uiElement,t.dialog,t.key),e.data.preventDefault())}function m(e){var t=e.data.$.ctrlKey||e.data.$.metaKey,n=e.data.$.altKey,i=e.data.$.shiftKey,a=String.fromCharCode(e.data.$.keyCode);(t=k[(t?"CTRL+":"")+(n?"ALT+":"")+(i?"SHIFT+":"")+a])&&t.length&&(t=t[t.length-1]).keyup&&(t.keyup.call(t.uiElement,t.dialog,t.key),e.data.preventDefault())}function v(e,t,n,i,a){(k[n]||(k[n]=[])).push({uiElement:e,dialog:t,key:n,keyup:a||e.accessKeyUp,keydown:i||e.accessKeyDown})}function E(e,t){e._.accessKeyMap[t]&&e.selectPage(e._.accessKeyMap[t])}function T(){}var C,I,b=CKEDITOR.tools.cssLength,y=!1,D=!CKEDITOR.env.ie||CKEDITOR.env.edge,O='<div class="cke_reset_all cke_dialog_container {editorId} {editorDialogClass} {hidpi}" dir="{langDir}" style="'+(D?"display:flex":"")+'" lang="{langCode}" role="dialog" aria-labelledby="cke_dialog_title_{id}"><table class="cke_dialog '+CKEDITOR.env.cssClass+' cke_{langDir}" style="'+(D?"margin:auto":"position:absolute")+'" role="presentation"><tr><td role="presentation"><div class="cke_dialog_body" role="presentation"><div id="cke_dialog_title_{id}" class="cke_dialog_title" role="presentation"></div><a id="cke_dialog_close_button_{id}" class="cke_dialog_close_button" href="javascript:void(0)" title="{closeTitle}" role="button"><span class="cke_label">X</span></a><div id="cke_dialog_tabs_{id}" class="cke_dialog_tabs" role="tablist"></div><table class="cke_dialog_contents" role="presentation"><tr><td id="cke_dialog_contents_{id}" class="cke_dialog_contents_body" role="presentation"></td></tr><tr><td id="cke_dialog_footer_{id}" class="cke_dialog_footer" role="presentation"></td></tr></table></div></td></tr></table></div>';CKEDITOR.dialog=function(i,s){function d(e){var t=y._.focusList;if(e=e||0,!(1>t.length)){var n=y._.currentFocusIndex;y._.tabBarMode&&0>e&&(n=0);try{t[n].getInputElement().$.blur()}catch(e){}var i=n,a=1<y._.pageCount;do{if(i+=e,a&&!y._.tabBarMode&&(i==t.length||-1==i))return y._.tabBarMode=!0,y._.tabs[y._.currentTabId][0].focus(),void(y._.currentFocusIndex=-1);if((i=(i+t.length)%t.length)==n)break}while(e&&!t[i].isFocusable());t[i].focus(),"text"==t[i].type&&t[i].select()}}function u(a){if(y==CKEDITOR.dialog._.currentTop){var r=a.data.getKeystroke(),o="rtl"==i.lang.dir;if(h=p=0,9==r||r==CKEDITOR.SHIFT+9)d(r==CKEDITOR.SHIFT+9?-1:1),h=1;else if(r==CKEDITOR.ALT+121&&!y._.tabBarMode&&1<y.getPageCount())e(y),h=1;else if(-1!=CKEDITOR.tools.indexOf([37,38,39,40],r)&&y._.tabBarMode)r=-1!=CKEDITOR.tools.indexOf([o?39:37,38],r)?t.call(y):n.call(y),y.selectPage(r),y._.tabs[r][0].focus(),h=1;else if(13!=r&&32!=r||!y._.tabBarMode)if(13==r)(r=a.data.getTarget()).is("a","button","select","textarea")||r.is("input")&&"button"==r.$.type||((r=this.getButton("ok"))&&CKEDITOR.tools.setTimeout(r.click,0,r),h=1),p=1;else{if(27!=r)return;(r=this.getButton("cancel"))?CKEDITOR.tools.setTimeout(r.click,0,r):!1!==this.fire("cancel",{hide:!0}).hide&&this.hide(),p=1}else this.selectPage(this._.currentTabId),this._.tabBarMode=!1,this._.currentFocusIndex=-1,d(1),h=1;f(a)}}function f(e){h?e.data.preventDefault(1):p&&e.data.stopPropagation()}var h,p,g=CKEDITOR.dialog._.dialogDefinitions[s],m=CKEDITOR.tools.clone(C),v=i.config.dialog_buttonsOrder||"OS",E=i.lang.dir,T={};if(("OS"==v&&CKEDITOR.env.mac||"rtl"==v&&"ltr"==E||"ltr"==v&&"rtl"==E)&&m.buttons.reverse(),g=CKEDITOR.tools.extend(g(i),m),g=new l(this,g=CKEDITOR.tools.clone(g)),m=o(i),this._={editor:i,element:m.element,name:s,model:null,contentSize:{width:0,height:0},size:{width:0,height:0},contents:{},buttons:{},accessKeyMap:{},viewportRatio:{width:.5,height:.5},tabs:{},tabIdList:[],currentTabId:null,currentTabIndex:null,pageCount:0,lastTab:null,tabBarMode:!1,focusList:[],currentFocusIndex:0,hasFocus:!1},this.parts=m.parts,CKEDITOR.tools.setTimeout((function(){i.fire("ariaWidget",this.parts.contents)}),0,this),m={top:0,visibility:"hidden"},CKEDITOR.env.ie6Compat&&(m.position="absolute"),m["rtl"==E?"right":"left"]=0,this.parts.dialog.setStyles(m),CKEDITOR.event.call(this),this.definition=g=CKEDITOR.fire("dialogDefinition",{name:s,definition:g,dialog:this},i).definition,!("removeDialogTabs"in i._)&&i.config.removeDialogTabs){for(m=i.config.removeDialogTabs.split(";"),E=0;E<m.length;E++)if(2==(v=m[E].split(":")).length){var b=v[0];T[b]||(T[b]=[]),T[b].push(v[1])}i._.removeDialogTabs=T}if(i._.removeDialogTabs&&(T=i._.removeDialogTabs[s]))for(E=0;E<T.length;E++)g.removeContents(T[E]);g.onLoad&&this.on("load",g.onLoad),g.onShow&&this.on("show",g.onShow),g.onHide&&this.on("hide",g.onHide),g.onOk&&this.on("ok",(function(e){i.fire("saveSnapshot"),setTimeout((function(){i.fire("saveSnapshot")}),0),!1===g.onOk.call(this,e)&&(e.data.hide=!1)})),this.state=CKEDITOR.DIALOG_STATE_IDLE,g.onCancel&&this.on("cancel",(function(e){!1===g.onCancel.call(this,e)&&(e.data.hide=!1)}));var y=this,D=function(e){var t,n=y._.contents;for(t in n)for(var i in n[t])if(e.call(this,n[t][i]))return};this.on("ok",(function(e){D((function(t){if(t.validate){var n=t.validate(this),i="string"==typeof n||!1===n;return i&&(e.data.hide=!1,e.stop()),a.call(t,!i,"string"==typeof n?n:void 0),i}}))}),this,null,0),this.on("cancel",(function(e){D((function(t){if(t.isChanged())return i.config.dialog_noConfirmCancel||confirm(i.lang.common.confirmCancel)||(e.data.hide=!1),!0}))}),this,null,0),this.parts.close.on("click",(function(e){!1!==this.fire("cancel",{hide:!0}).hide&&this.hide(),e.data.preventDefault()}),this),this.changeFocus=d;var O=this._.element;for(i.focusManager.add(O,1),this.on("show",(function(){O.on("keydown",u,this),CKEDITOR.env.gecko&&O.on("keypress",f,this)})),this.on("hide",(function(){O.removeListener("keydown",u),CKEDITOR.env.gecko&&O.removeListener("keypress",f),D((function(e){r.apply(e)}))})),this.on("iframeAdded",(function(e){new CKEDITOR.dom.document(e.data.iframe.$.contentWindow.document).on("keydown",u,this,null,0)})),this.on("show",(function(){!function(){var e=y._.focusList;e.sort((function(e,t){return e.tabIndex!=t.tabIndex?t.tabIndex-e.tabIndex:e.focusIndex-t.focusIndex}));for(var t=e.length,n=0;n<t;n++)e[n].focusIndex=n}();var e=1<y._.pageCount;i.config.dialog_startupFocusTab&&e?(y._.tabBarMode=!0,y._.tabs[y._.currentTabId][0].focus(),y._.currentFocusIndex=-1):this._.hasFocus||(this._.currentFocusIndex=e?-1:this._.focusList.length-1,g.onFocus?(e=g.onFocus.call(this))&&e.focus():d(1))}),this,null,4294967295),CKEDITOR.env.ie6Compat&&this.on("load",(function(){var e=this.getElement(),t=e.getFirst();t.remove(),t.appendTo(e)}),this),function(e){function t(t){var n=e.getSize(),l=e.parts.dialog.getParent().getClientSize(),d=t.data.$.screenX,c=t.data.$.screenY,u=d-i.x,f=c-i.y;i={x:d,y:c},a.x+=u,a.y+=f,d=a.x+s[3]<o?-s[3]:a.x-s[1]>l.width-n.width-o?l.width-n.width+("rtl"==r.lang.dir?0:s[1]):a.x,n=a.y+s[0]<o?-s[0]:a.y-s[2]>l.height-n.height-o?l.height-n.height+s[2]:a.y,d=Math.floor(d),n=Math.floor(n),e.move(d,n,1),t.data.preventDefault()}function n(){if(CKEDITOR.document.removeListener("mousemove",t),CKEDITOR.document.removeListener("mouseup",n),CKEDITOR.env.ie6Compat){var e=I.getChild(0).getFrameDocument();e.removeListener("mousemove",t),e.removeListener("mouseup",n)}}var i=null,a=null,r=e.getParentEditor(),o=r.config.dialog_magnetDistance,s=CKEDITOR.skin.margins||[0,0,0,0];void 0===o&&(o=20),e.parts.title.on("mousedown",(function(r){if(!e._.moved){var o=e._.element;o.getFirst().setStyle("position","absolute"),o.removeStyle("display"),e._.moved=!0,e.layout()}i={x:r.data.$.screenX,y:r.data.$.screenY},CKEDITOR.document.on("mousemove",t),CKEDITOR.document.on("mouseup",n),a=e.getPosition(),CKEDITOR.env.ie6Compat&&((o=I.getChild(0).getFrameDocument()).on("mousemove",t),o.on("mouseup",n)),r.data.preventDefault()}),e)}(this),c(this),new CKEDITOR.dom.text(g.title,CKEDITOR.document).appendTo(this.parts.title),E=0;E<g.contents.length;E++)(T=g.contents[E])&&this.addPage(T);for(this.parts.tabs.on("click",(function(t){var n=t.data.getTarget();n.hasClass("cke_dialog_tab")&&(n=n.$.id,this.selectPage(n.substring(4,n.lastIndexOf("_"))),e(this),t.data.preventDefault())}),this),E=[],T=CKEDITOR.dialog._.uiElementBuilders.hbox.build(this,{type:"hbox",className:"cke_dialog_footer_buttons",widths:[],children:g.buttons},E).getChild(),this.parts.footer.setHtml(E.join("")),E=0;E<T.length;E++)this._.buttons[T[E].id]=T[E]},CKEDITOR.dialog.prototype={destroy:function(){this.hide(),this._.element.remove()},resize:function(e,t){if(!this._.contentSize||this._.contentSize.width!=e||this._.contentSize.height!=t){if(CKEDITOR.dialog.fire("resize",{dialog:this,width:e,height:t},this._.editor),this.fire("resize",{width:e,height:t},this._.editor),this.parts.contents.setStyles({width:e+"px",height:t+"px"}),"rtl"==this._.editor.lang.dir&&this._.position){var n=this.parts.dialog.getParent().getClientSize().width;this._.position.x=n-this._.contentSize.width-parseInt(this._.element.getFirst().getStyle("right"),10)}this._.contentSize={width:e,height:t}}},getSize:function(){var e=this._.element.getFirst();return{width:e.$.offsetWidth||0,height:e.$.offsetHeight||0}},move:function(e,t,n){var i=this._.element.getFirst(),a="rtl"==this._.editor.lang.dir;CKEDITOR.env.ie&&i.setStyle("zoom","100%");var r=this.parts.dialog.getParent().getClientSize(),o=this.getSize(),s=this._.viewportRatio,l=Math.max(r.width-o.width,0);r=Math.max(r.height-o.height,0),this._.position&&this._.position.x==e&&this._.position.y==t?(e=Math.floor(l*s.width),t=Math.floor(r*s.height)):u(this,e,t),this._.position={x:e,y:t},a&&(e=l-e),(t={top:(0<t?t:0)+"px"})[a?"right":"left"]=(0<e?e:0)+"px",i.setStyles(t),n&&(this._.moved=1)},getPosition:function(){return CKEDITOR.tools.extend({},this._.position)},show:function(){var e=this._.element,t=this.definition,n=CKEDITOR.document.getBody(),i=this._.editor.config.baseFloatZIndex;for(var a in e.getParent()&&e.getParent().equals(n)?e.setStyle("display",D?"flex":"block"):e.appendTo(n),this.resize(this._.contentSize&&this._.contentSize.width||t.width||t.minWidth,this._.contentSize&&this._.contentSize.height||t.height||t.minHeight),this.reset(),null===this._.currentTabId&&this.selectPage(this.definition.contents[0].id),null===CKEDITOR.dialog._.currentZIndex&&(CKEDITOR.dialog._.currentZIndex=i),this._.element.getFirst().setStyle("z-index",CKEDITOR.dialog._.currentZIndex+=10),this.getElement().setStyle("z-index",CKEDITOR.dialog._.currentZIndex),null===CKEDITOR.dialog._.currentTop?(CKEDITOR.dialog._.currentTop=this,this._.parentDialog=null,h(this._.editor)):CKEDITOR.dialog._.currentTop!==this&&(this._.parentDialog=CKEDITOR.dialog._.currentTop,(n=this._.parentDialog.getElement().getFirst()).$.style.zIndex-=Math.floor(i/2),this._.parentDialog.getElement().setStyle("z-index",n.$.style.zIndex),CKEDITOR.dialog._.currentTop=this),e.on("keydown",g),e.on("keyup",m),this._.hasFocus=!1,t.contents)if(t.contents[a]){e=t.contents[a],i=this._.tabs[e.id],n=e.requiredContent;var r=0;if(i){for(var o in this._.contents[e.id]){var s=this._.contents[e.id][o];"hbox"!=s.type&&"vbox"!=s.type&&s.getInputElement()&&(s.requiredContent&&!this._.editor.activeFilter.check(s.requiredContent)?s.disable():(s.enable(),r++))}!r||n&&!this._.editor.activeFilter.check(n)?i[0].addClass("cke_dialog_tab_disabled"):i[0].removeClass("cke_dialog_tab_disabled")}}CKEDITOR.tools.setTimeout((function(){this.layout(),function(e){function t(){e.layout()}var n=CKEDITOR.document.getWindow();n.on("resize",t),e.on("hide",(function(){n.removeListener("resize",t)}))}(this),this.parts.dialog.setStyle("visibility",""),this.fireOnce("load",{}),CKEDITOR.ui.fire("ready",this),this.fire("show",{}),this._.editor.fire("dialogShow",this),this._.parentDialog||this._.editor.focusManager.lock(),this.foreach((function(e){e.setInitValue&&e.setInitValue()}))}),100,this)},layout:function(){var e=this.parts.dialog;if(this._.moved||!D){var t,n=this.getSize(),i=CKEDITOR.document.getWindow().getViewPaneSize();this._.moved&&this._.position?(t=this._.position.x,n=this._.position.y):(t=(i.width-n.width)/2,n=(i.height-n.height)/2),CKEDITOR.env.ie6Compat||(e.setStyle("position","absolute"),e.removeStyle("margin")),t=Math.floor(t),n=Math.floor(n),this.move(t,n)}},foreach:function(e){for(var t in this._.contents)for(var n in this._.contents[t])e.call(this,this._.contents[t][n]);return this},reset:function(){var e=function(e){e.reset&&e.reset(1)};return function(){return this.foreach(e),this}}(),setupContent:function(){var e=arguments;this.foreach((function(t){t.setup&&t.setup.apply(t,e)}))},commitContent:function(){var e=arguments;this.foreach((function(t){CKEDITOR.env.ie&&this._.currentFocusIndex==t.focusIndex&&t.getInputElement().$.blur(),t.commit&&t.commit.apply(t,e)}))},hide:function(){if(this.parts.dialog.isVisible()){this.fire("hide",{}),this._.editor.fire("dialogHide",this),this.selectPage(this._.tabIdList[0]);var e=this._.element;for(e.setStyle("display","none"),this.parts.dialog.setStyle("visibility","hidden"),function(e){for(var t in k){for(var n=k[t],i=n.length-1;0<=i;i--)n[i].dialog!=e&&n[i].uiElement!=e||n.splice(i,1);0===n.length&&delete k[t]}}(this);CKEDITOR.dialog._.currentTop!=this;)CKEDITOR.dialog._.currentTop.hide();if(this._.parentDialog){var t=this._.parentDialog.getElement().getFirst(),n=parseInt(t.$.style.zIndex,10)+Math.floor(this._.editor.config.baseFloatZIndex/2);this._.parentDialog.getElement().setStyle("z-index",n),t.setStyle("z-index",n)}else p(this._.editor);if(CKEDITOR.dialog._.currentTop=this._.parentDialog)CKEDITOR.dialog._.currentZIndex-=10;else{CKEDITOR.dialog._.currentZIndex=null,e.removeListener("keydown",g),e.removeListener("keyup",m);var i=this._.editor;i.focus(),setTimeout((function(){i.focusManager.unlock(),CKEDITOR.env.iOS&&i.window.focus()}),0)}delete this._.parentDialog,this.foreach((function(e){e.resetInitValue&&e.resetInitValue()})),this.setState(CKEDITOR.DIALOG_STATE_IDLE)}},addPage:function(e){if(!e.requiredContent||this._.editor.filter.check(e.requiredContent)){for(var t=[],n=e.label?' title="'+CKEDITOR.tools.htmlEncode(e.label)+'"':"",i=CKEDITOR.dialog._.uiElementBuilders.vbox.build(this,{type:"vbox",className:"cke_dialog_page_contents",children:e.elements,expand:!!e.expand,padding:e.padding,style:e.style||"width: 100%;"},t),a=this._.contents[e.id]={},r=i.getChild(),o=0;i=r.shift();)i.notAllowed||"hbox"==i.type||"vbox"==i.type||o++,a[i.id]=i,"function"==typeof i.getChild&&r.push.apply(r,i.getChild());o||(e.hidden=!0),(t=CKEDITOR.dom.element.createFromHtml(t.join(""))).setAttribute("role","tabpanel"),t.setStyle("min-height","100%"),i=CKEDITOR.env,a="cke_"+e.id+"_"+CKEDITOR.tools.getNextNumber(),n=CKEDITOR.dom.element.createFromHtml(['<a class="cke_dialog_tab"',0<this._.pageCount?" cke_last":"cke_first",n,e.hidden?' style="display:none"':"",' id="',a,'"',i.gecko&&!i.hc?"":' href="javascript:void(0)"',' tabIndex="-1" hidefocus="true" role="tab">',e.label,"</a>"].join("")),t.setAttribute("aria-labelledby",a),this._.tabs[e.id]=[n,t],this._.tabIdList.push(e.id),!e.hidden&&this._.pageCount++,this._.lastTab=n,this.updateStyle(),t.setAttribute("name",e.id),t.appendTo(this.parts.contents),n.unselectable(),this.parts.tabs.append(n),e.accessKey&&(v(this,this,"CTRL+"+e.accessKey,T,E),this._.accessKeyMap["CTRL+"+e.accessKey]=e.id)}},selectPage:function(e){if(this._.currentTabId!=e&&!this._.tabs[e][0].hasClass("cke_dialog_tab_disabled")&&!1!==this.fire("selectPage",{page:e,currentPage:this._.currentTabId})){for(var t in this._.tabs){var n=this._.tabs[t][0],a=this._.tabs[t][1];t!=e&&(n.removeClass("cke_dialog_tab_selected"),n.removeAttribute("aria-selected"),a.hide()),a.setAttribute("aria-hidden",t!=e)}var r=this._.tabs[e];r[0].addClass("cke_dialog_tab_selected"),r[0].setAttribute("aria-selected",!0),CKEDITOR.env.ie6Compat||CKEDITOR.env.ie7Compat?(i(r[1]),r[1].show(),setTimeout((function(){i(r[1],1)}),0)):r[1].show(),this._.currentTabId=e,this._.currentTabIndex=CKEDITOR.tools.indexOf(this._.tabIdList,e)}},updateStyle:function(){this.parts.dialog[(1===this._.pageCount?"add":"remove")+"Class"]("cke_single_page")},hidePage:function(e){var n=this._.tabs[e]&&this._.tabs[e][0];n&&1!=this._.pageCount&&n.isVisible()&&(e==this._.currentTabId&&this.selectPage(t.call(this)),n.hide(),this._.pageCount--,this.updateStyle())},showPage:function(e){(e=this._.tabs[e]&&this._.tabs[e][0])&&(e.show(),this._.pageCount++,this.updateStyle())},getElement:function(){return this._.element},getName:function(){return this._.name},getContentElement:function(e,t){var n=this._.contents[e];return n&&n[t]},getValueOf:function(e,t){return this.getContentElement(e,t).getValue()},setValueOf:function(e,t,n){return this.getContentElement(e,t).setValue(n)},getButton:function(e){return this._.buttons[e]},click:function(e){return this._.buttons[e].click()},disableButton:function(e){return this._.buttons[e].disable()},enableButton:function(e){return this._.buttons[e].enable()},getPageCount:function(){return this._.pageCount},getParentEditor:function(){return this._.editor},getSelectedElement:function(){return this.getParentEditor().getSelection().getSelectedElement()},addFocusable:function(e,t){if(void 0===t)t=this._.focusList.length,this._.focusList.push(new s(this,e,t));else{this._.focusList.splice(t,0,new s(this,e,t));for(var n=t+1;n<this._.focusList.length;n++)this._.focusList[n].focusIndex++}},setState:function(e){if(this.state!=e){if(this.state=e,e==CKEDITOR.DIALOG_STATE_BUSY){if(!this.parts.spinner){var t=this.getParentEditor().lang.dir,n={attributes:{class:"cke_dialog_spinner"},styles:{float:"rtl"==t?"right":"left"}};n.styles["margin-"+("rtl"==t?"left":"right")]="8px",this.parts.spinner=CKEDITOR.document.createElement("div",n),this.parts.spinner.setHtml("&#8987;"),this.parts.spinner.appendTo(this.parts.title,1)}this.parts.spinner.show(),this.getButton("ok")&&this.getButton("ok").disable()}else e==CKEDITOR.DIALOG_STATE_IDLE&&(this.parts.spinner&&this.parts.spinner.hide(),this.getButton("ok")&&this.getButton("ok").enable());this.fire("state",e)}},getModel:function(e){return this._.model?this._.model:this.definition.getModel?this.definition.getModel(e):null},setModel:function(e){this._.model=e},getMode:function(e){return this.definition.getMode?this.definition.getMode(e):!(e=this.getModel(e))||e instanceof CKEDITOR.dom.element&&!e.getParent()?CKEDITOR.dialog.CREATION_MODE:CKEDITOR.dialog.EDITING_MODE}},CKEDITOR.tools.extend(CKEDITOR.dialog,{CREATION_MODE:0,EDITING_MODE:1,add:function(e,t){this._.dialogDefinitions[e]&&"function"!=typeof t||(this._.dialogDefinitions[e]=t)},exists:function(e){return!!this._.dialogDefinitions[e]},getCurrent:function(){return CKEDITOR.dialog._.currentTop},isTabEnabled:function(e,t,n){return!((e=e.config.removeDialogTabs)&&e.match(new RegExp("(?:^|;)"+t+":"+n+"(?:$|;)","i")))},okButton:function(){var e=function(e,t){return t=t||{},CKEDITOR.tools.extend({id:"ok",type:"button",label:e.lang.common.ok,class:"cke_dialog_ui_button_ok",onClick:function(e){!1!==(e=e.data.dialog).fire("ok",{hide:!0}).hide&&e.hide()}},t,!0)};return e.type="button",e.override=function(t){return CKEDITOR.tools.extend((function(n){return e(n,t)}),{type:"button"},!0)},e}(),cancelButton:function(){var e=function(e,t){return t=t||{},CKEDITOR.tools.extend({id:"cancel",type:"button",label:e.lang.common.cancel,class:"cke_dialog_ui_button_cancel",onClick:function(e){!1!==(e=e.data.dialog).fire("cancel",{hide:!0}).hide&&e.hide()}},t,!0)};return e.type="button",e.override=function(t){return CKEDITOR.tools.extend((function(n){return e(n,t)}),{type:"button"},!0)},e}(),addUIElement:function(e,t){this._.uiElementBuilders[e]=t}}),CKEDITOR.dialog._={uiElementBuilders:{},dialogDefinitions:{},currentTop:null,currentZIndex:null},CKEDITOR.event.implementOn(CKEDITOR.dialog),CKEDITOR.event.implementOn(CKEDITOR.dialog.prototype),C={resizable:CKEDITOR.DIALOG_RESIZE_BOTH,minWidth:600,minHeight:400,buttons:[CKEDITOR.dialog.okButton,CKEDITOR.dialog.cancelButton]};var R=function(e,t,n){for(var i,a=0;i=e[a];a++)if(i.id==t||n&&i[n]&&(i=R(i[n],t,n)))return i;return null},_=function(e,t,n,i,a){if(n){for(var r,o=0;r=e[o];o++){if(r.id==n)return e.splice(o,0,t),t;if(i&&r[i]&&(r=_(r[i],t,n,i,!0)))return r}if(a)return null}return e.push(t),t},x=function(e,t,n){for(var i,a=0;i=e[a];a++){if(i.id==t)return e.splice(a,1);if(n&&i[n]&&(i=x(i[n],t,n)))return i}return null};l.prototype={getContents:function(e){return R(this.contents,e)},getButton:function(e){return R(this.buttons,e)},addContents:function(e,t){return _(this.contents,e,t)},addButton:function(e,t){return _(this.buttons,e,t)},removeContents:function(e){x(this.contents,e)},removeButton:function(e){x(this.buttons,e)}},d.prototype={get:function(e){return R(this.elements,e,"children")},add:function(e,t){return _(this.elements,e,t,"children")},remove:function(e){x(this.elements,e,"children")}};var w={},k={};CKEDITOR.ui.dialog={uiElement:function(e,t,n,i,a,r,o){if(!(4>arguments.length)){var s=(i.call?i(t):i)||"div",l=["<",s," "],d=(a&&a.call?a(t):a)||{},c=(r&&r.call?r(t):r)||{},u=(o&&o.call?o.call(this,e,t):o)||"",f=this.domId=c.id||CKEDITOR.tools.getNextId()+"_uiElement";t.requiredContent&&!e.getParentEditor().filter.check(t.requiredContent)&&(d.display="none",this.notAllowed=!0),c.id=f;var h={};t.type&&(h["cke_dialog_ui_"+t.type]=1),t.className&&(h[t.className]=1),t.disabled&&(h.cke_disabled=1);var p=c.class&&c.class.split?c.class.split(" "):[];for(f=0;f<p.length;f++)p[f]&&(h[p[f]]=1);for(f in p=[],h)p.push(f);for(f in c.class=p.join(" "),t.title&&(c.title=t.title),h=(t.style||"").split(";"),t.align&&(p=t.align,d["margin-left"]="left"==p?0:"auto",d["margin-right"]="right"==p?0:"auto"),d)h.push(f+":"+d[f]);for(t.hidden&&h.push("display:none"),f=h.length-1;0<=f;f--)""===h[f]&&h.splice(f,1);for(f in 0<h.length&&(c.style=(c.style?c.style+"; ":"")+h.join("; ")),c)l.push(f+'="'+CKEDITOR.tools.htmlEncode(c[f])+'" ');l.push(">",u,"</",s,">"),n.push(l.join("")),(this._||(this._={})).dialog=e,"boolean"==typeof t.isChanged&&(this.isChanged=function(){return t.isChanged}),"function"==typeof t.isChanged&&(this.isChanged=t.isChanged),"function"==typeof t.setValue&&(this.setValue=CKEDITOR.tools.override(this.setValue,(function(e){return function(n){e.call(this,t.setValue.call(this,n))}}))),"function"==typeof t.getValue&&(this.getValue=CKEDITOR.tools.override(this.getValue,(function(e){return function(){return t.getValue.call(this,e.call(this))}}))),CKEDITOR.event.implementOn(this),this.registerEvents(t),this.accessKeyUp&&this.accessKeyDown&&t.accessKey&&v(this,e,"CTRL+"+t.accessKey);var g=this;e.on("load",(function(){var t=g.getInputElement();if(t){var n=g.type in{checkbox:1,ratio:1}&&CKEDITOR.env.ie&&8>CKEDITOR.env.version?"cke_dialog_ui_focused":"";t.on("focus",(function(){e._.tabBarMode=!1,e._.hasFocus=!0,g.fire("focus"),n&&this.addClass(n)})),t.on("blur",(function(){g.fire("blur"),n&&this.removeClass(n)}))}})),CKEDITOR.tools.extend(this,t),this.keyboardFocusable&&(this.tabIndex=t.tabIndex||0,this.focusIndex=e._.focusList.push(this)-1,this.on("focus",(function(){e._.currentFocusIndex=g.focusIndex})))}},hbox:function(e,t,n,i,a){if(!(4>arguments.length)){this._||(this._={});var r,o=this._.children=t,s=a&&a.widths||null,l=a&&a.height||null,d={role:"presentation"};a&&a.align&&(d.align=a.align),CKEDITOR.ui.dialog.uiElement.call(this,e,a||{type:"hbox"},i,"table",{},d,(function(){var e=['<tbody><tr class="cke_dialog_ui_hbox">'];for(r=0;r<n.length;r++){var t="cke_dialog_ui_hbox_child",i=[];0===r&&(t="cke_dialog_ui_hbox_first"),r==n.length-1&&(t="cke_dialog_ui_hbox_last"),e.push('<td class="',t,'" role="presentation" '),s?s[r]&&i.push("width:"+b(s[r])):i.push("width:"+Math.floor(100/n.length)+"%"),l&&i.push("height:"+b(l)),a&&void 0!==a.padding&&i.push("padding:"+b(a.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&o[r].align&&i.push("text-align:"+o[r].align),0<i.length&&e.push('style="'+i.join("; ")+'" '),e.push(">",n[r],"</td>")}return e.push("</tr></tbody>"),e.join("")}))}},vbox:function(e,t,n,i,a){if(!(3>arguments.length)){this._||(this._={});var r=this._.children=t,o=a&&a.width||null,s=a&&a.heights||null;CKEDITOR.ui.dialog.uiElement.call(this,e,a||{type:"vbox"},i,"div",null,{role:"presentation"},(function(){var t=['<table role="presentation" cellspacing="0" border="0" '];t.push('style="'),a&&a.expand&&t.push("height:100%;"),t.push("width:"+b(o||"100%"),";"),CKEDITOR.env.webkit&&t.push("float:none;"),t.push('"'),t.push('align="',CKEDITOR.tools.htmlEncode(a&&a.align||("ltr"==e.getParentEditor().lang.dir?"left":"right")),'" '),t.push("><tbody>");for(var i=0;i<n.length;i++){var l=[];t.push('<tr><td role="presentation" '),o&&l.push("width:"+b(o||"100%")),s?l.push("height:"+b(s[i])):a&&a.expand&&l.push("height:"+Math.floor(100/n.length)+"%"),a&&void 0!==a.padding&&l.push("padding:"+b(a.padding)),CKEDITOR.env.ie&&CKEDITOR.env.quirks&&r[i].align&&l.push("text-align:"+r[i].align),0<l.length&&t.push('style="',l.join("; "),'" '),t.push(' class="cke_dialog_ui_vbox_child">',n[i],"</td></tr>")}return t.push("</tbody></table>"),t.join("")}))}}},CKEDITOR.ui.dialog.uiElement.prototype={getElement:function(){return CKEDITOR.document.getById(this.domId)},getInputElement:function(){return this.getElement()},getDialog:function(){return this._.dialog},setValue:function(e,t){return this.getInputElement().setValue(e),!t&&this.fire("change",{value:e}),this},getValue:function(){return this.getInputElement().getValue()},isChanged:function(){return!1},selectParentTab:function(){for(var e=this.getInputElement();(e=e.getParent())&&-1==e.$.className.search("cke_dialog_page_contents"););return e?(e=e.getAttribute("name"),this._.dialog._.currentTabId!=e&&this._.dialog.selectPage(e),this):this},focus:function(){return this.selectParentTab().getInputElement().focus(),this},registerEvents:function(e){var t,n,i=/^on([A-Z]\w+)/,a=function(e,t,n,i){t.on("load",(function(){e.getInputElement().on(n,i,e)}))};for(n in e)(t=n.match(i))&&(this.eventProcessors[n]?this.eventProcessors[n].call(this,this._.dialog,e[n]):a(this,this._.dialog,t[1].toLowerCase(),e[n]));return this},eventProcessors:{onLoad:function(e,t){e.on("load",t,this)},onShow:function(e,t){e.on("show",t,this)},onHide:function(e,t){e.on("hide",t,this)}},accessKeyDown:function(){this.focus()},accessKeyUp:function(){},disable:function(){var e=this.getElement();this.getInputElement().setAttribute("disabled","true"),e.addClass("cke_disabled")},enable:function(){var e=this.getElement();this.getInputElement().removeAttribute("disabled"),e.removeClass("cke_disabled")},isEnabled:function(){return!this.getElement().hasClass("cke_disabled")},isVisible:function(){return this.getInputElement().isVisible()},isFocusable:function(){return!(!this.isEnabled()||!this.isVisible())}},CKEDITOR.ui.dialog.hbox.prototype=CKEDITOR.tools.extend(new CKEDITOR.ui.dialog.uiElement,{getChild:function(e){return 1>arguments.length?this._.children.concat():(e.splice||(e=[e]),2>e.length?this._.children[e[0]]:this._.children[e[0]]&&this._.children[e[0]].getChild?this._.children[e[0]].getChild(e.slice(1,e.length)):null)}},!0),CKEDITOR.ui.dialog.vbox.prototype=new CKEDITOR.ui.dialog.hbox,function(){var e={build:function(e,t,n){for(var i,a=t.children,r=[],o=[],s=0;s<a.length&&(i=a[s]);s++){var l=[];r.push(l),o.push(CKEDITOR.dialog._.uiElementBuilders[i.type].build(e,i,l))}return new CKEDITOR.ui.dialog[t.type](e,o,r,n,t)}};CKEDITOR.dialog.addUIElement("hbox",e),CKEDITOR.dialog.addUIElement("vbox",e)}(),CKEDITOR.dialogCommand=function(e,t){this.dialogName=e,CKEDITOR.tools.extend(this,t,!0)},CKEDITOR.dialogCommand.prototype={exec:function(e){var t=this.tabId;e.openDialog(this.dialogName,(function(e){t&&e.selectPage(t)}))},canUndo:!1,editorFocus:1},function(){var e=/^\d*$/,t=/^\d*(?:\.\d+)?$/,n=/^(((\d*(\.\d+))|(\d*))(px|\%)?)?$/,i=/^(((\d*(\.\d+))|(\d*))(px|em|ex|in|cm|mm|pt|pc|\%)?)?$/i,a=/^(--|-?([a-zA-Z_]|\\))(\\|[a-zA-Z0-9-_])*\s*?:\s*?[^:;]+$/;CKEDITOR.VALIDATE_OR=1,CKEDITOR.VALIDATE_AND=2,CKEDITOR.dialog.validate={functions:function(){var e=arguments;return function(t){this&&this.getValue&&(t=this.getValue());var n,i,a=CKEDITOR.VALIDATE_AND,r=[];for(i=0;i<e.length&&"function"==typeof e[i];i++)r.push(e[i]);i<e.length&&"string"==typeof e[i]&&(n=e[i],i++),i<e.length&&"number"==typeof e[i]&&(a=e[i]),i=a==CKEDITOR.VALIDATE_AND;for(var o=0;o<r.length;o++){var s=!0===r[o](t);i=a==CKEDITOR.VALIDATE_AND?i&&s:i||s}return!!i||n}},regex:function(e,t){return this.functions((function(t){return e.test(t)}),t)},notEmpty:function(e){return this.functions((function(e){return 0<e.replace(RegExp("^[\\u0020\\u00a0\\u1680\\u202f\\u205f\\u3000\\u2000-\\u200a\\s]+|[\\u0020\\u00a0\\u1680\\u202f\\u205f\\u3000\\u2000-\\u200a\\s]+$","g"),"").length}),e)},integer:function(t){return this.regex(e,t)},number:function(e){return this.regex(t,e)},cssLength:function(e){return this.functions((function(e){return i.test(CKEDITOR.tools.trim(e))}),e)},htmlLength:function(e){return this.functions((function(e){return n.test(CKEDITOR.tools.trim(e))}),e)},inlineStyle:function(e){return this.functions((function(e){return""===(e=CKEDITOR.tools.trim(e).split(";"))[e.length-1]&&e.pop(),CKEDITOR.tools.array.every(e,(function(e){return a.test(CKEDITOR.tools.trim(e))}))}),e)},equals:function(e,t){return this.functions((function(t){return t==e}),t)},notEqual:function(e,t){return this.functions((function(t){return t!=e}),t)}},CKEDITOR.on("instanceDestroyed",(function(e){if(CKEDITOR.tools.isEmpty(CKEDITOR.instances)){for(var t;t=CKEDITOR.dialog._.currentTop;)t.hide();for(var n in w)w[n].remove();w={}}for(var i in e=e.editor._.storedDialogs)e[i].destroy()}))}(),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{openDialog:function(e,t,n){var i=null,a=CKEDITOR.dialog._.dialogDefinitions[e];if(null===CKEDITOR.dialog._.currentTop&&h(this),"function"==typeof a)a=this._.storedDialogs||(this._.storedDialogs={}),(i=a[e]||(a[e]=new CKEDITOR.dialog(this,e))).setModel(n),t&&t.call(i,i),i.show();else{if("failed"==a)throw p(this),Error('[CKEDITOR.dialog.openDialog] Dialog "'+e+'" failed when loading definition.');"string"==typeof a&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(a),(function(){"function"!=typeof CKEDITOR.dialog._.dialogDefinitions[e]&&(CKEDITOR.dialog._.dialogDefinitions[e]="failed"),this.openDialog(e,t,n)}),this,0,1)}return CKEDITOR.skin.loadPart("dialog"),i&&i.once("hide",(function(){i.setModel(null)}),null,null,999),i}}),CKEDITOR.plugins.add("dialog",{requires:"dialogui",init:function(e){y||(CKEDITOR.document.appendStyleSheet(this.path+"styles/dialog.css"),y=!0),e.on("doubleclick",(function(t){t.data.dialog&&e.openDialog(t.data.dialog)}),null,null,999)}})}(),function(){function e(e,t){CKEDITOR.tools.extend(this,t,{editor:e,id:"cke-"+CKEDITOR.tools.getUniqueId(),area:e._.notificationArea}),t.type||(this.type="info"),this.element=this._createElement(),e.plugins.clipboard&&CKEDITOR.plugins.clipboard.preventDefaultDropOnElement(this.element)}function t(e){var t=this;this.editor=e,this.notifications=[],this.element=this._createElement(),this._uiBuffer=CKEDITOR.tools.eventsBuffer(10,this._layout,this),this._changeBuffer=CKEDITOR.tools.eventsBuffer(500,this._layout,this),e.on("destroy",(function(){t._removeListeners(),t.element.remove()}))}CKEDITOR.plugins.add("notification",{init:function(e){e._.notificationArea=new t(e),e.showNotification=function(t,n,i){var a,r;return"progress"==n?a=i:r=i,(t=new CKEDITOR.plugins.notification(e,{message:t,type:n,progress:a,duration:r})).show(),t},e.on("key",(function(t){if(27==t.data.keyCode){var n=e._.notificationArea.notifications;n.length&&(function(e){var t=new CKEDITOR.dom.element("div");t.setStyles({position:"fixed","margin-left":"-9999px"}),t.setAttributes({"aria-live":"assertive","aria-atomic":"true"}),t.setText(e),CKEDITOR.document.getBody().append(t),setTimeout((function(){t.remove()}),100)}(e.lang.notification.closed),n[n.length-1].hide(),t.cancel())}}))}}),e.prototype={show:function(){!1!==this.editor.fire("notificationShow",{notification:this})&&(this.area.add(this),this._hideAfterTimeout())},update:function(e){var t=!0;!1===this.editor.fire("notificationUpdate",{notification:this,options:e})&&(t=!1);var n=this.element,i=n.findOne(".cke_notification_message"),a=n.findOne(".cke_notification_progress"),r=e.type;n.removeAttribute("role"),e.progress&&"progress"!=this.type&&(r="progress"),r&&(n.removeClass(this._getClass()),n.removeAttribute("aria-label"),this.type=r,n.addClass(this._getClass()),n.setAttribute("aria-label",this.type),"progress"!=this.type||a?"progress"!=this.type&&a&&a.remove():(a=this._createProgressElement()).insertBefore(i)),void 0!==e.message&&(this.message=e.message,i.setHtml(this.message)),void 0!==e.progress&&(this.progress=e.progress,a&&a.setStyle("width",this._getPercentageProgress())),t&&e.important&&(n.setAttribute("role","alert"),this.isVisible()||this.area.add(this)),this.duration=e.duration,this._hideAfterTimeout()},hide:function(){!1!==this.editor.fire("notificationHide",{notification:this})&&this.area.remove(this)},isVisible:function(){return 0<=CKEDITOR.tools.indexOf(this.area.notifications,this)},_createElement:function(){var e,t,n=this,i=this.editor.lang.common.close;return(e=new CKEDITOR.dom.element("div")).addClass("cke_notification"),e.addClass(this._getClass()),e.setAttributes({id:this.id,role:"alert","aria-label":this.type}),"progress"==this.type&&e.append(this._createProgressElement()),(t=new CKEDITOR.dom.element("p")).addClass("cke_notification_message"),t.setHtml(this.message),e.append(t),t=CKEDITOR.dom.element.createFromHtml('<a class="cke_notification_close" href="javascript:void(0)" title="'+i+'" role="button" tabindex="-1"><span class="cke_label">X</span></a>'),e.append(t),t.on("click",(function(){n.editor.focus(),n.hide()})),e},_getClass:function(){return"progress"==this.type?"cke_notification_info":"cke_notification_"+this.type},_createProgressElement:function(){var e=new CKEDITOR.dom.element("span");return e.addClass("cke_notification_progress"),e.setStyle("width",this._getPercentageProgress()),e},_getPercentageProgress:function(){return Math.round(100*(this.progress||0))+"%"},_hideAfterTimeout:function(){var e,t=this;this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),"number"==typeof this.duration?e=this.duration:"info"!=this.type&&"success"!=this.type||(e="number"==typeof this.editor.config.notification_duration?this.editor.config.notification_duration:5e3),e&&(t._hideTimeoutId=setTimeout((function(){t.hide()}),e))}},t.prototype={add:function(e){this.notifications.push(e),this.element.append(e.element),1==this.element.getChildCount()&&(CKEDITOR.document.getBody().append(this.element),this._attachListeners()),this._layout()},remove:function(e){var t=CKEDITOR.tools.indexOf(this.notifications,e);0>t||(this.notifications.splice(t,1),e.element.remove(),this.element.getChildCount()||(this._removeListeners(),this.element.remove()))},_createElement:function(){var e=this.editor,t=e.config,n=new CKEDITOR.dom.element("div");return n.addClass("cke_notifications_area"),n.setAttribute("id","cke_notifications_area_"+e.name),n.setStyle("z-index",t.baseFloatZIndex-2),n},_attachListeners:function(){var e=CKEDITOR.document.getWindow(),t=this.editor;e.on("scroll",this._uiBuffer.input),e.on("resize",this._uiBuffer.input),t.on("change",this._changeBuffer.input),t.on("floatingSpaceLayout",this._layout,this,null,20),t.on("blur",this._layout,this,null,20)},_removeListeners:function(){var e=CKEDITOR.document.getWindow(),t=this.editor;e.removeListener("scroll",this._uiBuffer.input),e.removeListener("resize",this._uiBuffer.input),t.removeListener("change",this._changeBuffer.input),t.removeListener("floatingSpaceLayout",this._layout),t.removeListener("blur",this._layout)},_layout:function(){function e(){a.setStyle("left",g(m+o.width-d-c))}var t,n,i,a=this.element,r=this.editor,o=r.ui.contentsElement.getClientRect(),s=r.ui.contentsElement.getDocumentPosition(),l=a.getClientRect(),d=this._notificationWidth,c=this._notificationMargin,u=(i=CKEDITOR.document.getWindow()).getScrollPosition(),f=i.getViewPaneSize(),h=CKEDITOR.document.getBody(),p=h.getDocumentPosition(),g=CKEDITOR.tools.cssLength;d&&c||(i=this.element.getChild(0),d=this._notificationWidth=i.getClientRect().width,c=this._notificationMargin=parseInt(i.getComputedStyle("margin-left"),10)+parseInt(i.getComputedStyle("margin-right"),10)),r.toolbar&&(n=(t=r.ui.space(r.config.toolbarLocation)).getClientRect()),t&&t.isVisible()&&n.bottom>o.top&&n.bottom<o.bottom-l.height?a.setStyles({position:"fixed",top:g(n.bottom)}):0<o.top?a.setStyles({position:"absolute",top:g(s.y)}):s.y+o.height-l.height>u.y?a.setStyles({position:"fixed",top:0}):a.setStyles({position:"absolute",top:g(s.y+o.height-l.height)});var m="fixed"==a.getStyle("position")?o.left:"static"!=h.getComputedStyle("position")?s.x-p.x:s.x;o.width<d+c?s.x+d+c>u.x+f.width?e():a.setStyle("left",g(m)):s.x+d+c>u.x+f.width?a.setStyle("left",g(m)):s.x+o.width/2+d/2+c>u.x+f.width?a.setStyle("left",g(m-s.x+u.x+f.width-d-c)):0>o.left+o.width-d-c?e():0>o.left+o.width/2-d/2?a.setStyle("left",g(m-s.x+u.x)):a.setStyle("left",g(m+o.width/2-d/2-c/2))}},CKEDITOR.plugins.notification=e}(),function(){var e='<a id="{id}" class="cke_button cke_button__{name} cke_button_{state} {cls}"'+(CKEDITOR.env.gecko&&!CKEDITOR.env.hc?"":" href=\"javascript:void('{titleJs}')\"")+' title="{title}" tabindex="-1" hidefocus="true" role="button" aria-labelledby="{id}_label" aria-describedby="{id}_description" aria-haspopup="{hasArrow}" aria-disabled="{ariaDisabled}"{hasArrowAriaHtml}{toggleAriaHtml}';CKEDITOR.env.gecko&&CKEDITOR.env.mac&&(e+=' onkeypress="return false;"'),CKEDITOR.env.gecko&&(e+=' onblur="this.style.cssText = this.style.cssText;"');var t="";CKEDITOR.env.ie&&(t='return false;" onmouseup="CKEDITOR.tools.getMouseButton(event)==CKEDITOR.MOUSE_BUTTON_LEFT&&'),e=e+' onkeydown="return CKEDITOR.tools.callFunction({keydownFn},event);" onfocus="return CKEDITOR.tools.callFunction({focusFn},event);" onclick="'+t+'CKEDITOR.tools.callFunction({clickFn},this);return false;"><span class="cke_button_icon cke_button__{iconName}_icon" style="{style}">&nbsp;</span><span id="{id}_label" class="cke_button_label cke_button__{name}_label" aria-hidden="false">{label}</span><span id="{id}_description" class="cke_button_label" aria-hidden="false">{ariaShortcutSpace}{ariaShortcut}</span>{arrowHtml}</a>';var n=CKEDITOR.addTemplate("buttonArrow",'<span class="cke_button_arrow">'+(CKEDITOR.env.hc?"&#9660;":"")+"</span>"),i=CKEDITOR.addTemplate("button",e);CKEDITOR.plugins.add("button",{beforeInit:function(e){e.ui.addHandler(CKEDITOR.UI_BUTTON,CKEDITOR.ui.button.handler)}}),CKEDITOR.UI_BUTTON="button",CKEDITOR.ui.button=function(e){CKEDITOR.tools.extend(this,e,{isToggle:e.isToggle||!1,title:e.label,click:e.click||function(t){t.execCommand(e.command)}}),this._={}},CKEDITOR.ui.button.handler={create:function(e){return new CKEDITOR.ui.button(e)}},CKEDITOR.ui.button.prototype={render:function(e,t){function a(){var t=e.mode;t&&(t=this.modes[t]?void 0!==l[t]?l[t]:CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED,t=e.readOnly&&!this.readOnly?CKEDITOR.TRISTATE_DISABLED:t,this.setState(t),this.refresh&&this.refresh())}var r,o,s,l=null,d=CKEDITOR.env,c=this._.id=CKEDITOR.tools.getNextId(),u="",f=this.command;this._.editor=e;var h,p={id:c,button:this,editor:e,focus:function(){CKEDITOR.document.getById(c).focus()},execute:function(){this.button.click(e)},attach:function(e){this.button.attach(e)}},g=CKEDITOR.tools.addFunction((function(e){if(p.onkey)return e=new CKEDITOR.dom.event(e),!1!==p.onkey(p,e.getKeystroke())})),m=CKEDITOR.tools.addFunction((function(e){var t;return p.onfocus&&(t=!1!==p.onfocus(p,new CKEDITOR.dom.event(e))),t})),v=0;p.clickFn=r=CKEDITOR.tools.addFunction((function(){v&&(e.unlockSelection(1),v=0),p.execute(),d.iOS&&e.focus()})),this.modes?(l={},e.on("beforeModeUnload",(function(){e.mode&&this._.state!=CKEDITOR.TRISTATE_DISABLED&&(l[e.mode]=this._.state)}),this),e.on("activeFilterChange",a,this),e.on("mode",a,this),!this.readOnly&&e.on("readOnly",a,this)):f&&(f=e.getCommand(f))&&(f.on("state",(function(){this.setState(f.state)}),this),u+=f.state==CKEDITOR.TRISTATE_ON?"on":f.state==CKEDITOR.TRISTATE_DISABLED?"disabled":"off"),this.directional&&e.on("contentDirChanged",(function(t){var n=CKEDITOR.document.getById(this._.id),i=n.getFirst();(t=t.data)!=e.lang.dir?n.addClass("cke_"+t):n.removeClass("cke_ltr").removeClass("cke_rtl"),i.setAttribute("style",CKEDITOR.skin.getIconStyle(h,"rtl"==t,this.icon,this.iconOffset))}),this),f?(o=e.getCommandKeystroke(f))&&(s=CKEDITOR.tools.keystrokeToString(e.lang.common.keyboard,o)):u+="off",o=this.name||this.command;var E=null,T=this.icon;return h=o,this.icon&&!/\./.test(this.icon)?(h=this.icon,T=null):(this.icon&&(E=this.icon),CKEDITOR.env.hidpi&&this.iconHiDpi&&(E=this.iconHiDpi)),E?(CKEDITOR.skin.addIcon(E,E),T=null):E=h,u={id:c,name:o,iconName:h,label:this.label,cls:(this.hasArrow?"cke_button_expandable ":"")+(this.className||""),state:u,ariaDisabled:"disabled"==u?"true":"false",title:this.title+(s?" ("+s.display+")":""),ariaShortcutSpace:s?"&nbsp;":"",ariaShortcut:s?e.lang.common.keyboardShortcut+" "+s.aria:"",titleJs:d.gecko&&!d.hc?"":(this.title||"").replace("'",""),hasArrow:"string"==typeof this.hasArrow&&this.hasArrow||(this.hasArrow?"true":"false"),keydownFn:g,focusFn:m,clickFn:r,style:CKEDITOR.skin.getIconStyle(E,"rtl"==e.lang.dir,T,this.iconOffset),arrowHtml:this.hasArrow?n.output():"",hasArrowAriaHtml:this.hasArrow?' aria-expanded="false"':"",toggleAriaHtml:this.isToggle?'aria-pressed="false"':""},i.output(u,t),this.onRender&&this.onRender(),p},setState:function(e){if(this._.state==e)return!1;this._.state=e;var t=CKEDITOR.document.getById(this._.id);return!!t&&(t.setState(e,"cke_button"),t.setAttribute("aria-disabled",e==CKEDITOR.TRISTATE_DISABLED),this.isToggle&&!this.hasArrow&&t.setAttribute("aria-pressed",e===CKEDITOR.TRISTATE_ON),!0)},getState:function(){return this._.state},toFeature:function(e){if(this._.feature)return this._.feature;var t=this;return this.allowedContent||this.requiredContent||!this.command||(t=e.getCommand(this.command)||t),this._.feature=t}},CKEDITOR.ui.prototype.addButton=function(e,t){this.add(e,CKEDITOR.UI_BUTTON,t)}}(),function(){function e(e){function n(t,n){if(n.length){t.items?t.items.push(e.ui.create("-")):t.items=[];for(var a;a=n.shift();)a="string"==typeof a?a:a.name,i&&-1!=CKEDITOR.tools.indexOf(i,a)||(a=e.ui.create(a))&&e.addFeature(a)&&t.items.push(a)}}var i=function(e){return e&&"string"==typeof e?e.split(","):e}(e.config.removeButtons),a=e.config.toolbar;return"string"==typeof a&&(a=e.config["toolbar_"+a]),e.toolbar=a?function(e){var t,i,a,r=[];for(t=0;t<e.length;++t)a={},"/"==(i=e[t])?r.push(i):CKEDITOR.tools.isArray(i)?(n(a,CKEDITOR.tools.clone(i)),r.push(a)):i.items&&(n(a,CKEDITOR.tools.clone(i.items)),a.name=i.name,r.push(a));return r}(a):function(){for(var i=function(){var t,n,i,a={};for(t in e.ui.items)n=(i=(i=(n=e.ui.items[t]).toolbar||"others").split(","))[0],i=parseInt(i[1]||-1,10),a[n]||(a[n]=[]),a[n].push({name:t,order:i});for(n in a)a[n]=a[n].sort((function(e,t){return e.order==t.order?0:0>t.order?-1:0>e.order?1:e.order<t.order?-1:1}));return a}(),a=CKEDITOR.tools.clone(e.config.toolbarGroups)||t(e),r=0;r<a.length;r++){var o=a[r];if("/"!=o){"string"==typeof o&&(o=a[r]={name:o});var s,l=o.groups;if(l)for(var d=0;d<l.length;d++)(s=i[s=l[d]])&&n(o,s);(s=i[o.name])&&n(o,s)}}return a}()}function t(e){return e._.toolbarGroups||(e._.toolbarGroups=[{name:"document",groups:["mode","document","doctools"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"forms"},"/",{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"links"},{name:"insert"},"/",{name:"styles"},{name:"colors"},{name:"tools"},{name:"others"},{name:"about"}])}var n=function(){this.toolbars=[]};n.prototype.focus=function(){for(var e,t=0;e=this.toolbars[t++];)for(var n,i=0;n=e.items[i++];)if(n.focus)return void n.focus()};var i={modes:{wysiwyg:1,source:1},readOnly:1,exec:function(e){e.toolbox&&(CKEDITOR.env.ie||CKEDITOR.env.air?setTimeout((function(){e.toolbox.focus()}),100):e.toolbox.focus())}};CKEDITOR.plugins.add("toolbar",{requires:"button",init:function(t){var a,r=function(e,n){var i,o=(s="rtl"==t.lang.dir)?37:39,s=s?39:37,l=void 0===(l=t.config.toolbarGroupCycling)||l;switch(n){case 9:case CKEDITOR.SHIFT+9:for(;!i||!i.items.length;)if((i=9==n?(i?i.next:e.toolbar.next)||t.toolbox.toolbars[0]:(i?i.previous:e.toolbar.previous)||t.toolbox.toolbars[t.toolbox.toolbars.length-1]).items.length)for(e=i.items[a?i.items.length-1:0];e&&!e.focus;)(e=a?e.previous:e.next)||(i=0);return e&&e.focus(),!1;case o:i=e;do{!(i=i.next)&&l&&(i=e.toolbar.items[0])}while(i&&!i.focus);return i?i.focus():r(e,9),!1;case 40:return e.button&&e.button.hasArrow?e.execute():r(e,40==n?o:s),!1;case s:case 38:i=e;do{!(i=i.previous)&&l&&(i=e.toolbar.items[e.toolbar.items.length-1])}while(i&&!i.focus);return i?i.focus():(a=1,r(e,CKEDITOR.SHIFT+9),a=0),!1;case 27:return t.focus(),!1;case 13:case 32:return e.execute(),!1;case CKEDITOR.ALT+122:return t.execCommand("elementsPathFocus"),!1}return!0};t.on("uiSpace",(function(i){if(i.data.space==t.config.toolbarLocation){i.removeListener(),t.toolbox=new n;var a,o,s=['<span id="',l=CKEDITOR.tools.getNextId(),'" class="cke_voice_label">',t.lang.toolbar.toolbars,"</span>",'<span id="'+t.ui.spaceId("toolbox")+'" class="cke_toolbox" role="group" aria-labelledby="',l,'" onmousedown="return false;">'],l=!1!==t.config.toolbarStartupExpanded;t.config.toolbarCanCollapse&&t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE&&s.push('<span class="cke_toolbox_main"'+(l?">":' style="display:none">'));for(var d=t.toolbox.toolbars,c=e(t),u=c.length,f=0;f<u;f++){var h,p,g,m=0,v=c[f],E="/"!==v&&("/"===c[f+1]||f==u-1);if(v)if(a&&(s.push("</span>"),o=a=0),"/"===v)s.push('<span class="cke_toolbar_break"></span>');else{g=v.items||v;for(var T=0;T<g.length;T++){var C,I=g[T];if(I){var b=function(e){e=e.render(t,s),0<(y=m.items.push(e)-1)&&(e.previous=m.items[y-1],e.previous.next=e),e.toolbar=m,e.onkey=r};if(I.type==CKEDITOR.UI_SEPARATOR)o=a&&I;else{if(C=!1!==I.canGroup,!m){h=CKEDITOR.tools.getNextId(),m={id:h,items:[]},p=v.name&&(t.lang.toolbar.toolbarGroups[v.name]||v.name),s.push('<span id="',h,'" class="cke_toolbar'+(E?' cke_toolbar_last"':'"'),p?' aria-labelledby="'+h+'_label"':"",' role="toolbar">'),p&&s.push('<span id="',h,'_label" class="cke_voice_label">',p,"</span>"),s.push('<span class="cke_toolbar_start"></span>');var y=d.push(m)-1;0<y&&(m.previous=d[y-1],m.previous.next=m)}C?a||(s.push('<span class="cke_toolgroup" role="presentation">'),a=1):a&&(s.push("</span>"),a=0),o&&(b(o),o=0),b(I)}}}a&&(s.push("</span>"),o=a=0),m&&s.push('<span class="cke_toolbar_end"></span></span>')}}if(t.config.toolbarCanCollapse&&s.push("</span>"),t.config.toolbarCanCollapse&&t.elementMode!=CKEDITOR.ELEMENT_MODE_INLINE){var D=CKEDITOR.tools.addFunction((function(){t.execCommand("toolbarCollapse")}));t.on("destroy",(function(){CKEDITOR.tools.removeFunction(D)})),t.addCommand("toolbarCollapse",{readOnly:1,exec:function(e){var t=e.ui.space("toolbar_collapser"),n=t.getPrevious(),i=e.ui.space("contents"),a=n.getParent(),r=parseInt(i.$.style.height,10),o=a.$.offsetHeight,s=t.hasClass("cke_toolbox_collapser_min");s?(n.show(),t.removeClass("cke_toolbox_collapser_min"),t.setAttribute("title",e.lang.toolbar.toolbarCollapse)):(n.hide(),t.addClass("cke_toolbox_collapser_min"),t.setAttribute("title",e.lang.toolbar.toolbarExpand)),t.getFirst().setText(s?"▲":"◀"),i.setStyle("height",r-(a.$.offsetHeight-o)+"px"),e.fire("resize",{outerHeight:e.container.$.offsetHeight,contentsHeight:i.$.offsetHeight,outerWidth:e.container.$.offsetWidth})},modes:{wysiwyg:1,source:1}}),t.setKeystroke(CKEDITOR.ALT+(CKEDITOR.env.ie||CKEDITOR.env.webkit?189:109),"toolbarCollapse"),s.push('<a title="'+(l?t.lang.toolbar.toolbarCollapse:t.lang.toolbar.toolbarExpand)+'" id="'+t.ui.spaceId("toolbar_collapser")+'" tabIndex="-1" class="cke_toolbox_collapser'),l||s.push(" cke_toolbox_collapser_min"),s.push('" onclick="CKEDITOR.tools.callFunction('+D+')">','<span class="cke_arrow">&#9650;</span>',"</a>")}s.push("</span>"),i.data.html+=s.join("")}})),t.on("destroy",(function(){if(this.toolbox){var e,t,n,i,a=0;for(e=this.toolbox.toolbars;a<e.length;a++)for(n=e[a].items,t=0;t<n.length;t++)(i=n[t]).clickFn&&CKEDITOR.tools.removeFunction(i.clickFn),i.keyDownFn&&CKEDITOR.tools.removeFunction(i.keyDownFn)}})),t.on("uiReady",(function(){var e=t.ui.space("toolbox");e&&t.focusManager.add(e,1)})),t.addCommand("toolbarFocus",i),t.setKeystroke(CKEDITOR.ALT+121,"toolbarFocus"),t.ui.add("-",CKEDITOR.UI_SEPARATOR,{}),t.ui.addHandler(CKEDITOR.UI_SEPARATOR,{create:function(){return{render:function(e,t){return t.push('<span class="cke_toolbar_separator" role="separator"></span>'),{}}}}})}}),CKEDITOR.ui.prototype.addToolbarGroup=function(e,n,i){var a=t(this.editor),r=0===n,o={name:e};if(i){if(i=CKEDITOR.tools.search(a,(function(e){return e.name==i})))return!i.groups&&(i.groups=[]),n&&0<=(n=CKEDITOR.tools.indexOf(i.groups,n))?void i.groups.splice(n+1,0,e):void(r?i.groups.splice(0,0,e):i.groups.push(e));n=null}n&&(n=CKEDITOR.tools.indexOf(a,(function(e){return e.name==n}))),r?a.splice(0,0,e):"number"==typeof n?a.splice(n+1,0,o):a.push(e)}}(),CKEDITOR.UI_SEPARATOR="separator",CKEDITOR.config.toolbarLocation="top",function(){function e(e,t,n){return t.type||(t.type="auto"),!(n&&!1===e.fire("beforePaste",t)||!t.dataValue&&t.dataTransfer.isEmpty())&&(t.dataValue||(t.dataValue=""),CKEDITOR.env.gecko&&"drop"==t.method&&e.toolbox&&e.once("afterPaste",(function(){e.toolbox.focus(),e.focus()})),e.fire("paste",t))}function t(t){function n(){var e,n=t.editable();if(CKEDITOR.plugins.clipboard.isCustomCopyCutSupported){var i=function(e){t.getSelection().isCollapsed()||(t.readOnly&&"cut"==e.name||p.initPasteDataTransfer(e,t),e.data.preventDefault())};n.on("copy",i),n.on("cut",i),n.on("cut",(function(){t.readOnly||t.extractSelectedHtml()}),null,null,999)}n.on(p.mainPasteEvent,(function(e){"beforepaste"==p.mainPasteEvent&&g||u(e)})),"beforepaste"==p.mainPasteEvent&&(n.on("paste",(function(e){m||(r(),e.data.preventDefault(),u(e),s("paste"))})),n.on("contextmenu",o,null,null,0),n.on("beforepaste",(function(e){!e.data||e.data.$.ctrlKey||e.data.$.shiftKey||o()}),null,null,0)),n.on("beforecut",(function(){!g&&l()})),n.attachListener(CKEDITOR.env.ie?n:t.document.getDocumentElement(),"mouseup",(function(){e=setTimeout(f,0)})),t.on("destroy",(function(){clearTimeout(e)})),n.on("keyup",f)}function i(e){return{type:e,canUndo:"cut"==e,startDisabled:!0,fakeKeystroke:"cut"==e?CKEDITOR.CTRL+88:CKEDITOR.CTRL+67,exec:function(){var e;"cut"==this.type&&l();var n=this.type;if(CKEDITOR.env.ie)e=s(n);else try{e=t.document.$.execCommand(n,!1,null)}catch(t){e=!1}return e||t.showNotification(t.lang.clipboard[this.type+"Error"]),e}}}function a(){return{canUndo:!1,async:!0,fakeKeystroke:CKEDITOR.CTRL+86,exec:function(t,n){function i(n,i){i=void 0===i||i,n?(n.method="paste",n.dataTransfer||(n.dataTransfer=p.initPasteDataTransfer()),e(t,n,i)):r&&!t._.forcePasteDialog&&t.showNotification(l,"info",t.config.clipboard_notificationDuration),t._.forcePasteDialog=!1,t.fire("afterCommandExec",{name:"paste",command:a,returnValue:!!n})}var a=this,r=void 0===(n=null!=n?n:{}).notification||n.notification,o=n.type,s=CKEDITOR.tools.keystrokeToString(t.lang.common.keyboard,t.getCommandKeystroke(this)),l="string"==typeof r?r:t.lang.clipboard.pasteNotification.replace(/%1/,'<kbd aria-label="'+s.aria+'">'+s.display+"</kbd>");s="string"==typeof n?n:n.dataValue,o&&!0!==t.config.forcePasteAsPlainText&&"allow-word"!==t.config.forcePasteAsPlainText?t._.nextPasteType=o:delete t._.nextPasteType,"string"==typeof s?i({dataValue:s}):t.getClipboardData(i)}}}function r(){m=1,setTimeout((function(){m=0}),100)}function o(){g=1,setTimeout((function(){g=0}),10)}function s(e){var n=t.document,i=n.getBody(),a=!1,r=function(){a=!0};return i.on(e,r),7<CKEDITOR.env.version?n.$.execCommand(e):n.$.selection.createRange().execCommand(e),i.removeListener(e,r),a}function l(){if(CKEDITOR.env.ie&&!CKEDITOR.env.quirks){var e,n,i,a=t.getSelection();a.getType()==CKEDITOR.SELECTION_ELEMENT&&(e=a.getSelectedElement())&&(n=a.getRanges()[0],(i=t.document.createText("")).insertBefore(e),n.setStartBefore(i),n.setEndAfter(e),a.selectRanges([n]),setTimeout((function(){e.getParent()&&(i.remove(),a.selectElement(e))}),0))}}function d(){if("paste"==p.mainPasteEvent)return t.fire("beforePaste",{type:"auto",method:"paste"}),!1;t.focus(),r();var e=t.focusManager;return e.lock(),t.editable().fire(p.mainPasteEvent)&&!s("paste")?(e.unlock(),!1):(e.unlock(),!0)}function c(e){if("wysiwyg"==t.mode)switch(e.data.keyCode){case CKEDITOR.CTRL+86:case CKEDITOR.SHIFT+45:e=t.editable(),r(),"paste"==p.mainPasteEvent&&e.fire("beforepaste");break;case CKEDITOR.CTRL+88:case CKEDITOR.SHIFT+46:t.fire("saveSnapshot"),setTimeout((function(){t.fire("saveSnapshot")}),50)}}function u(n){var i={type:"auto",method:"paste",dataTransfer:p.initPasteDataTransfer(n)};i.dataTransfer.cacheData();var a=!1!==t.fire("beforePaste",i);a&&p.canClipboardApiBeTrusted(i.dataTransfer,t)?(n.data.preventDefault(),setTimeout((function(){e(t,i)}),0)):function(e,n){var i,a=t.document,r=t.editable(),o=function(e){e.cancel()};if(!a.getById("cke_pastebin")){var s=t.getSelection(),l=s.createBookmarks();CKEDITOR.env.ie&&s.root.fire("selectionchange");var d=new CKEDITOR.dom.element(!CKEDITOR.env.webkit&&!r.is("body")||CKEDITOR.env.ie?"div":"body",a);d.setAttributes({id:"cke_pastebin","data-cke-temp":"1"});var c=0;a=a.getWindow(),CKEDITOR.env.webkit?(r.append(d),d.addClass("cke_editable"),r.is("body")||(c=(c="static"!=r.getComputedStyle("position")?r:CKEDITOR.dom.element.get(r.$.offsetParent)).getDocumentPosition().y)):r.getAscendant(CKEDITOR.env.ie?"body":"html",1).append(d),d.setStyles({position:"absolute",top:a.getScrollPosition().y-c+10+"px",width:"1px",height:Math.max(1,a.getViewPaneSize().height-20)+"px",overflow:"hidden",margin:0,padding:0}),CKEDITOR.env.safari&&d.setStyles(CKEDITOR.tools.cssVendorPrefix("user-select","text")),(c=d.getParent().isReadOnly())?(d.setOpacity(0),d.setAttribute("contenteditable",!0)):d.setStyle("ltr"==t.config.contentsLangDirection?"left":"right","-10000px"),t.on("selectionChange",o,null,null,0),(CKEDITOR.env.webkit||CKEDITOR.env.gecko)&&(i=r.once("blur",o,null,null,-100)),c&&d.focus(),(c=new CKEDITOR.dom.range(d)).selectNodeContents(d);var u=c.select();CKEDITOR.env.ie&&(i=r.once("blur",(function(){t.lockSelection(u)})));var f=CKEDITOR.document.getWindow().getScrollPosition().y;setTimeout((function(){var e;CKEDITOR.env.webkit&&(CKEDITOR.document.getBody().$.scrollTop=f),i&&i.removeListener(),CKEDITOR.env.ie&&r.focus(),s.selectBookmarks(l),d.remove(),CKEDITOR.env.webkit&&(e=d.getFirst())&&e.is&&e.hasClass("Apple-style-span")&&(d=e),t.removeListener("selectionChange",o),n(d.getHtml())}),0)}}(0,(function(n){i.dataValue=n.replace(/<span[^>]+data-cke-bookmark[^<]*?<\/span>/gi,""),a&&e(t,i)}))}function f(){if("wysiwyg"==t.mode){var e=h("paste");t.getCommand("cut").setState(h("cut")),t.getCommand("copy").setState(h("copy")),t.getCommand("paste").setState(e),t.fire("pasteState",e)}}function h(e){var n=(n=t.getSelection())&&n.getRanges()[0];return(t.readOnly||n&&n.checkReadOnly())&&e in{paste:1,cut:1}?CKEDITOR.TRISTATE_DISABLED:"paste"==e?CKEDITOR.TRISTATE_OFF:(n=(e=t.getSelection()).getRanges(),e.getType()==CKEDITOR.SELECTION_NONE||1==n.length&&n[0].collapsed?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF)}var p=CKEDITOR.plugins.clipboard,g=0,m=0;!function(){if(t.on("key",c),t.on("contentDom",n),t.on("selectionChange",f),t.contextMenu){t.contextMenu.addListener((function(){return{cut:h("cut"),copy:h("copy"),paste:h("paste")}}));var e=null;t.on("menuShow",(function(){e&&(e.removeListener(),e=null);var n=t.contextMenu.findItemByCommandName("paste");n&&n.element&&(e=n.element.on("touchend",(function(){t._.forcePasteDialog=!0})))}))}t.ui.addButton&&t.once("instanceReady",(function(){t._.pasteButtons&&CKEDITOR.tools.array.forEach(t._.pasteButtons,(function(e){(e=t.ui.get(e))&&(e=CKEDITOR.document.getById(e._.id))&&e.on("touchend",(function(){t._.forcePasteDialog=!0}))}))}))}(),function(){function e(e,n,i,a,r){var o=t.lang.clipboard[n];t.addCommand(n,i),t.ui.addButton&&t.ui.addButton(e,{label:o,command:n,toolbar:"clipboard,"+a}),t.addMenuItems&&t.addMenuItem(n,{label:o,command:n,group:"clipboard",order:r})}e("Cut","cut",i("cut"),10,1),e("Copy","copy",i("copy"),20,4),e("Paste","paste",a(),30,8),t._.pasteButtons||(t._.pasteButtons=[]),t._.pasteButtons.push("Paste")}(),t.getClipboardData=function(e,n){function i(e){e.removeListener(),e.cancel(),n(e.data)}function a(e){e.removeListener(),e.cancel(),n({type:o,dataValue:e.data.dataValue,dataTransfer:e.data.dataTransfer,method:"paste"})}var r=!1,o="auto";n||(n=e,e=null),t.on("beforePaste",(function(e){e.removeListener(),r=!0,o=e.data.type}),null,null,1e3),t.on("paste",i,null,null,0),!1===d()&&(t.removeListener("paste",i),t._.forcePasteDialog&&r&&t.fire("pasteDialog")?(t.on("pasteDialogCommit",a),t.on("dialogHide",(function(e){e.removeListener(),e.data.removeListener("pasteDialogCommit",a),e.data._.committed||n(null)}))):n(null))}}function n(e,t,n){t=CKEDITOR.htmlParser.fragment.fromHtml(t);var i=new CKEDITOR.htmlParser.basicWriter;return n.applyTo(t,!0,!1,e.activeEnterMode),t.writeHtml(i),i.getHtml()}function i(e){e.data.preventDefault(),e.data.$.dataTransfer.dropEffect="none"}function a(t){var n=CKEDITOR.plugins.clipboard;t.on("contentDom",(function(){function i(n,i,a){i.select(),e(t,{dataTransfer:a,method:"drop"},1),a.sourceEditor.fire("saveSnapshot"),a.sourceEditor.editable().extractHtmlFromRange(n),a.sourceEditor.getSelection().selectRanges([n]),a.sourceEditor.fire("saveSnapshot")}function a(i,a){i.select(),e(t,{dataTransfer:a,method:"drop"},1),n.resetDragDataTransfer()}function r(e,n,i){var a={$:e.data.$,target:e.data.getTarget()};n&&(a.dragRange=n),i&&(a.dropRange=i),!1===t.fire(e.name,a)&&e.data.preventDefault()}function o(e){return e.type!=CKEDITOR.NODE_ELEMENT&&(e=e.getParent()),e.getChildCount()}var s=t.editable(),l=CKEDITOR.plugins.clipboard.getDropTarget(t),d=t.ui.space("top"),c=t.ui.space("bottom");n.preventDefaultDropOnElement(d),n.preventDefaultDropOnElement(c),s.attachListener(l,"dragstart",r),s.attachListener(t,"dragstart",n.resetDragDataTransfer,n,null,1),s.attachListener(t,"dragstart",(function(e){n.initDragDataTransfer(e,t)}),null,null,2),s.attachListener(t,"dragstart",(function(){var e=n.dragRange=t.getSelection().getRanges()[0];CKEDITOR.env.ie&&10>CKEDITOR.env.version&&(n.dragStartContainerChildCount=e?o(e.startContainer):null,n.dragEndContainerChildCount=e?o(e.endContainer):null)}),null,null,100),s.attachListener(l,"dragend",r),s.attachListener(t,"dragend",n.initDragDataTransfer,n,null,1),s.attachListener(t,"dragend",n.resetDragDataTransfer,n,null,100),s.attachListener(l,"dragover",(function(e){if(CKEDITOR.env.edge)e.data.preventDefault();else{var t=e.data.getTarget();(t&&t.is&&t.is("html")||CKEDITOR.env.ie&&CKEDITOR.plugins.clipboard.isFileApiSupported&&e.data.$.dataTransfer.types.contains("Files"))&&e.data.preventDefault()}})),s.attachListener(l,"drop",(function(e){if(!e.data.$.defaultPrevented&&(e.data.preventDefault(),!t.readOnly)&&(!(i=e.data.getTarget()).isReadOnly()||i.type==CKEDITOR.NODE_ELEMENT&&i.is("html"))){var i=n.getRangeAtDropPosition(e,t),a=n.dragRange;i&&r(e,a,i)}}),null,null,9999),s.attachListener(t,"drop",n.initDragDataTransfer,n,null,1),s.attachListener(t,"drop",(function(e){if(e=e.data){var r=e.dropRange,o=e.dragRange,s=e.dataTransfer;s.getTransferType(t)==CKEDITOR.DATA_TRANSFER_INTERNAL?setTimeout((function(){n.internalDrop(o,r,s,t)}),0):s.getTransferType(t)==CKEDITOR.DATA_TRANSFER_CROSS_EDITORS?i(o,r,s):a(r,s)}}),null,null,9999)}))}var r;CKEDITOR.plugins.add("clipboard",{requires:"dialog,notification,toolbar",_supportedFileMatchers:[],init:function(e){function i(t){return!!e.config.clipboard_handleImages&&-1!==CKEDITOR.tools.indexOf(["image/png","image/jpeg","image/gif"],t.type)}function r(t){return CKEDITOR.tools.array.some(e.plugins.clipboard._supportedFileMatchers,(function(e){return e(t)}))}function o(t){t.length&&(t=CKEDITOR.tools.array.unique(t),t=CKEDITOR.tools.array.filter(t,(function(e){return!!CKEDITOR.tools.trim(e)})),t=function(t){return t?e.lang.clipboard.fileFormatNotSupportedNotification.replace(/\${formats\}/g,"<em>"+t+"</em>"):e.lang.clipboard.fileWithoutFormatNotSupportedNotification}(t.join(", ")),e.showNotification(t,"info",e.config.clipboard_notificationDuration))}var s,l=function(e){function t(){var e,t={};for(e in CKEDITOR.dtd)"$"!=e.charAt(0)&&"div"!=e&&"span"!=e&&(t[e]=1);return t}var n={};return{get:function(i){return"plain-text"==i?n.plainText||(n.plainText=new CKEDITOR.filter(e,"br")):"semantic-content"==i?((i=n.semanticContent)||((i=new CKEDITOR.filter(e,{})).allow({$1:{elements:t(),attributes:!0,styles:!1,classes:!1}}),i=n.semanticContent=i),i):i?new CKEDITOR.filter(e,i):null}}}(e);e.config.forcePasteAsPlainText?s="plain-text":e.config.pasteFilter?s=e.config.pasteFilter:!CKEDITOR.env.webkit||"pasteFilter"in e.config||(s="semantic-content"),e.pasteFilter=l.get(s),t(e),a(e),CKEDITOR.dialog.add("paste",CKEDITOR.getUrl(this.path+"dialogs/paste.js"));var d,c=CKEDITOR.plugins.clipboard.isCustomDataTypesSupported||CKEDITOR.plugins.clipboard.isFileApiSupported;CKEDITOR.plugins.clipboard.addFileMatcher(e,i),e.on("paste",(function(e){if(c&&(e=(t=e.data).dataTransfer,!t.dataValue)){for(var t=[],n=0;n<e.getFilesCount();n++){var i=e.getFile(n);r(i)||t.push(i.type)}o(t)}}),null,null,1),e.on("paste",(function(t){if(c&&e.config.clipboard_handleImages){var n=t.data,a=n.dataTransfer;if(!n.dataValue&&function(e,t){return!(CKEDITOR.env.ie&&e.data.fileTransferCancel||!(CKEDITOR.env.ie||t&&d!==t.id))&&t.isFileTransfer()&&1===t.getFilesCount()}(t,a)&&i(a=a.getFile(0))){var r=new FileReader;r.addEventListener("load",(function(){t.data.dataValue='<img src="'+r.result+'" />',e.fire("paste",t.data)}),!1),r.addEventListener("abort",(function(){CKEDITOR.env.ie&&(t.data.fileTransferCancel=!0),e.fire("paste",t.data)}),!1),r.addEventListener("error",(function(){CKEDITOR.env.ie&&(t.data.fileTransferCancel=!0),e.fire("paste",t.data)}),!1),r.readAsDataURL(a),d=n.dataTransfer.id,t.stop()}}}),null,null,1),e.on("paste",(function(t){if(t.data.dataTransfer||(t.data.dataTransfer=new CKEDITOR.plugins.clipboard.dataTransfer),!t.data.dataValue){var n=t.data.dataTransfer,i=n.getData("text/html");i?(t.data.dataValue=i,t.data.type="html"):(i=n.getData("text/plain"))&&(t.data.dataValue=e.editable().transformPlainTextToHtml(i),t.data.type="text")}}),null,null,1),e.on("paste",(function(e){var t=e.data.dataValue,n=CKEDITOR.dtd.$block;if(-1<t.indexOf("Apple-")&&(t=t.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),"html"!=e.data.type&&(t=t.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,(function(e,t){return t.replace(/\t/g,"&nbsp;&nbsp; &nbsp;")}))),-1<t.indexOf('<br class="Apple-interchange-newline">')&&(e.data.startsWithEOL=1,e.data.preSniffing="html",t=t.replace(/<br class="Apple-interchange-newline">/,"")),t=t.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1")),t.match(/^<[^<]+cke_(editable|contents)/i)){var i,a,r=new CKEDITOR.dom.element("div");for(r.setHtml(t);1==r.getChildCount()&&(i=r.getFirst())&&i.type==CKEDITOR.NODE_ELEMENT&&(i.hasClass("cke_editable")||i.hasClass("cke_contents"));)r=a=i;a&&(t=a.getHtml().replace(/<br>$/i,""))}CKEDITOR.env.ie?t=t.replace(/^&nbsp;(?: |\r\n)?<(\w+)/g,(function(t,i){return i.toLowerCase()in n?(e.data.preSniffing="html","<"+i):t})):CKEDITOR.env.webkit?t=t.replace(/<\/(\w+)><div><br><\/div>$/,(function(t,i){return i in n?(e.data.endsWithEOL=1,"</"+i+">"):t})):CKEDITOR.env.gecko&&(t=t.replace(/(\s)<br>$/,"$1")),e.data.dataValue=t}),null,null,3),e.on("paste",(function(t){t=t.data;var i,a=e._.nextPasteType||t.type,r=t.dataValue,o=e.config.clipboard_defaultContentType||"html",s=t.dataTransfer.getTransferType(e)==CKEDITOR.DATA_TRANSFER_EXTERNAL,d=!0===e.config.forcePasteAsPlainText;i="html"==a||"html"==t.preSniffing?"html":function(e){if(CKEDITOR.env.webkit){if(!e.match(/^[^<]*$/g)&&!e.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return"html"}else if(CKEDITOR.env.ie){if(!e.match(/^([^<]|<br( ?\/)?>)*$/gi)&&!e.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return"html"}else{if(!CKEDITOR.env.gecko)return"html";if(!e.match(/^([^<]|<br( ?\/)?>)*$/gi))return"html"}return"htmlifiedtext"}(r),delete e._.nextPasteType,"htmlifiedtext"==i&&(r=function(e,t){function n(e){return CKEDITOR.tools.repeat("</p><p>",~~(e/2))+(1==e%2?"<br>":"")}return t=(t=t.replace(/(?!\u3000)\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>")).replace(/<\/?[A-Z]+>/g,(function(e){return e.toLowerCase()})),t.match(/^[^<]$/)?t:(CKEDITOR.env.webkit&&-1<t.indexOf("<div>")&&((t=t.replace(/^(<div>(<br>|)<\/div>)(?!$|(<div>(<br>|)<\/div>))/g,"<br>").replace(/^(<div>(<br>|)<\/div>){2}(?!$)/g,"<div></div>")).match(/<div>(<br>|)<\/div>/)&&(t="<p>"+t.replace(/(<div>(<br>|)<\/div>)+/g,(function(e){return n(e.split("</div><div>").length+1)}))+"</p>"),t=(t=t.replace(/<\/div><div>/g,"<br>")).replace(/<\/?div>/g,"")),CKEDITOR.env.gecko&&e.enterMode!=CKEDITOR.ENTER_BR&&(CKEDITOR.env.gecko&&(t=t.replace(/^<br><br>$/,"<br>")),-1<t.indexOf("<br><br>")&&(t="<p>"+t.replace(/(<br>){2,}/g,(function(e){return n(e.length/4)}))+"</p>")),function(e,t){return e.enterMode==CKEDITOR.ENTER_BR?t=t.replace(/(<\/p><p>)+/g,(function(e){return CKEDITOR.tools.repeat("<br>",e.length/7*2)})).replace(/<\/?p>/g,""):e.enterMode==CKEDITOR.ENTER_DIV&&(t=t.replace(/<(\/)?p>/g,"<$1div>")),t}(e,t))}(e.config,r)),"text"==a&&"html"==i?r=n(e,r,l.get("plain-text")):(s&&e.pasteFilter&&!t.dontFilter||d)&&(r=n(e,r,e.pasteFilter)),t.startsWithEOL&&(r='<br data-cke-eol="1">'+r),t.endsWithEOL&&(r+='<br data-cke-eol="1">'),"auto"==a&&(a="html"==i||"html"==o?"html":"text"),t.type=a,t.dataValue=r,delete t.preSniffing,delete t.startsWithEOL,delete t.endsWithEOL}),null,null,6),e.on("paste",(function(t){(t=t.data).dataValue&&(e.insertHtml(t.dataValue,t.type,t.range),setTimeout((function(){e.fire("afterPaste")}),0))}),null,null,1e3),e.on("pasteDialog",(function(t){setTimeout((function(){e.openDialog("paste",t.data)}),0)}))}}),CKEDITOR.plugins.clipboard={addFileMatcher:function(e,t){e.plugins.clipboard._supportedFileMatchers.push(t)},isCustomCopyCutSupported:!(CKEDITOR.env.ie&&16>CKEDITOR.env.version||CKEDITOR.env.iOS&&605>CKEDITOR.env.version),isCustomDataTypesSupported:!CKEDITOR.env.ie||16<=CKEDITOR.env.version,isFileApiSupported:!CKEDITOR.env.ie||9<CKEDITOR.env.version,mainPasteEvent:CKEDITOR.env.ie&&!CKEDITOR.env.edge?"beforepaste":"paste",addPasteButton:function(e,t,n){e.ui.addButton&&(e.ui.addButton(t,n),e._.pasteButtons||(e._.pasteButtons=[]),e._.pasteButtons.push(t))},canClipboardApiBeTrusted:function(e,t){return!!(e.getTransferType(t)!=CKEDITOR.DATA_TRANSFER_EXTERNAL||CKEDITOR.env.chrome&&!e.isEmpty()||CKEDITOR.env.gecko&&(e.getData("text/html")||e.getFilesCount())||CKEDITOR.env.safari&&603<=CKEDITOR.env.version&&!CKEDITOR.env.iOS||CKEDITOR.env.iOS&&605<=CKEDITOR.env.version||CKEDITOR.env.edge&&16<=CKEDITOR.env.version)},getDropTarget:function(e){var t=e.editable();return CKEDITOR.env.ie&&9>CKEDITOR.env.version||t.isInline()?t:e.document},fixSplitNodesAfterDrop:function(e,t,n,i){function a(e,n,i){var a=e;if(a.type==CKEDITOR.NODE_TEXT&&(a=e.getParent()),a.equals(n)&&i!=n.getChildCount())return e=t.startContainer.getChild(t.startOffset-1),n=t.startContainer.getChild(t.startOffset),e&&e.type==CKEDITOR.NODE_TEXT&&n&&n.type==CKEDITOR.NODE_TEXT&&(i=e.getLength(),e.setText(e.getText()+n.getText()),n.remove(),t.setStart(e,i),t.collapse(!0)),!0}var r=t.startContainer;"number"==typeof i&&"number"==typeof n&&r.type==CKEDITOR.NODE_ELEMENT&&(a(e.startContainer,r,n)||a(e.endContainer,r,i))},isDropRangeAffectedByDragRange:function(e,t){var n=t.startContainer,i=t.endOffset;return!!(e.endContainer.equals(n)&&e.endOffset<=i||e.startContainer.getParent().equals(n)&&e.startContainer.getIndex()<i||e.endContainer.getParent().equals(n)&&e.endContainer.getIndex()<i)},internalDrop:function(t,n,i,a){var r,o,s=CKEDITOR.plugins.clipboard,l=a.editable();a.fire("saveSnapshot"),a.fire("lockSnapshot",{dontUpdate:1}),CKEDITOR.env.ie&&10>CKEDITOR.env.version&&this.fixSplitNodesAfterDrop(t,n,s.dragStartContainerChildCount,s.dragEndContainerChildCount),(o=this.isDropRangeAffectedByDragRange(t,n))||(r=t.createBookmark(!1)),s=n.clone().createBookmark(!1),o&&(r=t.createBookmark(!1)),t=r.startNode,n=r.endNode,o=s.startNode,n&&t.getPosition(o)&CKEDITOR.POSITION_PRECEDING&&n.getPosition(o)&CKEDITOR.POSITION_FOLLOWING&&o.insertBefore(t),(t=a.createRange()).moveToBookmark(r),l.extractHtmlFromRange(t,1),n=a.createRange(),s.startNode.getCommonAncestor(l)||(s=a.getSelection().createBookmarks()[0]),n.moveToBookmark(s),e(a,{dataTransfer:i,method:"drop",range:n},1),a.fire("unlockSnapshot")},getRangeAtDropPosition:function(e,t){var n=e.data.$,i=n.clientX,a=n.clientY,r=t.getSelection(!0).getRanges()[0],o=t.createRange();if(e.data.testRange)return e.data.testRange;if(document.caretRangeFromPoint&&t.document.$.caretRangeFromPoint(i,a))n=t.document.$.caretRangeFromPoint(i,a),o.setStart(CKEDITOR.dom.node(n.startContainer),n.startOffset),o.collapse(!0);else if(n.rangeParent)o.setStart(CKEDITOR.dom.node(n.rangeParent),n.rangeOffset),o.collapse(!0);else{if(CKEDITOR.env.ie&&8<CKEDITOR.env.version&&r&&t.editable().hasFocus)return r;if(!document.body.createTextRange)return null;t.focus(),n=t.document.getBody().$.createTextRange();try{for(var s=!1,l=0;20>l&&!s;l++){if(!s)try{n.moveToPoint(i,a-l),s=!0}catch(e){}if(!s)try{n.moveToPoint(i,a+l),s=!0}catch(e){}}if(s){var d="cke-temp-"+(new Date).getTime();n.pasteHTML('<span id="'+d+'">​</span>');var c=t.document.getById(d);o.moveToPosition(c,CKEDITOR.POSITION_BEFORE_START),c.remove()}else{var u=t.document.$.elementFromPoint(i,a),f=new CKEDITOR.dom.element(u);if(f.equals(t.editable())||"html"==f.getName())return r&&r.startContainer&&!r.startContainer.equals(t.editable())?r:null;i<f.getClientRect().left?o.setStartAt(f,CKEDITOR.POSITION_AFTER_START):o.setStartAt(f,CKEDITOR.POSITION_BEFORE_END),o.collapse(!0)}}catch(e){return null}}return o},initDragDataTransfer:function(e,t){var n=e.data.$?e.data.$.dataTransfer:null,i=new this.dataTransfer(n,t);"dragstart"===e.name&&i.storeId(),n?this.dragData&&i.id==this.dragData.id?i=this.dragData:this.dragData=i:this.dragData?i=this.dragData:this.dragData=i,e.data.dataTransfer=i},resetDragDataTransfer:function(){this.dragData=null},initPasteDataTransfer:function(e,t){if(this.isCustomCopyCutSupported){if(e&&e.data&&e.data.$){var n=e.data.$.clipboardData,i=new this.dataTransfer(n,t);return"copy"!==e.name&&"cut"!==e.name||i.storeId(),this.copyCutData&&i.id==this.copyCutData.id?(i=this.copyCutData).$=n:this.copyCutData=i,i}return new this.dataTransfer(null,t)}return new this.dataTransfer(CKEDITOR.env.edge&&e&&e.data.$&&e.data.$.clipboardData||null,t)},preventDefaultDropOnElement:function(e){e&&e.on("dragover",i)}},r=CKEDITOR.plugins.clipboard.isCustomDataTypesSupported?"cke/id":"Text",CKEDITOR.plugins.clipboard.dataTransfer=function(e,t){e&&(this.$=e),this._={metaRegExp:/^<meta.*?>/i,fragmentRegExp:/\s*\x3c!--StartFragment--\x3e|\x3c!--EndFragment--\x3e\s*/g,types:[],data:{},files:[],nativeHtmlCache:"",normalizeType:function(e){return"text"==(e=e.toLowerCase())||"text/plain"==e?"Text":"url"==e?"URL":"files"===e?"Files":e}},this._.fallbackDataTransfer=new CKEDITOR.plugins.clipboard.fallbackDataTransfer(this),this.id=this.getData(r),this.id||(this.id="Text"==r?"":"cke-"+CKEDITOR.tools.getUniqueId()),t&&(this.sourceEditor=t,this.setData("text/html",t.getSelectedHtml(1)),"Text"==r||this.getData("text/plain")||this.setData("text/plain",t.getSelection().getSelectedText()))},CKEDITOR.DATA_TRANSFER_INTERNAL=1,CKEDITOR.DATA_TRANSFER_CROSS_EDITORS=2,CKEDITOR.DATA_TRANSFER_EXTERNAL=3,CKEDITOR.plugins.clipboard.dataTransfer.prototype={getData:function(e,t){if(null==(i="text/html"==(e=this._.normalizeType(e))&&t?this._.nativeHtmlCache:this._.data[e])||""===i){if(this._.fallbackDataTransfer.isRequired())i=this._.fallbackDataTransfer.getData(e,t);else try{i=this.$.getData(e)||""}catch(e){i=""}"text/html"!=e||t||(i=this._stripHtml(i))}if("Text"==e&&CKEDITOR.env.gecko&&this.getFilesCount()&&"file://"==i.substring(0,7)&&(i=""),"string"==typeof i)var n=i.indexOf("</html>"),i=-1!==n?i.substring(0,n+7):i;return i},setData:function(e,t){if("text/html"==(e=this._.normalizeType(e))?(this._.data[e]=this._stripHtml(t),this._.nativeHtmlCache=t):this._.data[e]=t,CKEDITOR.plugins.clipboard.isCustomDataTypesSupported||"URL"==e||"Text"==e)if("Text"==r&&"Text"==e&&(this.id=t),this._.fallbackDataTransfer.isRequired())this._.fallbackDataTransfer.setData(e,t);else try{this.$.setData(e,t)}catch(e){}},storeId:function(){"Text"!==r&&this.setData(r,this.id)},getTransferType:function(e){return this.sourceEditor?this.sourceEditor==e?CKEDITOR.DATA_TRANSFER_INTERNAL:CKEDITOR.DATA_TRANSFER_CROSS_EDITORS:CKEDITOR.DATA_TRANSFER_EXTERNAL},cacheData:function(){function e(e){e=a._.normalizeType(e);var t=a.getData(e);"text/html"==e&&(a._.nativeHtmlCache=a.getData(e,!0),t=a._stripHtml(t)),t&&(a._.data[e]=t),a._.types.push(e)}if(this.$){var t,n,i,a=this;if(CKEDITOR.plugins.clipboard.isCustomDataTypesSupported){if(this.$.types)for(t=0;t<this.$.types.length;t++)e(this.$.types[t])}else e("Text"),e("URL");if(n=this._getImageFromClipboard(),(i=this.$&&this.$.files||null)||n){if(this._.files=[],i&&i.length)for(t=0;t<i.length;t++)this._.files.push(i[t]);0===this._.files.length&&n&&this._.files.push(n)}}},getFilesCount:function(){if(this._.files.length)return this._.files.length;var e=this.$&&this.$.files||null;return e&&e.length?e.length:this._getImageFromClipboard()?1:0},getFile:function(e){if(this._.files.length)return this._.files[e];var t=this.$&&this.$.files||null;return t&&t.length?t[e]:0===e?this._getImageFromClipboard():void 0},isFileTransfer:function(){var e=this.getTypes();return 1===(e=CKEDITOR.tools.array.filter(e,(function(e){return"application/x-moz-file"!==e}))).length&&"files"===e[0].toLowerCase()},isEmpty:function(){var e,t={};if(this.getFilesCount())return!1;if(CKEDITOR.tools.array.forEach(CKEDITOR.tools.object.keys(this._.data),(function(e){t[e]=1})),this.$)if(CKEDITOR.plugins.clipboard.isCustomDataTypesSupported){if(this.$.types)for(var n=0;n<this.$.types.length;n++)t[this.$.types[n]]=1}else t.Text=1,t.URL=1;for(e in"Text"!=r&&(t[r]=0),t)if(t[e]&&""!==this.getData(e))return!1;return!0},getTypes:function(){return 0<this._.types.length?this._.types:this.$&&this.$.types?[].slice.call(this.$.types):[]},_getImageFromClipboard:function(){var e;try{if(this.$&&this.$.items&&this.$.items[0]&&(e=this.$.items[0].getAsFile())&&e.type)return e}catch(e){}},_stripHtml:function(e){return e&&e.length&&(e=function(e){var t,n,i=new CKEDITOR.htmlParser;return i.onTagOpen=function(e){"body"===e&&(t=i._.htmlPartsRegex.lastIndex)},i.onTagClose=function(e){"body"===e&&(n=i._.htmlPartsRegex.lastIndex)},i.parse(e),"number"!=typeof t||"number"!=typeof n?e:e.substring(t,n).replace(/<\/body\s*>$/gi,"")}(e),e=(e=e.replace(this._.metaRegExp,"")).replace(this._.fragmentRegExp,"")),e}},CKEDITOR.plugins.clipboard.fallbackDataTransfer=function(e){this._dataTransfer=e,this._customDataFallbackType="text/html"},CKEDITOR.plugins.clipboard.fallbackDataTransfer._isCustomMimeTypeSupported=null,CKEDITOR.plugins.clipboard.fallbackDataTransfer._customTypes=[],CKEDITOR.plugins.clipboard.fallbackDataTransfer.prototype={isRequired:function(){var e=CKEDITOR.plugins.clipboard.fallbackDataTransfer,t=this._dataTransfer.$;if(null===e._isCustomMimeTypeSupported){if(!t)return!1;if(e._isCustomMimeTypeSupported=!1,CKEDITOR.env.edge&&17<=CKEDITOR.env.version)return!0;try{t.setData("cke/mimetypetest","cke test value"),e._isCustomMimeTypeSupported="cke test value"===t.getData("cke/mimetypetest"),t.clearData("cke/mimetypetest")}catch(e){}}return!e._isCustomMimeTypeSupported},getData:function(e,t){var n=this._getData(this._customDataFallbackType,!0);if(t)return n;n=this._extractDataComment(n);var i;return null!==(i=e===this._customDataFallbackType?n.content:n.data&&n.data[e]?n.data[e]:this._getData(e,!0))?i:""},setData:function(e,t){(a=e===this._customDataFallbackType)&&(t=this._applyDataComment(t,this._getFallbackTypeData()));var n=t,i=this._dataTransfer.$;try{i.setData(e,n),a&&(this._dataTransfer._.nativeHtmlCache=n)}catch(t){if(this._isUnsupportedMimeTypeError(t)){a=CKEDITOR.plugins.clipboard.fallbackDataTransfer,-1===CKEDITOR.tools.indexOf(a._customTypes,e)&&a._customTypes.push(e);var a=this._getFallbackTypeContent(),r=this._getFallbackTypeData();r[e]=n;try{n=this._applyDataComment(a,r),i.setData(this._customDataFallbackType,n),this._dataTransfer._.nativeHtmlCache=n}catch(e){n=""}}}return n},_getData:function(e,t){var n=this._dataTransfer._.data;if(!t&&n[e])return n[e];try{return this._dataTransfer.$.getData(e)}catch(e){return null}},_getFallbackTypeContent:function(){var e=this._dataTransfer._.data[this._customDataFallbackType];return e||(e=this._extractDataComment(this._getData(this._customDataFallbackType,!0)).content),e},_getFallbackTypeData:function(){var e=CKEDITOR.plugins.clipboard.fallbackDataTransfer._customTypes,t=this._extractDataComment(this._getData(this._customDataFallbackType,!0)).data||{},n=this._dataTransfer._.data;return CKEDITOR.tools.array.forEach(e,(function(e){void 0!==n[e]?t[e]=n[e]:void 0!==t[e]&&(t[e]=t[e])}),this),t},_isUnsupportedMimeTypeError:function(e){return e.message&&-1!==e.message.search(/element not found/gi)},_extractDataComment:function(e){var t,n={data:null,content:e||""};return e&&16<e.length&&(t=/\x3c!--cke-data:(.*?)--\x3e/g.exec(e))&&t[1]&&(n.data=JSON.parse(decodeURIComponent(t[1])),n.content=e.replace(t[0],"")),n},_applyDataComment:function(e,t){var n="";return t&&CKEDITOR.tools.object.keys(t).length&&(n="\x3c!--cke-data:"+encodeURIComponent(JSON.stringify(t))+"--\x3e"),n+(e&&e.length?e:"")}}}(),CKEDITOR.config.clipboard_notificationDuration=1e4,CKEDITOR.config.clipboard_handleImages=!0,function(){function e(e){return!(e&&(20<e.length||(e=e.replace(/[\n|\t]*/g,"").toLowerCase())&&"<br>"!=e&&"<p>&nbsp;<br></p>"!=e&&"<p><br></p>"!=e&&"<div><br></div>"!=e&&"<p>&nbsp;</p>"!=e&&"&nbsp;"!=e&&" "!=e&&"&nbsp;<br>"!=e&&" <br>"!=e))}function t(t){var n=t.editor;if(!n.readOnly){var i=n.editable(),a=t.listenerData;if(i){if("wysiwyg"==n.mode){if(CKEDITOR.dialog._.currentTop||!i)return;e(i.getHtml())&&(i.setHtml(a),i.addClass("placeholder"))}"source"==n.mode&&(r?"mode"==t.name&&i.setAttribute("placeholder",a):e(i.getValue())&&(i.setValue(a),i.addClass("placeholder")))}}}function n(e){var t=(e=e.editor).editable();if(t){if("wysiwyg"==e.mode){if(!t.hasClass("placeholder"))return;if(t.removeClass("placeholder"),CKEDITOR.dtd[t.getName()].p){var n="";e.enterMode===CKEDITOR.ENTER_P?n="<p><br/></p>":e.enterMode===CKEDITOR.ENTER_DIV?n="<div><br/></div>":(n="<br/>",(CKEDITOR.env.gecko||CKEDITOR.env.ie)&&(n=" ")),t.setHtml(n),(n=new CKEDITOR.dom.range(e.document)).moveToElementEditablePosition(t.getFirst(),!0),e.getSelection().selectRanges([n])}else t.setHtml(" ")}"source"==e.mode&&t.hasClass("placeholder")&&(t.removeClass("placeholder"),t.setValue(""))}}function i(e){e.editor.readOnly?n(e):t(e)}function a(e){return e?e.getAttribute("lang")||a(e.getParent()):null}var r="placeholder"in document.createElement("textarea");CKEDITOR.plugins.add("confighelper",{getPlaceholderCss:function(){return".placeholder{ color: #999; }"},onLoad:function(){CKEDITOR.addCss(this.getPlaceholderCss())},init:function(o){function s(e){if(o==e.editor){var t,n,i,a,r,s=e.data.name;if(e=e.data.definition,"tableProperties"==s&&(s="table"),"removeDialogFields"in o._||!o.config.removeDialogFields||(o._.removeDialogFields=c(o.config.removeDialogFields)),o._.removeDialogFields&&(t=o._.removeDialogFields[s]))for(i in t)if(a=t[i],r=e.getContents(i))for(n=0;n<a.length;n++)r.remove(a[n]);if("hideDialogFields"in o._||!o.config.hideDialogFields||(o._.hideDialogFields=c(o.config.hideDialogFields)),o._.hideDialogFields&&(t=o._.hideDialogFields[s]))for(i in t)if(a=t[i],r=e.getContents(i))for(n=0;n<a.length;n++)r.get(a[n]).hidden=!0;if(o.config.dialogFieldsDefaultValues&&(t=o.config.dialogFieldsDefaultValues[s]))for(i in t)if(a=t[i],r=e.getContents(i))for(var l in a)(s=r.get(l))&&(s.default=a[l])}}o.on("mode",(function(e){e.editor.focusManager.hasFocus=!1}));var l=o.element.getAttribute("placeholder")||o.config.placeholder;if(l){var d=CKEDITOR.document.getHead().append("style");d.setAttribute("type","text/css"),CKEDITOR.env.ie&&11>CKEDITOR.env.version?d.$.styleSheet.cssText="textarea.placeholder { color: #999; font-style: italic; }":d.$.innerHTML="textarea.placeholder { color: #999; font-style: italic; }",o.on("getData",(function(e){var t=o.editable();t&&t.hasClass("placeholder")&&(e.data.dataValue="")})),o.on("setData",(function(n){if(!(CKEDITOR.dialog._.currentTop||"source"==o.mode&&r)){var i=o.editable();i&&(e(n.data.dataValue)?t(n):i.hasClass("placeholder")&&i.removeClass("placeholder"))}})),o.on("blur",t,null,l),o.on("mode",t,null,l),o.on("contentDom",t,null,l),o.on("focus",n),o.on("key",n),o.on("beforeModeUnload",n),o.on("readOnly",i,null,l)}if((l=o.config.contentsLanguage||a(o.element))&&o.plugins.scayt&&!o.config.scayt_sLang){try{localStorage&&localStorage.removeItem("scayt_0_lang")}catch(e){}o.config.scayt_sLang={en:"en_US","en-us":"en_US","en-gb":"en_GB","pt-br":"pt_BR",da:"da_DK","da-dk":"da_DK","nl-nl":"nl_NL","en-ca":"en_CA","fi-fi":"fi_FI",fr:"fr_FR","fr-fr":"fr_FR","fr-ca":"fr_CA",de:"de_DE","de-de":"de_DE","el-gr":"el_GR",it:"it_IT","it-it":"it_IT","nb-no":"nb_NO",pt:"pt_PT","pt-pt":"pt_PT",es:"es_ES","es-es":"es_ES","sv-se":"sv_SE"}[l.toLowerCase()]}var c=function(e){if("object"==typeof e)return e;e=e.split(";");var t,n={};for(t=0;t<e.length;t++)if(3==(r=e[t].split(":")).length){var i=r[0],a=r[1],r=r[2];n[i]||(n[i]={}),n[i][a]||(n[i][a]=[]),n[i][a].push(r)}return n};CKEDITOR.on("dialogDefinition",s),o.once("beforeDestroy",(function(){CKEDITOR.removeListener("dialogDefinition",s)}))}})}(),function(){function e(e,t){var n={},i=[],a={nbsp:" ",shy:"­",gt:">",lt:"<",amp:"&",apos:"'",quot:'"'};if(e=e.replace(/\b(nbsp|shy|gt|lt|amp|apos|quot)(?:,|$)/g,(function(e,r){var o=t?"&"+r+";":a[r];return n[o]=t?a[r]:"&"+r+";",i.push(o),""})),e=e.replace(/,$/,""),!t&&e){e=e.split(",");var r,o=document.createElement("div");for(o.innerHTML="&"+e.join(";&")+";",r=o.innerHTML,o=null,o=0;o<r.length;o++){var s=r.charAt(o);n[s]="&"+e[o]+";",i.push(s)}}return n.regex=i.join(t?"|":""),n}CKEDITOR.plugins.add("entities",{afterInit:function(t){function n(e){return l[e]}function i(e){return"force"!=a.entities_processNumerical&&o[e]?o[e]:"&#"+(CKEDITOR.env.ie?e.charCodeAt(0):e.codePointAt(0))+";"}var a=t.config;if(t=(t=t.dataProcessor)&&t.htmlFilter){var r=[];!1!==a.basicEntities&&r.push("nbsp,gt,lt,amp"),a.entities&&(r.length&&r.push("quot,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,times,divide,fnof,bull,hellip,prime,Prime,oline,frasl,weierp,image,real,trade,alefsym,larr,uarr,rarr,darr,harr,crarr,lArr,uArr,rArr,dArr,hArr,forall,part,exist,empty,nabla,isin,notin,ni,prod,sum,minus,lowast,radic,prop,infin,ang,and,or,cap,cup,int,there4,sim,cong,asymp,ne,equiv,le,ge,sub,sup,nsub,sube,supe,oplus,otimes,perp,sdot,lceil,rceil,lfloor,rfloor,lang,rang,loz,spades,clubs,hearts,diams,circ,tilde,ensp,emsp,thinsp,zwnj,zwj,lrm,rlm,ndash,mdash,lsquo,rsquo,sbquo,ldquo,rdquo,bdquo,dagger,Dagger,permil,lsaquo,rsaquo,euro"),a.entities_latin&&r.push("Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml,OElig,oelig,Scaron,scaron,Yuml"),a.entities_greek&&r.push("Alpha,Beta,Gamma,Delta,Epsilon,Zeta,Eta,Theta,Iota,Kappa,Lambda,Mu,Nu,Xi,Omicron,Pi,Rho,Sigma,Tau,Upsilon,Phi,Chi,Psi,Omega,alpha,beta,gamma,delta,epsilon,zeta,eta,theta,iota,kappa,lambda,mu,nu,xi,omicron,pi,rho,sigmaf,sigma,tau,upsilon,phi,chi,psi,omega,thetasym,upsih,piv"),a.entities_additional&&r.push(a.entities_additional));var o=e(r.join(",")),s=o.regex?"["+o.regex+"]":"a^";delete o.regex,a.entities&&a.entities_processNumerical&&(s="[^ -~]|"+s),s=new RegExp(s,CKEDITOR.env.ie?"g":"gu");var l=e("nbsp,gt,lt,amp,shy",!0),d=new RegExp(l.regex,"g");t.addRules({text:function(e){return e.replace(d,n).replace(s,i)}},{applyToAll:!0,excludeNestedEditable:!0})}}})}(),CKEDITOR.config.basicEntities=!0,CKEDITOR.config.entities=!0,CKEDITOR.config.entities_latin=!0,CKEDITOR.config.entities_greek=!0,CKEDITOR.config.entities_additional="#39",function(){var e=[CKEDITOR.CTRL+90,CKEDITOR.CTRL+89,CKEDITOR.CTRL+CKEDITOR.SHIFT+90],t={8:1,46:1};CKEDITOR.plugins.add("undo",{init:function(t){function i(e){o.enabled&&!1!==e.data.command.canUndo&&o.save()}function a(){o.enabled=!t.readOnly&&"wysiwyg"==t.mode,o.onChange()}var o=t.undoManager=new n(t),s=o.editingHandler=new r(o),l=t.addCommand("undo",{exec:function(){o.undo()&&(t.selectionChange(),this.fire("afterUndo"))},startDisabled:!0,canUndo:!1}),d=t.addCommand("redo",{exec:function(){o.redo()&&(t.selectionChange(),this.fire("afterRedo"))},startDisabled:!0,canUndo:!1});t.setKeystroke([[e[0],"undo"],[e[1],"redo"],[e[2],"redo"]]),o.onChange=function(){l.setState(o.undoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),d.setState(o.redoable()?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)},t.on("beforeCommandExec",i),t.on("afterCommandExec",i),t.on("saveSnapshot",(function(e){o.save(e.data&&e.data.contentOnly)})),t.on("contentDom",s.attachListeners,s),t.on("instanceReady",(function(){t.fire("saveSnapshot")})),t.on("beforeModeUnload",(function(){"wysiwyg"==t.mode&&o.save(!0)})),t.on("mode",a),t.on("readOnly",a),t.ui.addButton&&(t.ui.addButton("Undo",{label:t.lang.undo.undo,command:"undo",toolbar:"undo,10"}),t.ui.addButton("Redo",{label:t.lang.undo.redo,command:"redo",toolbar:"undo,20"})),t.resetUndo=function(){o.reset(),t.fire("saveSnapshot")},t.on("updateSnapshot",(function(){o.currentImage&&o.update()})),t.on("lockSnapshot",(function(e){e=e.data,o.lock(e&&e.dontUpdate,e&&e.forceUpdate)})),t.on("unlockSnapshot",o.unlock,o)}}),CKEDITOR.plugins.undo={};var n=CKEDITOR.plugins.undo.UndoManager=function(e){this.strokesRecorded=[0,0],this.locked=null,this.previousKeyGroup=-1,this.limit=e.config.undoStackSize||20,this.strokesLimit=25,this._filterRules=[],this.editor=e,this.reset(),CKEDITOR.env.ie&&this.addFilterRule((function(e){return e.replace(/\s+data-cke-expando=".*?"/g,"")}))};n.prototype={type:function(e,t){var i=n.getKeyGroup(e),a=this.strokesRecorded[i]+1;t=t||a>=this.strokesLimit,this.typing||(this.hasUndo=this.typing=!0,this.hasRedo=!1,this.onChange()),t?(a=0,this.editor.fire("saveSnapshot")):this.editor.fire("change"),this.strokesRecorded[i]=a,this.previousKeyGroup=i},keyGroupChanged:function(e){return n.getKeyGroup(e)!=this.previousKeyGroup},reset:function(){this.snapshots=[],this.index=-1,this.currentImage=null,this.hasRedo=this.hasUndo=!1,this.locked=null,this.resetType()},resetType:function(){this.strokesRecorded=[0,0],this.typing=!1,this.previousKeyGroup=-1},refreshState:function(){this.hasUndo=!!this.getNextImage(!0),this.hasRedo=!!this.getNextImage(!1),this.resetType(),this.onChange()},save:function(e,t,n){var a=this.editor;if(this.locked||"ready"!=a.status||"wysiwyg"!=a.mode)return!1;var r=a.editable();if(!r||"ready"!=r.status)return!1;if(r=this.snapshots,t||(t=new i(a)),!1===t.contents)return!1;if(this.currentImage)if(t.equalsContent(this.currentImage)){if(e||t.equalsSelection(this.currentImage))return!1}else!1!==n&&a.fire("change");return r.splice(this.index+1,r.length-this.index-1),r.length==this.limit&&r.shift(),this.index=r.push(t)-1,this.currentImage=t,!1!==n&&this.refreshState(),!0},restoreImage:function(e){var t,n=this.editor;e.bookmarks&&(n.focus(),t=n.getSelection()),this.locked={level:999},this.editor.loadSnapshot(e.contents),e.bookmarks?t.selectBookmarks(e.bookmarks):CKEDITOR.env.ie&&((t=this.editor.document.getBody().$.createTextRange()).collapse(!0),t.select()),this.locked=null,this.index=e.index,this.currentImage=this.snapshots[this.index],this.update(),this.refreshState(),n.fire("change")},getNextImage:function(e){var t,n=this.snapshots,i=this.currentImage;if(i)if(e){for(t=this.index-1;0<=t;t--)if(e=n[t],!i.equalsContent(e))return e.index=t,e}else for(t=this.index+1;t<n.length;t++)if(e=n[t],!i.equalsContent(e))return e.index=t,e;return null},redoable:function(){return this.enabled&&this.hasRedo},undoable:function(){return this.enabled&&this.hasUndo},undo:function(){if(this.undoable()){this.save(!0);var e=this.getNextImage(!0);if(e)return this.restoreImage(e),!0}return!1},redo:function(){if(this.redoable()&&(this.save(!0),this.redoable())){var e=this.getNextImage(!1);if(e)return this.restoreImage(e),!0}return!1},update:function(e){if(!this.locked){e||(e=new i(this.editor));for(var t=this.index,n=this.snapshots;0<t&&this.currentImage.equalsContent(n[t-1]);)--t;n.splice(t,this.index-t+1,e),this.index=t,this.currentImage=e}},updateSelection:function(e){if(!this.snapshots.length)return!1;var t=this.snapshots,n=t[t.length-1];return!(!n.equalsContent(e)||n.equalsSelection(e)||(this.currentImage=t[t.length-1]=e,0))},lock:function(e,t){if(this.locked)this.locked.level++;else if(e)this.locked={level:1};else{var n=null;if(t)n=!0;else{var a=new i(this.editor,!0);this.currentImage&&this.currentImage.equalsContent(a)&&(n=a)}this.locked={update:n,level:1}}},unlock:function(){if(this.locked&&! --this.locked.level){var e=this.locked.update;if(this.locked=null,!0===e)this.update();else if(e){var t=new i(this.editor,!0);e.equalsContent(t)||this.update()}}},addFilterRule:function(e){this._filterRules.push(e)}},n.navigationKeyCodes={37:1,38:1,39:1,40:1,36:1,35:1,33:1,34:1},n.keyGroups={PRINTABLE:0,FUNCTIONAL:1},n.isNavigationKey=function(e){return!!n.navigationKeyCodes[e]},n.getKeyGroup=function(e){var i=n.keyGroups;return t[e]?i.FUNCTIONAL:i.PRINTABLE},n.getOppositeKeyGroup=function(e){var t=n.keyGroups;return e==t.FUNCTIONAL?t.PRINTABLE:t.FUNCTIONAL},n.ieFunctionalKeysBug=function(e){return CKEDITOR.env.ie&&n.getKeyGroup(e)==n.keyGroups.FUNCTIONAL};var i=CKEDITOR.plugins.undo.Image=function(e,t){this.editor=e,e.fire("beforeUndoImage");var n=e.getSnapshot();n&&(this.contents=function(e,t){return CKEDITOR.tools.array.reduce(t,(function(e,t){return t(e)}),e)}(n,e.undoManager._filterRules)),t||(this.bookmarks=(n=n&&e.getSelection())&&n.createBookmarks2(!0)),e.fire("afterUndoImage")},a=/\b(?:href|src|name)="[^"]*?"/gi;i.prototype={equalsContent:function(e){var t=this.contents;return e=e.contents,CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks)&&(t=t.replace(a,""),e=e.replace(a,"")),t==e},equalsSelection:function(e){var t=this.bookmarks;if(e=e.bookmarks,t||e){if(!t||!e||t.length!=e.length)return!1;for(var n=0;n<t.length;n++){var i=t[n],a=e[n];if(i.startOffset!=a.startOffset||i.endOffset!=a.endOffset||!CKEDITOR.tools.arrayCompare(i.start,a.start)||!CKEDITOR.tools.arrayCompare(i.end,a.end))return!1}}return!0}};var r=CKEDITOR.plugins.undo.NativeEditingHandler=function(e){this.undoManager=e,this.ignoreInputEvent=!1,this.keyEventsStack=new o,this.lastKeydownImage=null};r.prototype={onKeydown:function(t){var a=t.data.getKey();229!==a&&(-1<CKEDITOR.tools.indexOf(e,t.data.getKeystroke())?t.data.preventDefault():(this.keyEventsStack.cleanUp(t),t=this.undoManager,this.keyEventsStack.getLast(a)||this.keyEventsStack.push(a),this.lastKeydownImage=new i(t.editor),(n.isNavigationKey(a)||this.undoManager.keyGroupChanged(a))&&(t.strokesRecorded[0]||t.strokesRecorded[1])&&(t.save(!1,this.lastKeydownImage,!1),t.resetType())))},onInput:function(){if(this.ignoreInputEvent)this.ignoreInputEvent=!1;else{var e=this.keyEventsStack.getLast();e||(e=this.keyEventsStack.push(0)),this.keyEventsStack.increment(e.keyCode),this.keyEventsStack.getTotalInputs()>=this.undoManager.strokesLimit&&(this.undoManager.type(e.keyCode,!0),this.keyEventsStack.resetInputs())}},onKeyup:function(e){var t=this.undoManager;e=e.data.getKey();var a=this.keyEventsStack.getTotalInputs();this.keyEventsStack.remove(e),n.ieFunctionalKeysBug(e)&&this.lastKeydownImage&&this.lastKeydownImage.equalsContent(new i(t.editor,!0))||(0<a?t.type(e):n.isNavigationKey(e)&&this.onNavigationKey(!0))},onNavigationKey:function(e){var t=this.undoManager;!e&&t.save(!0,null,!1)||t.updateSelection(new i(t.editor)),t.resetType()},ignoreInputEventListener:function(){this.ignoreInputEvent=!0},activateInputEventListener:function(){this.ignoreInputEvent=!1},attachListeners:function(){var e=this.undoManager.editor,t=e.editable(),i=this;t.attachListener(t,"keydown",(function(e){i.onKeydown(e),n.ieFunctionalKeysBug(e.data.getKey())&&i.onInput()}),null,null,999),t.attachListener(t,CKEDITOR.env.ie?"keypress":"input",i.onInput,i,null,999),t.attachListener(t,"keyup",i.onKeyup,i,null,999),t.attachListener(t,"paste",i.ignoreInputEventListener,i,null,999),t.attachListener(t,"drop",i.ignoreInputEventListener,i,null,999),e.on("afterPaste",i.activateInputEventListener,i,null,999),t.attachListener(t.isInline()?t:e.document.getDocumentElement(),"click",(function(){i.onNavigationKey()}),null,null,999),t.attachListener(this.undoManager.editor,"blur",(function(){i.keyEventsStack.remove(9)}),null,null,999)}};var o=CKEDITOR.plugins.undo.KeyEventsStack=function(){this.stack=[]};o.prototype={push:function(e){return e=this.stack.push({keyCode:e,inputs:0}),this.stack[e-1]},getLastIndex:function(e){if("number"!=typeof e)return this.stack.length-1;for(var t=this.stack.length;t--;)if(this.stack[t].keyCode==e)return t;return-1},getLast:function(e){return-1!=(e=this.getLastIndex(e))?this.stack[e]:null},increment:function(e){this.getLast(e).inputs++},remove:function(e){-1!=(e=this.getLastIndex(e))&&this.stack.splice(e,1)},resetInputs:function(e){if("number"==typeof e)this.getLast(e).inputs=0;else for(e=this.stack.length;e--;)this.stack[e].inputs=0},getTotalInputs:function(){for(var e=this.stack.length,t=0;e--;)t+=this.stack[e].inputs;return t},cleanUp:function(e){(e=e.data.$).ctrlKey||e.metaKey||this.remove(17),e.shiftKey||this.remove(16),e.altKey||this.remove(18)}}}(),function(){function e(e,t){CKEDITOR.tools.extend(this,{editor:e,editable:e.editable(),doc:e.document,win:e.window},t,!0),this.inline=this.editable.isInline(),this.inline||(this.frame=this.win.getFrame()),this.target=this[this.inline?"editable":"doc"]}function t(e,t){CKEDITOR.tools.extend(this,t,{editor:e},!0)}function n(e,t){var n=e.editable();CKEDITOR.tools.extend(this,{editor:e,editable:n,inline:n.isInline(),doc:e.document,win:e.window,container:CKEDITOR.document.getBody(),winTop:CKEDITOR.document.getWindow()},t,!0),this.hidden={},this.visible={},this.inline||(this.frame=this.win.getFrame()),this.queryViewport();var i=CKEDITOR.tools.bind(this.queryViewport,this),o=CKEDITOR.tools.bind(this.hideVisible,this),s=CKEDITOR.tools.bind(this.removeAll,this);n.attachListener(this.winTop,"resize",i),n.attachListener(this.winTop,"scroll",i),n.attachListener(this.winTop,"resize",o),n.attachListener(this.win,"scroll",o),n.attachListener(this.inline?n:this.frame,"mouseout",(function(e){var t=e.data.$.clientX;e=e.data.$.clientY,this.queryViewport(),(t<=this.rect.left||t>=this.rect.right||e<=this.rect.top||e>=this.rect.bottom)&&this.hideVisible(),(0>=t||t>=this.winTopPane.width||0>=e||e>=this.winTopPane.height)&&this.hideVisible()}),this),n.attachListener(e,"resize",i),n.attachListener(e,"mode",s),e.on("destroy",s),this.lineTpl=new CKEDITOR.template('<div data-cke-lineutils-line="1" class="cke_reset_all" style="{lineStyle}"><span style="{tipLeftStyle}">&nbsp;</span><span style="{tipRightStyle}">&nbsp;</span></div>').output({lineStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},r,this.lineStyle,!0)),tipLeftStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},a,{left:"0px","border-left-color":"red","border-width":"6px 0 6px 6px"},this.tipCss,this.tipLeftStyle,!0)),tipRightStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},a,{right:"0px","border-right-color":"red","border-width":"6px 6px 6px 0"},this.tipCss,this.tipRightStyle,!0))})}function i(e){var t;return(t=e&&e.type==CKEDITOR.NODE_ELEMENT)&&(t=!(o[e.getComputedStyle("float")]||o[e.getAttribute("align")])),t&&!s[e.getComputedStyle("position")]}CKEDITOR.plugins.add("lineutils"),CKEDITOR.LINEUTILS_BEFORE=1,CKEDITOR.LINEUTILS_AFTER=2,CKEDITOR.LINEUTILS_INSIDE=4,e.prototype={start:function(e){var t,n,i,a,r=this,o=this.editor,s=this.doc,l=CKEDITOR.tools.eventsBuffer(50,(function(){o.readOnly||"wysiwyg"!=o.mode||(r.relations={},(n=s.$.elementFromPoint(i,a))&&n.nodeType&&(t=new CKEDITOR.dom.element(n),r.traverseSearch(t),isNaN(i+a)||r.pixelSearch(t,i,a),e&&e(r.relations,i,a)))}));this.listener=this.editable.attachListener(this.target,"mousemove",(function(e){i=e.data.$.clientX,a=e.data.$.clientY,l.input()})),this.editable.attachListener(this.inline?this.editable:this.frame,"mouseout",(function(){l.reset()}))},stop:function(){this.listener&&this.listener.removeListener()},getRange:function(){var e={};return e[CKEDITOR.LINEUTILS_BEFORE]=CKEDITOR.POSITION_BEFORE_START,e[CKEDITOR.LINEUTILS_AFTER]=CKEDITOR.POSITION_AFTER_END,e[CKEDITOR.LINEUTILS_INSIDE]=CKEDITOR.POSITION_AFTER_START,function(t){var n=this.editor.createRange();return n.moveToPosition(this.relations[t.uid].element,e[t.type]),n}}(),store:function(){function e(e,t,n){var i=e.getUniqueId();i in n?n[i].type|=t:n[i]={element:e,type:t}}return function(t,n){var a;n&CKEDITOR.LINEUTILS_AFTER&&i(a=t.getNext())&&a.isVisible()&&(e(a,CKEDITOR.LINEUTILS_BEFORE,this.relations),n^=CKEDITOR.LINEUTILS_AFTER),n&CKEDITOR.LINEUTILS_INSIDE&&i(a=t.getFirst())&&a.isVisible()&&(e(a,CKEDITOR.LINEUTILS_BEFORE,this.relations),n^=CKEDITOR.LINEUTILS_INSIDE),e(t,n,this.relations)}}(),traverseSearch:function(e){var t,n,a;do{if(!(a=e.$["data-cke-expando"])||!(a in this.relations)){if(e.equals(this.editable))break;if(i(e))for(t in this.lookups)(n=this.lookups[t](e))&&this.store(e,n)}}while((!e||e.type!=CKEDITOR.NODE_ELEMENT||"true"!=e.getAttribute("contenteditable"))&&(e=e.getParent()))},pixelSearch:function(){function e(e,n,a,r,o){for(var s,l=0;o(a)&&(a+=r,25!=++l);)if(s=this.doc.$.elementFromPoint(n,a))if(s==e)l=0;else if(t(e,s)&&(l=0,i(s=new CKEDITOR.dom.element(s))))return s}var t=CKEDITOR.env.ie||CKEDITOR.env.webkit?function(e,t){return e.contains(t)}:function(e,t){return!!(16&e.compareDocumentPosition(t))};return function(t,n,a){var r=this.win.getViewPaneSize().height,o=e.call(this,t.$,n,a,-1,(function(e){return 0<e}));if(n=e.call(this,t.$,n,a,1,(function(e){return e<r})),o)for(this.traverseSearch(o);!o.getParent().equals(t);)o=o.getParent();if(n)for(this.traverseSearch(n);!n.getParent().equals(t);)n=n.getParent();for(;(o||n)&&(o&&(o=o.getNext(i)),o&&!o.equals(n))&&(this.traverseSearch(o),n&&(n=n.getPrevious(i)),n&&!n.equals(o));)this.traverseSearch(n)}}(),greedySearch:function(){this.relations={};for(var e,t,n,a=this.editable.getElementsByTag("*"),r=0;e=a.getItem(r++);)if(!e.equals(this.editable)&&e.type==CKEDITOR.NODE_ELEMENT&&(e.hasAttribute("contenteditable")||!e.isReadOnly())&&i(e)&&e.isVisible())for(n in this.lookups)(t=this.lookups[n](e))&&this.store(e,t);return this.relations}},t.prototype={locate:function(){function e(e,t){var n=e.element[t===CKEDITOR.LINEUTILS_BEFORE?"getPrevious":"getNext"]();return n&&i(n)?(e.siblingRect=n.getClientRect(),t==CKEDITOR.LINEUTILS_BEFORE?(e.siblingRect.bottom+e.elementRect.top)/2:(e.elementRect.bottom+e.siblingRect.top)/2):t==CKEDITOR.LINEUTILS_BEFORE?e.elementRect.top:e.elementRect.bottom}return function(t){var n;for(var i in this.locations={},t)(n=t[i]).elementRect=n.element.getClientRect(),n.type&CKEDITOR.LINEUTILS_BEFORE&&this.store(i,CKEDITOR.LINEUTILS_BEFORE,e(n,CKEDITOR.LINEUTILS_BEFORE)),n.type&CKEDITOR.LINEUTILS_AFTER&&this.store(i,CKEDITOR.LINEUTILS_AFTER,e(n,CKEDITOR.LINEUTILS_AFTER)),n.type&CKEDITOR.LINEUTILS_INSIDE&&this.store(i,CKEDITOR.LINEUTILS_INSIDE,(n.elementRect.top+n.elementRect.bottom)/2);return this.locations}}(),sort:function(){var e,t,n,i;return function(a,r){for(var o in e=this.locations,t=[],e)for(var s in e[o])if(n=Math.abs(a-e[o][s]),t.length){for(i=0;i<t.length;i++)if(n<t[i].dist){t.splice(i,0,{uid:+o,type:s,dist:n});break}i==t.length&&t.push({uid:+o,type:s,dist:n})}else t.push({uid:+o,type:s,dist:n});return void 0!==r?t.slice(0,r):t}}(),store:function(e,t,n){this.locations[e]||(this.locations[e]={}),this.locations[e][t]=n}};var a={display:"block",width:"0px",height:"0px","border-color":"transparent","border-style":"solid",position:"absolute",top:"-6px"},r={height:"0px","border-top":"1px dashed red",position:"absolute","z-index":9999};n.prototype={removeAll:function(){for(var e in this.hidden)this.hidden[e].remove(),delete this.hidden[e];for(e in this.visible)this.visible[e].remove(),delete this.visible[e]},hideLine:function(e){var t=e.getUniqueId();e.hide(),this.hidden[t]=e,delete this.visible[t]},showLine:function(e){var t=e.getUniqueId();e.show(),this.visible[t]=e,delete this.hidden[t]},hideVisible:function(){for(var e in this.visible)this.hideLine(this.visible[e])},placeLine:function(e,t){var n,i,a;if(n=this.getStyle(e.uid,e.type)){for(a in this.visible)if(this.visible[a].getCustomData("hash")!==this.hash){i=this.visible[a];break}if(!i)for(a in this.hidden)if(this.hidden[a].getCustomData("hash")!==this.hash){this.showLine(i=this.hidden[a]);break}i||this.showLine(i=this.addLine()),i.setCustomData("hash",this.hash),this.visible[i.getUniqueId()]=i,i.setStyles(n),t&&t(i)}},getStyle:function(e,t){var n=this.relations[e],i=this.locations[e][t],a={};if(a.width=n.siblingRect?Math.max(n.siblingRect.width,n.elementRect.width):n.elementRect.width,a.top=this.inline?i+this.winTopScroll.y-this.rect.relativeY:this.rect.top+this.winTopScroll.y+i,a.top-this.winTopScroll.y<this.rect.top||a.top-this.winTopScroll.y>this.rect.bottom)return!1;for(var r in this.inline?a.left=n.elementRect.left-this.rect.relativeX:(0<n.elementRect.left?a.left=this.rect.left+n.elementRect.left:(a.width+=n.elementRect.left,a.left=this.rect.left),0<(n=a.left+a.width-(this.rect.left+this.winPane.width))&&(a.width-=n)),a.left+=this.winTopScroll.x,a)a[r]=CKEDITOR.tools.cssLength(a[r]);return a},addLine:function(){var e=CKEDITOR.dom.element.createFromHtml(this.lineTpl);return e.appendTo(this.container),e},prepare:function(e,t){this.relations=e,this.locations=t,this.hash=Math.random()},cleanup:function(){var e,t;for(t in this.visible)(e=this.visible[t]).getCustomData("hash")!==this.hash&&this.hideLine(e)},queryViewport:function(){this.winPane=this.win.getViewPaneSize(),this.winTopScroll=this.winTop.getScrollPosition(),this.winTopPane=this.winTop.getViewPaneSize(),this.rect=this.getClientRect(this.inline?this.editable:this.frame)},getClientRect:function(e){e=e.getClientRect();var t=this.container.getDocumentPosition(),n=this.container.getComputedStyle("position");return e.relativeX=e.relativeY=0,"static"!=n&&(e.relativeY=t.y,e.relativeX=t.x,e.top-=e.relativeY,e.bottom-=e.relativeY,e.left-=e.relativeX,e.right-=e.relativeX),e}};var o={left:1,right:1,center:1},s={absolute:1,fixed:1};CKEDITOR.plugins.lineutils={finder:e,locator:t,liner:n}}(),function(){function e(e){return e.getName&&!e.hasAttribute("data-cke-temp")}CKEDITOR.plugins.add("widgetselection",{init:function(e){if(CKEDITOR.env.webkit){var t=CKEDITOR.plugins.widgetselection;e.on("contentDom",(function(e){var n=(e=e.editor).editable();n.attachListener(n,"keydown",(function(e){e.data.getKeystroke()==CKEDITOR.CTRL+65&&CKEDITOR.tools.setTimeout((function(){t.addFillers(n)||t.removeFillers(n)}),0)}),null,null,-1),e.on("selectionCheck",(function(e){t.removeFillers(e.editor.editable())})),e.on("paste",(function(e){e.data.dataValue=t.cleanPasteData(e.data.dataValue)})),"selectall"in e.plugins&&t.addSelectAllIntegration(e)}))}}}),CKEDITOR.plugins.widgetselection={startFiller:null,endFiller:null,fillerAttribute:"data-cke-filler-webkit",fillerContent:"&nbsp;",fillerTagName:"div",addFillers:function(t){var n=t.editor;if(!this.isWholeContentSelected(t)&&0<t.getChildCount()){var i=t.getFirst(e),a=t.getLast(e);if(i&&i.type==CKEDITOR.NODE_ELEMENT&&!i.isEditable()&&(this.startFiller=this.createFiller(),t.append(this.startFiller,1)),a&&a.type==CKEDITOR.NODE_ELEMENT&&!a.isEditable()&&(this.endFiller=this.createFiller(!0),t.append(this.endFiller,0)),this.hasFiller(t))return(n=n.createRange()).selectNodeContents(t),n.select(),!0}return!1},removeFillers:function(e){if(this.hasFiller(e)&&!this.isWholeContentSelected(e)){var t=e.findOne(this.fillerTagName+"["+this.fillerAttribute+"=start]"),n=e.findOne(this.fillerTagName+"["+this.fillerAttribute+"=end]");this.startFiller&&t&&this.startFiller.equals(t)?this.removeFiller(this.startFiller,e):this.startFiller=t,this.endFiller&&n&&this.endFiller.equals(n)?this.removeFiller(this.endFiller,e):this.endFiller=n}},cleanPasteData:function(e){return e&&e.length&&(e=e.replace(this.createFillerRegex(),"").replace(this.createFillerRegex(!0),"")),e},isWholeContentSelected:function(e){var t=e.editor.getSelection().getRanges()[0];return!(!t||t&&t.collapsed||((t=t.clone()).enlarge(CKEDITOR.ENLARGE_ELEMENT),!(t&&e&&t.startContainer&&t.endContainer&&0===t.startOffset&&t.endOffset===e.getChildCount()&&t.startContainer.equals(e)&&t.endContainer.equals(e))))},hasFiller:function(e){return 0<e.find(this.fillerTagName+"["+this.fillerAttribute+"]").count()},createFiller:function(e){var t=new CKEDITOR.dom.element(this.fillerTagName);return t.setHtml(this.fillerContent),t.setAttribute(this.fillerAttribute,e?"end":"start"),t.setAttribute("data-cke-temp",1),t.setStyles({display:"block",width:0,height:0,padding:0,border:0,margin:0,position:"absolute",top:0,left:"-9999px",opacity:0,overflow:"hidden"}),t},removeFiller:function(e,t){if(e){var n,i,a=t.editor,r=t.editor.getSelection().getRanges()[0].startPath(),o=a.createRange();r.contains(e)&&(n=e.getHtml(),i=!0),r="start"==e.getAttribute(this.fillerAttribute),e.remove(),n&&0<n.length&&n!=this.fillerContent?(t.insertHtmlIntoRange(n,a.getSelection().getRanges()[0]),o.setStartAt(t.getChild(t.getChildCount()-1),CKEDITOR.POSITION_BEFORE_END),a.getSelection().selectRanges([o])):i&&(r?o.setStartAt(t.getFirst().getNext(),CKEDITOR.POSITION_AFTER_START):o.setEndAt(t.getLast().getPrevious(),CKEDITOR.POSITION_BEFORE_END),t.editor.getSelection().selectRanges([o]))}},createFillerRegex:function(e){var t=this.createFiller(e).getOuterHtml().replace(/style="[^"]*"/gi,'style="[^"]*"').replace(/>[^<]*</gi,">[^<]*<");return new RegExp((e?"":"^")+t+(e?"$":""))},addSelectAllIntegration:function(e){var t=this;e.editable().attachListener(e,"beforeCommandExec",(function(n){var i=e.editable();"selectAll"==n.data.name&&i&&t.addFillers(i)}),null,null,9999)}}}(),function(){function e(e){this.editor=e,this.registered={},this.instances={},this.selected=[],this.widgetHoldingFocusedEditable=this.focused=null,this._={nextId:0,upcasts:[],upcastCallbacks:[],filters:{}},function(e){var n,i,a=e.editor;a.on("toHtml",(function(i){var a,r=function(e){var n=[],i=e._.upcasts,a=e._.upcastCallbacks;return{toBeWrapped:n,iterator:function(e){var r,o,s,l,d;if("data-cke-widget-wrapper"in e.attributes)return(e=e.getFirst(t.isParserWidgetElement))&&n.push([e]),!1;if("data-widget"in e.attributes)return n.push([e]),!1;if(d=i.length){if(e.attributes["data-cke-widget-upcasted"])return!1;for(l=0,r=a.length;l<r;++l)if(!1===a[l](e))return;for(l=0;l<d;++l)if(s={},o=(r=i[l])[0](e,s))return o instanceof CKEDITOR.htmlParser.element&&(e=o),e.attributes["data-cke-widget-data"]=encodeURIComponent(JSON.stringify(s)),e.attributes["data-cke-widget-upcasted"]=1,n.push([e,r[1]]),!1}}}}(e);for(i.data.dataValue.forEach(r.iterator,CKEDITOR.NODE_ELEMENT,!0);a=r.toBeWrapped.pop();){var o=a[0],s=o.parent;s.type==CKEDITOR.NODE_ELEMENT&&s.attributes["data-cke-widget-wrapper"]&&s.replaceWith(o),e.wrapElement(a[0],a[1])}n=i.data.protectedWhitespaces?3==i.data.dataValue.children.length&&t.isParserWidgetWrapper(i.data.dataValue.children[1]):1==i.data.dataValue.children.length&&t.isParserWidgetWrapper(i.data.dataValue.children[0])}),null,null,8),a.on("dataReady",(function(){if(i)for(var n,r,o=a.editable().find(".cke_widget_wrapper"),s=0,l=o.count();s<l;++s)(r=(n=o.getItem(s)).getFirst(t.isDomWidgetElement)).type==CKEDITOR.NODE_ELEMENT&&r.data("widget")?(r.replace(n),e.wrapElement(r)):n.remove();i=0,e.destroyAll(!0),e.initOnAll()})),a.on("loadSnapshot",(function(t){/data-cke-widget/.test(t.data)&&(i=1),e.destroyAll(!0)}),null,null,9),a.on("paste",(function(e){(e=e.data).dataValue=e.dataValue.replace(k,p),e.range&&(e=t.getNestedEditable(a.editable(),e.range.startContainer))&&(e=CKEDITOR.filter.instances[e.data("cke-filter")])&&a.setActiveFilter(e)})),a.on("afterInsertHtml",(function(t){t.data.intoRange?e.checkWidgets({initOnlyNew:!0}):(a.fire("lockSnapshot"),e.checkWidgets({initOnlyNew:!0,focusInited:n}),a.fire("unlockSnapshot"))}))}(this),function(e){var n=e.editor,i={};n.on("toDataFormat",(function(n){var a=CKEDITOR.tools.getNextNumber(),r=[];n.data.downcastingSessionId=a,i[a]=r,n.data.dataValue.forEach((function(n){var i,a=n.attributes;if("data-cke-widget-white-space"in a){i=o(n);var l=s(n);i.parent.attributes["data-cke-white-space-first"]&&(i.value=i.value.replace(/^&nbsp;/g," ")),l.parent.attributes["data-cke-white-space-last"]&&(l.value=l.value.replace(/&nbsp;$/g," "))}if("data-cke-widget-id"in a)(a=e.instances[a["data-cke-widget-id"]])&&(i=n.getFirst(t.isParserWidgetElement),r.push({wrapper:n,element:i,widget:a,editables:{}}),i&&"1"!=i.attributes["data-cke-widget-keep-attr"]&&delete i.attributes["data-widget"]);else if("data-cke-widget-editable"in a)return 0<r.length&&(r[r.length-1].editables[a["data-cke-widget-editable"]]=n),!1}),CKEDITOR.NODE_ELEMENT,!0)}),null,null,8),n.on("toDataFormat",(function(e){if(e.data.downcastingSessionId)for(var t,n,a,r,o,s,l=i[e.data.downcastingSessionId];t=l.shift();){for(s in n=t.widget,a=t.element,r=n._.downcastFn&&n._.downcastFn.call(n,a),e.data.widgetsCopy&&n.getClipboardHtml&&(r=(r=CKEDITOR.htmlParser.fragment.fromHtml(n.getClipboardHtml())).children[0]),t.editables)delete(o=t.editables[s]).attributes.contenteditable,o.setHtml(n.editables[s].getData());r||(r=a),r?t.wrapper.replaceWith(r):t.wrapper.remove()}}),null,null,13),n.on("contentDomUnload",(function(){e.destroyAll(!0)}))}(this),this.on("checkWidgets",a),this.editor.on("contentDomInvalidated",this.checkWidgets,this),function(e){function n(e){return e?e.type==CKEDITOR.NODE_TEXT?n(e.getParent()):r.widgets.getByElement(e):null}function a(){e.fire("checkSelection")}var r=e.editor;r.on("selectionCheck",a),r.on("contentDom",(function(){r.editable().attachListener(r,"key",(function(){setTimeout(a,10)}))})),CKEDITOR.env.ie||e.on("checkSelection",(function(){var e=r.getSelection();if(e&&(e=e.getRanges()[0])&&!e.collapsed){var t=n(e.startContainer),i=n(e.endContainer);!t&&i?(e.setEndBefore(i.wrapper),e.select()):t&&!i&&(e.setStartAfter(t.wrapper),e.select())}})),e.on("checkSelection",e.checkSelection,e),r.on("selectionChange",(function(n){var i=(n=t.getNestedEditable(r.editable(),n.data.selection.getStartElement()))&&e.getByElement(n),a=e.widgetHoldingFocusedEditable;a?a===i&&a.focusedEditable.equals(n)||(h(e,a,null),i&&n&&h(e,i,n)):i&&n&&h(e,i,n)})),r.on("dataReady",(function(){g(e).commit()})),r.on("blur",(function(){var t;(t=e.focused)&&i(e,t),(t=e.widgetHoldingFocusedEditable)&&h(e,t,null)}))}(this),function(e){var n=e.editor;n.on("contentDom",(function(){var i,a,r=n.editable(),o=r.isInline()?r:n.document;r.attachListener(o,"mousedown",(function(r){var o=r.data.getTarget();i=o instanceof CKEDITOR.dom.element?e.getByElement(o):null,a=0,i&&(i.inline&&o.type==CKEDITOR.NODE_ELEMENT&&o.hasAttribute("data-cke-widget-drag-handler")?(a=1,e.focused!=i&&n.getSelection().removeAllRanges()):t.getNestedEditable(i.wrapper,o)?i=null:(r.data.preventDefault(),CKEDITOR.env.ie||i.focus()))})),r.attachListener(o,"mouseup",(function(){a&&i&&i.wrapper&&(a=0,i.focus())})),CKEDITOR.env.ie&&r.attachListener(o,"mouseup",(function(){setTimeout((function(){i&&i.wrapper&&r.contains(i.wrapper)&&(i.focus(),i=null)}))}))})),n.on("doubleclick",(function(n){var i=e.getByElement(n.data.element);if(i&&!t.getNestedEditable(i.wrapper,n.data.element))return i.fire("doubleclick",{element:n.data.element})}),null,null,1)}(this),function(e){e.editor.on("key",(function(t){var n,i=e.focused,a=e.widgetHoldingFocusedEditable;return i?n=i.fire("key",{keyCode:t.data.keyCode}):a&&(i=t.data.keyCode,t=a.focusedEditable,i==CKEDITOR.CTRL+65?(i=t.getBogus(),(a=a.editor.createRange()).selectNodeContents(t),i&&a.setEndAt(i,CKEDITOR.POSITION_BEFORE_START),a.select(),n=!1):8==i||46==i?(n=a.editor.getSelection().getRanges(),a=n[0],n=!(1==n.length&&a.collapsed&&a.checkBoundaryOfElement(t,CKEDITOR[8==i?"START":"END"]))):n=void 0),n}),null,null,1)}(this),function(e){var n=e.editor,i=CKEDITOR.plugins.lineutils;n.on("dragstart",(function(i){var a=i.data.target;t.isDomDragHandler(a)&&(a=e.getByElement(a),i.data.dataTransfer.setData("cke/widget-id",a.id),n.focus(),a.focus())})),n.on("drop",(function(t){var i=(r=t.data.dataTransfer).getData("cke/widget-id"),a=r.getTransferType(n),r=n.createRange(),o=function(e){return(e=e.getBoundaryNodes().startNode).type!==CKEDITOR.NODE_ELEMENT&&(e=e.getParent()),n.widgets.getByElement(e)}(t.data.dropRange);""!==i&&a===CKEDITOR.DATA_TRANSFER_CROSS_EDITORS?t.cancel():a==CKEDITOR.DATA_TRANSFER_INTERNAL&&(""===i&&0<n.widgets.selected.length?t.data.dataTransfer.setData("text/html",y(n)):(i=e.instances[i])&&(function(e,t){return!(!e||!t)&&(e.wrapper.equals(t.wrapper)||e.wrapper.contains(t.wrapper))}(i,o)?t.cancel():(r.setStartBefore(i.wrapper),r.setEndAfter(i.wrapper),t.data.dragRange=r,delete CKEDITOR.plugins.clipboard.dragStartContainerChildCount,delete CKEDITOR.plugins.clipboard.dragEndContainerChildCount,t.data.dataTransfer.setData("text/html",i.getClipboardHtml()),n.widgets.destroy(i,!0))))})),n.on("contentDom",(function(){var a=n.editable();CKEDITOR.tools.extend(e,{finder:new i.finder(n,{lookups:{default:function(n){if(!n.is(CKEDITOR.dtd.$listItem)&&n.is(CKEDITOR.dtd.$block)&&!t.isDomNestedEditable(n)&&!e._.draggedWidget.wrapper.contains(n)){var i=t.getNestedEditable(a,n);if(i){if(n=e._.draggedWidget,e.getByElement(i)==n)return;if(i=CKEDITOR.filter.instances[i.data("cke-filter")],n=n.requiredContent,i&&n&&!i.check(n))return}return CKEDITOR.LINEUTILS_BEFORE|CKEDITOR.LINEUTILS_AFTER}}}}),locator:new i.locator(n),liner:new i.liner(n,{lineStyle:{cursor:"move !important","border-top-color":"#666"},tipLeftStyle:{"border-left-color":"#666"},tipRightStyle:{"border-right-color":"#666"}})},!0)}))}(this),function(e){function t(t){1>e.selected.length||T(n,"cut"===t.name)}var n=e.editor;n.on("contentDom",(function(){var e=n.editable();e.attachListener(e,"copy",t),e.attachListener(e,"cut",t)}))}(this)}function t(e,n,i,a,r){var o=e.editor;CKEDITOR.tools.extend(this,a,{editor:o,id:n,inline:"span"==i.getParent().getName(),element:i,data:CKEDITOR.tools.extend({},"function"==typeof a.defaults?a.defaults():a.defaults),dataReady:!1,inited:!1,ready:!1,edit:t.prototype.edit,focusedEditable:null,definition:a,repository:e,draggable:!1!==a.draggable,_:{downcastFn:a.downcast&&"string"==typeof a.downcast?a.downcasts[a.downcast]:a.downcast}},!0),e.fire("instanceCreated",this),function(e,n){var i=e.editor.config.widget_keystrokeInsertLineBefore,a=e.editor.config.widget_keystrokeInsertLineAfter;(function(e){(e.wrapper=e.element.getParent()).setAttribute("data-cke-widget-id",e.id)})(e),D(e),function(e){var t,n,i=e.editables;if(e.editables={},e.editables)for(t in i)n=i[t],e.initEditable(t,"string"==typeof n?{selector:n}:n)}(e),O(e),function(e){if(e.draggable){var n,i=e.editor,a=e.wrapper.getLast(t.isDomDragHandlerContainer);a?n=a.findOne("img"):((a=new CKEDITOR.dom.element("span",i.document)).setAttributes({class:"cke_reset cke_widget_drag_handler_container",style:"background:rgba(220,220,220,0.5);background-image:url("+i.plugins.widget.path+"images/handle.png);display:none;"}),(n=new CKEDITOR.dom.element("img",i.document)).setAttributes({class:"cke_reset cke_widget_drag_handler","data-cke-widget-drag-handler":"1",src:CKEDITOR.tools.transparentImageData,width:15,title:i.lang.widget.move,height:15,role:"presentation"}),e.inline&&n.setAttribute("draggable","true"),a.append(n),e.wrapper.append(a)),e.wrapper.on("dragover",(function(e){e.data.preventDefault()})),e.wrapper.on("mouseenter",e.updateDragHandlerPosition,e),setTimeout((function(){e.on("data",e.updateDragHandlerPosition,e)}),50),!e.inline&&(n.on("mousedown",_,e),CKEDITOR.env.ie&&9>CKEDITOR.env.version)&&n.on("dragstart",(function(e){e.data.preventDefault(!0)})),e.dragHandlerContainer=a}}(e),function(e){var t=null;e.on("data",(function(){var e,n=this.data.classes;if(t!=n){for(e in t)n&&n[e]||this.removeClass(e);for(e in n)this.addClass(e);t=n}}))}(e),function(e){e.on("data",(function(){if(e.wrapper){var t=this.getLabel?this.getLabel():this.editor.lang.widget.label.replace(/%1/,this.pathName||this.element.getName());e.wrapper.setAttribute("role","region"),e.wrapper.setAttribute("aria-label",t)}}),null,null,9999)}(e),CKEDITOR.env.ie&&9>CKEDITOR.env.version&&e.wrapper.on("dragstart",(function(n){var i=n.data.getTarget();t.getNestedEditable(e,i)||e.inline&&t.isDomDragHandler(i)||n.data.preventDefault()})),e.wrapper.removeClass("cke_widget_new"),e.element.addClass("cke_widget_element"),e.on("key",(function(t){if((t=t.data.keyCode)==i)E(e,"before"),e.editor.fire("saveSnapshot");else if(t==a)E(e,"after"),e.editor.fire("saveSnapshot");else if(13==t)e.edit();else{if(t==CKEDITOR.CTRL+67||t==CKEDITOR.CTRL+88)return void T(e.editor,t==CKEDITOR.CTRL+88);if(t in K||CKEDITOR.CTRL&t||CKEDITOR.ALT&t)return}return!1}),null,null,999),e.on("doubleclick",(function(t){e.edit()&&t.cancel()})),n.data&&e.on("data",n.data),n.edit&&e.on("edit",n.edit)}(this,a),this.init&&this.init(),this.inited=!0,(e=this.element.data("cke-widget-data"))&&this.setData(JSON.parse(decodeURIComponent(e))),r&&this.setData(r),this.data.classes||this.setData("classes",this.getClasses()),this.dataReady=!0,x(this),this.fire("data",this.data),this.isInited()&&o.editable().contains(this.wrapper)&&(this.ready=!0,this.fire("ready"))}function n(e,t,n){CKEDITOR.dom.element.call(this,t.$),this.editor=e,this._={},t=this.filter=n.filter,CKEDITOR.dtd[this.getName()].p?(this.enterMode=t?t.getAllowedEnterMode(e.enterMode):e.enterMode,this.shiftEnterMode=t?t.getAllowedEnterMode(e.shiftEnterMode,!0):e.shiftEnterMode):this.enterMode=this.shiftEnterMode=CKEDITOR.ENTER_BR}function i(e,t){if(e.focused=null,t.isInited()){var n=t.editor.checkDirty();e.fire("widgetBlurred",{widget:t}),t.setFocused(!1),!n&&t.editor.resetDirty()}}function a(e){if(e=e.data,"wysiwyg"==this.editor.mode){var n,i,a,r,o=this.editor.editable(),s=this.instances;if(o){for(n in s)s[n].isReady()&&!o.contains(s[n].wrapper)&&this.destroy(s[n],!0);if(e&&e.initOnlyNew)s=this.initOnAll();else{var l=o.find(".cke_widget_wrapper");for(s=[],n=0,i=l.count();n<i;n++){if(a=l.getItem(n),r=!this.getByElement(a,!0)){e:{r=f;for(var d=a;d=d.getParent();)if(r(d)){r=!0;break e}r=!1}r=!r}r&&o.contains(a)&&(a.addClass("cke_widget_new"),s.push(this.initOn(a.getFirst(t.isDomWidgetElement))))}}e&&e.focusInited&&1==s.length&&s[0].focus()}}}function r(e){if(void 0!==e.attributes&&e.attributes["data-widget"]){var t=o(e),n=s(e),i=!1;t&&t.value&&t.value.match(/^\s/g)&&(t.parent.attributes["data-cke-white-space-first"]=1,t.value=t.value.replace(/^\s/g,"&nbsp;"),i=!0),n&&n.value&&n.value.match(/\s$/g)&&(n.parent.attributes["data-cke-white-space-last"]=1,n.value=n.value.replace(/\s$/g,"&nbsp;"),i=!0),i&&(e.attributes["data-cke-widget-white-space"]=1)}}function o(e){return e.find((function(e){return 3===e.type}),!0).shift()}function s(e){return e.find((function(e){return 3===e.type}),!0).pop()}function l(e,t,n){if(!n.allowedContent&&!n.disallowedContent)return null;var i=this._.filters[e];return i||(this._.filters[e]=i={}),(e=i[t])||(e=n.allowedContent?new CKEDITOR.filter(n.allowedContent):this.editor.filter.clone(),i[t]=e,n.disallowedContent&&e.disallow(n.disallowedContent)),e}function d(e,t){return{tabindex:-1,contenteditable:"false","data-cke-widget-wrapper":1,"data-cke-filter":"off",class:"cke_widget_wrapper cke_widget_new cke_widget_"+(e?"inline":"block")+(t?" cke_widget_"+t:"")}}function c(e,t,n){if(e.type==CKEDITOR.NODE_ELEMENT&&(i=CKEDITOR.dtd[e.name])&&!i[n.name]){var i=e.split(t),a=e.parent;return t=i.getIndex(),e.children.length||(--t,e.remove()),i.children.length||i.remove(),c(a,t,n)}e.add(n,t)}function u(e,t){return"boolean"==typeof e.inline?e.inline:!!CKEDITOR.dtd.$inline[t]}function f(e){return e.hasAttribute("data-cke-temp")}function h(e,t,n,i){var a=e.editor;a.fire("lockSnapshot"),n?(i=n.data("cke-widget-editable"),i=t.editables[i],e.widgetHoldingFocusedEditable=t,t.focusedEditable=i,n.addClass("cke_widget_editable_focused"),i.filter&&a.setActiveFilter(i.filter),a.setActiveEnterMode(i.enterMode,i.shiftEnterMode)):(i||t.focusedEditable.removeClass("cke_widget_editable_focused"),t.focusedEditable=null,e.widgetHoldingFocusedEditable=null,a.setActiveFilter(null),a.setActiveEnterMode(null,null)),a.fire("unlockSnapshot")}function p(e,t){return CKEDITOR.tools.trim(t)}function g(e){var t=e.selected,n=[],a=t.slice(0),r=null;return{select:function(e){return 0>CKEDITOR.tools.indexOf(t,e)&&n.push(e),0<=(e=CKEDITOR.tools.indexOf(a,e))&&a.splice(e,1),this},focus:function(e){return r=e,this},commit:function(){var o,s,l=e.focused!==r;for(e.editor.fire("lockSnapshot"),l&&(o=e.focused)&&i(e,o);o=a.pop();)t.splice(CKEDITOR.tools.indexOf(t,o),1),o.isInited()&&(s=o.editor.checkDirty(),o.setSelected(!1),!s&&o.editor.resetDirty());for(l&&r&&(s=e.editor.checkDirty(),e.focused=r,e.fire("widgetFocused",{widget:r}),r.setFocused(!0),!s&&e.editor.resetDirty());o=n.pop();)t.push(o),o.setSelected(!0);e.editor.fire("unlockSnapshot")}}}function m(e,t,n){var i=0;t=C(t);var a,r=e.data.classes||{};if(t){for(r=CKEDITOR.tools.clone(r);a=t.pop();)n?r[a]||(i=r[a]=1):r[a]&&(delete r[a],i=1);i&&e.setData("classes",r)}}function v(e){e.cancel()}function E(e,t){var n=function(e){return e==CKEDITOR.ENTER_BR?"br":e==CKEDITOR.ENTER_DIV?"div":"p"}(e.editor.config.enterMode),i=new CKEDITOR.dom.element(n);"br"!==n&&i.appendBogus(),"after"===t?i.insertAfter(e.wrapper):i.insertBefore(e.wrapper),function(t){var n=e.editor.createRange();n.setStart(t,0),e.editor.getSelection().selectRanges([n])}(i)}function T(e,t){var n,i,a,r=e.widgets.focused;N.hasCopyBin(e)||(i=new N(e,{beforeDestroy:function(){!t&&r&&r.focus(),a&&e.getSelection().selectBookmarks(a),n&&CKEDITOR.plugins.widgetselection.addFillers(e.editable())},afterDestroy:function(){t&&!e.readOnly&&(r?e.widgets.del(r):e.extractSelectedHtml(),e.fire("saveSnapshot"))}}),r||(n=CKEDITOR.env.webkit&&CKEDITOR.plugins.widgetselection.isWholeContentSelected(e.editable()),a=e.getSelection().createBookmarks(!0)),i.handle(y(e)))}function C(e){return(e=(e=e.getDefinition().attributes)&&e.class)?e.split(/\s+/):null}function I(){var e=CKEDITOR.document.getActive(),t=this.editor,n=t.editable();(n.isInline()?n:t.document.getWindow().getFrame()).equals(e)&&t.focusManager.focus(n)}function b(){CKEDITOR.env.gecko&&this.editor.unlockSelection(),CKEDITOR.env.webkit||(this.editor.forceNextSelectionCheck(),this.editor.selectionChange(1))}function y(e){var t=e.getSelectedHtml(!0);return e.widgets.focused?e.widgets.focused.getClipboardHtml():(e.once("toDataFormat",(function(e){e.data.widgetsCopy=!0}),null,null,-1),e.dataProcessor.toDataFormat(t))}function D(e,t){if(e.partSelectors||(e.partSelectors=e.parts),e.parts){var n,i,a={};for(i in e.partSelectors)t||!e.parts[i]||"string"==typeof e.parts[i]?(n=e.wrapper.findOne(e.partSelectors[i]),a[i]=n):a[i]=e.parts[i];e.parts=a}}function O(e){if(!0===e.mask)!function(e){var t=e.wrapper.findOne(".cke_widget_mask");t||((t=new CKEDITOR.dom.element("img",e.editor.document)).setAttributes({src:CKEDITOR.tools.transparentImageData,class:"cke_reset cke_widget_mask"}),e.wrapper.append(t)),e.mask=t}(e);else if(e.mask){var t,n,i=new CKEDITOR.tools.buffers.throttle(250,R,e),a=CKEDITOR.env.gecko?300:0;if(e.on("focus",(function(){i.input(),t=e.editor.on("change",i.input),n=e.on("blur",(function(){t.removeListener(),n.removeListener()}))})),e.editor.on("instanceReady",(function(){setTimeout((function(){i.input()}),a)})),e.editor.on("mode",(function(){setTimeout((function(){i.input()}),a)})),CKEDITOR.env.gecko){var r=e.element.find("img");CKEDITOR.tools.array.forEach(r.toArray(),(function(e){e.on("load",(function(){i.input()}))}))}for(var o in e.editables)e.editables[o].on("focus",(function(){e.editor.on("change",i.input),n&&n.removeListener()})),e.editables[o].on("blur",(function(){e.editor.removeListener("change",i.input)}));i.input()}}function R(){if(this.wrapper){this.maskPart=this.maskPart||this.mask;var e,t=this.parts[this.maskPart];if(t&&"string"!=typeof t){(e=this.wrapper.findOne(".cke_widget_partial_mask"))||((e=new CKEDITOR.dom.element("img",this.editor.document)).setAttributes({src:CKEDITOR.tools.transparentImageData,class:"cke_reset cke_widget_partial_mask"}),this.wrapper.append(e)),this.mask=e;var n=e.$,i=t.$,a=!(n.offsetTop==i.offsetTop&&n.offsetLeft==i.offsetLeft);(n.offsetWidth!=i.offsetWidth||n.offsetHeight!=i.offsetHeight||a)&&(n=t.getParent(),i=CKEDITOR.plugins.widget.isDomWidget(n),e.setStyles({top:t.$.offsetTop+(i?0:n.$.offsetTop)+"px",left:t.$.offsetLeft+(i?0:n.$.offsetLeft)+"px",width:t.$.offsetWidth+"px",height:t.$.offsetHeight+"px"}))}}}function _(e){function t(){var t;for(f.reset();t=d.pop();)t.removeListener();var n=c;t=e.sender;var i=this.repository.finder,a=this.repository.liner,r=this.editor,o=this.editor.editable();CKEDITOR.tools.isEmpty(a.visible)||(n=i.getRange(n[0]),this.focus(),r.fire("drop",{dropRange:n,target:n.startContainer})),o.removeClass("cke_widget_dragging"),a.hideVisible(),r.fire("dragend",{target:t})}if(CKEDITOR.tools.getMouseButton(e)===CKEDITOR.MOUSE_BUTTON_LEFT){var n,i,a=this.repository.finder,r=this.repository.locator,o=this.repository.liner,s=this.editor,l=s.editable(),d=[],c=[];this.repository._.draggedWidget=this;var u=a.greedySearch(),f=CKEDITOR.tools.eventsBuffer(50,(function(){n=r.locate(u),(c=r.sort(i,1)).length&&(o.prepare(u,n),o.placeLine(c[0]),o.cleanup())}));l.addClass("cke_widget_dragging"),d.push(l.on("mousemove",(function(e){i=e.data.$.clientY,f.input()}))),s.fire("dragstart",{target:e.sender}),d.push(s.document.once("mouseup",t,this)),l.isInline()||d.push(CKEDITOR.document.once("mouseup",t,this))}}function x(e){e.element.data("cke-widget-data",encodeURIComponent(JSON.stringify(e.data)))}function w(){function e(){}function n(e,t,n){return!(!n||!this.checkElement(e))&&(e=n.widgets.getByElement(e,!0))&&e.checkStyleActive(this)}function i(e){function t(e,t,n){for(var i=e.length,a=0;a<i;){if(t.call(n,e[a],a,e))return e[a];a++}}function n(e){function t(e,n){var i=CKEDITOR.tools.object.keys(e),a=CKEDITOR.tools.object.keys(n);if(i.length!==a.length)return!1;for(var r in e)if(("object"!=typeof e[r]||"object"!=typeof n[r]||!t(e[r],n[r]))&&e[r]!==n[r])return!1;return!0}return function(n){return t(e.getDefinition(),n.getDefinition())}}var i,r=e.widget;a[r]||(a[r]={});for(var o=0,s=e.group.length;o<s;o++)i=e.group[o],a[r][i]||(a[r][i]=[]),t(i=a[r][i],n(e))||i.push(e)}var a={};CKEDITOR.style.addCustomHandler({type:"widget",setup:function(e){this.widget=e.widget,(this.group="string"==typeof e.group?[e.group]:e.group)&&i(this)},apply:function(e){var t;e instanceof CKEDITOR.editor&&this.checkApplicable(e.elementPath(),e)&&(t=e.widgets.focused,this.group&&this.removeStylesFromSameGroup(e),t.applyStyle(this))},remove:function(e){e instanceof CKEDITOR.editor&&this.checkApplicable(e.elementPath(),e)&&e.widgets.focused.removeStyle(this)},removeStylesFromSameGroup:function(e){var t,n,i=!1;if(!(e instanceof CKEDITOR.editor))return!1;if(n=e.elementPath(),this.checkApplicable(n,e))for(var r=0,o=this.group.length;r<o;r++){t=a[this.widget][this.group[r]];for(var s=0;s<t.length;s++)t[s]!==this&&t[s].checkActive(n,e)&&(e.widgets.focused.removeStyle(t[s]),i=!0)}return i},checkActive:function(e,t){return this.checkElementMatch(e.lastElement,0,t)},checkApplicable:function(e,t){return t instanceof CKEDITOR.editor&&this.checkElement(e.lastElement)},checkElementMatch:n,checkElementRemovable:n,checkElement:function(e){return!!t.isDomWidgetWrapper(e)&&(e=e.getFirst(t.isDomWidgetElement))&&e.data("widget")==this.widget},buildPreview:function(e){return e||this._.definition.name},toAllowedContentRules:function(e){if(!e)return null;var t,n={};return(e=e.widgets.registered[this.widget])?e.styleableElements?(t=this.getClassesArray())?(n[e.styleableElements]={classes:t,propertiesOnly:!0},n):null:e.styleToAllowedContentRules?e.styleToAllowedContentRules(this):null:null},getClassesArray:function(){var e=this._.definition.attributes&&this._.definition.attributes.class;return e?CKEDITOR.tools.trim(e).split(/\s+/):null},applyToRange:e,removeFromRange:e,applyToObject:e})}CKEDITOR.plugins.add("widget",{requires:"lineutils,clipboard,widgetselection",onLoad:function(){void 0!==CKEDITOR.document.$.querySelectorAll&&(CKEDITOR.addCss('.cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover>.cke_widget_element{outline:2px solid #ffd25c;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid #ffd25c}.cke_widget_wrapper.cke_widget_focused>.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #47a4f5}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:15px;height:0;display:block;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover>.cke_widget_drag_handler_container{height:15px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}.cke_editable[contenteditable="false"] .cke_widget_drag_handler_container{display:none;}img.cke_widget_drag_handler{cursor:move;width:15px;height:15px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_widget_partial_mask{position:absolute;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}'),w())},beforeInit:function(t){void 0!==CKEDITOR.document.$.querySelectorAll&&(t.widgets=new e(t))},afterInit:function(e){if(void 0!==CKEDITOR.document.$.querySelectorAll){var t,n,i,a=e.widgets.registered;for(n in a)(i=(t=a[n]).button)&&e.ui.addButton&&e.ui.addButton(CKEDITOR.tools.capitalize(t.name,!0),{label:i,command:t.name,toolbar:"insert,10"});!function(e){e.contextMenu&&e.contextMenu.addListener((function(t){if(t=e.widgets.getByElement(t,!0))return t.fire("contextMenu",{})}))}(e),function(e){e&&e.addFilterRule((function(e){return e.replace(/\s*cke_widget_selected/g,"").replace(/\s*cke_widget_focused/g,"")}))}(e.undoManager)}}}),e.prototype={MIN_SELECTION_CHECK_INTERVAL:500,add:function(e,t){var n=this.editor;if((t=CKEDITOR.tools.prototypedCopy(t)).name=e,t._=t._||{},n.fire("widgetDefinition",t),t.template&&(t.template=new CKEDITOR.template(t.template)),function(e,t){e.addCommand(t.name,{exec:function(e,n){function i(){e.widgets.finalizeCreation(s)}if((r=e.widgets.focused)&&r.name==t.name)r.edit();else if(t.insert)t.insert({editor:e,commandData:n});else if(t.template){var a,r="function"==typeof t.defaults?t.defaults():t.defaults,o=(r=CKEDITOR.tools.object.merge(r||{},n&&n.startupData||{}),r=CKEDITOR.dom.element.createFromHtml(t.template.output(r),e.document),e.widgets.wrapElement(r,t.name)),s=new CKEDITOR.dom.documentFragment(o.getDocument());s.append(o),(a=e.widgets.initOn(r,t,n&&n.startupData))?(r=a.once("edit",(function(t){t.data.dialog?a.once("dialog",(function(t){var n,r;t=t.data,n=t.once("ok",i,null,null,20),r=t.once("cancel",(function(t){t.data&&!1===t.data.hide||e.widgets.destroy(a,!0)})),t.once("hide",(function(){n.removeListener(),r.removeListener()}))})):i()}),null,null,999),a.edit(),r.removeListener()):i()}},allowedContent:t.allowedContent,requiredContent:t.requiredContent,contentForms:t.contentForms,contentTransformations:t.contentTransformations})}(n,t),function(e,t){var n=t.upcast,i=t.upcastPriority||10;n&&function(t,n,i){var a=CKEDITOR.tools.getIndex(e._.upcasts,(function(e){return e[2]>i}));0>a&&(a=e._.upcasts.length),e._.upcasts.splice(a,0,[CKEDITOR.tools.bind(t,n),n.name,i])}("string"==typeof n?function(e,n){var i,a,r=t.upcast.split(",");for(a=0;a<r.length;a++)if((i=r[a])===e.name)return t.upcasts[i].call(this,e,n);return!1}:n,t,i)}(this,t),this.registered[e]=t,t.dialog&&n.plugins.dialog)var i=CKEDITOR.on("dialogDefinition",(function(e){var a=(e=e.data.definition).dialog;e.getMode||a.getName()!==t.dialog||(e.getMode=function(){var e=a.getModel(n);return e&&e instanceof CKEDITOR.plugins.widget&&e.ready?CKEDITOR.dialog.EDITING_MODE:CKEDITOR.dialog.CREATION_MODE}),i.removeListener()}));return t},addUpcastCallback:function(e){this._.upcastCallbacks.push(e)},checkSelection:function(){if(this.editor.getSelection()){var e,n=this.editor.getSelection(),i=n.getSelectedElement(),a=g(this);if(i&&(e=this.getByElement(i,!0)))return a.focus(e).select(e).commit();if(!(n=n.getRanges()[0])||n.collapsed)return a.commit();for((n=new CKEDITOR.dom.walker(n)).evaluator=t.isDomWidgetWrapper;i=n.next();)a.select(this.getByElement(i));a.commit()}},checkWidgets:function(e){this.fire("checkWidgets",CKEDITOR.tools.copy(e||{}))},del:function(e){if(this.focused===e){var t,n=e.editor,i=n.createRange();(t=i.moveToClosestEditablePosition(e.wrapper,!0))||(t=i.moveToClosestEditablePosition(e.wrapper,!1)),t&&n.getSelection().selectRanges([i])}e.wrapper.remove(),this.destroy(e,!0)},destroy:function(e,t){this.widgetHoldingFocusedEditable===e&&h(this,e,null,t),e.destroy(t),delete this.instances[e.id],this.fire("instanceDestroyed",e)},destroyAll:function(e,t){var n,i,a=this.instances;if(t&&!e){a=(i=t.find(".cke_widget_wrapper")).count();for(var r=0;r<a;++r)(n=this.getByElement(i.getItem(r),!0))&&this.destroy(n)}else for(i in a)n=a[i],this.destroy(n,e)},finalizeCreation:function(e){(e=e.getFirst())&&t.isDomWidgetWrapper(e)&&(this.editor.insertElement(e),(e=this.getByElement(e)).ready=!0,e.fire("ready"),e.focus())},getByElement:function(){function e(e){return e.is(t)&&e.data("cke-widget-id")}var t={div:1,span:1};return function(t,n){if(!t)return null;var i=e(t);if(!n&&!i){var a=this.editor.editable();do{t=t.getParent()}while(t&&!t.equals(a)&&!(i=e(t)))}return this.instances[i]||null}}(),initOn:function(e,n,i){if(n?"string"==typeof n&&(n=this.registered[n]):n=this.registered[e.data("widget")],!n)return null;var a=this.wrapElement(e,n.name);return a?a.hasClass("cke_widget_new")?(e=new t(this,this._.nextId++,e,n,i)).isInited()?this.instances[e.id]=e:null:this.getByElement(e):null},initOnAll:function(e){for(var n,i=[],a=(e=(e||this.editor.editable()).find(".cke_widget_new")).count();a--;)(n=this.initOn(e.getItem(a).getFirst(t.isDomWidgetElement)))&&i.push(n);return i},onWidget:function(e){var t=Array.prototype.slice.call(arguments);for(var n in t.shift(),this.instances){var i=this.instances[n];i.name==e&&i.on.apply(i,t)}this.on("instanceCreated",(function(n){(n=n.data).name==e&&n.on.apply(n,t)}))},parseElementClasses:function(e){if(!e)return null;e=CKEDITOR.tools.trim(e).split(/\s+/);for(var t,n={},i=0;t=e.pop();)-1==t.indexOf("cke_")&&(n[t]=i=1);return i?n:null},wrapElement:function(e,t){var n,i,a=null;if(e instanceof CKEDITOR.dom.element){if(t=t||e.data("widget"),!(n=this.registered[t]))return null;if((a=e.getParent())&&a.type==CKEDITOR.NODE_ELEMENT&&a.data("cke-widget-wrapper"))return a;e.hasAttribute("data-cke-widget-keep-attr")||e.data("cke-widget-keep-attr",e.data("widget")?1:0),e.data("widget",t),(i=u(n,e.getName()))&&r(e),(a=new CKEDITOR.dom.element(i?"span":"div",e.getDocument())).setAttributes(d(i,t)),a.data("cke-display-name",n.pathName?n.pathName:e.getName()),e.getParent(!0)&&a.replace(e),e.appendTo(a)}else if(e instanceof CKEDITOR.htmlParser.element){if(t=t||e.attributes["data-widget"],!(n=this.registered[t]))return null;if((a=e.parent)&&a.type==CKEDITOR.NODE_ELEMENT&&a.attributes["data-cke-widget-wrapper"])return a;var o;"data-cke-widget-keep-attr"in e.attributes||(e.attributes["data-cke-widget-keep-attr"]=e.attributes["data-widget"]?1:0),t&&(e.attributes["data-widget"]=t),(i=u(n,e.name))&&r(e),(a=new CKEDITOR.htmlParser.element(i?"span":"div",d(i,t))).attributes["data-cke-display-name"]=n.pathName?n.pathName:e.name,(n=e.parent)&&(o=e.getIndex(),e.remove()),a.add(e),n&&c(n,o,a)}return a},_tests_createEditableFilter:l},CKEDITOR.event.implementOn(e.prototype),t.prototype={addClass:function(e){this.element.addClass(e),this.wrapper.addClass(t.WRAPPER_CLASS_PREFIX+e)},applyStyle:function(e){m(this,e,1)},checkStyleActive:function(e){var t;if(!(e=C(e)))return!1;for(;t=e.pop();)if(!this.hasClass(t))return!1;return!0},destroy:function(e){if(this.fire("destroy"),this.editables)for(var t in this.editables)this.destroyEditable(t,e);e||("0"==this.element.data("cke-widget-keep-attr")&&this.element.removeAttribute("data-widget"),this.element.removeAttributes(["data-cke-widget-data","data-cke-widget-keep-attr"]),this.element.removeClass("cke_widget_element"),this.element.replace(this.wrapper)),this.wrapper=null},destroyEditable:function(e,t){var n=this.editables[e],i=!0;if(n.removeListener("focus",b),n.removeListener("blur",I),this.editor.focusManager.remove(n),n.filter){for(var a in this.repository.instances){var r=this.repository.instances[a];r.editables&&(r=r.editables[e])&&r!==n&&n.filter===r.filter&&(i=!1)}i&&(n.filter.destroy(),(i=this.repository._.filters[this.name])&&delete i[e])}t||(this.repository.destroyAll(!1,n),n.removeClass("cke_widget_editable"),n.removeClass("cke_widget_editable_focused"),n.removeAttributes(["contenteditable","data-cke-widget-editable","data-cke-enter-mode"])),delete this.editables[e]},edit:function(){var e={dialog:this.dialog},t=this;return!(!1===this.fire("edit",e)||!e.dialog||(this.editor.openDialog(e.dialog,(function(e){var n,i;!1!==t.fire("dialog",e)&&(n=e.on("show",(function(){e.setupContent(t)})),i=e.on("ok",(function(){var n,i=t.on("data",(function(e){n=1,e.cancel()}),null,null,0);t.editor.fire("saveSnapshot"),e.commitContent(t),i.removeListener(),n&&(t.fire("data",t.data),t.editor.fire("saveSnapshot"))})),e.once("hide",(function(){n.removeListener(),i.removeListener()})))}),t),0))},getClasses:function(){return this.repository.parseElementClasses(this.element.getAttribute("class"))},getClipboardHtml:function(){var e=this.editor.createRange();return e.setStartBefore(this.wrapper),e.setEndAfter(this.wrapper),this.editor.editable().getHtmlFromRange(e).getHtml()},hasClass:function(e){return this.element.hasClass(e)},initEditable:function(e,t){var i=this._findOneNotNested(t.selector);return!(!i||!i.is(CKEDITOR.dtd.$editable)||(i=new n(this.editor,i,{filter:l.call(this.repository,this.name,e,t)}),this.editables[e]=i,i.setAttributes({contenteditable:"true","data-cke-widget-editable":e,"data-cke-enter-mode":i.enterMode}),i.filter&&i.data("cke-filter",i.filter.id),i.addClass("cke_widget_editable"),i.removeClass("cke_widget_editable_focused"),t.pathName&&i.data("cke-display-name",t.pathName),this.editor.focusManager.add(i),i.on("focus",b,this),CKEDITOR.env.ie&&i.on("blur",I,this),i._.initialSetData=!0,i.setData(i.getHtml()),0))},_findOneNotNested:function(e){e=this.wrapper.find(e);for(var n,i,a=0;a<e.count();a++)if(i=(n=e.getItem(a)).getAscendant(t.isDomWidgetWrapper),this.wrapper.equals(i))return n;return null},isInited:function(){return!(!this.wrapper||!this.inited)},isReady:function(){return this.isInited()&&this.ready},focus:function(){var e=this.editor.getSelection();if(e){var t=this.editor.checkDirty();e.fake(this.wrapper),!t&&this.editor.resetDirty()}this.editor.focus()},refreshMask:function(){O(this)},refreshParts:function(e){D(this,void 0===e||e)},removeClass:function(e){this.element.removeClass(e),this.wrapper.removeClass(t.WRAPPER_CLASS_PREFIX+e)},removeStyle:function(e){m(this,e,0)},setData:function(e,t){var n=this.data,i=0;if("string"==typeof e)n[e]!==t&&(n[e]=t,i=1);else{var a=e;for(e in a)n[e]!==a[e]&&(i=1,n[e]=a[e])}return i&&this.dataReady&&(x(this),this.fire("data",n)),this},setFocused:function(e){return this.wrapper[e?"addClass":"removeClass"]("cke_widget_focused"),this.fire(e?"focus":"blur"),this},setSelected:function(e){return this.wrapper[e?"addClass":"removeClass"]("cke_widget_selected"),this.fire(e?"select":"deselect"),this},updateDragHandlerPosition:function(){var e=this.editor,t=this.element.$,n=this._.dragHandlerOffset;t={x:t.offsetLeft,y:t.offsetTop-15},n&&t.x==n.x&&t.y==n.y||(n=e.checkDirty(),e.fire("lockSnapshot"),this.dragHandlerContainer.setStyles({top:t.y+"px",left:t.x+"px"}),this.dragHandlerContainer.removeStyle("display"),e.fire("unlockSnapshot"),!n&&e.resetDirty(),this._.dragHandlerOffset=t)}},CKEDITOR.event.implementOn(t.prototype),t.getNestedEditable=function(e,n){return!n||n.equals(e)?null:t.isDomNestedEditable(n)?n:t.getNestedEditable(e,n.getParent())},t.isDomDragHandler=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-drag-handler")},t.isDomDragHandlerContainer=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_widget_drag_handler_container")},t.isDomNestedEditable=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-editable")},t.isDomWidgetElement=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-widget")},t.isDomWidgetWrapper=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-wrapper")},t.isDomWidget=function(e){return!!e&&(this.isDomWidgetWrapper(e)||this.isDomWidgetElement(e))},t.isParserWidgetElement=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&!!e.attributes["data-widget"]},t.isParserWidgetWrapper=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&!!e.attributes["data-cke-widget-wrapper"]},t.WRAPPER_CLASS_PREFIX="cke_widget_wrapper_",n.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.dom.element.prototype),{setData:function(e){this._.initialSetData||this.editor.widgets.destroyAll(!1,this),this._.initialSetData=!1,e=this.editor.dataProcessor.unprotectRealComments(e),e=this.editor.dataProcessor.unprotectSource(e),e=this.editor.dataProcessor.toHtml(e,{context:this.getName(),filter:this.filter,enterMode:this.enterMode}),this.setHtml(e),this.editor.widgets.initOnAll(this)},getData:function(){return this.editor.dataProcessor.toDataFormat(this.getHtml(),{context:this.getName(),filter:this.filter,enterMode:this.enterMode})}});var k=/^(?:<(?:div|span)(?: data-cke-temp="1")?(?: id="cke_copybin")?(?: data-cke-temp="1")?>)?(?:<(?:div|span)(?: style="[^"]+")?>)?<span [^>]*data-cke-copybin-start="1"[^>]*>.?<\/span>([\s\S]+)<span [^>]*data-cke-copybin-end="1"[^>]*>.?<\/span>(?:<\/(?:div|span)>)?(?:<\/(?:div|span)>)?$/i,K={37:1,38:1,39:1,40:1,8:1,46:1};K[CKEDITOR.SHIFT+121]=1;var N=CKEDITOR.tools.createClass({$:function(e,t){this._.createCopyBin(e,t),this._.createListeners(t)},_:{createCopyBin:function(e){var t=e.document,n=CKEDITOR.env.edge&&16<=CKEDITOR.env.version,i=!e.blockless&&!CKEDITOR.env.ie||n?"div":"span";n=t.createElement(i),(t=t.createElement(i)).setAttributes({id:"cke_copybin","data-cke-temp":"1"}),n.setStyles({position:"absolute",width:"1px",height:"1px",overflow:"hidden"}),n.setStyle("ltr"==e.config.contentsLangDirection?"left":"right","-5000px"),this.editor=e,this.copyBin=n,this.container=t},createListeners:function(e){e&&(e.beforeDestroy&&(this.beforeDestroy=e.beforeDestroy),e.afterDestroy&&(this.afterDestroy=e.afterDestroy))}},proto:{handle:function(e){var t,n,i,a=this.copyBin,r=this.editor,o=this.container,s=CKEDITOR.env.ie&&9>CKEDITOR.env.version,l=r.document.getDocumentElement().$,d=r.createRange(),c=this,u=CKEDITOR.env.mac&&CKEDITOR.env.webkit,f=u?100:0,h=window.requestAnimationFrame&&!u?requestAnimationFrame:setTimeout;return a.setHtml('<span data-cke-copybin-start="1">​</span>'+e+'<span data-cke-copybin-end="1">​</span>'),r.fire("lockSnapshot"),o.append(a),r.editable().append(o),t=r.on("selectionChange",v,null,null,0),n=r.widgets.on("checkSelection",v,null,null,0),s&&(i=l.scrollTop),d.selectNodeContents(a),d.select(),s&&(l.scrollTop=i),new CKEDITOR.tools.promise((function(e){h((function(){c.beforeDestroy&&c.beforeDestroy(),o.remove(),t.removeListener(),n.removeListener(),r.fire("unlockSnapshot"),c.afterDestroy&&c.afterDestroy(),e()}),f)}))}},statics:{hasCopyBin:function(e){return!!N.getCopyBin(e)},getCopyBin:function(e){return e.document.getById("cke_copybin")}}});CKEDITOR.plugins.widget=t,t.repository=e,t.nestedEditable=n}(),CKEDITOR.config.widget_keystrokeInsertLineBefore=CKEDITOR.SHIFT+CKEDITOR.ALT+13,CKEDITOR.config.widget_keystrokeInsertLineAfter=CKEDITOR.SHIFT+13,CKEDITOR.config.plugins="dialogui,dialog,notification,button,toolbar,clipboard,confighelper,entities,undo,lineutils,widgetselection,widget",CKEDITOR.config.skin="minimalist",function(){var e=function(e,t){var n=CKEDITOR.getUrl("plugins/"+t);e=e.split(",");for(var i=0;i<e.length;i++)CKEDITOR.skin.icons[e[i]]={path:n,offset:-e[++i],bgsize:e[++i]}};CKEDITOR.env.hidpi?e("about,0,,bold,24,,italic,48,,strike,72,,subscript,96,,superscript,120,,underline,144,,bidiltr,168,,bidirtl,192,,blockquote,216,,copy-rtl,240,,copy,264,,cut-rtl,288,,cut,312,,paste-rtl,336,,paste,360,,codesnippet,384,,bgcolor,408,,textcolor,432,,copyformatting,456,,creatediv,480,,docprops-rtl,504,,docprops,528,,easyimagealigncenter,552,,easyimagealignleft,576,,easyimagealignright,600,,easyimagealt,624,,easyimagefull,648,,easyimageside,672,,easyimageupload,696,,embed,720,,embedsemantic,744,,emojipanel,768,,find-rtl,792,,find,816,,replace,840,,button,864,,checkbox,888,,form,912,,hiddenfield,936,,imagebutton,960,,radio,984,,select-rtl,1008,,select,1032,,textarea-rtl,1056,,textarea,1080,,textfield-rtl,1104,,textfield,1128,,horizontalrule,1152,,iframe,1176,,image,1200,,indent-rtl,1224,,indent,1248,,outdent-rtl,1272,,outdent,1296,,justifyblock,1320,,justifycenter,1344,,justifyleft,1368,,justifyright,1392,,language,1416,,anchor-rtl,1440,,anchor,1464,,link,1488,,unlink,1512,,bulletedlist-rtl,1536,,bulletedlist,1560,,numberedlist-rtl,1584,,numberedlist,1608,,mathjax,1632,,maximize,1656,,newpage-rtl,1680,,newpage,1704,,pagebreak-rtl,1728,,pagebreak,1752,,pastefromword-rtl,1776,,pastefromword,1800,,pastetext-rtl,1824,,pastetext,1848,,placeholder,1872,,preview-rtl,1896,,preview,1920,,print,1944,,removeformat,1968,,save,1992,,selectall,2016,,showblocks-rtl,2040,,showblocks,2064,,smiley,2088,,source-rtl,2112,,source,2136,,sourcedialog-rtl,2160,,sourcedialog,2184,,specialchar,2208,,table,2232,,templates-rtl,2256,,templates,2280,,uicolor,2304,,redo-rtl,2328,,redo,2352,,undo-rtl,2376,,undo,2400,,simplebox,4848,auto","icons_hidpi.png"):e("about,0,auto,bold,24,auto,italic,48,auto,strike,72,auto,subscript,96,auto,superscript,120,auto,underline,144,auto,bidiltr,168,auto,bidirtl,192,auto,blockquote,216,auto,copy-rtl,240,auto,copy,264,auto,cut-rtl,288,auto,cut,312,auto,paste-rtl,336,auto,paste,360,auto,codesnippet,384,auto,bgcolor,408,auto,textcolor,432,auto,copyformatting,456,auto,creatediv,480,auto,docprops-rtl,504,auto,docprops,528,auto,easyimagealigncenter,552,auto,easyimagealignleft,576,auto,easyimagealignright,600,auto,easyimagealt,624,auto,easyimagefull,648,auto,easyimageside,672,auto,easyimageupload,696,auto,embed,720,auto,embedsemantic,744,auto,emojipanel,768,auto,find-rtl,792,auto,find,816,auto,replace,840,auto,button,864,auto,checkbox,888,auto,form,912,auto,hiddenfield,936,auto,imagebutton,960,auto,radio,984,auto,select-rtl,1008,auto,select,1032,auto,textarea-rtl,1056,auto,textarea,1080,auto,textfield-rtl,1104,auto,textfield,1128,auto,horizontalrule,1152,auto,iframe,1176,auto,image,1200,auto,indent-rtl,1224,auto,indent,1248,auto,outdent-rtl,1272,auto,outdent,1296,auto,justifyblock,1320,auto,justifycenter,1344,auto,justifyleft,1368,auto,justifyright,1392,auto,language,1416,auto,anchor-rtl,1440,auto,anchor,1464,auto,link,1488,auto,unlink,1512,auto,bulletedlist-rtl,1536,auto,bulletedlist,1560,auto,numberedlist-rtl,1584,auto,numberedlist,1608,auto,mathjax,1632,auto,maximize,1656,auto,newpage-rtl,1680,auto,newpage,1704,auto,pagebreak-rtl,1728,auto,pagebreak,1752,auto,pastefromword-rtl,1776,auto,pastefromword,1800,auto,pastetext-rtl,1824,auto,pastetext,1848,auto,placeholder,1872,auto,preview-rtl,1896,auto,preview,1920,auto,print,1944,auto,removeformat,1968,auto,save,1992,auto,selectall,2016,auto,showblocks-rtl,2040,auto,showblocks,2064,auto,smiley,2088,auto,source-rtl,2112,auto,source,2136,auto,sourcedialog-rtl,2160,auto,sourcedialog,2184,auto,specialchar,2208,auto,table,2232,auto,templates-rtl,2256,auto,templates,2280,auto,uicolor,2304,auto,redo-rtl,2328,auto,redo,2352,auto,undo-rtl,2376,auto,undo,2400,auto,simplebox,2424,auto","icons.png")}(),CKEDITOR.lang.languages={en:1}),e.exports=CKEDITOR},9537:function(e){function t(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var n=-1;t.Diff,t.prototype.diff_main=function(e,t,n,i){void 0===i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var a=i;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[0,e]]:[];void 0===n&&(n=!0);var r=n,o=this.diff_commonPrefix(e,t),s=e.substring(0,o);e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var l=e.substring(e.length-o);e=e.substring(0,e.length-o),t=t.substring(0,t.length-o);var d=this.diff_compute_(e,t,r,a);return s&&d.unshift([0,s]),l&&d.push([0,l]),this.diff_cleanupMerge(d),d},t.prototype.diff_compute_=function(e,t,i,a){var r;if(!e)return[[1,t]];if(!t)return[[n,e]];var o=e.length>t.length?e:t,s=e.length>t.length?t:e,l=o.indexOf(s);if(-1!=l)return r=[[1,o.substring(0,l)],[0,s],[1,o.substring(l+s.length)]],e.length>t.length&&(r[0][0]=r[2][0]=n),r;if(1==s.length)return[[n,e],[1,t]];var d=this.diff_halfMatch_(e,t);if(d){var c=d[0],u=d[1],f=d[2],h=d[3],p=d[4],g=this.diff_main(c,f,i,a),m=this.diff_main(u,h,i,a);return g.concat([[0,p]],m)}return i&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,a):this.diff_bisect_(e,t,a)},t.prototype.diff_lineMode_=function(e,t,i){e=(u=this.diff_linesToChars_(e,t)).chars1,t=u.chars2;var a=u.lineArray,r=this.diff_main(e,t,!1,i);this.diff_charsToLines_(r,a),this.diff_cleanupSemantic(r),r.push([0,""]);for(var o=0,s=0,l=0,d="",c="";o<r.length;){switch(r[o][0]){case 1:l++,c+=r[o][1];break;case n:s++,d+=r[o][1];break;case 0:if(s>=1&&l>=1){r.splice(o-s-l,s+l),o=o-s-l;for(var u,f=(u=this.diff_main(d,c,!1,i)).length-1;f>=0;f--)r.splice(o,0,u[f]);o+=u.length}l=0,s=0,d="",c=""}o++}return r.pop(),r},t.prototype.diff_bisect_=function(e,t,i){for(var a=e.length,r=t.length,o=Math.ceil((a+r)/2),s=o,l=2*o,d=new Array(l),c=new Array(l),u=0;u<l;u++)d[u]=-1,c[u]=-1;d[s+1]=0,c[s+1]=0;for(var f=a-r,h=f%2!=0,p=0,g=0,m=0,v=0,E=0;E<o&&!((new Date).getTime()>i);E++){for(var T=-E+p;T<=E-g;T+=2){for(var C=s+T,I=(R=T==-E||T!=E&&d[C-1]<d[C+1]?d[C+1]:d[C-1]+1)-T;R<a&&I<r&&e.charAt(R)==t.charAt(I);)R++,I++;if(d[C]=R,R>a)g+=2;else if(I>r)p+=2;else if(h&&(D=s+f-T)>=0&&D<l&&-1!=c[D]&&R>=(y=a-c[D]))return this.diff_bisectSplit_(e,t,R,I,i)}for(var b=-E+m;b<=E-v;b+=2){for(var y,D=s+b,O=(y=b==-E||b!=E&&c[D-1]<c[D+1]?c[D+1]:c[D-1]+1)-b;y<a&&O<r&&e.charAt(a-y-1)==t.charAt(r-O-1);)y++,O++;if(c[D]=y,y>a)v+=2;else if(O>r)m+=2;else if(!h){var R;if((C=s+f-b)>=0&&C<l&&-1!=d[C])if(I=s+(R=d[C])-C,R>=(y=a-y))return this.diff_bisectSplit_(e,t,R,I,i)}}}return[[n,e],[1,t]]},t.prototype.diff_bisectSplit_=function(e,t,n,i,a){var r=e.substring(0,n),o=t.substring(0,i),s=e.substring(n),l=t.substring(i),d=this.diff_main(r,o,!1,a),c=this.diff_main(s,l,!1,a);return d.concat(c)},t.prototype.diff_linesToChars_=function(e,t){var n=[],i={};function a(e){for(var t="",a=0,r=-1,o=n.length;r<e.length-1;){-1==(r=e.indexOf("\n",a))&&(r=e.length-1);var s=e.substring(a,r+1);a=r+1,(i.hasOwnProperty?i.hasOwnProperty(s):void 0!==i[s])?t+=String.fromCharCode(i[s]):(t+=String.fromCharCode(o),i[s]=o,n[o++]=s)}return t}return n[0]="",{chars1:a(e),chars2:a(t),lineArray:n}},t.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],a=[],r=0;r<i.length;r++)a[r]=t[i.charCodeAt(r)];e[n][1]=a.join("")}},t.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),a=i,r=0;n<a;)e.substring(r,a)==t.substring(r,a)?r=n=a:i=a,a=Math.floor((i-n)/2+n);return a},t.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),a=i,r=0;n<a;)e.substring(e.length-a,e.length-r)==t.substring(t.length-a,t.length-r)?r=n=a:i=a,a=Math.floor((i-n)/2+n);return a},t.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):n<i&&(t=t.substring(0,n));var a=Math.min(n,i);if(e==t)return a;for(var r=0,o=1;;){var s=e.substring(a-o),l=t.indexOf(s);if(-1==l)return r;o+=l,0!=l&&e.substring(a-o)!=t.substring(0,o)||(r=o,o++)}},t.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,i=e.length>t.length?t:e;if(n.length<4||2*i.length<n.length)return null;var a=this;function r(e,t,n){for(var i,r,o,s,l=e.substring(n,n+Math.floor(e.length/4)),d=-1,c="";-1!=(d=t.indexOf(l,d+1));){var u=a.diff_commonPrefix(e.substring(n),t.substring(d)),f=a.diff_commonSuffix(e.substring(0,n),t.substring(0,d));c.length<f+u&&(c=t.substring(d-f,d)+t.substring(d,d+u),i=e.substring(0,n-f),r=e.substring(n+u),o=t.substring(0,d-f),s=t.substring(d+u))}return 2*c.length>=e.length?[i,r,o,s,c]:null}var o,s,l,d,c,u=r(n,i,Math.ceil(n.length/4)),f=r(n,i,Math.ceil(n.length/2));return u||f?(o=f?u&&u[4].length>f[4].length?u:f:u,e.length>t.length?(s=o[0],l=o[1],d=o[2],c=o[3]):(d=o[0],c=o[1],s=o[2],l=o[3]),[s,l,d,c,o[4]]):null},t.prototype.diff_cleanupSemantic=function(e){for(var t=!1,i=[],a=0,r=null,o=0,s=0,l=0,d=0,c=0;o<e.length;)0==e[o][0]?(i[a++]=o,s=d,l=c,d=0,c=0,r=e[o][1]):(1==e[o][0]?d+=e[o][1].length:c+=e[o][1].length,r&&r.length<=Math.max(s,l)&&r.length<=Math.max(d,c)&&(e.splice(i[a-1],0,[n,r]),e[i[a-1]+1][0]=1,a--,o=--a>0?i[a-1]:-1,s=0,l=0,d=0,c=0,r=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;){if(e[o-1][0]==n&&1==e[o][0]){var u=e[o-1][1],f=e[o][1],h=this.diff_commonOverlap_(u,f),p=this.diff_commonOverlap_(f,u);h>=p?(h>=u.length/2||h>=f.length/2)&&(e.splice(o,0,[0,f.substring(0,h)]),e[o-1][1]=u.substring(0,u.length-h),e[o+1][1]=f.substring(h),o++):(p>=u.length/2||p>=f.length/2)&&(e.splice(o,0,[0,u.substring(0,p)]),e[o-1][0]=1,e[o-1][1]=f.substring(0,f.length-p),e[o+1][0]=n,e[o+1][1]=u.substring(p),o++),o++}o++}},t.prototype.diff_cleanupSemanticLossless=function(e){function n(e,n){if(!e||!n)return 6;var i=e.charAt(e.length-1),a=n.charAt(0),r=i.match(t.nonAlphaNumericRegex_),o=a.match(t.nonAlphaNumericRegex_),s=r&&i.match(t.whitespaceRegex_),l=o&&a.match(t.whitespaceRegex_),d=s&&i.match(t.linebreakRegex_),c=l&&a.match(t.linebreakRegex_),u=d&&e.match(t.blanklineEndRegex_),f=c&&n.match(t.blanklineStartRegex_);return u||f?5:d||c?4:r&&!s&&l?3:s||l?2:r||o?1:0}for(var i=1;i<e.length-1;){if(0==e[i-1][0]&&0==e[i+1][0]){var a=e[i-1][1],r=e[i][1],o=e[i+1][1],s=this.diff_commonSuffix(a,r);if(s){var l=r.substring(r.length-s);a=a.substring(0,a.length-s),r=l+r.substring(0,r.length-s),o=l+o}for(var d=a,c=r,u=o,f=n(a,r)+n(r,o);r.charAt(0)===o.charAt(0);){a+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);var h=n(a,r)+n(r,o);h>=f&&(f=h,d=a,c=r,u=o)}e[i-1][1]!=d&&(d?e[i-1][1]=d:(e.splice(i-1,1),i--),e[i][1]=c,u?e[i+1][1]=u:(e.splice(i+1,1),i--))}i++}},t.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,t.whitespaceRegex_=/\s/,t.linebreakRegex_=/[\r\n]/,t.blanklineEndRegex_=/\n\r?\n$/,t.blanklineStartRegex_=/^\r?\n\r?\n/,t.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,i=[],a=0,r=null,o=0,s=!1,l=!1,d=!1,c=!1;o<e.length;)0==e[o][0]?(e[o][1].length<this.Diff_EditCost&&(d||c)?(i[a++]=o,s=d,l=c,r=e[o][1]):(a=0,r=null),d=c=!1):(e[o][0]==n?c=!0:d=!0,r&&(s&&l&&d&&c||r.length<this.Diff_EditCost/2&&s+l+d+c==3)&&(e.splice(i[a-1],0,[n,r]),e[i[a-1]+1][0]=1,a--,r=null,s&&l?(d=c=!0,a=0):(o=--a>0?i[a-1]:-1,d=c=!1),t=!0)),o++;t&&this.diff_cleanupMerge(e)},t.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,i=0,a=0,r=0,o="",s="";i<e.length;)switch(e[i][0]){case 1:r++,s+=e[i][1],i++;break;case n:a++,o+=e[i][1],i++;break;case 0:a+r>1?(0!==a&&0!==r&&(0!==(t=this.diff_commonPrefix(s,o))&&(i-a-r>0&&0==e[i-a-r-1][0]?e[i-a-r-1][1]+=s.substring(0,t):(e.splice(0,0,[0,s.substring(0,t)]),i++),s=s.substring(t),o=o.substring(t)),0!==(t=this.diff_commonSuffix(s,o))&&(e[i][1]=s.substring(s.length-t)+e[i][1],s=s.substring(0,s.length-t),o=o.substring(0,o.length-t))),0===a?e.splice(i-r,a+r,[1,s]):0===r?e.splice(i-a,a+r,[n,o]):e.splice(i-a-r,a+r,[n,o],[1,s]),i=i-a-r+(a?1:0)+(r?1:0)+1):0!==i&&0==e[i-1][0]?(e[i-1][1]+=e[i][1],e.splice(i,1)):i++,r=0,a=0,o="",s=""}""===e[e.length-1][1]&&e.pop();var l=!1;for(i=1;i<e.length-1;)0==e[i-1][0]&&0==e[i+1][0]&&(e[i][1].substring(e[i][1].length-e[i-1][1].length)==e[i-1][1]?(e[i][1]=e[i-1][1]+e[i][1].substring(0,e[i][1].length-e[i-1][1].length),e[i+1][1]=e[i-1][1]+e[i+1][1],e.splice(i-1,1),l=!0):e[i][1].substring(0,e[i+1][1].length)==e[i+1][1]&&(e[i-1][1]+=e[i+1][1],e[i][1]=e[i][1].substring(e[i+1][1].length)+e[i+1][1],e.splice(i+1,1),l=!0)),i++;l&&this.diff_cleanupMerge(e)},t.prototype.diff_xIndex=function(e,t){var i,a=0,r=0,o=0,s=0;for(i=0;i<e.length&&(1!==e[i][0]&&(a+=e[i][1].length),e[i][0]!==n&&(r+=e[i][1].length),!(a>t));i++)o=a,s=r;return e.length!=i&&e[i][0]===n?s:s+(t-o)},t.prototype.diff_prettyHtml=function(e){for(var t=[],i=/&/g,a=/</g,r=/>/g,o=/\n/g,s=0;s<e.length;s++){var l=e[s][0],d=e[s][1].replace(i,"&amp;").replace(a,"&lt;").replace(r,"&gt;").replace(o,"&para;<br>");switch(l){case 1:t[s]='<ins style="background:#e6ffe6;">'+d+"</ins>";break;case n:t[s]='<del style="background:#ffe6e6;">'+d+"</del>";break;case 0:t[s]="<span>"+d+"</span>"}}return t.join("")},t.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},t.prototype.diff_text2=function(e){for(var t=[],i=0;i<e.length;i++)e[i][0]!==n&&(t[i]=e[i][1]);return t.join("")},t.prototype.diff_levenshtein=function(e){for(var t=0,i=0,a=0,r=0;r<e.length;r++){var o=e[r][0],s=e[r][1];switch(o){case 1:i+=s.length;break;case n:a+=s.length;break;case 0:t+=Math.max(i,a),i=0,a=0}}return t+Math.max(i,a)},t.prototype.diff_toDelta=function(e){for(var t=[],i=0;i<e.length;i++)switch(e[i][0]){case 1:t[i]="+"+encodeURI(e[i][1]);break;case n:t[i]="-"+e[i][1].length;break;case 0:t[i]="="+e[i][1].length}return t.join("\t").replace(/%20/g," ")},t.prototype.diff_fromDelta=function(e,t){for(var i=[],a=0,r=0,o=t.split(/\t/g),s=0;s<o.length;s++){var l=o[s].substring(1);switch(o[s].charAt(0)){case"+":try{i[a++]=[1,decodeURI(l)]}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var d=parseInt(l,10);if(isNaN(d)||d<0)throw new Error("Invalid number in diff_fromDelta: "+l);var c=e.substring(r,r+=d);"="==o[s].charAt(0)?i[a++]=[0,c]:i[a++]=[n,c];break;default:if(o[s])throw new Error("Invalid diff operation in diff_fromDelta: "+o[s])}}if(r!=e.length)throw new Error("Delta length ("+r+") does not equal source text length ("+e.length+").");return i},t.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},t.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(t),a=this;function r(e,i){var r=e/t.length,o=Math.abs(n-i);return a.Match_Distance?r+o/a.Match_Distance:o?1:r}var o=this.Match_Threshold,s=e.indexOf(t,n);-1!=s&&(o=Math.min(r(0,s),o),-1!=(s=e.lastIndexOf(t,n+t.length))&&(o=Math.min(r(0,s),o)));var l,d,c=1<<t.length-1;s=-1;for(var u,f=t.length+e.length,h=0;h<t.length;h++){for(l=0,d=f;l<d;)r(h,n+d)<=o?l=d:f=d,d=Math.floor((f-l)/2+l);f=d;var p=Math.max(1,n-d+1),g=Math.min(n+d,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<h)-1;for(var v=g;v>=p;v--){var E=i[e.charAt(v-1)];if(m[v]=0===h?(m[v+1]<<1|1)&E:(m[v+1]<<1|1)&E|(u[v+1]|u[v])<<1|1|u[v+1],m[v]&c){var T=r(h,v-1);if(T<=o){if(o=T,!((s=v-1)>n))break;p=Math.max(1,2*n-s)}}}if(r(h+1,n)>o)break;u=m}return s},t.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},t.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),i=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=t.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin;var a=t.substring(e.start2-i,e.start2);a&&e.diffs.unshift([0,a]);var r=t.substring(e.start2+e.length1,e.start2+e.length1+i);r&&e.diffs.push([0,r]),e.start1-=a.length,e.start2-=a.length,e.length1+=a.length+r.length,e.length2+=a.length+r.length}},t.prototype.patch_make=function(e,i,a){var r,o;if("string"==typeof e&&"string"==typeof i&&void 0===a)r=e,(o=this.diff_main(r,i,!0)).length>2&&(this.diff_cleanupSemantic(o),this.diff_cleanupEfficiency(o));else if(e&&"object"==typeof e&&void 0===i&&void 0===a)o=e,r=this.diff_text1(o);else if("string"==typeof e&&i&&"object"==typeof i&&void 0===a)r=e,o=i;else{if("string"!=typeof e||"string"!=typeof i||!a||"object"!=typeof a)throw new Error("Unknown call format to patch_make.");r=e,o=a}if(0===o.length)return[];for(var s=[],l=new t.patch_obj,d=0,c=0,u=0,f=r,h=r,p=0;p<o.length;p++){var g=o[p][0],m=o[p][1];switch(d||0===g||(l.start1=c,l.start2=u),g){case 1:l.diffs[d++]=o[p],l.length2+=m.length,h=h.substring(0,u)+m+h.substring(u);break;case n:l.length1+=m.length,l.diffs[d++]=o[p],h=h.substring(0,u)+h.substring(u+m.length);break;case 0:m.length<=2*this.Patch_Margin&&d&&o.length!=p+1?(l.diffs[d++]=o[p],l.length1+=m.length,l.length2+=m.length):m.length>=2*this.Patch_Margin&&d&&(this.patch_addContext_(l,f),s.push(l),l=new t.patch_obj,d=0,f=h,c=u)}1!==g&&(c+=m.length),g!==n&&(u+=m.length)}return d&&(this.patch_addContext_(l,f),s.push(l)),s},t.prototype.patch_deepCopy=function(e){for(var n=[],i=0;i<e.length;i++){var a=e[i],r=new t.patch_obj;r.diffs=[];for(var o=0;o<a.diffs.length;o++)r.diffs[o]=a.diffs[o].slice();r.start1=a.start1,r.start2=a.start2,r.length1=a.length1,r.length2=a.length2,n[i]=r}return n},t.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var i=this.patch_addPadding(e);t=i+t+i,this.patch_splitMax(e);for(var a=0,r=[],o=0;o<e.length;o++){var s,l,d=e[o].start2+a,c=this.diff_text1(e[o].diffs),u=-1;if(c.length>this.Match_MaxBits?-1!=(s=this.match_main(t,c.substring(0,this.Match_MaxBits),d))&&(-1==(u=this.match_main(t,c.substring(c.length-this.Match_MaxBits),d+c.length-this.Match_MaxBits))||s>=u)&&(s=-1):s=this.match_main(t,c,d),-1==s)r[o]=!1,a-=e[o].length2-e[o].length1;else if(r[o]=!0,a=s-d,c==(l=-1==u?t.substring(s,s+c.length):t.substring(s,u+this.Match_MaxBits)))t=t.substring(0,s)+this.diff_text2(e[o].diffs)+t.substring(s+c.length);else{var f=this.diff_main(c,l,!1);if(c.length>this.Match_MaxBits&&this.diff_levenshtein(f)/c.length>this.Patch_DeleteThreshold)r[o]=!1;else{this.diff_cleanupSemanticLossless(f);for(var h,p=0,g=0;g<e[o].diffs.length;g++){var m=e[o].diffs[g];0!==m[0]&&(h=this.diff_xIndex(f,p)),1===m[0]?t=t.substring(0,s+h)+m[1]+t.substring(s+h):m[0]===n&&(t=t.substring(0,s+h)+t.substring(s+this.diff_xIndex(f,p+m[1].length))),m[0]!==n&&(p+=m[1].length)}}}}return[t=t.substring(i.length,t.length-i.length),r]},t.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",i=1;i<=t;i++)n+=String.fromCharCode(i);for(i=0;i<e.length;i++)e[i].start1+=t,e[i].start2+=t;var a=e[0],r=a.diffs;if(0==r.length||0!=r[0][0])r.unshift([0,n]),a.start1-=t,a.start2-=t,a.length1+=t,a.length2+=t;else if(t>r[0][1].length){var o=t-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],a.start1-=o,a.start2-=o,a.length1+=o,a.length2+=o}return 0==(r=(a=e[e.length-1]).diffs).length||0!=r[r.length-1][0]?(r.push([0,n]),a.length1+=t,a.length2+=t):t>r[r.length-1][1].length&&(o=t-r[r.length-1][1].length,r[r.length-1][1]+=n.substring(0,o),a.length1+=o,a.length2+=o),n},t.prototype.patch_splitMax=function(e){for(var i=this.Match_MaxBits,a=0;a<e.length;a++)if(!(e[a].length1<=i)){var r=e[a];e.splice(a--,1);for(var o=r.start1,s=r.start2,l="";0!==r.diffs.length;){var d=new t.patch_obj,c=!0;for(d.start1=o-l.length,d.start2=s-l.length,""!==l&&(d.length1=d.length2=l.length,d.diffs.push([0,l]));0!==r.diffs.length&&d.length1<i-this.Patch_Margin;){var u=r.diffs[0][0],f=r.diffs[0][1];1===u?(d.length2+=f.length,s+=f.length,d.diffs.push(r.diffs.shift()),c=!1):u===n&&1==d.diffs.length&&0==d.diffs[0][0]&&f.length>2*i?(d.length1+=f.length,o+=f.length,c=!1,d.diffs.push([u,f]),r.diffs.shift()):(f=f.substring(0,i-d.length1-this.Patch_Margin),d.length1+=f.length,o+=f.length,0===u?(d.length2+=f.length,s+=f.length):c=!1,d.diffs.push([u,f]),f==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(f.length))}l=(l=this.diff_text2(d.diffs)).substring(l.length-this.Patch_Margin);var h=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==h&&(d.length1+=h.length,d.length2+=h.length,0!==d.diffs.length&&0===d.diffs[d.diffs.length-1][0]?d.diffs[d.diffs.length-1][1]+=h:d.diffs.push([0,h])),c||e.splice(++a,0,d)}}},t.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},t.prototype.patch_fromText=function(e){var i=[];if(!e)return i;for(var a=e.split("\n"),r=0,o=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<a.length;){var s=a[r].match(o);if(!s)throw new Error("Invalid patch string: "+a[r]);var l=new t.patch_obj;for(i.push(l),l.start1=parseInt(s[1],10),""===s[2]?(l.start1--,l.length1=1):"0"==s[2]?l.length1=0:(l.start1--,l.length1=parseInt(s[2],10)),l.start2=parseInt(s[3],10),""===s[4]?(l.start2--,l.length2=1):"0"==s[4]?l.length2=0:(l.start2--,l.length2=parseInt(s[4],10)),r++;r<a.length;){var d=a[r].charAt(0);try{var c=decodeURI(a[r].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+c)}if("-"==d)l.diffs.push([n,c]);else if("+"==d)l.diffs.push([1,c]);else if(" "==d)l.diffs.push([0,c]);else{if("@"==d)break;if(""!==d)throw new Error('Invalid patch mode "'+d+'" in: '+c)}r++}}return i},t.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},t.patch_obj.prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],i=0;i<this.diffs.length;i++){switch(this.diffs[i][0]){case 1:e="+";break;case n:e="-";break;case 0:e=" "}t[i+1]=e+encodeURI(this.diffs[i][1])+"\n"}return t.join("").replace(/%20/g," ")},this.diff_match_patch=t,this.DIFF_DELETE=n,this.DIFF_INSERT=1,this.DIFF_EQUAL=0,e.exports=t},5156:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var i=n(5072),a=n.n(i),r=n(7825),o=n.n(r),s=n(7659),l=n.n(s),d=n(5056),c=n.n(d),u=n(540),f=n.n(u),h=n(1113),p=n.n(h),g=n(5311),m={};m.styleTagTransform=p(),m.setAttributes=c(),m.insert=l().bind(null,"head"),m.domAPI=o(),m.insertStyleElement=f(),a()(g.A,m);const v=g.A&&g.A.locals?g.A.locals:void 0},939:(e,t,n)=>{var i,a;i=[n(3946),n(561),n(4459),n(3578),n(8094),n(7724),n(1877)],void 0===(a=function(e,t,n,i,a,r){var o={};function s(t,n,o){var s=n.form;return{at:t,displayTpl:r,insertTpl:o.insertTpl,limit:10,maxLen:30,startWithSpace:!1,tabSelectsMatch:o.tabSelectsMatch,callbacks:{matcher:function(e,t){var n;return(n=new RegExp("([\\s​]+|^)"+RegExp.escape(e)+"([\\w/-]*)$","gi").exec(t))?n[2]:null},filter:function(t,i,a){return r=t?s.fuse.search(t):s.fuse.list(),e.filter(r,(function(t){return n.ufid!==t.id&&t.name&&!e.isUndefined(t.displayLabel)}));var r},sorter:function(t,n,i){return e.map(n,(function(e,t){return e.atwho_order=t,e}))},beforeInsert:function(e,t){var n=a.getReferenceName(e);return i.usage(n,"Autocomplete",o.property),e},afterMatchFailed:function(e,t){if(o.useRichText&&t.html()){var n=t.html().trim().replace(/^.*\s/,""),i=s.isValidHashtag(n)||s.hasValidHashtagPrefix(n);i&&o.functionOverrides.insert.call(this,n);var a=this._unwrap(t.text(t.text()).contents().first());i||this._setRange("after",a)}return!1}},functionOverrides:o.functionOverrides}}return o.autocomplete=function(e,t,n){t.form.vellum.data.atwho&&(n&&n.choices?o._dropdownAutocomplete(e,n.choices):o._questionAutocomplete(e,t,n),t.on("teardown-mug-properties",(function(){e.data("atwho")&&e.atwho("destroy")}),null,"teardown-mug-properties"))},o._dropdownAutocomplete=function(i,a){var r={at:"",data:a,limit:10,maxLen:1/0,suffix:"",tabSelectsMatch:!1,callbacks:{filter:function(t,n,i){return e.filter(n,(function(e){return-1!==e.name.indexOf(t)}))},matcher:function(e,t,n){return i.val()},beforeInsert:function(e,t){i.data("selected-value",e)}}};i.one("focus",(function(){i.atwho(r).on("inserted.atwho",(function(e,a,r){t(this).find(".atwho-inserted").children().unwrap(),i.attr("contenteditable")?n.editor(i).setValue(i.data("selected-value")).change():i.val(i.data("selected-value")).change()}))}))},o._questionAutocomplete=function(i,a,r){function o(){i.one("focus",(function(){i.atwho(s(a.form.getBasePath(),a,r)),r.useHashtags&&i.atwho(s("#",a,r))}))}(r=e.defaults(r||{},{insertTpl:"${name}",property:"",outputValue:!1,useRichText:!1,useHashtags:!1,tabSelectsMatch:!1,functionOverrides:{}})).useRichText&&(r.useHashtags=!0,r.functionOverrides.insert=function(e,t){this.query.el.remove(),n.editor(i).insertExpression(e),this.$inputor.is(":focus")||this.$inputor.focus()}),r.useHashtags&&(r.insertTpl="${hashtagPath}"),o(),i.on("inserted.atwho",(function(e,n,i){t(this).find(".atwho-inserted").children().unwrap()})),a.form.on("change-display-language",(function(){i.data("atwho")&&(i.atwho("destroy"),o())}))},t.vellum.plugin("atwho",{},{}),o}.apply(t,i))||(e.exports=a)},579:(e,t,n)=>{var i,a;i=[n(561),n(3946)],void 0===(a=function(e,t,n){var i=["core","intents","javaRosa","lock","ignore","uploader","windowManager","copyPaste","commander"];function a(e,t,i){if("init"!==i||"core"===e)if(0!==i.indexOf("_"))t.plugin=e,t.old=this[i],this[i]=function(){var e=t,n=Array.prototype.slice.call(arguments),i=this.__callOld;this.__callOld=function(){return e.old.apply(this,arguments.length?Array.prototype.slice.call(arguments):n)};try{return e.apply(this,n)}finally{this.__callOld=i}},this[i].old=t.old,this[i].plugin=e;else{if(this[i]!==n)throw"private plugin method "+e+"."+i+" would overwrite existing: "+this[i];this[i]=t}}e.fn.vellum=function(t){var n,i="string"==typeof t,a=Array.prototype.slice.call(arguments,1);if(i){if("get"===t){for(var r=this;r&&r.length;){if((n=r.data("vellum_instance"))instanceof e.vellum._instance)return n;r=r.parent()}return null}return(n=this.data("vellum_instance"))[t].apply(n,a)}return this.each((function(){var n=new e.vellum._instance(e(this),t);e.data(this,"vellum_instance",n)})),this},e.vellum={defaults:{},_plugins:{},_fn:{},_instance:function(n,r){r.plugins=t.filter(t.union(i,r.plugins||[]),(function(n){return!t.isUndefined(e.vellum._plugins[n])})),r=e.extend(!0,{},e.vellum.defaults,r);var o=this;this.$f=n,this.data={},this.opts=function(){return e.extend(!0,{},r)},this.getData=function(){return this.data}.bind(this),this.isPluginEnabled=function(e){return-1!==r.plugins.indexOf(e)},t.each(r.plugins,(function(n,i){o.data[n]={};var r=e.vellum._plugins[n];r&&t.each(r,(function(e,t){0===i?o[t]=e:a.call(o,n,e,t)}))})),t.each(r.plugins,(function(t){var n=e.vellum._plugins[t].init;n&&n.apply(o)})),o.postInit()},plugin:function(t,n,i){return e.vellum.defaults[t]=n,e.vellum._plugins[t]=i,e}}}.apply(t,i))||(e.exports=a)},3586:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(3578),n(939),n(8094),n(7444)],void 0===(a=function(e,t,n,i,a,r){var o={},s={};function l(e){e.addQuestionButton.show(),e.container.hide(),e.input.val("").removeClass("alert-danger")}function d(n){function i(e,n){if(!n)throw new Error("getArg parameter is required");return{regexp:t.chain(e).map((function(e){return RegExp.escape(e.name)})).sortBy((function(e){return-e.length})).value().join("|"),items:e,getArg:n}}function a(e){var n,i;for(e=e.trim(),n=0;n<f.length;n++)if(i=f[n].exec(e))return{tokens:t.tail(i),config:f[n].config}}var r=e.fn.atwho.default.callbacks,s=o.getQuestionMap(n),l=t.map(s,(function(e){return{name:e.typeName,icon:e.icon}})),d=t.map(["after","before","first in","in"],(function(e){return{name:e}})),c={in:"into","first in":"first"},u={regexp:/[#\/][^\s]+/.source,getArg:function(e){var t;if(e){if(!(t=n.getMugByPath(e)))throw new Error("bad path: "+e)}else t=n.getCurrentlySelectedMug();return t}},f=[],h=[],p=[{name:"add question",args:[i(l,(function(e){if(e=e.toLowerCase(),s.hasOwnProperty(e))return s[e].__className})),i(d,(function(e){return e&&(e=e.toLowerCase(),c.hasOwnProperty(e)&&(e=c[e])),e})),u],run:function(e){!e[2]&&/^(before|after)$/i.test(e[1])&&(e[1]=void 0);try{return n.addQuestion.apply(n,e)}catch(e){}}},{name:"select question",args:[u],run:function(e){var t=e[0];if(t&&n.ensureCurrentMugIsSaved())return n.setCurrentMug(t),n.scrollTreeTo(t.ufid),n.focusFirstInput(),t}}];return t.each(p,(function(e){var n=[],i=[],a=h.length;t.each(e.args,(function(e){if(e.items){var t=n.concat(["(.*)$"]),r=new RegExp("^"+t.join("\\s+"),"i");r.items=e.items,h.splice(a,0,r)}n.push("(?:"+e.regexp+")"),i.length<1?i.push("^("+e.regexp+")"):i.push("(?:\\s+("+e.regexp+")")})),i.push.apply(i,t.map(i,(function(){return")?"}))),i[i.length-1]="$";var r=new RegExp(i.join(""),"i");r.config=e,f.push(r)})),{tokenize:a,dispatch:function(e){var n,i=a(e);if(i){try{n=t.map(i.tokens,(function(e,t){return i.config.args[t].getArg(e)}))}catch(e){return}var r=i.config.run(n);return r&&{name:i.config.name,value:r}}},atwhoConfig:{at:"",data:[],limit:50,maxLen:1/0,displayTpl:'<li><i class="${icon}" /> ${name}</li>',insertTpl:"${full}",suffix:" ",searchKey:e.fn.atwho.default.searchKey,tabSelectsMatch:!0,callbacks:{matcher:function(e,t){return t},filter:function(e,n,i){var a=[];return t.each(h,(function(n){var o=n.exec(e);if(o){var s=o[o.length-1],l=s?e.slice(0,-s.length):e,d=s.trimLeft(),c=r.filter(d,n.items,i);c=t.map(c,(function(e){return{name:e.name,icon:e.icon,full:l+e.name}})),d&&(d=d.toLowerCase(),c=t.sortBy(c,(function(e){var t=e.name.toLowerCase().indexOf(d);return t>=0?t:1/0}))),Array.prototype.push.apply(a,c)}})),a},sorter:function(e,t){return t}}}}}function c(e){if(e.input.atwho("isSelecting"))t.defer(c,e);else{var i=e.input.val(),a=o.doCommand(i,e.vellum);a?(l(e),n.usage("Commander",a.name)):(e.input.addClass("alert-danger"),n.usage("Commander","bad command"))}}return e.vellum.plugin("commander",{},{init:function(){var t=this,n=t.data.commander;n.vellum=t,n.container=e(r()),n.addQuestionButton=t.$f.find(".fd-add-question"),n.input=n.container.find("input"),n.input.on("keydown",(function(e){var t=a.getKeyChord(e);s.hasOwnProperty(t)?(s[t](n),e.preventDefault()):n.input.removeClass("alert-danger")})),n.container.find(".fd-commander-close").click((function(e){l(n)})),e(".fd-add-question-dropdown").append(n.container.hide())},getToolsMenuItems:function(){var e=this.__callOld();return e.splice(e.length-1,0,{name:gettext("Command Bar"),icon:"fa fa-terminal",hotkey:"Ctrl+;",action:function(){!function(e){(function(e){e.atwhoConfig||(t.extend(e,d(e.vellum)),e.input.atwho(e.atwhoConfig),i.autocomplete(e.input,{form:e.vellum.data.core.form,on:t.identity},{useHashtags:!0,tabSelectsMatch:!0}),e.vellum.data.core.form.on("change-display-language",(function(){e.input.atwho(e.atwhoConfig)})),e.input.on("inserted.atwho",(function(e){e.preventDefault()})))})(e),e.addQuestionButton.hide();const n=e.addQuestionButton.outerHeight(!0);e.container.css("min-height",n+"px"),e.container.show(),e.input.focus().select()}(this.data.commander)}}),e}}),s.Tab=function(){},s.Enter=c,s.Return=c,s.Escape=l,s.Esc=l,o.getCompletions=function(e,t){var n=d(t).atwhoConfig;return n.callbacks.filter(e,null,n.searchKey)},o.tokenize=function(e,t){return d(t).tokenize(e)},o.doCommand=function(e,n){var i=n.data.commander;return i.dispatch||t.extend(i,d(n)),i.dispatch(e)},o.getQuestionMap=function(e){var n=e.data.commander,i=e.data.core.mugTypes;return n.hasOwnProperty("questions")||(n.questions=t.chain(e.data.core.QUESTIONS_IN_TOOLBAR).map((function(e){var t=i[e];return[t.typeName.toLowerCase(),t]})).object().value(),n.questions.choice=i.Choice),n.questions},o}.apply(t,i))||(e.exports=a)},37:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(4078),n(7026),n(8094),n(705),n(1877)],void 0===(a=function(e,t,n,i,a,r){let o="http://commcareconnect.com/data/v1/learn",s={slug:"main",displayName:gettext("Basic"),properties:["nodeID"]},l={slug:"logic",displayName:gettext("Logic"),help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"},properties:["relevantAttr"]},d={xmlnsAttr:{presence:"optional",serialize:()=>{},deserialize:()=>{}},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}},c={isTypeChangeable:!1,isDataOnly:!0,supportsDataNodeRole:!0,getExtraDataAttributes:e=>({"vellum:role":e.__className}),getBindList:e=>{let t=u[e.__className];return[{nodeset:e.hashtagPath,relevant:e.p.relevantAttr}].concat(t.childNodes.filter((e=>!e.writeToData)).map((n=>({nodeset:`${e.absolutePath}/${t.rootName}/${n.id}`,calculate:e.p[n.id]}))))},parseDataNode:(t,n)=>{let i=n.children(),a=u[t.__className];if(1===i.length){let n=i[0];n.nodeName===a.rootName&&n.getAttribute("xmlns")===o&&e(n).children().each(((n,i)=>{let r=a.childNodes.find((e=>e.id===i.nodeName));r&&r.writeToData&&(t.p[i.nodeName]=e(i).text())}))}return e([])},dataChildFilter:(e,t)=>(e=u[t.__className].childNodes.map((e=>{let n={rawDataAttributes:null};return e.writeToData&&(n.dataValue=t.p[e.id]),new i.Node([],{getNodeID:()=>e.id,p:n,options:{getExtraDataAttributes:()=>{}}})})),[new i.Node(e,{getNodeID:()=>u[t.__className].rootName,p:{rawDataAttributes:null},options:{getExtraDataAttributes:()=>({xmlns:o,id:t.p.nodeID})}})])},u={ConnectLearnModule:{rootName:"module",childNodes:[{id:"name",writeToData:!0},{id:"description",writeToData:!0},{id:"time_estimate",writeToData:!0}],mugOptions:a.extend(c,{typeName:"Learn Module",icon:"fa fa-graduation-cap",init:e=>{e.p.name="",e.p.description="",e.p.time_estimate=""},spec:a.extend(d,{nodeID:{lstring:gettext("Module ID")},name:{lstring:gettext("Name"),visibility:"visible",presence:"required",widget:r.text},description:{lstring:gettext("Description"),visibility:"visible",presence:"required",widget:r.richTextarea},time_estimate:{lstring:gettext("Time Estimate"),visibility:"visible",presence:"required",widget:r.text,validationFunc:e=>{let t=e.p.time_estimate;return t&&t.match(/^\d+$/)?"pass":gettext("Must be an integer")},help:gettext("Estimated time to complete the module in hours.")},relevantAttr:{visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"bool",serialize:n.serializeXPath,deserialize:n.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[t.extend({},s,{properties:["nodeID","name","description","time_estimate"]}),t.clone(l)]},ConnectAssessment:{rootName:"assessment",childNodes:[{id:"user_score"}],mugOptions:a.extend(c,{typeName:"Assessment Score",icon:"fa-brands fa-leanpub",init:e=>{e.p.user_score=""},spec:a.extend(d,{nodeID:{lstring:gettext("Assessment ID")},user_score:{lstring:gettext("User Score"),visibility:"visible",presence:"required",widget:r.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the users assessment score.")},relevantAttr:{visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"bool",serialize:n.serializeXPath,deserialize:n.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[t.extend({},s,{properties:["nodeID","user_score"]}),t.clone(l)]},ConnectDeliverUnit:{rootName:"deliver",childNodes:[{id:"name",writeToData:!0},{id:"entity_id"},{id:"entity_name"}],mugOptions:a.extend(c,{typeName:"Deliver Unit",icon:"fa fa-briefcase",init:e=>{e.p.name="",e.p.entity_id="",e.p.entity_name=""},spec:a.extend(d,{nodeID:{lstring:gettext("Delivery Unit ID")},name:{lstring:gettext("Name"),visibility:"visible",presence:"required",widget:r.text},entity_id:{lstring:gettext("Entity ID"),visibility:"visible",presence:"optional",widget:r.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the entity ID associated with this Delivery Unit e.g. the case ID.")},entity_name:{lstring:gettext("Entity Name"),visibility:"visible",presence:"optional",widget:r.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the name of the entity associated with this Delivery Unit.")},relevantAttr:{visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"bool",serialize:n.serializeXPath,deserialize:n.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[t.extend({},s,{properties:["nodeID","name","entity_id","entity_name"]}),t.clone(l)]}};e.vellum.plugin("commcareConnect",{},{getAdvancedQuestions:function(){return this.__callOld().concat(Object.keys(u))},getMugTypes:function(){let e=this.__callOld();return Object.entries(u).forEach((([t,i])=>{e.normal[t]=a.extend(n.defaultOptions,i.mugOptions)})),e},getSections:function(e){return Object.hasOwn(u,e.__className)?t.map(u[e.__className].sections,(e=>t.clone(e))):this.__callOld()},parseBindElement:function(e,t,n){let i=e.getMugByPath(n);if(i){if(Object.hasOwn(u,i.__className))return void(i.p.relevantAttr=t.xmlAttr("relevant"))}else if(Object.entries(u).some((([a,r])=>{let o=r.childNodes.map((e=>e.id)).join("|"),s=new RegExp(`/${r.rootName}/(${o})`),l=n.match(s);if(l&&l.length>0){let r=l[1];if(i=e.getMugByPath(n.replace(s,"")),i&&i.__className===a)return i.p[r]=t.xmlAttr("calculate"),!0}})))return;this.__callOld()}})}.apply(t,i))||(e.exports=a)},9208:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(4078),n(7026),n(8094),n(705),n(1877)],void 0===(a=function(e,t,n,i,a,r){var o="http://commcarehq.org/ledger/v1",s=0,l=[{attr:"entryId",path:"entry/@id"},{attr:"quantity",path:"entry/@quantity"},{attr:"src",path:"@src"},{attr:"dest",path:"@dest"},{attr:"date",path:"@date"}],d={Balance:[{attr:"entryId",path:"entry/@id"},{attr:"quantity",path:"entry/@quantity"},{attr:"entityId",path:"@entity-id"},{attr:"date",path:"@date"}],Transfer:l,Dispense:l,Receive:l},c=t.mapObject(d,(function(e){return t.object(t.map(e,(function(e){return[e.path,e.attr]})))})),u={slug:"main",displayName:gettext("Basic"),properties:["nodeID","src","dest","sectionId","entryId","quantity","date"],help:{title:gettext("Basic"),text:"<p>"+a.format(gettext("The {questionid} is an internal identifier for a question. It does not appear on the phone. It is the name of the question in data exports."),{questionid:"<strong>"+gettext("Question ID")+"</strong>"})+"</p>",link:"https://help.commcarehq.org/display/commcarepublic/Transactions"}},f={slug:"logic",displayName:gettext("Logic"),help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"},properties:["relevantAttr"]},h={Balance:[t.extend({},u,{properties:["nodeID","entityId","sectionId","entryId","quantity"]}),f],Transfer:[u,f],Dispense:[u,f],Receive:[u,f]},p=a.extend(n.defaultOptions,{isDataOnly:!0,isTypeChangeable:!1,supportsDataNodeRole:!0,parseDataNode:function(t,n){return t.p.nodeID=t.p.rawDataAttributes.type||"tx-"+s++,delete t.p.rawDataAttributes.type,t.p.sectionId=t.p.rawDataAttributes["section-id"],delete t.p.rawDataAttributes["section-id"],e([])},getPathName:function(e,t){return e.options.getTagName()+"[@type='"+t+"']"},dataChildFilter:function(e,t){return[new i.Node(e,{getNodeID:function(){return"entry"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{id:"",quantity:""}}}})]},getBindList:function(e){var n=[{nodeset:e.hashtagPath,relevant:e.p.relevantAttr}];return t.each(d[e.__className],(function(t){var i=e.p[t.attr];i&&n.push({nodeset:e.hashtagPath+"/"+t.path,calculate:i})})),n},isHashtaggable:!1,spec:{date:{lstring:gettext("Date"),visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("The date and time of the action, e.g., now() or today()")},sectionId:{lstring:gettext("Balance ID"),visibility:"visible",presence:"optional",widget:r.text,help:gettext("The name of the balance you are tracking. This is an internal identifier which does not appear on the phone.")},entryId:{lstring:gettext("Product"),visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext('A reference to a product ID, e.g., "/data/products/current_product"')},quantity:{lstring:gettext("Quantity"),visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("A reference to an integer question in this form.")},relevantAttr:{visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"bool",serialize:n.serializeXPath,deserialize:n.deserializeXPath,lstring:gettext("Display Condition")}}}),g=a.extend(p,{typeName:"Balance",getTagName:function(){return"balance"},getExtraDataAttributes:function(e){var t=e.p.rawDataAttributes||{};return{xmlns:o,type:e.p.nodeID,"entity-id":t["entity-id"]||"","section-id":e.p.sectionId,date:t.date||""}},icon:"fcc fcc-fd-hash",init:function(e,t){e.p.entityId="",e.p.sectionId="",e.p.entryId="",e.p.quantity="",e.p.date="now()",y(e,t)},spec:{xmlnsAttr:{presence:"optional",serialize:function(){},deserialize:function(){}},nodeID:{serialize:D},entityId:{lstring:gettext("Case"),visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the case ID associated with this balance.")},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}}}),m=function(e){var t={key:"commtrack-transfer-src-dest-error",level:e.ERROR};return e.p.dest&&e.p.src||(t.message=gettext("Transfer must have both Source Case and Destination Case defined.")),e.addMessages({src:[t],dest:[t]}),"pass"},v=a.extend(p,{typeName:"Transfer",getTagName:function(){return"transfer"},isTypeChangeable:!0,typeChangeError:function(e,t){return"Balance"!==t&&"Balance"!==e.__className&&b(e)&&b({__className:t})?"":gettext("Cannot change $1 to $2").replace("$1",e.__className).replace("$2",t)},getExtraDataAttributes:function(t){var n=t.p.rawDataAttributes||{},i={xmlns:o,type:t.p.nodeID,date:n.date||"","section-id":t.p.sectionId};return t.p.src&&e.trim(t.p.src)?i.src=n.src||"":delete n.src,t.p.dest&&e.trim(t.p.dest)?i.dest=n.dest||"":delete n.dest,i},icon:"fa-solid fa-right-left",init:function(e,t){e.p.src="",e.p.dest="",e.p.sectionId="",e.p.entryId="",e.p.quantity="",e.p.date="now()",y(e,t)},spec:{nodeID:{serialize:D},xmlnsAttr:{presence:"optional",serialize:function(){},deserialize:function(){}},src:{lstring:gettext("Source Case"),visibility:"visible",presence:"required",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the case ID issuing the transaction."),validationFunc:m},dest:{lstring:gettext("Destination Case"),visibility:"visible",presence:"required",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the case ID receiving the transaction."),validationFunc:m},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}}}),E=a.extend(v,{typeName:"Dispense",icon:"fa fa-sign-out",spec:{src:{validationFunc:function(e){return e.p.src?"pass":gettext("Dispense must have a Source Case.")}},dest:{presence:"notallowed"}}}),T=a.extend(v,{typeName:"Receive",icon:"fa fa-sign-in",spec:{src:{presence:"notallowed"},dest:{validationFunc:function(e){return e.p.dest?"pass":gettext("Receive must have a Destination Case.")}}}}),C=t.chain(d).map((function(e){return t.map(e,(function(e){return RegExp.escape(e.path)}))})).flatten().uniq().value(),I=new RegExp("/("+C.join("|")+")$");function b(e){return e&&d.hasOwnProperty(e.__className)}function y(e,t){t.addInstanceIfNotExists({id:"ledger",src:"jr://instance/ledgerdb"},e,"")}function D(e,t,n,i){var a=n.parentMug?n.absolutePathNoRoot+"/":"/";i.id=a+n.p.nodeID}e.vellum.plugin("commtrack",{},{getAdvancedQuestions:function(){return this.__callOld().concat(["Balance","Transfer","Dispense","Receive"])},getMugTypes:function(){var e=this.__callOld();return e.normal.Balance=g,e.normal.Transfer=v,e.normal.Dispense=E,e.normal.Receive=T,e},parseDataElement:function(n,i,a,r){var s=i.nodeName;if(!r&&("transfer"===s||"balance"===s)&&e(i).xmlAttr("xmlns")===o){if("transfer"===s){var l=e(i);r=t.isUndefined(l.xmlAttr("src"))?"Receive":t.isUndefined(l.xmlAttr("dest"))?"Dispense":"Transfer"}else r="Balance";return this.__callOld(n,i,a,r)}return this.__callOld()},parseBindElement:function(e,t,n){var i=e.getMugByPath(n);if(i){if(b(i))return void(i.p.relevantAttr=t.xmlAttr("relevant"))}else{var a=n.replace(I,"");if(n!==a&&b(i=e.getMugByPath(a))){var r=n.match(I)[1],o=c[i.__className][r];return void(i.p[o]=t.xmlAttr("calculate"))}}this.__callOld()},parseSetValue:function(e,t,n){var i=e.getMugByPath(n);if(!i){var a=n.replace(I,"");if(n!==a&&b(i=e.getMugByPath(a))){var r=n.match(I)[1],o=c[i.__className][r];return void(i.p[o]=t.xmlAttr("value"))}}this.__callOld()},getSections:function(e){return h.hasOwnProperty(e.__className)?t.map(h[e.__className],(function(e){return t.clone(e)})):this.__callOld()}})}.apply(t,i))||(e.exports=a)},1437:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(23),n(4078),n(3809),n(8094),n(3578),n(1877)],void 0===(a=function(e,t,n,i,a,r,o){var s,l=["Form Builder clip","version 1"],d=e("<textarea></textarea>").css({position:"absolute",width:0,height:0}).css({top:-1e4,left:-1e4}).appendTo("body"),c=/Chrome/.test(navigator.userAgent),u=/Safari/.test(navigator.userAgent)&&!c;function f(t,n){0===t.length&&(t=e("body")),d.css({top:t.offset().top}),d.val(n),d.focus(),d.select()}function h(e,t){e.focus();var n=d.val();return t&&n&&d.val(""),n}var p=/^(null|true|false|\[[^]*\]|\{[^]*\}|"[^]*"|-?\d+(\.\d+)?([Ee][+-]?\d+)?)$/;function g(e){return t.isString(e)&&!p.test(e)?e:JSON.stringify(e)}function m(e){return p.test(e)?JSON.parse(e):e}function v(e){var t="1",n=/^(.*)Itext(?::([^-]+)-(.*))?$/.exec(e);return n&&(t="0","label"===n[1]&&(n[1]="!"),"default"===n[3]?n[3]="!":n[3]||(n[3]="~"),e=n[1]+" "+n[3]+" "+n[2]),t+e}function E(e){var t=s.data.core.mugTypes.allTypes[e];return t&&t.typeName||e}function T(e,t){for(var n,i;;){if(!e.parent||t.id.startsWith(e.id+"/")){i=e.id&&!t.id.startsWith(e.id+"/"),n=s.getInsertTargetAndPosition(e.mug,t.type,i);break}e=e.parent}if(n){for(;e.mug!==n.mug;){if(!e.parent)return n.error=gettext("Cannot insert $1 into $2").replace("$1",E(t.type)).replace("$2",E(e.mug.parentMug.__className)),n;e=e.parent}"after"===n.position?n.parent=e.parent:"last"===n.position||"into"===n.position?n.parent=e:n.error="Cannot insert $1 $2 $3".replace("$1",E(t.type)).replace("$2",n.position).replace("$3",E(n.mug.__className))}else n={},e.mug?n.error=gettext("Cannot insert $1 into or after $2").replace("$1",E(t.type)).replace("$2",E(e.mug.__className)):n.error=r.format(gettext("Cannot insert {type} into tree root"),{type:E(t.type)});return n}function C(){var e=I(!0),n=s.getCurrentlySelectedMug(!0);return o.usage("Copy Paste","Cut",n.length),o.workflow("Cut questions in form builder"),(n=t.filter(n,(function(e){return e.options.isCopyable})))&&n.length&&s.data.core.form.removeMugsFromForm(n),e}function I(e){var n=s.getCurrentlySelectedMug(!0,!0),i={};if(e||(o.usage("Copy Paste","Copy",n.length),o.workflow("Copy questions in form builder")),!n||!n.length)return"";var r={id:!0,type:!0},d=[],c=n[0].form,u=t.filter(t.flatten(t.map(n,(function e(n){if(!i.hasOwnProperty(n.ufid)&&(i[n.ufid]=!0,n.options.isCopyable)){var a=n.serialize(),o=c.getChildren(n);return t.each(a,(function(e,t){r.hasOwnProperty(t)||(d.push(t),r[t]=!0)})),o.length&&(a=[a].concat(t.map(o,e))),a}}))),t.identity);return 0===u.length?"":(d=["id","type"].concat(t.sortBy(d,v)),a.tabDelimit([l,d].concat(t.map(u,(function(e){return t.map(d,(function(n){var i=e[n];return g(t.isUndefined(i)?null:i)}))})))))}function b(e){o.workflow("Paste questions in form builder");var n=a.makeRowParser(e);if(!t.isEqual(n().slice(0,2),l))return[gettext("Unsupported paste format")];var r,d,c=s.data.core.mugTypes.allTypes,u=s.data.core.form,f=function(e){function n(e){var t=e.replace(/^#form/,"");return r.hasOwnProperty(t)?r[t].hashtagPath:e}var a=new i.MugMessages,r={},o=[],s={length:0,context:{addError:function(e){a.update(null,{key:e,level:i.ERROR,message:e})},errors:a,later:function(e){o.push(e)},transformHashtags:function(t){return e.transformHashtags(t,n)}},addMug:function(e,t){r[e]=t,s.length++},getErrors:a.get.bind(a),finish:function(){t.each(o,(function(e){e()}))}};return s}(u),h=f.context,p=s.getCurrentlySelectedMug(!0,!0),g=p.length?p[p.length-1]:null,v=n(),E=n(),C={id:null,mug:g,parent:null};for(s.beforeBulkInsert(u);E;E=n()){try{r=t.object(v,t.map(E,(function(e){return m(e)})))}catch(e){h.addError(gettext("Unsupported paste format:")+" "+E.join(", "));continue}c.hasOwnProperty(r.type)?(d=T(C,r)).hasOwnProperty("error")?h.addError(d.error):((g=u.createQuestion(d.mug,d.position,r.type,!0)).deserialize(r,h),f.addMug(r.id,g),C={id:r.id,mug:g,parent:d.parent}):h.addError(gettext("Unknown question type:")+" "+E.join(", "))}return f.finish(),s.afterBulkInsert(u),g&&d&&s.setCurrentMug(g),o.usage("Copy Paste","Paste",f.length),f.getErrors()}return e.vellum.plugin("copyPaste",{cut:C,copy:I,paste:b},{init:function(){var t=this.opts().copyPaste;s=this,e(document).on("cut copy paste keydown",(function(n){"cut"===n.type||"Ctrl+X"===r.getKeyChord(n)||("copy"===n.type||"Ctrl+C"===r.getKeyChord(n)?function(t){var n=e(":focus");if(n.is(".jstree-anchor")){var i=t.copy();i&&(f(n,i),setTimeout((function(){h(n)}),10))}}(t):"paste"!==n.type&&"Ctrl+V"!==r.getKeyChord(n)||function(t){var n=e(":focus");(0===n.length||n.parents(".fd-tree").length||n.is(d))&&(f(n),setTimeout((function(){var e=h(n,!0);if(e){var i=t.paste(e);i.length&&s._resetMessages([{level:"parse-warning",message:i}])}}),0))}(t))}))},displayMultipleSelectionView:function(){function t(){a.hide(),o.removeClass("hide"),s.val(I(!0))}this.__callOld();var i=e(n({metachar:r.isMac?"⌘":"Ctrl+",format:r.format})),a=i.find(".copy-paste-help"),o=i.find(".copy-paste-box"),s=o.find("textarea");u?(t(),setTimeout((function(){s.focus().select()}),1)):a.click((function(){t(),s.focus().select()})),s.focus((function(){s.select().mouseup((function(){return s.off("mouseup"),!1}))})).keyup((function(e){9===e.which&&s.select()})),i.find(".insert-questions").click((function(){b(s.val())})),this.$f.find(".fd-props-content").html(i)}}),{cut:C,copy:I,paste:b,stringify:g,valuify:m}}.apply(t,i))||(e.exports=a)},1877:(e,t,n)=>{var i,a;i=[n,n(9848),n(3946),n(561),n(8101),n(4872),n(5674),n(516),n(7133),n(8267),n(8019),n(4226),n(348),n(7356),n(7649),n(1694),n(8426),n(1089),n(579),n(4078),n(705),n(4459),n(7417),n(7229),n(5382),n(8094),n(3876),n(3578),n(939),n(2183),n(9537),n(1396),n(952),n(5156),n(1460),n(9199),n(8671),n(9320),n(2591),n(6129),n(9103),n(875),n(9385)],void 0===(a=function(e,t,i,a,r,o,s,l,d,c,u,f,h,p,g,m,v,E,T,C,I,b,y,D,O,R,_,x,w,k,K,N){setTimeout((function(){Promise.all([n.e(485),n.e(576)]).then((function(){var e=[n(5237),n(576),n(4485)];(function(){}).apply(null,e)})).catch(n.oe)}),0);var S=R.isMac,A={Ctrl:"Ctrl+",Alt:"Alt+",Shift:"Shift+"};S&&(A={Ctrl:"⌘",Alt:"⌥",Shift:"⇧"});var M,P={error:{cssClass:"alert-danger",title:gettext("Error"),icon:"fa fa-exclamation-circle"},"parse-warning":{cssClass:"alert-warning",title:gettext("Warning"),icon:"fa fa-warning"},"form-warning":{cssClass:"alert-warning",title:gettext("Form Warning"),icon:"fa fa-info-circle"},info:{cssClass:"alert-info",title:gettext("Notification"),icon:"fa fa-info-circle"}},L={isCurrentlySelectedMugValid:function(){var e=this.getCurrentlySelectedMug();return!e||(e.validate(),!e.hasErrors())},init:function(){this.data.core.mugTypes=new C.MugTypesManager(this.getMugSpec(),this.getMugTypes(),this.opts());var e=this,n=this.opts().core.bindBeforeUnload;this.data.core.saveButton=t.init({save:function(t){var n=t&&t.altKey;n&&!window.confirm(gettext("Holding the ALT key while clicking save invokes an inefficient save procedure. Do this only if a normal save fails."))||(e.ensureCurrentMugIsSaved((function(){x.workflow("Clicked Save in the form builder"),e.validateAndSaveXForm(n)})),e.data.core.form.walkMugs((function(e){e.__originalNodeID=e.p.nodeID,e.dropMessage("nodeID","mug-nodeID-changed-warning")})))},unsavedMessage:gettext("Are you sure you want to exit? All unsaved changes will be lost!"),csrftoken:e.opts().csrftoken});var o=i.debounce((function(){var t,n="<div class='alert alert-danger'>{error}<br/>{action}</div>",i="<i class='fd-valid-alert-icon fa fa-warning'></i>";return e.data.core.form.hasBrokenReferences()?(t=gettext("Look for questions marked with $1 and check they don't reference deleted questions."),{title:gettext("Errors in Form"),content:R.format(n,{error:gettext("Form has reference errors."),action:t.replace("$1",i)})}):e.isCurrentlySelectedMugValid()?{title:"",content:""}:(t=gettext("Look for questions marked with $1 and fix the errors."),{title:"Validation Failed",content:R.format(n,{error:gettext("Form has validation errors."),action:t.replace("$1",i)})})}),500,!0);e.data.core.saveButton.ui.popover({title:function(){return o().title},content:function(){return o().content},html:!0,placement:"bottom",container:"body",trigger:"hover",sanitize:!1}),e.data.core.saveButton.ui.on("click",(function(){a(this).popover("hide")})),n(this.data.core.saveButton.beforeunload),this.data.core.lastSavedXForm=this.opts().core.form,this.$f.addClass("formdesigner");var s=i.extend({format:R.format},A);this.$f.empty().append(r(s)),a(document).on("keydown",(function(t){var n=R.getKeyChord(t);(L.hotkeys[n]||i.identity).call(e,t)})),a(document).on("click",".jstree-hover",(function(t){t.preventDefault();var n=a(this).data("ufid");e.scrollTreeTo(n),x.fbUsage("Clicked link to show in tree"),x.workflow("Clicked on easy reference popover's link to show in tree")})),a(window).on("hashchange",(function(){e.selectSomethingOrHideProperties(!0,window.location.hash)})),this._init_toolbar(),this._init_add_question(),this._createJSTree(),this.datasources=O.init(this.opts().core.dataSourcesEndpoint,this.opts().core.invalidCaseProperties)},postInit:function(){var e=this;function t(){e.opts().core.onReady.apply(e)}e.opts().features.allow_bulk_form_actions&&this._init_bulk_update_questions(),this._init_extra_tools(),y.init(this),this.loadXFormOrError(this.opts().core.form,(function(){setTimeout(t,0)}))},hotkeys:{"Ctrl+Alt+=":function(){this.data.core.$tree.jstree("open_all")},"Ctrl+Alt+-":function(){this.data.core.$tree.jstree("close_all")}},getMugTypes:function(){return C.baseMugTypes},_init_add_question:function(){var e=this,t=e.$f.find(".fd-add-question-dropdown");this.data.core.QUESTIONS_IN_TOOLBAR=[],i.each(e.getQuestionGroups(),(function(t){t.questions=i.map(t.questions,(function(t){var n=e.data.core.mugTypes[t],i=[t,n.typeName,n.icon];return e.data.core.QUESTIONS_IN_TOOLBAR.push(t),i}))})),t.find(".fd-add-question").after(a(o({groups:i.map(e.getQuestionGroups(),(function(t){var n=e.data.core.mugTypes[t.group[0]];return{name:t.group[1]||n.typeName,defaultQuestion:{slug:t.group[0],name:t.group[1]||n.typeName,icon:t.group[2]||n.icon},questions:i.map(t.questions,(function(t){var n=e.data.core.mugTypes[t];return{slug:t,name:n.typeName,icon:n.icon}}))}}))}))),t.find(".fd-question-type").click((function(t){a(this).hasClass("disabled")||e.addQuestion(a(this).data("qtype")),t.preventDefault()}))},_init_toolbar:function(){var e=this.$f.find(".fd-save-button");this.data.core.saveButton.ui.appendTo(e)},getQuestionGroups:function(){let e={group:["Image",gettext("Multimedia Capture")],questions:["Image","Audio","Video","Signature"]};return this.opts().features.support_document_upload&&e.questions.push("Document"),this.opts().features.case_micro_image&&e.questions.push("MicroImage"),[{group:["Text"],questions:["Text"]},{group:["Select",gettext("Multiple Choice")],questions:["Select","MSelect"]},{group:["Int",gettext("Number")],questions:["Int","PhoneNumber","Double"]},{group:["Date",gettext("Date")],questions:["Date","Time","DateTime"]},{group:["Group",gettext("Groups")],questions:["Group","Repeat","FieldList"]},e,{group:["Trigger"],questions:["Trigger"]},{group:["DataBindOnly",gettext("Hidden Value")],questions:["DataBindOnly"]},{group:["Geopoint",gettext("Advanced"),""],textOnly:!0,questions:this.getAdvancedQuestions()}]},getAdvancedQuestions:function(){return["Geopoint","Barcode","Secret"]},_init_bulk_update_questions:function(){var e=this,t=this.getBulkUpdateMenuItems(),n=this.$f.find(".fd-bulk-update-header");n.nextUntil(".divider").remove(),i(t).each((function(t){var r=a(R.format("<a tabindex='-1' href='#'>{name}</a>",i.extend(t))).click((function(n){n.preventDefault(),e.showConfirmBulkActionModal(t.confirmMessage,t.confirmAction)})),o=a("<li></li>").append(r);n.after(o),n=o}))},getBulkUpdateMenuItems:function(){var e=this,t=[{name:gettext("Make Required"),confirmMessage:gettext("You are about to make all existing questions on this form required. This action will overwrite the current configuration of this form and can only be undone by editing individual questions."),confirmAction:function(){e.makeAllQuestionsRequired()}}];return e.data.core.databrowser&&t.push({name:gettext("Load Default Values"),confirmMessage:gettext("You are about to set matching case properties as Default Values for all existing questions. This action will overwrite existing Default Values for all questions with matching case properties and can only be undone by editing individual questions."),confirmAction:function(){e.defaultMatchingQuestionsToCaseProperties()}}),t},makeAllQuestionsRequired:function(){this.data.core.form.walkMugs((function(e){e.spec.requiredAttr&&e.isVisible("requiredAttr")&&(e.p.requiredAttr=!0)})),this.refreshCurrentMug()},defaultMatchingQuestionsToCaseProperties:function(){var e=this,t=e.datasources.getHashtagMap({});e.data.core.form.walkMugs((function(e){if(e.isVisible("defaultValue")){var n="#case/"+e.p.nodeID,i="#user/"+e.p.nodeID;t.hasOwnProperty(n)?e.p.defaultValue=n:t.hasOwnProperty(i)&&(e.p.defaultValue=i)}})),e.refreshCurrentMug()},showConfirmBulkActionModal:function(e,t){var n,i=this;(n=this.generateNewModal(gettext("Are you sure you want to perform this action?"),[{title:gettext("Continue"),cssClasses:"btn-primary",action:function(){i.closeModal(),t()}}],gettext("Cancel"))).find(".modal-body").html(a("<p></p>").text(e)),n.modal("show")},_init_extra_tools:function(){var e=this,t=this.getToolsMenuItems(),n=this.$f.find(".fd-tools-menu");n.nextUntil(".divider").remove(),i(t).each((function(t){var r=t.hotkey||"",o="";r&&(L.hotkeys[r]=function(){t.action.apply(e,(function(){}))},o="<span class='hotkey'>"+(o=r.replace(/(Ctrl|Alt|Shift)\+/g,(function(e,t){return A[t]||t})))+"</span>");var s=a(R.format("<a tabindex='-1' href='#'><i class='{icon}'></i> {name}{key}</a>",i.extend({key:o},t))).click((function(n){n.preventDefault(),e.ensureCurrentMugIsSaved((function(){x.fbUsage("Tools",t.name),t.action.call(e,(function(){e.refreshVisibleData()}))}))})),l=a("<li></li>").append(s);n.after(l),n=l})),this.$f.find(".fd-expand-all").click((function(){e.data.core.$tree.jstree("open_all")})),this.$f.find(".fd-collapse-all").click((function(){e.data.core.$tree.jstree("close_all")})),this.$f.find(".fd-button-copy").click((function(){x.usage("Copy Paste","Copy Button"),x.workflow("Clicked Copy Button in form builder"),e.ensureCurrentMugIsSaved((function(){e.displayMultipleSelectionView();var t=e.jstree("get_selected");t.length&&a("#"+t[0]+" a").focus()}))})),this.$f.find(".fd-content-right").on("click",".fd-section-changer .dropdown-menu a",(function(t){var n=a(t.target);e.collapseSection(n.data("slug"),n.hasClass("selected"))}))},toggleFullScreen:function(){var e=this,t=gettext("Expand Editor"),n=gettext("Shrink Editor"),r=new RegExp(RegExp.escape(t)+"|"+RegExp.escape(n)),o=a(i.find(e.$f.find(".fd-tools-menu").nextAll(),(function(e){return a(e).find("a").text().match(r)}))).find("a"),s=o.html();x.fbUsage("Full Screen Mode",e.opts().core.formid),e.data.windowManager.fullscreen?(e.data.windowManager.fullscreen=!1,o.html(s.replace(new RegExp(RegExp.escape(n)),t))):(e.data.windowManager.fullscreen=!0,o.html(s.replace(new RegExp(RegExp.escape(t)),n))),o.find("i").toggleClass("fa-down-left-and-up-right-to-center").toggleClass("fa-up-right-and-down-left-from-center"),e.adjustToWindow(),e.opts().windowManager.toggleFullScreenCallback&&e.opts().windowManager.toggleFullScreenCallback(e.data.windowManager.fullscreen)},getToolsMenuItems:function(){var e=this;return[{name:gettext("Expand Editor"),icon:"fa-solid fa-up-right-and-down-left-from-center",hotkey:"Ctrl+Alt+F",action:function(t){e.toggleFullScreen()}},{name:gettext("Export Form Contents"),icon:"fa-regular fa-file-excel",action:function(t){e.showExportModal(t)}},{name:gettext("Edit Source XML"),icon:"fa fa-edit",action:function(t){e.showSourceXMLModal(t)}},{name:gettext("Form Properties"),icon:"fa-regular fa-rectangle-list",action:function(t){e.showFormPropertiesModal(t)}},{name:gettext("Find Usages"),icon:"fa fa-search",action:function(t){e.findUsages(t)}}]},refreshVisibleData:function(){var e=this;this.data.core.form.getMugList().map((function(t){e.refreshMugName(t)})),this.refreshCurrentMug()},refreshCurrentMug:function(){var e=this.getCurrentlySelectedMug();e&&this.displayMugProperties(e)},getMugDisplayName:function(e){var t=this.data.core.currentItextDisplayLanguage||this.data.javaRosa.Itext.getDefaultLanguage(),n=e.getDisplayName(t,!1);return n&&e._core_cachedDisplayNameKey===n?e._core_cachedDisplayNameValue:(e._core_cachedDisplayNameKey=n,n=e.form.richText?b.bubbleOutputs(n,this.data.core.form,!1):_.outputToXPath(n,e.form.xpath,!0),e._core_cachedDisplayNameValue=n,n)},_resizeFullScreenModal:function(e){var t,n,i;t=e.find(".modal-header").outerHeight(!1),n=e.find(".modal-footer").outerHeight(!1),i=a(window).height()-40-(n-t)-126,e.find(".modal-body").css("height",i+"px")},showSourceXMLModal:function(e){var t,i,r,o,l=this,d=this.data.core.form.isFormValid((function(e){return e.validate(),!e.hasErrors()}))?"":" <i class='fd-valid-alert-icon fa fa-warning'></i> "+gettext("Validation failed. Form may not perform correctly on your device!");t=this.generateNewModal(gettext("Edit Form's Source XML")+d,[{title:gettext("Update Source"),cssClasses:"btn-primary",action:function(){o.save(),l.loadXFormOrError(r.val(),(function(){t.modal("hide"),e()}),!0)}}]),i=a(s({description:gettext("This is the raw XML. You can edit or paste into this box to make changes to your form. Press 'Update Source' to save changes, or 'Close' to cancel.")})),t.addClass("fd-full-screen-modal").find(".modal-body").removeClass("form-horizontal").removeClass("form").html(i),this._resizeFullScreenModal(t),r=i.find("textarea"),this.data.core.formLoadingFailed?r.val(this.data.core.failedLoadXML):r.val(this.createXML()),o=n(5237).fromTextArea(r.get(0),{mode:"xml",lineNumbers:!0,viewportMargin:1/0}),t.modal("show"),t.one("shown.bs.modal",(function(){var e=t.find(".modal-body"),n=e.height(),i=e.find("p").outerHeight(!0);o.setSize("100%",n-i),o.refresh(),o.focus()}))},showExportModal:function(e){var t,n;t=this.generateNewModal(gettext("Export Form Contents"),[]),n=a(s({description:gettext("Copy and paste this content into a spreadsheet program like Excel to easily share your form with others.")})),t.find(".modal-body").html(n);var i=n.find("textarea");i.val(this.data.core.form.getExportTSV()),t.modal("show"),t.one("shown.bs.modal",(function(){i.focus()}))},showOverwriteWarning:function(e,t,n){var i,r,o=this;i=o.generateNewModal(gettext("Lost Work Warning"),[{title:gettext("Overwrite their work"),cssClasses:"btn-primary",defaultButton:!0,action:function(){a("#form-differences").hide(),e(t,"full"),o.closeModal()}},{title:gettext("Show XML Differences"),cssClasses:"btn-info",action:function(){a("#form-differences").show(),i.addClass("fd-full-screen-modal").removeClass("form-horizontal").find(".modal-body").html(r),o._resizeFullScreenModal(i),i.find(".btn-info").prop("disabled",!0)}}],gettext("Cancel"),"fa fa-warning"),r=a(l({description:gettext("Looks like someone else has edited this form since you loaded the page. Are you sure you want to overwrite their work?"),xmldiff:R.htmlXMLDiff(t,n||"")})),i.find(".modal-body").html(r),a("#form-differences").hide(),i.modal("show")},showFormPropertiesModal:function(){var e=this,t=this.generateNewModal(gettext("Edit Form Properties"),[]),n=t.find(".modal-body"),r=[{label:gettext("Disable Text Formatting"),slug:"noMarkdown",type:"checkbox",value:function(e,t){return t?e.prop("checked",t):e.prop("checked")}}];this.opts().features.rich_text&&r.push({label:gettext("Use Easy References"),slug:"richText",type:"checkbox",value:function(e,t){return t?e.prop("checked",t):e.prop("checked")}}),i.each(r,(function(t){var i=a(d({label:t.label,type:t.type||"text"}));n.append(i),i.find("input").val(e.data.core.form[t.slug]).on("change",(function(){var n=a(this),i=n.val();t.value&&(i=t.value(n)),e.data.core.form.setAttr(t.slug,i),e.refreshVisibleData()})),t.value&&t.value(i.find("input"),e.data.core.form[t.slug])})),t.modal("show"),t.one("shown.bs.modal",(function(){n.find("input:first").focus().select()}))},findUsages:function(){var e=this,t=this.generateNewModal(gettext("Use of each question"),[]),n=t.find(".modal-body"),r=e.data.core.form,o=r.findUsages();t.addClass("fd-full-screen-modal"),n.append(a(E())),n.append(a(v({tableData:o}))),this._resizeFullScreenModal(t),t.modal("show"),n.find(".link-to-question").click((function(){var n=a(this).text();return t.modal("hide"),e.setCurrentMug(r.getMugByPath(n)),!1})),n.find("#findUsagesSearch").on("keypress inserted.atwho",i.debounce((function(){var e=a.trim(this.value),t={};e?i.each(o,(function(n,a){a.includes(e)?t[a]=n:i.each(n,(function(n,i){i.includes(e)&&(t[a]||(t[a]={}),t[a][i]=n)}))})):t=o,n.find("table").remove(),n.append(a(v({tableData:t})))}),250)),w.autocomplete(a("#findUsagesSearch"),e.getCurrentlySelectedMug(),{useRichText:!0})},closeModal:function(e,t){var n=this,i=n.$f.find(".fd-modal-generic-container .modal");e&&i.one("hidden.bs.modal",(function(){e.apply(n)})),t&&i.removeClass("fade"),i.modal("hide")},generateNewModal:function(e,t,n,r){void 0===n&&(n=gettext("Close")),t.reverse(),t=i.map(t,(function(e){return e.cssClasses=e.cssClasses||"",e}));var o=this,s=o.$f.find(".fd-modal-generic-container");o.closeModal(void 0,!0);var l=a(g({title:e,closeButtonTitle:n,headerIcon:r}));return l.one("shown.bs.modal",(function(){l.find(".btn-default:last").focus()})),i.each(t,(function(e){e.defaultButton=e.defaultButton||!1,e.action=e.action||function(){o.closeModal()},l.find(".modal-footer").prepend(a(m(e)).click(e.action))})),s.html(l),l}},F=function(){var e=a("<div><div><i class='fa fa-spin fa-spinner'></i></div></div>");e.addClass("fd-form-saving"),a("body").append(e)},B=function(){a(".fd-form-saving").remove()};function $(e,t){var n=t.p.getDefinition(e);return n&&t.isVisible(e)?{widget:n.widget||I.text,options:a.extend(!0,{path:e},n)}:null}L.handleDropFinish=function(e,t,n,i){var a=e.closest(".xpath-expression-row").find(".op-select");if(e){I.util.getWidget(e,this).options.richText&&this.data.core.form.richText?b.editor(e).insertExpression(t):e.val(e.val()+t).change();var r,o=R.getReferenceName(t);switch(e[0].id){case"property-relevantAttr":r="Display";break;case"property-constraintAttr":r="Validation";break;case"property-calculateAttr":r="Calculation";break;default:r="Expression Editor"}x.usage(o,"Drag and Drop",r)}n&&a&&n.options.defaultOperator&&a.val(n.options.defaultOperator)},L._createJSTree=function(){M={"#":{valid_children:this.data.core.mugTypes.Group.validChildTypes},default:{icon:"fa fa-question-circle",max_children:0,valid_children:[]}},i(this.data.core.mugTypes.allTypes).each((function(e,t){M[t]={icon:e.icon,max_children:e.maxChildren,valid_children:e.validChildTypes}}));var e,t=this;this.data.core.$tree=e=this.$f.find(".fd-question-tree"),e.jstree({core:{data:[],worker:!1,multiple:!0,strings:{"New node":this.opts().core.noTextString},check_callback:function(e,n,i,a,r){return"move_node"!==e||t.checkMove(n.id,n.type,i.id,i.type,a)}},dnd:{copy:!1,inside_pos:"last"},types:M,conditionalevents:{should_activate:function(){return t.ensureCurrentMugIsSaved()},redraw_node:function(e){var t=Array.prototype.slice.call(arguments),n=this.parent.redraw_node.apply(this.inst,t);return e=this.inst.get_node(e),n&&e.data&&e.data.errors&&a(n).find("a > i").first().after(e.data.errors),n}},plugins:["themes","types","dnd","conditionalevents","actions"]}).on("select_node.jstree deselect_node.jstree",(function(e,n){var i=t.jstree("get_selected");if(i.length)if(i.length<2){var a=t.data.core.form.getMugByUFID(i[0]);t.displayMugProperties(a),t._setURLHash(a)}else t.displayMultipleSelectionView();else t.hideQuestionProperties()})).on("open_node.jstree",(function(e,n){window.event&&window.event.altKey&&t.jstree("open_all",n.node);var i=t.data.core.form.getMugByUFID(n.node.id);t.data.core.form.getDescendants(i).map((function(e){t.refreshMugName(e)}))})).on("close_node.jstree",(function(e,n){window.event&&window.event.altKey&&t.jstree("close_all",n.node)})).on("move_node.jstree",(function(e,n){var i=t.data.core.form,a=i.getMugByUFID(n.node.id),r="#"!==n.parent?i.getMugByUFID(n.parent):null,o=t.getRelativePosition(r,n.position);i.moveMug(a,o.position,o.mug),n.node.icon=a.getIcon(),t.refreshCurrentMug()})).on("model.jstree",(function(e,n){i(n.nodes).each((function(e){var n=t.jstree("get_node",e);n.data.mug&&(n.icon=n.data.mug.getIcon())}))}))},a(document).one("dnd_move.vakata.jstree",(function(e,t){a(document).on("dnd_move.vakata.jstree",(function(e,t){a(".jstree-drop").addClass("jstree-drop-active");var n=a(t.data.obj),i=a(t.event.target);a.jstree.reference(i)||i.vellum("get")!==n.vellum("get")||(i.closest(".jstree-drop").length?t.helper.find(".jstree-icon").removeClass("jstree-er").addClass("jstree-ok"):t.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"))})).on("dnd_stop.vakata.jstree",(function(e,t){a(".jstree-drop").removeClass("jstree-drop-active");var n=a(t.data.obj).vellum("get"),i=a(t.event.target);if(!a.jstree.reference(i)&&i.closest(".jstree-drop").length&&n===i.vellum("get")&&t.data.origin){var r=t.data.origin.get_node(t.data.nodes[0]);r.data&&r.data.handleDrop&&r.data.handleDrop(i.closest(".jstree-drop"),t.event)}}))})),L.scrollTreeTo=function(e){this.jstree("_open_to",e),this.jstree("hover_node",e);var t=a(".jstree-hovered");if(t.length){var n=t.closest(".fd-scrollable"),i=n.offset().top,r=n.height(),o=t.offset().top,s=t.height(),l=o-t.closest(".fd-question-tree").offset().top;(o<i||o+s>i+r)&&n.scrollTop(l-(r-s)/2)}},L.getRelativePosition=function(e,t){if(!i.isNumber(t))return{mug:e,position:t};if(0===t)return{mug:e,position:"first"};var n=this.jstree("get_node",e?e.ufid:"#");return t>n.children.length?{mug:e,position:"last"}:{mug:this.jstree("get_node",n.children[t-1]).data.mug,position:"after"}},L.checkMove=function(e,t,n,i,a){var r=this.data.core.form,o=r.getMugByUFID(n),s=r.getMugByUFID(e);return!!s&&("inside"===a&&(a="into"),!!this.isMugPathMoveable(s.hashtagPath)||("into"===a||"last"===a||"first"===a?s.parentMug===o:s.parentMug===o.parentMug))},L.onFormChange=function(e){this.data.core.saveButton.fire("change"),this.notifyUserActivity()},L.notifyUserActivity=function(){var e=Date.now(),t=this.opts().core.activityTimeout||3e5,n=this.opts().core.activityUrl;n&&(this.data.core.activityTimestamp?e-this.data.core.activityTimestamp>=t&&(this.data.core.activityTimestamp=e,i.isFunction(n)?n():a.get(n)):this.data.core.activityTimestamp=e)},L.jstree=function(){var e=this.data.core.$tree;return e.jstree.apply(e,arguments)},L.getCurrentlySelectedMug=function(e,t){var n=this.jstree("get_selected"),a=this.data.core.form;if(e){if(t&&n.length>1){var r=i.object(i.map(n,(function(e){return[e,!0]}))),o=n.length,s=[];return a.tree.walk((function(e,t,n){e&&r.hasOwnProperty(e.ufid)&&s.push(e),s.length!==o&&n()})),s}return i.map(n,a.getMugByUFID.bind(a))}return n.length?a.getMugByUFID(n[0]):null},L.getCurrentMugInput=function(e){return this.$f.find("[name=property-"+e+"]")},L.mugToXPathReference=function(e){return"Choice"===e.__className?"'"+e.p.nodeID+"'":e.ufid===this.getCurrentlySelectedMug().ufid?".":e.form.richText?e.hashtagPath:e.absolutePath},L.nodeIDFromLabel=function(e){var t=this.getMugDisplayName(e)||"";return t=(t=(t=(t=(t=(t=(t=(t=a("<div/>").html(t).text()).toLowerCase()).trim()).replace(/\s+/g,"_")).replace(/[^\w\-]/g,"")).replace(/^[^a-z]*/i,"")).replace(/_*$/g,"")).substring(0,75),e.form.generate_question_id(t,e)},L.ensureCurrentMugIsSaved=function(e){var t=this.getCurrentlySelectedMug();return this.data.core.hasXPathEditorChanged?(this.alert(gettext("Unsaved Changes in Editor"),gettext("You have UNSAVED changes in the Expression Editor. Please save changes before continuing.")),!1):(t&&!t.p.nodeID&&(t.p.nodeID=this.nodeIDFromLabel(t)),(e||function(){})(),!0)},L.loadXFormOrError=function(e,t,n){t=t||function(){};var i=this;i.opts().core.formLoadingCallback?i.opts().core.formLoadingCallback():F(),window.setTimeout((function(){i.data.core.formLoadingFailed=!1;try{i.data.core.parseWarnings=[],i.loadXML(e,{}),delete i.data.core.parseWarnings,i.data.core.form.fire("form-load-finished"),e?n&&i.data.core.saveButton.fire("change"):(i.$f.find(".fd-content-right .fd-column").addClass("hide"),i.$f.find(".fd-default-panel").removeClass("hide")),i.opts().core.formIconClass?i.$f.find(".fd-form-icon").addClass(i.opts().core.formIconClass):i.$f.find(".fd-form-icon").addClass("fa fa-edit"),i.opts().core.defaultHelpTextTemplateId&&i.$f.find(".fd-default-helptext").html(a(i.opts().core.defaultHelpTextTemplateId).html()).addClass("alert alert-info"),a(".fd-tree .fd-head-text").text(i.data.core.form.formName),i.opts().core.formLoadedCallback?i.opts().core.formLoadedCallback():B()}catch(t){window.console.log(R.formatExc(t));var r=t.toString();-1!==r.indexOf("Invalid XML")&&(r=gettext("Parsing Error. Please check that your form is valid XML.")),i.hideQuestionProperties();var o=i.generateNewModal(gettext("Error"),[],gettext("OK"),"fa fa-warning");throw o.find(".modal-body").text(r),o.modal("show"),i.data.core.formLoadingFailed=!0,i.data.core.failedLoadXML=e,i.opts().core.formLoadedCallback?i.opts().core.formLoadedCallback():B(),t}t()}),this.opts().core.loadDelay)},L.loadXML=function(e,t){var n,r=this,o=window.location.hash;r.data.core.$tree.children().children().each((function(e,t){r.jstree("delete_node",t)})),t=i.extend({mugTypes:this.data.core.mugTypes,allowedDataNodeReferences:this.opts().core.allowedDataNodeReferences,enableInstanceRefCounting:!0},t),this.data.core.form&&this.data.core.form.disconnectDataSources(),this.data.core.form=n=y.parseXForm(e,t,this,r.data.core.parseWarnings),this.onXFormLoaded(n),e&&(r._resetMessages(r.data.core.form.errors),r._populateTree(o)),n.on("question-type-change",(function(e){r.jstree("set_type",e.mug.ufid,e.qType),e.mug===r.getCurrentlySelectedMug()&&r.refreshCurrentMug()})).on("parent-question-type-change",(function(e){r.jstree("set_icon",e.childMug.ufid,e.childMug.getIcon())})).on("question-remove",(function(e){e.mug&&(e.mug.unbind(r.data.core),e.mug===r._propertiesMug&&(r._propertiesMug.teardownProperties(),r._propertiesMug=null));var t=r.getCurrentlySelectedMug();if(e.mug&&e.mug.parentMug&&e.mug.parentMug===t&&r.displayMugProperties(t),!e.isInternal){var i=r.jstree("get_prev_dom",e.mug.ufid);r.jstree("delete_node",e.mug.ufid),i?r.jstree("select_node",i):r.selectSomethingOrHideProperties()}e.mug._node_control=void 0,a(".fd-undo").click((function(){return r.ensureCurrentMugIsSaved(n.undo.bind(n)),!1})),a(".fd-undo-container").on("click",".close",(function(){n.undomanager.resetUndo()}))})).on("question-create",(function(e){r.handleNewMug(e.mug,e.refMug,e.position),r.setTreeActions(e.mug);var t=r.getCurrentlySelectedMug();e.mug&&e.mug.parentMug&&e.mug.parentMug===t&&r.displayMugProperties(t),e.isInternal||r.setCurrentMug(e.mug)})).on("change",(function(e){r.onFormChange(e.mug)})).on("question-label-text-change",(function(e){r.refreshMugName(e.mug),r.toggleConstraintItext(e.mug)})).on("change-display-language",(function(e){var t=r.getCurrentlySelectedMug();t&&r.refreshMugName(t)})).on("mug-property-change",(function(e){r.refreshMugName(e.mug),r.toggleConstraintItext(e.mug),"comment"===e.property&&e.val&&(r.$f.find(".fd-question-comment").show(),r.$f.find(".fd-question-comment").text(e.val))}))},L.onXFormLoaded=function(e){e.warnWhenChanged=this.opts().core.hasSubmissions,e.submissionUrl=this.opts().core.hasSubmissionsUrl},L.refreshMugName=function(e){var t=this.getMugDisplayName(e);t!==this.jstree("get_text",e.ufid)&&this.jstree("rename_node",e.ufid,t);var n=this.getCurrentlySelectedMug();n&&e.ufid===n.ufid&&this.$f.find(".fd-question-properties .fd-head h2").html(t)},L.toggleConstraintItext=function(e){var t=this.getCurrentlySelectedMug();if(!t||t.ufid===e.ufid){var n=e.p.constraintMsgItext&&(!e.p.constraintMsgItext.isEmpty()||e.p.constraintAttr),i=a(".itext-block-constraintMsg");n?i.removeClass("hide"):i.addClass("hide")}},L._populateTree=function(e){var t=this;this.data.core.form.walkMugs((function(e){t.handleMugParseFinish(e),t.createQuestion(e,e.parentMug,"into")&&(!e.validate()&&e.hasErrors()&&t.setTreeValidationIcon(e),t.setTreeActions(e))})),t.selectSomethingOrHideProperties(!0,e)},L.selectSomethingOrHideProperties=function(e,t){if(e&&this.jstree("deselect_all"),!this.jstree("get_selected").length){var n,i=this.data.core.$tree.find("li");if(t){var a=this.getMugByPath(t)||void 0,r=a&&a.ufid;r&&(n=i.filter("[id= "+r+"]"))}return n&&n.length>0?(this.jstree("select_node",n[0]),this.scrollTreeTo(n[0].id),!0):i.length>0?(this.jstree("select_node",i[0]),this.scrollTreeTo(i[0].id),!0):(this.jstree("deselect_all"),this.hideQuestionProperties(),this.$f.find(".fd-content-right .fd-column").addClass("hide"),this.$f.find(".fd-default-panel").removeClass("hide"),!1)}return!0},L.addQuestion=function(e,t,n){var i,a=this;return this.ensureCurrentMugIsSaved((function(){if(t){if(!/^(before|after|into|first|last)$/.test(t))throw new Error("bad position: "+t);if(!a.isInsertAllowed(e,t,n))throw new Error("cannot insert "+e+" "+t+" "+(n?n.hashtagPath:"root node"))}else{var r=a.getInsertTargetAndPosition(a.getCurrentlySelectedMug(),e);if(!r)throw new Error("cannot add "+e+" at the current position");t=r.position,n=r.mug}x.workflow("Added question in form builder"),i=a.data.core.form.createQuestion(n,t,e),a.scrollTreeTo(i.ufid),a.focusFirstInput()})),i},L.focusFirstInput=function(){var e=this.$f.find(".fd-question-properties .form-group:first");if(e.length){var t=e.find("input, textarea");t.length?t.focus():(t=e.find(".fd-textarea, .fd-input"),b.editor(t).focus())}},L.adjustToWindow=function(){this.data.windowManager.adjustToWindow()},L.getInsertTargetAndPosition=function(e,t,n){for(var i,a=n?"after":"last";e;){if("after"===a){if(!(i=e.parentMug)){if(!this.isInsertAllowed(t,a,e))return null;break}}else i=e;if(this.jstree("is_closed",i.ufid))e=i,a="after";else{if(-1!==M[i.__className].valid_children.indexOf(t))break;"after"!==a?a="after":e=e.parentMug}}return e||this.isInsertAllowed(t,a,e)?{mug:e,position:a}:null},L.isInsertAllowed=function(e,t,n){var i="#";if(n)if("after"===t||"before"===t)n.parentMug&&(i=n.parentMug.__className);else{if("into"!==t&&"first"!==t&&"last"!==t)throw new Error("validation of insert "+t+" "+n.__className+" not implemented");i=n.__className}else if("into"!==t&&"first"!==t&&"last"!==t)throw new Error("validation of insert "+t+" root node not implemented");return-1!==M[i].valid_children.indexOf(e)},L.handleNewMug=function(e,t,n){this.createQuestion(e,t,n)},L.createQuestion=function(e,t,n){var i=this;return e.on("messages-changed",(function(e){i.setTreeValidationIcon(e.mug)}),null,null,this.data.core),i.jstree("create_node",t?"#"+t.ufid:"#",{text:this.getMugDisplayName(e),type:e.__className,data:{mug:e,handleDrop:function(t,n){var a=i.mugToXPathReference(e);i.handleDropFinish(t,a,e,n)}},li_attr:{id:e.ufid,rel:e.__className},state:{opened:!0}},"into"===n?"last":n)},L.handleMugParseFinish=function(e){},L.getMugByPath=function(e){return this.data.core.form.getMugByPath(e)},L.setCurrentMug=function(e){this.jstree("deselect_all",!0).jstree("select_node",e.ufid)},L.displayMugProperties=function(e){var t=this.$f.find(".fd-question-properties");this.$f.find(".fd-default-panel").addClass("hide"),this.showContentRight(),t.addClass("hide"),this._setPropertiesMug(e);var n=this.$f.find(".fd-props-content").empty(),r=this.getSections(e),o=a("<div class='messages' />");this.$f.find(".fd-props-toolbar").html(this.getMugToolbar(e));for(var s=0;s<r.length;s++){var l=i.clone(r[s]);l.mug=e,l.properties=i(l.properties).map((function(t){return $(t,e)})).filter(i.identity),l.properties.length&&this.getSectionDisplay(e,l).appendTo(n)}function d(){o.empty().append(I.util.getMessages(e,null))}n.children().length?o.insertAfter(n.children().first()):o.appendTo(n),e.on("messages-changed",d,null,"teardown-mug-properties"),d(),this.$f.find(".fd-content-right .fd-column").addClass("hide"),t.removeClass("hide"),this.adjustToWindow(),this.$f.find(".fd-help a").fdHelp(),this.refreshMugName(e),this.toggleConstraintItext(e)},L._setURLHash=function(e){e&&void 0!==e.getNodeID()&&e.hashtagPath&&e.hashtagPath.startsWith("#")&&!e.hashtagPath.endsWith("/")?window.history.replaceState(null,null,e.hashtagPath):window.history.replaceState(null,null," ")},L._setPropertiesMug=function(e){if(this._propertiesMug){this._propertiesMug.teardownProperties();try{this._propertiesMug.validate()}catch(e){}}this._propertiesMug=e},L.displayMultipleSelectionView=function(){var e=this.getCurrentlySelectedMug(!0);this.showContentRight(),this.hideQuestionProperties(),this._setPropertiesMug(null),this.$f.find(".fd-props-toolbar").html(this.getMugToolbar(e,!0)),this.$f.find(".fd-props-content").empty(),this.showQuestionProperties()},L.showContentRight=function(){this.$f.find(".fd-content-right").show()},L.hideContentRight=function(){this.$f.find(".fd-content-right").hide()},L.showQuestionProperties=function(){this.$f.find(".fd-content-right .fd-column").addClass("hide"),this.$f.find(".fd-question-properties").removeClass("hide")},L.hideQuestionProperties=function(){this.$f.find(".fd-question-properties").addClass("hide")},L.displaySecondaryEditor=function(e){var t=this,n=this.$f.find(".fd-xpath-editor");n.find(".fd-head h2").text(e.headerText),e.DEBUG_MODE=!1,this.hideQuestionProperties();var i=e.done;e.done=function(e){i(e),t.data.core.hasXPathEditorChanged?(t.data.core.hasXPathEditorChanged=!1,n.addClass("hide"),t.refreshCurrentMug()):(n.addClass("hide"),t.showQuestionProperties())};var a=e.change;e.change=function(e){t.data.core.hasXPathEditorChanged=!0,a&&a(e)},t.$f.find(".fd-content-right .fd-column").addClass("hide"),n.removeClass("hide"),e.loadEditor(t.$f.find(".fd-xpath-editor-content"),e)},L.displayXPathEditor=function(e){e.headerText=gettext("Expression Editor"),e.loadEditor=function(e,t){n.e(485).then((function(){var i=[n(4485)];(function(n){n.showXPathEditor(e,t)}).apply(null,i)})).catch(n.oe)},this.displaySecondaryEditor(e)},L.alert=function(e,t,n){if(n=n||[],!this.data.core.isAlertVisible){var i=this;this.data.core.isAlertVisible=!0,n.length||n.push({title:gettext("OK"),defaultButton:!0});var r=this.generateNewModal(e,n,!1,"fa fa-warning");this.data.core.$modal=r,r.removeClass("fade"),t instanceof a?r.find(".modal-body").append(t):r.find(".modal-body").append(a("<p />").text(t)),r.modal("show").on("hide.bs.modal",(function(){i.data.core.isAlertVisible=!1}))}},L.alertUser=function(e){this._resetMessages([{level:"info",message:e}])},L.setTreeValidationIcon=function(e){var t=e.ufid&&this.jstree("get_node",e.ufid);if(t){var n=e.getErrors();if(n.length){var i=n.join("\n").replace(/"/g,"'");t.data.errors='<i class="fd-valid-alert-icon fa fa-warning" title="'+i+'"></i>'}else t.data.errors=null;this.jstree("redraw_node",t)}},L._resetMessages=function(e){var t,n=this.$f.find(".fd-messages");if(e.length>0){t=e[e.length-1];var i=function(){var e;n.html(p({messageType:P[t.level],messages:(e=t.message,"string"!=typeof e&&e instanceof Array||(e=[""+e]),e)})).fadeIn(500)};n.is(":visible")?n.fadeOut(500,i):i()}},L.sectionIsCollapsed=function(e){var t="collapse-"+e.slug;return"main"!==e.slug&&(localStorage.hasOwnProperty(t)?localStorage.getItem(t):e.isCollapsed)},L.collapseSection=function(e,t){var n=a(".fd-question-fieldset[data-slug='"+e+"']"),i=a(".fd-section-changer [data-slug='"+e+"']");t?(n.addClass("hide"),i.removeClass("selected")):(n.removeClass("hide"),i.addClass("selected")),localStorage.setItem("collapse-"+e,t?"1":"")},L.getSectionDisplay=function(e,t){var n=this,i=n.sectionIsCollapsed(t),r=a(u({fieldsetClass:"fd-question-edit-"+t.slug||0,fieldsetTitle:t.displayName,fieldsetSlug:t.slug,isCollapsed:!!i,help:t.help})),o=r.find(".fd-fieldset-content");return t.properties.map((function(t){var i=t.widget(e,a.extend(t.options,{vellum:n,displayXPathEditor:function(e){n.data.core.currentlyEditedProperty=t.options.path,n.displayXPathEditor(e)}}));i.setValue(i.currentValue),i.on("change",(function(){n.onFormChange(e)}));var r=i.getUIElement();I.util.setWidget(r,i),o.append(r),i.refreshMessages()})),r},L.getMugToolbar=function(e,t){var n=this,r=this.data.core.form,o=t?e:[e],s=a(h({comment:t?"":b.sanitizeInput(e.p.comment),isDeleteable:o&&o.length&&i.every(o,(function(e){return n.isMugRemoveable(e,e.hashtagPath)})),isCopyable:!t&&e.options.isCopyable,sections:t?[]:i.chain(n.getSections(e)).rest().filter((function(t){return i.some(i.map(t.properties,(function(t){return $(t,e)})))})).map((function(e){return i.extend({show:!n.sectionIsCollapsed(e)},e)})).value()}));return s.find(".fd-button-remove").click((function(){var e=n.getCurrentlySelectedMug(!0,!0);r.removeMugsFromForm(e),n.refreshCurrentMug()})),t||(s.find(".btn-toolbar.pull-left").prepend(this.getQuestionTypeChanger(e)),e.p.comment&&s.find(".fd-question-comment").show()),s},L.getQuestionTypeChanger=function(e){var t=this,n=this.isMugTypeChangeable(e,e.hashtagPath),i=a(f({currentQuestionIcon:e.getIcon(),currentTypeName:e.options.typeName,questions:n?function(e){for(var n=e.__className,i=t.data.core.mugTypes[n],a=t.data.core.QUESTIONS_IN_TOOLBAR,r=[],o=0;o<a.length;o++){var s=a[o],l=t.data.core.mugTypes[s];n===s||i.typeChangeError(e,s)||!l.isTypeChangeable||l.typeChangeError(e,n)||r.push({slug:a[o],name:l.typeName,icon:l.icon})}return r}(e):[]}));return i.find(".change-question").click((function(n){try{t.changeMugType(e,a(this).data("qtype"))}catch(e){window.alert(R.format(gettext("Sorry, {err}"),{err:e}))}n.preventDefault()})),i.addClass("fd-question-changer"),i},L.changeMugType=function(e,t){this.data.core.form.changeMugType(e,t),this.setTreeActions(e)},L.setTreeActions=function(e){var t=this,n=t.data.core.$tree,i="add_choice";e.options.canAddChoices?n.jstree(!0).add_action(e.ufid,{id:i,class:"fa fa-plus add_choice",text:" "+gettext("Add Choice"),after:!0,selector:"a",event:"click",callback:function(n,i,a,r){t.ensureCurrentMugIsSaved((function(){t.setCurrentMug(e),t.addQuestion("Choice")}))}}):n.jstree(!0).remove_action(e.ufid,i)},L.createXML=function(){return this.data.core.form.createXML()},L.canSerializeXForm=function(e,t){var n=this,i=this.data.core.form,r=this.data.core.currentItextDisplayLanguage,o=i.getSerializationWarnings();if(o.length){var s=a(c({errors:o,displayLanguage:r}));return e=e?" "+gettext("and")+" "+e:"",this.alert(gettext("There are errors in the form"),s,[{title:gettext("Fix Manually"),action:function(){n.data.core.$modal.modal("hide")}},{title:gettext("Fix Automatically")+e,cssClasses:"btn-primary",defaultButton:!0,action:function(){i.fixSerializationWarnings(o),n.data.core.$modal.modal("hide"),t(),n.refreshVisibleData()}}]),!1}return!0},L.validateAndSaveXForm=function(e){var t=this;if(this.canSerializeXForm(gettext("Save"),(function(){t.validateAndSaveXForm(e)}))){var n=this.createXML();try{D.parseXML(n)}catch(r){var i=gettext("It looks like your form is not valid XML. This can often happen if you use a reserved character in one of your questions. Characters to look out for are <, >, and &. You can still save, but you CANNOT LOAD THIS FORM again until you fix the XML by hand. What would you like to do?"),a=t.generateNewModal(gettext("Form Validation Error"),[{title:gettext("Fix the problem (recommended)"),cssClasses:"btn-primary",action:function(){t.closeModal()}},{title:gettext("Save anyway"),cssClasses:"btn-default",action:function(){t.closeModal(),t.send(n,e?"full":null)}}],!1,"fa fa-warning");return a.find(".modal-body").html(i),void a.modal("show")}this.send(n,e?"full":null)}},L.send=function(e,t){var n,a,r=this,o=this.opts().core,s=!1,l="patch"===(t=t||o.saveType)?o.patchUrl:o.saveUrl;if(F(),"patch"===t){s=!0;var d=new K;(n=d.patch_toText(d.patch_make(this.data.core.lastSavedXForm,e))).length>e.length&&o.saveUrl&&(t="full",l=o.saveUrl)}(a="patch"===t?{patch:n}:{xform:e}).case_references=JSON.stringify(this.data.core.form._logicManager.caseReferences()),s&&(a.sha1=N.SHA1(this.data.core.lastSavedXForm).toString()),this.data.core.saveButton.ajax({type:"POST",url:l,data:a,dataType:"json",error:function(){B()},success:function(t){if(s){if("conflict"===t.status){r.data.core.saveButton.fire("change");var n=r.opts().features.full_save_on_missing_conflict_xform;return void(i.isUndefined(t.xform)&&n?r.send(e,"full"):(B(),r.showOverwriteWarning(r.send.bind(r),e,t.xform)))}N.SHA1(e).toString()!==t.sha1&&(k.error("sha1's didn't match"),r.send(e,"full"))}B(),r.opts().core.onFormSave(t),r.data.core.lastSavedXForm=e,r._setURLHash(r._propertiesMug)}})},L.getSections=function(e){return[{slug:"main",displayName:gettext("Basic"),properties:this.getMainProperties(),help:{title:gettext("Basic"),text:"<p>"+R.format(gettext("The {displaytext} appears in the application. This text will not appear in data exports."),{displaytext:"<strong>"+gettext("Display Text")+"</strong>"})+"</p> ",link:"https://confluence.dimagi.com/display/commcarepublic/Form+Builder"}},{slug:"data_source",displayName:gettext("Data Source"),properties:this.getDataSourceProperties(),isCollapsed:!0,help:{title:gettext("Data Source"),text:gettext("You can configure an external data source like a case list or lookup table to use as the choices for a multiple choice question.")}},{slug:"logic",displayName:gettext("Logic"),properties:this.getLogicProperties(),isCollapsed:!0,help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"}},{displayName:gettext("Media"),slug:"content",properties:this.getMediaProperties(),isCollapsed:!0,help:{title:gettext("Media"),text:gettext("This will allow you to add images, audio or video media to a question, or other custom content."),link:"https://confluence.dimagi.com/display/commcarepublic/Multimedia+in+CommCare"}},{slug:"advanced",type:"accordion",displayName:gettext("Advanced"),properties:this.getAdvancedProperties(),isCollapsed:!0,help:{title:gettext("Advanced"),text:gettext("These are advanced settings and are not needed for most applications.  Please only change these if you have a specific need!"),link:"https://confluence.dimagi.com/display/commcarepublic/Application+Building"}}]},L.getMainProperties=function(){return["label","calculateAttr","nodeID","requiredAttr","readOnlyControl","itemsetData","imageSize"]},L.getDataSourceProperties=function(){return[]},L.getMediaProperties=function(){return["mediaItext"]},L.getLogicProperties=function(){return["relevantAttr","constraintAttr","repeat_count","defaultValue","requiredCondition"]},L.getAdvancedProperties=function(){return["dataSource","dataValue","xmlnsAttr","label","hintLabel","constraintMsgAttr","dataParent","appearance","comment"]},L.getMugSpec=function(){return C.baseSpecs},L.isMugRemoveable=function(e,t){return e.options.isRemoveable},L.isPropertyLocked=function(e,t){return!1},L.isMugPathMoveable=function(e){return!0},L.isMugTypeChangeable=function(e,t){return e.options.isTypeChangeable},L.handleMugRename=function(e,t,n,i,a,r,o){e.handleMugRename(t,n,i,a,r,o)},L.duplicateMugProperties=function(e){},L.beforeSerialize=function(){},L.afterSerialize=function(){},L.beforeBulkInsert=function(e){},L.afterBulkInsert=function(e){this.refreshVisibleData()},L.parseDataElement=function(e,t,n,i){return y.parseDataElement(e,t,n,i)},L.parseBindElement=function(e,t,n){y.parseBindElement(e,t,n)},L.parseSetValue=function(e,t,n){y.parseSetValue(e,t,n)},L.getControlNodeAdaptorFactory=function(e){return this.data.core.controlNodeAdaptorMap[e]},L.populateControlMug=function(e,t){return y.populateControlMug(e,t)},L.updateControlNodeAdaptorMap=function(e){},L.contributeToModelXML=function(e,t){},L.contributeToHeadXML=function(e,t){},L.initMediaUploaderWidget=function(e){},L.destroy=function(){},a.vellum.plugin("core",{form:null,loadDelay:500,patchUrl:!1,hasSubmissions:!1,hasSubmissionsUrl:!1,saveUrl:!1,saveType:"full",staticPrefix:"",allowedDataNodeReferences:[],noTextString:"[no text]",onReady:function(){},onFormSave:function(e){},bindBeforeUnload:function(e){a(window).on("beforeunload",e)}},L)}.apply(t,i))||(e.exports=a)},1874:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(705),n(9740)],void 0===(a=function(e,t,n,i){function a(t,n){var a=e(i()),r=a.find("[name=instance-id]"),o=a.find("[name=instance-src]"),s=a.find("[name=query]");function l(){return{id:r.val(),src:o.val(),query:s.val()}}t.empty().append(a),n.source&&(r.val(n.source.id||""),o.val(n.source.src||""),s.val(n.source.query||"")),n.change&&(r.on("change keyup",(function(){n.change(l())})),o.on("change keyup",(function(){n.change(l())})),s.on("change keyup",(function(){n.change(l())})));var d=function(e){t.find(".fd-data-source-editor").hide(),n.done(e)};a.find(".fd-data-source-save-button").click((function(){d(l())})),a.find(".fd-data-source-cancel-button").click((function(){d()})),n.onLoad&&n.onLoad(a)}function r(e){function n(e,i){return t.map(e,(function(e,a){var r=[],o={id:i.id,src:i.src,query:i.query+"/"+a,name:i.name+" - "+(e.name||a)};return t.isEmpty(e.structure)||e.no_option||(r=[o]),r.concat(n(e.structure,o))}))}return t.flatten(t.map(e,(function(e){var t={id:e.id,src:e.uri,query:"instance('"+e.id+"')"+e.path,name:e.name||e.id};return[t].concat(n(e.structure,t))})))}return{advancedDataSourceWidget:function(i,r,o){var s=n.text(i,r),l=n.util.getUIElement,d=n.util.getUIElementWithEditButton,c=s.getValue,u=s.setValue,f=null;function h(){return f.query=c(),f}function p(e){f=e,u(e.query||"")}return s.options.richText=!1,s.getUIElement=function(){var r=d(l(s.input,o),(function(){i.form.vellum.displaySecondaryEditor({source:h(),headerText:o,loadEditor:a,onLoad:function(e){n.util.setWidget(e,s)},done:function(e){t.isUndefined(e)||(p(e),s.handleChange())}})}));return e("<div></div>").append(r)},s.getValue=h,s.setValue=p,s},fixtureWidget:function(i,o,s){var l=gettext("Lookup table was not found in the project"),d=JSON.stringify({src:"",id:"",query:""});function c(e){return!e||t.all(t.map(e,t.isEmpty))}function u(){var e=p();return e?JSON.parse(e):d}function f(e){var t=d;c(e)||(t=JSON.stringify(e),h.equivalentOption(t)||h.addOption(t,l)),g(t),E=!0}var h=n.dropdown(i,o),p=h.getValue,g=h.setValue,m=o.getSource?o.getSource:u,v=o.setSource?o.setSource:f,E=!1;h.options.richText=!1,h.addOption(d,gettext("Loading..."));var T=i.form.vellum.datasources.onChangeReady((function(){var e,n=i.form.vellum.datasources.getDataSources();o.dataSourcesFilter&&(n=o.dataSourcesFilter(n)),E&&(e=u()),h.clearOptions();var a=r(n);h.addOptions(function(e){return t.map(e,(function(e){return{value:JSON.stringify(t.omit(e,"name")),text:e.name}}))}(a)),E&&!c(e)?f(e):a&&a.length&&f(t.omit(a[0],"name")),o.onOptionsLoaded&&o.onOptionsLoaded(n)}));return i.on("teardown-mug-properties",T,null,"teardown-mug-properties"),o.hasAdvancedEditor&&(h.getUIElement=function(){var r=n.util.getUIElementWithEditButton(n.util.getUIElement(h.input,s),(function(){i.form.vellum.displaySecondaryEditor({source:m(i),headerText:s,loadEditor:a,onLoad:function(e){n.util.setWidget(e,h)},done:function(e){t.isUndefined(e)||(v(e,i),h.handleChange())}})}));return r.find(".fd-edit-button").text("..."),e("<div></div>").append(r)}),h.getValue=u,h.setValue=f,h},autocompleteChoices:function(e,n){var i=t.find(e,(function(e){return e.uri===n}));return i?function(e){return e?t.flatten(function e(n){return t.map(n,(function(n,i){return[i].concat(t.map(e(n.structure),(function(e){return i+"/"+e})))}))}(e.structure)):[]}(i):[]},getPossibleFixtures:r}}.apply(t,i))||(e.exports=a)},5304:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(8094),n(705),n(8922),n(1705)],void 0===(a=function(e,t,n,i,a,r){var o={};function s(n){var a=n.$f.find(".fd-external-sources-container"),r=a.find(".fd-external-resource-search input"),o=a.find(".fd-external-sources-tree");n.data.core.databrowser.errorContainer=a,o.on("after_open.jstree",(function(){e(".jstree-anchor").popover()})),o.on("redraw.jstree",(function(){e(".jstree-anchor").popover()})),o.jstree({core:{data:function(e,a){function r(){var e=n.datasources.getDataNodes([]);a.call(o,function(e,n){function a(e,t,a,r){for(var o,s=i.util.getWidget(a,n),l=s.mug.form.richText&&e.hashtag?e.hashtag:e.xpath;t;)t.id&&t.uri&&(o=s.addInstanceRef({id:t.id,src:t.uri}))!==t.id&&(l=s.mug.form.updateInstanceQuery(l,o,t.id)),t=t._parent;n.handleDropFinish(a,l,void 0,r)}var r=50;return t.chain(e).map((function e(n){var i=function(){return t.map(n.getNodes(),e)},o=!!n.recursive||i();return{text:n.name,icon:n.recursive||o.length?"fcc fcc-fd-external-case":"fcc fcc-fd-case-property",state:{opened:!n.recursive&&o.length<=r},children:o,data:{handleDrop:t.partial(a,n,n.sourceInfo),getNodes:n.recursive?i:null},a_attr:{"data-content":n.description,"data-container":"body","data-trigger":"hover"}}})).map((function e(n){var i=t.filter(n.children,(function(e){return e.children.length}));return n.children=t.filter(n.children,(function(e){return 0===e.children.length})),i=t.flatten(t.map(i,e)),[n].concat(i)})).flatten().value()}(e,n))}var o=this;e.data&&e.data.getNodes?a.call(this,e.data.getNodes()):n.datasources.isReady()?r():n.datasources.on("change",r,null,"change")},worker:!1,multiple:!1,check_callback:function(e,t,n,i,a){return!1}},search:{show_only_matches:!0},conditionalevents:{should_activate:function(){return!1}},plugins:["themes","conditionalevents","dnd","search"]}),r.keyup(t.debounce((function(){o.jstree(!0).search(r.val())}),250))}function l(t){var n=t.$f.find(".fd-accessory-pane"),i=n.find(".fd-head-external-sources").outerHeight(!0);if(n.height()>i)n.css("height",i+"px"),n.find(".fd-head-external-sources .fd-head-max-indicator i").removeClass("fa-circle-down").addClass("fa-circle-up"),e(window).resize();else{var a=t.$f.find(".fd-tree"),r=t.data.core.databrowser.panelHeight||.33*a.height();n.css("height",r+"px"),n.find(".fd-head-external-sources .fd-head-max-indicator i").removeClass("fa-circle-up").addClass("fa-circle-down"),e(window).resize(),o.initDataBrowser(t)}}return e.vellum.plugin("databrowser",{},{init:function(){var n,i,d,c=this,u=this.$f.find(".fd-tree"),f=this.$f.find(".fd-accessory-pane");c.data.core.databrowser={errorContainer:f,panelHeight:null},o.initDataBrowser=t.once(s),f.append(e(r())),n=f.find(".fd-head-external-sources"),i=n.outerHeight(!0)||0,f.data("min-size",i).height(Math.min(.33*u.height(),12*i)).resize((function(){f.height()>i+100&&(c.data.core.databrowser.panelHeight=f.height(),d=f.height()/e(".fd-content-left").height())})),d=f.height()/e(".fd-content-left").height(),e(window).scroll((function(){f.height()>i&&(f.height(e(".fd-content-left").height()*d),c.data.core.databrowser.panelHeight=f.height())})),f.find("#fdExternalSearch").on("keyup keypress",(function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1})),o.initDataBrowser(c),a.preventDoubleScrolling(f.find(".fd-scrollable")),c.datasources.on("error",(function(e){var t=c.data.core.databrowser.errorContainer;if(t){var n=gettext("Could not load app properties.")+"<br>";400===e.xhr.status?n+=e.xhr.responseText:n+=gettext("If this error persists, please report an issue."),t.find(".fd-external-sources-error").removeClass("hide").find(".help-block").html(n),t.find(".fd-external-sources-tree").addClass("hide")}}));var h=t.partial(l,c);f.parent().find(".fd-external-sources-divider").clickExceptAfterDrag(h),n.click(h)}}),o}.apply(t,i))||(e.exports=a)},5382:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(8094)],void 0===(a=function(e,t,n){var i={};function a(i){function r(e){i.cache={sources:e.length?e:[{id:"",uri:"",path:"",name:gettext("Not Found"),structure:{}}]},i.loading=!1,i.fire("change")}i.endpoint?t.isString(i.endpoint)?(i.loading=!0,e.ajax({type:"GET",url:i.endpoint,dataType:"json",success:r,error:function(e,t,r){i.fire({type:"error",xhr:e,errorType:t,error:r}),window.console.log(n.formatExc(r||t)),i.retryTimeout<8001&&(setTimeout((function(){a(i)}),i.retryTimeout),i.retryTimeout=2*i.retryTimeout)},data:{}})):i.endpoint(r):r([])}function r(e,t,n){var a=e.cache;if(a.hasOwnProperty(t))return a[t];var r=i[t](e);return void 0!==r?(a[t]=r,r):n}return i.sources=function(e){return e.loading||a(e),e.cache.sources},i.dataNodes=function(e){function n(e,t){if(e.length<=t)return e;let n="",i=e;for(;i.length>t;)n+=i.slice(0,t)+"\n",i=i.slice(t,i.length);return n+="\n"+i,n}function i(e,t){let i=e.split(" "),a="";for(let e of i)a+=n(e,t),a+=" ";return a.trim()}function a(n,a,r,s){return function(n,c){if(t.contains(e.invalidCaseProperties,c))return null;var u=a?a+"/"+c:c,f=function(e,n,i,a){var r={name:e.name||n,description:e.description||"",recursive:!1},s=e,c=null;if(!e.structure&&e.reference){var u=e.reference;if(s=l[u.source||a.id]){a=t.extend(t.omit(s,"structure"),{_parent:a,hashtag:u.hashtag});var f=i;if(i="instance('"+s.id+"')"+s.path,u.subset_filter&&u.subset_key&&u.subset&&(i+="["+u.subset_key+" = '"+u.subset+"']"),i+="["+u.key+" = "+f+"]",s.subsets&&u.subset){var h={id:u.subset};u.subset_key&&(h.key=u.subset_key),s=t.findWhere(s.subsets,h)||s}var p=s.name||s.id;p&&(r.name=p),d.hasOwnProperty(s.id)?r.recursive=!0:d[s.id]=!0}}return r.getNodes=function(){return null===c&&(c=o(s,i,a)),c},r}(n,c,u,r),h=f.name;return{name:h,description:i(f.description,43),hashtag:r.hashtag&&!s?r.hashtag+"/"+h:null,parentPath:a,xpath:u,index:s||!1,sourceInfo:r,getNodes:f.getNodes,recursive:f.recursive}}}function o(e,n,i){var r=t.chain(e&&e.structure).map((function(e,t){return e.merge?o(e,n+"/"+t,{_parent:i}):a(0,n,i)(e,t)})).flatten().compact().sortBy("text").value();return e&&e.related&&(r=t.chain(e.related).map((function(e,t){var r,o;return r={reference:e},o=e.index||"/index",a(0,n+o,i,!0)(r,t)})).sortBy("text").value().concat(r)),r}var s,l=r(e,"sources"),d={};if(l&&(l=l=t.indexBy(l,"id")).commcaresession){var c=l.commcaresession,u=t.omit(c,"structure"),f="instance('"+c.id+"')"+c.path;s=a(0,null,u)(c,f).getNodes()}return s},i.hashtags=function(e){var n=r(e,"dataNodes");return n?function e(n,i){return t.each(n,(function(t){t.index||(i.nodeMap[t.hashtag||t.xpath]=t),t.hashtag&&!t.index&&(i.map[t.hashtag]=t.xpath,i.transforms[t.sourceInfo.hashtag+"/"]=function(e){return t.parentPath+"/"+e}),t.recursive||e(t.getNodes(),i)})),i}(n,{map:{},nodeMap:{},transforms:{}}):void 0},i.nodeMap=function(e){var t=r(e,"hashtags");return t&&t.nodeMap},i.hashtagMap=function(e){var t=r(e,"hashtags");return t&&t.map},i.hashtagTransforms=function(e){var t=r(e,"hashtags");return t&&t.transforms},{init:function(e,i){var o=n.eventuality({endpoint:e,invalidCaseProperties:i});return o.reset=function(){o.retryTimeout=1e3,o.cache={}},o.isReady=function(){return void 0!==r(o,"sources")},o.getDataSources=function(e){return r(o,"sources",e)},o.getDataNodes=function(e){return r(o,"dataNodes",e)},o.getHashtagMap=function(e){return r(o,"hashtagMap",e)},o.getHashtagTransforms=function(e){return r(o,"hashtagTransforms",e)},o.getNode=function(e,t){var n=r(o,"nodeMap",{});return n.hasOwnProperty(e)?n[e]:t},o.onChangeReady=function(e){var t={};return o.isReady()&&e(),o.on("change",e,null,null,t),function(){o.unbind(t,"change")}},o.reset(),e&&t.isString(e)&&a(o),o}}}.apply(t,i))||(e.exports=a)},9832:(e,t,n)=>{var i,a;i=[n(561),n(3436)],void 0===(a=function(e,t){return{showMenu:function(n,i,a,r){var o={"":gettext("No Formatting"),"%e/%n/%y":"d/m/yy e.g. 30/1/14","%a, %b %e, %Y":"ddd, mmm d, yyyy e.g. Thu, Jan 30, 2014"},s=e(t({formats:o}));e("body").append(s),s.find("li a").click((function(){var t=e(this).data("format");try{a(t)}finally{s.remove()}return!1})),s.css({top:i,left:n}).show(),r&&s.mouseleave((function(){s.fadeOut(400,(function(){s.remove()}))}))}}}.apply(t,i))||(e.exports=a)},2183:(e,t,n)=>{var i,a;i=[n(3946)],void 0===(a=function(e){return e.isUndefined(console)?{log:function(){},error:function(){}}:{log:function(){console.log.apply(console,arguments)},error:function(){console.error.apply(console,arguments)}}}.apply(t,i))||(e.exports=a)},8916:(e,t,n)=>{var i,a;i=[n(3946),n(7867)],void 0===(a=function(e,t){var n="`",i=/^[\w.\-]/;return{escapeDelimiters:function(e){return e.replace(/`/g,"``")},delimit:function(e){if(-1!==e.indexOf(n))throw new Error("cannot delimit: "+e);return n+e+n},transform:function(e,t,a){if(!e)return e;var r=function(e){for(var t=0,n=e.length,i=[];t<n-1;++t){var a=e.charCodeAt(t);a>=55296&&a<=56319&&(a=e.charCodeAt(t+1))>=56320&&a<=57343?(i.push(e.slice(t,t+2)),++t):i.push(e.charAt(t))}return i.push(e.charAt(t)),i}(e);t=t||function(e){return e};for(var o=0,s=r.length,l="",d="",c=0;c<s;c++){var u=r[c],f=r[c+1];0===o?u===n&&f===n?(l+=n,c++):u===n?o=1:l+=u:1===o&&(u===n?(o=0,l+=t(d),!a&&f&&i.test(f)&&(l+=" "),d=""):void 0!==f&&(d+=u))}return 1===o&&(l+=n+d),l},makeHashtagTransform:function(n){function i(e){var t=e.toHashtag;return e.toHashtag=function(e){var n=t(e);return null===n?null:s(n)},e}var a=t.makeXPathModels(n,i),r=t.createParser(a),o=a.HashtagExpr,s=e.identity;return a.HashtagExpr=function(e){return o.call(this,e),i(this),this},function(t,n){s=n;try{return r.parse(t).toHashtag()}catch(e){return t}finally{s=e.identity}}}}}.apply(t,i))||(e.exports=a)},5392:(e,t,n)=>{var i,a;i=[n,n(3946),n(561),n(7026),n(4854),n(4459),n(7867),n(8916),n(6827),n(3629),n(8094),n(3578)],void 0===(a=function(e,t,i,a,r,o,s,l,d,c,u,f){var h,p;n.e(483).then((function(){var e=[n(5081),n(1307)];(function(e,t){h=e,p=t}).apply(null,e)})).catch(n.oe);var g=function(e,n,i,a){var r={},o={};return r.attributes=e,r.children=n||[],r.addReference=function(e,t){o&&(e?(o[e.ufid]||(o[e.ufid]={}),o[e.ufid][t||"."]=null):o=null)},r.dropReference=function(e,n){return!(!o||!o[e.ufid])&&(n?(delete o[e.ufid][n],t.isEmpty(o[e.ufid])&&delete o[e.ufid]):delete o[e.ufid],t.isEmpty(o))},t.isUndefined(i)||r.addReference(i,a),r},m=/(^)instance\((['"])([^'"]+)\2\)/i,v=/^#([^\/]+)/;function E(e,n,i){var o=this;this.setValues=[],this._setValueId=1,this._logicManager=new r.LogicManager(this,{allowedDataNodeReferences:e.allowedDataNodeReferences}),this.vellum=n,this.mugTypes=i,this.formName=n.opts().core.formName||gettext("New Form"),this.noMarkdown=!1,this.mugMap={},this.instanceMetadata=[g({})],this.knownInstances={},this.richText=!!n.opts().features.rich_text,this.mayDisableRichText=this.richText,this._inferHashtags=function(e){function n(e,t){function n(e){return t+"/"+e}return[e,function(t){return d[e]=n,n(t)}]}var i="instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]",a="instance('casedb')/cases/case[@case_id = "+i+"/index/parent]",r="instance('casedb')/cases/case[@case_id = "+a+"/index/parent]",o={hashtagTransformations:t.object([n("#case/",i),n("#case/parent/",a),n("#case/grandparent/",r),n("#user/","instance('casedb')/cases/case[@case_type = 'commcare-user'][hq_user_id = instance('commcaresession')/session/context/userid]")])},l=null,d=null,c=s.parser(o,(function(e){var t=e.hashtagToXPath;return e.hashtagToXPath=function(e){var n=t(e);return n!==o.hashtagMap[e]&&(o.hashtagMap[e]=n,l[e]=n),n},e}));return function(n,i){var a;l={},d={},o.hashtagMap=t.clone(e.hashtagMap),o.hashtagNamespaces=e.hashtagNamespaces;try{a=c.parse(n).toXPath()}catch(e){window.console.log(u.formatExc(e))}a===i&&t.some(l)&&(t.each(l,(function(t,n){e.initHashtag(n,t)})),t.each(d,(function(t,n){e.hashtagTransformations.hasOwnProperty(n)||(e.hashtagTransformations[n]=t)})))}}(this),this.shouldInferHashtags=this.richText,n.datasources.on("change",this._updateHashtags.bind(this),null,null,this),this._updateHashtags(),this.transformHashtags=l.makeHashtagTransform(this),this.tree=new a("data","control"),this.addHashtag("#form","/data"),this.tree.on("change",(function(e){o.fireChange(e.mug)})),this.enableInstanceRefCounting=e.enableInstanceRefCounting,this.errors=[],this.question_counter=1,this.xpath=s.parser(this),this.undomanager=new c,this.undomanager.on("reset",(function(e){o.vellum.adjustToWindow()})),u.eventuality(this),this.on("form-load-finished",(function(){o.fuse=new d(o)})).on("question-create",(function(){o.undomanager.resetUndo()})),this.disconnectDataSources=function(){n.datasources.unbind(o,"change")}}return E.prototype={_updateHashtags:function(){var e=this,n=e.vellum,i=e.hashtagMap;e.hashtagNamespaces={form:!0},e.richText?(e.hashtagMap=t.clone(n.datasources.getHashtagMap({})),e.invertedHashtagMap=t.invert(e.hashtagMap),e.hashtagTransformations=n.datasources.getHashtagTransforms({}),e.hasCaseHashtags=n.datasources.isReady(),e.shouldInferHashtags=!e.hasCaseHashtags,t.each(e.hashtagTransformations,(function(t,n){e.hashtagNamespaces[v.exec(n)[1]]=!0}))):(e.hashtagMap={},e.invertedHashtagMap={},e.hashtagTransformations={}),e.updateKnownInstances(t.chain(n.datasources.getDataSources([])).map((function(e){return[e.id,e.uri]})).object().value()),i&&t.each(i,(function(t,n){n.startsWith("#form/")&&e.addHashtag(n,t)})),e.fixBrokenReferences(),this._logicManager.validateExternalReferences()},inferHashtagMeanings:function(e,t){e&&s&&this.shouldInferHashtags&&this._inferHashtags(e,t)},isValidHashtag:function(e){return e=this.normalizeHashtag(e),this.hashtagMap.hasOwnProperty(e)},hasValidHashtagPrefix:function(e){var t=e.lastIndexOf("/");return-1!==t&&e.length>t+1&&this.hashtagTransformations.hasOwnProperty(e.substring(0,t+1))},addHashtag:function(e,t){this.hashtagMap[e]=t,this.invertedHashtagMap[t]=e},initHashtag:function(e,t){this.hashtagMap[e]||(this.addHashtag(e,t),this.hashtagNamespaces[v.exec(e)[1]]=!0)},removeHashtag:function(e){this.hashtagMap.hasOwnProperty(e)&&(delete this.invertedHashtagMap[this.hashtagMap[e]],delete this.hashtagMap[e])},normalize:function(e,t,n){if(!t||this.richText&&o.isInvalid(t))return t;try{return this.xpath.parse(t)[e]()}catch(e){return n?null:t}},normalizeHashtag:function(e,t){return this.normalize("toHashtag",e,t)},normalizeXPath:function(e){return this.normalize("toXPath",e)},getHashtagsInXPath:function(e){try{return new r.LogicExpression(e,this.xpath).getHashtags()}catch(e){return[]}},getLogicalXPath:function(e){var t=e,n=this;if(e=String(e),t&&n.richText&&function(e){if(!o.isInvalid(e))return!1;var t=o.unescapeHashtags(e,n);if(t)try{n.xpath.parse(t)}catch(t){if(/\bExpecting '.+', got 'LBRACK'$/.test(String(t)))return/`#[\w/]+`\s*\[.+\]/.test(e)}return!1}(e)){e=o.unescapeXPath(e,n);try{return n.xpath.parse(e),e}catch(e){}}return t},knownExternalReferences:function(){return this._logicManager.knownExternalReferences()},knownHashtagTransforms:function(){var e={},n=this.hashtagTransformations;return t.isEmpty(this.hashtagTransformations)||(e.prefixes=t.object(t.map(n,(function(e,t){return[t,e("")]})))),e},referenceHashtag:function(e,t,n){this.hasValidHashtagPrefix(e)&&(this.referenceInstance("casedb",t,n),this.referenceInstance("commcaresession",t,n))},dataTree:function(){var e=this.getBasePath().slice(1,-1),n=new a(e,"data"),i={},r=this;return this.tree.walk((function(e,t,a){if(e){if(e.options.isControlOnly)return;if(e.p.dataParent){var r=e.p.dataParent;i[r]?i[r].push(e):i[r]=[e]}else n.insertMug(e,"into",e.parentMug)}a()})),t.each(i,(function(e,t){for(var i=r.mugMap[r.normalizeHashtag(t)],a=0,o=e.length;a<o;a++)n.insertMug(e[a],"into",i)})),n},getBasePath:function(e){return"/"+this.tree.getRootNode().getID()+(e?"":"/")},fireChange:function(e){this.fire({type:"change",mug:e})},addInstanceIfNotExists:function(e,n,i){var a;if(e.src){if(!(a=t.find(this.instanceMetadata,(function(t){return t.attributes.src===e.src})))){var r=t.indexBy(this.instanceMetadata,(function(e){return e.attributes.id}));(a=e.id&&r.hasOwnProperty(e.id)?r[e.id]:null)&&a.internal?(a.internal=!1,a.attributes.src=e.src):((e=t.clone(e)).id=function(e,t){for(var n=(e||"data")+"-",i=1;!e||t.hasOwnProperty(e);)e=n+i,i++;return e}(e.id,r),a=null),this.knownInstances[e.id]={src:e.src}}}else{if(!e.id)throw new Error("unsupported: non-primary instance without id or src");(a=t.find(this.instanceMetadata,(function(t){return t.attributes.id===e.id})))?a.internal&&this.knownInstances.hasOwnProperty(e.id)&&(a.internal=!1,a.attributes.src=this.knownInstances[e.id].src):this.knownInstances.hasOwnProperty(e.id)&&t.defaults(e,this.knownInstances[e.id])}return a?(this.enableInstanceRefCounting&&a.addReference(n,i),a.attributes.id):(a=g({src:e.src,id:e.id},e.children,n||null,i),e.src||e.children||(a.internal=!0),this.instanceMetadata.push(a),e.id)},parseInstance:function(e,n,i){var a=e.match(m),r=null;if(a){var o=a[3],s=this.referenceInstance(o,n,i);s&&(r=t.clone(s.attributes))}return r},parseInstanceRefs:function(e,n,a){var o=new r.LogicExpression(e,this.xpath),s=this.knownInstances,l={};return o.analyze(),t.each(o.instanceRefs,(function(e,t){s.hasOwnProperty(t)&&s[t]&&(l[t]=u.extend(s[t]),l[t].children&&(l[t].children=i("<div>").append(l[t].children).html()))})),l},referenceInstance:function(e,n,i){function a(t){return t.attributes.id===e}var r=t.find(this.instanceMetadata,a);return this.enableInstanceRefCounting&&(r?r.addReference(n,i):(e=this.addInstanceIfNotExists({id:e},n,i),r=t.find(this.instanceMetadata,a))),r||null},updateInstanceQuery:function(e,t,n){var i=m;return n&&(i=new RegExp("(^|\\W)instance\\((['\"])"+RegExp.escape(n)+"\\2\\)","ig")),e.replace(i,"$1instance('"+t+"')")},updateKnownInstances:function(e){var n=this.knownInstances;if(e){var a=t.indexBy(this.instanceMetadata,(function(e){return e.attributes.id}));t.each(e,(function(e,r){if(e&&!n.hasOwnProperty(r)){e.children?n[r]={children:i(e.children)}:t.isString(e)?n[r]={src:e}:n[r]=e;var o=a[r];o&&o.internal&&(o.internal=!1,o.attributes.src=n[r].src)}}))}else t.each(this.instanceMetadata,(function(e){e.attributes.id&&(e.attributes.src?n[e.attributes.id]={src:e.attributes.src}:e.children&&(n[e.attributes.id]={children:e.children}))}))},dropInstanceReference:function(e,n,i){if(!this.enableInstanceRefCounting||!n)return!1;var a=t.find(this.instanceMetadata,(function(t){return t.attributes.src===e}));return!(!a||!a.dropReference(n,i)||(this.instanceMetadata=t.without(this.instanceMetadata,a),0))},dropAllInstanceReferences:function(e,n){this.instanceMetadata=t.filter(this.instanceMetadata,(function(t){return!t.dropReference(e,n)}))},addSetValue:function(e,n,i){var a=t.find(this.setValues,(function(t){return t.event===e&&t.ref===n}));return a?a.value=i:(a={_id:this._setValueId++,event:e,ref:n,value:i},this.setValues.push(a)),a},getSetValues:function(){return this.setValues},dropSetValues:function(e){this.setValues=t.reject(this.setValues,e)},setFormID:function(e){this.tree.setRootID(e),this.addHashtag("#form","/"+e)},setAttr:function(e,t){this[e]=t,"richText"===e&&t&&!this.hasCaseHashtags&&this._updateHashtags(),this.fire({type:"change"})},createXML:function(){return h.createXForm(this)},getMugList:function(){return this.tree.treeMap((function(e){if(!e.isRootNode)return e.getValue()}))},updateError:function(e){var t,n;if((n={}).message=(t=e).message,n.key=t.key,n.level=t.level||"form-warning",n.options=t,n.isMatch=function(e){return!(!this.key||!e.key)&&this.key===e.key},(e=n).key){for(var i=null,a=0;a<this.errors.length;a++)e.isMatch(this.errors[a])&&(i=this.errors.splice(a,1,e));i||this.errors.push(e)}else this.errors.push(e)},getSerializationWarnings:function(){var e=[];return this.walkMugs((function(t){var n=t.getSerializationWarnings();n.length&&e.push({mug:t,errors:n})})),e},fixSerializationWarnings:function(e){t.each(e||[],(function(e){e.mug.fixSerializationWarnings(e.errors)}))},isFormValid:function(e){return this.tree.isTreeValid(e)},findFirstMatchingChild:function(e,n){var i=e?this.tree.getNodeFromMug(e):this.tree.rootNode;return t.find(i.getChildrenMugs(),n)},insertMug:function(e,t,n){this.tree.insertMug(t,n,e)},moveMug:function(e,t,n){var i,a,r,o,s;if("rename"===t){if(i=n,!this.tree.getNodeFromMug(e))return void e.p.set("nodeID",i);a=e.p.nodeID,r=e.hashtagPath,o=s=e.parentMug}else{a=e.p.nodeID,r=e.hashtagPath,o=e.parentMug,this.insertMug(n,e,t);var l=e.spec.dataParent;l&&"pass"!==l.validationFunc(e)&&e.p.set("dataParent"),i=e.p.conflictedNodeId||a,s=e.parentMug}e.options.isControlOnly||(this.findFirstMatchingChild(s,(function(t){return t!==e&&t.p.nodeID===i}))?(e.p.conflictedNodeId=i,i=this.generate_question_id(i,e)):e.p.has("conflictedNodeId")&&(e.p.conflictedNodeId=null),e.p.nodeID!==i&&e.p.set("nodeID",i));var d=e.hashtagPath;this.vellum.handleMugRename(this,e,i,a,d,r,o),"rename"!==t&&this.fireChange(e)},walkMugs:function(e){this.tree.walk((function(t,n,i){null!==t&&e(t),i()}))},getDescendants:function(e){var t,n=this.getChildren(e);for(t=n.length-1;t>=0;t--)n=n.concat(this.getDescendants(n[t]));return n},handleMugRename:function(e,n,i,a,r,o){if(this._logicManager.updatePath(e.ufid,r,a),a){for(var s,l,d=this.getDescendants(e).concat([e]),c=t(d).map((function(e){return e.hashtagPath})),u=new RegExp("^"+RegExp.escape(a)+"/"),f={},h=0;h<d.length;h++)c[h]&&(s=(l=c[h])===a?r:l.replace(u,r+"/"),f[d[h].ufid]=[s,c[h]],this._updateMugPath(d[h],s,c[h]));if(this._logicManager.updatePaths(f),this.fixBrokenReferences(),i&&"Choice"!==e.__className){var p=this.findFirstMatchingChild(o,(function(e){return e.p.conflictedNodeId===i}));p&&this.moveMug(p,"rename",i)}}},changeMugType:function(e,t){this.mugTypes.changeType(e,t)},getChildren:function(e){var t=this.tree.getNodeFromMug(e);return(t?t.getChildren():[]).map((function(e){return e.getValue()}))},duplicateMug:function(e){var t=this._duplicateMug(e,e.parentMug),n=t[0],i=t[1];f.workflow("Form Builder","Copy",n.options.typeName);for(var a=0;a<i.length;a++){var r=i[a];this._logicManager.updatePath(r.mugId,r.from,r.to,n.hashtagPath)}return n},_duplicateMug:function(e,t,n){n=n||0;var i=this.mugTypes.make(e.__className,this,e);if(0===n){var a=e.p.nodeID;i.p.conflictedNodeId?i.p.conflictedNodeId=null:i.p.nodeID=this.generate_question_id(a,e),this.insertQuestion(i,e,"after",!0)}else this.insertQuestion(i,t,"into",!0);this.updateLogicReferences(i),this.vellum.duplicateMugProperties(i);for(var r=this.getChildren(e),o=[],s=0;s<r.length;s++)o=o.concat(this._duplicateMug(r[s],i,n+1)[1]);return o.push({mugId:e.ufid,from:e.hashtagPath,to:i.hashtagPath}),[i,o]},updateLogicReferences:function(e,t,n){this._logicManager.updateReferences(e,t,n)},shouldMugPropertyChange:function(e,t,n,i){return this.isLoadingXForm?function(){}:function(){e.fire({type:"property-changed",property:t,val:n,previous:i});var a={type:"mug-property-change",mug:e,property:t,val:n,previous:i};e.validate(t),this.fire(a),this.fireChange(e)}.bind(this)},createQuestion:function(e,t,n,i){var a=this.mugTypes.make(n,this);return i&&!a.options.isControlOnly&&(a.p.nodeID=this.generate_question_id()),"Choice"===a.__className&&(a.p.nodeID=""),this.insertQuestion(a,e,t,i),"Choice"===a.__className&&(a.dropMessage("labelItext","mug-labelItext-error"),a.dropMessage("nodeID","mug-nodeID-error")),a},insertQuestion:function(e,t,n,i){this.mugMap[e.ufid]=e,t=t||this.tree.getRootNode().getValue(),this.insertMug(t,e,n),this._updateMugPath(e),this.fire({type:"question-create",mug:e,refMug:t,position:n,isInternal:i}),i||e.options.afterInsert(this,e)},_updateMugPath:function(e,n,i){var a,r=this.mugMap;delete r[this.normalizeHashtag(n)],n&&this.removeHashtag(n),t.isUndefined(i)?(a=e.absolutePath,i=e.hashtagPath):(a=i.replace(/^#form/,this.getBasePath(!0)))===i&&(a=null),i&&(a&&this.addHashtag(i,a),r[this.normalizeHashtag(i)]=e)},_fixMugState:function(e){this.mugMap[e.ufid]=e;var t=e.absolutePath;t&&(this.addHashtag(e.hashtagPath,t),this.mugMap[this.normalizeHashtag(e.hashtagPath)]=e)},fixBrokenReferences:function(){var e=this.updateLogicReferences.bind(this);this._logicManager.forEachBrokenReference(e)},hasBrokenReferences:function(){return this._logicManager.hasBrokenReferences()},isReferencedByOtherMugs:function(e,n){var i=t.object(t.map(n,(function(e){return[e.ufid,null]})));return i[e.ufid]=null,this._logicManager.hasReferencingMug(e,(function(e){return!i.hasOwnProperty(e.ufid)}))},getAbsolutePath:function(e,t){return e&&!e.options.isControlOnly?this.tree.getAbsolutePath(e,t):null},getMugByUFID:function(e){return this.mugMap[e]},getMugByPath:function(e){return e?this.mugMap[this.normalizeHashtag(e)]:null},getIconByPath:function(e){var t=this.getMugByPath(e);return t?t.getIcon():null},removeMugsFromForm:function(e){var n=this,i={},a={};this.undomanager.resetUndo(),n._addToUndoManager(e),t.each(e,(function(e){n._removeMugFromForm(e,a,!1)})),this._logicManager.forEachReferencingProperty(a,(function(e,t){e&&!i.hasOwnProperty(e.ufid+" "+t)&&(i[e.ufid+" "+t]=null,n.updateLogicReferences(e,t))}))},_addToUndoManager:function(e){var n=this.tree,i={},a=[];t.each(e,(function e(t){if(!i.hasOwnProperty(t.ufid)){i[t.ufid]=null;var r=n.getNodeFromMug(t),o=t.parentMug,s=t.previousSibling,l=s===o?"first":"after";if(a.push([t,s,l]),r){var d=r.getChildrenMugs();d.length;for(var c=0;c<d.length;c++)e(d[c])}}})),this.undomanager.setUndo(a)},_removeMugFromForm:function(e,n,i){if(!n.hasOwnProperty(e.ufid)){n[e.ufid]=null;var a=this.tree.getNodeFromMug(e);if(a){for(var r=a.getChildrenMugs(),o=0;o<r.length;o++)this._removeMugFromForm(r[o],n,!0);delete this.mugMap[this.normalizeHashtag(e.hashtagPath)],this.tree.removeMug(e)}this.enableInstanceRefCounting&&(this.instanceMetadata=t.filter(this.instanceMetadata,(function(t){return!t.dropReference(e)}))),this._logicManager.clearReferences(e),delete this.mugMap[e.ufid],this.fire({type:"question-remove",mug:e,isInternal:i})}},isUniqueQuestionId:function(e,n){var i;if(n){var a=this.tree.getNodeFromMug(n);i=this.tree.getParentNode(a).getChildrenMugs()}else i=this.getMugList();return!t.any(i,(function(t){return t.p.nodeID===e}))},generate_question_id:function(e,t){if(!e)return this._make_label(t&&"Choice"===t.__className?"choice":"question",t);var n=/^copy-(\d+)-of-(.+)$/.exec(e);n&&(e=n[2]);for(var i=e,a=1;;a++){if(this.isUniqueQuestionId(i,t))return i;i="copy-"+a+"-of-"+e}},generate_item_label:function(e,n,i){var a,r=(e?this.tree.getNodeFromMug(e):this.tree.rootNode).getChildrenMugs();n||(n="choice"),arguments.length<3&&(i=r.length+1);do{a=n+i++}while(t.any(r,(function(e){return e.p.nodeID===a})));return a},_make_label:function(e,t){var n;do{n=e+this.question_counter,this.question_counter+=1}while(!this.isUniqueQuestionId(n,t));return n},getExportTSV:function(){this.vellum.beforeSerialize();var e=p.generateExportTSV(this);return this.vellum.afterSerialize(),e},undo:function(){this.undomanager.undo(),this.fixBrokenReferences(),this.vellum.selectSomethingOrHideProperties()},findUsages:function(e){return this._logicManager.findUsages(e)}},{Form:E,InstanceMetadata:g}}.apply(t,i))||(e.exports=a)},6827:(e,t,n)=>{var i,a;i=[n(3946),n(375),n(8094)],void 0===(a=function(e,t,n){var i={keys:["displayPath"],tokenize:!0,tokenSeparator:/\/+/g,threshold:.4};function a(n){var a=this;function s(e){l(e),a.dataset.push(r(e.mug)),a.fusejs.set(a.dataset)}function l(t){a.dataset=e.filter(a.dataset,(function(e){return e.id!==t.mug.ufid}))}this.form=n,n.vellum.datasources.on("change",(function(){a.dataset=o(n),a.fusejs.set(a.dataset)}),null,null,n),n.on("change",(function(e){void 0===e.mug&&(a.dataset=o(n),a.fusejs.set(a.dataset))})),this.dataset||(this.dataset=o(n)),this.fusejs=new t(this.dataset,i),this.form.on("mug-property-change",(function(e){"nodeID"===e.property&&s(e)})).on("question-label-text-change",s).on("question-create",s).on("question-remove",l)}function r(e){if(e){var t=e.form.vellum.getMugDisplayName(e);return{id:e.ufid,name:e.absolutePath,hashtagPath:e.hashtagPath,absolutePath:e.absolutePath,displayPath:e.form.richText?e.hashtagPath:e.absolutePath,icon:e.options.icon,questionId:e.p.nodeID,displayLabel:n.truncate(t),label:t,mug:e}}return null}function o(t){var n=[];return t.richText&&(n=e.chain(t.vellum.datasources.getHashtagMap({})).map((function(e,t){return{name:t,hashtagPath:t,absolutePath:e,icon:"fcc fcc-fd-case-property",displayLabel:null,displayPath:t}})).value()),e.chain(t.getMugList()).map(r).filter((function(t){return t.name&&!e.isUndefined(t.displayLabel)})).value().concat(n)}return a.prototype={list:function(){return this.fusejs.list},search:function(e){return this.fusejs.search(e)}},a}.apply(t,i))||(e.exports=a)},8360:(e,t,n)=>{var i,a;i=[n(3946),n(561),n(7229),n(7417),n(1877)],void 0===(a=function(e,t,n,i){var a=new XMLSerializer,r=n.parseXML,o="parent";t.vellum.plugin("ignore",{},{loadXML:function(n,i){if(this.data.ignore.ignoredNodes=[],n){var o=this,s=[],l=r(n),d=l.find('[vellum\\:ignore="retain"]');if(this.data.ignore.active=d.length,this.data.ignore.active){i.enableInstanceRefCounting=!1,this.data.ignore.ignoredMugs=[];var c=l.find("h\\:xdoc > h\\:head > model").first(),h=c.find("instance").first(),p=l.find("h\\:xdoc > h\\:body, h\\:xdoc > body").first();e.each([c,h,p],(function(e){e.length||window.console.log("WARNING",e.tagName,"not found")})),(d=d.not((function(n,i){var a=e.any(t(i).parents(),(function(n){return h.is(n)||p.is(n)||e.any(d,(function(e){return t(e).is(n)}))}));return a||"bind"!==i.nodeName?a:t(i).parent().is(c)}))).each((function(e,t){o.data.ignore.ignoredNodes.push(function(e){var t,n,i=e,r=[];for(t=u(e,"previous"),n=u(e,"next"),e=e.parentElement;e;)r.unshift(f(e)),e=e.parentElement;var o=a.serializeToString(i).replace(/xmlns="(.*?)"/,"");return{prev:t,next:n,path:r.join(" > "),nodeXML:"\n"+o}}(t)),s.push(t)})),e.each(s,(function(e){e.parentElement.removeChild(e)})),this.__callOld(a.serializeToString(l[0]),i)}else this.__callOld()}else this.__callOld()},createXML:function(){var n=this.__callOld(),i=this.data.ignore.ignoredNodes;if(!this.data.ignore.active)return n;var o=t(r(n));e.each(i,(function(e){"h\\:xdoc > h\\:body"===e.path?e.path="h\\:xdoc > body, h\\:xdoc > h\\:body":"h\\:xdoc > h\\:head"===e.path&&(e.path="h\\:xdoc > head, h\\:xdoc > h\\:head");var t=o.find(e.path),n=r(e.nodeXML)[0].childNodes[0],i=e.prev&&t.find(e.prev),a=e.next&&t.find(e.next);i&&i.length?i.first().after(n):a&&a.length?a.first().before(n):t.append(n)}));var s=0;return a.serializeToString(o[0]).replace(/ xmlns=""/g,"").replace(/ xmlns:vellum="(.+?)"/g,(function(e){return s++?"":e}))},getMugTypes:function(){var e=this.__callOld();return e.normal.Ignored=s,e},parseDataElement:function(e,n,a){if(this.data.ignore.active){var r=t(n);if("retain"===r.xmlAttr("vellum:ignore")){var o=e.mugTypes.make("Ignored",e);return o.p.nodeID=n.nodeName,o.p.rawDataAttributes=i.getAttributes(n),r.children().length?o.p.dataNodeXML=c(r).replace(/^<[^>]+>([^]*)<\/[^>]+>$/,"$1"):o.p.dataNodeXML="",this.data.ignore.ignoredMugs.push(o),o}}return this.__callOld()},parseBindElement:function(e,t,n){if(this.data.ignore.active){n=e.normalizeXPath(n);var a=e.getMugByPath(n);if(a||(a=l(n,e)),a&&"Ignored"===a.__className||"retain"===t.xmlAttr("vellum:ignore")){var r,s;if(a&&"Ignored"===a.__className)r=a.absolutePath,s="mug";else{var c=null;a&&(c=a.options.isSpecialGroup?a:a.parentMug),a=d(e,c),e.tree.insertMug(a,"into",c),e._fixMugState(a),r=c?c.absolutePath:e.getBasePath(!0),s=o,this.data.ignore.ignoredMugs.push(a)}return void a.p.binds.push({path:n.startsWith(r)?n.slice(r.length):n,relativeTo:n.startsWith(r)?s:null,attrs:i.getAttributes(t)})}}this.__callOld()},parseSetValue:function(e,t,n){if(this.data.ignore.active){n=e.normalizeXPath(n);var i=e.getMugByPath(n);if(i||(i=l(n,e)),i&&"Ignored"===i.__className||"retain"===t.xmlAttr("vellum:ignore")){if(i&&"Ignored"===i.__className)i.absolutePath;else{var a=null;i&&(a=i.options.isSpecialGroup?i:i.parentMug),i=d(e,a),e.tree.insertMug(i,"into",a),e._fixMugState(i),a?a.absolutePath:e.getBasePath(!0),this.data.ignore.ignoredMugs.push(i)}return void i.p.setValues.push({ref:t.xmlAttr("ref"),event:t.xmlAttr("event"),value:t.xmlAttr("value")})}}this.__callOld()},getControlNodeAdaptorFactory:function(e){var t=this.__callOld();if(this.data.ignore.active){var n=this.data.ignore.ignoredMugs;return function(e,a,r,o){function s(){var t;return u&&"Ignored"===u.__className||(u=d(r,o),n.push(u)),(t=e).length&&t[0].poppedAttributes&&t.xmlAttr(t[0].poppedAttributes),u.p.controlNode=c(e),u}s.skipPopulate=!0;var l=i.getPathFromControlElement(e,r,o,!0),u=r.getMugByPath(l);if("retain"===e.xmlAttr("vellum:ignore"))return s.ignoreDataNode=u&&"Ignored"!==u.__className,s;if(u&&"Ignored"===u.__className)return s;var f=Array.prototype.slice.call(arguments);return t&&t.apply(null,f)}}return t},getSections:function(e){return this.data.ignore.active&&"Ignored"===e.__className?[{slug:"advanced",type:"accordion",displayName:"Advanced",properties:["nodeID"],isCollapsed:!0,help:{title:gettext("Advanced"),text:gettext("This question represents advanced content that is not supported by the form builder. Please only change it if you have a specific need!")}}]:this.__callOld()},handleMugRename:function(t,n,i,a,r,o){if(this.__callOld(),this.data.ignore.active&&o){o=o.replace(/^#form\//,t.getBasePath(!0)+"/"),r=t.normalizeXPath(r);var s=RegExp.escape(o),l=new RegExp(s+"(\\W|$)","g"),d=r+"$1";e.each(this.data.ignore.ignoredNodes,(function(e){e.nodeXML=e.nodeXML.replace(l,d)})),e.each(this.data.ignore.ignoredMugs,(function(t){t.p.controlNode&&(t.p.controlNode=t.p.controlNode.replace(l,d)),e.each(t.p.binds,(function(t){t.attrs=e.object(e.map(t.attrs,(function(e,t){return[t,e.replace(l,d)]})))}))}))}}});var s={typeName:gettext("Ignored XML"),icon:"fa fa-question-circle",isTypeChangeable:!1,isRemoveable:!1,isCopyable:!1,ignoreHashtags:!0,isHashtaggable:!1,init:function(e){e.p.binds=[],e.p.setValues=[]},parseDataNode:function(e,n){return t([])},getTagName:function(e,t){return e.p.rawDataAttributes?t:null},writeDataNodeXML:function(e,t){t.p.dataNodeXML&&e.writeXML(t.p.dataNodeXML)},getBindList:function(t){return e.map(t.p.binds,(function(n){var i=e.clone(n.attrs),a="";if("mug"===n.relativeTo)a=t.absolutePath;else if(n.relativeTo===o){var r=t.parentMug;a=r?r.absolutePath:t.form.getBasePath(!0)}return i.nodeset=a+n.path,i}))},getSetValues:function(e){return e.p.setValues},writesOnlyCustomXML:!0,writeCustomXML:function(e,t){t.p.controlNode&&e.writeXML(t.p.controlNode)},spec:{label:{presence:"notallowed"},labelItext:{presence:"notallowed"},labelItextID:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},hintItextID:{presence:"notallowed"},helpItext:{presence:"notallowed"},helpItextID:{presence:"notallowed"},mediaItext:{presence:"notallowed"},otherItext:{presence:"notallowed"},appearance:{presence:"notallowed"}}};function l(e,t){for(var n=null,i=/[\/[][^\/[]+$/;!n&&e&&i.test(e);)(e=e.replace(i,""))&&(n=t.getMugByPath(e));return n}function d(e,t){var n=e.mugTypes.make("Ignored",e);return n.p.nodeID=e.generate_item_label(t,"ignored--",1),n}function c(e){var t=a.serializeToString(e[0]),n=t.indexOf(">");return-1===n?t:t.slice(0,n).replace(/ xmlns(:.*?)?="(.*?)"/g,"")+t.slice(n)}function u(e,t){var n=f(e[t+"ElementSibling"]);return n&&n+", "+n.replace(/\w+:([^:]*)$/,"$1")}function f(e){if(!e)return null;var n=t(e),i=n.xmlAttr("nodeset"),a=n.xmlAttr("ref"),r=n.xmlAttr("id");return"setvalue"===(n.prop("tagName")||"").toLowerCase()?'[event="'+n.xmlAttr("event")+'"][ref="'+a+'"]':i?'[nodeset="'+i+'"]':a?'[ref="'+a+'"]':r?'[id="'+r+'"]':e.nodeName.replace(":","\\:")}}.apply(t,i))||(e.exports=a)},5465:(e,t,n)=>{var i,a;i=[n(4078),n(705),n(8094),n(7229),n(3946),n(561),n(1877)],void 0===(a=function(e,t,n,i,a,r){"use strict";var o,s="http://opendatakit.org/xforms",l=["androidIntentAppId","docTemplate","androidIntentExtra","androidIntentResponse","unknownAttributes","intentXmlns"];function d(e,t){return{androidIntentAppId:t||"",intentXmlns:s,androidIntentExtra:{},androidIntentResponse:{},unknownAttributes:{},nodeID:e}}var c=function(e,t){var n={};return a.each(e.find(t),(function(e){var t,i=r(e),o=i.xmlAttr("key");t=i.xmlAttr("ref"),n.hasOwnProperty(o)?a.isArray(n[o])?n[o].push(t):n[o]=[n[o],t]:n[o]=t})),n},u=function(e,t,i,r){i&&a.each(i,(function(i,o){o&&a.each(a.isArray(i)?i:[i],(function(i){e.writeStartElement(t),e.writeAttributeString("key",o),r?n.writeHashtags(e,"ref",i,r):e.writeAttributeString("ref",i),e.writeEndElement()}))}))};function f(e,t,n){var i,r=(i=t.androidIntentAppId,a.find(o,(function(e){return e.value===i})));e.writeStartElement("odkx:intent"),e.writeAttributeString("xmlns:odkx",t.intentXmlns),e.writeAttributeString("id",t.nodeID),e.writeAttributeString("class",t.androidIntentAppId),r&&r.type&&e.writeAttributeString("type",r.type),a.each(t.unknownAttributes,(function(t,n){e.writeAttributeString(n,t)})),u(e,"extra",t.androidIntentExtra,n),t.docTemplate&&u(e,"extra",{"cc:print_template_reference":"'"+t.docTemplate+"'"}),u(e,"response",t.androidIntentResponse,n),e.writeEndElement("odkx:intent")}function h(e,t){if("AndroidIntent"===t.__className||"PrintIntent"===t.__className){var n=t.p.nodeID,i=e.hasOwnProperty(n)?e[n]:d(n);a.each(l,(function(e){t.p[e]||(t.p[e]=i[e])})),delete e[i.nodeID]}"org.commcare.dalvik.action.PRINT"===t.p.androidIntentAppId?t.form.changeMugType(t,"PrintIntent"):t.p.androidIntentAppId||(t.p.androidIntentAppId=o[0].value),"PrintIntent"===t.__className&&t.p.androidIntentExtra["cc:print_template_reference"]&&(t.p.docTemplate=t.p.androidIntentExtra["cc:print_template_reference"].replace(/^'|'$/g,""),delete t.p.androidIntentExtra["cc:print_template_reference"])}function p(e,t,n,i){i[t]=a.clone(n.p[t]),""===i[t][""]&&delete i[t][""]}var g=n.extend(e.defaultOptions,{typeName:gettext("Android App Callout"),dataType:"intent",tagName:"input",icon:"fcc fcc-fd-android-intent",isTypeChangeable:!1,init:function(e,t){e.p.intentXmlns=e.p.intentXmlns||s},spec:{androidIntentAppId:{lstring:gettext("External App"),visibility:"visible",widget:function(e,n){n.defaultOptions=o;var i=n.vellum.opts().features;return v(i)||E(i)?t.dropdown(e,n):t.dropdownWithInput(e,n)},noCustom:!0,placeholder:gettext("Insert Android Application ID"),deserialize:function(e,t,n){e.intent?(n.p.androidIntentAppId=e.intent.path||"",a.each([["intentXmlns","xmlns"],["androidIntentExtra","extra"],["androidIntentResponse","response"],["unknownAttributes","unknownAttributes"]],(function(t){var i=t[0],r=t[1];a.isEmpty(e.intent[r])||(n.p[i]=e.intent[r])}))):n.p[t]=e[t]},validationFunc:function(e){var t,i=e.form.vellum.opts(),r=i.features,s=i.core.externalLinks.changeSubscription,l=gettext("change your subscription");if(s=s?"["+l+"]("+s+")":l,v(r))return n.format(gettext("You no longer have access to built in or external integration in your application.\n\nBuilt in integrations are available on the Pro plan and higher. External integrations are available on the Advanced plan and higher. Before you can make a new version of your application, you must {link} or delete this question."),{link:s});if(E(r)&&(t=e.p.androidIntentAppId,a.chain(o).map((function(e){return e.value})).find((function(e){return e===t})).isUndefined().value()))return n.format(gettext("Your subscription only has access to built-in integration.\n\nExternal integrations are available on the Advanced plan and higher. Before you can make a new version of your application, you must {link} or delete this question."),{link:s});var d=a.filter(e.form.getMugList(),(function(e){return e.p.androidIntentAppId}));if(d.length>1){var c=a.countBy(d,(function(e){return e.p.nodeID}));a.each(d,(function(e){(c[e.p.nodeID]>1?e.messages.update("nodeID",{key:"intent-nodeID-duplicate",level:e.ERROR,message:gettext("Android app callouts of the same type must have different question ids.")}):e.dropMessage("nodeID","intent-nodeID-duplicate"))&&e.fire({type:"messages-changed",mug:e})}))}return"pass"}},androidIntentExtra:{lstring:gettext("Extra"),visibility:"visible",widget:t.baseKeyValue,serialize:p},androidIntentResponse:{lstring:gettext("Response"),visibility:"visible",widget:t.baseKeyValue,serialize:p},unknownAttributes:{visibility:"hidden",presence:"optional",serialize:p},intentXmlns:{visibility:"hidden",presence:"optional",lstring:gettext("Special Intent XMLNS attribute")}},getAppearanceAttribute:function(e){return"intent:"+e.p.nodeID}}),m=n.extend(g,{typeName:gettext("Print"),icon:"fa fa-print",init:function(e,t){g.init(e,t),e.p.androidIntentAppId="org.commcare.dalvik.action.PRINT"},spec:{docTemplate:{lstring:gettext("Document Template"),visibility:"visible",widget:function(e,n){var i=t.abstractMediaWidget(e,n);return i.getBaseMediaPath=function(){return"jr://file/commcare/text/"+e.p.nodeID},i}},androidIntentAppId:{visibility:"hidden"}}});function v(e){return!e.custom_intents&&!e.templated_intents}function E(e){return e.templated_intents&&!e.custom_intents}r.vellum.plugin("intents",{},{init:function(){var e=this.opts().intents;o=a.map(e&&e.templates,(function(e){return{value:e.id,text:e.name,type:e.mime}}))},loadXML:function(e){var t,n;this.data.intents.unmappedIntentTags=(t=i.parseXML(e).find("h\\:head, head").children("odkx\\:intent, intent"),n={},a.each(t,(function(e){var t,i,o;i=(t=r(e)).xmlAttr("id"),(o=d(i,t.xmlAttr("class"))).xmlns=t.xmlAttr("xmlns:odkx")||o.intentXmlns,o.androidIntentExtra=c(t,"extra"),o.androidIntentResponse=c(t,"response"),a.chain(e.attributes).filter((function(e){return!a.contains(["id","class","xmlns:odk"],e.nodeName)})).each((function(e){o.unknownAttributes[e.nodeName]=e.nodeValue})),n[i]=o})),n),this.__callOld()},contributeToHeadXML:function(e,t){this.__callOld(),function(e,t,n){a.each(e,(function(e){f(t,e)})),n.treeMap((function(e){var n=e.getValue();n&&"intent"===n.options.dataType&&f(t,n.p,n)}))}(this.data.intents.unmappedIntentTags,e,t.tree)},handleNewMug:function(e){var t=this.__callOld();return h(this.data.intents.unmappedIntentTags,e),t},handleMugParseFinish:function(e){this.__callOld(),h(this.data.intents.unmappedIntentTags,e)},getMugTypes:function(){var e=this.__callOld();return e.normal.AndroidIntent=g,e.normal.PrintIntent=m,e},getAdvancedQuestions:function(){var e=this.__callOld();return v(this.opts().features)||(e.push("AndroidIntent"),this.opts().features.printing&&e.push("PrintIntent")),e},getMainProperties:function(){var e=this.__callOld().concat(l);return E(this.opts().features)&&(e=a.without(e,"androidIntentExtra","androidIntentResponse")),e}})}.apply(t,i))||(e.exports=a)},9333:(e,t,n)=>{var i,a;i=[n(3946),n(561),n(705),n(1874),n(4078),n(7417),n(8094),n(939),n(2183)],void 0===(a=function(e,t,n,i,a,r,o,s,l){var d,c,u,f,h=a.baseMugTypes.normal,p=/\[[^\[\]]*\]$/;function g(e,t){var n=t.form.getChildren(t);if(n.length)return n[0];var a=E(t),r=e.createQuestion(t,"into","Itemset",!0);if(a.length){var o=a[0].uri,s="instance('"+a[0].id+"')"+a[0].path;(r=T(r,i.autocompleteChoices(a,o))).p.filter="",r.p.itemsetData={instance:e.parseInstance(s,r,"itemsetData"),nodeset:s}}return r}d=o.extend(a.defaultOptions,{isControlOnly:!0,typeName:gettext("Lookup Table Data"),tagName:"itemset",icon:"fa fa-th",isTypeChangeable:!1,isRemoveable:!1,isCopyable:!1,getIcon:function(e){return"fa fa-th"},init:function(e,t,n){e.p.itemsetData={}},writeControlLabel:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){var n=t.p.itemsetData.nodeset,i=t.p.filter,a=t.p.valueRef,r=t.p.labelRef,s=t.p.sortRef;i&&(n+="["+i+"]"),o.writeHashtags(e,"nodeset",n||"",t),e.writeStartElement("label"),e.writeAttributeString("ref",r||""),e.writeEndElement(),e.writeStartElement("value"),e.writeAttributeString("ref",a||""),e.writeEndElement();var l=t.form.vellum.opts().features;s&&s.trim()&&l.sorted_itemsets&&(e.writeStartElement("sort"),e.writeAttributeString("ref",s),e.writeEndElement())},spec:{label:{presence:"notallowed"},labelItext:{presence:"notallowed"},labelItextID:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},hintItextID:{presence:"notallowed"},helpItext:{presence:"notallowed"},helpItextID:{presence:"notallowed"},mediaItext:{presence:"notallowed"},otherItext:{presence:"notallowed"},appearance:{presence:"notallowed"},itemsetData:{lstring:gettext("Lookup Table"),visibility:"visible_if_present",presence:"optional",widget:function(n,a){function r(t){return!t||e.all(e.map(t,e.isEmpty))}function o(e){var a=m(),r=i.autocompleteChoices(e,a?a.src:"");return s.autocomplete(t("#property-valueRef"),n,{choices:r}),s.autocomplete(t("#property-labelRef"),n,{choices:r}),s.autocomplete(t("#property-sortRef"),n,{choices:r}),r}function l(e){if(f=e,h=!0,p){var t=o(e);t&&t.length&&r(d.value)&&(n=T(n,t),d.hasOwnProperty("value")&&C())}}a=e.extend({},a,{onOptionsLoaded:l,dataSourcesFilter:u.dataSourcesFilter}),c&&(a.hasAdvancedEditor=!0,a.getSource=function(e){var t=m();return e.p.filter&&(t.query+="["+e.p.filter+"]"),t},a.setSource=function(e,t){var n=e,i=v(e.query);n.query=i.value,t.p.filter=i.filter,E(n)});var d={},f=[],h=!1,p=!1,g=i.fixtureWidget(n,a,gettext("Lookup Table")),m=g.getValue,E=g.setValue,C=g.handleChange;return g.handleChange=function(){o(f),C()},g.getValue=function(){var e=m();return{instance:t.trim(e.src)?{id:e.id,src:e.src}:{id:null,src:null},nodeset:e.query}},g.setValue=function(t){var n=d.hasOwnProperty("value");d.value=t,h&&!n&&r(t)?C():(t=e.isEmpty(t)?{instance:{}}:t,E({id:t.instance?t.instance.id:"",src:t.instance?t.instance.src:"",query:t.nodeset||""}))},p=!0,h&&l(f),g},serialize:function(e,t,n,i){return e.nodeset=a.serializeXPath(e.nodeset,t,n,i),e},deserialize:function(e,t,n,i){var r=e[t];if(r){if(a.updateInstances(e,n),r.instance&&r.instance.id&&r.instance.src){var o={};o[r.instance.id]=r.instance.src,n.form.updateKnownInstances(o)}var s={form:n.form,p:r};r.nodeset=a.deserializeXPath(r,"nodeset",s,i),r.valueRef&&(n.p.valueRef=r.valueRef),r.labelRef&&(n.p.labelRef=r.labelRef),r.sortRef&&(n.p.sortRef=r.sortRef)}return r},validationFunc:function(e){if(!e.options.lookupTablesEnabled)return o.format(gettext("You no longer have access to Lookup Tables in your application. Lookup Tables are available on the Standard plan and higher.\nBefore you can make a new version of your application, you must {link} or delete this question"),{link:f?"["+gettext("change your subscription")+"]("+f+")":gettext("change your subscription")});var t=e.p.itemsetData;return t.nodeset?(e.form.updateLogicReferences(e,"itemsetData",t.nodeset),"pass"):gettext("A data source must be selected.")}},valueRef:{lstring:"Value Field",widget:C,visibility:"visible",presence:"required",validationFunc:I("valueRef"),serialize:function(e,t,n,i){n.p.valueRef&&(i.itemsetData[0].valueRef=n.p.valueRef)}},labelRef:{lstring:gettext("Display Text Field"),widget:C,visibility:"visible",presence:"required",validationFunc:I("labelRef"),serialize:function(e,t,n,i){n.p.labelRef&&(i.itemsetData[0].labelRef=n.p.labelRef)}},sortRef:{lstring:gettext("Sort Field"),widget:C,visibility:function(e){return e.form.vellum.opts().features.sorted_itemsets},presence:"optional",validationFunc:I("sortRef"),serialize:function(e,t,n,i){n.p.sortRef&&(i.itemsetData[0].sortRef=n.p.sortRef)}},filter:{lstring:gettext("Filter"),presence:"optional",widget:n.xPath,xpathType:"bool",serialize:a.serializeXPath,deserialize:a.deserializeXPath,visibility:"visible",leftPlaceholder:"",autocompleteChoices:function(e){var t=E(e),n=e.p.itemsetData.instance.src;return i.autocompleteChoices(t,n)},help:gettext("This is an XPath expression that will filter the set of choices from the lookup table")}}});var m={presence:"optional",visibility:"hidden",serialize:function(t,n,i,a){return t=e.chain(i.form.getChildren(i)).map((function(e){return e.spec[n].serialize(e.p[n],n,e,a)})).filter(e.identity).value(),e.isEmpty(t)?void 0:t},deserialize:function(t,n,i,a){e.each(t[n],(function(r,o){var s=i.form.getChildren(i)[o]||g(i.form,i),l=e.clone(t);l[n]=r,s.p[n]=s.spec[n].deserialize(l,n,s,a)}))}};function v(e){var t=e.search(p);return-1!==t?{value:e.slice(0,t),filter:e.slice(t+1,-1)}:{value:e,filter:""}}function E(e){var t=e.form.vellum.datasources.getDataSources([]);return u.dataSourcesFilter&&(t=u.dataSourcesFilter(t)),t}function T(t,n){return t.p.labelRef||(e.contains(n,"name")?t.p.labelRef="name":t.p.labelRef=n[0]),t.p.valueRef||(e.contains(n,"@id")?t.p.valueRef="@id":t.p.valueRef=n.length>1?n[1]:n[0]),t}function C(e,t){var a=n.text(e,t),r=e.p.itemsetData,o=r?r.instance:null,l=o?o.src:"",d=i.autocompleteChoices(E(e),l);return s.autocomplete(a.input,e,{choices:d}),a}function I(t){return function(n){var a=n.p.itemsetData,r=n.p[t],s=a.instance,l=s?s.src:"",d=E(n),c=i.getPossibleFixtures(d),u=e.some(c,(function(e){return e.src===l})),f=i.autocompleteChoices(d,l),h=r.replace(/\[[^\[]+]/g,"");return u&&!e.contains(f,h)?o.format(gettext("{attr} was not found in the lookup table"),{attr:r}):"pass"}}t.vellum.plugin("itemset",{},{init:function(){u=this.opts().itemset,c=this.opts().features.advanced_itemsets,d.lookupTablesEnabled=this.opts().features.lookup_tables,f=this.opts().core.externalLinks.changeSubscription},getQuestionGroups:function(){var e=this.__callOld();return this.opts().features.lookup_tables&&e.splice(e.length-1,0,{group:["SelectDynamic",gettext("Lookup Tables")],questions:["SelectDynamic","MSelectDynamic"]}),e},getMugTypes:function(){var e=this.__callOld();return e.auxiliary.Itemset=d,e.normal=t.extend(e.normal,{MSelectDynamic:o.extend(h.MSelect,{typeName:gettext("Checkbox Lookup Table"),typeChangeError:function(e,t){return t.match(/^M?Select$/)?e.form.getChildren(e).length>0?gettext("Cannot change to Multiple/Single Choice question if it has Choices. Please remove all Choices and try again."):"":"SelectDynamic"===t?"":gettext("Can only change to a Multiple Choice Lookup Table")},validChildTypes:["Itemset"],maxChildren:1,afterInsert:g,canAddChoices:!1,spec:{itemsetData:m,valueRef:m,labelRef:m,sortRef:m,filter:m}}),SelectDynamic:o.extend(h.Select,{typeName:gettext("Multiple Choice Lookup Table"),typeChangeError:function(e,t){return t.match(/^M?Select$/)?e.form.getChildren(e).length>0?gettext("Cannot change to Multiple/Single Choice question if it has Choices. Please remove all Choices and try again."):"":"MSelectDynamic"===t?"":gettext("Can only change to a Checkbox Lookup Table")},validChildTypes:["Itemset"],maxChildren:1,afterInsert:g,canAddChoices:!1,spec:{itemsetData:m,valueRef:m,labelRef:m,sortRef:m,filter:m}})}),e},updateControlNodeAdaptorMap:function(e){this.__callOld();var t=r.makeControlOnlyMugAdaptor("Itemset");e.itemset=function(e,n,i,a){var r=function(n,i){"Select"===a.__className?i.changeMugType(a,"SelectDynamic"):"MSelect"===a.__className?i.changeMugType(a,"MSelectDynamic"):l.log("Unknown parent type: "+a.__className),n=t(n,i);var r=v(e.popAttr("vellum:nodeset")||e.popAttr("nodeset"));n.p.filter=r.filter,n.p.itemsetData={instance:i.parseInstance(r.value,n,"itemsetData"),nodeset:r.value},n.p.labelRef=e.children("label").xmlAttr("ref"),n.p.valueRef=e.children("value").xmlAttr("ref");var o=e.children("sort");return o.length&&(n.p.sortRef=o.xmlAttr("ref")),n};return r.ignoreDataNode=!0,r}},loadXML:function(){this.__callOld(),this.data.core.form.on("mug-property-change",(function(e){var t=e.mug;"Itemset"===t.__className&&"itemsetData"===e.property&&function(e,t,n){if(n&&n.instance&&n.instance.src&&e.form.dropInstanceReference(n.instance.src,e,"itemsetData.instance"),t&&t.instance&&t.instance.src){var i=e.form.addInstanceIfNotExists(t.instance,e,"itemsetData.instance");i!==t.instance.id&&(t.instance.id=i,t.nodeset=e.form.updateInstanceQuery(t.nodeset,i))}}(t,e.val,e.previous)}))},getMainProperties:function(){return this.__callOld().concat(["valueRef","labelRef","sortRef"])},getLogicProperties:function(){var e=this.__callOld();return e.push("filter"),e},changeMugType:function(e,t){var n=e.__className.match(/^M?Select/)&&t.match(/^M?SelectDynamic$/);this.__callOld(),n&&g(e.form,e)}})}.apply(t,i))||(e.exports=a)},6294:(e,t,n)=>{var i,a;i=[n(3946),n(561),n(3876),n(8094),n(7229),n(1877)],void 0===(a=function(e,t,n,i,a){var r=1,o=function(t){this.forms=t.forms||[],this.id=t.id||"",this.autoId=!!e.isUndefined(t.autoId)||t.autoId,this.hasMarkdown=!e.isUndefined(t.hasMarkdown)&&t.hasMarkdown,this.itextModel=t.itextModel,this.key=String(r++),this.refCount=1};o.prototype={clone:function(){return new o({forms:e.map(this.forms,(function(e){return e.clone()})),id:this.id,autoId:this.autoId,itextModel:this.itextModel,hasMarkdown:this.hasMarkdown})},getForms:function(){return this.forms},getFormNames:function(){return this.forms.map((function(e){return e.name}))},hasForm:function(e){return-1!==this.getFormNames().indexOf(e)},getForm:function(e){return i.reduceToOne(this.forms,(function(t){return t.name===e}),"form name = "+e)},getOrCreateForm:function(e){try{return this.getForm(e)}catch(t){return this.addForm(e)}},addForm:function(e){if(!this.hasForm(e)){var t=new s({name:e,itextModel:this.itextModel});return this.forms.push(t),t}},removeForm:function(e){var t=this.getFormNames().indexOf(e);-1!==t&&this.forms.splice(t,1)},cloneForm:function(e,t){var n=this.getOrCreateForm(e).clone();n.name=t,this.forms.push(n)},get:function(t,n){if((e.isUndefined(t)||null===t)&&(t="default"),(e.isUndefined(n)||null===n)&&(n=this.itextModel.getDefaultLanguage()),this.hasForm(t))return this.getForm(t).getValue(n)},set:function(t,n,i){(e.isUndefined(n)||null===n)&&(n="default");var a=this.getOrCreateForm(n);if(e.isUndefined(i)||null===i){i=this.itextModel.getDefaultLanguage();var r=a.getValue(i);a.setValue(i,t),e.each(this.itextModel.languages,(function(e){var n=a.getValue(e);n&&n!==r||a.setValue(e,t)}))}else a.setValue(i,t)},defaultValue:function(){return this.get()},isEmpty:function(){return!this.forms||e.every(this.forms,(function(e){return e.isEmpty()}))},hasHumanReadableItext:function(){var t=this;return e.some(["default","long","short"].concat(n.SUPPORTED_MEDIA_TYPES),(function(n){return t.hasForm(n)&&e.every(t.itextModel.languages,(function(e){return t.get(n,e)}))}))},mapLogicExpressions:function(t){var n=this.getForms(),i=e.map(n,(function(n){return e.map(n.getOutputRefExpressions(),t)}));return e.flatten(i)},updateLogicExpressions:function(t,n){e.some(e.map(this.getForms(),(function(e){return e.forEachExpression(t)})))&&n.form.fire({type:"question-label-text-change",mug:n})}};var s=function(e){this.itextModel=e.itextModel,this.data=e.data||{},this.name=e.name||"default",this.outputExpressions=null};s.prototype={clone:function(){return new s({itextModel:this.itextModel,data:e.clone(this.data),name:this.name})},getValue:function(e){return this.data[e]},setValue:function(e,t){this.data[e]=a.humanize(t),this.outputExpressions=null},getValueOrDefault:function(e){if(this.data[e])return this.data[e];var t=this.itextModel.getDefaultLanguage();if(e!==t&&this.data[t])return this.data[t];for(var n in this.data)if(this.data.hasOwnProperty(n)&&this.data[n])return this.data[n];return""},isEmpty:function(){for(var e in this.data)if(this.data.hasOwnProperty(e)&&this.data[e])return!1;return!0},initUndefined:function(t){var n=this.itextModel.getDefaultLanguage(),i=this.data;t=this.getValueOrDefault(n)||t||"",e.each(this.itextModel.languages,(function(e){i.hasOwnProperty(e)||(i[e]=t)}))},getOutputRefExpressions:function(){return null===this.outputExpressions&&(this.outputExpressions=this._getOutputRefExpressions()),this.outputExpressions},_getOutputRefExpressions:function(){var e=[];return this.forEachExpression((function(t){t&&e.push(t)})),e},forEachExpression:function(n){var i,r,o=!1;for(var s in this.data)this.data.hasOwnProperty(s)&&this.data[s]&&(i=!1,r=a.query(this.data[s]),e.each(r.find("output"),(function(e){var a=(e=t(e)).is("[ref]")?"ref":"value",r="vellum:"+a,o=e.xmlAttr(r)||e.xmlAttr(a),s=n(o);void 0!==s&&s!==o&&(e.xmlAttr(a,s).removeAttr(r),i=!0)})),i&&(this.setValue(s,r.toString()),o=!0));return o}};var l=function(){i.eventuality(this),this.languages=[]};return l.prototype={getLanguages:function(){return this.languages},hasLanguage:function(e){return-1!==this.languages.indexOf(e)},addLanguage:function(e){this.hasLanguage(e)||this.languages.push(e)},removeLanguage:function(e){this.hasLanguage(e)&&this.languages.splice(this.languages.indexOf(e),1),this.getDefaultLanguage()===e&&this.setDefaultLanguage(this.languages.length>0?this.languages[0]:"")},setDefaultLanguage:function(e){this.defaultLanguage=e},getDefaultLanguage:function(){return this.defaultLanguage?this.defaultLanguage:this.languages.length>0?this.languages[0]:""},createItem:function(e,t,n){return new o({id:e,autoId:t,itextModel:this,forms:[new s({name:"default",itextModel:this})],hasMarkdown:n})},updateForMug:function(e){e.options.isDataOnly||(e.p.labelItext||"notallowed"===e.getPresence("labelItext")||((e.p.labelItext=this.createItem()).set(e.getLabelValue()),e.validate()),e.p.hintItext||"notallowed"===e.getPresence("hintItext")||(e.p.hintItext=this.createItem()),e.p.helpItext||"notallowed"===e.getPresence("helpItext")||(e.p.helpItext=this.createItem()),e.options.isRepeat&&e.options.customRepeatButtonText&&(e.p.addEmptyCaptionItext||(e.p.addEmptyCaptionItext=this.createItem()),e.p.addCaptionItext||(e.p.addCaptionItext=this.createItem()))),e.options.isControlOnly||"notallowed"===e.getPresence("constraintMsgItext")||e.p.constraintMsgItext||(e.p.constraintMsgItext=this.createItem())}},{form:s,item:o,model:l}}.apply(t,i))||(e.exports=a)},4173:(e,t,n)=>{var i,a;i=[n(3946),n(561),n(7207),n(9443),n(705),n(8094),n(6910),n(1877)],void 0===(a=function(e,t,n,i,a,r,o){var s=e.union(r.SUPPORTED_MEDIA_TYPES,["default","short","long"]),l=["Choice","Group","FieldList","Repeat"],d=function(n,i){var o=n.form.vellum.data.javaRosa.Itext,s={};r.eventuality(s),s.mug=n,s.itextType=i.itextType,s.languages=o.getLanguages(),s.defaultLang=o.getDefaultLanguage(),s.forms=i.forms||["default"],s.getItextItem=function(){return i.getItextByMug(s.mug)},s.setValue=function(e){},s.getValue=function(e){};var l=t("<div />").addClass("controls").addClass("messages"),d=t("<div />").addClass("itext-block-container").addClass("itext-block-"+s.itextType);return s.getFormGroupClass=function(e){return"itext-block-"+s.itextType+"-group-"+e},s.getFormGroupContainer=function(e){return t("<div />").addClass(s.getFormGroupClass(e)).addClass("itext-lang-group")},s.getForms=function(){return s.forms},s.refreshMessages=function(){if(i.messagesPath){var e=a.util.getMessages(n,i.messagesPath);l.empty().append(e)}},n.on("messages-changed",(function(){s.refreshMessages()}),null,"teardown-mug-properties"),s.getUIElement=function(){return e.each(s.getForms(),(function(t){var n=s.getFormGroupContainer(t),r=s.languages;i.vellum.data.javaRosa.showOnlyCurrentLang&&(r=e.intersection([i.vellum.data.javaRosa.Itext.defaultLanguage,i.vellum.data.core.currentItextDisplayLanguage],s.languages)),e.each(r,(function(r){var o=s.itextWidget(s.mug,r,t,e.extend(i,{parent:d}));o.init(),o.on("change",(function(){s.fire("change")}));var l=o.getUIElement();a.util.setWidget(l,o),n.append(l)})),d.append(n)})),d.append(l),d},s},c=function(r,l){var c=d(r,l);c.isCustomAllowed=l.isCustomAllowed,c.activeForms=c.getItextItem().getFormNames(),c.displayName=l.displayName,c.formToIcon=l.formToIcon||{},c.itextWidget=o.form,c.getForms=function(){var t=e.difference(c.activeForms,s),n=e.intersection(c.activeForms,c.forms);return e.union(t,n)};var u=c.getFormGroupContainer;c.getFormGroupContainer=function(e){var t=u(e);return t.addClass("itext-lang-group-config").addClass("well").data("formtype",e),t},c.getAddFormButtonClass=function(e){return"itext-block-"+c.itextType+"-add-form-"+e},c.getAddFormButtons=function(){var n=t("<div />").addClass("btn-group itext-options");return e.each(c.forms,(function(e){var i=t("<div />");i.text(" "+e).addClass(c.getAddFormButtonClass(e)).addClass("btn btn-default itext-option").click((function(){c.addItext(e)}));var a=c.formToIcon[e];a&&i.prepend(t("<i />").addClass(a).after(" ")),-1!==c.activeForms.indexOf(e)&&i.addClass("disabled"),n.append(i)})),c.isCustomAllowed&&n.append(c.getAddCustomItextButton()),n},c.getAddCustomItextButton=function(){var e=t("<button />").text(gettext("custom...")).addClass("btn btn-default").attr("type","button"),n="fd-new-itext-button";return e.click((function(){var e,a,o;e=r.form.vellum.generateNewModal(gettext("New Content Type"),[{title:gettext("Add"),cssClasses:n+" disabled ",attributes:{disabled:"disabled"}}]),a=t(i({label:gettext("Content Type")})),(o=t("<input />").attr("type","text").addClass("form-control")).keyup((function(){var e=t(this).val(),i=r.form.vellum.$f.find("."+n);e&&-1===s.indexOf(e)&&-1===c.activeForms.indexOf(e)?i.removeClass("disabled").addClass("btn-primary").prop("disabled",!1):i.addClass("disabled").removeClass("btn-primary").prop("disabled",!0)})),a.find(".controls").append(o),e.find(".modal-body").append(a),r.form.vellum.$f.find("."+n).click((function(){o.val()&&(c.addItext(o.val()),e.modal("hide"))})),e.modal("show"),e.one("shown.bs.modal",(function(){o.focus()}))})),e},c.deleteItextForm=function(t){var n=c.getItextItem();n&&n.removeForm(t),c.activeForms=e.without(c.activeForms,t),c.fire("change")},c.getDeleteFormButton=function(e){var i=t(n());return i.addClass("pull-right").addClass("delete-"+c.getFormGroupClass(e)).click((function(){var n=t("."+c.getFormGroupClass(e));c.deleteItextForm(e),n.remove(),t(this).remove(),t("."+c.getAddFormButtonClass(e)).removeClass("disabled")})),i},c.addItext=function(n){if(-1===c.activeForms.indexOf(n)){c.activeForms.push(n),c.fire("change"),t("."+c.getAddFormButtonClass(n)).addClass("disabled");var i=c.getFormGroupContainer(n);e.each(c.languages,(function(e){var t=c.itextWidget(c.mug,e,n,l);t.init(!0),t.on("change",(function(){c.fire("change")}));var r=t.getUIElement();a.util.setWidget(r,t),i.append(r)})),f.find(".new-itext-form-group").after(i),i.find(".col-sm-9").removeClass("col-sm-9").addClass("col-sm-8"),i.before(c.getDeleteFormButton(n))}};var f=t("<div />"),h=c.getUIElement;return c.getUIElement=function(){f=h();var e=t(i({label:c.displayName}));return e.addClass("new-itext-form-group").find(".controls").append(c.getAddFormButtons()),f.prepend(e),f.find(".itext-lang-group").each((function(){t(this).find(".col-sm-9").removeClass("col-sm-9").addClass("col-sm-8"),t(this).before(c.getDeleteFormButton(t(this).data("formtype")))})),f},c};return{configurable:c,label:function(t,n){var i=d(t,n);return!n.vellum.opts().features.markdown_in_groups&&e.contains(l,t.__className)||t.form.noMarkdown?i.itextWidget=o.label:i.itextWidget=o.markdown,i},media:function(t,n){var i=c(t,n),a=n.pathPrefix;return e.isString(n.pathPrefix)||(a="/"+n.itextType),i.getForms=function(){return e.intersection(i.activeForms,i.forms)},i.itextWidget=o.media(a+t.form.getBasePath()),i}}}.apply(t,i))||(e.exports=a)},6910:(e,t,n)=>{var i,a;i=[n(3946),n(561),n(4489),n(3591),n(3876),n(705),n(4459),n(8094),n(939),n(1877)],void 0===(a=function(e,t,n,i,a,r,o,s,l){var d={image:"png",audio:"mp3",video:"3gp","video-inline":"3gp"},c=function(t,n,i,d){var c,u,f=t.form.vellum.data.javaRosa.Itext,h="itext-"+n+"-"+d.itextType,p=d.baseWidgetClass||r.richTextarea;d.language=n,d.idSuffix&&(h+=d.idSuffix),d.id=h,(u=(c=p(t,d)).input).addClass("jstree-drop"),"labelItext"===d.path&&(t.form.richText||u.keydown((function(e){if(e&&8===e.which||46===e.which){var t,n,i=c.getControl()[0],a=s.getCaretPosition(i),r=c.getValue(),o="<output";if(8===e.which?a>1&&"/>"===r.substr(a-2,2)&&(t=r.lastIndexOf(o,a),n=a):46===e.which&&r.substr(a,7)===o&&(n=-1===(n=r.indexOf("/>",a))?n:n+2,t=a),t||n&&-1!==t&&-1!==n){var l=r.slice(0,t)+r.slice(n,r.length);c.setValue(l),s.setCaretPosition(i,t),e.preventDefault()}}}))),e.contains(a.ITEXT_PROPERTIES,d.path)&&l.autocomplete(u,t,{category:"Output Value",insertTpl:'<output value="${name}" />',property:"labelItext",outputValue:!0,useRichText:t.form.richText}),c.displayName=d.displayName,c.itextType=d.itextType,c.form=i||"default",c.language=n,c.languageName=s.langCodeToName[c.language]||c.language,c.showOneLanguage=f.getLanguages().length<2,c.defaultLang=f.getDefaultLanguage(),c.isDefaultLang=c.language===c.defaultLang,c.isSyncedWithDefaultLang=!1,c.getItextItem=function(){return d.getItextByMug(c.mug)},c.getItextValue=function(e){var n,i=c.getItextItem();return e||(e=c.language),n=i&&i.get(c.form,e),t.form.richText?a.outputToHashtag(n,c.mug.form.xpath):a.outputToXPath(n,c.mug.form.xpath)},c.setItextValue=function(e){e=o.sanitizeInput(e);var t=c.getItextItem();e=a.outputToHashtag(e,c.mug.form.xpath),t&&(c.isDefaultLang&&c.mug.fire({type:"defaultLanguage-itext-changed",form:c.form,prevValue:t.get(c.form,c.language),value:e,itextType:c.itextType}),t.getForm(c.form).setValue(c.language,e))},c.getLangDesc=function(){return c.showOneLanguage?"":" ("+c.languageName+")"},c.getDisplayName=function(){return c.displayName+c.getLangDesc()},c.init=function(t){if(t){var n=c.getDefaultValue();c.getItextItem().getOrCreateForm(c.form),c.setValue(n),c.handleChange()}else{var i=c.getItextValue();e.isString(i)||(i=c.isDefaultLang?"":c.getItextValue(c.defaultLang)||""),c.setItextValue(i),c.setValue(i)}};var g=c.updateValue;return c.updateValue=function(){g(),c.getValue()||c.isDefaultLang||c.setItextValue(c.getItextValue(c.defaultLang))},c.toggleDefaultLangSync=function(e){c.isSyncedWithDefaultLang=!e&&!c.isDefaultLang},c.getDefaultValue=function(){return null},c.isDefaultLang||c.mug.on("defaultLanguage-itext-changed",(function(e){e.form===c.form&&e.itextType===c.itextType&&c.getItextValue()===e.prevValue&&(c.setItextValue(e.value),c.setValue(e.value))}),null,"teardown-mug-properties"),c.refreshMessages=function(){c.getMessagesContainer().empty().append(c.getMessages(t,c.id))},c.save=function(){c.setItextValue(c.getValue())},c},u=function(e,t,n,i){var a=c(e,t,n,i),r=a.handleChange;return a.handleChange=function(){var t=a.getItextItem(),n=t&&t.get(a.form,a.language);r();var i=t&&t.get(a.form,a.language);n!==i&&e.form.fire({type:"question-label-text-change",mug:e,text:i})},a},f=function(e,t,n,i){(i=i||{}).idSuffix="-"+n;var a=c(e,t,n,i);return a.getDisplayName=function(){return n+a.getLangDesc()},a};return{form:f,id:function(e,i){var o=r.text(e,i),s=o.input,l=null;function d(){return a.getDefaultItextId(e,o.path.replace(/Itext$/,""))}function c(){u(d()),h(!0)}var u=o.setValue;o.setValue=function(e){l=e,e.autoId?c():(u(e.id),h(!1))},o.getValue=function(){return l.id=s.val(),l.autoId=p(),l};var f=t("<input />").attr("type","checkbox");function h(e){f.prop("checked",e)}function p(){return f.prop("checked")}f.change((function(){t(this).prop("checked")&&(l.refCount>1&&(l.refCount--,l=l.clone()),c(),o.handleChange())}));var g=o.getUIElement;return o.getUIElement=function(){var e=g().css("position","relative"),i=t(n());return i.find("label").prepend(f),e.find(".controls").removeClass("col-sm-9").addClass("col-sm-8").after(i),e},o.input.keyup((function(){t(this).val()!==d()&&h(!1)})),e.on("property-changed",(function(e){p()&&"nodeID"===e.property&&s.val(d())}),null,"teardown-mug-properties"),o},label:u,markdown:function(e,n,r,o){var l,d,c=(o=o||{}).parent,f=u(e,n,r,o),h=f.setValue,p=f.getUIElement,g=f.handleChange,m=!0,v=o.vellum.opts().features.markdown_tables;return f.toggleMarkdown=function(){c.toggleClass("has-markdown"),f.mug.form.fire("change")},d=t("<div>").addClass("controls well markdown-output col-sm-9"),s.isRightToLeftLanguage(o.language)&&d.attr("dir","rtl"),f.handleChange=function(){g();var e=f.getValue(),t=f.getItextItem();a.looksLikeMarkdown(e,v)?m&&(c.removeClass("markdown-ignorant"),c.addClass("has-markdown")):e||c.removeClass("has-markdown"),t.hasMarkdown=l.is(":visible"),d.html(s.markdown(e)).closest(".form-group").removeClass("hide")},f.setValue=function(e,t){h(e,t),e||d.closest(".form-group").addClass("hide"),d.html(s.markdown(e))},f.getUIElement=function(){var e=p(),n=f.getValue(),r=t("<div />").addClass("col-sm-3"),u=t("<div />").addClass("col-sm-9"),h=t("<div />").addClass("form-group").addClass("markdown-group");return e.detach(".markdown-output"),h.append(r),u.append(d),h.append(u),e.append(h),e.find(".control-label").append(i({title:o.lstring})),l=e.find(".turn-markdown-off").click((function(){return m=!1,f.getItextItem().hasMarkdown=!1,f.toggleMarkdown(),!1})),e.find(".turn-markdown-on").click((function(){return m=!0,f.getItextItem().hasMarkdown=!0,f.toggleMarkdown(),!1})),f.getItextItem().hasMarkdown?c.addClass("has-markdown"):a.looksLikeMarkdown(n,v)?(d.html(s.markdown(n)),l.removeClass("hide")):c.addClass("markdown-ignorant"),e},f},media:function(e){return function(t,n,i,o){o.baseWidgetClass=r.text;var s=f(t,n,i,o);return s.getDefaultValue=function(){if(-1!==a.SUPPORTED_MEDIA_TYPES.indexOf(i)){var e=d[i];return s.getBaseMediaPath()+"."+e}return null},s.getBaseMediaPath=function(){return"jr://file/commcare/"+i+e+a.getDefaultItextRoot(s.mug)},s.mug.form.vellum.initMediaUploaderWidget(s),s}}}}.apply(t,i))||(e.exports=a)},3391:(e,t,n)=>{var i,a;i=[n(3946),n(561),n(5674),n(6328),n(9832),n(8094),n(7229),n(3578),n(6294),n(4173),n(6910),n(4459),n(3876),n(1877)],void 0===(a=function(e,t,n,i,a,r,o,s,l,d,c,u,f){var h={image:"fa-regular fa-image",audio:"fa fa-volume-up",video:"fa fa-video-camera","video-inline":"fa fa-play"};t.vellum.plugin("javaRosa",{langs:["en"],displayLanguage:"en"},{init:function(){this.data.javaRosa.ItextItem=l.item,this.data.javaRosa.ItextForm=l.form,this.data.javaRosa.ICONS=h,this.data.javaRosa.showOnlyCurrentLang=this.opts().javaRosa.showOnlyCurrentLang},handleDropFinish:function(e,t,n,i){var o=e&&e.attr("name")&&0===e.attr("name").lastIndexOf("itext-",0),l=this;if(o){"Date"===(n&&n.options.typeName)?a.showMenu(i.clientX,i.clientY,(function(i){f.insertOutputRef(l,e,t,n,i)})):f.insertOutputRef(l,e,t,n);var d=r.getReferenceName(t);s.usage(d,"Drag and Drop","Label")}else l.__callOld()},handleNewMug:function(e){var t=this.__callOld();return this.data.javaRosa.Itext.updateForMug(e),t},_makeLanguageSelectorDropdown:function(){var n,a,o,s=this,l=this.data.javaRosa.Itext.getLanguages(),d=this.$f.find(".fd-questions-menu");(o=e.map(l,(function(e){return{code:e,name:r.langCodeToName[e]||e}})))[o.length]={code:"_ids",name:gettext("Question ID")},o.length<2||(d.find(".language-selector").remove(),d.find(".fd-bulk-update-menu").before(i({languages:o})),(n=d.find(".fd-display-item")).click((function(e){a.val(t(this).data("code")).change(),e.preventDefault()})),(a=d.parent().find(".fd-question-tree-display")).change((function(){var e=a.val();s._changeTreeDisplayLanguage(e),n.removeClass("selected").filter("[data-code="+e+"]").addClass("selected")})),a.val(this.data.core.currentItextDisplayLanguage).change())},_changeTreeDisplayLanguage:function(e){var n=this,i=this.data.core.form;this.data.core.currentItextDisplayLanguage=e,this.data.core.$tree.find("li").each((function(e,a){var r=t(a),o=i.getMugByUFID(r.prop("id"));if("_ids"===n.data.core.currentItextDisplayLanguage)n.jstree("rename_node",r,o.getNodeID());else if(o.p.labelItext){var s=n.getMugDisplayName(o);n.jstree("rename_node",r,s||n.opts().core.noTextString)}})),i&&i.fire({type:"change-display-language"})},loadXML:function(e){var n,i,a=this,r=this.opts().javaRosa.langs;if(this.data.javaRosa.Itext=n=new l.model,this.data.javaRosa.itextMap=i={},r&&r.length>0){for(var s=0;s<r.length;s++)n.addLanguage(r[s]);n.setDefaultLanguage(r[0])}if(e){var d=o.parseXML(e).find("h\\:head, head").find("itext");t(d).children().each((function(){var e=t(this),o=e.xmlAttr("lang");r&&-1===r.indexOf(o)?a.data.core.parseWarnings.push(gettext('You have languages in your form that are not specified in the "Languages" page of the application builder. The following language will be deleted on save unless you add it to the "Languages" page:')+" "+o):(n.addLanguage(o),e.children().each((function(){var e=t(this),a=e.xmlAttr("id"),r=i[a];r&&i.hasOwnProperty(a)||((r=n.createItem(a)).refCount=0,i[a]=r),e.children().each((function(){var e=t(this),n=e.xmlAttr("form");if(n){if("markdown"===n)return r.hasMarkdown=!0,void r.getOrCreateForm("default").setValue(o,e)}else if(n="default",r.hasMarkdown)return;r.getOrCreateForm(n).setValue(o,e)}))})))}))}this.data.core.currentItextDisplayLanguage=this.opts().javaRosa.displayLanguage||n.getDefaultLanguage(),this._makeLanguageSelectorDropdown(),this.__callOld(),delete this.data.javaRosa.itextMap,n.on("change",(function(){a.onFormChange()}))},onXFormLoaded:function(n){var i=this.opts().javaRosa.langs;f.forEachItextItem(n,(function(a,r){e(a.forms).each((function(a){e.each(i,(function(e){var i=a.getValue(e);if(i){i=u.sanitizeInput(i);var r=o.query(i);r.find("output").replaceWith((function(){var e=t(this),i=e.is("[value]")||!e.is("[ref]")?"value":"ref",a="vellum:"+i,r=e.xmlAttr(i),o=e.xmlAttr(a);return o?(r&&n.inferHashtagMeanings(o,r),r=o):r=function(e){try{return n.xpath.parse(e).toHashtag()}catch(t){return e}}(r),t("<output />").xmlAttr("value",r)})),a.setValue(e,r.toString())}}))}))})),this.__callOld()},populateControlMug:function(e,t){this.__callOld();var n=this.data.javaRosa.Itext,i=this.data.javaRosa.itextMap;function a(t){try{var n=e.form.xpath.parse(t);if(n instanceof e.form.xpath.models.XPathFuncExpr&&"jr:itext"===n.id)return n.args[0].value}catch(e){}return""}function r(t,a){var r=!t||t===f.getDefaultItextId(e,a);if(t){var o=i[t];if(o&&i.hasOwnProperty(t))return r||(o.autoId=!1),o.refCount++,o}return n.createItem(t,r)}function s(e,t){var n=e.xmlAttr("ref");return r(n?a(n):"",t)}var l=t.children("label"),d=t.children("hint"),c=t.children("help"),u=t.children("alert");if(l.length&&"notallowed"!==e.getPresence("label")){var h=s(l,"label"),p=o.humanize(l)||e.getLabelValue();h.getOrCreateForm("default").initUndefined(p),e.p.labelItext=h}if(d.length&&"notallowed"!==e.getPresence("hintLabel")&&(e.p.hintItext=s(d,"hint")),c.length&&"notallowed"!==e.getPresence("label")&&(e.p.helpItext=s(c,"help")),u.length&&"notallowed"!==e.getPresence("constraintMsgAttr"))e.p.constraintMsgItext=s(u,"constraintMsg");else if(e.p.constraintMsgAttr){var g=a(e.p.constraintMsgAttr);g&&(e.p.constraintMsgItext=r(g,"constraintMsg"),e.p.constraintMsgAttr=null)}e.options.isRepeat&&e.options.customRepeatButtonText&&function(e,t){var n=t.children("repeat"),i=n.children("jr\\:addEmptyCaption"),a=n.children("jr\\:addCaption");i.length&&(e.p.addEmptyCaptionItext=s(i,"addEmptyCaption")),a.length&&(e.p.addCaptionItext=s(a,"addCaption"))}(e,t)},handleMugParseFinish:function(e){this.__callOld(),this.data.javaRosa.Itext.updateForMug(e)},duplicateMugProperties:function(t){this.__callOld(),e.each(f.ITEXT_PROPERTIES,(function(e){var n=t.p[e];n&&n.autoId&&(t.p[e]=n.clone())}))},contributeToModelXML:function(e,n){function i(e,i){(i=o.query(i)).find("output").each((function(){!function(e){var i,a,r,o=t(e),s=o.is("[value]")||!o.is("[ref]")?"value":"ref",l="vellum:"+s,d=o.xmlAttr(l)||o.xmlAttr(s);try{a=(i=c.parse(d)).toHashtag(),r=i.toXPath()}catch(e){a=d,r=d}n.richText&&r!==a?o.xmlAttr(s,r).xmlAttr(l,a):o.xmlAttr(s,r).removeAttr(l)}(this)})),e.writeXML(i.toString())}var a,r,s,l,d,c=n.xpath,u=this.data.javaRosa.Itext,f=this.data.javaRosa.itextItemsFromBeforeSerialize,h=u.getLanguages();if(h.length>0){e.writeStartElement("itext");for(var p=0;p<h.length;p++){l=h[p],e.writeStartElement("translation"),e.writeAttributeString("lang",l),u.getDefaultLanguage()===l&&e.writeAttributeString("default","");for(var g=0;g<f.length;g++){a=f[g],e.writeStartElement("text"),e.writeAttributeString("id",a.id),r=a.getForms();for(var m=0;m<r.length;m++)d=(s=r[m]).getValueOrDefault(l),e.writeStartElement("value"),"default"!==s.name&&e.writeAttributeString("form",s.name),i(e,d),e.writeEndElement();a.hasMarkdown&&!this.data.core.form.noMarkdown&&(d=a.getForm("default").getValueOrDefault(l),e.writeStartElement("value"),e.writeAttributeString("form","markdown"),i(e,d),e.writeEndElement()),e.writeEndElement()}e.writeEndElement()}e.writeEndElement()}},beforeSerialize:function(){this.__callOld(),this.data.javaRosa.itextItemsFromBeforeSerialize=f.getItextItemsFromMugs(this.data.core.form)},afterSerialize:function(){this.__callOld(),delete this.data.javaRosa.itextItemsFromBeforeSerialize},beforeBulkInsert:function(e){this.__callOld(),this.data.javaRosa.itextById=f.getItextItemsFromMugs(e,!0)},afterBulkInsert:function(){this.__callOld(),delete this.data.javaRosa.itextById},getMugTypes:function(){var e=this.__callOld(),t=e.normal;return t.Group.spec=r.extend(t.Group.spec,{constraintMsgItext:{presence:"notallowed"}}),e},getMugSpec:function(){var n=this.__callOld(),i=this,a=n.databind,s=n.control;function l(e,t){return function(n){var i=n.p[e];if(!(i&&i.hasHumanReadableItext()||"required"!==n.getPresence(e)))return 1===i.itextModel.languages.length?r.format(gettext("{name} (or multimedia) is required."),{name:t}):r.format(gettext("{name} (or multimedia) is required for all languages."),{name:t});if(i&&!i.autoId&&!i.isEmpty()){if(!i.id)return r.format(gettext("{name} Itext ID is required."),{name:t});if(!r.isValidAttributeValue(i.id))return r.format(gettext("{name} is not a valid ID."),{name:i.id})}return"pass"}}function u(n){function a(e,n){var i=o.query(e);return i.find("output").each((function(){!function(e,n){var i=t(e),a=i.is("[value]")||!i.is("[ref]")?"value":"ref",r=i.xmlAttr(a);r&&i.xmlAttr(a,n.transformHashtags(r))}(this,n)})),i.toString()}return n.serialize=function(t,n,i,a){var r=!1;e.each(t.forms,(function(i){i.isEmpty()||(r=!0,e.each(t.itextModel.languages,(function(e){var t=n+":"+e+"-"+i.name;a[t]=i.getValue(e)})))})),r&&!t.autoId&&(a[n]=t.id),t.hasMarkdown&&(a[n+":hasMarkdown"]=t.hasMarkdown)},n.deserialize=function(t,n,r,o){var s=r.p[n],l=!1;if(t[n]){var d=r.form.vellum.data.javaRosa.itextById,c=t[n];d.hasOwnProperty(c)&&!d[c].autoId?(r.p[n]=s=d[c],s.refCount++):(s.id=t[n],s.autoId=!1,d[s.id]=s)}var u=s.itextModel.getDefaultLanguage(),h=s.itextModel.languages,p=e.object(f.SUPPORTED_MEDIA_TYPES,f.SUPPORTED_MEDIA_TYPES),g=i.data.uploader.objectMap||{};function m(e){return null==e?"":String(e)}t.id&&t.id.slice(t.id.lastIndexOf("/")+1);var v=e.memoize((function(i){return!e.find(h,(function(e){return t[n+":"+e+"-"+i]}))}));e.each(h,(function(i){var d=n.length+i.length+2,c=new RegExp("^"+RegExp.escape(n)+":"+RegExp.escape(i)+"-"),f={};e.each(t,(function(e,h){if(c.test(h)){var E=h.slice(d),T=p.hasOwnProperty(E);if(T&&!e&&v(E))return;if(!f.hasOwnProperty(E)){f[E]=!0;var C=n+":"+u+"-"+E,I=t.hasOwnProperty(C)?m(t[C]):m(e);s.set(I,E),!T&&I&&o.later((function(){s.set(a(I,o),E)}))}s.set(m(e),E,i),!T&&e&&o.later((function(){s.set(a(e,o),E,i)})),T&&!g.hasOwnProperty(e)&&r.addMessage(n,{key:"missing-multimedia-warning",level:r.WARNING,message:gettext("Multimedia was not copied; it must be uploaded separately.")}),l=!0}}))})),l&&!t[n]&&(s.id=f.getDefaultItextId(r,n.replace(/Itext$/,""))),t[n+":hasMarkdown"]&&(s.hasMarkdown=!0);var E="javaRosa-discarded-languages-warning",T=new RegExp("^"+RegExp.escape(n)+":(\\w+)-"),C=e.filter(e.map(e.keys(t),(function(e){var t=e.match(T);if(t&&-1===h.indexOf(t[1]))return t[1]})),e.identity);if(C.length){var I=o.errors.get(null,E);I?(I.langs=e.union(I.langs,C),I.message=gettext("Discarded languages:")+" "+I.langs.join(", ")):o.errors.update(null,{key:E,level:r.WARNING,langs:C,message:gettext("Discarded languages:")+" "+C.join(", ")})}r.validate(n)},n}function p(e){return e.trackLogicReferences=!0,e}function g(e){var t=e.p.constraintMsgItext;return e.p.constraintAttr||!t||t.isEmpty()?"pass":gettext("You cannot have a Validation Error Message with no Validation Condition!")}return a.constraintMsgAttr.visibility="hidden",a.constraintMsgItext=u({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Validation Message"),widget:p((function(e,n){return d.label(e,t.extend(n,{itextType:"constraintMsg",messagesPath:"constraintMsgItext",getItextByMug:function(e){return e.p.constraintMsgItext},displayName:gettext("Validation Message")}))})),validationFunc:function(e){var t=e.p.constraintMsgItext;if(!e.p.constraintAttr&&t&&t.id&&!t.autoId)return gettext("Can't have a Validation Message Itext ID without a Validation Condition");var n=l("constraintMsgItext","Validation Message")(e);return"pass"===n&&(n=g(e)),n}}),a.constraintAttr.validationFunc=g,a.constraintMsgItextID={visibility:"constraintMsgItext",presence:"optional",lstring:gettext("Validation Message Itext ID"),widget:c.id,widgetValuePath:"constraintMsgItext"},a.constraintMediaIText=function(e){return e.isSpecialGroup?void 0:{visibility:function(e){return e.isVisible("constraintAttr")},presence:"optional",lstring:gettext("Add Validation Media"),widget:function(e,n){return d.media(e,t.extend(n,{displayName:gettext("Add Validation Media"),itextType:"constraintMsg",getItextByMug:function(e){return e.p.constraintMsgItext},forms:f.SUPPORTED_MEDIA_TYPES,formToIcon:h}))}}},s.label.visibility="visible_if_present",s.hintLabel.visibility="visible_if_present",s.labelItext=u({visibility:"visible",presence:"optional",lstring:gettext("Display Text"),widget:p((function(e,n){return d.label(e,t.extend(n,{itextType:"label",messagesPath:"labelItext",getItextByMug:function(e){return e.p.labelItext},displayName:gettext("Display Text")}))})),validationFunc:l("labelItext",gettext("Display Text"))}),s.labelItextID={visibility:"labelItext",presence:"optional",lstring:gettext("Display Text Itext ID"),widget:c.id,widgetValuePath:"labelItext"},s.hintItext=u({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Hint Message"),widget:p((function(e,n){return d.label(e,t.extend(n,{itextType:"hint",messagesPath:"hintItext",getItextByMug:function(e){return e.p.hintItext},displayName:gettext("Hint Message")}))})),validationFunc:l("hintItext",gettext("Hint Message"))}),s.hintItextID={visibility:"hintItext",lstring:gettext("Hint Itext ID"),widget:c.id,widgetValuePath:"hintItext"},s.helpItext=u({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Help Message"),widget:p((function(e,n){var i=d.label(e,t.extend(n,{itextType:"help",messagesPath:"helpItext",getItextByMug:function(e){return e.p.helpItext},displayName:gettext("Help Message")}));return i})),validationFunc:l("helpItext",gettext("Help Message"))}),s.helpItextID={visibility:"helpItext",lstring:gettext("Help Itext ID"),widget:c.id,widgetValuePath:"helpItext"},s.addEmptyCaptionItext=u({visibility:"visible",presence:function(e){return e.options.isRepeat&&e.options.customRepeatButtonText?"optional":"notallowed"},lstring:gettext("Add New Item Button Text"),widget:p((function(e,n){var i=d.label(e,t.extend(n,{itextType:"addEmptyCaption",messagesPath:"addEmptyCaptionItext",getItextByMug:function(e){return e.p.addEmptyCaptionItext},displayName:gettext("Add New Item Button Text")}));return i})),validationFunc:l("addEmptyCaptionItext",gettext("Add New Item Button Text"))}),s.addEmptyCaptionItextID={visibility:"addEmptyCaptionItext",lstring:gettext("Add New Itext ID"),widget:c.id,widgetValuePath:"addEmptyCaptionItext"},s.addCaptionItext=u({visibility:"visible",presence:function(e){return e.options.isRepeat&&e.options.customRepeatButtonText?"optional":"notallowed"},lstring:gettext("Add Another Item Button Text"),widget:p((function(e,n){var i=d.label(e,t.extend(n,{itextType:"addCaption",messagesPath:"addCaptionItext",getItextByMug:function(e){return e.p.addCaptionItext},displayName:gettext("Add Another Item Button Text")}));return i})),validationFunc:l("addCaptionItext",gettext("Add Another Item Button Text"))}),s.addCaptionItextID={visibility:"addCaptionItext",lstring:gettext("Add Another Itext ID"),widget:c.id,widgetValuePath:"addCaptionItext"},s.otherItext=function(e){return e.isSpecialGroup?void 0:{visibility:"labelItext",presence:"optional",lstring:gettext("Add Other Content"),widget:function(e,n){return d.configurable(e,t.extend(n,{displayName:gettext("Add Other Content"),itextType:"label",getItextByMug:function(e){return e.p.labelItext},forms:["long","short"],isCustomAllowed:!0}))}}},s.mediaItext=function(e){return e.isSpecialGroup?void 0:{visibility:"labelItext",presence:"optional",lstring:gettext("Add Multimedia"),widget:function(e,n){return d.media(e,t.extend(n,{displayName:gettext("Add Multimedia"),itextType:"label",pathPrefix:"",getItextByMug:function(e){return e.p.labelItext},forms:f.SUPPORTED_MEDIA_TYPES,formToIcon:h}))}}},s.helpMediaIText=function(e){return e.isSpecialGroup?void 0:{visibility:"helpItext",presence:"optional",lstring:gettext("Add Help Media"),widget:function(e,n){return d.media(e,t.extend(n,{displayName:gettext("Add Help Media"),itextType:"help",getItextByMug:function(e){return e.p.helpItext},forms:f.SUPPORTED_MEDIA_TYPES,formToIcon:h}))}}},n},getMainProperties:function(){var e=this.__callOld();return e.splice(1+e.indexOf("label"),0,"labelItext"),e},getLogicProperties:function(){var e=this.__callOld();return e.splice(1+e.indexOf("constraintAttr"),0,"constraintMsgItext"),e},getMediaProperties:function(){var e=this.__callOld();return e.push("constraintMediaIText"),e},getAdvancedProperties:function(){var e=this.__callOld();return(e=e.concat(["labelItextID","constraintMsgItextID","hintItextID","hintItext","helpItextID","helpItext","addEmptyCaptionItextID","addEmptyCaptionItext","addCaptionItextID","addCaptionItext","helpMediaIText"])).concat(["otherItext"])},getToolsMenuItems:function(){var e=this;return this.__callOld().concat([{name:gettext("Edit Bulk Translations"),icon:"fa fa-language",action:function(t){e.showItextModal(t)}}])},showItextModal:function(e){var i,a,r,o=this,s=o.data.javaRosa.Itext,l=o.data.core.form;i=o.generateNewModal(gettext("Edit Bulk Translations"),[{title:gettext("Update Translations"),cssClasses:"btn-primary",action:function(){f.parseXLSItext(l,r.val(),s),i.modal("hide"),e()}}]),a=t(n({description:gettext("Copy these translations into a spreadsheet program like Excel. You can edit them there and then paste them back here when you're done. These will update the translations used in your form. Press 'Update Translations' to save changes, or 'Close' to cancel.")})),i.find(".modal-body").html(a),(r=a.find("textarea")).val(f.generateItextXLS(l,s)),i.modal("show"),i.one("shown.bs.modal",(function(){r.focus()}))}})}.apply(t,i))||(e.exports=a)},3876:(e,t,n)=>{var i,a;i=[n(3946),n(561),n(3809),n(4459),n(7229),n(8094)],void 0===(a=function(e,t,n,i,a,r){var o=["default","audio","image","video","video-inline"],s=["labelItext","hintItext","helpItext","constraintMsgItext","addEmptyCaptionItext","addCaptionItext"],l=function(e){if("Choice"===e.__className){var t=new RegExp(r.invalidAttributeRegex.source,"g");return l(e.parentMug)+"-"+e.getNodeID().replace(t,"_")}var n=e.absolutePathNoRoot;return n||(n=e.parentMug?e.parentMug.absolutePathNoRoot+"/"+e.getNodeID():"/"+e.getNodeID()),n.slice(1)},d=function(e,t){return l(e)+"-"+t},c=function(t,n){var i={};t.tree.walk((function(t,a,r){t&&e.each(s,(function(e){var a=t.p[e];!a||a.key?a&&!i.hasOwnProperty(a.key)&&(i[a.key]=!0,n(a,t,e)):window.console.log("ignoring ItextItem without a key: "+a.id)})),r()}))},u=function(t,n){var i=n,a=[],r={},o=e.object(e.map(s,(function(e){return[e,e.replace("Itext","")]})));return c(t,(function(e,t,s){var l=e.isEmpty();if(!l||i){var c=e.autoId||!e.id?d(t,o[s]):e.id,u=c,f=2;if(r.hasOwnProperty(c)&&(l||e===r[c]))return;for(;r.hasOwnProperty(c);)c=u+f,f++;e.id=c,r[c]=e,n||a.push(e)}})),n?r:a},f=function(e,t){return t?'<output value="format-date(date('+e+"), '"+t+"')\"/>":'<output value="'+e+'" />'};function h(e){return function(n,i,r){if(n){var o=a.query(n);o.find("output").each((function(){var n=t(this),a=n.xmlAttr("value")||n.xmlAttr("ref");try{var r=i.parse(a);n.xmlAttr("value",r[e]())}catch(e){n.xmlAttr("value",a)}})),n=o.toString(),r&&(n=n.replace(/(<)|>/g,(function(e,t){return t?"&lt;":"&gt;"})))}return n}}return{ITEXT_PROPERTIES:s,SUPPORTED_MEDIA_TYPES:["image","audio","video","video-inline"],forEachItextItem:c,generateItextXLS:function(t,i){function a(t,n,i,a){var r=[t];return e.each(i,(function(t){e.each(n,(function(e){r.push(a(e,t))}))})),r}var r=o,s=i.getLanguages(),l=[];if(s.length>0){var d=u(t);l.push(function(e,t){return a("label",e,t,(function(e,t){return t+"_"+e}))}(s,r)),e.each(d,(function(e){l.push(function(e,t,n){return a(e.id,t,n,(function(t,n){return e.hasForm(n)?e.get(n,t):""}))}(e,s,r))}))}return n.tabDelimit(l)},getDefaultItextRoot:l,getDefaultItextId:d,getItextItemsFromMugs:u,getOutputRef:f,insertOutputRef:function(e,t,n,a,o){var s=f(n,o),l=e.data.core.form;l.richText?i.editor(t).insertOutput(s):r.insertTextAtCursor(t,s,!0),a&&(function(e,t,n,i,a){if("."===n){var o=t.p.getDefinition(e).lstring;t.addMessage(a,{key:"core-circular-reference-warning",level:t.WARNING,message:r.format(gettext("The {field} for a question is not allowed to reference the question itself. Please remove the {ref} from the {field} or your form will have errors."),{field:o,ref:i})})}}("label",a,n,gettext("output value"),t.attr("name")),function(e,t,n){if(!t.options.canOutputValue){var i=e.vellum.getCurrentlySelectedMug(),a=t.options.typeName;i&&i.addMessage(null,{key:"javaRosa-output-value-type-error",level:t.WARNING,message:r.format(gettext("{type} nodes cannot be used in an output value. Please remove the output value for '{path}' or your form will have errors."),{type:a,path:n})})}}(l,a,n))},looksLikeMarkdown:function(e,t){var n=/^\d+[\.\)] |^\* |~~.+~~|# |\*{1,3}\S.*\*{1,3}|\[.+\]\(\S+\)/m.test(e),i=!1;return t&&(i=/^(\|[^\n]+\|\r?\n)((?:\|\s*:?[-]+:?\s*)+\|)(\n(?:\|[^\n]+\|\r?\n?)*)?$/m.test(e)),n||i},parseXLSItext:function(i,a,r){var s,l,d,c,f=o,h=r.getLanguages(),p=n.makeRowParser(a),g=p();g&&(g=e.map(g,(function(e){var t=e.split(/[-_]/);return-1===f.indexOf(t[0])||-1===h.indexOf(t[1])?null:{form:t[0],lang:t[1]}})));var m=u(i,!0);for(l=p();l;l=p())if(c=m[l[0]])for(s=1;s<l.length;s++)(d=g[s])&&(c.hasForm(d.form)?c.getForm(d.form).setValue(d.lang,l[s]):t.trim(l[s])&&c.getOrCreateForm(d.form).setValue(d.lang,l[s]));r.fire("change")},outputToXPath:h("toXPath"),outputToHashtag:h("toHashtag")}}.apply(t,i))||(e.exports=a)},6283:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(9320)],void 0===(a=function(e,t){var n;e.fn.popAttr=function(e){var n=!1,i=this.xmlAttr(e);try{this.removeAttr(e),n=!0}catch(e){}return n&&!t.isUndefined(i)&&(this[0].poppedAttributes||(this[0].poppedAttributes={}),this[0].poppedAttributes[e]=i),i},e.fn.xmlAttr=function(e,n){if(t.isObject(e)){var i=this;return t.each(e,(function(e,t){i.xmlAttr(t,e)})),this}var a=arguments.length>1;if(e&&e.indexOf(":")>-1)return a?this.attr(e,n):this.attr(e);var r,o=this.get(0);if(o){if(a)return null===n?this.removeAttr(e):void 0!==n&&((r=document.createAttribute(e)).value=n,o.setAttributeNode(r)),this;if(r=o.attributes.getNamedItem(e))return r.value}return a?this:void 0},e.fn.stopLink=function(){return this.click((function(e){e.preventDefault()})),this},e.fn.fdHelp=function(){return this.append(e("<i />").addClass("fa fa-question-circle")).popover({trigger:"focus",html:!0,container:"body",sanitize:!1}).click((function(e){e.stopPropagation()})),this},e.fn.clickExceptAfterDrag=function(t){var n=e(this);function i(e){t.currentXY=[e.pageX,e.pageY],n.off("mousemove",i)}function a(e){var i=t.currentXY[0]-e.pageX,r=t.currentXY[1]-e.pageY;Math.sqrt(i*i+r*r)<3&&t(e),n.off("mouseup",a)}t.currentXY=[],n.on("mousedown",(function(e){i(e),n.on("mousemove",i).on("mouseup",a)}))},e.fn.disableSelection||e.fn.extend({disableSelection:(n="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(n+".ui-disableSelection",(function(e){e.preventDefault()}))}),enableSelection:function(){return this.off(".ui-disableSelection")}});var i=e.fn.popover.Constructor.prototype.leave;e.fn.popover.Constructor.prototype.leave=function(t){var n,a,r=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);i.call(this,t),t.currentTarget&&(n=e(".popover"),a=r.timeout,n.one("mouseenter",(function(){clearTimeout(a),n.one("mouseleave",(function(){e.fn.popover.Constructor.prototype.leave.call(r,r)}))})))}}.apply(t,i))||(e.exports=a)},952:(e,t,n)=>{var i,a;i=[n(561),n(1460)],void 0===(a=function(e){"use strict";e.jstree.defaults.conditionalevents={should_activate:function(){return!0},redraw_node:function(){var e=Array.prototype.slice.call(arguments);return this.parent.redraw_node.apply(this.inst,e)}},e.jstree.plugins.conditionalevents=function(e,t){this.activate_node=function(){var e=Array.prototype.slice.call(arguments);this.settings.conditionalevents.should_activate.apply(this,e)&&t.activate_node.apply(this,e)},this.redraw_node=function(){var e=Array.prototype.slice.call(arguments),n={inst:this,parent:t};return this.settings.conditionalevents.redraw_node.apply(n,e)},this.edit=function(){}}}.apply(t,i))||(e.exports=a)},5889:(e,t,n)=>{var i,a;i=[n(561),n(1877)],void 0===(a=function(e){e.vellum.plugin("lock",{},{loadXML:function(e){this.data.lock.locks={},this.__callOld()},parseBindElement:function(e,t,n){this.__callOld();var i=t.xmlAttr("vellum:lock");i&&"none"!==i&&(this.data.lock.locks[n]=i)},isPropertyLocked:function(e,t){if(this.__callOld())return!0;var n=this.data.lock.locks[e];return!!n&&(("node"===n||"value"===n)&&"nodeID"===t||"value"===n&&-1===t.indexOf("Itext"))},isMugPathMoveable:function(e){return this.__callOld()&&!this.data.lock.locks[e]},isMugRemoveable:function(e,t){return this.__callOld()&&!this.data.lock.locks[t]},isMugTypeChangeable:function(e,t){return this.__callOld()&&"value"!==this.data.lock.locks[t]}})}.apply(t,i))||(e.exports=a)},4854:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(8094)],void 0===(a=function(e,t,n){var i="#",a="#invalid/xpath ";function r(t,n){if(this._text=t||"",this._xpathParser=n,"string"==typeof this._text&&this._text.startsWith(a))this.parsed=null,this.error=a;else if(e.trim(t))try{this.parsed=this._xpathParser.parse(t)}catch(e){this.parsed=null,this.error=e}else this.parsed=null}function o(e,t){t.allowedDataNodeReferences=t.allowedDataNodeReferences||{},this.opts=t,this.form=e,this.forward={},this.reverse={},this.errors={}}return r.prototype={analyze:function(){var e,t=[],n=[],i=[],a=[],r=this._xpathParser.models.XPathInitialContextEnum.ROOT,o=this._xpathParser.models.XPathInitialContextEnum.RELATIVE,s=this._xpathParser.models.XPathInitialContextEnum.EXPR;if(this.paths=t,this.absolutePaths=n,this.hashtags=a,this.instanceRefs={},this.referencesSelf=!1,this.topLevelPaths=i,this.parsed)for(var l,d,c,u,f,h,p=[{xpath:this.parsed,insideFilter:!1}];p.length>0;){if(l=(f=p.shift()).xpath,h=f.insideFilter,l instanceof this._xpathParser.models.XPathPathExpr){if(t.push(l),h||i.push(l),h=!0,l.initial_context===r)n.push(l);else if(l.initial_context===o&&1===l.steps.length&&"self"===l.steps[0].axis)this.referencesSelf=!0;else if(l.initial_context===s)for(this._addInstanceRef(l.filter.expr)||p.push({xpath:l.filter.expr,insideFilter:h}),e=l.filter.predicates,d=0;d<e.length;d++)p.push({xpath:e[d],insideFilter:h})}else l instanceof this._xpathParser.models.XPathFuncExpr?this._addInstanceRef(l):l instanceof this._xpathParser.models.HashtagExpr&&a.push(l);for(c=l.getChildren(),d=0;d<c.length;d++)if(p.push({xpath:c[d],insideFilter:h}),c[d].predicates&&c[d].predicates.length)for(e=c[d].predicates,u=0;u<e.length;u++)p.push({xpath:e[u],insideFilter:h})}},_addInstanceRef:function(e){if("instance"===e.id&&1===e.args.length&&e.args[0]instanceof this._xpathParser.models.XPathStringLiteral){var t=e.args[0].value;return this.instanceRefs[t]=null,!0}return!1},getPaths:function(){return this.paths||this.analyze(),this.paths},getTopLevelPaths:function(){return this.topLevelPaths||this.analyze(),this.topLevelPaths},getHashtags:function(){return this.hashtags||this.analyze(),this.hashtags},updatePath:function(e,t){var n,i,a,r,o=this.getPaths().concat(this.getHashtags());for(i=0;i<o.length;i++)(n=o[i]).toHashtag()===e&&(a=this._xpathParser.parse(t),(r=n).toHashtag=a.toHashtag.bind(a),r.toXPath=a.toXPath.bind(a))},getText:function(){return this._text&&this.parsed?this.parsed.toHashtag():this._text}},o.prototype={clearReferences:function(e,n){function i(n,i){if(i.ref){if(i.mug!==e.ufid)throw new Error([e,i]);r[i.ref][i.mug]=t.filter(r[i.ref][i.mug],(function(e){return e.property!==n}))}}var a,r=this.reverse,o=this.forward,s=this.errors;e.form.dropAllInstanceReferences(e,n,!0),o.hasOwnProperty(e.ufid)?n?(o[e.ufid].hasOwnProperty(n)&&(a=t.partial(i,n),t.each(o[e.ufid][n],a)),o[e.ufid][n]=[]):(t.each(o[e.ufid],(function(e,n){a=t.partial(i,n),t.each(e,a)})),o[e.ufid]={}):o[e.ufid]={},s.hasOwnProperty(e.ufid)&&(n?delete this.errors[e.ufid][n]:delete this.errors[e.ufid])},_addReferences:function(e,o,s){s=this.form.getLogicalXPath(s||e.p[o]);var l,d=this,c=d.form,u=new r(s,c.xpath),f=[],h=[],p="",g=e.spec[o],m=g?g.lstring:o,v=this.reverse;return h.push({key:"logic-invalid-xpath-warning",level:e.WARNING,message:u.error===a?gettext("Invalid XPath expression."):""}),u.analyze(),!u.referencesSelf||g&&g.mayReferenceSelf||(p=n.format(gettext("The {property} for a question is not allowed to reference the question itself. Please remove the . from the {property} or your form will have errors."),{property:m})),h.push({key:"core-circular-reference-warning",level:e.WARNING,message:p}),l=u.absolutePaths.concat(u.hashtags).map((function(t){var n=t.toHashtag(),a=n.startsWith("#"),r=a?n:t.pathWithoutPredicates(),s=a?"":r.substring(1+r.indexOf("/",1)),l=c.getMugByPath(r),u=c.hasValidHashtagPrefix(n),h=u&&c.isValidHashtag(n);(l||h||e.options.ignoreReferenceWarning&&e.options.ignoreReferenceWarning(e)||-1!==d.opts.allowedDataNodeReferences.indexOf(s)||"dataParent"===o&&r===c.getBasePath().slice(0,-1))&&(l||!u||h)||f.push(n);var p=l?l.ufid:u?i:"",g={mug:e.ufid,ref:p,property:o,path:n,sourcePath:e.hashtagPath};return p&&(v.hasOwnProperty(p)?v[p].hasOwnProperty(e.ufid)||(v[p][e.ufid]=[]):(v[p]={},v[p][e.ufid]=[]),v[p][e.ufid].push(g)),g})),this.forward[e.ufid][o]=l,t.each(u.instanceRefs,(function(t,n){c.referenceInstance(n,e,o)})),t.each(u.hashtags,(function(t){c.referenceHashtag(t.toHashtag(),e,o)})),f.length>0?(this.errors[e.ufid]||(this.errors[e.ufid]={}),this.errors[e.ufid][o]=!0):this.errors[e.ufid]&&delete this.errors[e.ufid][o],h.push({key:"logic-bad-path-warning",level:e.WARNING,message:f.length?1===f.length?gettext("Unknown question:")+" "+f[0]:gettext("Unknown questions:")+"\n- "+f.join("\n- "):""}),h},addReferences:function(e,n,i){var a=this,r={};return this.clearReferences(e,n),!i&&e.p[n]&&t.isFunction(e.p[n].mapLogicExpressions)?e.p[n].mapLogicExpressions((function(i){var o=a._addReferences(e,n,i);return t.filter(o,(function(e){if(r.hasOwnProperty(e.key)){if(!r[e.key].message||!e.message)return e.message&&t.extend(r[e.key],e),!1}else r[e.key]=e;return!0}))})):this._addReferences(e,n,i)},updateReferences:function(e,n,i){function a(t){o[t]=r.addReferences(e,t,i)}var r=this,o={};n?a(n):t.each(e.logicReferenceAttrs,a),e.addMessages(o)},updatePath:function(e,t,n,i){if(t!==n){var a={};a[e]=[t,n],this.updatePaths(a,i)}},updatePaths:function(e,n){var i={},a=this.form;this.forEachReferencingProperty(e,(function(e,n,o){function s(e){if(!e)return e;var t=new r(e,a.xpath),n=t.getText();t.updatePath(o[0],o[1]);var i=t.getText();return i!==n?i:e}var l=e.ufid+" "+n+" "+o[0];if(!i.hasOwnProperty(l)){i[l]=null;var d=e.p[n];if(d&&t.isFunction(d.updateLogicExpressions))d.updateLogicExpressions(s,e);else{var c=s(d);d!==c&&e.p.set(n,c)}}}),n)},forEachBrokenReference:function(e){t.each(this.errors,(function(n,i){var a=this.form.getMugByUFID(i);a?n?t.each(n,(function(t,n){e(a,n)})):e(a):delete this.errors[i]}),this)},hasBrokenReferences:function(){return t.find(this.errors,(function(e){return t.some(e)}))},validateExternalReferences:function(){var e=this,n=t.chain(this.reverse[i]||{}).values().flatten(!0).filter((function(t){return!e.form.isValidHashtag(t.path)})).value();t.each(n,(function(t){var n=e.form.getMugByUFID(t.mug);e.updateReferences(n,t.property)}))},forEachReferencingProperty:function(e,n,i){var a=this.form,r=this.reverse;t.each(e,(function(e,o){r.hasOwnProperty(o)&&t.each(r[o],(function(r,o){var s=a.getMugByUFID(o);t.each(r,(function(t){i&&t.sourcePath!==i&&0!==t.sourcePath.indexOf(i+"/")||n(s,t.property,e)}))}))}))},hasReferencingMug:function(e,n){var i=this.form;return!!this.reverse.hasOwnProperty(e.ufid)&&t.find(this.reverse[e.ufid],(function(e,t){var a=i.getMugByUFID(t);return e.length&&a&&n(a)}))},reset:function(){this.forward={},this.reverse={}},caseReferences:function(){var e=this,n={},a={};t.each(t.flatten(t.values(this.reverse[i]||{})),(function(i){var a=e.form.normalizeXPath(i.sourcePath);if(null===a){var r=e.form.getMugByUFID(i.mug).parentMug;r&&(a=r.absolutePath)}n.hasOwnProperty(a)?t.contains(n[a],i.path)||n[a].push(i.path):n[a]=[i.path]}));var r=t.filter(this.form.getMugList(),(function(e){return void 0!==e.options.getCaseSaveData}));return t.each(r,(function(t){var n=e.form.getAbsolutePath(t);a[n]=t.options.getCaseSaveData(t)})),{load:n,save:a}},knownExternalReferences:function(){var e=this;return t.chain(this.reverse[i]||{}).values().flatten(!0).filter((function(t){return e.form.isValidHashtag(t.path)})).map((function(e){return[e.path,null]})).object().value()},findUsages:function(e){var n=this.form,a={},r=t.omit(this.reverse,i);return t.each(r,(function(i,r){var o=n.getMugByUFID(r),s={};!o||e&&e!==o.hashtagPath||(t.each(i,(function(e,i){t.each(e,(function(e){var t=n.getMugByUFID(i),a=t.hashtagPath,r=t.spec[e.property].lstring;a||(a=t.parentMug.hashtagPath),s[a]=r}))})),a[o.hashtagPath]=s)})),a}},{LogicManager:o,LogicExpression:r}}.apply(t,i))||(e.exports=a)},8803:(e,t,n)=>{var i,a;window.gettext||(window.gettext=function(e){return e},window.ngettext=function(e,t,n){return 1===n?e:t}),i=[n(1877),n(8360),n(5465),n(9333),n(3391),n(5382),n(5889),n(5304),n(9208),n(1374),n(8610),n(7100),n(8922),n(1437),n(3586),n(37)],void 0===(a=function(){}.apply(t,i))||(e.exports=a)},7903:(e,t,n)=>{var i,a;i=[n(2922),n(3946)],void 0===(a=function(e,t){var n=e("zero").enable(["link","emphasis","strikethrough","heading","list","table"]),i=n.renderer.rules.link_open||function(e,t,n,i,a){return a.renderToken(e,t,n)};return n.renderer.rules.link_open=function(e,t,n,a,r){var o=e[t].attrIndex("target");return o<0?e[t].attrPush(["target","_blank"]):e[t].attrs[o][1]="_blank",i(e,t,n,a,r)},function(e){return t.isString(e)?(e=e.replace(/\\\\n/g,"\n"),n.render(e)):""}}.apply(t,i))||(e.exports=a)},1374:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(1874),n(4078),n(7417),n(7026),n(8094),n(1877)],void 0===(a=function(e,t,n,i,a,r,o){var s=i.baseMugTypes.normal.Repeat,l=[{key:"ids",event:"xforms-ready",path:"",query:"join(' ', {})"},{key:"count",event:"xforms-ready",path:"",query:"count-selected({}/@ids)"},{key:"index",event:"jr-insert",path:"/item",query:"int({}/@current_index)"},{key:"id",event:"jr-insert",path:"/item",query:"selected-at({}/@ids, ../@index)"}],d=/^ *join\(['"] ['"], *(.*)\) *$/i,c={supportsDataNodeRole:!0,isRepeat:!0,getPathName:function(e,t){return e.p.dataSource.idsQuery&&(t+="/item"),t},parseDataNode:function(e,t){return e.p.dataSource={idsQuery:"value for getPathName"},t.children("item").children()},dataChildFilter:function(e,t){return t.p.dataSource.idsQuery?[new r.Node(e,{getNodeID:function(){return"item"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{id:"",index:"","jr:template":""}}}})]:e},controlChildFilter:function(e,t){var n=t.hashtagPath,i=t.p.repeat_count;return(e=s.controlChildFilter(e,t))[0].getValue().options.writeCustomXML=function(e,t){i&&(o.writeHashtags(e,"jr:count",String(i),t),e.writeAttributeString("jr:noAddRemove","true()")),o.writeHashtags(e,"nodeset",n,t)},e},getExtraDataAttributes:function(e){return e.p.dataSource.idsQuery?{ids:"",count:"",current_index:"","vellum:role":"Repeat"}:s.getExtraDataAttributes(e)},getBindList:function(e){var t=e.absolutePath,n=s.getBindList(e);return e.p.dataSource.idsQuery&&n.splice(0,0,{nodeset:t.replace(/\/item$/,"/@current_index"),calculate:"count("+t+")"}),n},init:function(e,t){s.init(e,t),e.p.repeat_count="",e.p.setvalues={},e.p.originalPath=null,e.p.dataSource={},e.p.dataSourceChanged=!1,e.options.customRepeatButtonText=t.vellum.opts().features.use_custom_repeat_button_text},spec:{nodeID:{deserialize:function(e,n,a,r){var o=i.baseSpecs.databind.nodeID.deserialize;if(e.dataSource){var s=e.id.slice(0,e.id.lastIndexOf("/"))||e.id;return o(t.extend({},e,{id:s}),n,a,r)}return o(e,n,a,r)}},repeat_count:t.extend({},s.spec.repeat_count,{visibility:function(e){return!e.p.dataSource.idsQuery}}),dataSource:{lstring:gettext("Data Source"),visibility:"visible_if_present",presence:"optional",widget:function(t,i){var a=n.advancedDataSourceWidget(t,i,gettext("Model Iteration ID Query")),r=a.getValue,o=a.setValue;return a.input.attr({readonly:"readonly"}),a.getValue=function(){var t=r();return{instance:e.trim(t.src)?{id:t.id,src:t.src}:null,idsQuery:t.query}},a.setValue=function(e){o({id:(e=e||{}).instance?e.instance.id:"",src:e.instance?e.instance.src:"",query:e.idsQuery||""})},a},validationFunc:function(e){e.p.dataSource.idsQuery&&e.form.updateLogicReferences(e,"dataSource",e.p.dataSource.idsQuery)},serialize:function(e,t,n,a){if(e&&e.idsQuery)return{idsQuery:i.serializeXPath(e.idsQuery,t,n,a)}},deserialize:function(e,t,n,a){var r=e[t]||{};if(i.updateInstances(e,n),r&&r.instance&&r.instance.id&&r.instance.src){var o={};o[r.instance.id]=r.instance.src,n.form.updateKnownInstances(o)}var s={},l={form:n.form,p:s};return s.idsQuery=i.deserializeXPath(r,"idsQuery",l,a),s}}},ignoreReferenceWarning:function(e){return u(e)},getSetValues:function(e){var n=e.absolutePath,i=e.p.dataSource.idsQuery,a=[];if(i){n=n.replace(/\/item$/,""),e.p.repeat_count=n+"/@count";var r=e.parentMug&&e.parentMug.isInRepeat(),o=e.p.setvalues;t.each(l,(function(e){var t=r?"jr-insert":e.event,s=o[e.key];s||(s={}),s.ref=n+e.path+"/@"+e.key,s.value=e.query.replace("{}","ids"===e.key?i:n),s.event||(s.event=t),a.push({event:t,ref:s.ref,value:s.value})}))}return a}};function u(e){return e&&"Repeat"===e.__className&&e.p.dataSource.idsQuery}e.vellum.plugin("modeliteration",{},{getMugTypes:function(){var e=this.__callOld();return e.normal.Repeat=o.extend(s,c),e},updateControlNodeAdaptorMap:function(e){this.__callOld();var t=e.group;e.group=function(e,n,i,r){var o=t(e,n,i,r);if(o.repeat){var s,l=o.repeat,d=o.path;/\/item$/.test(d)&&(s=i.getMugByPath(d.substring(0,d.length-5)))&&"Repeat"===s.__className&&((o=function(e,t){return s.p.nodeset=d,s.p.repeat_count=l.popAttr("jr:count")||null,s.p.rawRepeatAttributes=a.getAttributes(l),s}).type="Repeat",o.path=d,o.repeat=l,o.ignoreDataNode=!0)}return o}},parseBindElement:function(e,t,n){var i=e.getMugByPath(n);if(!i){var a=n.replace(/\/@current_index$/,"/item");if(n!==a&&u(i=e.getMugByPath(a)))return}this.__callOld()},handleMugParseFinish:function(e){if(this.__callOld(),"Repeat"===e.__className){var n=e.absolutePath,i=null;if(e.p.dataSource.idsQuery&&(i=n.replace(/\/item$/,"")),e.p.originalPath=n,e.p.dataSource={},e.p.dataSourceChanged=!1,e.p.setvalues={},null!==i){var a=e.parentMug&&e.parentMug.isInRepeat(),r=t.object(t.map(e.form.getSetValues(),(function(e){return[e.event+" "+e.ref,e]})));t.each(l,(function(t){var n=a?"jr-insert":t.event,o=r[n+" "+i+t.path+"/@"+t.key];if(o&&(e.p.setvalues[t.key]=o,"ids"===t.key)){var s=(o=o.value)&&o.match(d);e.p.dataSource.idsQuery=s?s[1]:o}})),e.p.dataSource.idsQuery?e.p.dataSource.instance=e.form.parseInstance(e.p.dataSource.idsQuery,e,"dataSource"):e.p.dataSource.idsQuery="''",e.p.rawDataAttributes=t.omit(e.p.rawDataAttributes,["ids","count","current_index"]),function(e){if(e.p.setvalues){var n=t.groupBy(e.p.setvalues,"_id");e.form.dropSetValues((function(e){return n.hasOwnProperty(e._id)}))}}(e)}}},loadXML:function(){this.__callOld(),this.data.core.form.on("mug-property-change",(function(e){var t=e.mug;"Repeat"===t.__className&&"dataSource"===e.property&&(t.p.dataSourceChanged=!0,function(e,t,n){if(n&&n.instance&&n.instance.src&&e.form.dropInstanceReference(n.instance.src,e,"dataSource.instance"),t&&t.instance&&t.instance.src){var i=e.form.addInstanceIfNotExists(t.instance,e,"dataSource.instance");i!==t.instance.id&&(t.instance.id=i,t.idsQuery=e.form.updateInstanceQuery(t.idsQuery,i))}if(Boolean(t&&t.idsQuery)!==Boolean(n&&n.idsQuery)){var a,r=e.p.nodeID,o=e.hashtagPath,s=e.parentMug;t&&t.idsQuery?a=o.replace(/\/item$/,""):(a=o+"/item",/\/@count$/.test(e.p.repeat_count)&&(e.p.repeat_count="")),e.form.vellum.handleMugRename(e.form,e,r,r,o,a,s)}}(t,e.val,e.previous))}))}})}.apply(t,i))||(e.exports=a)},4078:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(7026),n(705),n(4854),n(8094)],void 0===(a=function(e,t,n,i,a,r){function o(n,i,a,o){var l=null;r.eventuality(this),o&&(l=t.object(t.map(o,(function(n,i){return n&&"object"==typeof n&&(n=e.isPlainObject(n)?t.clone(n):n.clone()),[i,n]})))),this.ufid=r.get_guid(),this.form=i,this.messages=new s,this._baseSpec=a,this.setOptionsAndProperties(n,l)}function s(){this.messages={}}function l(e){this.__data={},this.__spec=e.spec,this.__mug=e.mug,this.shouldChange=function(){return function(){}}}function d(e,n,i,a){e&&/\binstance\(/.test(e)&&(a.instances=t.extend(a.instances||{},i.form.parseInstanceRefs(e)));try{e&&(e=i.form.xpath.parse(e.toString()).toHashtag())}catch(n){t.isString(e)&&!e.startsWith("#invalid/")&&(e="#invalid/xpath "+e)}return e||void 0}function c(e,n,i,a){u(e,i);var r=e[n];if(r)try{r=i.form.xpath.parse(r).toHashtag(),a.later((function(){i.p[n]=a.transformHashtags(r)}))}catch(e){t.isString(r)&&!r.startsWith("#invalid/")&&(r="#invalid/xpath "+r)}else null===r&&(r=void 0);return r}function u(e,n){e.hasOwnProperty("instances")&&!t.isEmpty(e.instances)&&n.form.updateKnownInstances(e.instances)}function f(e){e.p.conflictedNodeId=null}o.prototype={setOptionsAndProperties:function(n,i){var a=this,o=i||this.p&&this.p.getAttrs()||{};this.logicReferenceAttrs=[],this.options=r.extend(g,n),this.__className=this.options.__className,this.showChangedMsg=!0,this.spec=function(n,i,a){var r=n.control,o=n.databind;a.isDataOnly?r={}:a.isControlOnly&&(o={});var s=e.extend(!0,{},o,r,i);return t.each(s,(function(e,n){t.isFunction(e)&&(e=e(a)),e?s[n]=e:delete s[n]})),s}(this._baseSpec,this.options.spec,this.options),t.each(this.spec,(function(e,t){e.deleteOnCopy&&delete o[t],"notallowed"!==a.getPresence(t)&&e.widget&&e.widget.trackLogicReferences&&a.logicReferenceAttrs.push(t)})),this.p=new l({spec:this.spec,mug:this}),this.options.init(this,this.form),this.p.setAttrs(o),this.p.shouldChange=this.form.shouldMugPropertyChange.bind(this.form)},getAppearanceAttribute:function(){return this.options.getAppearanceAttribute(this)},getIcon:function(){return this.options.getIcon(this)},validate:function(e){var n=this;return r.checkForFormSubmissions(n.form),this._withMessages((function(){var i=!1;return n.form.updateLogicReferences(n,e),e?i=n._validate(e):t.each(t.keys(n.p.__data),(function(e){i=n._validate(e)||i})),i}))},_validate:function(e){var t=this,n=t.spec[e];if(!n)return window.console.log("unexpected property: "+e),!1;var i=t.p[e],a=t.getPresence(e),o=n.lstring||e,s="";if(i||"required"!==a){if(i&&"notallowed"===a)s=gettext("{question} is not allowed.");else if(n.validationFunc){try{s=n.validationFunc(t)}catch(e){s=gettext("{question} validation failed")+"\n"+r.formatExc(e)}"pass"===s&&(s="")}}else s=gettext("{question} is required.");return this.messages.update(e,{key:"mug-"+e+"-error",level:this.ERROR,message:r.format(s||"",{question:o})})},ERROR:"error",WARNING:"warning",INFO:"info",addMessage:function(e,t){var n=this.messages;return this._withMessages((function(){return n.update(e,t)}))},dropMessage:function(e,t){var n=this.spec[e],i=this.addMessage(e,{key:t});return n&&n.dropMessage&&n.dropMessage(this,e,t),i},addMessages:function(e){var n=this;this._withMessages((function(){return t.reduce(e,(function(e,i,a){return t.reduce(i,(function(e,t){return n.messages.update(a,t)||e}),!1)||e}),!1)}))},_withMessages:function(e){var n=t.isUndefined(this._messagesChanged),i=!1;n&&(this._messagesChanged=!1);try{(i=e()||this._messagesChanged)&&(n?this.fire({type:"messages-changed",mug:this}):this._messagesChanged=!0)}finally{n&&delete this._messagesChanged}return i},getErrors:function(){var e=[];return this.messages.each((function(t){"info"!==t.level&&e.push(t.message)})),t.uniq(e)},hasErrors:function(){return 0!==this.getErrors().length},getSerializationWarnings:function(){var e=[];return this.messages.each((function(t){t.fixSerializationWarning&&e.push(t)})),e},fixSerializationWarnings:function(e){var n=this;t.each(e,(function(e){e.fixSerializationWarning(n)}))},getLabelValue:function(){return this.p.label||""},getNodeID:function(){return this.p.nodeID},getPresence:function(e){var n=this.spec[e];if(t.isUndefined(n))throw new Error("unknown property: $1.spec.$2".replace("$1",this.__className).replace("$2",e));return t.isFunction(n.presence)?n.presence(this):n.presence},isVisible:function(e){if("notallowed"===this.getPresence(e))return!1;var n=this.spec[e],i=n.visibility;if("visible"===i)return!0;if("visible_if_present"===i)return!t.isUndefined(this.p[e]);if("hidden"===i)return!1;if(t.isFunction(i))return i(this,n);if(this.spec.hasOwnProperty(i))return this.isVisible(i);throw new Error("unknown visibility: $1.spec.$2 = $3".replace("$1",this.__className).replace("$2",e).replace("$3",String(i)))},getDisplayName:function(t,n){void 0===n&&(n=!0);var i,a,r=this.p.labelItext,o=this.form.vellum.data.javaRosa.Itext.getDefaultLanguage(),s=this.p.conflictedNodeId||this.p.nodeID;return"ReadOnly"===this.__className?gettext("Unknown (read-only) question type"):"Itemset"===this.__className?gettext("Lookup Table Data"):r&&"_ids"!==t?(t=t||o)?(a=r.get("default",o),(i=r.get("default",t)||a)&&i!==s?(t!==o&&i===a&&(i+=" ["+o+"]"),n?e("<div>").text(i).html():i):s):gettext("No Translation Data"):s},serialize:function(){var e=this,n={type:e.__className};return t.each(e.spec,(function(i,a){if("notallowed"!==e.getPresence(a)){var r=e.p[a];i.serialize?(r=i.serialize(r,a,e,n),t.isUndefined(r)||(n[a]=r)):!r||t.isEmpty(r)&&(t.isObject(r)||t.isArray(r))||(n[a]=r)}})),n},deserialize:function(e,n){var i=this;t.each(i.spec,(function(a,r){if("notallowed"!==i.getPresence(r))if(a.deserialize){var o=a.deserialize(e,r,i,n);t.isUndefined(o)||(i.p[r]=o)}else e.hasOwnProperty(r)&&(i.p[r]=e[r])}))},teardownProperties:function(){this.fire({type:"teardown-mug-properties",mug:this})},isInRepeat:function(){return"Repeat"===this.__className||this.parentMug&&this.parentMug.isInRepeat()},isReferencedByOtherMugs:function(e){return this.form.isReferencedByOtherMugs(this,e)}},Object.defineProperty(o.prototype,"absolutePath",{get:function(){return this.form.getAbsolutePath(this)}}),Object.defineProperty(o.prototype,"absolutePathNoRoot",{get:function(){return this.form.getAbsolutePath(this,!0)}}),Object.defineProperty(o.prototype,"hashtagPath",{get:function(){return this.options.isHashtaggable&&this.absolutePathNoRoot?"#form"+this.absolutePathNoRoot:this.absolutePath}}),Object.defineProperty(o.prototype,"parentMug",{get:function(){var e=this.form.tree.getNodeFromMug(this);return e&&e.parent?e.parent.value:null}}),Object.defineProperty(o.prototype,"previousSibling",{get:function(){return this.form.tree.getPreviousSibling(this)}}),s.prototype={update:function(e,t){if(e=e||"",1===arguments.length)return!!this.messages.hasOwnProperty(e)&&(delete this.messages[e],!0);if(!this.messages.hasOwnProperty(e)&&!t.message)return!1;if(!t.key)throw new Error("missing key: "+JSON.stringify(t));for(var n=this.messages[e]||[],i=!1,a=n.length-1;a>=0;a--){var r=n[a];if(r.key===t.key){if(r.level===t.level&&r.message===t.message)return!1;n.splice(a,1),i=!0;break}}if(t.message)n.push(t);else if(!i)return!1;return n.length?this.messages[e]=n:delete this.messages[e],!0},get:function(e,n){return arguments.length?n?t.find(this.messages[e||""],(function(e){return e.key===n}))||null:t.pluck(this.messages[e||""],"message"):t.flatten(t.map(this.messages,(function(e){return t.pluck(e,"message")})))},each:function(){var e,n;arguments.length>1?(e=arguments[0]||"",n=arguments[1],t.each(this.messages[e],n)):(n=arguments[0],t.each(this.messages,(function(e,i){t.each(e,(function(e){n(e,i)}))})))},isEmpty:function(){return t.isEmpty(this.messages)}},l.setBaseSpec=function(e){t.each(e,(function(e,t){Object.defineProperty(l.prototype,t,{get:function(){return this._get(t)},set:function(e){this._set(t,e)},configurable:!0})}))},l.prototype={getDefinition:function(e){return this.__spec[e]},getAttrs:function(){return t.clone(this.__data)},has:function(e){return this.__data.hasOwnProperty(e)},set:function(e,t){arguments.length>1?this.__data[e]=t:delete this.__data[e]},_get:function(e){return this.__data[e]},_set:function(e,t){var n=this.__spec[e],i=this.__data[e],a=this.__mug;if(n&&t!==i&&("notallowed"!==a.getPresence(e)||"DataBindOnly"===a.__className)){var r=this.shouldChange(a,e,t,i);r&&(n.setter?n.setter(a,e,t):this.__data[e]=t,r())}},setAttrs:function(e){var n=this;t(e).each((function(e,t){n[t]=e}))}};var h={case:!0,registration:!0,script:!0},p={databind:{nodeID:{visibility:"visible",presence:"required",lstring:gettext("Question ID"),setter:function(e,t,n){e.form.moveMug(e,"rename",n)},mugValue:function(e,t){if(1===arguments.length)return e.p.has("conflictedNodeId")?e.p.conflictedNodeId:e.p.nodeID;e.p.nodeID=t},widget:i.identifier,validationFunc:function(e){var t=e.p.nodeID.toLowerCase(),n={key:"mug-nodeID-reserved-name-warning",level:e.WARNING},i={key:"mug-nodeID-changed-warning",level:e.INFO},a="pass";return h.hasOwnProperty(t)&&(n.message=r.format(gettext("The ID '{nodeID}' may cause problems with form parsing. It is recommended to pick a different Question ID."),{nodeID:e.p.nodeID})),e.addMessage("nodeID",n),r.isValidElementName(e.p.nodeID)?"meta"===e.p.nodeID.toLowerCase()?a=gettext("'meta' is not a valid Question ID."):e.form.warnWhenChanged&&e.showChangedMsg&&e.__originalNodeID&&e.p.nodeID!==e.__originalNodeID&&(i.message=gettext("Making this change will create a new Question ID (and a new column in exports).")):a=r.format(gettext("{nodeID} is not a valid Question ID. It must start with a letter and contain only letters, numbers, and '-' or '_' characters."),{nodeID:e.p.nodeID}),e.addMessage("nodeID",i),a},dropMessage:function(e,t,n){"nodeID"===t&&"mug-conflictedNodeId-warning"===n&&f(e)},serialize:function(e,t,n,i){i.id=n.absolutePathNoRoot},deserialize:function(e,t,n,i){return e.id&&e.id!==n.p.nodeID&&(n.p.nodeID=e.id.slice(e.id.lastIndexOf("/")+1)||n.form.generate_question_id(null,n),e.conflictedNodeId)?i.later((function(){n.p.nodeID=e.conflictedNodeId})):i.later((function(){n.p.conflictedNodeId&&f(n)}))}},conflictedNodeId:{visibility:"hidden",presence:"optional",setter:function(e,t,n){var i=null;n?(e.p.set(t,n),i=gettext("This question has the same Question ID as another question in the same group. Please choose a unique Question ID.")):e.p.set(t),e.addMessage("nodeID",{key:"mug-conflictedNodeId-warning",level:e.WARNING,message:i,fixSerializationWarning:f})},deserialize:function(){}},dataValue:{visibility:"visible_if_present",presence:"optional",lstring:gettext("Default Data Value")},xmlnsAttr:{visibility:"visible",presence:"notallowed",lstring:gettext("Special Hidden Value XMLNS attribute")},rawDataAttributes:{presence:"optional",lstring:gettext("Extra Data Attributes")},relevantAttr:{visibility:"visible",presence:"optional",widget:i.xPath,xpathType:"bool",serialize:d,deserialize:c,lstring:gettext("Display Condition")},calculateAttr:{visibility:"visible_if_present",presence:"optional",widget:i.xPath,xpathType:"generic",serialize:d,deserialize:c,lstring:gettext("Calculate Condition")},constraintAttr:{visibility:"visible",presence:"optional",validationFunc:function(e){return p.databind.constraintMsgAttr.validationFunc(e)},widget:i.xPath,xpathType:"bool",mayReferenceSelf:!0,serialize:d,deserialize:c,lstring:gettext("Validation Condition")},constraintMsgAttr:{visibility:"visible",presence:"optional",validationFunc:function(e){return e.p.constraintMsgAttr&&!e.p.constraintAttr?gettext("You cannot have a Validation Error Message with no Validation Condition!"):"pass"},lstring:gettext("Validation Error Message")},requiredAttr:{visibility:"visible",presence:"optional",lstring:gettext("Required"),widget:i.checkbox,validationFunc:function(e){return p.databind.requiredCondition.validationFunc(e)}},requiredCondition:{visibility:"requiredAttr",presence:"optional",lstring:gettext("Required Condition"),widget:i.xPath,xpathType:"bool",serialize:d,deserialize:c,validationFunc:function(e){var n="mug-requiredCondition-warning",i=["requiredAttr","requiredCondition"];if(e.p.requiredCondition&&!e.p.requiredAttr){var a=gettext("The condition will be ignored unless you mark the question required.");t.each(i,(function(t){e.addMessage(t,{key:n,level:e.WARNING,message:a})}))}else t.each(i,(function(t){e.dropMessage(t,n)}));return"pass"}},nodeset:{visibility:"hidden",presence:"optional"},rawBindAttributes:{presence:"optional",lstring:gettext("Extra Bind Attributes")},defaultValue:{visibility:"visible",presence:"optional",lstring:gettext("Default Value"),widget:i.xPath,xpathType:"generic",serialize:d,deserialize:c,validationFunc:function(e){if(!e.form.vellum.opts().features.allow_data_reference_in_setvalue){var n=e.form.getHashtagsInXPath(e.p.defaultValue);if((n=t.filter(n,(function(e){return"form"===e.namespace}))).length)return gettext("You are referencing a node in this form. This can cause errors in the form")}return"pass"}},comment:{lstring:gettext("Comment"),visibility:"visible",widget:i.multilineText}},control:{appearance:{deleteOnCopy:!0,visibility:"visible",presence:"optional",lstring:gettext("Appearance Attribute")},label:{visibility:"visible",presence:"optional",lstring:gettext("Default Display Text"),validationFunc:function(e){return e.p.label||"required"!==e.getPresence("label")?"pass":gettext("Default Display Text is required")}},hintLabel:{visibility:"visible",presence:"optional",lstring:gettext("Hint Display Text")},rawControlAttributes:{presence:"optional",lstring:gettext("Extra Control Attributes")},rawControlXML:{presence:"optional",lstring:gettext("Raw XML")},dataParent:{lstring:gettext("Data Parent"),visibility:"visible",presence:"optional",setter:function(e,t,n){var i=e.hashtagPath;e.p.set(t,n),e.form._updateMugPath(e,i)},widget:i.droppableText,validationFunc:function(e){function t(e){return e?"limited"===e.options.possibleDataParent?e:t(e.parentMug):null}var n,i=e.p.dataParent,a=e.form;if(i)if(n=a.getMugByPath(i)){if(n===e||!n.options.possibleDataParent)return r.format(gettext("{path} is not a valid data parent"),{path:n.hashtagPath});if(t(e)!==t(n))return gettext("Data parent of question in repeat group must be (in) the same repeat group")}else if(a.getBasePath().slice(0,-1)!==i)return gettext("Must be valid path");return"pass"}}}},g={typeName:"Base",tagName:"input",isDataOnly:!1,isControlOnly:!1,isTypeChangeable:!0,typeChangeError:function(e,t){return""},changeTypeTransform:function(e){},isRemoveable:!0,isCopyable:!0,canOutputValue:!0,maxChildren:-1,icon:null,supportsDataNodeRole:!1,parseDataNode:function(e,t){return t.children()},controlNodeChildren:null,getPathName:null,getTagName:null,dataChildFilter:null,controlChildFilter:null,getExtraDataAttributes:null,writeDataNodeXML:null,getBindList:function(e){var n,i,a=e.p.constraintMsgItext;n=a&&!a.isEmpty()?"jr:itext('"+a.id+"')":e.p.constraintMsgAttr,i=e.p.requiredAttr&&e.p.requiredCondition||r.createXPathBoolFromJS(e.p.requiredAttr);var o={nodeset:e.hashtagPath,type:e.options.dataType,constraint:e.p.constraintAttr,"jr:constraintMsg":n,relevant:e.p.relevantAttr,required:i,requiredCondition:e.p.requiredCondition,calculate:e.p.calculateAttr};return t.each(e.p.rawBindAttributes,(function(e,n){o.hasOwnProperty(n)&&!t.isUndefined(o[n])||(o[n]=e)})),o.nodeset?[o]:[]},getSetValues:function(e){var t=[];return e.p.defaultValue&&(t=[{value:e.p.defaultValue,event:e.isInRepeat()?"jr-insert":"xforms-ready",ref:e.hashtagPath}]),t},writeControlLabel:!0,writeControlHint:!0,writeControlHelp:!0,writeControlAlert:!0,writeControlRefAttr:"ref",writeCustomXML:null,writesOnlyCustomXML:!1,afterInsert:function(e,t){},getAppearanceAttribute:function(e){return e.p.appearance},getIcon:function(e){return e.options.icon},isHashtaggable:!0,init:function(e,t){},spec:{}},m=r.extend(g,{isDataOnly:!0,typeName:gettext("Hidden Value"),icon:"fcc fcc-fd-variable",isTypeChangeable:!1,spec:{xmlnsAttr:{presence:"optional"},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{visibility:"visible"}}}),v=r.extend(g,{writesOnlyCustomXML:!0,writeCustomXML:function(t,n){return t.writeXML(e("<div>").append(n.p.rawControlXML).clone().html())},spec:{readOnlyControl:{visibility:"visible",widget:i.readOnlyControl}}}),E=r.extend(g,{typeName:gettext("Text"),dataType:"xsd:string",icon:"fcc fcc-fd-text",init:function(e,t){}}),T=r.extend(E,{typeName:gettext("Phone Number or Numeric ID"),icon:"fa fa-signal",init:function(e,t){E.init(e,t),e.p.appearance="numeric"},changeTypeTransform:function(e){e.p.appearance=void 0}}),C=r.extend(g,{typeName:gettext("Password"),dataType:"xsd:string",tagName:"secret",icon:"fa fa-key",canOutputValue:!1,init:function(e,t){}}),I=r.extend(g,{typeName:gettext("Integer"),dataType:"xsd:int",icon:"fcc fcc-fd-numeric",init:function(e,t){}}),b=r.extend(g,{typeName:gettext("Audio Capture"),dataType:"binary",tagName:"upload",icon:"fcc fcc-fd-audio-capture",mediaType:"audio/*",canOutputValue:!1,writeCustomXML:function(e,t){e.writeAttributeString("mediatype",t.options.mediaType)}}),y=r.extend(b,{typeName:gettext("Image Capture"),icon:"fa fa-camera",mediaType:"image/*",spec:{imageSize:{lstring:gettext("Image Size"),visibility:"visible",widget:i.dropdown,enabled:function(e){return e.options.resize_enabled},defaultOptions:[{text:gettext("Small"),value:"250"},{text:gettext("Medium"),value:"500"},{text:gettext("Large"),value:"1000"},{text:gettext("Original"),value:""}],help:gettext("This will resize the image before sending the form. Use this option to send smaller images in areas of poor connectivity.<ul><li>Small - 0.1 megapixels</li><li>Medium - 0.2 megapixels</li><li>Large - 0.5 megapixels</li></ul>")}},writeCustomXML:function(e,t){b.writeCustomXML(e,t),"Image"===t.__className&&t.p.imageSize&&e.writeAttributeString("jr:imageDimensionScaledMax",t.p.imageSize+"px")},init:function(e,t){b.init(e,t),""!==e.p.imageSize&&(e.p.imageSize=e.p.imageSize||250)}}),D=r.extend(b,{typeName:gettext("Micro-Image"),isTypeChangeable:!1,icon:"fa fa-camera",tagName:"input",mediaType:"image/*",init:function(e,t){b.init(e,t),e.p.appearance="micro-image"}}),O=r.extend(b,{typeName:gettext("Video Capture"),icon:"fa fa-video-camera",mediaType:"video/*"}),R=r.extend(y,{typeName:gettext("Signature Capture"),icon:"fcc fcc-fd-signature",spec:{imageSize:{visibility:"hidden"}},init:function(e,t){y.init(e,t),e.p.appearance="signature"},changeTypeTransform:function(e){e.p.appearance=void 0}}),_=r.extend(b,{typeName:gettext("Document Upload"),icon:"fa fa-file",mediaType:"application/*,text/*"}),x=r.extend(g,{typeName:gettext("GPS"),dataType:"geopoint",icon:"fa-solid fa-location-dot",init:function(e,t){}}),w=r.extend(g,{typeName:gettext("Barcode Scan"),dataType:"barcode",icon:"fa fa-barcode",init:function(e,t){}}),k=r.extend(g,{typeName:gettext("Date"),dataType:"xsd:date",icon:"fa-solid fa-calendar-days",init:function(e,t){}}),K=r.extend(g,{typeName:gettext("Date and Time"),dataType:"xsd:dateTime",icon:"fcc fcc-fd-datetime",init:function(e,t){}}),N=r.extend(g,{typeName:gettext("Time"),dataType:"xsd:time",icon:"fa-regular fa-clock",init:function(e,t){}}),S=r.extend(I,{typeName:gettext("Long"),dataType:"xsd:long",icon:"fcc fcc-fd-long",init:function(e,t){}}),A=r.extend(I,{typeName:gettext("Decimal"),dataType:"xsd:double",icon:"fcc fcc-fd-decimal",init:function(e,t){}}),M=r.extend(g,{isControlOnly:!0,typeName:gettext("Choice"),tagName:"item",icon:"fcc fcc-fd-single-circle",isTypeChangeable:!1,canOutputValue:!1,getIcon:function(e){return"Select"===e.parentMug.__className?"fcc fcc-fd-single-circle":"fcc fcc-fd-multi-box"},writeControlHint:!1,writeControlHelp:!1,writeControlAlert:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){var n=t.p.nodeID;n&&(e.writeStartElement("value"),e.writeString(n),e.writeEndElement())},init:function(e,t){},spec:{nodeID:{lstring:gettext("Choice Value"),visibility:"visible",presence:"required",widget:i.identifier,setter:null,validationFunc:function(e){if(/\s/.test(e.p.nodeID))return gettext("Whitespace in values is not allowed.");if(e.parentMug){var n=e.form.getChildren(e.parentMug);if(t.any(n,(function(t){return t!==e&&t.p.nodeID===e.p.nodeID})))return gettext("This choice value has been used in the same question")}return"pass"},serialize:function(e,t,n,i){var a=n.parentMug.absolutePathNoRoot;i.id=a+"/"+e},deserialize:function(e){return e.id&&e.id.slice(e.id.lastIndexOf("/")+1)}},labelItext:{presence:"required"},conflictedNodeId:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},helpItext:{presence:"notallowed"},defaultValue:{presence:"optional",visibility:"hidden"}}}),P=r.extend(g,{typeName:gettext("Label"),tagName:"trigger",icon:"fa fa-tag",init:function(e,t){e.p.appearance="minimal"},changeTypeTransform:function(e){e.p.appearance=void 0},spec:{dataValue:{presence:"optional"},defaultValue:{presence:"optional",visibility:"hidden"},requiredAttr:{deleteOnCopy:!0,visibility:function(e){return"minimal"!==e.p.appearance}}}}),L=r.extend(g,{validChildTypes:["Choice"],controlNodeChildren:function(e){return e.children().not("label, value, hint, help, alert")},typeChangeError:function(e,t){return e.form.getChildren(e).length>0&&!t.match(/^M?Select$/)?gettext("Cannot change a Multiple/Single Choice question to a non-Choice question if it has Choices. Please remove all Choices and try again."):""},canAddChoices:!0,spec:{appearance:{deleteOnCopy:!1}},dataType:""}),F=r.extend(L,{typeName:gettext("Checkbox"),tagName:"select",icon:"fcc fcc-fd-multi-select",defaultOperator:"selected"}),B=r.extend(L,{typeName:gettext("Multiple Choice"),tagName:"select1",icon:"fcc fcc-fd-single-select",defaultOperator:null}),$=r.extend(g,{typeName:gettext("Group"),tagName:"group",icon:"fa fa-folder-open",isSpecialGroup:!0,isNestableGroup:!0,isTypeChangeable:!1,possibleDataParent:!0,canOutputValue:!1,controlNodeChildren:function(e){return e.children().not("label, value, hint, help, alert")},init:function(e,t){},spec:{hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},helpItext:{presence:"notallowed"},calculateAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},constraintMsgAttr:{presence:"notallowed"},dataValue:{presence:"notallowed"},requiredAttr:{presence:"notallowed"},defaultValue:{presence:"optional",visibility:"hidden"}}}),q=r.extend($,{typeName:gettext("Question List"),icon:"fa fa-reorder",init:function(e,t){$.init(e,t),e.p.appearance="field-list"},changeTypeTransform:function(e){e.p.appearance=void 0}}),H=r.extend($,{typeName:gettext("Repeat Group"),icon:"fa fa-retweet",possibleDataParent:"limited",controlNodeChildren:function(e){return e.children("repeat").children().not("jr\\:addEmptyCaption, jr\\:addCaption")},getExtraDataAttributes:function(e){return{"jr:template":""}},controlChildFilter:function(e,i){var a=i.hashtagPath,o=i.p.repeat_count,s=t.object(t.filter(t.map(i.p.rawRepeatAttributes,(function(e,t){return"jr:noaddremove"!==t.toLowerCase()?[t,e]:null})),t.identity));return[new n.Node(e,{getNodeID:function(){},getAppearanceAttribute:function(){},form:i.form,p:{rawControlAttributes:s,addEmptyCaptionItext:i.p.addEmptyCaptionItext,addCaptionItext:i.p.addCaptionItext},options:{tagName:"repeat",writeRepeatItexts:i.options.customRepeatButtonText,writeControlLabel:!1,writeControlHint:!1,writeControlHelp:!1,writeControlAlert:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){o&&(r.writeHashtags(e,"jr:count",String(o)),e.writeAttributeString("jr:noAddRemove","true()")),r.writeHashtags(e,"nodeset",a,t)}}})]},writeControlRefAttr:null,init:function(e,t){e.p.repeat_count=null},spec:{repeat_count:{lstring:gettext("Repeat Count"),visibility:"visible_if_present",presence:"optional",widget:i.droppableText,validationFunc:function(t){return!e.trim(t.p.repeat_count)&&function e(t){if(!t)return!1;var n=t.parentMug;return!(!n||"FieldList"!==n.__className)||e(n)}(t)?gettext("Repeat Count is required."):"pass"}},rawRepeatAttributes:{presence:"optional",lstring:gettext("Extra Repeat Attributes")}}});function V(n,i,a){var o=this,s=a.features.group_in_field_list;y.resize_enabled=a.features.image_resize,this.auxiliaryTypes=i.auxiliary,this.normalTypes=i.normal,this.baseSpec=n,l.setBaseSpec(r.extend.apply(null,[n.databind,n.control].concat(t.filter(t.pluck(r.extend(this.normalTypes,this.auxiliaryTypes),"spec"),t.identity)))),this.allTypes=e.extend({},this.auxiliaryTypes,this.normalTypes);var d=t.keys(this.allTypes),c=t.without.apply(t,[d].concat(t.keys(this.auxiliaryTypes)));s||(this.normalTypes.FieldList.validChildTypes=t.without.apply(t,[c].concat(t.without(t.map(this.allTypes,(function(e,t){return e.isNestableGroup?t:null})),null)))),t.each(this.auxiliaryTypes,(function(e){e.validChildTypes=[]})),t.each(this.normalTypes,(function(e,t){var n;e.validChildTypes||(n=e.isNestableGroup?c:[],e.validChildTypes=n)})),t.each(this.allTypes,(function(e,t){e.__className=t,o[t]=e}))}return V.prototype={make:function(e,t,n){var i=this.allTypes[e],a=n?n.p.getAttrs():null;return new o(i,t,this.baseSpec,a)},changeType:function(e,n){var i=e.form,a=i.getChildren(e),r=this.allTypes[e.__className].typeChangeError(e,n);if(r)throw new Error(r);this.allTypes[e.__className].changeTypeTransform(e),e.setOptionsAndProperties(this.allTypes[n]),-1!==n.indexOf("Select")&&t.each(a,(function(e){i.fire({type:"parent-question-type-change",childMug:e})})),e.validate(),i.fire({type:"question-type-change",qType:n,mug:e}),i.fireChange(e)}},{defaultOptions:g,baseMugTypes:{normal:{Audio:b,Barcode:w,DataBindOnly:m,Date:k,DateTime:K,Document:_,Double:A,FieldList:q,Geopoint:x,Group:$,Image:y,MicroImage:D,Int:I,Long:S,MSelect:F,PhoneNumber:T,ReadOnly:v,Repeat:H,Secret:C,Select:B,Signature:R,Text:E,Time:N,Trigger:P,Video:O},auxiliary:{Choice:M}},MugTypesManager:V,MugMessages:s,WARNING:o.WARNING,ERROR:o.ERROR,baseSpecs:p,deserializeXPath:c,serializeXPath:d,updateInstances:u}}.apply(t,i))||(e.exports=a)},7417:(e,t,n)=>{var i,a;i=[n(5392),n(8094),n(7229),n(561),n(3946)],void 0===(a=function(e,t,n,i,a){function r(e){return a.chain(i(e)[0].attributes).map((function(e){return[e.nodeName,e.nodeValue]})).object().value()}function o(e){var t=function(t,n){return t?n.changeMugType(t,e):t=n.mugTypes.make(e,n),t};return t.type=e,t}function s(e){var t=function(t,n){return n.mugTypes.make(e,n)};return t.type=e,t.ignoreDataNode=!0,t}function l(e,t){if(!e)return t;var n=e.toLowerCase().replace(/\s/g,"");return"false()"!==n&&(!!n||t)}function d(e,t,n,i){if(!e)return null;var a,r,o=u(t,e,"ref",i),s=t.tree.getRootNode().getID();if(o||(o=u(t,e,"nodeset",i)),o||(a=u(t,e,"bind",i))&&(r=c(a,s,t),t.getMugByPath(r)?o=r:t.parseWarnings.push(gettext("Ambiguous bind:")+" "+a)),(o=o||a||null)&&"/"!==o[0]&&"#"!==o[0]&&"`"!==o[0])if(n){var l=n.hashtagPath;l&&(o=l+"/"+o)}else o=t.getBasePath()+o;return o}function c(e,t,n){var i;try{i=n.xpath.parse(e)}catch(t){return e}return i instanceof n.xpath.models.XPathPathExpr||i instanceof n.xpath.models.HashtagExpr?(i.initial_context===n.xpath.models.XPathInitialContextEnum.RELATIVE&&(i.steps.splice(0,0,n.xpath.models.XPathStep({axis:"child",test:t})),i.initial_context=n.xpath.models.XPathInitialContextEnum.ROOT),i.toHashtag()):e}function u(e,t,n,i){var a=(i?t.xmlAttr:t.popAttr).bind(t),r=a("vellum:"+n.replace(/:/g,"__")),o=a(n);return e.inferHashtagMeanings(r,o),e.normalizeHashtag(e.richText&&r?r:o)}return{init:function(e){var t,n,i,a,l,c=e.data.core;c.controlNodeAdaptorMap=(t={string:o("Text"),long:o("Long"),int:o("Int"),double:o("Double"),date:o("Date"),datetime:o("DateTime"),time:o("Time"),geopoint:o("Geopoint"),barcode:o("Barcode"),intent:o("AndroidIntent")},n=o("Select"),i=s("Choice"),a=o("Trigger"),l=function(e){return function(t,n){return(t=a(t,n)).p.appearance=e,t}},{secret:function(){return o("Secret")},select:function(){return o("MSelect")},select1:function(){return n},trigger:function(e,t){return l(t)},input:function(e,n){return"true()"===e.popAttr("readonly")?l(n):function(e,i){var a=e&&e.p.rawBindAttributes&&e.p.rawBindAttributes.type;if(a){if(a=(a=a.replace("xsd:","")).toLowerCase(),t.hasOwnProperty(a))return delete e.p.rawBindAttributes.type,"string"===a&&"numeric"===n?o("PhoneNumber")(e,i):t[a](e,i);if("micro-image"===n&&i.vellum.opts().features.case_micro_image)return o("MicroImage")(e,i)}return t.string(e,i)}},item:function(e){var t=function(t,n){return(t=i(t,n)).p.nodeID=e.children("value").text(),t};return t.type=i.type,t.ignoreDataNode=!0,t},group:function(e,t,n,i){var a;if("field-list"===t)a="FieldList";else{var s=e.children("repeat");if(1===s.length){var l=function(e,t){return(e=o("Repeat")(e,t)).p.repeat_count=u(t,s,"jr:count")||null,e.p.rawRepeatAttributes=r(s),e};return l.repeat=s,l.path=d(s,n,i),l.type="Repeat",l}a="Group"}return o(a)},upload:function(e,t,n,i){var a,r=e.popAttr("mediatype");if(!r)throw"Unable to parse binary question type. The question has no MediaType attribute assigned to it!";if("video/*"===(r=r.toLowerCase()))a="Video";else if("image/*"===r)a="signature"===t?"Signature":"Image";else if("audio/*"===r)a="Audio";else{if("application/*,text/*"!==r)throw"Unrecognized upload question type for Element: "+d(e,n,i);a="Document"}return o(a)}}),e.updateControlNodeAdaptorMap(c.controlNodeAdaptorMap)},parseXForm:function(n,s,l,f){var h=e.Form,p=e.InstanceMetadata,g=new h(s,l,s.mugTypes);if(g.parseErrors=[],g.parseWarnings=f,g.isLoadingXForm=!0,!n)return g.isLoadingXForm=!1,g;var m=t.parseXML(n),v=m.find("h\\:xdoc"),E=m.find(":root > h\\:head, :root > head"),T=E.children("h\\:title, title"),C=E.find("bind"),I=function(e){for(var t=e.find("instance"),n=!1,a=[],r=0;r<t.length;r++)if(i(t[r]).xmlAttr("id"))a.push(t[r]);else{if(n)throw"multiple unnamed instance elements found in the form! this is not allowed. please add id's to all but 1 instance.";a.splice(0,0,t[r]),n=!0}return a}(m),b=i(I[0]).children(),y=E.find("> model > setvalue");if(m.find("parsererror").length>0)throw gettext("PARSE ERROR!:")+m.find("parsererror").find("div").html();v.length||(v=E.parent());var D,O=v.xmlAttr("vellum:ignore");if(O=O?O.split(" "):[],a.contains(O,"richText")&&(g.richText=!1),a.contains(O,"markdown")&&(g.noMarkdown=!0),g.instanceMetadata=I.map((function(e){return p(r(e),i(e).children())})),g.updateKnownInstances(),g.richText&&!g.vellum.datasources.isReady()&&function(e,t,n){try{t=JSON.parse(i.trim(t.text()))}catch(e){t={}}try{n=JSON.parse(i.trim(n.text())).prefixes||{}}catch(e){n={}}a.isEmpty(n)||(e.hashtagTransformations=a.object(a.map(n,(function(e,t){return[t,function(t){return e+t}]})))),a.each(t,(function(t,i){e.initHashtag(i,function(e,t){if(!t){var i=/(#.+\/)([^\/]+)/.exec(e);if(i&&n.hasOwnProperty(i[1]))return n[i[1]]+i[2]}return t}(i,t))})),e.shouldInferHashtags=a.some(e.hashtagMap,(function(e){return null===e}))}(g,E.children("vellum\\:hashtags, hashtags"),E.children("vellum\\:hashtagTransforms, hashtagTransforms")),0===b.length&&g.parseErrors.push(gettext("No Data block was found in the form. Please check that your form is valid!")),function(e,n,a){var r,o=i(n),s=e.tree;r=function(t){var n=e.vellum.parseDataElement(e,this,t),a=n.options.parseDataNode(n,i(this),t);s.insertMug(n,"into",t),e._fixMugState(n),a.each((function(){r.call(this,n)}))},o[0]?e.setFormID(o[0].tagName):e.setFormID("data"),o.children().each((function(){r.call(this,null)})),e.formUuid=o.xmlAttr("xmlns"),e.formJRM=o.xmlAttr("xmlns:jrm"),e.formUIVersion=o.xmlAttr("uiVersion"),e.formVersion=o.xmlAttr("version");var l=e.vellum.opts().core.formName||o.xmlAttr("name")||a;l?e.formName=l:e.parseWarnings.push(gettext("Form does not have a Name! The default form name will be used")),e.formUuid&&"undefined"!==e.formUuid||(e.formUuid="http://openrosa.org/formdesigner/"+t.generate_xmlns_uuid()),e.formJRM||e.parseWarnings.push(gettext("Form JRM namespace attribute was not found in data block. One will be added automatically")),e.formUIVersion||e.parseWarnings.push(gettext("Form does not have a UIVersion attribute, one will be generated automatically")),e.formVersion||e.parseWarnings.push(gettext("Form does not have a Version attribute (in the data block), one will be added automatically"))}(g,b[0],T.length?T.text():""),function(e,t){var n=e.tree.getRootNode().getID();t.each((function(){var t=i(this),a=u(e,t,"nodeset")||u(e,t,"ref");e.vellum.parseBindElement(e,t,c(a,n,e))}))}(g,C),function(e,t){var n=e.tree.getRootNode().getID();t.each((function(){var t=i(this);e.vellum.parseSetValue(e,t,c(u(e,t,"ref",!0),n,e))}))}(g,y),function(e,t){function n(e){return e.value.ufid}function s(t,l){for(var c=function(e){var t=0,n=e.length;return function(){return t<n?e[t++]:null}}(t.children),u=function(t,n){var l=0,c=t.length;return function(){if(l>=c)return null;var u=i(t[l++]),f=function(e,t,n){var i,s=t[0].nodeName.toLowerCase(),l=t.popAttr("appearance"),c=null,u=e.vellum.getControlNodeAdaptorFactory(s);if(u&&(i=u(t,l,e,n)),i||(i=function(e){var t=function(t,n){return t=o("ReadOnly")(t,n),1===e.length&&e[0].poppedAttributes&&a.each(e[0].poppedAttributes,(function(t,n){e.xmlAttr(n,t)})),t.p.rawControlXML=e,t};return t.skipPopulate=!0,t}(t)),!i.ignoreDataNode){var f=i.path;f||(f=d(t,e,n)),c=e.getMugByPath(f)}c=i(c,e);var h=e.tree.getNodeFromMug(c);if(h){if(h.parent.value!==n){var p=h.parent,g=h.parent.value;c.p.dataParent=p.isRootNode?"#form":g.hashtagPath,h=e.tree.insertMug(c,"into",n)}}else c.options.isControlOnly=!0,h=e.tree.insertMug(c,"into",n),e.mugMap[c.ufid]=c;return l&&(c.p.appearance=l),i.skipPopulate||(e.vellum.populateControlMug(c,t),c.p.rawControlAttributes=r(t)),h}(e,u,n),h=f.value;return h.options.controlNodeChildren&&s(f,h.options.controlNodeChildren(u)),f}}(l,t.value),f=c(),h=u(),p=[],g={},m=!1;h;)f?(f===h&&(p.push(h),h=u()),g[n(f)]=null,f=c()):(m=m||g.hasOwnProperty(n(h)),p.push(h),h=u());m&&(t.children=a.union(p,t.children))}s(e.tree.getRootNode(),t)}(g,m.find(":root > h\\:body, :root > body").children()),g.parseErrors)for(D=0;D<g.parseErrors.length;D++)g.updateError({level:"error",message:g.parseErrors[D]});if(g.parseWarnings)for(D=0;D<g.parseWarnings.length;D++)g.updateError({level:"parse-warning",message:g.parseWarnings[D]});return g.isLoadingXForm=!1,g},parseDataElement:function(e,t,n,a){var o=i(t),s=t.nodeName,l=o.children().length?null:o.text(),d=o.popAttr("xmlns")||null,c=o.popAttr("vellum:comment")||null;(a=a||o.xmlAttr("vellum:role"))&&e.mugTypes.allTypes.hasOwnProperty(a)&&e.mugTypes.allTypes[a].supportsDataNodeRole?o.popAttr("vellum:role"):a="DataBindOnly";var u=e.mugTypes.make(a,e);return u.p.nodeID=s,u.__originalNodeID=s,u.p.dataValue=l||void 0,d&&d!==e.formUuid&&(u.p.xmlnsAttr=d),c&&(u.p.comment=c),u.p.rawDataAttributes=r(t),u},parseBindElement:function(e,n,i){var a=e.getMugByPath(i);if(a){var o,s,d=n.popAttr("required"),c={relevantAttr:u(e,n,"relevant"),calculateAttr:u(e,n,"calculate"),constraintAttr:u(e,n,"constraint"),constraintMsgAttr:(o=n,s="constraintMsg",o.popAttr("jr:"+s)||o.popAttr("jr\\:"+s)||null),requiredAttr:l(d),requiredCondition:u(e,n,"requiredCondition")||("true()"!==d&&"false()"!==d?d:void 0)},f=c.rawBindAttributes=r(n);f.type&&"xsd:integer"===f.type.toLowerCase()&&(f.type="xsd:int"),a.p.setAttrs(c)}else e.parseWarnings.push(t.format(gettext("Bind Node [{path}] found but has no associated Data node. This bind node will be discarded!"),{path:i}))},parseSetValue:function(e,t,n){var i=e.getMugByPath(n),a=t.xmlAttr("event"),r=u(e,t,"ref",!0),o=u(e,t,"value",!0);!i||"xforms-ready"!==a&&"jr-insert"!==a?e.addSetValue(a,r,o):i.p.defaultValue=o},populateControlMug:function(e,t){var i=t.children("label"),a=t.children("hint"),r=t.popAttr("jr:imageDimensionScaledMax");if(i.length&&"notallowed"!==e.getPresence("label")){var o=n.humanize(i);o&&(e.p.label=o)}a.length&&"notallowed"!==e.getPresence("hintLabel")&&(e.p.hintLabel=n.humanize(a)),"Image"===e.__className&&(e.p.imageSize=r?parseInt(r):"")},getAttributes:r,getPathFromControlElement:d,makeControlOnlyMugAdaptor:s,makeMugAdaptor:o}}.apply(t,i))||(e.exports=a)},4459:(e,t,n)=>{var i,a;window.CKEDITOR_BASEPATH||(window.CKEDITOR_BASEPATH="src/../lib/ckeditor/"),i=[n,n(3946),n(561),n(8654),n(6990),n(9832),n(8916),n(4854),n(8094),n(7229),n(3578),n(612),n(5022)],void 0===(a=function(e,t,i,a,r,o,s,l,d,c,u,f){var h=/^#form\//,p="#invalid/xpath ",g={template:'<span class="label label-datanode label-datanode-internal"><i class="fa fa-question-circle">&nbsp;</i>example widget, not used</span>',upcast:function(e){return"span"===e.name&&e.hasClass("label-datanode")},init:function(){var e=i(this.element.$),t=e.innerWidth(),n=e.outerHeight(),a=this.dragHandlerContainer,r=this.editor;if(a.setStyles({width:t+"px",height:n+"px",left:"0px"}),r.commands.createPopover){var o=this;r.on("change",(function(e){r.widgets.checkWidgets({initOnlyNew:1})})),"ready"===r.status?r.execCommand("createPopover",o):r.on("instanceReady",(function(){r.execCommand("createPopover",o)}))}}};function m(e,t){if(v.call(this,e),t){this.sourceEditor=t;var n=t.getSelectedHtml(1);if(n){var i=t._vellum_fromRichText(n);_(i)&&(i=s.transform(i.slice(15),(function(e){return e}))),this.setData("text/plain",i)}}}f.plugins.add("bubbles",{requires:"widget",init:function(e){e.widgets.add("bubbles",g)}}),f.config.allowedContent=!0,f.config.customConfig="",f.config.title=!1,f.config.extraPlugins="bubbles",f.config.disableNativeSpellChecker=!1,f.config.toolbar=[];var v=f.plugins.clipboard.dataTransfer;function E(e,t,n){function i(e){var t=0,n=e.getChildren(),a=n.count(),r=null;return function e(){var o;if(r){if(null!==(o=r()))return o;r=null}if(t>=a)return null;if(o=n.getItem(t),t++,o.type===f.NODE_ELEMENT){var s=o.getName().toLowerCase();if("p"===s)return r=i(o),e();if("span"===s||"br"===s)return{node:o,length:1,isText:!1};throw new Error("not implemented: "+s)}if(o.type===f.NODE_TEXT)return{node:o,length:o.getText().length,isText:!0};throw new Error("unhandled element type: "+o.type)}}function a(e,t){for(var n=e,i=t();i;){if(i.length>=n)return{node:i.node,offset:n,isText:i.isText};n-=i.length,i=t()}throw new Error("index is larger than content: "+e)}e.focus();var r=e.getSelection(),o=i(r.root),s=a(t,o),l=r.getRanges()[0];s.isText?l.setStart(s.node,s.offset):l.setStartAfter(s.node),n?(s=a(t+n,o=i(r.root))).isText?l.setEnd(s.node,s.offset):l.setEndAfter(s.node):l.collapse(!0),r.selectRanges([l])}m.prototype=v.prototype,f.plugins.clipboard.dataTransfer=m;var T={dateFormat:{serialize:function(e,n){return t.template("format-date(date(<%=xpath%>), '<%=dateFormat%>')")({xpath:e,dateFormat:n.dateFormat})}},value:{serialize:function(e){return t.template('&lt;output value="<%=xpath%>" /&gt;')({xpath:e})}}},C=["dateFormat","value"];function I(e){var n=e.value;return t.each(C,(function(t){e[t]&&(n=T[t].serialize(n,e))})),n}function b(e,t){var n,a,r,o,s,d,c=function(e,t){if(!h.test(e)){if(t.isValidHashtag(e))return{classes:["label-datanode-external","fcc fcc-fd-case-property"]};if(t.hasValidHashtagPrefix(t.normalizeHashtag(e)))return{classes:["label-datanode-external-unknown","fa-solid fa-triangle-exclamation"]}}var n=t.getIconByPath(e);return n?{classes:["label-datanode-internal",n]}:{classes:["label-datanode-unknown","fcc fcc-help"]}}(t,e),u=c.classes[0],f=c.classes[1],p=(n=t,a=e.xpath,s=(o=new l.LogicExpression(n,a)).getTopLevelPaths(),d=o.getHashtags(),s.length?(r=s[0].steps)[r.length-1].name:(r=d[0].toHashtag().split("/"))[r.length-1]),g=i("<i>").addClass(f).html("&nbsp;");return i("<span>").addClass("label label-datanode "+u).attr("data-value",t).append(g).append(p)}function y(e,n){var a=k(i(n)),r=e.normalizeHashtag(a.value,!0),o=t.omit(a,"value"),s=r&&(h.test(r)||e.hasValidHashtagPrefix(r)),l=/\s/.test(r);return!s||s&&l?i("<span>").text(c.normalize(n)).html():i("<div>").append(b(e,r).attr(o)).html()}function D(e,t,n){var i,a,r=c.xhtml(e),o={};return i=n?function(){var e=d.get_guid();return o[e]=y(t,this),"{"+e+"}"}:function(){return y(t,this)},r.find("output").replaceWith(i),a=r.html(),n&&(a=O(a,o)),a}function O(e,t){return(e=i("<div />").text(c.humanize(e)).html()).replace(/{(.+?)}/g,(function(e,n){return t.hasOwnProperty(n)?i("<div>").append(t[n]).html():e}))}function R(e,t){var n;return _(e)?(e=e.slice(15),n=s.transform):n=t.transformHashtags,n(e,(function(e){return b(t,e).prop("outerHTML")}),!0)}function _(e){return e.startsWith(p)}function x(e,t,n){return e?function(e){return"<p>"+(e=e.replace(/\n/g,"</p><p>").replace(/  /g," &nbsp;"))+"</p>"}(((n=n||{}).isExpression?R:D)(e,t)):""}function w(e,t,n){return function(e,t,n){var a,r,o,l=c.xhtml(e),u={},f=l.find(".label-datanode");if(!f.length)return l.text();if(a=n?function(){var e=d.get_guid();return u[e]=i(this).data("value"),"{"+e+"}"}:function(){return I(i(this).data())},f.replaceWith(a),r=l.text(),n){o=r.replace(/{(.+?)}([\w.\-]?)/g,(function(e,t,n){return u.hasOwnProperty(t)?u[t]+(n?" "+n:""):e}));try{t.xpath.parse(o)}catch(e){o=p+s.escapeDelimiters(r).replace(/{(.+?)}/g,(function(e,t){return u.hasOwnProperty(t)?s.delimit(u[t]):e}))}r=o}return r}(function(e){return e.replace(/<p>&nbsp;<\/p>/gi,"\n").replace(/<p>/gi,"").replace(/<\/p>/gi,"\n").replace(/<br \/>/gi,"\n").replace(/(&nbsp;|\xa0|\u2005)/gi," ").replace(/<span\b[^>]*?id="?cke_bm_\d+\w"?\b[^>]*?>.*?<\/span>/gi,"").replace(/<span\b[^>]*?data-cke-copybin-(start|end)[^<]*?<\/span>/gi,"").replace(/\u200b+/gi," ").replace(/\n$/,"")}(e),t,n)}function k(e){var t=e.xmlAttr("vellum:value")||e.xmlAttr("value")||e.xmlAttr("ref"),n=/^format-date\(date\(([^)]+)\),\s*'([^']+)'\)$/.exec(t);return n?{value:n[1],"data-date-format":n[2]}:{value:t}}var K={Y:"yyyy",y:"yy",m:"mm",n:"m",b:"mmm",d:"dd",e:"d",H:"HH",h:"H",M:"MM",S:"SS",3:"msec",a:"ddd"};function N(e){return e?e.replace(/(%[YymnbdeHhMS3a])/g,(function(e,t){return K.hasOwnProperty(t[1])?K[t[1]]:t})):gettext("no formatting")}function S(e,t){var s=i(t.element.$),l=t.dragHandlerContainer,f=s.data("value"),p=(0,n(705).util.getWidget)(s);if(p){var g=h.test(f),m=s.contents().filter((function(){return 3===this.nodeType}))[0].nodeValue,v=p.mug.form.normalizeHashtag(f),E=d.escape(v),T=p.mug.form.getMugByPath(f),C=T&&T.p.labelItext?T.p.labelItext.get():"",I=T&&0===T.__className.indexOf("Date"),b=i(l.$).children("img"),y=d.get_guid();T||(C=p.mug.form.vellum.datasources.getNode(v,{}).description||""),(C=c.xhtml(C)).find("output").replaceWith((function(){var e=k(i(this)).value;return p.mug.form.normalizeHashtag(e)})),C=c.normalize(C),b.removeAttr("title"),b.popover({trigger:"hover",container:"body",placement:"bottom",title:function(){var e=E,t=s.attr("data-date-format");return(I||t)&&(e+=a({guid:y,text:d.escape(N(t))})),"<h3>"+d.escape(m)+'</h3><div class="text-muted">'+e+"</div>"},html:!0,sanitize:!1,content:r({text:C,ufid:T?T.ufid:""}),template:'<div contenteditable="false" class="popover rich-text-popover"><div class="popover-inner"><div class="popover-title"></div>'+(T||C?'<div class="popover-content"><p></p></div>':"")+"</div></div>",delay:{show:350,hide:200}}).on("shown.bs.popover",(function(){var t=g?"form":"case";if(u.fbUsage("Hovered over easy "+t+" reference"),u.workflow("Hovered over easy reference"),I||s.attr("data-date-format")){var n=i(this).offset(),a=n.left,r=n.top+i(this).height();i("#"+y).click((function(){return b.popover("hide"),o.showMenu(a,r,(function(t){s.attr("data-date-format",t),e.fire("saveSnapshot")}),!0),!1}))}})),t.on("destroy",(function(e){try{b.popover("destroy")}catch(e){}}))}}return{applyFormats:I,bubbleOutputs:D,sanitizeInput:function(e){if(!/<(?!output| )/g.test(e))return e;var t=c.xhtml(e),n={};return t.find("output").replaceWith((function(){var e=d.get_guid();return n[e]=this,"{"+e+"}"})),O(t.html(),n)},editor:function(e,n,a){function r(e){d.insertHtml(e+" ")}var o=e.data("ckwrapper");if(o)return o;if(1===arguments.length)throw new Error("editor not initialized: "+i("<div>").append(e).html());if(1!==e.length)throw new Error("input should reference exactly one element, got "+e.length);(a=a||{}).createPopover||n.vellum.opts().features.disable_popovers||(a.createPopover=S);var s={},l=s,d=e.ckeditor({contentsLangDirection:a.rtl?"rtl":"ltr",disableNativeSpellChecker:a.disableNativeSpellChecker,placeholder:" "}).editor;return o={getValue:function(t){if(!t){if(l!==s)return l;var i;try{i=d.getData()}catch(e){if("IndexSizeError"!==e.name)throw e;o.select(0),i=d.getData()}return w(i,n,a.isExpression)}e.promise.then((function(){t(w(d.getData()))}))},setValue:function(e,t){return l=e,e=x(e,n,a),d.setData(e,{callback:function(){l=s,t&&t()},noSnapshot:!0}),o},insertExpression:function(e){if(a.isExpression)r(R(e,n));else{var t=b(n,e);r(i("<p>").append(t).html())}return o},insertOutput:function(e){if(a.isExpression)throw new Error("cannot insert output into expression editor");return r(D(e,n)),o},change:function(){return d.fire("saveSnapshot"),o},focus:function(){"ready"===d.status?d.focus():(d.removeListener("instanceReady",d.focus),d.on("instanceReady",d.focus))},select:function(e,t){return E.call(null,d,e,t),o},on:function(){var e=Array.prototype.slice.call(arguments);return d.on.apply(d,e),o},destroy:function(){null!==e&&(e.removeData("ckwrapper"),e.promise.then((function(){d.destroy(),d=null})),e=null)}},d.on("focus",(function(e){d.setReadOnly(!1);var t=e.editor.editable();t.hasClass("placeholder")&&(t.removeClass("placeholder"),t.setHtml(""));var n=d.getSelection().getRanges()[0];if(n){var i=n.startContainer.getAscendant({p:2},!0);if(i){var a=new f.dom.range(n.document);a.moveToPosition(i,f.POSITION_BEFORE_END),a.select()}}})),d._vellum_fromRichText=function(e){return w(e,n,a.isExpression)},d.on("paste",(function(e){var t=e.data;if(t.dataTransfer&&t.dataTransfer.getData("Text")){var n=t.dataTransfer.getData("Text");t.type="html",t.dataValue=i("<div />").text(n).html().replace(/\n/g,"<br />").replace(/  /g," &nbsp;")}else t.dataValue=t.dataValue.replace(/<style type="text\/css">.*?<\/style>/g,"")}),null,null,2),t.isFunction(a.createPopover)&&d.addCommand("createPopover",{exec:a.createPopover,editorFocus:!1,canUndo:!1}),e.data("ckwrapper",o),o},fromRichText:w,toRichText:x,isInvalid:_,unescapeXPath:function(e,t){return _(e)&&(e=s.transform(e.slice(15),t.normalizeXPath.bind(t))),e},unescapeHashtags:function(e,t){return _(e)&&(e=s.transform(e.slice(15),t.normalizeHashtag.bind(t))),e}}}.apply(t,i))||(e.exports=a)},8610:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(4078),n(7026),n(8094),n(939),n(705),n(1),n(4206),n(7501),n(3835),n(1877)],void 0===(a=function(e,t,n,i,a,r,o,s,l,d,c){function u(e){return!!e&&e.p.useCreate}function f(e){return!!e&&e.p.useClose}function h(e){return!!e&&e.p.useUpdate}function p(e){return!!e&&e.p.useIndex}function g(e){return!!e&&e.p.useAttachment}var m=function(n,i){var a=o.normal(n,i),s=i.id,l=i.template;return i.richText=!1,a.input=e('<div class="control-row" />').attr("name",s),a.getControl=function(){return a.input},a.refreshControl=function(t){t=t||a.getValue(),a.input.html(c({internal_template:l,props:t})),a.input.find("input").on("change keyup",(function(){a.handleChange()})),a.input.find(".fd-add-property").click(a.addProperty),a.input.find(".fd-remove-property").click(a.removeProperty),a.input.find("input").addClass("jstree-drop"),a.input.find("input").each((function(){r.autocomplete(e(this),n)}))},a.setValue=function(e){e=t.isUndefined(e)?{}:e,a.refreshControl(e)},a.updateValue=function(){""in a.getValue()||(a.input.find(".btn").removeClass("hide"),a.input.find(".fd-remove-property").removeClass("hide")),a.save()},a.removeProperty=function(t){e(this).parent().parent().parent().remove(),a.refreshControl(),a.save(),t.preventDefault()},a.addProperty=function(e){a.refreshControl(),e.preventDefault()},a},v=function(n,i){i.template=s;var a=m(n,i);return a.getValue=function(){var n={};return t.each(a.input.find(".fd-update-property"),(function(t){var i=e(t);n[i.find(".fd-update-property-name").val()]={calculate:i.find(".fd-update-property-source").val(),relevant:i.find(".fd-update-property-relevant").val()}})),n},a},E=/^[a-z0-9_-]+$/i,T={typeName:"Save to Case",isTypeChangeable:!1,isDataOnly:!0,supportsDataNodeRole:!0,icon:"fa fa-save",init:function(e,t){e.p.date_modified=e.p.date_modified||"/data/meta/timeEnd",e.p.user_id=e.p.user_id||"instance('commcaresession')/session/context/userid"},spec:{xmlnsAttr:{presence:"optional"},date_modified:{lstring:gettext("Date Modified"),visibility:"visible",presence:"required",widget:o.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath},user_id:{lstring:gettext("User ID"),visibility:"visible",presence:"optional",widget:o.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath},case_type:{lstring:gettext("Case Type"),visibility:"visible",presence:"optional",widget:o.text},case_id:{lstring:gettext("Case ID"),visibility:"visible",presence:"required",widget:o.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath},useCreate:{lstring:gettext("Create Case"),visibility:"visible",presence:"optional",widget:o.checkbox},createProperty:{lstring:gettext("Properties To Create"),visibility:"visible",presence:"optional",widget:v,validationFunc:function(e){if(e.p.useCreate){var n=t.without(t.keys(e.p.createProperty),""),i=["case_type","case_name"],r=t.union(i,["owner_id"]),o=t.difference(n,r),s=t.intersection(n,i),l=t.filter(n,(function(e){return!E.test(e)}));if(s.length!==i.length)return a.format(gettext("You must include {columns} columns to create a case"),{columns:i.join(", ")});if(o.length>0)return gettext("You can only use the following properties:")+" "+r.join(", ");if(l.length>0)return a.format(gettext("{props} are invalid properties"),{props:l.join(", ")})}return"pass"}},useClose:{lstring:gettext("Close Case"),visibility:"visible",presence:"optional",widget:o.checkbox},closeCondition:{lstring:gettext("Close Condition"),visibility:"visible",presence:"optional",widget:o.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath},useUpdate:{lstring:gettext("Update Case"),visibility:"visible",presence:"optional",widget:o.checkbox},updateProperty:{lstring:gettext("Properties To Update"),visibility:"visible",presence:"optional",widget:v,validationFunc:function(e){if(e.p.useUpdate){var n=t.without(t.keys(e.p.updateProperty),""),i=t.filter(n,(function(e){return!E.test(e)}));if(i.length>0)return a.format(gettext("{props} are invalid properties"),{props:i.join(", ")})}return"pass"}},useIndex:{lstring:gettext("Use Index"),visibility:"visible",presence:"optional",widget:o.checkbox},indexProperty:{lstring:gettext("Index Properties"),visibility:"visible",presence:"optional",widget:function(n,i){i.template=l;var a=m(n,i);return a.getValue=function(){var n={};return t.each(a.input.find(".fd-index-property"),(function(t){var i=e(t);n[i.find(".fd-index-property-name").val()]={calculate:i.find(".fd-index-property-source").val(),case_type:i.find(".fd-index-property-case-type").val(),relationship:i.find(".fd-index-property-relationship").val()}})),n},a},validationFunc:function(e){if(e.p.useIndex){var n=t.without(t.keys(e.p.indexProperty),""),i=t.filter(n,(function(e){return!E.test(e)})),r=t.without(t.map(e.p.indexProperty,(function(e,t){return e.relationship})),""),o=t.filter(r,(function(e){return!t.contains(["child","extension"],e)}));if(i.length>0)return a.format(gettext("{props} are invalid properties"),{props:i.join(", ")});if(o.length>0)return gettext("Relationship must be child or extension")}return"pass"}},useAttachment:{lstring:gettext("Use Attachments"),visibility:"visible",presence:"optional",widget:o.checkbox},attachmentProperty:{lstring:gettext("Attachment Properties"),visibility:"visible",presence:"optional",widget:function(n,i){i.template=d;var a=m(n,i);return a.getValue=function(){var n={};return t.each(a.input.find(".fd-attachment-property"),(function(t){var i=e(t);n[i.find(".fd-attachment-property-name").val()]={calculate:i.find(".fd-attachment-property-source").val(),from:i.find(".fd-attachment-property-from").val(),name:i.find(".fd-attachment-name").val()}})),n},a},validationFunc:function(e){if(!e.p.useAttachment)return"pass";var n=t.without(t.keys(e.p.attachmentProperty),""),i=t.filter(n,(function(e){return!E.test(e)})),r=t.filter(n,(function(n){return!t.contains(["local","remote","inline"],e.p.attachmentProperty[n].from)})),o=t.filter(n,(function(t){var n=e.p.attachmentProperty[t],i=n.from,a=n.name;return"inline"===i&&!a}));return i.length>0?a.format(gettext("{props} are invalid properties"),{props:i.join(", ")}):r.length>0?gettext("The from attribute must be one of: local, remote, or inline"):o.length>0?gettext("Inlined attachments must have an attachment name"):"pass"}}},getExtraDataAttributes:function(e){return{"vellum:role":"SaveToCase","vellum:case_type":e.p.case_type||""}},dataChildFilter:function(e,n){function a(e,t,n){return t=t||[],new i.Node(t,{getNodeID:function(){return e},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return n}}})}function r(e,n){return t.chain(e).map((function(e,i){if(i)return a(i,[],t.pick(e,n))})).compact().value()}var o=[];return u(n)&&o.push(a("create",r(n.p.createProperty))),h(n)&&o.push(a("update",r(n.p.updateProperty))),f(n)&&o.push(a("close")),p(n)&&o.push(a("index",r(n.p.indexProperty,["case_type","relationship"]))),g(n)&&o.push(a("attachment",r(n.p.attachmentProperty,["from","name"]))),[new i.Node(o,{getNodeID:function(){return"case"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{xmlns:"http://commcarehq.org/case/transaction/v2",case_id:"",date_modified:"",user_id:""}}}})]},getBindList:function(e){var n=[];function i(n,i){return t.chain(i).omit("").map((function(t,i){return{nodeset:e.absolutePath+"/case/"+n+"/"+i,calculate:t.calculate,relevant:t.relevant}})).value()}return u(e)&&(e.isInRepeat()&&(n=n.concat({nodeset:e.absolutePath+"/case/@case_id",calculate:e.p.case_id})),n=n.concat(i("create",e.p.createProperty))),h(e)&&(n=n.concat(i("update",e.p.updateProperty))),f(e)&&n.push({nodeset:e.absolutePath+"/case/close",relevant:e.p.closeCondition}),p(e)&&(n=n.concat(i("index",e.p.indexProperty))),g(e)&&(n=n.concat(t.chain(e.p.attachmentProperty).omit("").map((function(t,n){return{nodeset:e.absolutePath+"/case/attachment/"+n+"/@src",calculate:t.calculate}})).value())),function(e){return u(e)||f(e)||h(e)||p(e)||g(e)}(e)&&(n.push({nodeset:e.absolutePath+"/case/@date_modified",calculate:e.p.date_modified,type:"xsd:dateTime"}),n.push({nodeset:e.absolutePath+"/case/@user_id",calculate:e.p.user_id}),u(e)||n.push({nodeset:e.absolutePath+"/case/@case_id",calculate:e.p.case_id})),n},parseDataNode:function(n,i){var a=i.xmlAttr("vellum:case_type"),r=i.children(),o=r.find("create"),s=r.find("close"),l=r.find("update"),d=r.find("index"),c=r.find("attachment");return a&&(n.p.case_type=a),o&&0!==o.length&&(n.p.useCreate=!0),l&&0!==l.length&&(n.p.useUpdate=!0),s&&0!==s.length&&(n.p.useClose=!0),d&&0!==d.length&&(n.p.useIndex=!0,n.p.indexProperty={},t.each(d.children(),(function(t){var i=e(t);n.p.indexProperty[i.prop("tagName")]={case_type:i.xmlAttr("case_type"),relationship:i.xmlAttr("relationship")}}))),c&&0!==c.length&&(n.p.useAttachment=!0,n.p.attachmentProperty||(n.p.attachmentProperty={}),t.each(c.children(),(function(t){var i=e(t);n.p.attachmentProperty[i.prop("tagName")]={from:i.xmlAttr("from"),name:i.xmlAttr("name")}}))),e([])},getSetValues:function(e){return u(e)&&!e.isInRepeat()?[{event:"xforms-ready",ref:e.absolutePath+"/case/@case_id",value:e.p.case_id}]:[]},getCaseSaveData:function(e){var n=t.union(t.keys(e.p.createProperty||{}),t.keys(e.p.updateProperty||{}));return{case_type:e.p.case_type||"",properties:t.filter(n,t.identity),create:e.p.useCreate||!1,close:e.p.useClose||!1}}},C={SaveToCase:[{slug:"main",displayName:gettext("Basic"),properties:["nodeID","date_modified","user_id","case_type","case_id"]},{slug:"create",displayName:gettext("Create"),properties:["useCreate","createProperty"],isCollapsed:function(e){return!u(e)}},{slug:"update",displayName:gettext("Update"),properties:["useUpdate","updateProperty"],isCollapsed:function(e){return!h(e)}},{slug:"close",displayName:gettext("Close"),properties:["useClose","closeCondition"],isCollapsed:function(e){return!f(e)}},{slug:"index",displayName:gettext("Index"),properties:["useIndex","indexProperty"],isCollapsed:function(e){return!p(e)}},{slug:"attachment",displayName:gettext("Attachments"),properties:["useAttachment","attachmentProperty"],isCollapsed:function(e){return!g(e)}}]};e.vellum.plugin("saveToCase",{},{getAdvancedQuestions:function(){return this.__callOld().concat(["SaveToCase"])},handleMugParseFinish:function(e){if(this.__callOld(),u(e)){var n=e.absolutePath+"/case/@case_id",i=t.find(e.form.getSetValues(),(function(e){return e.ref===n}));i&&(e.p.case_id=i.value,e.form.dropSetValues((function(e){return i===e})))}},getMugTypes:function(){var e=this.__callOld();return e.normal.SaveToCase=a.extend(n.defaultOptions,T),e},getSections:function(e){return C.hasOwnProperty(e.__className)?t.map(C[e.__className],(function(n){var i=t.clone(n);return t.isFunction(i.isCollapsed)&&(i.isCollapsed=i.isCollapsed(e)),i})):this.__callOld()},parseBindElement:function(e,t,n){var i=e.getMugByPath(n);if(!i){var a,r=/\/case\/(?:(create|update|index)\/([\w-]+)|(close|@date_modified|@user_id|@case_id))$/,o=n.match(r);if(o&&o.length>0&&(a=n.replace(r,""),(i=e.getMugByPath(a))&&"SaveToCase"===i.__className)){if(o[2]){var s=o[2],l={create:"createProperty",update:"updateProperty",index:"indexProperty",attachment:"attachmentProperty"}[o[1]];return i.p[l]||(i.p[l]={}),i.p[l][s]||(i.p[l][s]={}),i.p[l][s].calculate=t.xmlAttr("calculate"),void(t.xmlAttr("relevant")&&(i.p[l][s].relevant=t.xmlAttr("relevant")))}var d={close:{mugProp:"closeCondition",elAttr:"relevant"},"@date_modified":{mugProp:"date_modified",elAttr:"calculate"},"@user_id":{mugProp:"user_id",elAttr:"calculate"},"@case_id":{mugProp:"case_id",elAttr:"calculate"}}[o[3]];return void(i.p[d.mugProp]=t.xmlAttr(d.elAttr))}var c=/\/case\/attachment\/(\w+)\/@src$/,u=n.match(c);if(u&&(a=n.replace(c,""),(i=e.getMugByPath(a))&&"SaveToCase"===i.__className)){var f=i.p.attachmentProperty,h=u[1];return f[h]||(f[h]={}),void(i.p.attachmentProperty[h].calculate=t.xmlAttr("calculate"))}}this.__callOld()}})}.apply(t,i))||(e.exports=a)},4872:(e,t,n)=>{const i=n(3946);e.exports=i.template('<ul class="dropdown-menu multi-level" role="menu">\n    <% _.each(groups, function(group) { %>\n        <% if (group.questions.length > 1) { %>\n            <li class="dropdown-submenu">\n                <a tabindex="-1" class="fd-question-type" data-qtype="<%= group.defaultQuestion.slug %>">\n                    <i class="<%= group.defaultQuestion.icon %>"></i>\n                    <%= group.name %>\n                </a>\n                <ul class="dropdown-menu">\n        <% } %>\n                    <% _.each(group.questions, function(question) { %>\n                        <li>\n                            <a tabindex="-1" class="fd-question-type" data-qtype="<%= question.slug %>">\n                                <i class="<%= question.icon %>"></i> <%= question.name %>\n                            </a>\n                        </li>\n                    <% }) %>\n        <% if (group.questions.length > 1) { %>\n                </ul>\n            </li>\n        <% } %>\n    <% }); %>\n</ul>\n')},7356:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="alert alert-block <%=messageType.cssClass%>">\n    <button type="button" class="close" data-dismiss="alert">&times;</button>\n    <h4><% if (messageType.icon) { %><i class="<%=messageType.icon%>"></i> <% } %><%=messageType.title%></h4>\n    <ul>\n        <% _.each(messages, function (message) { %>\n        <li><%-message%></li>\n        <% }); %>\n    </ul>\n</div>\n')},7724:(e,t,n)=>{const i=n(3946);e.exports=i.template('<li>\n  <i class="<%= icon %>"></i> <%= displayPath %>\n    <% if (displayLabel) { %>\n      <br />\n      <span class="atwho-jrtext"><%= displayLabel %></span>\n    <% } %>\n</li>,\n')},4489:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-itextID-checkbox-container col-sm-1">\n    <label class="checkbox">\n        \x3c!-- checkbox goes here --\x3e\n        <%-gettext("auto?")%>\n    </label>\n</div>\n')},7207:(e,t,n)=>{const i=n(3946);e.exports=i.template('<button type="button" class="btn btn-danger"><i class="fa fa-remove"></i></button>\n')},7444:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-commander">\n    <i class="fa-solid fa-xmark fd-commander-close"></i>\n    <input type="text" class="form-control" placeholder="<%-gettext(\'Enter command\')%>" />\n</div>\n')},516:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-source-container">\n    <p>\n        <%=description%>\n    </p>\n    <div id="form-differences">\n      <pre><%=xmldiff%></pre>\n    </div>\n</div>\n')},9443:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="form-group">\n    <label class="control-label col-sm-3"><div><%=label%></div></label>\n    <div class="controls col-sm-9"></div>\n</div>\n')},7133:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="form-group">\n    <label class="control-label col-sm-3">\n        <%=label%>\n    </label>\n    <div class="col-sm-9">\n        <input type="<%=type%>"<% if (type === \'text\') { %> class="form-control"<% } %> />\n    </div>\n</div>\n')},23:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-copy-paste-help">\n    <h3><%-gettext("Copying and Pasting Questions")%></h3>\n    <div class="copy-paste-help">\n        <%-gettext("These actions are available via the browser\'s Edit menu, and you can also use:")%>\n        <div class="row">\n            <div class="col-sm-3">\n                <h1><%=metachar%>C</h1>\n                <span><%-gettext("for copy")%></span>\n            </div>\n            \x3c!--div class="col-sm-3">\n                <h1><%=metachar%>X</h1>\n                <span>for cut</span>\n            </div--\x3e\n            <div class="col-sm-3">\n                <h1><%=metachar%>V</h1>\n                <span><%-gettext("for paste")%></span>\n            </div>\n        </div>\n    </div>\n    <div class="copy-paste-box hide">\n        <p><%-gettext("Copy from or Paste into this text box:")%> <textarea></textarea></p>\n        <p><button class="btn btn-default insert-questions"><%-gettext("Insert Questions")%></button></p>\n    </div>\n    <h3><%-gettext("Selecting Multiple Questions")%></h3>\n    <div class="row">\n        <%\n            var key = metachar.endsWith("+") ? metachar.slice(0, -1) : metachar;\n            key = "<strong>" + key + "</strong>";\n            print(format(gettext("Hold {key} and click on each question."), {key: key}));\n        %>\n    </div>\n    <h3><%-gettext("Other Tips")%></h3>\n    <p><%-gettext("Questions can be copied between forms, and even to other apps.")%></p>\n</div>\n')},9740:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-data-source-editor-container form form-horizontal">\n\n    <fieldset class="data-source-advanced">\n        <legend>\n            <i class="fa fa-cog"></i> <%-gettext("Edit Data Source")%>\n        </legend>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Query Expression")%>\n            </label>\n            <div class="col-sm-10">\n                <textarea rows="5"\n                          name="query"\n                          class="form-control fd-data-source-query jstree-drop"></textarea>\n                <p class="help-block">\n                    <a target="_blank"\n                       href="https://help.commcarehq.org/display/commcarepublic/Common+Logic+and+Calculations">\n                        <i class="fa fa-info-circle"></i> <%-gettext("Guide to Common Logic and Calculations")%>\n                    </a>\n                </p>\n            </div>\n        </div>\n        <legend><%-gettext("Optional Instance Properties")%></legend>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Instance ID")%>\n            </label>\n            <div class="col-sm-10">\n                <input name="instance-id" type="text" class="form-control jstree-drop" />\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Instance URI")%>\n            </label>\n            <div class="col-sm-10">\n                <input name="instance-src" type="text" class="form-control jstree-drop" />\n            </div>\n        </div>\n    </fieldset>\n\n    <div class="form-actions form-actions-condensed fd-data-source-actions">\n        <div class="col-sm-2"></div>\n        <div class="col-sm-10">\n            <button type="button" class="btn btn-primary fd-data-source-save-button"><%-gettext("Save")%></button>\n            <button type="button" class="btn btn-default fd-data-source-cancel-button"><%-gettext("Cancel")%></button>\n        </div>\n    </div>\n    </div>\n</div>\n')},3436:(e,t,n)=>{const i=n(3946);e.exports=i.template('<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">\n    <li style="padding-left: 10px;"><strong><%-gettext("Date Format Options")%></strong></li>\n    <% _.each(formats, function (label, format) { %>\n        <li><a tabindex="-1" data-format="<%= format %>"><%= label %></a></li>\n    <% }); %>\n</ul>\n')},8654:(e,t,n)=>{const i=n(3946);e.exports=i.template(' (<a class="jstree-hover" id="<%= guid %>"><%= text %></a>)')},6990:(e,t,n)=>{const i=n(3946);e.exports=i.template('<p><%= text %></p>\n<% if (ufid) { %>\n    <p>\n        <a class="jstree-hover" data-ufid="<%= ufid %>">\n            <%-gettext("show in question list")%>\n        </a>\n    </p>\n<% } %>\n')},5674:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-source-container">\n    <p>\n        <%=description%>\n    </p>\n    <textarea class="form-control" rows="16"></textarea>\n</div>\n')},1705:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-external-sources-container">\n    <div class="fd-head fd-head-external-sources">\n        <div class="fd-head-max-indicator"><i class="fa-regular fa-circle-down"></i></div>\n        <h2><%-gettext("App Properties")%></h2>\n    </div>\n    <div class="fd-scrollable">\n        <div class="fd-external-resource-search">\n            <form class="form-inline">\n                <label class="control-label" for="fdExternalSearch"><i class="fa fa-search"></i></label>\n                <div class="fd-search-control">\n                    <input type="text"\n                        id="fdExternalSearch"\n                        class="form-control search-query"\n                        placeholder="<%-gettext("Search...")%>"\n                        style="width: calc(100% - 42px);"\n                        autocomplete="off" >\n                </div>\n            </form>\n        </div>\n        <div class="fd-external-sources-error container-fluid has-error hide">\n            <div class="help-block"></div>\n        </div>\n        <div class="fd-external-sources-tree"></div>\n    </div>\n</div>\n')},8426:(e,t,n)=>{const i=n(3946);e.exports=i.template('<table class="table table-hover">\n  <thead>\n    <th><%-gettext("Question")%></th>\n    <th><%-gettext("Used By")%></th>\n    <th><%-gettext("In Property")%></th>\n  </thead>\n  <% _.each(tableData, function(refs, question) { %>\n     <tr>\n       <td><a class="link-to-question"><%- question %></a></td>\n       <td></td>\n       <td></td>\n     </tr>\n     <% _.each(refs, function(propName, path) {%>\n       <tr class="usage-row">\n         <td></td>\n         <td><a class="link-to-question"><%- path %></a></td>\n         <td><%- propName %></td>\n       </tr>\n     <% }); %>\n   <% }); %>\n</table>\n')},1089:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-search">\n  <div class=\'form-inline\'>\n    <div>\n      <label class="control-label" for="findUsagesSearch">\n        <i class="fa fa-search"></i>\n      </label>\n      <div class="fd-search-control">\n        <input type="text"\n               class="form-control search-query"\n               id="findUsagesSearch"\n               placeholder="<%-gettext("Search...")%>"\n               style="width: calc(100% - 42px);"\n               autocomplete="off"/>\n      </div>\n    </div>\n  </div>\n</div>\n')},8267:(e,t,n)=>{const i=n(3946);e.exports=i.template("<ul>\n<% _.each(errors, function (error) { %>\n    <li>\n        <%= error.mug.getDisplayName(displayLanguage) %>\n        <ul>\n        <% _.each(error.errors, function (error) { %>\n            <li><%= error.message %></li>\n        <% }); %>\n        </ul>\n    </li>\n<% }); %>\n</ul>\n")},6328:(e,t,n)=>{const i=n(3946);e.exports=i.template('<li class="divider language-selector"></li>\n<li class="dropdown-header language-selector"><%-gettext("Display")%></li>\n<% _.each(languages, function(language) { %>\n<li><a tabindex="-1" class="fd-display-item language-selector" data-code="<%-language.code%>"><i class="fa fa-check"></i><%-language.name%><%\n    if (language.name !== language.code && language.code !== \'_ids\') {\n        %> (<%-language.code%>)<%\n    }\n    %></a></li><%\n}); %>\n')},8101:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-ui-container">\n    <div class="fd-content fd-content-left">\n        <div class="fd-tree">\n            <div class="fd-head">\n                <h2>\n                    <i class="fd-form-icon"></i>\n                    <span class="fd-head-text"><%-gettext("Questions")%></span>\n                </h2>\n                <div class="fd-head-menu-container">\n                    <div class="dropdown">\n                        <a class="dropdown-toggle"\n                           data-toggle="dropdown">\n                            <i class="fa fa-reorder"></i>\n                            <i class="fa fa-caret-down"></i>\n                        </a>\n                        <ul class="dropdown-menu checklist fd-questions-menu fd-scrollable-minimal" role="menu">\n                            <li>\n                                <a class="fd-button-copy">\n                                    <i class="fa fa-copy"></i>\n                                    <%-gettext("Copy")%><span class="hotkey"><%-Ctrl%>C</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class="fd-expand-all">\n                                    <i class="fa fa-angle-double-down"></i>\n                                    <%-gettext("Expand All")%><span class="hotkey"><%-Ctrl%><%-Alt%>=</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class="fd-collapse-all">\n                                    <i class="fa fa-angle-double-right"></i>\n                                    <%-gettext("Collapse All")%><span class="hotkey"><%-Ctrl%><%-Alt%>&ndash;</span>\n                                </a>\n                            </li>\n                            <li class="divider fd-bulk-update-menu"></li>\n                            <li class="dropdown-header fd-bulk-update-header">\n                              <%-gettext("Bulk Update All Questions")%>\n                            </li>\n                            <li class="divider fd-tools-menu"></li>\n                        </ul>\n                        <input type="hidden" class="fd-question-tree-display" />\n                    </div>\n                </div>\n            </div>\n            <div class="dropdown fd-add-question-dropdown">\n                <button class="fd-add-question dropdown-toggle btn btn-purple" data-toggle="dropdown">\n                    <i class="fa fa-plus"></i> <%-gettext("Add Question")%>\n                    <i class="fa fa-caret-down"></i>\n                </button>\n            </div>\n            <div class="fd-undo-container"> </div>\n            <div class="fd-scrollable fd-scrollable-tree">\n                <div class="fd-question-tree"></div>\n                <div class="hide fd-default-panel fd-default-qtree">\n                  <div class="helpbubble helpbubble-purple helpbubble-top-left">\n                    <p class="lead">\n                    <%\n                        var msg = gettext("Click {btn} to start building your form."),\n                            add = gettext("Add Question"),\n                            btn = \'<i class="fa fa-plus"></i> <strong>\' + add + \'</strong>\';\n                        print(format(msg, {btn: btn}));\n                    %>\n                    </p>\n                    <p class="fd-default-helptext"></p>\n                  </div>\n                </div>\n            </div>\n        </div>\n        <div class="fd-external-sources-divider fd-content-left-divider fd-content-horizontal-divider">\n          <i class="fa fa-ellipsis-h"></i>\n        </div>\n        <div class="fd-accessory-pane"></div>\n    </div>\n    <div class="fd-content fd-content-divider fd-content-vertical-divider"></div>\n    <div class="fd-content fd-content-right">\n        <div class="fd-form-actions btn-toolbar">\n            <div class="btn-group fd-save-button"></div>\n        </div>\n        <div class="fd-column fd-question-properties hide">\n            <div class="fd-head"><h2><%-gettext("Question Details")%></h2></div>\n            <div class="fd-props-toolbar"></div>\n            <div class="fd-scrollable fd-props-scrollable">\n                <form class="form form-horizontal fd-props-content"></form>\n            </div>\n        </div>\n        <div class="fd-xpath-editor fd-column hide">\n            <div class="fd-head"><h2><%-gettext("Expression Editor")%></h2></div>\n            <div class="fd-scrollable full">\n                <div class="fd-xpath-editor-content"></div>\n            </div>\n        </div>\n        <div class="fd-column hide fd-default-panel">\n        </div>\n    </div>\n\n    <div class="fd-messages"></div>\n</div>\n\x3c!-- Begin modal divs --\x3e\n<div class="fd-multimedia-modal-container"></div>\n<div class="fd-modal-generic-container"></div>\n\x3c!-- end modal divs --\x3e\n')},3591:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div>\n    <div class="fd-help pull-right">\n      <a tabindex="-1"\n        data-title="<%-title%>"\n        data-placement="right"\n        data-content="<%=gettext("Use text formatting to <strong>bold</strong> and <em>italicize</em> words, use bulleted lists, and <a target=\'_blank\' href=\'https://help.commcarehq.org/display/commcarepublic/Text+Formatting\'>more</a>")%>"\n      ></a>\n    </div>\n    <a class="turn-markdown-off markdown-trigger clearfix"><%-gettext("Turn Off Text Formatting")%></a>\n    <a class="turn-markdown-on markdown-trigger clearfix"><%-gettext("Turn On Text Formatting")%></a>\n</div>\n')},1694:(e,t,n)=>{const i=n(3946);e.exports=i.template('<button class="btn <%=cssClasses%><% if (defaultButton) { %> btn-default<% } %>">\n    <%= title %>\n</button>\n')},7649:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="modal fade">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title">\n                    <% if (headerIcon) { %>\n                        <i class="<%=headerIcon%>"></i>\n                    <% } %>\n                    <%=title%>\n                </h4>\n            </div>\n            <div class="modal-body form form-horizontal">\n            </div>\n            <div class="modal-footer">\n                <% if (closeButtonTitle) { %>\n                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">\n                    <%=closeButtonTitle%>\n                </button>\n                <% } %>\n            </div>\n        </div>\n    </div>\n</div>\n')},4533:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="control-row">\n    <div class="col-sm-12">\n        <button type="button" class="btn btn-default fd-mm-path-show pull-right">\n            <i class="fa fa-cog"></i>\n            <%-gettext("Advanced: Show Path")%>\n        </button>\n        <div class="fd-mm-upload-trigger"></div>\n    </div>\n</div>\n<div class="control-row">\n    <div class="fd-mm-path hide col-sm-12">\n        <button type="button" class="btn btn-default fd-mm-path-hide pull-right"><%-gettext("Hide Path")%></button>\n        <div class="fd-mm-path-input"></div>\n    </div>\n</div>\n')},3609:(e,t,n)=>{const i=n(3946);e.exports=i.template('<% if (errors.length > 0) { %>\n    <div class="alert alert-danger">\n        <% for (var e = 0; e < errors.length; e++) {\n            var error = errors[e]; %>\n            <p><%- error %></p>\n        <% } %>\n    </div>\n<% } %>\n')},9606:(e,t,n)=>{const i=n(3946);e.exports=i.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open Audio")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Audio Uploaded Successfully")%></span>\n</p>\n')},8793:(e,t,n)=>{const i=n(3946);e.exports=i.template('<p>\n    <img src="<%=url %>?thumb=100" alt="uploaded image" />\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens image in new tab.")%>"><%-gettext("View Full Size")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Image Uploaded Successfully")%></span>\n</p>\n')},8125:(e,t,n)=>{const i=n(3946);e.exports=i.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open HTML")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New HTML Document Uploaded Successfully")%></span>\n</p>\n')},1779:(e,t,n)=>{const i=n(3946);e.exports=i.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open Video")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Video Uploaded Successfully")%></span>\n</p>\n')},2589:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="modal fade" id="<%= modalId %>">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title"><%-gettext("Upload")%> <%= mediaType %></h4>\n            </div>\n            <div class="modal-body form form-horizontal">\n                <div class="form-group">\n                    <label class="col-sm-4 control-label">\n                        <%-gettext("Select new")%> <%= mediaType %>\n                    </label>\n                    <div class="col-sm-8">\n                        <button class="btn btn-primary" type="button"><%-gettext("Select File")%></button>\n                        <input type="file" class="hide" />\n                        <div class="hqm-upload-status"></div>\n                    </div>\n                </div>\n                <div class="form-group hqm-existing hide">\n                    <label class="col-sm-4 control-label">\n                        <%-gettext("Current")%> <%= mediaType %>\n                    </label>\n                    <div class="col-sm-8 hqm-existing-controls">\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <a class="btn btn-default" data-dismiss="modal"><%-gettext("Close")%></a>\n                <a class="btn btn-default disabled hqm-upload hqm-upload-confirm">\n                    <i class="fa-solid fa-cloud-arrow-up"></i>\n                    <i class="fa-solid fa-spin fa-refresh hide"></i>\n                    <%-gettext("Begin Upload")%>\n                </a>\n            </div>\n        </div>\n    </div>\n</div>\n')},2618:(e,t,n)=>{const i=n(3946);e.exports=i.template('<p class="fd-mm-no-ref">\n    <i class="<%=iconClass%>"></i>\n    <%-gettext("No Reference")%>\n</p>\n')},5080:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div style="clear: both;">\n    <div class="alert alert-success" style="margin-bottom: 2px; margin-top: 10px;">\n        <i class="fa fa-check"></i> <%= file_name %> <strong>[<%= file_size %> MB]</strong>\n    </div>\n    <p class="text-success hqm-begin">\n      <%=gettext("Ready to upload. Click <strong>Begin Upload</strong> below to start.")%>\n    </p>\n    <p class="text-danger hqm-error hide">\n        <span class="label label-danger"><%-gettext("There were errors.")%></span>\n    </p>\n    <div class="hqm-errors"></div>\n</div>\n')},3184:(e,t,n)=>{const i=n(3946);e.exports=i.template('<a href="#<%= uploaderId %>"\n   class="btn btn-primary"\n   data-toggle="modal">\n    <%- multimediaExists ? gettext("Replace") : gettext("Upload") %> <%=mediaType%>\n</a>\n')},8019:(e,t,n)=>{const i=n(3946);e.exports=i.template('<fieldset class="fd-question-fieldset<% if (isCollapsed) { %> hide<% } %>" data-slug="<%= fieldsetSlug %>">\n    <legend>\n        <% if (help) { %>\n        <div class="fd-help pull-right">\n            <a class="help" tabindex="-1"\n                data-title="<%=help.title%>"\n                data-content="<%=help.text%><p><a target=\'_blank\' href=\'<%=help.link%>\'>See More</a></p>"\n                data-placement="left">\n            </a>\n        </div>\n        <% } %>\n        <%=fieldsetTitle%>\n    </legend>\n    \x3c!-- todo: don\'t require passing a unique ID to this template or an\n    interface that exposes it (i.e., allow passing a non-unique id and then\n    append it to a random one, or something --\x3e\n    <div id="<%=fieldsetClass%>">\n        <div class="fd-fieldset-content"></div>\n    </div>\n</fieldset>\n')},348:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-question-toolbar-container clearfix">\n    <% if (isCopyable) { %><div class="btn-toolbar pull-left"></div><% } %>\n    <div class="btn-toolbar pull-right">\n        <% if (isDeleteable) { %>\n            <button type="button" class="btn btn-danger fd-button-remove"  tabindex="-1">\n                <i class="fa-regular fa-trash-can"></i> <%-gettext("Delete")%>\n            </button>\n        <% } %>\n        <% if (sections.length) { %>\n            <div class="btn-group fd-section-changer">\n                <a class="btn btn-default dropdown-toggle" data-toggle="dropdown">\n                    <i class="fa fa-reorder"></i>\n                    <i class="fa fa-caret-down"></i>\n                </a>\n                <ul class="dropdown-menu dropdown-menu-right checklist">\n                    <li class="dropdown-header"><%-gettext("Show")%></li>\n                    <% _.each(sections, function(section) { %>\n                    <li>\n                        <a data-slug="<%= section.slug %>" <% if (section.show) { %>class="selected"<% } %>>\n                            <i class="fa fa-check"></i><%= section.displayName %>\n                        </a>\n                    </li>\n                    <% }); %>\n                </ul>\n            </div>\n        <% } %>\n    </div>\n</div>\n<div class="alert alert-info fd-question-comment"\n<% if (!comment) { %>\n  style="display: none"\n<% } %>\n><%= comment %></div>\n')},4226:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="btn-group question-type-changer">\n    <a class="btn btn-default dropdown-toggle current-question"\n        data-toggle="dropdown">\n        <i class="<%=currentQuestionIcon%>"></i> \n        <%= currentTypeName %> <span class="caret"></span>\n    </a>\n    <ul class="dropdown-menu">\n        <% if (questions.length === 0) { %>\n            <li class="dropdown-header"><%-gettext("Cannot Change Question Type")%></li>\n        <% } else { %>\n            <li class="dropdown-header"><%-gettext("Change Question Type To")%></li>\n            <% _.each(questions, function(question) { %>\n            <li>\n                <a class="change-question" data-qtype="<%=question.slug%>">\n                    <i class="<%=question.icon%>"></i> <%=question.name%>\n                </a>\n            </li>\n            <% }); %>\n        <% } %>\n\n    </ul>\n</div>\n')},1409:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="widget">\n    <div class="form-group">\n        <div class="control-label col-sm-3">\n            <label><%= labelText %></label>\n            <% if (help) { %>\n                <div class="fd-help">\n                    <a tabindex="-1"\n                        data-title="<%- labelText %>"\n                        data-content="<%- help.text %><% if (help.url) { %><p><a href=\'<%- help.url %>\' target=\'_blank\'>See more</a></p><% } %>"></a>\n                </div>\n            <% } %>\n        </div>\n        <div class="col-sm-9 controls">\n            \x3c!-- input will go here --\x3e\n            <div class="messages"></div>\n        </div>\n    </div>\n</div>\n')},9655:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-undo-delete alert alert-<%= errors.length ? "danger" : "success" %> fade in">\n  <button type="button" class="close">&times;</button>\n  <%-gettext("You have deleted a question.")%> <a class="fd-undo"><%-gettext("Undo")%></a>\n  <% if (errors.length) { %>\n    <p><%\n      print(format(\n        ngettext(\n          "Warning: {errs} is still referenced by other questions.",\n          "Warning: {errs} are still referenced by other questions.",\n          errors.length\n        ),\n        {errs: errors.join(", ")}\n      ))\n    %></p>\n  <% } %>\n</div>\n')},7501:(e,t,n)=>{const i=n(3946);e.exports=i.template('<% props[""] = {calculate: "", relevant: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-attachment-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Node Name")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Source")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-from form-control"\n               value="<%-v[\'from\']%>" type="text" placeholder="<%-gettext("From")%>"/>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-name form-control"\n               value="<%-v[\'name\']%>" type="text" placeholder="<%-gettext("Attachment Name")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},237:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="well fd-kv">\n    <% pairs[""] = ""; %>\n    <% _.each(pairs, function (v, k) { _.each(_.isArray(v) ? v : [v], function (v) { %>\n        <div class="fd-kv-pair form-group">\n            <div class="col-sm-3">\n                <input class="fd-kv-key form-control" type="text" value="<%=k%>" placeholder="<%-gettext("key")%>" />\n            </div>\n            <div class="col-sm-1 fd-kv-arrow"><i class="fa fa-arrow-right"></i></div>\n            <div class="col-sm-7"><input class="fd-kv-val form-control jstree-drop" type="text" value="<%=v%>" placeholder="<%-gettext("value")%>" /></div>\n            <div class="col-sm-1">\n                <a class="btn fd-kv-remove-pair btn-sm btn-danger<% if (k ==\'\') { %> hide<% } %>">\n                    <i class="fa fa-remove"></i>\n                </a>\n            </div>\n        </div>\n    <% }); }); %>\n    <a class="btn btn-default fd-kv-add-pair hide"><i class="fa fa-plus"></i> <%=gettext("Add Key&rarr;Value Pair")%></a>\n</div>\n')},918:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="fd-control-message alert alert-warning alert-block <%= msg.level %>">\n    <button type="button" class="close" data-dismiss="alert">&times;</button>\n    <% if (html) { %><%= html %><% } else { %><%- msg.message %><% } %>\n</div>\n')},4206:(e,t,n)=>{const i=n(3946);e.exports=i.template('<% props[""] = {calculate: "", relevant: "", case_type: "", relationship: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-index-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Relationship Identifier (e.g. parent or host)")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Referenced Case ID")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-case-type form-control"\n               value="<%-v[\'case_type\']%>" type="text" placeholder="<%-gettext("Referenced Case Type")%>"/>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-relationship form-control"\n               value="<%-v[\'relationship\']%>" type="text" placeholder="<%-gettext("Relationship (child or extension)")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},3835:(e,t,n)=>{const i=n(3946);e.exports=i.template('<div class="well well-small">\n  <%= internal_template({props: props}) %>\n  <a class="btn btn-default fd-add-property hide"><i class="fa fa-plus"></i> <%-gettext("Add Property")%></a>\n</div>\n<div class="messages" />\n')},1:(e,t,n)=>{const i=n(3946);e.exports=i.template('<% props[""] = {calculate: "", relevant: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-update-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Property Name")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Calculation")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-relevant form-control"\n               value="<%-v[\'relevant\']%>" type="text" placeholder="<%-gettext("Relevant")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},7026:(e,t,n)=>{var i,a;i=[n(8094),n(3946)],void 0===(a=function(e,t){function n(e,t){this.value=t,this.children=e||[],this.parent=null}function i(t,i){e.eventuality(this),this.rootNode=new n(null,null),this.rootNode.isRootNode=!0,this.setRootID(t),this.treeType=i||"data"}return n.prototype={getChildren:function(){return this.children},getValue:function(){return this.value},addChild:function(e){e.parent=this,this.children.push(e)},insertChild:function(e,t){if(null===e)return null;t<0&&(t=0),e.parent=this,this.children.splice(t,0,e)},getSingleMatchingNode:function(e){var t;if(e(this.getValue()))return this;for(var n=0;n<this.children.length;n++)if(t=this.children[n].getSingleMatchingNode(e))return t;return null},removeChild:function(e){var t=this.children.indexOf(e);return-1!==t&&this.children.splice(t,1),e.parent=null,e},getID:function(){return this.isRootNode?this.rootNodeId:this.getValue().getNodeID()},getChildrenMugs:function(){var e,t=[];for(e in this.children)this.children.hasOwnProperty(e)&&t.push(this.children[e].getValue());return t},getStructure:function(){var e={};return e[this.getID()]=t.map(this.children,(function(e){return e.getStructure()})),e},treeMap:function(e,t,n){var i,a=e(this),r=this.getChildren();for(i in a&&t.push(a),r)r.hasOwnProperty(i)&&r[i].treeMap(e,t,n);return n&&n(this,a),t},walk:function(e){var t=this.getValue(),n=this.getChildren();e(t,this.getID(),(function(i){i&&(n=i(n,t));for(var a=0;a<n.length;a++)n[a].walk(e)}))},getAbsolutePath:function(e){if(this.isRootNode)return e?"":"/"+this.getID();var t,n=this.value,i=n.p.dataParent;if(i){var a=n.form.getMugByPath(i);t=a&&a!==n?n.form.getAbsolutePath(a,e):e?"":"/"+this.getRootNode().rootNodeId}else if(null===(t=this.parent.getAbsolutePath(e)))return null;var r=this.getID();return n.options.getPathName&&(r=n.options.getPathName(n,r)),(t||"")+"/"+r},validateTree:function(e){var t;if(!this.getValue())throw"Tree contains node with no values!";if(!e(this.getValue()))return!1;for(t in this.getChildren())if(this.getChildren().hasOwnProperty(t)&&!this.getChildren()[t].validateTree(e))return!1;return!0},getRootNode:function(){return this.isRootNode?this:this.parent.getRootNode()}},i.prototype={setRootID:function(e){this.rootNode.rootNodeId=e},getParentNode:function(e){return this.rootNode===e?this.rootNode:e&&e.parent},getStructure:function(){return this.rootNode.getStructure()},getNodeFromMug:function(e){return e["_node_"+this.treeType]},_removeNodeFromTree:function(e){var t=this.getParentNode(e);t&&(t.removeChild(e),this.fire({type:"change"}))},insertMug:function(e,t,i,a){var r,o,s=i?this.getNodeFromMug(i):this.rootNode,l=this.getNodeFromMug(e);switch(l&&this.rootNode===l.getRootNode()?this._removeNodeFromTree(l):(l=new n(null,e),e["_node_"+this.treeType]=l),t){case"before":case"inside":r=(o=this.getParentNode(s)).children.indexOf(s),o.insertChild(l,r);break;case null:case"after":r=(o=this.getParentNode(s)).children.indexOf(s),o.insertChild(l,r+1);break;case"into":case"last":s.addChild(l);break;case"first":s.insertChild(l,0);break;case"index":s.insertChild(l,a);break;default:throw"in insertMug() position argument MUST be null, 'before', 'after', 'into', 'first' or 'last'. Argument was: "+t}return this.fire({type:"change",mug:e}),l},getAbsolutePath:function(e,t){var n=this.getNodeFromMug(e);return n?n.getAbsolutePath(t):null},getPreviousSibling:function(e){var t=this,n=t.getNodeFromMug(e),i=e.parentMug,a=i?t.getNodeFromMug(i):t.getRootNode(),r=a.children.indexOf(n);return 0===r?i:a.children[r-1].getValue()},findSibling:function(e,t,n){var i,a,r,o=this.getNodeFromMug(e);if(!o)throw"mug not found in "+this.treeType+" tree";if(-1===(a=(i=this.getParentNode(o).getChildrenMugs()).indexOf(e)))throw"mug not found in its parent's children";if("before"===t){for(r=a-1;r>=0;r--)if(n(i[r]))return i[r]}else for(r=a+1;r<i.length;r++)if(n(i[r]))return i[r];return null},removeMug:function(e){this._removeNodeFromTree(this.getNodeFromMug(e))},getRootChildren:function(){return this.rootNode.getChildrenMugs()},treeMap:function(e,t){return this.rootNode.treeMap(e,[],t)},walk:function(e){this.rootNode.walk(e)},isTreeValid:function(e){var t,n=this.rootNode.getChildren();for(t in n)if(n.hasOwnProperty(t)&&!n[t].validateTree(e))return!1;return!0},getRootNode:function(){return this.rootNode}},i.Node=n,i}.apply(t,i))||(e.exports=a)},3809:(e,t,n)=>{var i,a;i=[n(3946)],void 0===(a=function(e){var t=/[\r\n\u2028\u2029"\t]/;function n(n){return n=null===n||e.isUndefined(n)?"":String(n),t.test(n)&&(n='"'+n.replace(/"/g,'""')+'"'),n}return{escape:n,makeRowParser:function(t){var n=/(.*)(?:\n|\r\n|\r|\u2028|\u2029)/gm,i=/(.*?)(?:\t|(\n|\r\n|\r|\u2028|\u2029|$))/g,a=/^("(?:[^"]|"")*")(?:\t|(\n|\r\n|\r|\u2028|\u2029|$))/,r=/""/g,o=t.length,s=0;function l(e){if(e<=s)throw new Error("last index "+s+" -> "+e);s=e}return function(){if(s>=o)return null;n.lastIndex=s;var d=n.exec(t);return d&&-1===d[1].indexOf('"')?(l(n.lastIndex),d[1].split("\t")):function(){var n,d,c=[];i.lastIndex=s;do{'"'===(n=i.exec(t))[1][0]&&(d=a.exec(t.slice(s)))&&d[1]&&((n=d)[1]=n[1].slice(1,-1).replace(r,'"'),i.lastIndex=s+n[0].length),c.push(n[1]),l(i.lastIndex)}while(s<o&&e.isUndefined(n[2]));return c}()}},tabDelimit:function(t){return e.map(t,(function(t){return e.map(t,n).join("\t")})).join("\n")}}}.apply(t,i))||(e.exports=a)},3629:(e,t,n)=>{var i,a;i=[n(561),n(3946),n(8094),n(9655)],void 0===(a=function(e,t,n,i){function a(){var t=e(".fd-undo-delete");return!!t.hasClass("in")&&t.length}function r(r){var o,s;r.length&&!a()?(o=t.map(r,(function(e){return e[0]})),s=t.filter(t.map(o,(function(e){return e.isReferencedByOtherMugs(o)?e.p.nodeID:""})),t.identity),e(".fd-undo-container").append(i({errors:s,format:n.format}))):0===r.length&&a()&&e(".fd-undo-delete").remove()}function o(){this.undoStack=[],n.eventuality(this)}return o.prototype={resetUndo:function(e,t,n){this.undoStack=e?[[e,t,n]]:[],r(this.undoStack),this.fire({type:"reset"})},setUndo:function(e){this.undoStack=this.undoStack.concat(e),r(this.undoStack)},undo:function(){t.each(this.undoStack,(function(e){var t=e[0],n=e[1],i=e[2];t.form.insertQuestion(t,n,i,!0)})),this.resetUndo()}},o}.apply(t,i))||(e.exports=a)},7100:(e,t,n)=>{var i,a;i=[n,e,n(3946),n(561),n(2589),n(3184),n(5080),n(3609),n(8793),n(9606),n(1779),n(8125),n(2618),n(4533),n(1877)],void 0===(a=function(e,t,n,i,a,r,o,s,l,d,c,u,f,h){"use strict";var p={image:gettext("Image"),audio:gettext("Audio"),video:gettext("Video"),"video-inline":gettext("Inline Video"),text:gettext("HTML")},g={image:l,audio:d,video:c,"video-inline":c,text:u},m={image:"CommCareImage",audio:"CommCareAudio",video:"CommCareVideo","video-inline":"CommCareVideo",text:"CommCareMultimedia"},v={image:"fd_hqimage",audio:"fd_hqaudio",video:"fd_hqvideo","video-inline":"fd_hqInlineVideo",text:"fd_hqtext"},E=/(\.[^\/.]+)?$/,T=function(e,t,i){var a,r=n.isFunction(e.getItextValue),o=n.isFunction(e.getItextItem),s=r?e.getItextValue():e.getValue();if(!o||r||s||e.isDefaultLang||(s=e.getItextItem().get(e.form,e.defaultLang)),s in t){var l=t[s];a=g[e.form]({url:l.url})}else a=f({iconClass:i[e.form]});return a},C=function(e,t){var n,a=e.getItextValue?e.getItextValue():e.getValue();return(n=i(r({multimediaExists:a in t,uploaderId:v[e.form],mediaType:p[e.form]}))).click((function(){e.mediaRef.updateController(e),e.getUploaderModal().find(".hqm-upload-status").empty(),e.updateModalExistingFile(t)})),n};i.vellum.plugin("uploader",{objectMap:!1,uploadUrls:{image:!1,audio:!1,video:!1,"video-inline":!1,text:!1}},{init:function(){var e=this.opts().uploader,t=e.uploadUrls,n=e.objectMap&&e.uploadUrls&&e.uploadUrls.image;this.data.uploader.uploadEnabled=n,this.data.uploader.objectMap=e.objectMap,n&&(this.data.uploader.uploadControllers={image:this.initUploadController({uploaderSlug:"fd_hqimage",mediaType:"image",uploadUrl:t.image}),audio:this.initUploadController({uploaderSlug:"fd_hqaudio",mediaType:"audio",uploadUrl:t.audio}),video:this.initUploadController({uploaderSlug:"fd_hqvideo",mediaType:"video",uploadUrl:t.video}),"video-inline":this.initUploadController({uploaderSlug:"fd_hqInlineVideo",mediaType:"video-inline",uploadUrl:t.video}),text:this.initUploadController({uploaderSlug:"fd_hqtext",mediaType:"text",uploadUrl:t.text})})},initMediaUploaderWidget:function(e){this.__callOld(),this.data.uploader.uploadEnabled&&function(e,t,a){if(e.mediaRef=function(e,t,i){var a={};return a.mediaType=e,a.updateRef=function(e){a.path=e,a.linkedObj=t[e]},a.isMediaMatched=function(){return n.isObject(a.linkedObj)},a.getUrl=function(){return a.linkedObj?a.linkedObj.url:void 0},a.updateController=function(e){var t=i[a.mediaType];t.currentReference=a,t.updateMediaPath=function(){var n=t.uploadParams;n.path=e.getRandomizedMediaPath(n.path),e.updateReference(n.path)},t.uploadParams={path:a.path,media_type:m[a.mediaType],old_ref:a.isMediaMatched()?a.linkedObj.m_id:"",replace_attachment:!0}},a}(e.form,t,a),!e.getBaseMediaPath)throw new Error("required method not found: widget.getBaseMediaPath()");e.getRandomizedMediaPath=function(t){var n=E.exec(t)[0].toLowerCase()||".xyz",i=Math.random().toString(36).slice(2,8);return e.getBaseMediaPath()+"-"+i+n};var r=e.getItextValue||e.getValue,o=e.getControl(),s=i("<div />"),l=e.getUIElement,d=i("<div />").addClass("fd-mm-preview-container"),c=e.mug.form.vellum.data.javaRosa.ICONS;e.getUploaderModal=function(){return i("#"+v[e.form])},e.updateModalExistingFile=function(t,n){var a=e.mug.form.vellum.data.javaRosa.ICONS,r=e.getUploaderModal(),o=r.find(".hqm-existing");e.mediaRef.getUrl()&&e.mediaRef.isMediaMatched()?(o.removeClass("hide"),o.find(".hqm-existing-controls").html(T(e,t,a)),n&&r.find(".hqm-upload-completed").removeClass("hide")):(o.addClass("hide"),o.find(".hqm-existing-controls").empty()),i(".existing-media").tooltip({placement:"bottom"})},e.getUIElement=function(){var n=(s=l()).find(".controls"),a=i("<div />").addClass("fd-mm-upload-container");return n.empty().addClass("control-row").data("form",e.form),e.updateReference(),d.html(T(e,t,c)),n.append(d),a.html(h()),a.find(".fd-mm-upload-trigger").append(C(e,t)),a.find(".fd-mm-path-input").append(o),a.find(".fd-mm-path-show").click((function(e){i(this).addClass("hide"),a.find(".fd-mm-path").removeClass("hide"),e.preventDefault()})),a.find(".fd-mm-path-hide").click((function(e){i(this).parent().addClass("hide"),a.find(".fd-mm-path-show").removeClass("hide"),e.preventDefault()})),o.on("change keyup",(function(){e.updateMultimediaBlockUI(t)})),s.on("mediaUploadComplete",(function(n,i){e.handleUploadComplete(n,i,t)})),n.append(a),o.on("change keyup",e.updateValue),s},e.handleUploadComplete=function(t,n,i){n.ref&&n.ref.path&&(r()!==n.ref.path&&(e.getControl().val(n.ref.path),e.handleChange()),i[n.ref.path]=n.ref),e.updateMultimediaBlockUI(i),e.updateModalExistingFile(i,!0)},e.updateMultimediaBlockUI=function(t){d.html(T(e,t,c)).find(".existing-media").tooltip(),s.find(".fd-mm-upload-trigger").empty().append(C(e,t)),e.updateReference()},e.updateReference=function(t){var n=t||r();s.attr("data-hqmediapath",n),e.mediaRef.updateRef(n)}}(e,this.data.uploader.objectMap,this.data.uploader.uploadControllers)},initUploadController:function(e){var t=i(a({mediaType:e.mediaType,modalId:e.uploaderSlug}));this.$f.find(".fd-multimedia-modal-container").append(t);var r=!0;t.on("hide.bs.modal",(function(e){r||e.preventDefault()}));var l=t.find(".btn-primary"),d=t.find("input[type='file']"),c=t.find(".hqm-upload-confirm"),u=function(e,t){e?c.removeClass("disabled"):c.addClass("disabled"),t?(c.find(".fa-spin").removeClass("hide"),c.find(".fa-cloud-arrow-up").addClass("hide")):(c.find(".fa-spin").addClass("hide"),c.find(".fa-cloud-arrow-up").removeClass("hide"))};l.click((function(){d.click()})),d.change((function(){var e=t.find(".hqm-upload-status");if(d.get(0).files.length){var n=d.get(0).files[0];e.html(o({file_size:(n.size/1048576).toFixed(3),file_name:n.name})),u(!0,!1)}else e.empty(),u(!1,!1)}));var f={};return c.click((function(){u(!1,!0),r=!1;var a=d.get(0).files[0],o=new FormData;o.append("Filedata",a),f.updateMediaPath();var l="."+a.name.split(".").pop().toLowerCase();f.uploadParams.path=f.uploadParams.path.replace(/(\.[^/.]+)?$/,l),n.each(f.uploadParams,(function(e,t){o.append(t,e)}));var c=t.find(".hqm-upload-status");i.ajax({url:e.uploadUrl,type:"POST",data:o,contentType:!1,processData:!1,enctype:"multipart/form-data",success:function(e){e=JSON.parse(e),i('[data-hqmediapath^="'+e.ref.path.replace(/\.\w+$/,".")+'"]').trigger("mediaUploadComplete",e),c.empty(),u(!1,!1),r=!0},error:function(e){e=JSON.parse(e.responseText),c.find(".hqm-error").show(),c.find(".hqm-errors").html(s({errors:e.errors})),c.find(".hqm-begin").hide(),u(!1,!1),r=!0}})})),f}})}.apply(t,i))||(e.exports=a)},8094:(e,t,n)=>{var i,a;i=[n,n(9339),n(3946),n(9537),n(7903),n(7229),n(561),n(6283)],void 0===(a=function(e,t,i,a,r,o,s){RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};var l={isMac:/Mac/.test(navigator.platform)},d=l.isMac,c={";":";","≠":"=","–":"-","=":"=","-":"-",186:";",187:"=",189:"-"};return l.getKeyChord=function(e){var t=d&&e.metaKey||!d&&e.ctrlKey,n=d&&e.ctrlKey||!d&&e.metaKey,i=String(e.key),a=e.which;return c.hasOwnProperty(a)?i=c[a]:c.hasOwnProperty(i)?i=c[i]:1!==i.length&&"Unidentified"!==i||(i=a>=48&&a<=57||a>=65&&a<=90?String.fromCharCode(a):a>=96&&i<=105?String.fromCharCode(a-48):a),(t?"Ctrl+":"")+(e.altKey?"Alt+":"")+(e.shiftKey?"Shift+":"")+(n?"Meta+":"")+i},l.extend=function(){var e=Array.prototype.slice.call(arguments);return s.extend.apply(null,[!0,{}].concat(e))},l.langCodeToName={},i.each(t,(function(e){var t=e.names[0];l.langCodeToName[e.three]=t,l.langCodeToName[e.two]=t})),l.formatExc=function(e){return e&&e.stack?e+"\n"+e.stack:String(e)},l.validAttributeRegex=/^[^<&'">]*$/,l.invalidAttributeRegex=/[<&'">]/,l.isValidAttributeValue=function(e){return l.validAttributeRegex.test(e)},l.eventuality=function(e){var t={},n={};return e.fire=function(e){var n,i,a,r,o="string"==typeof e?e:e.type;if(t.hasOwnProperty(o))for(n=t[o],r=0;r<n.length;r+=1)"string"==typeof(i=(a=n[r]).method)&&(i=this[i]),i.apply(this,a.parameters||[e]);return this},e.on=function(a,r,o,s,l){arguments.length<5&&(l=null);var d={method:r,parameters:o,context:l};return t.hasOwnProperty(a)?t[a].push(d):t[a]=[d],s&&(n[s]||(n[s]=[]),-1===n[s].indexOf(l)&&(n[s].push(l),e.on(s,(function(){e.unbind(l),n[s]=i.filter(n[s],(function(e){return e!==l}))}),null,null,l))),this},e.unbind=function(e,n){return i.isUndefined(n)?t=i.object(i.map(t,(function(t,n,a){return[n,t=i.filter(t,(function(t){return t.context!==e}))]}))):t.hasOwnProperty(n)&&(t[n]=i.filter(t[n],(function(t){return t.context!==e}))),this},e},l.escape=function(e){return s("<div>").text(e).html()},l.get_guid=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()},l.generate_xmlns_uuid=function(){var e,t,n=[];for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",t=0;t<36;t++)n[t]||(e=Math.floor(16*Math.random()),n[t]="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[19===t?3&e|8:15&e]);return n.toString().replace(/,/g,"")},l.isValidElementName=function(e){return/^(?!XML)[a-zA-Z][\w-]*$/.test(e)},l.createXPathBoolFromJS=function(e){return!0===e||"true"===e?"true()":!1===e||"false"===e?"false()":null},l.getOneOrFail=function(e,t){if(0===e.length)throw l.format(gettext("No match for {info} found!"),{info:t});if(e.length>1)throw l.format(gettext("Multiple matches for {info} found!"),{info:t});return e[0]},l.reduceToOne=function(e,t,n){return l.getOneOrFail(i(e).filter(t),n)},l.getCaretPosition=function(e){var t=0;if(e.createTextRange){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else void 0!==e.selectionStart&&(t=e.selectionStart);return t},l.setCaretPosition=function(e,t,n){if(null==n&&(n=t),e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveStart("character",t),i.moveEnd("character",n),i.select()}},l.insertTextAtCursor=function(e,t,n){var i=e[0],a=l.getCaretPosition(i),r=i.value.substring(0,a),o=i.value.substring(a,i.value.length),s=n?a:a+t.length;e.val(r+t+o).change(),a+=t.length,l.setCaretPosition(i,s,a)},l.parseXML=o.parseXML,l.htmlXMLDiff=function(e,t){function n(e){return(e=e.replace(/^\t+/gm,(function(e){return e.replace(/\t/g,"  ")}))).match(/\n$/)||(e+="\n"),e}e=n(e),t=n(t);const i=new a,r=i.diff_main(e,t);let o=i.diff_prettyHtml(r);return o=o.replaceAll("&para;<br>","<br>"),o},l.markdown=r,l.truncate=function(e,t){return t=t||25,e&&e.length>t?e.slice(0,t)+"&hellip;":e},l.writeHashtags=function(e,t,a,r){if(i.isString(a))if(""===a||r.options&&r.options.ignoreHashtags)e.writeAttributeString(t,a);else{var o,s,l=r.form,d=t.replace(":","__");try{var c=l.xpath.parse(a);o=c.toXPath(),s=c.toHashtag()}catch(e){l.richText?(s=a,o=n(4459).unescapeXPath(a,l)):s=o=a}s!==o?(l.richText&&e.writeAttributeString("vellum:"+d,s),e.writeAttributeString(t,o)):e.writeAttributeString(t,a)}},l.isRightToLeftLanguage=function(e){return i.contains(["ara","arc","div","fas","heb","pus","snd","uig","urd","yid"],e)},l.getReferenceName=function(e){var t=/^#([^\/]+)\//.exec(e);return t?(t=t[1][0].toUpperCase()+t[1].substring(1).toLowerCase())+" Reference":"Form Reference"},l.format=function(e,t){return e.replace(/\{([a-z][\w_]*)\}/gi,(function(e,n){return t.hasOwnProperty(n)?t[n]:e}))},l.checkForFormSubmissions=i.throttle((function(e){e.warnWhenChanged||e.isCurrentlyCheckingForSubmissions||(e.isCurrentlyCheckingForSubmissions=!0,s.ajax({url:e.submissionUrl,type:"GET",dataType:"json",success:function(t){t.form_has_submissions&&(e.warnWhenChanged=!0,e.walkMugs((function(e){e.validate()})))},complete:function(){e.isCurrentlyCheckingForSubmissions=!1}}))}),1e4),l}.apply(t,i))||(e.exports=a)},705:(e,t,n)=>{var i,a;i=[n(1409),n(237),n(918),n(3946),n(561),n(939),n(8094),n(4459),n(3578)],void 0===(a=function(e,t,n,i,a,r,o,s,l){var d=function(e,t){var n={};return t.richText=!0,n.options=t,n.mug=e,n.id=t.id,o.eventuality(n),n.isDisabled=function(){return!!n.path&&(i.isFunction(e.spec[n.path].enabled)?!e.spec[n.path].enabled(e):e.form.vellum.isPropertyLocked(e.hashtagPath,n.path))},n.getDisplayName=function(){return this.definition.lstring?this.definition.lstring:this.path},n.getControl=function(){throw"must be overridden"},n.setValue=function(e){},n.getValue=function(){},n.getHelp=function(){return this.definition&&this.definition.help?{text:this.definition.help,url:this.definition.helpURL}:null},n.refreshMessages=function(){},n.handleChange=function(){n.updateValue(),e.showChangedMsg=!0,n.path&&e.validate(n.path),n.fire("change")},n.updateValue=function(){n.save()},n.save=function(){throw"Not Implemented"},n.getUIElement=function(){return T(n.getControl(),n.getDisplayName(),!!n.isDisabled(),n.getHelp())},n.addInstanceRef=function(t,i){if(!i&&!(i=n.path))throw new Error("widget has no path: "+n);return e.form.addInstanceIfNotExists(t,e,i)},n},c=function(e,t){var n=t.widgetValuePath||t.path,i=t.id||"property-"+n,r=t.disabled||!1,o=d(e,t);return o.mugValue=t.mugValue||function(e,t){if(1===arguments.length)return e.p[n];e.p[n]=t},o.path=n,o.definition=e.p.getDefinition(t.path),o.currentValue=o.mugValue(e),o.id=i,o.saving=!1,o.input=a("<input />").attr("name",i).attr("id",i).prop("disabled",r),o.getControl=function(){return o.input},o.getMessagesContainer=function(){return o.getControl().closest(".widget").find(".messages:last")},o.getMessages=function(e,t){return C(e,t)},o.refreshMessages=function(){var t=o.getMessages(e,n),i=o.getMessagesContainer();i.empty(),t.length?(i.append(t),i.removeClass("hide")):i.addClass("hide")},e.on("messages-changed",(function(){o.refreshMessages()}),null,"teardown-mug-properties"),o.save=function(){o.saving=!0;try{o.mugValue(e,o.getValue())}finally{o.saving=!1}},o},u=function(e,t){var n=c(e,t),i=n.input;return i.attr("type","text").addClass("form-control"),t.placeholder&&i.attr("placeholder",t.placeholder),o.isRightToLeftLanguage(t.language)&&i.attr("dir","rtl"),n.setValue=function(t){t&&(t=t.replace(/\n/g,"&#10;"));var a=o.getCaretPosition(i[0]),r=i.val();t&&n.hasLogicReferences?i.val(e.form.normalizeXPath(t)):i.val(t),i.is(":focus")&&r.length===t.length&&o.setCaretPosition(i[0],a,a)},n.getValue=function(){var t=i.val().replace(/&#10;/g,"\n");return t&&n.hasLogicReferences?e.form.normalizeHashtag(t):t},i.on("change input",(function(){n.handleChange()})),n},f=function(e,t){var n=c(e,t);return n.input=a("<textarea></textarea>").attr("name",n.id).attr("id",n.id).attr("rows","2").addClass("form-control").on("change input",(function(e){n.handleChange()})).keyup((function(e){9===e.which&&this.select()})),o.isRightToLeftLanguage(t.language)&&n.input.attr("dir","rtl"),n.getControl=function(){return n.input},n.setValue=function(e){n.input.val(e)},n.getValue=function(){return n.input.val()},n},h=function(e,t){var n=c(e,t);n.input=a("<div />").attr("contenteditable",!0).attr("name",n.id).addClass("form-control jstree-drop").addClass(t.singleLine?"fd-input":"fd-textarea");var i={isExpression:t.widget===m||t.widget===g,disableNativeSpellChecker:t.disableNativeSpellChecker,rtl:o.isRightToLeftLanguage(t.language)},r=s.editor(n.input,e.form,i);return e.on("teardown-mug-properties",r.destroy,null,"teardown-mug-properties"),r.on("change",(function(){n.handleChange()})),n.input.on("inserted.atwho",(function(e,t,n){a(this).find(".atwho-inserted").children().unwrap()})),n.getControl=function(){return n.input},n.setValue=r.setValue,n.getValue=r.getValue,n},p=function(e,t){return e.form.richText?(t.singleLine=!0,h(e,t)):u(e,t)},g=function(e,t){var n=p(e,t);return n.input.addClass("jstree-drop").attr("placeholder","Drag question here").change((function(){n.handleChange()})),n.hasLogicReferences=!0,n};g.trackLogicReferences=!0;var m=function(e,t){t.disableNativeSpellChecker=!0;var n=p(e,t),i=n.getValue,o=n.setValue;return n.getValue=function(){return a.trim(i())},n.getUIElement=function(){var a,r=n.getControl(),s=T(r,n.getDisplayName(),!!n.isDisabled(),n.getHelp());return r.addClass("jstree-drop"),t.autocompleteChoices&&(a=function(){return t.autocompleteChoices(e)}),E(s,(function(){n.options.displayXPathEditor({leftPlaceholder:t.leftPlaceholder,rightPlaceholder:t.rightPlaceholder,leftAutocompleteChoices:a,value:i(),xpathType:n.definition.xpathType,onLoad:function(e){I(e,n),e.find(".property-name").text(t.lstring||"Expression")},done:function(e){!1!==e&&(o(e),n.handleChange())},mug:e}),l.fbUsage("Logic",t.lstring)}),!!n.isDisabled())},r.autocomplete(n.input,e,{property:t.path,useRichText:e.form.richText}),n.hasLogicReferences=!0,n};m.trackLogicReferences=!0;var v=function(e,t){var n=c(e,t);n.dropdown=n.input=a("<select />").attr("name",n.id).addClass("form-control");var r=n.input;return n.setValue=function(e){var i=n.equivalentOption(e);i?r.val(i.value):t.noCustom?r.prop("selectedIndex",-1):(n.addCustomIfNeeded(e),r.val(e))},n.getValue=function(){return r.val()},n.updateValue=function(){n.save()},r.change((function(){n.handleChange()})),n.addOption=function(e,t){var n=a("<option />").attr("value",e).text(t);this.dropdown.append(n)},n.addOptions=function(e){var t=this;i.forEach(e,(function(e){t.addOption(e.value,e.text)}))},n.clearOptions=function(){this.dropdown.empty()},n.getOptions=function(){return i.map(n.dropdown.find("option"),(function(e){return{value:e.value,text:e.text}}))},n.equivalentOption=function(e){function t(e){try{return JSON.parse(e)}catch(t){return e}}return e=t(e),i.find(n.getOptions(),(function(n){return i.isEqual(t(n.value),e)}))},n.addCustomIfNeeded=function(e){var t=a("[name=property-androidIntentAppId]").find("option").filter((function(){return a(this).text()===gettext("Custom")}));0===t.length?n.addOption(e,gettext("Custom")):t.val(e)},t.defaultOptions&&n.addOptions(t.defaultOptions),n},E=function(e,t,n){var r=e.find("input");i.isUndefined(n)&&(n=!!r&&r.prop("disabled"));var o=a("<button />").addClass("fd-edit-button").html("<i class='fa fa-edit'></i>").stopLink().addClass("btn btn-default btn-block").attr("type","button").prop("disabled",n).click(t),s=a("<div />").addClass("col-sm-1").append(o);return e.css("position","relative"),e.find(".controls").removeClass("col-sm-9").addClass("col-sm-8").after(s),e},T=function(t,n,i,r){var o=a(e({labelText:n,help:r}));return t.find("*").addBack().prop("disabled",!!i),o.find(".controls").prepend(t),r&&!r.url&&o.find(".fd-help a").click((function(e){e.preventDefault()})),o};function C(e,t){var i=a(),r={};return e.messages.each(t,(function(s){if(!r.hasOwnProperty(s.message)){r[s.message]=!0;var l=a(n({msg:s,html:/\n/.test(s.message)?o.markdown(s.message):""}));l.find("button.close").click((function(){e.dropMessage(t,s.key),"mug-nodeID-changed-warning"===s.key&&(e.showChangedMsg=!1)})),i=i.add(l)}})),i}function I(e,t){return e.data("vellum_widget",t),e}return{base:d,normal:c,text:u,multilineText:f,richTextarea:function(e,t){return e.form.richText?(t.singleLine=!1,h(e,t)):f(e,t)},identifier:function(e,t){var n=u(e,t),a=n.updateValue,r=n.handleChange;function o(){var t=e.form.vellum.nodeIDFromLabel(e);n.input.attr("placeholder",t)}return n.updateValue=function(){var e=n.getValue();-1!==e.indexOf(" ")&&n.setValue(e.replace(/\s/g,"_")),""===e&&o(),a()},n._setURLHash=i.debounce((function(e){e.form.vellum._setURLHash(e)}),500),n.handleChange=function(){r(),n._setURLHash(e),e.p.nodeID||e.dropMessage("nodeID","mug-nodeID-error")},e.on("property-changed",(function(t){"conflictedNodeId"!==t.property||n.saving||n.setValue(n.mugValue(e))}),null,"teardown-mug-properties"),e.form.on("question-label-text-change",(function(t){e.p.nodeID||o()}),null,null,n),e.on("teardown-mug-properties",(function(){e.form.unbind(n)}),null,"teardown-mug-properties"),n},droppableText:g,checkbox:function(e,t){var n=c(e,t),i=n.input;return i.attr("type","checkbox"),n.setValue=function(e){i.prop("checked",e)},n.getValue=function(){return i.prop("checked")},i.change((function(){n.handleChange()})),n},dropdown:v,dropdownWithInput:function(e,t){var n=v(e,t),i=n.handleChange;n.input=n.text=a("<input />").addClass("form-control").attr({type:"text",name:n.id+"-text"});var r=a('<div class="control-row row">').append(a("<div class='col-sm-4'>").append(n.dropdown)).append(a("<div class='col-sm-8'>").append(n.text));return n.setValue=function(e){var t=n.equivalentOption(e);n.addCustomIfNeeded(e),t?(n.dropdown.val(t.value),n.text.attr("readonly",!0),n.text.val(t.value)):(n.dropdown.val(e),n.text.attr("readonly",!1),n.text.val(e))},n.getValue=function(){return n.text.val()},n.getControl=function(){return r},n.dropdown.change((function(){var e=n.dropdown.find(":selected");n.text.attr("readonly",e.text()!==gettext("Custom")),n.text.val(e.val()),i()})),n.text.change((function(){var e=n.dropdown.find(":selected");n.text.attr("readonly",!1),e.val(n.text.val()),i()})),n},xPath:m,baseKeyValue:function(e,n){var r=d(e,n),o=n.widgetValuePath||n.path,s=n.id||"property-"+o;function l(){var e={};return i.each(r.kvInput.find(".fd-kv-pair"),(function(t){var n=a(t),r=n.find(".fd-kv-key").val(),o=n.find(".fd-kv-val").val();e.hasOwnProperty(r)?i.isArray(e[r])?e[r].push(o):e[r]=[e[r],o]:e[r]=o})),e}return r.definition=e.p.getDefinition(n.path),n.richText=!1,r.mugValue=n.mugValue||function(e,t){if(1===arguments.length)return e.p[o];e.p[o]=t},r.currentValue=r.mugValue(e),r.kvInput=a('<div class="control-row" />').attr("name",s),r.getControl=function(){return r.isDisabled(),r.kvInput},r.setValue=function(e){r.kvInput.html(t({pairs:i.clone(e)})),r.kvInput.find("input").on("change keyup",(function(){r.handleChange()})),r.kvInput.find(".fd-kv-add-pair").click((function(e){r.refreshControl(),e.preventDefault()})),r.kvInput.find(".fd-kv-remove-pair").click((function(e){a(this).parent().parent().remove(),r.refreshControl(),r.save(),e.preventDefault()}))},r.getValue=function(){return i.omit(l(),"")},r.updateValue=function(){l().hasOwnProperty("")||(r.kvInput.find(".btn").removeClass("hide"),r.kvInput.find(".fd-kv-remove-pair").removeClass("hide")),r.save()},r.refreshControl=function(){r.setValue(r.getValue())},r.save=function(){r.saving=!0;try{r.mugValue(e,r.getValue())}finally{r.saving=!1}},r},readOnlyControl:function(e,t){t.id="readonly-control";var n=d(e,t);return n.definition={},n.currentValue=a("<div>").append(e.p.rawControlXML).clone().html(),n.getControl=function(){return a("<p />").text(this.currentValue)},n},abstractMediaWidget:function(e,t){var n=c(e,t);return n.form="text",n.getValue=function(){return n.input.val()},n.setValue=function(e){return n.input.val(e)},n.getBaseMediaPath=function(){throw new Error("abstract method not implemented: widget.getBaseMediaPath()")},n.mug.form.vellum.initMediaUploaderWidget(n),n},util:{getWidget:function(e,t){for(var n,i=e;i&&i.length;){if((n=i.data("vellum_widget"))&&(!t||t===i.vellum("get")))return n;i=i.parent()}return null},setWidget:I,getMessages:C,getUIElementWithEditButton:E,getUIElement:T}}}.apply(t,i))||(e.exports=a)},8922:(e,t,n)=>{var i,a;i=[n(561),n(1877),n(6283)],void 0===(a=function(e){function t(t){t.on("DOMMouseScroll mousewheel",(function(t){var n=e(this),i=this.scrollTop,a=this.scrollHeight,r=n.height(),o=t.originalEvent.wheelDelta,s=o>0,l=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};return!s&&-o>a-r-i?(n.scrollTop(a),l()):s&&o>i?(n.scrollTop(0),l()):void 0}))}function n(t,n,i){var a,r,o,s;t.hasClass("fd-content-vertical-divider")?(o=n.offset().left<t.offset().left,a="pageX",r="width",s="col-resize"):(o=n.offset().top<t.offset().top,a="pageY",r="height",s="row-resize");var l=o?1:-1;t.mousedown((function(t){var o=n.data("min-size")||0,s=n[r](),d=function(e){var d=e[a]-t[a];n[r](Math.max(s+d*l,o)),n.resize(),i()};e(window).disableSelection().on("mousemove",d).one("mouseup",(function(){e(this).enableSelection(),e(this).off("mousemove",d)}))})).hover((function(e){e.target.style.cursor=s}))}return e.vellum.plugin("windowManager",{minHeight:200,bottomOffset:0},{init:function(){var i=this,a=this.opts().windowManager,r=function(){i.adjustToWindow()};t(this.$f.find(".fd-scrollable")),n(this.$f.find(".fd-content-divider"),this.$f.find(".fd-content-left"),r),n(this.$f.find(".fd-content-left-divider"),this.$f.find(".fd-accessory-pane"),r),this.data.windowManager.offset={top:a.topOffset||this.$f.offset().top-1,bottom:a.bottomOffset||0,left:a.leftOffset||this.$f.offset().left},this.data.windowManager.fullscreen=a.fullscreen,this.data.windowManager.adjustToWindow=r,e(window).resize(r),e(document).scroll(r),e(r),i.adjustToWindow()},adjustToWindow:function(){if(this.$f.is(":visible")){var t,n=e(window).height()-this.getCurrentTopOffset(),i=0===this.getCurrentTopOffset()?"fixed":"static",a=this.$f.find(".fd-ui-container");this.data.windowManager.fullscreen?(a.parent().css({height:null,width:null}),a.css({height:null,width:null}),a.addClass("full-screen"),e("body").addClass("vellum-full-screen"),a.parent().css({top:0,bottom:0,left:0,right:0,backgroundColor:"white"}),a.css("width",e(window).width())):(a.removeClass("full-screen"),e("body").removeClass("vellum-full-screen"),a.parent().css({top:"",bottom:"",left:"",right:"",backgroundColor:"white"}),a.css("width",a.parent().width())),a.parent().css("height",n+"px"),n-=this.getCurrentBottomOffset(),a.css("height",n+"px"),a.css("position",i).css("left",this.getCurrentLeftOffset()+"px"),t=a.width();var r=Math.max(n,this.opts().windowManager.minHeight),o=r,s=r-this.$f.find(".fd-head").outerHeight(!1),l=this.$f.find(".fd-accessory-pane");a.find(".fd-content").css("height",r+"px");var d=a.find(".fd-content-left .fd-tree");if(d.children(":not(.fd-scrollable)").each((function(t,n){o-=e(n).outerHeight(!1)})),l.children().length){var c=l.outerHeight(!1),u=c-l.find(".fd-head").outerHeight(!0);o-=2+c+this.$f.find(".fd-content-left-divider").outerHeight(!0),l.find(".fd-scrollable").css("height",u+"px"),l.show(),this.$f.find(".fd-content-left-divider").show()}else l.hide(),this.$f.find(".fd-content-left-divider").hide();d.find(".fd-scrollable").css("height",o+"px"),d.find(".fd-scrollable-minimal").css("max-height",o+"px"),a.find(".fd-content-right").css("width",t-this.getLeftWidth()+"px").find(".fd-scrollable.full").css("height",s+"px"),a.find(".fd-props-scrollable").css("height",s-a.find(".fd-props-toolbar").outerHeight(!0)-a.find(".fd-form-actions").outerHeight(!1)+"px")}},getLeftWidth:function(){return 2+this.$f.find(".fd-content-left").outerWidth(!1)+this.$f.find(".fd-content-divider").outerWidth(!0)},getCurrentTopOffset:function(){if(this.data.windowManager.fullscreen)return 0;var t=e(window).scrollTop(),n=this.data.windowManager.offset,i="function"==typeof n.top?n.top():n.top;return Math.min(Math.max(i-t,0),i)},getCurrentBottomOffset:function(){if(this.data.windowManager.fullscreen)return 0;var e=this.data.windowManager.offset;return"function"==typeof e.bottom?e.bottom():e.bottom},getCurrentLeftOffset:function(){if(this.data.windowManager.fullscreen)return 0;var t=e(window).scrollLeft(),n=this.data.windowManager.offset,i="function"==typeof n.left?n.left():n.left;return Math.min(i-t,i)}}),{preventDoubleScrolling:t}}.apply(t,i))||(e.exports=a)},7229:(e,t,n)=>{var i,a;i=[n(561),n(3946)],void 0===(a=function(e,t){function n(t,n=!1){var i=a(t||""),r=document.implementation.createHTMLDocument().createElement("div");return n?e(r).append(i):e(r).html(i)}function i(i,r){if(!i)return"";if(t.isString(i)){if(!/[<>&]/.test(i))return i;i=function(e){return e.replace(/<(([\w:.-]+)(?:\s[^<]*?|))\/>/g,"<$1></$2>")}(a(i)),i=r?e(i):n(i,!0)}var o=new XMLSerializer,s=i[0];void 0===s&&(s=i);var l=o.serializeToString(s);return l.startsWith("<output")&&(l="<div>"+l+"</div>"),l.replace(/ xmlns="http:\/\/www.w3.org\/1999\/xhtml"/g,"").replace(/^<([\w:.-]+)(?:\s+[\w:.-]+=(["'])[^]*?\2)*\s*(?:\/>|>([^]*)<\/\1>)$/g,"$3").replace(/(<([\w:.-]+)(?:\s[^>]*|))><\/\2>/g,"$1 />").replace(/(<(output)(?:\s[^>]*|))>([\w\W]+)<\/output>/g,"$1 />$3").replace(/&nbsp;|\xa0/g," ").replace(/ xmlns:vellum="http:\/\/commcarehq.org\/xforms\/vellum"([ \/>])/g,"$1")}function a(e){return e.replace(/<(([\w:.-]+)(?:\s[^>]*|))\/>/g,"<$1></$2>")}return{humanize:function(e,n){return e?t.isString(e)&&-1===e.indexOf("&")&&!/<([\w:.-]+)(?:\s[^>]*|)><\/\1>/.test(e)?e:i(e,n).replace(/(?:&lt;(=?\s)|(\s)&gt;|&amp;([^&;\s]+;|.|$))/g,(function(e,t,n,i){return t?"<"+t:n?n+">":";"===i.slice(i.length-1)?e:"&"+i})):""},normalize:i,parseXML:function(t){return t?(t=t.replace(/<(h:)?html\b/,"<h:xdoc").replace(/<\/(h:)?html\b>/,"</h:xdoc>"),e(e.parseXML(t))):e()},query:function(t){var n,i='<xml xmlns="http://www.w3.org/1999/xhtml" xmlns:vellum="http://commcarehq.org/xforms/vellum">'+(t=a(t))+"</xml>";try{n=e(e.parseXML(i))}catch(i){n=e("<xml></xml>").html(t)}return n.toString=function(){return(new XMLSerializer).serializeToString(n[0]).replace(/^<xml\b[^>]*>/,"").replace(/<\/xml>$/,"").replace(/(<([\w:.-]+)(?:\s[^>]*|))><\/\2>/g,"$1 />").replace(/(<(output)(?:\s[^>]*|))>([\w\W]+)<\/output>/g,"$1 />$3").replace(/"\/>/g,'" />').replace(/&nbsp;|\xa0/g," ")},n},xhtml:n}}.apply(t,i))||(e.exports=a)},7867:(e,t,n)=>{var i,a;i=[n(3946),n(2776)],void 0===(a=function(e,t){return{makeXPathModels:function(e,n){return n=n||function(e){return e},t.makeXPathModels(n({isValidNamespace:function(t){return e.hashtagNamespaces.hasOwnProperty(t)},hashtagToXPath:function(t){var n=e.hashtagMap[t];if(n)return n;var i=t.lastIndexOf("/");if(-1!==i){var a=t.substring(0,i+1),r=t.substring(i+1);if(e.hashtagTransformations.hasOwnProperty(a))return e.hashtagTransformations[a](r)}return t},toHashtag:function(t){var n=t.toXPath();return e.invertedHashtagMap.hasOwnProperty(n)?e.invertedHashtagMap[n]:null}}))},createParser:function(e){var n=new t.Parser;return n.yy.xpathmodels=e,n.models=n.yy.xpathmodels,n},parser:function(e,t){var n=this.makeXPathModels(e,t);return this.createParser(n)}}}.apply(t,i))||(e.exports=a)},8819:e=>{"use strict";e.exports="data:image/gif;base64,R0lGODlhCwAHAIAAACgoKP///yH5BAEAAAEALAAAAAALAAcAAAINjI+AC7rWHIsPtmoxLAA7"},8612:e=>{"use strict";e.exports="data:image/gif;base64,R0lGODlhCwAHAIAAACgoKP///yH5BAEAAAEALAAAAAALAAcAAAIORI4JlrqN1oMSnmmZDQUAOw=="},4095:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAMAAAB/qqA+AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMNAMM9s3UAAAAXSURBVHjajcEBAQAAAIKg/H/aCQZ70AUBjAATb6YPDgAAAABJRU5ErkJggg=="},2466:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAACAQMAAABv1h6PAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjAAMHBgAAiABBI4gz9AAAAABJRU5ErkJggg=="},1037:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAACAQMAAAB49I5GAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjAAMOBgAAGAAJMwQHdQAAAABJRU5ErkJggg=="},7475:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAACAQMAAAAD0EyKAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjgIIGBgABCgCBvVLXcAAAAABJRU5ErkJggg=="},3010:e=>{"use strict";e.exports="data:image/svg+xml;utf8,<svg xmlns=%27http://www.w3.org/2000/svg%27><filter id=%27jstree-grayscale%27><feColorMatrix type=%27matrix%27 values=%270.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0%27/></filter></svg>#jstree-grayscale"},477:()=>{}}]);