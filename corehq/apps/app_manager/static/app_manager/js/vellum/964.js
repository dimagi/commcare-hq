(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[964],{9848:(e,t,n)=>{var a=n(10561),i={init:function(e){var t={disabled:!1,csrftoken:e.csrftoken,$save:a("<span/>").text(i.message.SAVE).click((function(e){t.fire("save",e)})).addClass("btn btn-info"),$retry:a("<span/>").text(i.message.RETRY).click((function(e){t.fire("save",e)})).addClass("btn btn-info"),$saving:a("<span/>").text(i.message.SAVING).prepend('<i class="fa fa-refresh icon-spin"></i> ').addClass("btn btn-info disabled"),$saved:a("<span/>").text(i.message.SAVED).addClass("btn btn-info disabled"),ui:a("<div/>").addClass("pull-right"),setStateWhenReady:function(e){"saving"===this.state?this.nextState=e:this.setState(e)},setState:function(e){this.state!==e&&(this.state=e,this.$save.detach(),this.$saving.detach(),this.$saved.detach(),this.$retry.detach(),"save"===e?this.ui.append(this.$save):"saving"===e?this.ui.append(this.$saving):"saved"===e?this.ui.append(this.$saved):"retry"===e&&this.ui.append(this.$retry),this.fire("state:change"))},ajaxOptions:function(e){var t=(e=e||{}).beforeSend||function(){},n=e.success||function(){},a=e.error||function(){},r=this;return e.beforeSend=function(e){r.csrftoken&&!this.crossDomain&&e.setRequestHeader("X-CSRFToken",r.csrftoken),r.setState("saving"),r.nextState="saved",t.apply(this,arguments)},e.success=function(e){r.setState(r.nextState),n.apply(this,arguments)},e.error=function(e){r.nextState=null,r.setState("retry"),alert(i.message.ERROR_SAVING),a.apply(this,arguments)},e},ajax:function(e){if("function"==typeof(e=t.ajaxOptions(e)).url){e.beforeSend();var n=e.url(e.data);e.success(n||{})}else a.ajax(e)},beforeunload:function(){var n="html"==t.ui.parents()[t.ui.parents().length-1].tagName.toLowerCase();if("saved"!==t.state&&n)return e.unsavedMessage||""}};return r(t),t.setState("saved"),t.on("change",(function(){this.setStateWhenReady("save")})),t.on("disable",(function(){this.disabled=!0,this.$save.addClass("disabled"),this.$saving.addClass("disabled"),this.$retry.addClass("disabled")})),t.on("enable",(function(){this.disabled=!1,this.$save.removeClass("disabled"),this.$saving.removeClass("disabled"),this.$retry.removeClass("disabled")})),t.on("save",(function(n){if(!t.disabled)if(e.save)e.save(n);else if(e.saveRequest){var a=t.ajaxOptions();a.beforeSend(),e.saveRequest(n).success(a.success).error(a.error)}})),t},initForm:function(e,t){var n=e.attr("action"),a=i.init({unsavedMessage:t.unsavedMessage,save:function(){a.ajax({url:n,type:"POST",dataType:"json",data:e.serialize(),success:t.success})}}),r=function(){a.fire("change")};return e.find("*").change(r),e.find("input, textarea").bind("textchange",r),a},message:{SAVE:"Save",SAVING:"Saving",SAVED:"Saved",RETRY:"Try Again",ERROR_SAVING:"There was an error saving"}},r=function(e){"use strict";var t={};return e.on=function(n,a){return void 0===t[n]&&(t[n]=[]),t[n].push(a),e},e.fire=function(n,a){var i;if(void 0!==t[n])for(i=0;i<t[n].length;i+=1)t[n][i].apply(e,[a]);return e},e};t.init=i.init},75311:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(31601),i=n.n(a),r=n(76314),o=n.n(r)()(i());o.push([e.id,'.clearfix {\n  *zoom: 1;\n}\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: "";\n  line-height: 0;\n}\n.clearfix:after {\n  clear: both;\n}\n.hide-text {\n  font: 0/0 a;\n  color: transparent;\n  text-shadow: none;\n  background-color: transparent;\n  border: 0;\n}\n.input-block-level {\n  display: block;\n  width: 100%;\n  min-height: 30px;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n}\n.atwho-view ul {\n  overflow: hidden;\n}\n.atwho-jrtext {\n  padding-left: 1em;\n  color: gray;\n}\n.cur > .atwho-jrtext {\n  padding-left: 1em;\n  color: white;\n}\n.dropdown-menu a > i {\n  display: inline-block;\n  width: 16px;\n}\n.checklist i.fa-check {\n  display: none;\n  width: auto;\n}\n.checklist .selected i.fa-check {\n  display: inline-block;\n  margin-left: -14px;\n  margin-right: 2px;\n}\n.dropdown-submenu {\n  position: relative;\n}\n.dropdown-submenu > a:after {\n  display: block;\n  content: " ";\n  float: right;\n  width: 0;\n  height: 0;\n  border-color: transparent transparent transparent #ccc;\n  border-style: solid;\n  border-width: 5px 0 5px 5px;\n  margin-top: 5px;\n  margin-right: -10px;\n}\n.dropdown-submenu > .dropdown-menu {\n  top: 0;\n  left: 100%;\n  margin-top: -6px;\n  margin-left: -1px;\n  border-radius: 0 6px 6px 6px;\n}\n.dropdown-submenu:hover > .dropdown-menu {\n  display: block;\n}\n.dropdown-submenu:hover > a:after {\n  border-left-color: #fff;\n}\n.fd-input {\n  -moz-appearance: textfield;\n  -webkit-appearance: textfield;\n  border: 1px solid #cccccc;\n  border-radius: 4px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -webkit-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -moz-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -o-transition: border linear 0.2s, box-shadow linear 0.2s;\n  transition: border linear 0.2s, box-shadow linear 0.2s;\n  height: 28px;\n  padding: 6px 12px;\n  font-size: 12px;\n  background: #ffffff;\n  vertical-align: middle;\n  color: #555555;\n  white-space: nowrap;\n  overflow: hidden;\n}\n.fd-input:focus {\n  border-color: rgba(82, 168, 236, 0.8);\n  outline: 0;\n  outline: thin dotted \\9;\n  /* IE6-9 */\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n}\n.fd-textarea {\n  -moz-appearance: textfield;\n  -webkit-appearance: textfield;\n  border: 1px solid #cccccc;\n  border-radius: 4px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -webkit-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -moz-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -o-transition: border linear 0.2s, box-shadow linear 0.2s;\n  transition: border linear 0.2s, box-shadow linear 0.2s;\n  height: 28px;\n  padding: 6px 12px;\n  font-size: 12px;\n  background: #ffffff;\n  vertical-align: middle;\n  color: #555555;\n  white-space: nowrap;\n  overflow: hidden;\n  -moz-appearance: textfield-multiline;\n  min-height: 4em;\n  height: 4.5em;\n  overflow: auto;\n  resize: both;\n  white-space: normal;\n  word-break: break-word;\n}\n.fd-textarea:focus {\n  border-color: rgba(82, 168, 236, 0.8);\n  outline: 0;\n  outline: thin dotted \\9;\n  /* IE6-9 */\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n}\n.fd-textarea.fd-xpath-editor-text {\n  height: 13em;\n  font-family: monospace;\n}\n.fd-search {\n  background-color: #f2f2f1;\n  margin-bottom: 5px;\n}\n.fd-search > .form-inline {\n  position: relative;\n  padding: 0px 12px;\n}\n.fd-search > .form-inline i {\n  line-height: 42px;\n}\n.fd-search .control-label {\n  padding-top: 0px;\n}\n.fd-search .fd-search-control {\n  position: absolute;\n  top: 5px;\n  margin-left: 18px;\n  width: 100%;\n}\n.fd-commander {\n  background-color: #f2f2f1;\n  padding: 5px;\n  display: flex;\n  align-items: center;\n}\n.fd-commander input {\n  border: 1px solid #d6d6d4;\n  height: 19px;\n  width: calc(100% - 15px);\n}\n.fd-commander .fd-commander-close {\n  background: none;\n  border: none;\n  color: #373534;\n  position: absolute;\n  right: 8px;\n  cursor: pointer;\n}\n.jstree-drop-active {\n  border: 2px solid #004ebc !important;\n  background: rgba(188, 222, 255, 0.3);\n  box-shadow: 0 0 8px 2px rgba(0, 78, 188, 0.4);\n  transition: box-shadow 0.2s, border 0.2s, background 0.2s;\n}\n.label-datanode {\n  text-shadow: none;\n  line-height: 16px;\n  padding: 0 2px;\n  margin: 0px 2px;\n  margin-bottom: 2px;\n  font-size: 12px;\n  border: 1px solid;\n  vertical-align: middle;\n  font-weight: 400;\n}\n.label-datanode:hover {\n  cursor: pointer;\n  color: #ffffff;\n}\n.label-datanode .close {\n  color: #00799a;\n  opacity: 0.4;\n  font-weight: 500;\n  line-height: 13px;\n  font-size: 18px;\n  padding: 0 5px;\n  padding-bottom: 3px;\n  margin-right: -3px;\n}\n.label-datanode .close:hover {\n  opacity: 0.9;\n}\n.label-datanode .fcc {\n  padding: 0 3px;\n  font-size: 0.8em;\n}\n.label-datanode-internal {\n  color: #00799a;\n  border-color: #88d0d2;\n  background-color: #d2edee;\n}\n.label-datanode-internal .close {\n  color: #00799a;\n}\n.label-datanode-internal:hover {\n  background-color: #1ea2a7;\n  border-color: #1a8d92;\n}\n.label-datanode-internal:hover .close {\n  color: #d2edee;\n}\n.label-datanode-external {\n  color: #373534;\n  border-color: #c1c1bc;\n  background-color: #e6e6e4;\n}\n.label-datanode-external .close {\n  color: #373534;\n}\n.label-datanode-external:hover {\n  background-color: #685c53;\n}\n.label-datanode-external:hover .close {\n  color: #d6d6d4;\n}\n.label-datanode-external-unknown {\n  color: #685300;\n  border-color: #eed161;\n  background-color: #f6e5a6;\n}\n.label-datanode-external-unknown .close {\n  color: #685300;\n}\n.label-datanode-external-unknown:hover {\n  background-color: #f9c700;\n}\n.label-datanode-external-unknown:hover .close {\n  color: #f8ecbd;\n}\n.label-datanode-unknown {\n  color: #812627;\n  border-color: #c6948e;\n  background-color: #e8d4d2;\n}\n.label-datanode-unknown .close {\n  color: #812627;\n}\n.label-datanode-unknown:hover {\n  background-color: #e53e30;\n}\n.label-datanode-unknown:hover .close {\n  color: #efcfcb;\n}\n.datanode-tree-bubble {\n  font-size: 11px;\n  color: #ffffff;\n  line-height: 18px;\n  display: inline-block;\n  padding: 0px 5px;\n  border-radius: 3px;\n}\n.datanode-tree-bubble .fcc {\n  font-size: 9px;\n}\n.datanode-tree-bubble-internal {\n  color: #00799a;\n  background-color: #ccf3f4;\n}\n.datanode-tree-bubble-external {\n  color: #373534;\n  background-color: #f2f2f1;\n}\n.datanode-tree-bubble-internal.on {\n  background-color: #00bdc5;\n  color: #ffffff;\n}\n.datanode-tree-bubble-external.on {\n  background-color: #685c53;\n  color: #ffffff;\n}\n.cke_widget_wrapper:hover > .label-datanode {\n  outline: none !important;\n  -webkit-box-shadow: 0px 0px 8px #004ebc;\n  -moz-box-shadow: 0px 0px 8px #004ebc;\n  box-shadow: 0px 0px 8px #004ebc;\n}\n.cke_widget_focused .label-datanode {\n  outline: none !important;\n  -webkit-box-shadow: 0px 0px 8px #002c5f;\n  -moz-box-shadow: 0px 0px 8px #002c5f;\n  box-shadow: 0px 0px 8px #002c5f;\n  border-color: #0073f8;\n}\n.cke_widget_drag_handler_container {\n  top: -2px !important;\n  background: transparent !important;\n}\n.cke_widget_drag_handler {\n  width: 100% !important;\n  height: 100% !important;\n}\n.itext-block-container.has-markdown .markdown-group {\n  display: block !important;\n}\n.itext-block-container.has-markdown .turn-markdown-off,\n.itext-block-container.has-markdown .markdown-output:not(:empty),\n.itext-block-container.has-markdown .fd-help {\n  display: inline-block !important;\n}\n.itext-block-container.has-markdown .turn-markdown-on {\n  display: none !important;\n}\n.itext-block-container:not(.has-markdown) .markdown-group,\n.itext-block-container:not(.has-markdown) .turn-markdown-off,\n.itext-block-container:not(.has-markdown) .markdown-output {\n  display: none !important;\n}\n.itext-block-container:not(.has-markdown) .turn-markdown-on,\n.itext-block-container:not(.has-markdown) .fd-help {\n  display: inline-block !important;\n}\n.itext-block-container.markdown-ignorant .turn-markdown-off,\n.itext-block-container.markdown-ignorant .turn-markdown-on,\n.itext-block-container.markdown-ignorant .markdown-output,\n.itext-block-container.markdown-ignorant .fd-help {\n  display: none !important;\n}\n.markdown-output {\n  width: 100%;\n  margin: 0;\n}\n.markdown-output table {\n  padding: 0;\n}\n.markdown-output table tr {\n  border-top: 1px solid #cccccc;\n  background-color: white;\n  margin: 0;\n  padding: 0;\n}\n.markdown-output table tr th {\n  font-weight: bold;\n  border: 1px solid #cccccc;\n  text-align: left;\n  margin: 0;\n  padding: 6px 13px;\n}\n.markdown-output table tr th:first-child {\n  margin-top: 0;\n}\n.markdown-output table tr th:last-child {\n  margin-bottom: 0;\n}\n.markdown-output table tr td {\n  border: 1px solid #cccccc;\n  text-align: left;\n  margin: 0;\n  padding: 6px 13px;\n}\n.markdown-output table tr td:first-child {\n  margin-top: 0;\n}\n.markdown-output table tr td:last-child {\n  margin-bottom: 0;\n}\n.markdown-output table tr:nth-child(2n) {\n  background-color: #f8f8f8;\n}\n.fd-valid-alert-icon {\n  color: #d83a2e;\n}\n.fd-form-saving {\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  opacity: 0.8;\n  background-color: #000;\n  z-index: 2000;\n}\n.fd-form-saving > div {\n  opacity: 1;\n  position: fixed;\n  top: calc(50% -  32px / 2);\n  left: calc(50% -  32px / 2);\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  width: 32px;\n  height: 32px;\n  -webkit-border-radius: 4px;\n  -moz-border-radius: 4px;\n  border-radius: 4px;\n  background-color: #fff;\n  font-size: 22px;\n  text-align: center;\n}\n.fd-full-screen-modal .modal-dialog {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  margin: 0;\n  width: auto;\n}\n.fd-full-screen-modal .modal-dialog .modal-content {\n  position: absolute;\n  top: 20px;\n  bottom: 20px;\n  left: 20px;\n  right: 20px;\n}\n.fd-full-screen-modal .modal-dialog .modal-content .modal-body {\n  overflow-y: auto;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container {\n  text-align: center;\n  width: 115px;\n  float: left;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container img,\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref {\n  border: 1px solid #eee;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container img {\n  padding: 0.5em;\n  background-color: #fff;\n  margin-bottom: 10px;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref {\n  color: #999;\n  background-color: #fff;\n  padding: 10px;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref i {\n  display: block;\n  font-size: 56px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container {\n  margin-left: 125px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container > .control-row {\n  margin: 0px 0px 10px 0;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container > .control-row:first-child {\n  height: 25px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container .fd-mm-path-input {\n  margin-right: 92px;\n}\n.rich-text-popover {\n  -webkit-border-radius: 3px;\n  -moz-border-radius: 3px;\n  border-radius: 3px;\n  word-wrap: break-word;\n  min-width: 236px;\n  max-width: 276px;\n}\n.rich-text-popover .popover-title h3 {\n  font-weight: 600;\n  font-size: 14px;\n  margin: 0;\n}\n.rich-text-popover .popover-title .text-muted {\n  margin-top: 5px;\n  line-height: 1.3em;\n}\n.rich-text-popover.top,\n.rich-text-popover.right,\n.rich-text-popover.bottom,\n.rich-text-popover.left {\n  margin: 0;\n}\n.rich-text-popover.bottom {\n  margin-top: 5px;\n}\n.rich-text-popover.top {\n  margin-bottom: -10px;\n}\n.rich-text-popover.right {\n  margin-left: 5px;\n}\n.rich-text-popover .arrow,\n.rich-text-popover .arrow:after {\n  display: none;\n}\n.popover-content .alert {\n  margin-bottom: 0;\n}\n.formdesigner .fd-ui-container .fd-props-toolbar {\n  margin-bottom: 5px;\n  border-bottom: 1px solid #F4F4F4;\n  padding: 12px;\n}\n.formdesigner .fd-ui-container .fd-props-toolbar .fd-question-comment {\n  margin-top: 10px;\n  white-space: pre-line;\n}\n.formdesigner .fd-ui-container .fd-props-content {\n  padding: 0 12px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-help {\n  width: 25px;\n  font-size: 21px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-help a:hover {\n  text-decoration: none;\n  color: #46a546;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-copy-paste-help .row {\n  padding: 0 2em;\n  margin-bottom: 2em;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-copy-paste-help .copy-paste-box textarea {\n  width: 100%;\n  height: 100px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset {\n  position: relative;\n  min-width: 0px;\n  /* for chrome */\n  display: table-column;\n  /* for firefox */\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset:first-child {\n  margin-top: 20px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset:first-child legend {\n  display: none;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset legend {\n  min-height: 30px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset legend .fd-help {\n  right: 0;\n  top: 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .control-label .fd-help {\n  position: relative;\n  top: -8px;\n  height: 15px;\n  display: inline-block;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .control-label label {\n  vertical-align: top;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .messages .alert {\n  margin: 10px 0 0 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .itext-block-container .btn-danger {\n  margin: 10px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-itextID-checkbox-container {\n  width: 55px;\n  padding: 0 5px;\n  background-color: #f1f9f1;\n  -webkit-border-radius: 5px;\n  -moz-border-radius: 5px;\n  border-radius: 5px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv {\n  margin-bottom: 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv .fd-kv-arrow {\n  text-align: center;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv .fd-kv-arrow i {\n  margin-top: 8px;\n}\nbody.vellum-full-screen {\n  overflow-y: hidden;\n}\n.formdesigner .fd-ui-container {\n  top: 0;\n  width: 100%;\n  background-color: white;\n}\n.formdesigner .fd-ui-container.full-screen {\n  z-index: 1031;\n}\n.formdesigner .fd-ui-container .fd-content {\n  float: left;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left {\n  width: 30%;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left .fd-add-question {\n  max-width: 140px;\n  width: 90%;\n  margin: 10px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left .fd-accessory-pane {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-head {\n  height: 31px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-head h2 {\n  line-height: 30px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .well {\n  padding: 10px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .well .col-sm-1 {\n  padding: 0;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-form-actions {\n  background-color: #004ebc !important;\n  padding: 5px 8px 8px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-default-panel {\n  padding-left: 12px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head {\n  color: #fff;\n  background-color: #002c5f;\n  font-size: 17px;\n  height: 25px;\n  position: relative;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-max-indicator {\n  position: absolute;\n  right: 10px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-max-indicator i {\n  color: #d6d6d4;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head:hover .fd-head-max-indicator i {\n  color: #fff;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head > h2 {\n  font-size: 12.6px;\n  padding: 1px 12px 0;\n  margin: 0;\n  font-weight: normal;\n  line-height: 23px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  position: absolute;\n  left: 0;\n  right: 38px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container {\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  line-height: 23px;\n  font-size: 12.6px;\n  min-width: 50px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-toggle {\n  color: #fff;\n  cursor: pointer;\n  display: block;\n  padding: 0 12px;\n  text-decoration: none;\n  background-color: #002c5f;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-toggle:hover {\n  text-decoration: none;\n  background-color: #004ebc;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-menu a {\n  min-width: 170px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-menu a > .hotkey {\n  float: right;\n}\n.formdesigner .fd-ui-container .fd-content-vertical-divider {\n  width: 5px;\n  background: #004ebc;\n}\n.formdesigner .fd-ui-container .fd-content-horizontal-divider {\n  height: 10px;\n  margin: 1px 0;\n  background: #F4F4F4;\n  text-align: center;\n  font-size: 16px;\n  color: #777;\n  position: relative;\n}\n.formdesigner .fd-ui-container .fd-content-horizontal-divider i {\n  display: inline-block;\n  position: absolute;\n}\n.formdesigner .fd-ui-container .fd-messages {\n  position: fixed;\n  bottom: 40px;\n  left: 0;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-messages .alert {\n  -webkit-box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  -moz-box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  margin: 20px;\n  height: auto;\n  overflow: auto;\n  max-height: 200px;\n}\n.formdesigner .fd-ui-container .fd-scrollable,\n.formdesigner .fd-ui-container .fd-scrollable-minimal {\n  overflow-x: hidden;\n  overflow-y: auto;\n  transform: translate3d(0, 0, 0);\n}\n.formdesigner .fd-ui-container .fd-scrollable {\n  height: 606px;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-scrollable-minimal {\n  max-height: 606px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor {\n  color: #37475d;\n  line-height: 27px;\n  height: 26px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-hovered,\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-clicked {\n  border: none;\n  background: #eaeff5;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-clicked {\n  -webkit-box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n  -moz-box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n  box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor > .jstree-icon,\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:before {\n  background: none;\n  font-size: 0.85em;\n  color: #004ebc;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice {\n  display: block;\n  margin-left: 50px;\n  cursor: pointer;\n  padding: 0 5px;\n  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n  line-height: 24px;\n  height: 24px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:before {\n  margin-right: 6px;\n  font: normal normal normal 14px/1 FontAwesome;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:hover {\n  border: none;\n  background-color: #eaeff5;\n  width: 95px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node.jstree-closed .add_choice {\n  display: none;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .fd-valid-alert-icon {\n  margin-right: 3px;\n  margin-left: -3px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head {\n  height: 46px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head h2 {\n  line-height: 46px;\n  font-size: 14px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head .fd-head-menu-container {\n  line-height: 46px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-scrollable {\n  overflow-x: auto;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-scrollable .jstree {\n  margin: 5px 0;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-undo-delete {\n  margin-bottom: 0px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-head.fd-head-external-sources {\n  cursor: pointer;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-head.fd-head-external-sources h2 {\n  font-size: 12px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search {\n  background-color: #f2f2f1;\n  margin-bottom: 5px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search > form {\n  position: relative;\n  padding: 0px 12px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search > form i {\n  line-height: 42px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search .fd-search-control {\n  position: absolute;\n  top: 5px;\n  margin-left: 18px;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor {\n  color: #373534;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor.jstree-clicked {\n  background-color: #f2f2f1;\n  -webkit-box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n  -moz-box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n  box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor > .jstree-icon {\n  color: #685c53;\n}\n.formdesigner .fd-ui-container .fd-undo-delete p {\n  margin-top: 1em;\n}\n#jstree-dnd {\n  max-width: 300px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n',""]);const s=o},70426:function(e){function t(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var n=-1;t.Diff,t.prototype.diff_main=function(e,t,n,a){void 0===a&&(a=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=a;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[0,e]]:[];void 0===n&&(n=!0);var r=n,o=this.diff_commonPrefix(e,t),s=e.substring(0,o);e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var l=e.substring(e.length-o);e=e.substring(0,e.length-o),t=t.substring(0,t.length-o);var d=this.diff_compute_(e,t,r,i);return s&&d.unshift([0,s]),l&&d.push([0,l]),this.diff_cleanupMerge(d),d},t.prototype.diff_compute_=function(e,t,a,i){var r;if(!e)return[[1,t]];if(!t)return[[n,e]];var o=e.length>t.length?e:t,s=e.length>t.length?t:e,l=o.indexOf(s);if(-1!=l)return r=[[1,o.substring(0,l)],[0,s],[1,o.substring(l+s.length)]],e.length>t.length&&(r[0][0]=r[2][0]=n),r;if(1==s.length)return[[n,e],[1,t]];var d=this.diff_halfMatch_(e,t);if(d){var u=d[0],c=d[1],p=d[2],f=d[3],h=d[4],g=this.diff_main(u,p,a,i),m=this.diff_main(c,f,a,i);return g.concat([[0,h]],m)}return a&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},t.prototype.diff_lineMode_=function(e,t,a){e=(c=this.diff_linesToChars_(e,t)).chars1,t=c.chars2;var i=c.lineArray,r=this.diff_main(e,t,!1,a);this.diff_charsToLines_(r,i),this.diff_cleanupSemantic(r),r.push([0,""]);for(var o=0,s=0,l=0,d="",u="";o<r.length;){switch(r[o][0]){case 1:l++,u+=r[o][1];break;case n:s++,d+=r[o][1];break;case 0:if(s>=1&&l>=1){r.splice(o-s-l,s+l),o=o-s-l;for(var c,p=(c=this.diff_main(d,u,!1,a)).length-1;p>=0;p--)r.splice(o,0,c[p]);o+=c.length}l=0,s=0,d="",u=""}o++}return r.pop(),r},t.prototype.diff_bisect_=function(e,t,a){for(var i=e.length,r=t.length,o=Math.ceil((i+r)/2),s=o,l=2*o,d=new Array(l),u=new Array(l),c=0;c<l;c++)d[c]=-1,u[c]=-1;d[s+1]=0,u[s+1]=0;for(var p=i-r,f=p%2!=0,h=0,g=0,m=0,v=0,x=0;x<o&&!((new Date).getTime()>a);x++){for(var y=-x+h;y<=x-g;y+=2){for(var b=s+y,w=(A=y==-x||y!=x&&d[b-1]<d[b+1]?d[b+1]:d[b-1]+1)-y;A<i&&w<r&&e.charAt(A)==t.charAt(w);)A++,w++;if(d[b]=A,A>i)g+=2;else if(w>r)h+=2;else if(f&&(I=s+p-y)>=0&&I<l&&-1!=u[I]&&A>=(M=i-u[I]))return this.diff_bisectSplit_(e,t,A,w,a)}for(var _=-x+m;_<=x-v;_+=2){for(var M,I=s+_,C=(M=_==-x||_!=x&&u[I-1]<u[I+1]?u[I+1]:u[I-1]+1)-_;M<i&&C<r&&e.charAt(i-M-1)==t.charAt(r-C-1);)M++,C++;if(u[I]=M,M>i)v+=2;else if(C>r)m+=2;else if(!f){var A;if((b=s+p-_)>=0&&b<l&&-1!=d[b])if(w=s+(A=d[b])-b,A>=(M=i-M))return this.diff_bisectSplit_(e,t,A,w,a)}}}return[[n,e],[1,t]]},t.prototype.diff_bisectSplit_=function(e,t,n,a,i){var r=e.substring(0,n),o=t.substring(0,a),s=e.substring(n),l=t.substring(a),d=this.diff_main(r,o,!1,i),u=this.diff_main(s,l,!1,i);return d.concat(u)},t.prototype.diff_linesToChars_=function(e,t){var n=[],a={};function i(e){for(var t="",i=0,r=-1,o=n.length;r<e.length-1;){-1==(r=e.indexOf("\n",i))&&(r=e.length-1);var s=e.substring(i,r+1);i=r+1,(a.hasOwnProperty?a.hasOwnProperty(s):void 0!==a[s])?t+=String.fromCharCode(a[s]):(t+=String.fromCharCode(o),a[s]=o,n[o++]=s)}return t}return n[0]="",{chars1:i(e),chars2:i(t),lineArray:n}},t.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var a=e[n][1],i=[],r=0;r<a.length;r++)i[r]=t[a.charCodeAt(r)];e[n][1]=i.join("")}},t.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,a=Math.min(e.length,t.length),i=a,r=0;n<i;)e.substring(r,i)==t.substring(r,i)?r=n=i:a=i,i=Math.floor((a-n)/2+n);return i},t.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,a=Math.min(e.length,t.length),i=a,r=0;n<i;)e.substring(e.length-i,e.length-r)==t.substring(t.length-i,t.length-r)?r=n=i:a=i,i=Math.floor((a-n)/2+n);return i},t.prototype.diff_commonOverlap_=function(e,t){var n=e.length,a=t.length;if(0==n||0==a)return 0;n>a?e=e.substring(n-a):n<a&&(t=t.substring(0,n));var i=Math.min(n,a);if(e==t)return i;for(var r=0,o=1;;){var s=e.substring(i-o),l=t.indexOf(s);if(-1==l)return r;o+=l,0!=l&&e.substring(i-o)!=t.substring(0,o)||(r=o,o++)}},t.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,a=e.length>t.length?t:e;if(n.length<4||2*a.length<n.length)return null;var i=this;function r(e,t,n){for(var a,r,o,s,l=e.substring(n,n+Math.floor(e.length/4)),d=-1,u="";-1!=(d=t.indexOf(l,d+1));){var c=i.diff_commonPrefix(e.substring(n),t.substring(d)),p=i.diff_commonSuffix(e.substring(0,n),t.substring(0,d));u.length<p+c&&(u=t.substring(d-p,d)+t.substring(d,d+c),a=e.substring(0,n-p),r=e.substring(n+c),o=t.substring(0,d-p),s=t.substring(d+c))}return 2*u.length>=e.length?[a,r,o,s,u]:null}var o,s,l,d,u,c=r(n,a,Math.ceil(n.length/4)),p=r(n,a,Math.ceil(n.length/2));return c||p?(o=p?c&&c[4].length>p[4].length?c:p:c,e.length>t.length?(s=o[0],l=o[1],d=o[2],u=o[3]):(d=o[0],u=o[1],s=o[2],l=o[3]),[s,l,d,u,o[4]]):null},t.prototype.diff_cleanupSemantic=function(e){for(var t=!1,a=[],i=0,r=null,o=0,s=0,l=0,d=0,u=0;o<e.length;)0==e[o][0]?(a[i++]=o,s=d,l=u,d=0,u=0,r=e[o][1]):(1==e[o][0]?d+=e[o][1].length:u+=e[o][1].length,r&&r.length<=Math.max(s,l)&&r.length<=Math.max(d,u)&&(e.splice(a[i-1],0,[n,r]),e[a[i-1]+1][0]=1,i--,o=--i>0?a[i-1]:-1,s=0,l=0,d=0,u=0,r=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;){if(e[o-1][0]==n&&1==e[o][0]){var c=e[o-1][1],p=e[o][1],f=this.diff_commonOverlap_(c,p),h=this.diff_commonOverlap_(p,c);f>=h?(f>=c.length/2||f>=p.length/2)&&(e.splice(o,0,[0,p.substring(0,f)]),e[o-1][1]=c.substring(0,c.length-f),e[o+1][1]=p.substring(f),o++):(h>=c.length/2||h>=p.length/2)&&(e.splice(o,0,[0,c.substring(0,h)]),e[o-1][0]=1,e[o-1][1]=p.substring(0,p.length-h),e[o+1][0]=n,e[o+1][1]=c.substring(h),o++),o++}o++}},t.prototype.diff_cleanupSemanticLossless=function(e){function n(e,n){if(!e||!n)return 6;var a=e.charAt(e.length-1),i=n.charAt(0),r=a.match(t.nonAlphaNumericRegex_),o=i.match(t.nonAlphaNumericRegex_),s=r&&a.match(t.whitespaceRegex_),l=o&&i.match(t.whitespaceRegex_),d=s&&a.match(t.linebreakRegex_),u=l&&i.match(t.linebreakRegex_),c=d&&e.match(t.blanklineEndRegex_),p=u&&n.match(t.blanklineStartRegex_);return c||p?5:d||u?4:r&&!s&&l?3:s||l?2:r||o?1:0}for(var a=1;a<e.length-1;){if(0==e[a-1][0]&&0==e[a+1][0]){var i=e[a-1][1],r=e[a][1],o=e[a+1][1],s=this.diff_commonSuffix(i,r);if(s){var l=r.substring(r.length-s);i=i.substring(0,i.length-s),r=l+r.substring(0,r.length-s),o=l+o}for(var d=i,u=r,c=o,p=n(i,r)+n(r,o);r.charAt(0)===o.charAt(0);){i+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);var f=n(i,r)+n(r,o);f>=p&&(p=f,d=i,u=r,c=o)}e[a-1][1]!=d&&(d?e[a-1][1]=d:(e.splice(a-1,1),a--),e[a][1]=u,c?e[a+1][1]=c:(e.splice(a+1,1),a--))}a++}},t.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,t.whitespaceRegex_=/\s/,t.linebreakRegex_=/[\r\n]/,t.blanklineEndRegex_=/\n\r?\n$/,t.blanklineStartRegex_=/^\r?\n\r?\n/,t.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,a=[],i=0,r=null,o=0,s=!1,l=!1,d=!1,u=!1;o<e.length;)0==e[o][0]?(e[o][1].length<this.Diff_EditCost&&(d||u)?(a[i++]=o,s=d,l=u,r=e[o][1]):(i=0,r=null),d=u=!1):(e[o][0]==n?u=!0:d=!0,r&&(s&&l&&d&&u||r.length<this.Diff_EditCost/2&&s+l+d+u==3)&&(e.splice(a[i-1],0,[n,r]),e[a[i-1]+1][0]=1,i--,r=null,s&&l?(d=u=!0,i=0):(o=--i>0?a[i-1]:-1,d=u=!1),t=!0)),o++;t&&this.diff_cleanupMerge(e)},t.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,a=0,i=0,r=0,o="",s="";a<e.length;)switch(e[a][0]){case 1:r++,s+=e[a][1],a++;break;case n:i++,o+=e[a][1],a++;break;case 0:i+r>1?(0!==i&&0!==r&&(0!==(t=this.diff_commonPrefix(s,o))&&(a-i-r>0&&0==e[a-i-r-1][0]?e[a-i-r-1][1]+=s.substring(0,t):(e.splice(0,0,[0,s.substring(0,t)]),a++),s=s.substring(t),o=o.substring(t)),0!==(t=this.diff_commonSuffix(s,o))&&(e[a][1]=s.substring(s.length-t)+e[a][1],s=s.substring(0,s.length-t),o=o.substring(0,o.length-t))),0===i?e.splice(a-r,i+r,[1,s]):0===r?e.splice(a-i,i+r,[n,o]):e.splice(a-i-r,i+r,[n,o],[1,s]),a=a-i-r+(i?1:0)+(r?1:0)+1):0!==a&&0==e[a-1][0]?(e[a-1][1]+=e[a][1],e.splice(a,1)):a++,r=0,i=0,o="",s=""}""===e[e.length-1][1]&&e.pop();var l=!1;for(a=1;a<e.length-1;)0==e[a-1][0]&&0==e[a+1][0]&&(e[a][1].substring(e[a][1].length-e[a-1][1].length)==e[a-1][1]?(e[a][1]=e[a-1][1]+e[a][1].substring(0,e[a][1].length-e[a-1][1].length),e[a+1][1]=e[a-1][1]+e[a+1][1],e.splice(a-1,1),l=!0):e[a][1].substring(0,e[a+1][1].length)==e[a+1][1]&&(e[a-1][1]+=e[a+1][1],e[a][1]=e[a][1].substring(e[a+1][1].length)+e[a+1][1],e.splice(a+1,1),l=!0)),a++;l&&this.diff_cleanupMerge(e)},t.prototype.diff_xIndex=function(e,t){var a,i=0,r=0,o=0,s=0;for(a=0;a<e.length&&(1!==e[a][0]&&(i+=e[a][1].length),e[a][0]!==n&&(r+=e[a][1].length),!(i>t));a++)o=i,s=r;return e.length!=a&&e[a][0]===n?s:s+(t-o)},t.prototype.diff_prettyHtml=function(e){for(var t=[],a=/&/g,i=/</g,r=/>/g,o=/\n/g,s=0;s<e.length;s++){var l=e[s][0],d=e[s][1].replace(a,"&amp;").replace(i,"&lt;").replace(r,"&gt;").replace(o,"&para;<br>");switch(l){case 1:t[s]='<ins style="background:#e6ffe6;">'+d+"</ins>";break;case n:t[s]='<del style="background:#ffe6e6;">'+d+"</del>";break;case 0:t[s]="<span>"+d+"</span>"}}return t.join("")},t.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},t.prototype.diff_text2=function(e){for(var t=[],a=0;a<e.length;a++)e[a][0]!==n&&(t[a]=e[a][1]);return t.join("")},t.prototype.diff_levenshtein=function(e){for(var t=0,a=0,i=0,r=0;r<e.length;r++){var o=e[r][0],s=e[r][1];switch(o){case 1:a+=s.length;break;case n:i+=s.length;break;case 0:t+=Math.max(a,i),a=0,i=0}}return t+Math.max(a,i)},t.prototype.diff_toDelta=function(e){for(var t=[],a=0;a<e.length;a++)switch(e[a][0]){case 1:t[a]="+"+encodeURI(e[a][1]);break;case n:t[a]="-"+e[a][1].length;break;case 0:t[a]="="+e[a][1].length}return t.join("\t").replace(/%20/g," ")},t.prototype.diff_fromDelta=function(e,t){for(var a=[],i=0,r=0,o=t.split(/\t/g),s=0;s<o.length;s++){var l=o[s].substring(1);switch(o[s].charAt(0)){case"+":try{a[i++]=[1,decodeURI(l)]}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var d=parseInt(l,10);if(isNaN(d)||d<0)throw new Error("Invalid number in diff_fromDelta: "+l);var u=e.substring(r,r+=d);"="==o[s].charAt(0)?a[i++]=[0,u]:a[i++]=[n,u];break;default:if(o[s])throw new Error("Invalid diff operation in diff_fromDelta: "+o[s])}}if(r!=e.length)throw new Error("Delta length ("+r+") does not equal source text length ("+e.length+").");return a},t.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},t.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var a=this.match_alphabet_(t),i=this;function r(e,a){var r=e/t.length,o=Math.abs(n-a);return i.Match_Distance?r+o/i.Match_Distance:o?1:r}var o=this.Match_Threshold,s=e.indexOf(t,n);-1!=s&&(o=Math.min(r(0,s),o),-1!=(s=e.lastIndexOf(t,n+t.length))&&(o=Math.min(r(0,s),o)));var l,d,u=1<<t.length-1;s=-1;for(var c,p=t.length+e.length,f=0;f<t.length;f++){for(l=0,d=p;l<d;)r(f,n+d)<=o?l=d:p=d,d=Math.floor((p-l)/2+l);p=d;var h=Math.max(1,n-d+1),g=Math.min(n+d,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<f)-1;for(var v=g;v>=h;v--){var x=a[e.charAt(v-1)];if(m[v]=0===f?(m[v+1]<<1|1)&x:(m[v+1]<<1|1)&x|(c[v+1]|c[v])<<1|1|c[v+1],m[v]&u){var y=r(f,v-1);if(y<=o){if(o=y,!((s=v-1)>n))break;h=Math.max(1,2*n-s)}}}if(r(f+1,n)>o)break;c=m}return s},t.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},t.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),a=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)a+=this.Patch_Margin,n=t.substring(e.start2-a,e.start2+e.length1+a);a+=this.Patch_Margin;var i=t.substring(e.start2-a,e.start2);i&&e.diffs.unshift([0,i]);var r=t.substring(e.start2+e.length1,e.start2+e.length1+a);r&&e.diffs.push([0,r]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+r.length,e.length2+=i.length+r.length}},t.prototype.patch_make=function(e,a,i){var r,o;if("string"==typeof e&&"string"==typeof a&&void 0===i)r=e,(o=this.diff_main(r,a,!0)).length>2&&(this.diff_cleanupSemantic(o),this.diff_cleanupEfficiency(o));else if(e&&"object"==typeof e&&void 0===a&&void 0===i)o=e,r=this.diff_text1(o);else if("string"==typeof e&&a&&"object"==typeof a&&void 0===i)r=e,o=a;else{if("string"!=typeof e||"string"!=typeof a||!i||"object"!=typeof i)throw new Error("Unknown call format to patch_make.");r=e,o=i}if(0===o.length)return[];for(var s=[],l=new t.patch_obj,d=0,u=0,c=0,p=r,f=r,h=0;h<o.length;h++){var g=o[h][0],m=o[h][1];switch(d||0===g||(l.start1=u,l.start2=c),g){case 1:l.diffs[d++]=o[h],l.length2+=m.length,f=f.substring(0,c)+m+f.substring(c);break;case n:l.length1+=m.length,l.diffs[d++]=o[h],f=f.substring(0,c)+f.substring(c+m.length);break;case 0:m.length<=2*this.Patch_Margin&&d&&o.length!=h+1?(l.diffs[d++]=o[h],l.length1+=m.length,l.length2+=m.length):m.length>=2*this.Patch_Margin&&d&&(this.patch_addContext_(l,p),s.push(l),l=new t.patch_obj,d=0,p=f,u=c)}1!==g&&(u+=m.length),g!==n&&(c+=m.length)}return d&&(this.patch_addContext_(l,p),s.push(l)),s},t.prototype.patch_deepCopy=function(e){for(var n=[],a=0;a<e.length;a++){var i=e[a],r=new t.patch_obj;r.diffs=[];for(var o=0;o<i.diffs.length;o++)r.diffs[o]=i.diffs[o].slice();r.start1=i.start1,r.start2=i.start2,r.length1=i.length1,r.length2=i.length2,n[a]=r}return n},t.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var a=this.patch_addPadding(e);t=a+t+a,this.patch_splitMax(e);for(var i=0,r=[],o=0;o<e.length;o++){var s,l,d=e[o].start2+i,u=this.diff_text1(e[o].diffs),c=-1;if(u.length>this.Match_MaxBits?-1!=(s=this.match_main(t,u.substring(0,this.Match_MaxBits),d))&&(-1==(c=this.match_main(t,u.substring(u.length-this.Match_MaxBits),d+u.length-this.Match_MaxBits))||s>=c)&&(s=-1):s=this.match_main(t,u,d),-1==s)r[o]=!1,i-=e[o].length2-e[o].length1;else if(r[o]=!0,i=s-d,u==(l=-1==c?t.substring(s,s+u.length):t.substring(s,c+this.Match_MaxBits)))t=t.substring(0,s)+this.diff_text2(e[o].diffs)+t.substring(s+u.length);else{var p=this.diff_main(u,l,!1);if(u.length>this.Match_MaxBits&&this.diff_levenshtein(p)/u.length>this.Patch_DeleteThreshold)r[o]=!1;else{this.diff_cleanupSemanticLossless(p);for(var f,h=0,g=0;g<e[o].diffs.length;g++){var m=e[o].diffs[g];0!==m[0]&&(f=this.diff_xIndex(p,h)),1===m[0]?t=t.substring(0,s+f)+m[1]+t.substring(s+f):m[0]===n&&(t=t.substring(0,s+f)+t.substring(s+this.diff_xIndex(p,h+m[1].length))),m[0]!==n&&(h+=m[1].length)}}}}return[t=t.substring(a.length,t.length-a.length),r]},t.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",a=1;a<=t;a++)n+=String.fromCharCode(a);for(a=0;a<e.length;a++)e[a].start1+=t,e[a].start2+=t;var i=e[0],r=i.diffs;if(0==r.length||0!=r[0][0])r.unshift([0,n]),i.start1-=t,i.start2-=t,i.length1+=t,i.length2+=t;else if(t>r[0][1].length){var o=t-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],i.start1-=o,i.start2-=o,i.length1+=o,i.length2+=o}return 0==(r=(i=e[e.length-1]).diffs).length||0!=r[r.length-1][0]?(r.push([0,n]),i.length1+=t,i.length2+=t):t>r[r.length-1][1].length&&(o=t-r[r.length-1][1].length,r[r.length-1][1]+=n.substring(0,o),i.length1+=o,i.length2+=o),n},t.prototype.patch_splitMax=function(e){for(var a=this.Match_MaxBits,i=0;i<e.length;i++)if(!(e[i].length1<=a)){var r=e[i];e.splice(i--,1);for(var o=r.start1,s=r.start2,l="";0!==r.diffs.length;){var d=new t.patch_obj,u=!0;for(d.start1=o-l.length,d.start2=s-l.length,""!==l&&(d.length1=d.length2=l.length,d.diffs.push([0,l]));0!==r.diffs.length&&d.length1<a-this.Patch_Margin;){var c=r.diffs[0][0],p=r.diffs[0][1];1===c?(d.length2+=p.length,s+=p.length,d.diffs.push(r.diffs.shift()),u=!1):c===n&&1==d.diffs.length&&0==d.diffs[0][0]&&p.length>2*a?(d.length1+=p.length,o+=p.length,u=!1,d.diffs.push([c,p]),r.diffs.shift()):(p=p.substring(0,a-d.length1-this.Patch_Margin),d.length1+=p.length,o+=p.length,0===c?(d.length2+=p.length,s+=p.length):u=!1,d.diffs.push([c,p]),p==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(p.length))}l=(l=this.diff_text2(d.diffs)).substring(l.length-this.Patch_Margin);var f=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==f&&(d.length1+=f.length,d.length2+=f.length,0!==d.diffs.length&&0===d.diffs[d.diffs.length-1][0]?d.diffs[d.diffs.length-1][1]+=f:d.diffs.push([0,f])),u||e.splice(++i,0,d)}}},t.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},t.prototype.patch_fromText=function(e){var a=[];if(!e)return a;for(var i=e.split("\n"),r=0,o=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<i.length;){var s=i[r].match(o);if(!s)throw new Error("Invalid patch string: "+i[r]);var l=new t.patch_obj;for(a.push(l),l.start1=parseInt(s[1],10),""===s[2]?(l.start1--,l.length1=1):"0"==s[2]?l.length1=0:(l.start1--,l.length1=parseInt(s[2],10)),l.start2=parseInt(s[3],10),""===s[4]?(l.start2--,l.length2=1):"0"==s[4]?l.length2=0:(l.start2--,l.length2=parseInt(s[4],10)),r++;r<i.length;){var d=i[r].charAt(0);try{var u=decodeURI(i[r].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+u)}if("-"==d)l.diffs.push([n,u]);else if("+"==d)l.diffs.push([1,u]);else if(" "==d)l.diffs.push([0,u]);else{if("@"==d)break;if(""!==d)throw new Error('Invalid patch mode "'+d+'" in: '+u)}r++}}return a},t.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},t.patch_obj.prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case 1:e="+";break;case n:e="-";break;case 0:e=" "}t[a+1]=e+encodeURI(this.diffs[a][1])+"\n"}return t.join("").replace(/%20/g," ")},this.diff_match_patch=t,this.DIFF_DELETE=n,this.DIFF_INSERT=1,this.DIFF_EQUAL=0,e.exports=t},45156:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>v});var a=n(85072),i=n.n(a),r=n(97825),o=n.n(r),s=n(77659),l=n.n(s),d=n(55056),u=n.n(d),c=n(10540),p=n.n(c),f=n(41113),h=n.n(f),g=n(75311),m={};m.styleTagTransform=h(),m.setAttributes=u(),m.insert=l().bind(null,"head"),m.domAPI=o(),m.insertStyleElement=p(),i()(g.A,m);const v=g.A&&g.A.locals?g.A.locals:void 0},20939:(e,t,n)=>{var a,i;a=[n(13946),n(10561),n(94459),n(53578),n(98094),n(47724),n(21877)],void 0===(i=function(e,t,n,a,i,r){var o={};function s(t,n,o){var s=n.form;return{at:t,displayTpl:r,insertTpl:o.insertTpl,limit:10,maxLen:30,startWithSpace:!1,tabSelectsMatch:o.tabSelectsMatch,callbacks:{matcher:function(e,t){var n;return(n=new RegExp("([\\s​]+|^)"+RegExp.escape(e)+"([\\w/-]*)$","gi").exec(t))?n[2]:null},filter:function(t,a,i){return r=t?s.fuse.search(t):s.fuse.list(),e.filter(r,(function(t){return n.ufid!==t.id&&t.name&&!e.isUndefined(t.displayLabel)}));var r},sorter:function(t,n,a){return e.map(n,(function(e,t){return e.atwho_order=t,e}))},beforeInsert:function(e,t){var n=i.getReferenceName(e);return a.usage(n,"Autocomplete",o.property),e},afterMatchFailed:function(e,t){if(o.useRichText&&t.html()){var n=t.html().trim().replace(/^.*\s/,""),a=s.isValidHashtag(n)||s.hasValidHashtagPrefix(n);a&&o.functionOverrides.insert.call(this,n);var i=this._unwrap(t.text(t.text()).contents().first());a||this._setRange("after",i)}return!1}},functionOverrides:o.functionOverrides}}return o.autocomplete=function(e,t,n){t.form.vellum.data.atwho&&(n&&n.choices?o._dropdownAutocomplete(e,n.choices):o._questionAutocomplete(e,t,n),t.on("teardown-mug-properties",(function(){e.data("atwho")&&e.atwho("destroy")}),null,"teardown-mug-properties"))},o._dropdownAutocomplete=function(a,i){var r={at:"",data:i,limit:10,maxLen:1/0,suffix:"",tabSelectsMatch:!1,callbacks:{filter:function(t,n,a){return e.filter(n,(function(e){return-1!==e.name.indexOf(t)}))},matcher:function(e,t,n){return a.val()},beforeInsert:function(e,t){a.data("selected-value",e)}}};a.one("focus",(function(){a.atwho(r).on("inserted.atwho",(function(e,i,r){t(this).find(".atwho-inserted").children().unwrap(),a.attr("contenteditable")?n.editor(a).setValue(a.data("selected-value")).change():a.val(a.data("selected-value")).change()}))}))},o._questionAutocomplete=function(a,i,r){function o(){a.one("focus",(function(){a.atwho(s(i.form.getBasePath(),i,r)),r.useHashtags&&a.atwho(s("#",i,r))}))}(r=e.defaults(r||{},{insertTpl:"${name}",property:"",outputValue:!1,useRichText:!1,useHashtags:!1,tabSelectsMatch:!1,functionOverrides:{}})).useRichText&&(r.useHashtags=!0,r.functionOverrides.insert=function(e,t){this.query.el.remove(),n.editor(a).insertExpression(e),this.$inputor.is(":focus")||this.$inputor.focus()}),r.useHashtags&&(r.insertTpl="${hashtagPath}"),o(),a.on("inserted.atwho",(function(e,n,a){t(this).find(".atwho-inserted").children().unwrap()})),i.form.on("change-display-language",(function(){a.data("atwho")&&(a.atwho("destroy"),o())}))},t.vellum.plugin("atwho",{},{}),o}.apply(t,a))||(e.exports=i)},70579:(e,t,n)=>{var a,i;a=[n(10561),n(13946)],void 0===(i=function(e,t,n){var a=["core","intents","javaRosa","lock","ignore","uploader","windowManager","copyPaste","commander","caseManagement"];function i(e,t,a){if("init"!==a||"core"===e)if(0!==a.indexOf("_"))t.plugin=e,t.old=this[a],this[a]=function(){var e=t,n=Array.prototype.slice.call(arguments),a=this.__callOld;this.__callOld=function(){return e.old.apply(this,arguments.length?Array.prototype.slice.call(arguments):n)};try{return e.apply(this,n)}finally{this.__callOld=a}},this[a].old=t.old,this[a].plugin=e;else{if(this[a]!==n)throw"private plugin method "+e+"."+a+" would overwrite existing: "+this[a];this[a]=t}}e.fn.vellum=function(t){var n,a="string"==typeof t,i=Array.prototype.slice.call(arguments,1);if(a){if("get"===t){for(var r=this;r&&r.length;){if((n=r.data("vellum_instance"))instanceof e.vellum._instance)return n;r=r.parent()}return null}return(n=this.data("vellum_instance"))[t].apply(n,i)}return this.each((function(){var n=new e.vellum._instance(e(this),t);e.data(this,"vellum_instance",n)})),this},e.vellum={defaults:{},_plugins:{},_fn:{},_instance:function(n,r){r.plugins=t.filter(t.union(a,r.plugins||[]),(function(n){return!t.isUndefined(e.vellum._plugins[n])})),r=e.extend(!0,{},e.vellum.defaults,r);var o=this;this.$f=n,this.data={},this.opts=function(){return e.extend(!0,{},r)},this.getData=function(){return this.data}.bind(this),this.isPluginEnabled=function(e){return-1!==r.plugins.indexOf(e)},t.each(r.plugins,(function(n,a){o.data[n]={};var r=e.vellum._plugins[n];r&&t.each(r,(function(e,t){0===a?o[t]=e:i.call(o,n,e,t)}))})),t.each(r.plugins,(function(t){var n=e.vellum._plugins[t].init;n&&n.apply(o)})),o.postInit()},plugin:function(t,n,a){return e.vellum.defaults[t]=n,e.vellum._plugins[t]=a,e}}}.apply(t,a))||(e.exports=i)},65329:(e,t,n)=>{var a,i;a=[n(10561),n(34078),n(98094),n(50705)],void 0===(i=function(e,t,n,a){"use strict";function i(t,n){const i=n.vellum.caseManager.getProperties().map((e=>({text:e,value:e})));n.defaultOptions=i,n.useValueAsCustomName=!0;var r=a.dropdown(t,n);return r.postRender=function(){r.input.select2({tags:!0,allowClear:!0,placeholder:""}),r.input.on("remove",(function(){e(this).data("select2")&&e(this).select2("destroy")}))},r}const r="mug-caseProperty-conflict";function o(e,t){const a={key:r,message:n.format(gettext('"{caseProperty}" is assigned by another question. You can still save the form, but will need to have only one question for any case property in order to build the application'),{caseProperty:t}),level:e.WARNING};e.addMessage("case_property",a)}class s{addMappingsToForm(e,t){let n=[];t&&(n=t.find(":root > case_mappings").children().toArray()),e.mappings=this.buildMappingsFromXMLElements(n),e.mappingsByQuestion=this.buildQuestionMappingsFromCaseMappings(e.mappings)}buildMappingsFromXMLElements(t){const n={};return t.forEach((t=>{const a=t.attributes.property.value,i=[];e(t).children().each(((e,t)=>{i.push(this.buildQuestionFromXMLElement(t))})),n[a]=i})),n}buildQuestionFromXMLElement(e){const t={};for(let n=0;n<e.attributes.length;n++){const a=e.attributes.item(n);t[a.name]=a.value}return t}buildQuestionMappingsFromCaseMappings(e){const t={};return Object.entries(e).forEach((([e,n])=>{n.forEach((n=>{const a=n.question_path;t[a]=t[a]||[],t[a].push(e)}))})),t}}class l{constructor(e){this.writer=e}writeCaseMappingsElement(e){e.hasOwnProperty("mappings")&&(this.writer.writeStartElement("case_mappings"),Object.entries(e.mappings).forEach((([e,t])=>{this.writeMappingElement(e,t)})),this.writer.writeEndElement())}writeMappingElement(e,t){this.writer.writeStartElement("mapping"),this.writer.writeAttributeString("property",e),t.forEach((e=>this.writeQuestionElement(e))),this.writer.writeEndElement()}writeQuestionElement(e){this.writer.writeStartElement("question"),Object.entries(e).forEach((([e,t])=>{this.writer.writeAttributeString(e,t)})),this.writer.writeEndElement()}}class d{constructor(e){this.form=e}updateFormMappings(e,t,n){this.replaceFormQuestionMappings(e,t,n),this.replaceFormPropertyMappings(e,t,n)}replaceFormQuestionMappings(e,t,n){this.form.mappingsByQuestion[e]=this.form.mappingsByQuestion[e]||[];const a=this.form.mappingsByQuestion[e];let i=0;t&&(i=a.findIndex((e=>e===t)),a.splice(i,1)),n?a.splice(i,0,n):0===a.length&&delete this.form.mappingsByQuestion[e]}replaceFormPropertyMappings(e,t,n){let a=t?this.form.mappings[t]:[],i=null,s=a.findIndex((t=>t.question_path===e));-1!==s&&(i=a[s],a.splice(s,1),0===a.length?delete this.form.mappings[t]:1===a.length&&this.form.getMugByPath(a[0].question_path).dropMessage("case_property",r),this.form.getMugByPath(i.question_path).dropMessage("case_property",r)),n&&(this.form.mappings[n]=this.form.mappings[n]||[],i||(i={question_path:e}),this.form.mappings[n].push(i),this.form.mappings[n].length>=2&&this.form.mappings[n].forEach((e=>{o(this.form.getMugByPath(e.question_path),n)})))}moveMappings(e,t){if(!this.form.hasOwnProperty("mappingsByQuestion"))return;const n=this.form.mappingsByQuestion[e]||[];0!==n.length&&(delete this.form.mappingsByQuestion[e],t&&(this.form.mappingsByQuestion[t]=n),n.forEach((n=>{const a=this.form.mappings[n],i=a.findIndex((t=>t.question_path===e));-1!==i&&(t?a[i].question_path=t:(a.splice(i,1),0===a.length&&delete this.form.mappings[n]))})))}removeMappings(e){this.moveMappings(e,null)}}class u{constructor(e,t){this.baseProperties=new Set(e),this.customProperties={},this.viewFormUrl=t}addProperty(e){this.baseProperties.has(e)||(this.customProperties[e]=this.customProperties[e]||0,this.customProperties[e]++)}removeProperty(e){this.customProperties.hasOwnProperty(e)&&(this.customProperties[e]--,this.customProperties[e]<=0&&delete this.customProperties[e])}getProperties(){return Array.from(this.baseProperties.values()).concat(Object.keys(this.customProperties))}}e.vellum.plugin("caseManagement",{},{init:function(){const e=this.data.caseManagement;e.properties=this.opts().caseManagement.properties,e.isActive=!!e.properties,e.view_form_url=this.opts().caseManagement.view_form_url,this.caseManager=new u(this.opts().caseManagement.properties,this.opts().caseManagement.view_form_url)},loadXML:function(){this.__callOld();const e=this.data.core.form;e.on("question-remove",(function(t){new d(e).removeMappings(t.absolutePath)})),e.on("question-create",(function(t){const n=new d(e),a=t.mug,i=a.p.case_property;i&&n.updateFormMappings(a.absolutePath,null,i)}))},performAdditionalParsing:function(e,t){this.__callOld(),this.data.caseManagement.isActive&&(new s).addMappingsToForm(e,t)},contributeToAdditionalXML:function(e,t){this.__callOld(),this.data.caseManagement.isActive&&new l(e).writeCaseMappingsElement(t)},getMugTypes:function(){const e=this.__callOld();return e.normal.Trigger.spec.case_property={presence:"notallowed"},[e.normal.Group,e.normal.Repeat,e.normal.FieldList].forEach((e=>e.spec.case_property={presence:"notallowed"})),e},getSections:function(e){const t=this.__callOld(e);return this.data.caseManagement.isActive?(t.splice(1,0,{slug:"caseManagement",displayName:gettext("Case Management"),properties:["case_property"],help:{title:gettext("Case Management"),text:gettext("Saving a question as a case property makes it accessible and reusable across your application. To manage all your case properties from this form, click on the Manage Case button. "),link:"https://dimagi.atlassian.net/wiki/spaces/commcarepublic/pages/2143955170/Case+Management+Overview"}}),t):t},getMugSpec:function(){const e=this.__callOld(),n=this,a=Object.assign(e.databind,{case_property:{visibility:"visible",widget:i,presence:"optional",enabled:function(e){if(!e.absolutePath||!e.form.mappingsByQuestion)return!0;const t=e.form.mappingsByQuestion[e.absolutePath];return!t||t.length<=1},lstring:gettext("Case Property"),serialize:t.serializeXPath,deserialize:t.deserializeXPath,setter:function(e,t,a){new d(e.form).updateFormMappings(e.absolutePath,e.p[t],a);const i=e.p[t];i&&n.caseManager.removeProperty(i),a&&n.caseManager.addProperty(a),e.p.set(t,a)}}}),r=a.nodeID.setter;return a.nodeID.setter=function(e,t,n){const a=e.absolutePath;r(e,t,n);const i=e.absolutePath;new d(e.form).moveMappings(a,i)},e.databind=a,e},handleMugParseFinish:function(e){if(this.__callOld(),!this.data.caseManagement.isActive)return;if(!e.absolutePath)return;const t=e.form.mappingsByQuestion[e.absolutePath];t&&t.length>0&&(e.p.set("case_property",t[0]),t.length>1&&function(e,t){const a={key:"mug-caseProperty-multipleAssignments",message:{markdown:n.format(gettext("This question is used to update multiple case properties. If you wish to update these case properties, please visit the [Manage Case Page]({url})"),{url:t})},level:e.INFO};e.addMessage("case_property",a)}(e,this.data.caseManagement.view_form_url),t.forEach((t=>{e.form.mappings[t].length>=2&&o(e,t)})))},handleMugRename:function(e,t,n,a,i,r){const o=this.__callOld(),s=e.getBasePath();function l(e){return e.replace(/^#form\//,s)}const u=new d(e);return Object.values(o).forEach((([e,t])=>{const n=l(e),a=l(t);u.moveMappings(n,a)})),o}})}.apply(t,a))||(e.exports=i)},33586:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(53578),n(20939),n(98094),n(37444)],void 0===(i=function(e,t,n,a,i,r){var o={},s={};function l(e){e.addQuestionButton.show(),e.container.hide(),e.input.val("").removeClass("alert-danger")}function d(n){function a(e,n){if(!n)throw new Error("getArg parameter is required");return{regexp:t.chain(e).map((function(e){return RegExp.escape(e.name)})).sortBy((function(e){return-e.length})).value().join("|"),items:e,getArg:n}}function i(e){var n,a;for(e=e.trim(),n=0;n<p.length;n++)if(a=p[n].exec(e))return{tokens:t.tail(a),config:p[n].config}}var r=e.fn.atwho.default.callbacks,s=o.getQuestionMap(n),l=t.map(s,(function(e){return{name:e.typeName,icon:e.icon}})),d=t.map(["after","before","first in","in"],(function(e){return{name:e}})),u={in:"into","first in":"first"},c={regexp:/[#\/][^\s]+/.source,getArg:function(e){var t;if(e){if(!(t=n.getMugByPath(e)))throw new Error("bad path: "+e)}else t=n.getCurrentlySelectedMug();return t}},p=[],f=[],h=[{name:"add question",args:[a(l,(function(e){if(e=e.toLowerCase(),s.hasOwnProperty(e))return s[e].__className})),a(d,(function(e){return e&&(e=e.toLowerCase(),u.hasOwnProperty(e)&&(e=u[e])),e})),c],run:function(e){!e[2]&&/^(before|after)$/i.test(e[1])&&(e[1]=void 0);try{return n.addQuestion.apply(n,e)}catch(e){}}},{name:"select question",args:[c],run:function(e){var t=e[0];if(t&&n.ensureCurrentMugIsSaved())return n.setCurrentMug(t),n.scrollTreeTo(t.ufid),n.focusFirstInput(),t}}];return t.each(h,(function(e){var n=[],a=[],i=f.length;t.each(e.args,(function(e){if(e.items){var t=n.concat(["(.*)$"]),r=new RegExp("^"+t.join("\\s+"),"i");r.items=e.items,f.splice(i,0,r)}n.push("(?:"+e.regexp+")"),a.length<1?a.push("^("+e.regexp+")"):a.push("(?:\\s+("+e.regexp+")")})),a.push.apply(a,t.map(a,(function(){return")?"}))),a[a.length-1]="$";var r=new RegExp(a.join(""),"i");r.config=e,p.push(r)})),{tokenize:i,dispatch:function(e){var n,a=i(e);if(a){try{n=t.map(a.tokens,(function(e,t){return a.config.args[t].getArg(e)}))}catch(e){return}var r=a.config.run(n);return r&&{name:a.config.name,value:r}}},atwhoConfig:{at:"",data:[],limit:50,maxLen:1/0,displayTpl:'<li><i class="${icon}"></i> ${name}</li>',insertTpl:"${full}",suffix:" ",searchKey:e.fn.atwho.default.searchKey,tabSelectsMatch:!0,callbacks:{matcher:function(e,t){return t},filter:function(e,n,a){var i=[];return t.each(f,(function(n){var o=n.exec(e);if(o){var s=o[o.length-1],l=s?e.slice(0,-s.length):e,d=s.trimLeft(),u=r.filter(d,n.items,a);u=t.map(u,(function(e){return{name:e.name,icon:e.icon,full:l+e.name}})),d&&(d=d.toLowerCase(),u=t.sortBy(u,(function(e){var t=e.name.toLowerCase().indexOf(d);return t>=0?t:1/0}))),Array.prototype.push.apply(i,u)}})),i},sorter:function(e,t){return t}}}}}function u(e){if(e.input.atwho("isSelecting"))t.defer(u,e);else{var a=e.input.val(),i=o.doCommand(a,e.vellum);i?(l(e),n.usage("Commander",i.name)):(e.input.addClass("alert-danger"),n.usage("Commander","bad command"))}}return e.vellum.plugin("commander",{},{init:function(){var t=this,n=t.data.commander;n.vellum=t,n.container=e(r()),n.addQuestionButton=t.$f.find(".fd-add-question"),n.input=n.container.find("input"),n.input.on("keydown",(function(e){var t=i.getKeyChord(e);s.hasOwnProperty(t)?(s[t](n),e.preventDefault()):n.input.removeClass("alert-danger")})),n.container.find(".fd-commander-close").click((function(e){l(n)})),e(".fd-add-question-dropdown").append(n.container.hide())},getToolsMenuItems:function(){var e=this.__callOld();return e.splice(e.length-1,0,{name:gettext("Command Bar"),icon:"fa fa-terminal",hotkey:"Ctrl+;",action:function(){!function(e){(function(e){e.atwhoConfig||(t.extend(e,d(e.vellum)),e.input.atwho(e.atwhoConfig),a.autocomplete(e.input,{form:e.vellum.data.core.form,on:t.identity},{useHashtags:!0,tabSelectsMatch:!0}),e.vellum.data.core.form.on("change-display-language",(function(){e.input.atwho(e.atwhoConfig)})),e.input.on("inserted.atwho",(function(e){e.preventDefault()})))})(e),e.addQuestionButton.hide();const n=e.addQuestionButton.outerHeight(!0);e.container.css("min-height",n+"px"),e.container.show(),e.input.focus().select()}(this.data.commander)}}),e}}),s.Tab=function(){},s.Enter=u,s.Return=u,s.Escape=l,s.Esc=l,o.getCompletions=function(e,t){var n=d(t).atwhoConfig;return n.callbacks.filter(e,null,n.searchKey)},o.tokenize=function(e,t){return d(t).tokenize(e)},o.doCommand=function(e,n){var a=n.data.commander;return a.dispatch||t.extend(a,d(n)),a.dispatch(e)},o.getQuestionMap=function(e){var n=e.data.commander,a=e.data.core.mugTypes;return n.hasOwnProperty("questions")||(n.questions=t.chain(e.data.core.QUESTIONS_IN_TOOLBAR).map((function(e){var t=a[e];return[t.typeName.toLowerCase(),t]})).object().value(),n.questions.choice=a.Choice),n.questions},o}.apply(t,a))||(e.exports=i)},80037:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(34078),n(77026),n(98094),n(50705),n(21877)],void 0===(i=function(e,t,n,a,i,r){let o="http://commcareconnect.com/data/v1/learn",s={slug:"main",displayName:gettext("Basic"),properties:["nodeID"]},l={slug:"logic",displayName:gettext("Logic"),help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"},properties:["relevantAttr"]},d={xmlnsAttr:{presence:"optional",serialize:()=>{},deserialize:()=>{}},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}},u={isTypeChangeable:!1,isDataOnly:!0,supportsDataNodeRole:!0,getExtraDataAttributes:e=>({"vellum:role":e.__className}),getBindList:e=>{let t=c[e.__className];return[{nodeset:e.hashtagPath,relevant:e.p.relevantAttr}].concat(t.childNodes.filter((e=>!e.writeToData)).map((n=>({nodeset:`${e.absolutePath}/${t.rootName}/${n.id}`,calculate:e.p[n.id]}))))},parseDataNode:(t,n)=>{let a=n.children(),i=c[t.__className];if(1===a.length){let n=a[0];n.nodeName===i.rootName&&n.getAttribute("xmlns")===o&&e(n).children().each(((n,a)=>{let r=i.childNodes.find((e=>e.id===a.nodeName));r&&r.writeToData&&(t.p[a.nodeName]=e(a).text())}))}return e([])},dataChildFilter:(e,t)=>(e=c[t.__className].childNodes.map((e=>{let n={rawDataAttributes:null};return e.writeToData&&(n.dataValue=t.p[e.id]),new a.Node([],{getNodeID:()=>e.id,p:n,options:{getExtraDataAttributes:()=>{}}})})),[new a.Node(e,{getNodeID:()=>c[t.__className].rootName,p:{rawDataAttributes:null},options:{getExtraDataAttributes:()=>({xmlns:o,id:t.p.nodeID})}})])},c={ConnectLearnModule:{rootName:"module",childNodes:[{id:"name",writeToData:!0},{id:"description",writeToData:!0},{id:"time_estimate",writeToData:!0}],mugOptions:i.extend(u,{typeName:"Learn Module",icon:"fa fa-graduation-cap",init:e=>{e.p.name="",e.p.description="",e.p.time_estimate=""},spec:i.extend(d,{nodeID:{lstring:gettext("Module ID")},name:{lstring:gettext("Name"),visibility:"visible",presence:"required",widget:r.text},description:{lstring:gettext("Description"),visibility:"visible",presence:"required",widget:r.richTextarea},time_estimate:{lstring:gettext("Time Estimate"),visibility:"visible",presence:"required",widget:r.text,validationFunc:e=>{let t=e.p.time_estimate;return t&&t.match(/^\d+$/)?"pass":gettext("Must be an integer")},help:gettext("Estimated time to complete the module in hours.")},relevantAttr:{visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"bool",serialize:n.serializeXPath,deserialize:n.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[t.extend({},s,{properties:["nodeID","name","description","time_estimate"]}),t.clone(l)]},ConnectAssessment:{rootName:"assessment",childNodes:[{id:"user_score"}],mugOptions:i.extend(u,{typeName:"Assessment Score",icon:"fa-brands fa-leanpub",init:e=>{e.p.user_score=""},spec:i.extend(d,{nodeID:{lstring:gettext("Assessment ID")},user_score:{lstring:gettext("User Score"),visibility:"visible",presence:"required",widget:r.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the users assessment score.")},relevantAttr:{visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"bool",serialize:n.serializeXPath,deserialize:n.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[t.extend({},s,{properties:["nodeID","user_score"]}),t.clone(l)]},ConnectDeliverUnit:{rootName:"deliver",childNodes:[{id:"name",writeToData:!0},{id:"entity_id"},{id:"entity_name"}],mugOptions:i.extend(u,{typeName:"Deliver Unit",icon:"fa fa-briefcase",init:e=>{e.p.name="",e.p.entity_id="",e.p.entity_name=""},spec:i.extend(d,{nodeID:{lstring:gettext("Delivery Unit ID")},name:{lstring:gettext("Name"),visibility:"visible",presence:"required",widget:r.text},entity_id:{lstring:gettext("Entity ID"),visibility:"visible",presence:"optional",widget:r.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the entity ID associated with this Delivery Unit e.g. the case ID.")},entity_name:{lstring:gettext("Entity Name"),visibility:"visible",presence:"optional",widget:r.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the name of the entity associated with this Delivery Unit.")},relevantAttr:{visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"bool",serialize:n.serializeXPath,deserialize:n.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[t.extend({},s,{properties:["nodeID","name","entity_id","entity_name"]}),t.clone(l)]}};e.vellum.plugin("commcareConnect",{},{getAdvancedQuestions:function(){return this.__callOld().concat(Object.keys(c))},getMugTypes:function(){let e=this.__callOld();return Object.entries(c).forEach((([t,a])=>{e.normal[t]=i.extend(n.defaultOptions,a.mugOptions)})),e},getSections:function(e){return Object.hasOwn(c,e.__className)?t.map(c[e.__className].sections,(e=>t.clone(e))):this.__callOld()},parseBindElement:function(e,t,n){let a=e.getMugByPath(n);if(a){if(Object.hasOwn(c,a.__className))return void(a.p.relevantAttr=t.xmlAttr("relevant"))}else if(Object.entries(c).some((([i,r])=>{let o=r.childNodes.map((e=>e.id)).join("|"),s=new RegExp(`/${r.rootName}/(${o})`),l=n.match(s);if(l&&l.length>0){let r=l[1];if(a=e.getMugByPath(n.replace(s,"")),a&&a.__className===i)return a.p[r]=t.xmlAttr("calculate"),!0}})))return;this.__callOld()}})}.apply(t,a))||(e.exports=i)},76827:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(34078),n(77026),n(98094),n(50705),n(21877)],void 0===(i=function(e,t,n,a,i,r){var o="http://commcarehq.org/ledger/v1",s=0,l=[{attr:"entryId",path:"entry/@id"},{attr:"quantity",path:"entry/@quantity"},{attr:"src",path:"@src"},{attr:"dest",path:"@dest"},{attr:"date",path:"@date"}],d={Balance:[{attr:"entryId",path:"entry/@id"},{attr:"quantity",path:"entry/@quantity"},{attr:"entityId",path:"@entity-id"},{attr:"date",path:"@date"}],Transfer:l,Dispense:l,Receive:l},u=t.mapObject(d,(function(e){return t.object(t.map(e,(function(e){return[e.path,e.attr]})))})),c={slug:"main",displayName:gettext("Basic"),properties:["nodeID","src","dest","sectionId","entryId","quantity","date"],help:{title:gettext("Basic"),text:"<p>"+i.format(gettext("The {questionid} is an internal identifier for a question. It does not appear on the phone. It is the name of the question in data exports."),{questionid:"<strong>"+gettext("Question ID")+"</strong>"})+"</p>",link:"https://help.commcarehq.org/display/commcarepublic/Transactions"}},p={slug:"logic",displayName:gettext("Logic"),help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"},properties:["relevantAttr"]},f={Balance:[t.extend({},c,{properties:["nodeID","entityId","sectionId","entryId","quantity"]}),p],Transfer:[c,p],Dispense:[c,p],Receive:[c,p]},h=i.extend(n.defaultOptions,{isDataOnly:!0,isTypeChangeable:!1,supportsDataNodeRole:!0,parseDataNode:function(t,n){return t.p.nodeID=t.p.rawDataAttributes.type||"tx-"+s++,delete t.p.rawDataAttributes.type,t.p.sectionId=t.p.rawDataAttributes["section-id"],delete t.p.rawDataAttributes["section-id"],e([])},getPathName:function(e,t){return e.options.getTagName()+"[@type='"+t+"']"},dataChildFilter:function(e,t){return[new a.Node(e,{getNodeID:function(){return"entry"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{id:"",quantity:""}}}})]},getBindList:function(e){var n=[{nodeset:e.hashtagPath,relevant:e.p.relevantAttr}];return t.each(d[e.__className],(function(t){var a=e.p[t.attr];a&&n.push({nodeset:e.hashtagPath+"/"+t.path,calculate:a})})),n},isHashtaggable:!1,spec:{date:{lstring:gettext("Date"),visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("The date and time of the action, e.g., now() or today()")},sectionId:{lstring:gettext("Balance ID"),visibility:"visible",presence:"optional",widget:r.text,help:gettext("The name of the balance you are tracking. This is an internal identifier which does not appear on the phone.")},entryId:{lstring:gettext("Product"),visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext('A reference to a product ID, e.g., "/data/products/current_product"')},quantity:{lstring:gettext("Quantity"),visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("A reference to an integer question in this form.")},relevantAttr:{visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"bool",serialize:n.serializeXPath,deserialize:n.deserializeXPath,lstring:gettext("Display Condition")}}}),g=i.extend(h,{typeName:"Balance",getTagName:function(){return"balance"},getExtraDataAttributes:function(e){var t=e.p.rawDataAttributes||{};return{xmlns:o,type:e.p.nodeID,"entity-id":t["entity-id"]||"","section-id":e.p.sectionId,date:t.date||""}},icon:"fcc fcc-fd-hash",init:function(e,t){e.p.entityId="",e.p.sectionId="",e.p.entryId="",e.p.quantity="",e.p.date="now()",M(e,t)},spec:{xmlnsAttr:{presence:"optional",serialize:function(){},deserialize:function(){}},nodeID:{serialize:I},entityId:{lstring:gettext("Case"),visibility:"visible",presence:"optional",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the case ID associated with this balance.")},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}}}),m=function(e){var t={key:"commtrack-transfer-src-dest-error",level:e.ERROR};return e.p.dest&&e.p.src||(t.message=gettext("Transfer must have both Source Case and Destination Case defined.")),e.addMessages({src:[t],dest:[t]}),"pass"},v=i.extend(h,{typeName:"Transfer",getTagName:function(){return"transfer"},isTypeChangeable:!0,typeChangeError:function(e,t){return"Balance"!==t&&"Balance"!==e.__className&&_(e)&&_({__className:t})?"":gettext("Cannot change $1 to $2").replace("$1",e.__className).replace("$2",t)},getExtraDataAttributes:function(t){var n=t.p.rawDataAttributes||{},a={xmlns:o,type:t.p.nodeID,date:n.date||"","section-id":t.p.sectionId};return t.p.src&&e.trim(t.p.src)?a.src=n.src||"":delete n.src,t.p.dest&&e.trim(t.p.dest)?a.dest=n.dest||"":delete n.dest,a},icon:"fa-solid fa-right-left",init:function(e,t){e.p.src="",e.p.dest="",e.p.sectionId="",e.p.entryId="",e.p.quantity="",e.p.date="now()",M(e,t)},spec:{nodeID:{serialize:I},xmlnsAttr:{presence:"optional",serialize:function(){},deserialize:function(){}},src:{lstring:gettext("Source Case"),visibility:"visible",presence:"required",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the case ID issuing the transaction."),validationFunc:m},dest:{lstring:gettext("Destination Case"),visibility:"visible",presence:"required",widget:r.xPath,xpathType:"generic",serialize:n.serializeXPath,deserialize:n.deserializeXPath,help:gettext("XPath expression for the case ID receiving the transaction."),validationFunc:m},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}}}),x=i.extend(v,{typeName:"Dispense",icon:"fa fa-sign-out",spec:{src:{validationFunc:function(e){return e.p.src?"pass":gettext("Dispense must have a Source Case.")}},dest:{presence:"notallowed"}}}),y=i.extend(v,{typeName:"Receive",icon:"fa fa-sign-in",spec:{src:{presence:"notallowed"},dest:{validationFunc:function(e){return e.p.dest?"pass":gettext("Receive must have a Destination Case.")}}}}),b=t.chain(d).map((function(e){return t.map(e,(function(e){return RegExp.escape(e.path)}))})).flatten().uniq().value(),w=new RegExp("/("+b.join("|")+")$");function _(e){return e&&d.hasOwnProperty(e.__className)}function M(e,t){t.addInstanceIfNotExists({id:"ledger",src:"jr://instance/ledgerdb"},e,"")}function I(e,t,n,a){var i=n.parentMug?n.absolutePathNoRoot+"/":"/";a.id=i+n.p.nodeID}e.vellum.plugin("commtrack",{},{getAdvancedQuestions:function(){return this.__callOld().concat(["Balance","Transfer","Dispense","Receive"])},getMugTypes:function(){var e=this.__callOld();return e.normal.Balance=g,e.normal.Transfer=v,e.normal.Dispense=x,e.normal.Receive=y,e},parseDataElement:function(n,a,i,r){var s=a.nodeName;if(!r&&("transfer"===s||"balance"===s)&&e(a).xmlAttr("xmlns")===o){if("transfer"===s){var l=e(a);r=t.isUndefined(l.xmlAttr("src"))?"Receive":t.isUndefined(l.xmlAttr("dest"))?"Dispense":"Transfer"}else r="Balance";return this.__callOld(n,a,i,r)}return this.__callOld()},parseBindElement:function(e,t,n){var a=e.getMugByPath(n);if(a){if(_(a))return void(a.p.relevantAttr=t.xmlAttr("relevant"))}else{var i=n.replace(w,"");if(n!==i&&_(a=e.getMugByPath(i))){var r=n.match(w)[1],o=u[a.__className][r];return void(a.p[o]=t.xmlAttr("calculate"))}}this.__callOld()},parseSetValue:function(e,t,n){var a=e.getMugByPath(n);if(!a){var i=n.replace(w,"");if(n!==i&&_(a=e.getMugByPath(i))){var r=n.match(w)[1],o=u[a.__className][r];return void(a.p[o]=t.xmlAttr("value"))}}this.__callOld()},getSections:function(e){return f.hasOwnProperty(e.__className)?t.map(f[e.__className],(function(e){return t.clone(e)})):this.__callOld()}})}.apply(t,a))||(e.exports=i)},81437:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(10023),n(34078),n(43809),n(98094),n(53578),n(21877)],void 0===(i=function(e,t,n,a,i,r,o){var s,l=["Form Builder clip","version 1"],d=e("<textarea></textarea>").css({position:"absolute",width:0,height:0}).css({top:-1e4,left:-1e4}).appendTo("body"),u=/Chrome/.test(navigator.userAgent),c=/Safari/.test(navigator.userAgent)&&!u;function p(t,n){0===t.length&&(t=e("body")),d.css({top:t.offset().top}),d.val(n),d.focus(),d.select()}function f(e,t){e.focus();var n=d.val();return t&&n&&d.val(""),n}var h=/^(null|true|false|\[[^]*\]|\{[^]*\}|"[^]*"|-?\d+(\.\d+)?([Ee][+-]?\d+)?)$/;function g(e){return t.isString(e)&&!h.test(e)?e:JSON.stringify(e)}function m(e){return h.test(e)?JSON.parse(e):e}function v(e){var t="1",n=/^(.*)Itext(?::([^-]+)-(.*))?$/.exec(e);return n&&(t="0","label"===n[1]&&(n[1]="!"),"default"===n[3]?n[3]="!":n[3]||(n[3]="~"),e=n[1]+" "+n[3]+" "+n[2]),t+e}function x(e){var t=s.data.core.mugTypes.allTypes[e];return t&&t.typeName||e}function y(e,t){for(var n,a;;){if(!e.parent||t.id.startsWith(e.id+"/")){a=e.id&&!t.id.startsWith(e.id+"/"),n=s.getInsertTargetAndPosition(e.mug,t.type,a);break}e=e.parent}if(n){for(;e.mug!==n.mug;){if(!e.parent)return n.error=gettext("Cannot insert $1 into $2").replace("$1",x(t.type)).replace("$2",x(e.mug.parentMug.__className)),n;e=e.parent}"after"===n.position?n.parent=e.parent:"last"===n.position||"into"===n.position?n.parent=e:n.error="Cannot insert $1 $2 $3".replace("$1",x(t.type)).replace("$2",n.position).replace("$3",x(n.mug.__className))}else n={},e.mug?n.error=gettext("Cannot insert $1 into or after $2").replace("$1",x(t.type)).replace("$2",x(e.mug.__className)):n.error=r.format(gettext("Cannot insert {type} into tree root"),{type:x(t.type)});return n}function b(){var e=w(!0),n=s.getCurrentlySelectedMug(!0);return o.usage("Copy Paste","Cut",n.length),o.workflow("Cut questions in form builder"),(n=t.filter(n,(function(e){return e.options.isCopyable})))&&n.length&&s.data.core.form.removeMugsFromForm(n),e}function w(e){var n=s.getCurrentlySelectedMug(!0,!0),a={};if(e||(o.usage("Copy Paste","Copy",n.length),o.workflow("Copy questions in form builder")),!n||!n.length)return"";var r={id:!0,type:!0},d=[],u=n[0].form,c=t.filter(t.flatten(t.map(n,(function e(n){if(!a.hasOwnProperty(n.ufid)&&(a[n.ufid]=!0,n.options.isCopyable)){var i=n.serialize(),o=u.getChildren(n);return t.each(i,(function(e,t){r.hasOwnProperty(t)||(d.push(t),r[t]=!0)})),o.length&&(i=[i].concat(t.map(o,e))),i}}))),t.identity);return 0===c.length?"":(d=["id","type"].concat(t.sortBy(d,v)),i.tabDelimit([l,d].concat(t.map(c,(function(e){return t.map(d,(function(n){var a=e[n];return g(t.isUndefined(a)?null:a)}))})))))}function _(e){o.workflow("Paste questions in form builder");var n=i.makeRowParser(e);if(!t.isEqual(n().slice(0,2),l))return[gettext("Unsupported paste format")];var r,d,u=s.data.core.mugTypes.allTypes,c=s.data.core.form,p=function(e){function n(e){var t=e.replace(/^#form/,"");return r.hasOwnProperty(t)?r[t].hashtagPath:e}var i=new a.MugMessages,r={},o=[],s={length:0,context:{addError:function(e){i.update(null,{key:e,level:a.ERROR,message:e})},errors:i,later:function(e){o.push(e)},transformHashtags:function(t){return e.transformHashtags(t,n)}},addMug:function(e,t){r[e]=t,s.length++},getErrors:i.get.bind(i),finish:function(){t.each(o,(function(e){e()}))}};return s}(c),f=p.context,h=s.getCurrentlySelectedMug(!0,!0),g=h.length?h[h.length-1]:null,v=n(),x=n(),b={id:null,mug:g,parent:null};for(s.beforeBulkInsert(c);x;x=n()){try{r=t.object(v,t.map(x,(function(e){return m(e)})))}catch(e){f.addError(gettext("Unsupported paste format:")+" "+x.join(", "));continue}u.hasOwnProperty(r.type)?(d=y(b,r)).hasOwnProperty("error")?f.addError(d.error):((g=c.createQuestion(d.mug,d.position,r.type,!0)).deserialize(r,f),p.addMug(r.id,g),b={id:r.id,mug:g,parent:d.parent}):f.addError(gettext("Unknown question type:")+" "+x.join(", "))}return p.finish(),s.afterBulkInsert(c),g&&d&&s.setCurrentMug(g),o.usage("Copy Paste","Paste",p.length),p.getErrors()}return e.vellum.plugin("copyPaste",{cut:b,copy:w,paste:_},{init:function(){var t=this.opts().copyPaste;s=this,e(document).on("cut copy paste keydown",(function(n){"cut"===n.type||"Ctrl+X"===r.getKeyChord(n)||("copy"===n.type||"Ctrl+C"===r.getKeyChord(n)?function(t){var n=e(":focus");if(n.is(".jstree-anchor")){var a=t.copy();a&&(p(n,a),setTimeout((function(){f(n)}),10))}}(t):"paste"!==n.type&&"Ctrl+V"!==r.getKeyChord(n)||function(t){var n=e(":focus");(0===n.length||n.parents(".fd-tree").length||n.is(d))&&(p(n),setTimeout((function(){var e=f(n,!0);if(e){var a=t.paste(e);a.length&&s._resetMessages([{level:"parse-warning",message:a}])}}),0))}(t))}))},displayMultipleSelectionView:function(){function t(){i.hide(),o.removeClass("hide"),s.val(w(!0))}this.__callOld();var a=e(n({metachar:r.isMac?"⌘":"Ctrl+",format:r.format})),i=a.find(".copy-paste-help"),o=a.find(".copy-paste-box"),s=o.find("textarea");c?(t(),setTimeout((function(){s.focus().select()}),1)):i.click((function(){t(),s.focus().select()})),s.focus((function(){s.select().mouseup((function(){return s.off("mouseup"),!1}))})).keyup((function(e){9===e.which&&s.select()})),a.find(".insert-questions").click((function(){_(s.val())})),this.$f.find(".fd-props-content").html(a)}}),{cut:b,copy:w,paste:_,stringify:g,valuify:m}}.apply(t,a))||(e.exports=i)},21877:(e,t,n)=>{var a,i;a=[n,n(9848),n(13946),n(10561),n(68101),n(54872),n(35674),n(70516),n(27133),n(78267),n(78019),n(64226),n(10348),n(97356),n(47649),n(71694),n(8426),n(51089),n(70579),n(34078),n(50705),n(94459),n(37417),n(77229),n(55382),n(98094),n(83876),n(53578),n(20939),n(62183),n(70426),n(21396),n(90952),n(45156),n(91460),n(9199),n(98671),n(29320),n(62591),n(46129),n(89103),n(70875),n(89385)],void 0===(i=function(e,t,a,i,r,o,s,l,d,u,c,p,f,h,g,m,v,x,y,b,w,_,M,I,C,A,k,P,T,N,D,S){setTimeout((function(){Promise.all([n.e(485),n.e(576)]).then((function(){var e=[n(15237),n(40576),n(24485)];(function(){}).apply(null,e)})).catch(n.oe)}),0);var E=A.isMac,R={Ctrl:"Ctrl+",Alt:"Alt+",Shift:"Shift+"};E&&(R={Ctrl:"⌘",Alt:"⌥",Shift:"⇧"});var O,L={error:{cssClass:"alert-danger",title:gettext("Error"),icon:"fa fa-exclamation-circle"},"parse-warning":{cssClass:"alert-warning",title:gettext("Warning"),icon:"fa fa-warning"},"form-warning":{cssClass:"alert-warning",title:gettext("Form Warning"),icon:"fa fa-info-circle"},info:{cssClass:"alert-info",title:gettext("Notification"),icon:"fa fa-info-circle"}},q={isCurrentlySelectedMugValid:function(){var e=this.getCurrentlySelectedMug();return!e||(e.validate(),!e.hasErrors())},init:function(){this.data.core.mugTypes=new b.MugTypesManager(this.getMugSpec(),this.getMugTypes(),this.opts());var e=this,n=this.opts().core.bindBeforeUnload;this.data.core.saveButton=t.init({save:function(t){var n=t&&t.altKey;n&&!window.confirm(gettext("Holding the ALT key while clicking save invokes an inefficient save procedure. Do this only if a normal save fails."))||(e.ensureCurrentMugIsSaved((function(){P.workflow("Clicked Save in the form builder"),e.validateAndSaveXForm(n)})),e.data.core.form.walkMugs((function(e){e.__originalNodeID=e.p.nodeID,e.dropMessage("nodeID","mug-nodeID-changed-warning")})))},unsavedMessage:gettext("Are you sure you want to exit? All unsaved changes will be lost!"),csrftoken:e.opts().csrftoken});var o=a.debounce((function(){var t,n="<div class='alert alert-danger'>{error}<br/>{action}</div>",a="<i class='fd-valid-alert-icon fa fa-warning'></i>";return e.data.core.form.hasBrokenReferences()?(t=gettext("Look for questions marked with $1 and check they don't reference deleted questions."),{title:gettext("Errors in Form"),content:A.format(n,{error:gettext("Form has reference errors."),action:t.replace("$1",a)})}):e.isCurrentlySelectedMugValid()?{title:"",content:""}:(t=gettext("Look for questions marked with $1 and fix the errors."),{title:"Validation Failed",content:A.format(n,{error:gettext("Form has validation errors."),action:t.replace("$1",a)})})}),500,!0);e.data.core.saveButton.ui.popover({title:function(){return o().title},content:function(){return o().content},html:!0,placement:"bottom",container:"body",trigger:"hover",sanitize:!1}),e.data.core.saveButton.ui.on("click",(function(){i(this).popover("hide")})),n(this.data.core.saveButton.beforeunload),this.data.core.lastSavedXForm=this.opts().core.form,this.$f.addClass("formdesigner");var s=a.extend({format:A.format},R);this.$f.empty().append(r(s)),i(document).on("keydown",(function(t){var n=A.getKeyChord(t);(q.hotkeys[n]||a.identity).call(e,t)})),i(document).on("click",".jstree-hover",(function(t){t.preventDefault();var n=i(this).data("ufid");e.scrollTreeTo(n),P.fbUsage("Clicked link to show in tree"),P.workflow("Clicked on easy reference popover's link to show in tree")})),i(window).on("hashchange",(function(){e.selectSomethingOrHideProperties(!0,window.location.hash)})),this._init_toolbar(),this._init_add_question(),this._createJSTree(),this.datasources=C.init(this.opts().core.dataSourcesEndpoint,this.opts().core.invalidCaseProperties)},postInit:function(){var e=this;function t(){e.opts().core.onReady.apply(e)}e.opts().features.allow_bulk_form_actions&&this._init_bulk_update_questions(),this._init_extra_tools(),M.init(this),this.loadXFormOrError(this.opts().core.form,(function(){setTimeout(t,0)}))},hotkeys:{"Ctrl+Alt+=":function(){this.data.core.$tree.jstree("open_all")},"Ctrl+Alt+-":function(){this.data.core.$tree.jstree("close_all")}},getMugTypes:function(){return b.baseMugTypes},_init_add_question:function(){var e=this,t=e.$f.find(".fd-add-question-dropdown");this.data.core.QUESTIONS_IN_TOOLBAR=[],a.each(e.getQuestionGroups(),(function(t){t.questions=a.map(t.questions,(function(t){var n=e.data.core.mugTypes[t],a=[t,n.typeName,n.icon];return e.data.core.QUESTIONS_IN_TOOLBAR.push(t),a}))})),t.find(".fd-add-question").after(i(o({groups:a.map(e.getQuestionGroups(),(function(t){var n=e.data.core.mugTypes[t.group[0]];return{name:t.group[1]||n.typeName,defaultQuestion:{slug:t.group[0],name:t.group[1]||n.typeName,icon:t.group[2]||n.icon},questions:a.map(t.questions,(function(t){var n=e.data.core.mugTypes[t];return{slug:t,name:n.typeName,icon:n.icon}}))}}))}))),t.find(".fd-question-type").click((function(t){i(this).hasClass("disabled")||e.addQuestion(i(this).data("qtype")),t.preventDefault()}))},_init_toolbar:function(){var e=this.$f.find(".fd-save-button");this.data.core.saveButton.ui.appendTo(e)},getQuestionGroups:function(){let e={group:["Image",gettext("Multimedia Capture")],questions:["Image","Audio","Video","Signature"]};return this.opts().features.support_document_upload&&e.questions.push("Document"),this.opts().features.case_micro_image&&e.questions.push("MicroImage"),[{group:["Text"],questions:["Text"]},{group:["Select",gettext("Multiple Choice")],questions:["Select","MSelect"]},{group:["Int",gettext("Number")],questions:["Int","PhoneNumber","Double"]},{group:["Date",gettext("Date")],questions:["Date","Time","DateTime"]},{group:["Group",gettext("Groups")],questions:["Group","Repeat","FieldList"]},e,{group:["Trigger"],questions:["Trigger"]},{group:["DataBindOnly",gettext("Hidden Value")],questions:["DataBindOnly"]},{group:["Geopoint",gettext("Advanced"),""],textOnly:!0,questions:this.getAdvancedQuestions()}]},getAdvancedQuestions:function(){return["Geopoint","Barcode","Secret"]},_init_bulk_update_questions:function(){var e=this,t=this.getBulkUpdateMenuItems(),n=this.$f.find(".fd-bulk-update-header");n.nextUntil(".divider").remove(),a(t).each((function(t){var r=i(A.format("<a tabindex='-1' href='#'>{name}</a>",a.extend(t))).click((function(n){n.preventDefault(),e.showConfirmBulkActionModal(t.confirmMessage,t.confirmAction)})),o=i("<li></li>").append(r);n.after(o),n=o}))},getBulkUpdateMenuItems:function(){var e=this,t=[{name:gettext("Make Required"),confirmMessage:gettext("You are about to make all existing questions on this form required. This action will overwrite the current configuration of this form and can only be undone by editing individual questions."),confirmAction:function(){e.makeAllQuestionsRequired()}}];return e.data.core.databrowser&&t.push({name:gettext("Load Default Values"),confirmMessage:gettext("You are about to set matching case properties as Default Values for all existing questions. This action will overwrite existing Default Values for all questions with matching case properties and can only be undone by editing individual questions."),confirmAction:function(){e.defaultMatchingQuestionsToCaseProperties()}}),t},makeAllQuestionsRequired:function(){this.data.core.form.walkMugs((function(e){e.spec.requiredAttr&&e.isVisible("requiredAttr")&&(e.p.requiredAttr=!0)})),this.refreshCurrentMug()},defaultMatchingQuestionsToCaseProperties:function(){var e=this,t=e.datasources.getHashtagMap({});e.data.core.form.walkMugs((function(e){if(e.isVisible("defaultValue")){var n="#case/"+e.p.nodeID,a="#user/"+e.p.nodeID;t.hasOwnProperty(n)?e.p.defaultValue=n:t.hasOwnProperty(a)&&(e.p.defaultValue=a)}})),e.refreshCurrentMug()},showConfirmBulkActionModal:function(e,t){var n,a=this;(n=this.generateNewModal(gettext("Are you sure you want to perform this action?"),[{title:gettext("Continue"),cssClasses:"btn-primary",action:function(){a.closeModal(),t()}}],gettext("Cancel"))).find(".modal-body").html(i("<p></p>").text(e)),n.modal("show")},_init_extra_tools:function(){var e=this,t=this.getToolsMenuItems(),n=this.$f.find(".fd-tools-menu");n.nextUntil(".divider").remove(),a(t).each((function(t){var r=t.hotkey||"",o="";r&&(q.hotkeys[r]=function(){t.action.apply(e,(function(){}))},o="<span class='hotkey'>"+(o=r.replace(/(Ctrl|Alt|Shift)\+/g,(function(e,t){return R[t]||t})))+"</span>");var s=i(A.format("<a tabindex='-1' href='#'><i class='{icon}'></i> {name}{key}</a>",a.extend({key:o},t))).click((function(n){n.preventDefault(),e.ensureCurrentMugIsSaved((function(){P.fbUsage("Tools",t.name),t.action.call(e,(function(){e.refreshVisibleData()}))}))})),l=i("<li></li>").append(s);n.after(l),n=l})),this.$f.find(".fd-expand-all").click((function(){e.data.core.$tree.jstree("open_all")})),this.$f.find(".fd-collapse-all").click((function(){e.data.core.$tree.jstree("close_all")})),this.$f.find(".fd-button-copy").click((function(){P.usage("Copy Paste","Copy Button"),P.workflow("Clicked Copy Button in form builder"),e.ensureCurrentMugIsSaved((function(){e.displayMultipleSelectionView();var t=e.jstree("get_selected");t.length&&i("#"+t[0]+" a").focus()}))})),this.$f.find(".fd-content-right").on("click",".fd-section-changer .dropdown-menu a",(function(t){var n=i(t.target);e.collapseSection(n.data("slug"),n.hasClass("selected"))}))},toggleFullScreen:function(){var e=this,t=gettext("Expand Editor"),n=gettext("Shrink Editor"),r=new RegExp(RegExp.escape(t)+"|"+RegExp.escape(n)),o=i(a.find(e.$f.find(".fd-tools-menu").nextAll(),(function(e){return i(e).find("a").text().match(r)}))).find("a"),s=o.html();P.fbUsage("Full Screen Mode",e.opts().core.formid),e.data.windowManager.fullscreen?(e.data.windowManager.fullscreen=!1,o.html(s.replace(new RegExp(RegExp.escape(n)),t))):(e.data.windowManager.fullscreen=!0,o.html(s.replace(new RegExp(RegExp.escape(t)),n))),o.find("i").toggleClass("fa-down-left-and-up-right-to-center").toggleClass("fa-up-right-and-down-left-from-center"),e.adjustToWindow(),e.opts().windowManager.toggleFullScreenCallback&&e.opts().windowManager.toggleFullScreenCallback(e.data.windowManager.fullscreen)},getToolsMenuItems:function(){var e=this;return[{name:gettext("Expand Editor"),icon:"fa-solid fa-up-right-and-down-left-from-center",hotkey:"Ctrl+Alt+F",action:function(t){e.toggleFullScreen()}},{name:gettext("Export Form Contents"),icon:"fa-regular fa-file-excel",action:function(t){e.showExportModal(t)}},{name:gettext("Edit Source XML"),icon:"fa fa-edit",action:function(t){e.showSourceXMLModal(t)}},{name:gettext("Form Properties"),icon:"fa-regular fa-rectangle-list",action:function(t){e.showFormPropertiesModal(t)}},{name:gettext("Find Usages"),icon:"fa fa-search",action:function(t){e.findUsages(t)}}]},refreshVisibleData:function(){var e=this;this.data.core.form.getMugList().map((function(t){e.refreshMugName(t)})),this.refreshCurrentMug()},refreshCurrentMug:function(){var e=this.getCurrentlySelectedMug();e&&this.displayMugProperties(e)},getMugDisplayName:function(e){var t=this.data.core.currentItextDisplayLanguage||this.data.javaRosa.Itext.getDefaultLanguage(),n=e.getDisplayName(t,!1);return n&&e._core_cachedDisplayNameKey===n?e._core_cachedDisplayNameValue:(e._core_cachedDisplayNameKey=n,n=e.form.richText?_.bubbleOutputs(n,this.data.core.form,!1):k.outputToXPath(n,e.form.xpath,!0),e._core_cachedDisplayNameValue=n,n)},_resizeFullScreenModal:function(e){var t,n,a;t=e.find(".modal-header").outerHeight(!1),n=e.find(".modal-footer").outerHeight(!1),a=i(window).height()-40-(n-t)-126,e.find(".modal-body").css("height",a+"px")},showSourceXMLModal:function(e){var t,a,r,o,l=this,d=this.data.core.form.isFormValid((function(e){return e.validate(),!e.hasErrors()}))?"":" <i class='fd-valid-alert-icon fa fa-warning'></i> "+gettext("Validation failed. Form may not perform correctly on your device!");t=this.generateNewModal(gettext("Edit Form's Source XML")+d,[{title:gettext("Update Source"),cssClasses:"btn-primary",action:function(){o.save(),l.loadXFormOrError(r.val(),(function(){t.modal("hide"),e()}),!0)}}]),a=i(s({description:gettext("This is the raw XML. You can edit or paste into this box to make changes to your form. Press 'Update Source' to save changes, or 'Close' to cancel.")})),t.addClass("fd-full-screen-modal").find(".modal-body").removeClass("form-horizontal").removeClass("form").html(a),this._resizeFullScreenModal(t),r=a.find("textarea"),this.data.core.formLoadingFailed?r.val(this.data.core.failedLoadXML):r.val(this.createXML()),o=n(15237).fromTextArea(r.get(0),{mode:"xml",lineNumbers:!0,viewportMargin:1/0}),t.modal("show"),t.one("shown.bs.modal",(function(){var e=t.find(".modal-body"),n=e.height(),a=e.find("p").outerHeight(!0);o.setSize("100%",n-a),o.refresh(),o.focus()}))},showExportModal:function(e){var t,n;t=this.generateNewModal(gettext("Export Form Contents"),[]),n=i(s({description:gettext("Copy and paste this content into a spreadsheet program like Excel to easily share your form with others.")})),t.find(".modal-body").html(n);var a=n.find("textarea");a.val(this.data.core.form.getExportTSV()),t.modal("show"),t.one("shown.bs.modal",(function(){a.focus()}))},showOverwriteWarning:function(e,t,n){var a,r,o=this;a=o.generateNewModal(gettext("Lost Work Warning"),[{title:gettext("Overwrite their work"),cssClasses:"btn-primary",defaultButton:!0,action:function(){i("#form-differences").hide(),e(t,"full"),o.closeModal()}},{title:gettext("Show XML Differences"),cssClasses:"btn-info",action:function(){i("#form-differences").show(),a.addClass("fd-full-screen-modal").removeClass("form-horizontal").find(".modal-body").html(r),o._resizeFullScreenModal(a),a.find(".btn-info").prop("disabled",!0)}}],gettext("Cancel"),"fa fa-warning"),r=i(l({description:gettext("Looks like someone else has edited this form since you loaded the page. Are you sure you want to overwrite their work?"),xmldiff:A.htmlXMLDiff(t,n||"")})),a.find(".modal-body").html(r),i("#form-differences").hide(),a.modal("show")},showFormPropertiesModal:function(){var e=this,t=this.generateNewModal(gettext("Edit Form Properties"),[]),n=t.find(".modal-body"),r=[{label:gettext("Disable Text Formatting"),slug:"noMarkdown",type:"checkbox",value:function(e,t){return t?e.prop("checked",t):e.prop("checked")}}];this.opts().features.rich_text&&r.push({label:gettext("Use Easy References"),slug:"richText",type:"checkbox",value:function(e,t){return t?e.prop("checked",t):e.prop("checked")}}),a.each(r,(function(t){var a=i(d({label:t.label,type:t.type||"text"}));n.append(a),a.find("input").val(e.data.core.form[t.slug]).on("change",(function(){var n=i(this),a=n.val();t.value&&(a=t.value(n)),e.data.core.form.setAttr(t.slug,a),e.refreshVisibleData()})),t.value&&t.value(a.find("input"),e.data.core.form[t.slug])})),t.modal("show"),t.one("shown.bs.modal",(function(){n.find("input:first").focus().select()}))},findUsages:function(){var e=this,t=this.generateNewModal(gettext("Use of each question"),[]),n=t.find(".modal-body"),r=e.data.core.form,o=r.findUsages();t.addClass("fd-full-screen-modal"),n.append(i(x())),n.append(i(v({tableData:o}))),this._resizeFullScreenModal(t),t.modal("show"),n.find(".link-to-question").click((function(){var n=i(this).text();return t.modal("hide"),e.setCurrentMug(r.getMugByPath(n)),!1})),n.find("#findUsagesSearch").on("keypress inserted.atwho",a.debounce((function(){var e=i.trim(this.value),t={};e?a.each(o,(function(n,i){i.includes(e)?t[i]=n:a.each(n,(function(n,a){a.includes(e)&&(t[i]||(t[i]={}),t[i][a]=n)}))})):t=o,n.find("table").remove(),n.append(i(v({tableData:t})))}),250)),T.autocomplete(i("#findUsagesSearch"),e.getCurrentlySelectedMug(),{useRichText:!0})},closeModal:function(e,t){var n=this,a=n.$f.find(".fd-modal-generic-container .modal");e&&a.one("hidden.bs.modal",(function(){e.apply(n)})),t&&a.removeClass("fade"),a.modal("hide")},generateNewModal:function(e,t,n,r){void 0===n&&(n=gettext("Close")),t.reverse(),t=a.map(t,(function(e){return e.cssClasses=e.cssClasses||"",e}));var o=this,s=o.$f.find(".fd-modal-generic-container");o.closeModal(void 0,!0);var l=i(g({title:e,closeButtonTitle:n,headerIcon:r}));return l.one("shown.bs.modal",(function(){l.find(".btn-default:last").focus()})),a.each(t,(function(e){e.defaultButton=e.defaultButton||!1,e.action=e.action||function(){o.closeModal()},l.find(".modal-footer").prepend(i(m(e)).click(e.action))})),s.html(l),l}},F=function(){var e=i("<div><div><i class='fa fa-spin fa-spinner'></i></div></div>");e.addClass("fd-form-saving"),i("body").append(e)},V=function(){i(".fd-form-saving").remove()};function j(e,t){var n=t.p.getDefinition(e);return n&&t.isVisible(e)?{widget:n.widget||w.text,options:i.extend(!0,{path:e},n)}:null}q.handleDropFinish=function(e,t,n,a){var i=e.closest(".xpath-expression-row").find(".op-select");if(e){w.util.getWidget(e,this).options.richText&&this.data.core.form.richText?_.editor(e).insertExpression(t):e.val(e.val()+t).change();var r,o=A.getReferenceName(t);switch(e[0].id){case"property-relevantAttr":r="Display";break;case"property-constraintAttr":r="Validation";break;case"property-calculateAttr":r="Calculation";break;default:r="Expression Editor"}P.usage(o,"Drag and Drop",r)}n&&i&&n.options.defaultOperator&&i.val(n.options.defaultOperator)},q._createJSTree=function(){O={"#":{valid_children:this.data.core.mugTypes.Group.validChildTypes},default:{icon:"fa fa-question-circle",max_children:0,valid_children:[]}},a(this.data.core.mugTypes.allTypes).each((function(e,t){O[t]={icon:e.icon,max_children:e.maxChildren,valid_children:e.validChildTypes}}));var e,t=this;this.data.core.$tree=e=this.$f.find(".fd-question-tree"),e.jstree({core:{data:[],worker:!1,multiple:!0,strings:{"New node":this.opts().core.noTextString},check_callback:function(e,n,a,i,r){return"move_node"!==e||t.checkMove(n.id,n.type,a.id,a.type,i)}},dnd:{copy:!1,inside_pos:"last"},types:O,conditionalevents:{should_activate:function(){return t.ensureCurrentMugIsSaved()},redraw_node:function(e){var t=Array.prototype.slice.call(arguments),n=this.parent.redraw_node.apply(this.inst,t);return e=this.inst.get_node(e),n&&e.data&&e.data.errors&&i(n).find("a > i").first().after(e.data.errors),n}},plugins:["themes","types","dnd","conditionalevents","actions"]}).on("select_node.jstree deselect_node.jstree",(function(e,n){var a=t.jstree("get_selected");if(a.length)if(a.length<2){var i=t.data.core.form.getMugByUFID(a[0]);t.displayMugProperties(i),t._setURLHash(i)}else t.displayMultipleSelectionView();else t.hideQuestionProperties()})).on("open_node.jstree",(function(e,n){window.event&&window.event.altKey&&t.jstree("open_all",n.node);var a=t.data.core.form.getMugByUFID(n.node.id);t.data.core.form.getDescendants(a).map((function(e){t.refreshMugName(e)}))})).on("close_node.jstree",(function(e,n){window.event&&window.event.altKey&&t.jstree("close_all",n.node)})).on("move_node.jstree",(function(e,n){var a=t.data.core.form,i=a.getMugByUFID(n.node.id),r="#"!==n.parent?a.getMugByUFID(n.parent):null,o=t.getRelativePosition(r,n.position);a.moveMug(i,o.position,o.mug),n.node.icon=i.getIcon(),t.refreshCurrentMug()})).on("model.jstree",(function(e,n){a(n.nodes).each((function(e){var n=t.jstree("get_node",e);n.data.mug&&(n.icon=n.data.mug.getIcon())}))}))},i(document).one("dnd_move.vakata.jstree",(function(e,t){i(document).on("dnd_move.vakata.jstree",(function(e,t){i(".jstree-drop").addClass("jstree-drop-active");var n=i(t.data.obj),a=i(t.event.target);i.jstree.reference(a)||a.vellum("get")!==n.vellum("get")||(a.closest(".jstree-drop").length?t.helper.find(".jstree-icon").removeClass("jstree-er").addClass("jstree-ok"):t.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"))})).on("dnd_stop.vakata.jstree",(function(e,t){i(".jstree-drop").removeClass("jstree-drop-active");var n=i(t.data.obj).vellum("get"),a=i(t.event.target);if(!i.jstree.reference(a)&&a.closest(".jstree-drop").length&&n===a.vellum("get")&&t.data.origin){var r=t.data.origin.get_node(t.data.nodes[0]);r.data&&r.data.handleDrop&&r.data.handleDrop(a.closest(".jstree-drop"),t.event)}}))})),q.scrollTreeTo=function(e){this.jstree("_open_to",e),this.jstree("hover_node",e);var t=i(".jstree-hovered");if(t.length){var n=t.closest(".fd-scrollable"),a=n.offset().top,r=n.height(),o=t.offset().top,s=t.height(),l=o-t.closest(".fd-question-tree").offset().top;(o<a||o+s>a+r)&&n.scrollTop(l-(r-s)/2)}},q.getRelativePosition=function(e,t){if(!a.isNumber(t))return{mug:e,position:t};if(0===t)return{mug:e,position:"first"};var n=this.jstree("get_node",e?e.ufid:"#");return t>n.children.length?{mug:e,position:"last"}:{mug:this.jstree("get_node",n.children[t-1]).data.mug,position:"after"}},q.checkMove=function(e,t,n,a,i){var r=this.data.core.form,o=r.getMugByUFID(n),s=r.getMugByUFID(e);return!!s&&("inside"===i&&(i="into"),!!this.isMugPathMoveable(s.hashtagPath)||("into"===i||"last"===i||"first"===i?s.parentMug===o:s.parentMug===o.parentMug))},q.onFormChange=function(e){this.data.core.saveButton.fire("change"),this.notifyUserActivity()},q.notifyUserActivity=function(){var e=Date.now(),t=this.opts().core.activityTimeout||3e5,n=this.opts().core.activityUrl;n&&(this.data.core.activityTimestamp?e-this.data.core.activityTimestamp>=t&&(this.data.core.activityTimestamp=e,a.isFunction(n)?n():i.get(n)):this.data.core.activityTimestamp=e)},q.jstree=function(){var e=this.data.core.$tree;return e.jstree.apply(e,arguments)},q.getCurrentlySelectedMug=function(e,t){var n=this.jstree("get_selected"),i=this.data.core.form;if(e){if(t&&n.length>1){var r=a.object(a.map(n,(function(e){return[e,!0]}))),o=n.length,s=[];return i.tree.walk((function(e,t,n){e&&r.hasOwnProperty(e.ufid)&&s.push(e),s.length!==o&&n()})),s}return a.map(n,i.getMugByUFID.bind(i))}return n.length?i.getMugByUFID(n[0]):null},q.getCurrentMugInput=function(e){return this.$f.find("[name=property-"+e+"]")},q.mugToXPathReference=function(e){return"Choice"===e.__className?"'"+e.p.nodeID+"'":e.ufid===this.getCurrentlySelectedMug().ufid?".":e.form.richText?e.hashtagPath:e.absolutePath},q.nodeIDFromLabel=function(e){var t=this.getMugDisplayName(e)||"";return t=(t=(t=(t=(t=(t=(t=(t=i("<div/>").html(t).text()).toLowerCase()).trim()).replace(/\s+/g,"_")).replace(/[^\w\-]/g,"")).replace(/^[^a-z]*/i,"")).replace(/_*$/g,"")).substring(0,75),e.form.generate_question_id(t,e)},q.ensureCurrentMugIsSaved=function(e){var t=this.getCurrentlySelectedMug();return this.data.core.hasXPathEditorChanged?(this.alert(gettext("Unsaved Changes in Editor"),gettext("You have UNSAVED changes in the Expression Editor. Please save changes before continuing.")),!1):(t&&!t.p.nodeID&&(t.p.nodeID=this.nodeIDFromLabel(t)),(e||function(){})(),!0)},q.loadXFormOrError=function(e,t,n){t=t||function(){};var a=this;a.opts().core.formLoadingCallback?a.opts().core.formLoadingCallback():F(),window.setTimeout((function(){a.data.core.formLoadingFailed=!1;try{a.data.core.parseWarnings=[],a.loadXML(e,{}),delete a.data.core.parseWarnings,a.data.core.form.fire("form-load-finished"),e?n&&a.data.core.saveButton.fire("change"):(a.$f.find(".fd-content-right .fd-column").addClass("hide"),a.$f.find(".fd-default-panel").removeClass("hide")),a.opts().core.formIconClass?a.$f.find(".fd-form-icon").addClass(a.opts().core.formIconClass):a.$f.find(".fd-form-icon").addClass("fa fa-edit"),a.opts().core.defaultHelpTextTemplateId&&a.$f.find(".fd-default-helptext").html(i(a.opts().core.defaultHelpTextTemplateId).html()).addClass("alert alert-info"),i(".fd-tree .fd-head-text").text(a.data.core.form.formName),a.opts().core.formLoadedCallback?a.opts().core.formLoadedCallback():V()}catch(t){window.console.log(A.formatExc(t));var r=t.toString();-1!==r.indexOf("Invalid XML")&&(r=gettext("Parsing Error. Please check that your form is valid XML.")),a.hideQuestionProperties();var o=a.generateNewModal(gettext("Error"),[],gettext("OK"),"fa fa-warning");throw o.find(".modal-body").text(r),o.modal("show"),a.data.core.formLoadingFailed=!0,a.data.core.failedLoadXML=e,a.opts().core.formLoadedCallback?a.opts().core.formLoadedCallback():V(),t}t()}),this.opts().core.loadDelay)},q.loadXML=function(e,t){var n,r=this,o=window.location.hash;r.data.core.$tree.children().children().each((function(e,t){r.jstree("delete_node",t)})),t=a.extend({mugTypes:this.data.core.mugTypes,allowedDataNodeReferences:this.opts().core.allowedDataNodeReferences,enableInstanceRefCounting:!0},t),this.data.core.form&&this.data.core.form.disconnectDataSources(),this.data.core.form=n=M.parseXForm(e,t,this,r.data.core.parseWarnings),this.onXFormLoaded(n),e&&(r._resetMessages(r.data.core.form.errors),r._populateTree(o)),n.on("question-type-change",(function(e){r.jstree("set_type",e.mug.ufid,e.qType),e.mug===r.getCurrentlySelectedMug()&&r.refreshCurrentMug()})).on("parent-question-type-change",(function(e){r.jstree("set_icon",e.childMug.ufid,e.childMug.getIcon())})).on("question-remove",(function(e){e.mug&&(e.mug.unbind(r.data.core),e.mug===r._propertiesMug&&(r._propertiesMug.teardownProperties(),r._propertiesMug=null));var t=r.getCurrentlySelectedMug();if(e.mug&&e.mug.parentMug&&e.mug.parentMug===t&&r.displayMugProperties(t),!e.isInternal){var a=r.jstree("get_prev_dom",e.mug.ufid);r.jstree("delete_node",e.mug.ufid),a?r.jstree("select_node",a):r.selectSomethingOrHideProperties()}e.mug._node_control=void 0,i(".fd-undo").click((function(){return r.ensureCurrentMugIsSaved(n.undo.bind(n)),!1})),i(".fd-undo-container").on("click",".close",(function(){n.undomanager.resetUndo()}))})).on("question-create",(function(e){r.handleNewMug(e.mug,e.refMug,e.position),r.setTreeActions(e.mug);var t=r.getCurrentlySelectedMug();e.mug&&e.mug.parentMug&&e.mug.parentMug===t&&r.displayMugProperties(t),e.isInternal||r.setCurrentMug(e.mug)})).on("change",(function(e){r.onFormChange(e.mug)})).on("question-label-text-change",(function(e){r.refreshMugName(e.mug),r.toggleConstraintItext(e.mug)})).on("change-display-language",(function(e){var t=r.getCurrentlySelectedMug();t&&r.refreshMugName(t)})).on("mug-property-change",(function(e){r.refreshMugName(e.mug),r.toggleConstraintItext(e.mug),"comment"===e.property&&e.val&&(r.$f.find(".fd-question-comment").show(),r.$f.find(".fd-question-comment").text(e.val))}))},q.onXFormLoaded=function(e){e.warnWhenChanged=this.opts().core.hasSubmissions,e.submissionUrl=this.opts().core.hasSubmissionsUrl},q.refreshMugName=function(e){var t=this.getMugDisplayName(e);t!==this.jstree("get_text",e.ufid)&&this.jstree("rename_node",e.ufid,t);var n=this.getCurrentlySelectedMug();n&&e.ufid===n.ufid&&this.$f.find(".fd-question-properties .fd-head h2").html(t)},q.toggleConstraintItext=function(e){var t=this.getCurrentlySelectedMug();if(!t||t.ufid===e.ufid){var n=e.p.constraintMsgItext&&(!e.p.constraintMsgItext.isEmpty()||e.p.constraintAttr),a=i(".itext-block-constraintMsg");n?a.removeClass("hide"):a.addClass("hide")}},q._populateTree=function(e){var t=this;this.data.core.form.walkMugs((function(e){t.handleMugParseFinish(e),t.createQuestion(e,e.parentMug,"into")&&(!e.validate()&&e.hasErrors()&&t.setTreeValidationIcon(e),t.setTreeActions(e))})),t.selectSomethingOrHideProperties(!0,e)},q.selectSomethingOrHideProperties=function(e,t){if(e&&this.jstree("deselect_all"),!this.jstree("get_selected").length){var n,a=this.data.core.$tree.find("li");if(t){var i=this.getMugByPath(t)||void 0,r=i&&i.ufid;r&&(n=a.filter("[id= "+r+"]"))}return n&&n.length>0?(this.jstree("select_node",n[0]),this.scrollTreeTo(n[0].id),!0):a.length>0?(this.jstree("select_node",a[0]),this.scrollTreeTo(a[0].id),!0):(this.jstree("deselect_all"),this.hideQuestionProperties(),this.$f.find(".fd-content-right .fd-column").addClass("hide"),this.$f.find(".fd-default-panel").removeClass("hide"),!1)}return!0},q.addQuestion=function(e,t,n){var a,i=this;return this.ensureCurrentMugIsSaved((function(){if(t){if(!/^(before|after|into|first|last)$/.test(t))throw new Error("bad position: "+t);if(!i.isInsertAllowed(e,t,n))throw new Error("cannot insert "+e+" "+t+" "+(n?n.hashtagPath:"root node"))}else{var r=i.getInsertTargetAndPosition(i.getCurrentlySelectedMug(),e);if(!r)throw new Error("cannot add "+e+" at the current position");t=r.position,n=r.mug}P.workflow("Added question in form builder"),a=i.data.core.form.createQuestion(n,t,e),i.scrollTreeTo(a.ufid),i.focusFirstInput()})),a},q.focusFirstInput=function(){var e=this.$f.find(".fd-question-properties .form-group:first");if(e.length){var t=e.find("input, textarea");t.length?t.focus():(t=e.find(".fd-textarea, .fd-input"),_.editor(t).focus())}},q.adjustToWindow=function(){this.data.windowManager.adjustToWindow()},q.getInsertTargetAndPosition=function(e,t,n){for(var a,i=n?"after":"last";e;){if("after"===i){if(!(a=e.parentMug)){if(!this.isInsertAllowed(t,i,e))return null;break}}else a=e;if(this.jstree("is_closed",a.ufid))e=a,i="after";else{if(-1!==O[a.__className].valid_children.indexOf(t))break;"after"!==i?i="after":e=e.parentMug}}return e||this.isInsertAllowed(t,i,e)?{mug:e,position:i}:null},q.isInsertAllowed=function(e,t,n){var a="#";if(n)if("after"===t||"before"===t)n.parentMug&&(a=n.parentMug.__className);else{if("into"!==t&&"first"!==t&&"last"!==t)throw new Error("validation of insert "+t+" "+n.__className+" not implemented");a=n.__className}else if("into"!==t&&"first"!==t&&"last"!==t)throw new Error("validation of insert "+t+" root node not implemented");return-1!==O[a].valid_children.indexOf(e)},q.handleNewMug=function(e,t,n){this.createQuestion(e,t,n)},q.createQuestion=function(e,t,n){var a=this;return e.on("messages-changed",(function(e){a.setTreeValidationIcon(e.mug)}),null,null,this.data.core),a.jstree("create_node",t?"#"+t.ufid:"#",{text:this.getMugDisplayName(e),type:e.__className,data:{mug:e,handleDrop:function(t,n){var i=a.mugToXPathReference(e);a.handleDropFinish(t,i,e,n)}},li_attr:{id:e.ufid,rel:e.__className},state:{opened:!0}},"into"===n?"last":n)},q.handleMugParseFinish=function(e){},q.getMugByPath=function(e){return this.data.core.form.getMugByPath(e)},q.setCurrentMug=function(e){this.jstree("deselect_all",!0).jstree("select_node",e.ufid)},q.displayMugProperties=function(e){var t=this.$f.find(".fd-question-properties");this.$f.find(".fd-default-panel").addClass("hide"),this.showContentRight(),t.addClass("hide"),this._setPropertiesMug(e);var n=this.$f.find(".fd-props-content").empty(),r=this.getSections(e),o=i("<div class='messages' />");this.$f.find(".fd-props-toolbar").html(this.getMugToolbar(e));for(var s=0;s<r.length;s++){var l=a.clone(r[s]);l.mug=e,l.properties=a(l.properties).map((function(t){return j(t,e)})).filter(a.identity),l.properties.length&&this.getSectionDisplay(e,l).appendTo(n)}function d(){o.empty().append(w.util.getMessages(e,null))}n.children().length?o.insertAfter(n.children().first()):o.appendTo(n),e.on("messages-changed",d,null,"teardown-mug-properties"),d(),this.$f.find(".fd-content-right .fd-column").addClass("hide"),t.removeClass("hide"),this.adjustToWindow(),this.$f.find(".fd-help a").fdHelp(),this.refreshMugName(e),this.toggleConstraintItext(e)},q._setURLHash=function(e){e&&void 0!==e.getNodeID()&&e.hashtagPath&&e.hashtagPath.startsWith("#")&&!e.hashtagPath.endsWith("/")?window.history.replaceState(null,null,e.hashtagPath):window.history.replaceState(null,null," ")},q._setPropertiesMug=function(e){if(this._propertiesMug){this._propertiesMug.teardownProperties();try{this._propertiesMug.validate()}catch(e){}}this._propertiesMug=e},q.displayMultipleSelectionView=function(){var e=this.getCurrentlySelectedMug(!0);this.showContentRight(),this.hideQuestionProperties(),this._setPropertiesMug(null),this.$f.find(".fd-props-toolbar").html(this.getMugToolbar(e,!0)),this.$f.find(".fd-props-content").empty(),this.showQuestionProperties()},q.showContentRight=function(){this.$f.find(".fd-content-right").show()},q.hideContentRight=function(){this.$f.find(".fd-content-right").hide()},q.showQuestionProperties=function(){this.$f.find(".fd-content-right .fd-column").addClass("hide"),this.$f.find(".fd-question-properties").removeClass("hide")},q.hideQuestionProperties=function(){this.$f.find(".fd-question-properties").addClass("hide")},q.displaySecondaryEditor=function(e){var t=this,n=this.$f.find(".fd-xpath-editor");n.find(".fd-head h2").text(e.headerText),e.DEBUG_MODE=!1,this.hideQuestionProperties();var a=e.done;e.done=function(e){a(e),t.data.core.hasXPathEditorChanged?(t.data.core.hasXPathEditorChanged=!1,n.addClass("hide"),t.refreshCurrentMug()):(n.addClass("hide"),t.showQuestionProperties())};var i=e.change;e.change=function(e){t.data.core.hasXPathEditorChanged=!0,i&&i(e)},t.$f.find(".fd-content-right .fd-column").addClass("hide"),n.removeClass("hide"),e.loadEditor(t.$f.find(".fd-xpath-editor-content"),e)},q.displayXPathEditor=function(e){e.headerText=gettext("Expression Editor"),e.loadEditor=function(e,t){n.e(485).then((function(){var a=[n(24485)];(function(n){n.showXPathEditor(e,t)}).apply(null,a)})).catch(n.oe)},this.displaySecondaryEditor(e)},q.alert=function(e,t,n){if(n=n||[],!this.data.core.isAlertVisible){var a=this;this.data.core.isAlertVisible=!0,n.length||n.push({title:gettext("OK"),defaultButton:!0});var r=this.generateNewModal(e,n,!1,"fa fa-warning");this.data.core.$modal=r,r.removeClass("fade"),t instanceof i?r.find(".modal-body").append(t):r.find(".modal-body").append(i("<p />").text(t)),r.modal("show").on("hide.bs.modal",(function(){a.data.core.isAlertVisible=!1}))}},q.alertUser=function(e){this._resetMessages([{level:"info",message:e}])},q.setTreeValidationIcon=function(e){var t=e.ufid&&this.jstree("get_node",e.ufid);if(t){var n=e.getErrors();if(n.length){var a=n.join("\n").replace(/"/g,"'");t.data.errors='<i class="fd-valid-alert-icon fa fa-warning" title="'+a+'"></i>'}else t.data.errors=null;this.jstree("redraw_node",t)}},q._resetMessages=function(e){var t,n=this.$f.find(".fd-messages");if(e.length>0){t=e[e.length-1];var a=function(){var e;n.html(h({messageType:L[t.level],messages:(e=t.message,"string"!=typeof e&&e instanceof Array||(e=[""+e]),e)})).fadeIn(500)};n.is(":visible")?n.fadeOut(500,a):a()}},q.sectionIsCollapsed=function(e){var t="collapse-"+e.slug;return"main"!==e.slug&&(localStorage.hasOwnProperty(t)?localStorage.getItem(t):e.isCollapsed)},q.collapseSection=function(e,t){var n=i(".fd-question-fieldset[data-slug='"+e+"']"),a=i(".fd-section-changer [data-slug='"+e+"']");t?(n.addClass("hide"),a.removeClass("selected")):(n.removeClass("hide"),a.addClass("selected")),localStorage.setItem("collapse-"+e,t?"1":"")},q.getSectionDisplay=function(e,t){var n=this,a=n.sectionIsCollapsed(t),r=i(c({fieldsetClass:"fd-question-edit-"+t.slug||0,fieldsetTitle:t.displayName,fieldsetSlug:t.slug,isCollapsed:!!a,help:t.help})),o=r.find(".fd-fieldset-content");return t.properties.map((function(t){var a=t.widget(e,i.extend(t.options,{vellum:n,displayXPathEditor:function(e){n.data.core.currentlyEditedProperty=t.options.path,n.displayXPathEditor(e)}}));a.setValue(a.currentValue),a.on("change",(function(){n.onFormChange(e)}));var r=a.getUIElement();w.util.setWidget(r,a),o.append(r),a.postRender&&a.postRender(),a.refreshMessages()})),r},q.getMugToolbar=function(e,t){var n=this,r=this.data.core.form,o=t?e:[e],s=i(f({comment:t?"":_.sanitizeInput(e.p.comment),isDeleteable:o&&o.length&&a.every(o,(function(e){return n.isMugRemoveable(e,e.hashtagPath)})),isCopyable:!t&&e.options.isCopyable,sections:t?[]:a.chain(n.getSections(e)).rest().filter((function(t){return a.some(a.map(t.properties,(function(t){return j(t,e)})))})).map((function(e){return a.extend({show:!n.sectionIsCollapsed(e)},e)})).value()}));return s.find(".fd-button-remove").click((function(){var e=n.getCurrentlySelectedMug(!0,!0);r.removeMugsFromForm(e),n.refreshCurrentMug()})),t||(s.find(".btn-toolbar.pull-left").prepend(this.getQuestionTypeChanger(e)),e.p.comment&&s.find(".fd-question-comment").show()),s},q.getQuestionTypeChanger=function(e){var t=this,n=this.isMugTypeChangeable(e,e.hashtagPath),a=i(p({currentQuestionIcon:e.getIcon(),currentTypeName:e.options.typeName,questions:n?function(e){for(var n=e.__className,a=t.data.core.mugTypes[n],i=t.data.core.QUESTIONS_IN_TOOLBAR,r=[],o=0;o<i.length;o++){var s=i[o],l=t.data.core.mugTypes[s];n===s||a.typeChangeError(e,s)||!l.isTypeChangeable||l.typeChangeError(e,n)||r.push({slug:i[o],name:l.typeName,icon:l.icon})}return r}(e):[]}));return a.find(".change-question").click((function(n){try{t.changeMugType(e,i(this).data("qtype"))}catch(e){window.alert(A.format(gettext("Sorry, {err}"),{err:e}))}n.preventDefault()})),a.addClass("fd-question-changer"),a},q.changeMugType=function(e,t){this.data.core.form.changeMugType(e,t),this.setTreeActions(e)},q.setTreeActions=function(e){var t=this,n=t.data.core.$tree,a="add_choice";e.options.canAddChoices?n.jstree(!0).add_action(e.ufid,{id:a,class:"fa fa-plus add_choice",text:" "+gettext("Add Choice"),after:!0,selector:"a",event:"click",callback:function(n,a,i,r){t.ensureCurrentMugIsSaved((function(){t.setCurrentMug(e),t.addQuestion("Choice")}))}}):n.jstree(!0).remove_action(e.ufid,a)},q.createXML=function(){return this.data.core.form.createXML()},q.canSerializeXForm=function(e,t){var n=this,a=this.data.core.form,r=this.data.core.currentItextDisplayLanguage,o=a.getSerializationWarnings();if(o.length){var s=i(u({errors:o,displayLanguage:r}));return e=e?" "+gettext("and")+" "+e:"",this.alert(gettext("There are errors in the form"),s,[{title:gettext("Fix Manually"),action:function(){n.data.core.$modal.modal("hide")}},{title:gettext("Fix Automatically")+e,cssClasses:"btn-primary",defaultButton:!0,action:function(){a.fixSerializationWarnings(o),n.data.core.$modal.modal("hide"),t(),n.refreshVisibleData()}}]),!1}return!0},q.validateAndSaveXForm=function(e){var t=this;if(this.canSerializeXForm(gettext("Save"),(function(){t.validateAndSaveXForm(e)}))){var n=this.createXML();try{I.parseXML(n)}catch(r){var a=gettext("It looks like your form is not valid XML. This can often happen if you use a reserved character in one of your questions. Characters to look out for are <, >, and &. You can still save, but you CANNOT LOAD THIS FORM again until you fix the XML by hand. What would you like to do?"),i=t.generateNewModal(gettext("Form Validation Error"),[{title:gettext("Fix the problem (recommended)"),cssClasses:"btn-primary",action:function(){t.closeModal()}},{title:gettext("Save anyway"),cssClasses:"btn-default",action:function(){t.closeModal(),t.send(n,e?"full":null)}}],!1,"fa fa-warning");return i.find(".modal-body").html(a),void i.modal("show")}this.send(n,e?"full":null)}},q.send=function(e,t){var n,i,r=this,o=this.opts().core,s=!1,l="patch"===(t=t||o.saveType)?o.patchUrl:o.saveUrl;if(F(),"patch"===t){s=!0;var d=new D;(n=d.patch_toText(d.patch_make(this.data.core.lastSavedXForm,e))).length>e.length&&o.saveUrl&&(t="full",l=o.saveUrl)}(i="patch"===t?{patch:n}:{xform:e}).case_references=JSON.stringify(this.data.core.form._logicManager.caseReferences()),s&&(i.sha1=S.SHA1(this.data.core.lastSavedXForm).toString()),this.data.core.saveButton.ajax({type:"POST",url:l,data:i,dataType:"json",error:function(){V()},success:function(t){if(s){if("conflict"===t.status){r.data.core.saveButton.fire("change");var n=r.opts().features.full_save_on_missing_conflict_xform;return void(a.isUndefined(t.xform)&&n?r.send(e,"full"):(V(),r.showOverwriteWarning(r.send.bind(r),e,t.xform)))}S.SHA1(e).toString()!==t.sha1&&(N.error("sha1's didn't match"),r.send(e,"full"))}V(),r.opts().core.onFormSave(t),r.data.core.lastSavedXForm=e,r._setURLHash(r._propertiesMug)}})},q.getSections=function(e){return[{slug:"main",displayName:gettext("Basic"),properties:this.getMainProperties(),help:{title:gettext("Basic"),text:"<p>"+A.format(gettext("The {displaytext} appears in the application. This text will not appear in data exports."),{displaytext:"<strong>"+gettext("Display Text")+"</strong>"})+"</p> ",link:"https://confluence.dimagi.com/display/commcarepublic/Form+Builder"}},{slug:"data_source",displayName:gettext("Data Source"),properties:this.getDataSourceProperties(),isCollapsed:!0,help:{title:gettext("Data Source"),text:gettext("You can configure an external data source like a case list or lookup table to use as the choices for a multiple choice question.")}},{slug:"logic",displayName:gettext("Logic"),properties:this.getLogicProperties(),isCollapsed:!0,help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"}},{displayName:gettext("Media"),slug:"content",properties:this.getMediaProperties(),isCollapsed:!0,help:{title:gettext("Media"),text:gettext("This will allow you to add images, audio or video media to a question, or other custom content."),link:"https://confluence.dimagi.com/display/commcarepublic/Multimedia+in+CommCare"}},{slug:"advanced",type:"accordion",displayName:gettext("Advanced"),properties:this.getAdvancedProperties(),isCollapsed:!0,help:{title:gettext("Advanced"),text:gettext("These are advanced settings and are not needed for most applications.  Please only change these if you have a specific need!"),link:"https://confluence.dimagi.com/display/commcarepublic/Application+Building"}}]},q.getMainProperties=function(){return["label","calculateAttr","nodeID","requiredAttr","readOnlyControl","itemsetData","imageSize"]},q.getDataSourceProperties=function(){return[]},q.getMediaProperties=function(){return["mediaItext"]},q.getLogicProperties=function(){return["relevantAttr","constraintAttr","repeat_count","defaultValue","requiredCondition"]},q.getAdvancedProperties=function(){return["dataSource","dataValue","xmlnsAttr","label","hintLabel","constraintMsgAttr","dataParent","appearance","comment"]},q.getMugSpec=function(){return b.baseSpecs},q.isMugRemoveable=function(e,t){return e.options.isRemoveable},q.isPropertyLocked=function(e,t){return!1},q.isMugPathMoveable=function(e){return!0},q.isMugTypeChangeable=function(e,t){return e.options.isTypeChangeable},q.handleMugRename=function(e,t,n,a,i,r,o){return e.handleMugRename(t,n,a,i,r,o)},q.duplicateMugProperties=function(e){},q.beforeSerialize=function(){},q.afterSerialize=function(){},q.beforeBulkInsert=function(e){},q.afterBulkInsert=function(e){this.refreshVisibleData()},q.parseDataElement=function(e,t,n,a){return M.parseDataElement(e,t,n,a)},q.parseBindElement=function(e,t,n){M.parseBindElement(e,t,n)},q.parseSetValue=function(e,t,n){M.parseSetValue(e,t,n)},q.performAdditionalParsing=function(e,t){},q.getControlNodeAdaptorFactory=function(e){return this.data.core.controlNodeAdaptorMap[e]},q.populateControlMug=function(e,t){return M.populateControlMug(e,t)},q.updateControlNodeAdaptorMap=function(e){},q.contributeToModelXML=function(e,t){},q.contributeToHeadXML=function(e,t){},q.contributeToAdditionalXML=function(e,t){},q.initMediaUploaderWidget=function(e){},q.destroy=function(){},i.vellum.plugin("core",{form:null,loadDelay:500,patchUrl:!1,hasSubmissions:!1,hasSubmissionsUrl:!1,saveUrl:!1,saveType:"full",staticPrefix:"",allowedDataNodeReferences:[],noTextString:"[no text]",onReady:function(){},onFormSave:function(e){},bindBeforeUnload:function(e){i(window).on("beforeunload",e)}},q)}.apply(t,a))||(e.exports=i)},21874:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(50705),n(69740)],void 0===(i=function(e,t,n,a){function i(t,n){var i=e(a()),r=i.find("[name=instance-id]"),o=i.find("[name=instance-src]"),s=i.find("[name=query]");function l(){return{id:r.val(),src:o.val(),query:s.val()}}t.empty().append(i),n.source&&(r.val(n.source.id||""),o.val(n.source.src||""),s.val(n.source.query||"")),n.change&&(r.on("change keyup",(function(){n.change(l())})),o.on("change keyup",(function(){n.change(l())})),s.on("change keyup",(function(){n.change(l())})));var d=function(e){t.find(".fd-data-source-editor").hide(),n.done(e)};i.find(".fd-data-source-save-button").click((function(){d(l())})),i.find(".fd-data-source-cancel-button").click((function(){d()})),n.onLoad&&n.onLoad(i)}function r(e){function n(e,a){return t.map(e,(function(e,i){var r=[],o={id:a.id,src:a.src,query:a.query+"/"+i,name:a.name+" - "+(e.name||i)};return t.isEmpty(e.structure)||e.no_option||(r=[o]),r.concat(n(e.structure,o))}))}return t.flatten(t.map(e,(function(e){var t={id:e.id,src:e.uri,query:"instance('"+e.id+"')"+e.path,name:e.name||e.id};return[t].concat(n(e.structure,t))})))}return{advancedDataSourceWidget:function(a,r,o){var s=n.text(a,r),l=n.util.getUIElement,d=n.util.getUIElementWithEditButton,u=s.getValue,c=s.setValue,p=null;function f(){return p.query=u(),p}function h(e){p=e,c(e.query||"")}return s.options.richText=!1,s.getUIElement=function(){var r=d(l(s.input,o),(function(){a.form.vellum.displaySecondaryEditor({source:f(),headerText:o,loadEditor:i,onLoad:function(e){n.util.setWidget(e,s)},done:function(e){t.isUndefined(e)||(h(e),s.handleChange())}})}));return e("<div></div>").append(r)},s.getValue=f,s.setValue=h,s},fixtureWidget:function(a,o,s){var l=gettext("Lookup table was not found in the project"),d=JSON.stringify({src:"",id:"",query:""});function u(e){return!e||t.all(t.map(e,t.isEmpty))}function c(){var e=h();return e?JSON.parse(e):d}function p(e){var t=d;u(e)||(t=JSON.stringify(e),f.equivalentOption(t)||f.addOption(t,l)),g(t),x=!0}var f=n.dropdown(a,o),h=f.getValue,g=f.setValue,m=o.getSource?o.getSource:c,v=o.setSource?o.setSource:p,x=!1;f.options.richText=!1,f.addOption(d,gettext("Loading..."));var y=a.form.vellum.datasources.onChangeReady((function(){var e,n=a.form.vellum.datasources.getDataSources();o.dataSourcesFilter&&(n=o.dataSourcesFilter(n)),x&&(e=c()),f.clearOptions();var i=r(n);f.addOptions(function(e){return t.map(e,(function(e){return{value:JSON.stringify(t.omit(e,"name")),text:e.name}}))}(i)),x&&!u(e)?p(e):i&&i.length&&p(t.omit(i[0],"name")),o.onOptionsLoaded&&o.onOptionsLoaded(n)}));return a.on("teardown-mug-properties",y,null,"teardown-mug-properties"),o.hasAdvancedEditor&&(f.getUIElement=function(){var r=n.util.getUIElementWithEditButton(n.util.getUIElement(f.input,s),(function(){a.form.vellum.displaySecondaryEditor({source:m(a),headerText:s,loadEditor:i,onLoad:function(e){n.util.setWidget(e,f)},done:function(e){t.isUndefined(e)||(v(e,a),f.handleChange())}})}));return r.find(".fd-edit-button").text("..."),e("<div></div>").append(r)}),f.getValue=c,f.setValue=p,f},autocompleteChoices:function(e,n){var a=t.find(e,(function(e){return e.uri===n}));return a?function(e){return e?t.flatten(function e(n){return t.map(n,(function(n,a){return[a].concat(t.map(e(n.structure),(function(e){return a+"/"+e})))}))}(e.structure)):[]}(a):[]},getPossibleFixtures:r}}.apply(t,a))||(e.exports=i)},45304:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(98094),n(50705),n(98922),n(51705)],void 0===(i=function(e,t,n,a,i,r){var o={};function s(n){var i=n.$f.find(".fd-external-sources-container"),r=i.find(".fd-external-resource-search input"),o=i.find(".fd-external-sources-tree");n.data.core.databrowser.errorContainer=i,o.on("after_open.jstree",(function(){e(".jstree-anchor").popover()})),o.on("redraw.jstree",(function(){e(".jstree-anchor").popover()})),o.jstree({core:{data:function(e,i){function r(){var e=n.datasources.getDataNodes([]);i.call(o,function(e,n){function i(e,t,i,r){for(var o,s=a.util.getWidget(i,n),l=s.mug.form.richText&&e.hashtag?e.hashtag:e.xpath;t;)t.id&&t.uri&&(o=s.addInstanceRef({id:t.id,src:t.uri}))!==t.id&&(l=s.mug.form.updateInstanceQuery(l,o,t.id)),t=t._parent;n.handleDropFinish(i,l,void 0,r)}var r=50;return t.chain(e).map((function e(n){var a=function(){return t.map(n.getNodes(),e)},o=!!n.recursive||a();return{text:n.name,icon:n.recursive||o.length?"fcc fcc-fd-external-case":"fcc fcc-fd-case-property",state:{opened:!n.recursive&&o.length<=r},children:o,data:{handleDrop:t.partial(i,n,n.sourceInfo),getNodes:n.recursive?a:null},a_attr:{"data-content":n.description,"data-container":"body","data-trigger":"hover"}}})).map((function e(n){var a=t.filter(n.children,(function(e){return e.children.length}));return n.children=t.filter(n.children,(function(e){return 0===e.children.length})),a=t.flatten(t.map(a,e)),[n].concat(a)})).flatten().value()}(e,n))}var o=this;e.data&&e.data.getNodes?i.call(this,e.data.getNodes()):n.datasources.isReady()?r():n.datasources.on("change",r,null,"change")},worker:!1,multiple:!1,check_callback:function(e,t,n,a,i){return!1}},search:{show_only_matches:!0},conditionalevents:{should_activate:function(){return!1}},plugins:["themes","conditionalevents","dnd","search"]}),r.keyup(t.debounce((function(){o.jstree(!0).search(r.val())}),250))}function l(t){var n=t.$f.find(".fd-accessory-pane"),a=n.find(".fd-head-external-sources").outerHeight(!0);if(n.height()>a)n.css("height",a+"px"),n.find(".fd-head-external-sources .fd-head-max-indicator i").removeClass("fa-circle-down").addClass("fa-circle-up"),e(window).resize();else{var i=t.$f.find(".fd-tree"),r=t.data.core.databrowser.panelHeight||.33*i.height();n.css("height",r+"px"),n.find(".fd-head-external-sources .fd-head-max-indicator i").removeClass("fa-circle-up").addClass("fa-circle-down"),e(window).resize(),o.initDataBrowser(t)}}return e.vellum.plugin("databrowser",{},{init:function(){var n,a,d,u=this,c=this.$f.find(".fd-tree"),p=this.$f.find(".fd-accessory-pane");u.data.core.databrowser={errorContainer:p,panelHeight:null},o.initDataBrowser=t.once(s),p.append(e(r())),n=p.find(".fd-head-external-sources"),a=n.outerHeight(!0)||0,p.data("min-size",a).height(Math.min(.33*c.height(),12*a)).resize((function(){p.height()>a+100&&(u.data.core.databrowser.panelHeight=p.height(),d=p.height()/e(".fd-content-left").height())})),d=p.height()/e(".fd-content-left").height(),e(window).scroll((function(){p.height()>a&&(p.height(e(".fd-content-left").height()*d),u.data.core.databrowser.panelHeight=p.height())})),p.find("#fdExternalSearch").on("keyup keypress",(function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1})),o.initDataBrowser(u),i.preventDoubleScrolling(p.find(".fd-scrollable")),u.datasources.on("error",(function(e){var t=u.data.core.databrowser.errorContainer;if(t){var n=gettext("Could not load app properties.")+"<br>";400===e.xhr.status?n+=e.xhr.responseText:n+=gettext("If this error persists, please report an issue."),t.find(".fd-external-sources-error").removeClass("hide").find(".help-block").html(n),t.find(".fd-external-sources-tree").addClass("hide")}}));var f=t.partial(l,u);p.parent().find(".fd-external-sources-divider").clickExceptAfterDrag(f),n.click(f)}}),o}.apply(t,a))||(e.exports=i)},55382:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(98094)],void 0===(i=function(e,t,n){var a={};function i(a){function r(e){a.cache={sources:e.length?e:[{id:"",uri:"",path:"",name:gettext("Not Found"),structure:{}}]},a.loading=!1,a.fire("change")}a.endpoint?t.isString(a.endpoint)?(a.loading=!0,e.ajax({type:"GET",url:a.endpoint,dataType:"json",success:r,error:function(e,t,r){a.fire({type:"error",xhr:e,errorType:t,error:r}),window.console.log(n.formatExc(r||t)),a.retryTimeout<8001&&(setTimeout((function(){i(a)}),a.retryTimeout),a.retryTimeout=2*a.retryTimeout)},data:{}})):a.endpoint(r):r([])}function r(e,t,n){var i=e.cache;if(i.hasOwnProperty(t))return i[t];var r=a[t](e);return void 0!==r?(i[t]=r,r):n}return a.sources=function(e){return e.loading||i(e),e.cache.sources},a.dataNodes=function(e){function n(e,t){if(e.length<=t)return e;let n="",a=e;for(;a.length>t;)n+=a.slice(0,t)+"\n",a=a.slice(t,a.length);return n+="\n"+a,n}function a(e,t){let a=e.split(" "),i="";for(let e of a)i+=n(e,t),i+=" ";return i.trim()}function i(n,i,r,s){return function(n,u){if(t.contains(e.invalidCaseProperties,u))return null;var c=i?i+"/"+u:u,p=function(e,n,a,i){var r={name:e.name||n,description:e.description||"",recursive:!1},s=e,u=null;if(!e.structure&&e.reference){var c=e.reference;if(s=l[c.source||i.id]){i=t.extend(t.omit(s,"structure"),{_parent:i,hashtag:c.hashtag});var p=a;if(a="instance('"+s.id+"')"+s.path,c.subset_filter&&c.subset_key&&c.subset&&(a+="["+c.subset_key+" = '"+c.subset+"']"),a+="["+c.key+" = "+p+"]",s.subsets&&c.subset){var f={id:c.subset};c.subset_key&&(f.key=c.subset_key),s=t.findWhere(s.subsets,f)||s}var h=s.name||s.id;h&&(r.name=h),d.hasOwnProperty(s.id)?r.recursive=!0:d[s.id]=!0}}return r.getNodes=function(){return null===u&&(u=o(s,a,i)),u},r}(n,u,c,r),f=p.name;return{name:f,description:a(p.description,43),hashtag:r.hashtag&&!s?r.hashtag+"/"+f:null,parentPath:i,xpath:c,index:s||!1,sourceInfo:r,getNodes:p.getNodes,recursive:p.recursive}}}function o(e,n,a){var r=t.chain(e&&e.structure).map((function(e,t){return e.merge?o(e,n+"/"+t,{_parent:a}):i(0,n,a)(e,t)})).flatten().compact().sortBy("text").value();return e&&e.related&&(r=t.chain(e.related).map((function(e,t){var r,o;return r={reference:e},o=e.index||"/index",i(0,n+o,a,!0)(r,t)})).sortBy("text").value().concat(r)),r}var s,l=r(e,"sources"),d={};if(l&&(l=l=t.indexBy(l,"id")).commcaresession){var u=l.commcaresession,c=t.omit(u,"structure"),p="instance('"+u.id+"')"+u.path;s=i(0,null,c)(u,p).getNodes()}return s},a.hashtags=function(e){var n=r(e,"dataNodes");return n?function e(n,a){return t.each(n,(function(t){t.index||(a.nodeMap[t.hashtag||t.xpath]=t),t.hashtag&&!t.index&&(a.map[t.hashtag]=t.xpath,a.transforms[t.sourceInfo.hashtag+"/"]=function(e){return t.parentPath+"/"+e}),t.recursive||e(t.getNodes(),a)})),a}(n,{map:{},nodeMap:{},transforms:{}}):void 0},a.nodeMap=function(e){var t=r(e,"hashtags");return t&&t.nodeMap},a.hashtagMap=function(e){var t=r(e,"hashtags");return t&&t.map},a.hashtagTransforms=function(e){var t=r(e,"hashtags");return t&&t.transforms},{init:function(e,a){var o=n.eventuality({endpoint:e,invalidCaseProperties:a});return o.reset=function(){o.retryTimeout=1e3,o.cache={}},o.isReady=function(){return void 0!==r(o,"sources")},o.getDataSources=function(e){return r(o,"sources",e)},o.getDataNodes=function(e){return r(o,"dataNodes",e)},o.getHashtagMap=function(e){return r(o,"hashtagMap",e)},o.getHashtagTransforms=function(e){return r(o,"hashtagTransforms",e)},o.getNode=function(e,t){var n=r(o,"nodeMap",{});return n.hasOwnProperty(e)?n[e]:t},o.onChangeReady=function(e){var t={};return o.isReady()&&e(),o.on("change",e,null,null,t),function(){o.unbind(t,"change")}},o.reset(),e&&t.isString(e)&&i(o),o}}}.apply(t,a))||(e.exports=i)},49832:(e,t,n)=>{var a,i;a=[n(10561),n(93436)],void 0===(i=function(e,t){return{showMenu:function(n,a,i,r){var o={"":gettext("No Formatting"),"%e/%n/%y":"d/m/yy e.g. 30/1/14","%a, %b %e, %Y":"ddd, mmm d, yyyy e.g. Thu, Jan 30, 2014"},s=e(t({formats:o}));e("body").append(s),s.find("li a").click((function(){var t=e(this).data("format");try{i(t)}finally{s.remove()}return!1})),s.css({top:a,left:n}).show(),r&&s.mouseleave((function(){s.fadeOut(400,(function(){s.remove()}))}))}}}.apply(t,a))||(e.exports=i)},62183:(e,t,n)=>{var a,i;a=[n(13946)],void 0===(i=function(e){return e.isUndefined(console)?{log:function(){},error:function(){}}:{log:function(){console.log.apply(console,arguments)},error:function(){console.error.apply(console,arguments)}}}.apply(t,a))||(e.exports=i)},48916:(e,t,n)=>{var a,i;a=[n(13946),n(17867)],void 0===(i=function(e,t){var n="`",a=/^[\w.\-]/;return{escapeDelimiters:function(e){return e.replace(/`/g,"``")},delimit:function(e){if(-1!==e.indexOf(n))throw new Error("cannot delimit: "+e);return n+e+n},transform:function(e,t,i){if(!e)return e;var r=function(e){for(var t=0,n=e.length,a=[];t<n-1;++t){var i=e.charCodeAt(t);i>=55296&&i<=56319&&(i=e.charCodeAt(t+1))>=56320&&i<=57343?(a.push(e.slice(t,t+2)),++t):a.push(e.charAt(t))}return a.push(e.charAt(t)),a}(e);t=t||function(e){return e};for(var o=0,s=r.length,l="",d="",u=0;u<s;u++){var c=r[u],p=r[u+1];0===o?c===n&&p===n?(l+=n,u++):c===n?o=1:l+=c:1===o&&(c===n?(o=0,l+=t(d),!i&&p&&a.test(p)&&(l+=" "),d=""):void 0!==p&&(d+=c))}return 1===o&&(l+=n+d),l},makeHashtagTransform:function(n){function a(e){var t=e.toHashtag;return e.toHashtag=function(e){var n=t(e);return null===n?null:s(n)},e}var i=t.makeXPathModels(n,a),r=t.createParser(i),o=i.HashtagExpr,s=e.identity;return i.HashtagExpr=function(e){return o.call(this,e),a(this),this},function(t,n){s=n;try{return r.parse(t).toHashtag()}catch(e){return t}finally{s=e.identity}}}}}.apply(t,a))||(e.exports=i)},65392:(e,t,n)=>{var a,i;a=[n,n(13946),n(10561),n(77026),n(84854),n(94459),n(17867),n(48916),n(66827),n(33629),n(98094),n(53578)],void 0===(i=function(e,t,a,i,r,o,s,l,d,u,c,p){var f,h;n.e(483).then((function(){var e=[n(85081),n(31307)];(function(e,t){f=e,h=t}).apply(null,e)})).catch(n.oe);var g=function(e,n,a,i){var r={},o={};return r.attributes=e,r.children=n||[],r.addReference=function(e,t){o&&(e?(o[e.ufid]||(o[e.ufid]={}),o[e.ufid][t||"."]=null):o=null)},r.dropReference=function(e,n){return!(!o||!o[e.ufid])&&(n?(delete o[e.ufid][n],t.isEmpty(o[e.ufid])&&delete o[e.ufid]):delete o[e.ufid],t.isEmpty(o))},t.isUndefined(a)||r.addReference(a,i),r},m=/(^)instance\((['"])([^'"]+)\2\)/i,v=/^#([^\/]+)/;function x(e,n,a){var o=this;this.setValues=[],this._setValueId=1,this._logicManager=new r.LogicManager(this,{allowedDataNodeReferences:e.allowedDataNodeReferences}),this.vellum=n,this.mugTypes=a,this.formName=n.opts().core.formName||gettext("New Form"),this.noMarkdown=!1,this.mugMap={},this.instanceMetadata=[g({})],this.knownInstances={},this.richText=!!n.opts().features.rich_text,this.mayDisableRichText=this.richText,this._inferHashtags=function(e){function n(e,t){function n(e){return t+"/"+e}return[e,function(t){return d[e]=n,n(t)}]}var a="instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]",i="instance('casedb')/cases/case[@case_id = "+a+"/index/parent]",r="instance('casedb')/cases/case[@case_id = "+i+"/index/parent]",o={hashtagTransformations:t.object([n("#case/",a),n("#case/parent/",i),n("#case/grandparent/",r),n("#user/","instance('casedb')/cases/case[@case_type = 'commcare-user'][hq_user_id = instance('commcaresession')/session/context/userid]")])},l=null,d=null,u=s.parser(o,(function(e){var t=e.hashtagToXPath;return e.hashtagToXPath=function(e){var n=t(e);return n!==o.hashtagMap[e]&&(o.hashtagMap[e]=n,l[e]=n),n},e}));return function(n,a){var i;l={},d={},o.hashtagMap=t.clone(e.hashtagMap),o.hashtagNamespaces=e.hashtagNamespaces;try{i=u.parse(n).toXPath()}catch(e){window.console.log(c.formatExc(e))}i===a&&t.some(l)&&(t.each(l,(function(t,n){e.initHashtag(n,t)})),t.each(d,(function(t,n){e.hashtagTransformations.hasOwnProperty(n)||(e.hashtagTransformations[n]=t)})))}}(this),this.shouldInferHashtags=this.richText,n.datasources.on("change",this._updateHashtags.bind(this),null,null,this),this._updateHashtags(),this.transformHashtags=l.makeHashtagTransform(this),this.tree=new i("data","control"),this.addHashtag("#form","/data"),this.tree.on("change",(function(e){o.fireChange(e.mug)})),this.enableInstanceRefCounting=e.enableInstanceRefCounting,this.errors=[],this.question_counter=1,this.xpath=s.parser(this),this.undomanager=new u,this.undomanager.on("reset",(function(e){o.vellum.adjustToWindow()})),c.eventuality(this),this.on("form-load-finished",(function(){o.fuse=new d(o)})).on("question-create",(function(){o.undomanager.resetUndo()})),this.disconnectDataSources=function(){n.datasources.unbind(o,"change")}}return x.prototype={_updateHashtags:function(){var e=this,n=e.vellum,a=e.hashtagMap;e.hashtagNamespaces={form:!0},e.richText?(e.hashtagMap=t.clone(n.datasources.getHashtagMap({})),e.invertedHashtagMap=t.invert(e.hashtagMap),e.hashtagTransformations=n.datasources.getHashtagTransforms({}),e.hasCaseHashtags=n.datasources.isReady(),e.shouldInferHashtags=!e.hasCaseHashtags,t.each(e.hashtagTransformations,(function(t,n){e.hashtagNamespaces[v.exec(n)[1]]=!0}))):(e.hashtagMap={},e.invertedHashtagMap={},e.hashtagTransformations={}),e.updateKnownInstances(t.chain(n.datasources.getDataSources([])).map((function(e){return[e.id,e.uri]})).object().value()),a&&t.each(a,(function(t,n){n.startsWith("#form/")&&e.addHashtag(n,t)})),e.fixBrokenReferences(),this._logicManager.validateExternalReferences()},inferHashtagMeanings:function(e,t){e&&s&&this.shouldInferHashtags&&this._inferHashtags(e,t)},isValidHashtag:function(e){return e=this.normalizeHashtag(e),this.hashtagMap.hasOwnProperty(e)},hasValidHashtagPrefix:function(e){var t=e.lastIndexOf("/");return-1!==t&&e.length>t+1&&this.hashtagTransformations.hasOwnProperty(e.substring(0,t+1))},addHashtag:function(e,t){this.hashtagMap[e]=t,this.invertedHashtagMap[t]=e},initHashtag:function(e,t){this.hashtagMap[e]||(this.addHashtag(e,t),this.hashtagNamespaces[v.exec(e)[1]]=!0)},removeHashtag:function(e){this.hashtagMap.hasOwnProperty(e)&&(delete this.invertedHashtagMap[this.hashtagMap[e]],delete this.hashtagMap[e])},normalize:function(e,t,n){if(!t||this.richText&&o.isInvalid(t))return t;try{return this.xpath.parse(t)[e]()}catch(e){return n?null:t}},normalizeHashtag:function(e,t){return this.normalize("toHashtag",e,t)},normalizeXPath:function(e){return this.normalize("toXPath",e)},getHashtagsInXPath:function(e){try{return new r.LogicExpression(e,this.xpath).getHashtags()}catch(e){return[]}},getLogicalXPath:function(e){var t=e,n=this;if(e=String(e),t&&n.richText&&function(e){if(!o.isInvalid(e))return!1;var t=o.unescapeHashtags(e,n);if(t)try{n.xpath.parse(t)}catch(t){if(/\bExpecting '.+', got 'LBRACK'$/.test(String(t)))return/`#[\w/]+`\s*\[.+\]/.test(e)}return!1}(e)){e=o.unescapeXPath(e,n);try{return n.xpath.parse(e),e}catch(e){}}return t},knownExternalReferences:function(){return this._logicManager.knownExternalReferences()},knownHashtagTransforms:function(){var e={},n=this.hashtagTransformations;return t.isEmpty(this.hashtagTransformations)||(e.prefixes=t.object(t.map(n,(function(e,t){return[t,e("")]})))),e},referenceHashtag:function(e,t,n){this.hasValidHashtagPrefix(e)&&(this.referenceInstance("casedb",t,n),this.referenceInstance("commcaresession",t,n))},dataTree:function(){var e=this.getBasePath().slice(1,-1),n=new i(e,"data"),a={},r=this;return this.tree.walk((function(e,t,i){if(e){if(e.options.isControlOnly)return;if(e.p.dataParent){var r=e.p.dataParent;a[r]?a[r].push(e):a[r]=[e]}else n.insertMug(e,"into",e.parentMug)}i()})),t.each(a,(function(e,t){for(var a=r.mugMap[r.normalizeHashtag(t)],i=0,o=e.length;i<o;i++)n.insertMug(e[i],"into",a)})),n},getBasePath:function(e){return"/"+this.tree.getRootNode().getID()+(e?"":"/")},fireChange:function(e){this.fire({type:"change",mug:e})},addInstanceIfNotExists:function(e,n,a){var i;if(e.src){if(!(i=t.find(this.instanceMetadata,(function(t){return t.attributes.src===e.src})))){var r=t.indexBy(this.instanceMetadata,(function(e){return e.attributes.id}));(i=e.id&&r.hasOwnProperty(e.id)?r[e.id]:null)&&i.internal?(i.internal=!1,i.attributes.src=e.src):((e=t.clone(e)).id=function(e,t){for(var n=(e||"data")+"-",a=1;!e||t.hasOwnProperty(e);)e=n+a,a++;return e}(e.id,r),i=null),this.knownInstances[e.id]={src:e.src}}}else{if(!e.id)throw new Error("unsupported: non-primary instance without id or src");(i=t.find(this.instanceMetadata,(function(t){return t.attributes.id===e.id})))?i.internal&&this.knownInstances.hasOwnProperty(e.id)&&(i.internal=!1,i.attributes.src=this.knownInstances[e.id].src):this.knownInstances.hasOwnProperty(e.id)&&t.defaults(e,this.knownInstances[e.id])}return i?(this.enableInstanceRefCounting&&i.addReference(n,a),i.attributes.id):(i=g({src:e.src,id:e.id},e.children,n||null,a),e.src||e.children||(i.internal=!0),this.instanceMetadata.push(i),e.id)},parseInstance:function(e,n,a){var i=e.match(m),r=null;if(i){var o=i[3],s=this.referenceInstance(o,n,a);s&&(r=t.clone(s.attributes))}return r},parseInstanceRefs:function(e,n,i){var o=new r.LogicExpression(e,this.xpath),s=this.knownInstances,l={};return o.analyze(),t.each(o.instanceRefs,(function(e,t){s.hasOwnProperty(t)&&s[t]&&(l[t]=c.extend(s[t]),l[t].children&&(l[t].children=a("<div>").append(l[t].children).html()))})),l},referenceInstance:function(e,n,a){function i(t){return t.attributes.id===e}var r=t.find(this.instanceMetadata,i);return this.enableInstanceRefCounting&&(r?r.addReference(n,a):(e=this.addInstanceIfNotExists({id:e},n,a),r=t.find(this.instanceMetadata,i))),r||null},updateInstanceQuery:function(e,t,n){var a=m;return n&&(a=new RegExp("(^|\\W)instance\\((['\"])"+RegExp.escape(n)+"\\2\\)","ig")),e.replace(a,"$1instance('"+t+"')")},updateKnownInstances:function(e){var n=this.knownInstances;if(e){var i=t.indexBy(this.instanceMetadata,(function(e){return e.attributes.id}));t.each(e,(function(e,r){if(e&&!n.hasOwnProperty(r)){e.children?n[r]={children:a(e.children)}:t.isString(e)?n[r]={src:e}:n[r]=e;var o=i[r];o&&o.internal&&(o.internal=!1,o.attributes.src=n[r].src)}}))}else t.each(this.instanceMetadata,(function(e){e.attributes.id&&(e.attributes.src?n[e.attributes.id]={src:e.attributes.src}:e.children&&(n[e.attributes.id]={children:e.children}))}))},dropInstanceReference:function(e,n,a){if(!this.enableInstanceRefCounting||!n)return!1;var i=t.find(this.instanceMetadata,(function(t){return t.attributes.src===e}));return!(!i||!i.dropReference(n,a)||(this.instanceMetadata=t.without(this.instanceMetadata,i),0))},dropAllInstanceReferences:function(e,n){this.instanceMetadata=t.filter(this.instanceMetadata,(function(t){return!t.dropReference(e,n)}))},addSetValue:function(e,n,a){var i=t.find(this.setValues,(function(t){return t.event===e&&t.ref===n}));return i?i.value=a:(i={_id:this._setValueId++,event:e,ref:n,value:a},this.setValues.push(i)),i},getSetValues:function(){return this.setValues},dropSetValues:function(e){this.setValues=t.reject(this.setValues,e)},setFormID:function(e){this.tree.setRootID(e),this.addHashtag("#form","/"+e)},setAttr:function(e,t){this[e]=t,"richText"===e&&t&&!this.hasCaseHashtags&&this._updateHashtags(),this.fire({type:"change"})},createXML:function(){return f.createXForm(this)},getMugList:function(){return this.tree.treeMap((function(e){if(!e.isRootNode)return e.getValue()}))},updateError:function(e){var t,n;if((n={}).message=(t=e).message,n.key=t.key,n.level=t.level||"form-warning",n.options=t,n.isMatch=function(e){return!(!this.key||!e.key)&&this.key===e.key},(e=n).key){for(var a=null,i=0;i<this.errors.length;i++)e.isMatch(this.errors[i])&&(a=this.errors.splice(i,1,e));a||this.errors.push(e)}else this.errors.push(e)},getSerializationWarnings:function(){var e=[];return this.walkMugs((function(t){var n=t.getSerializationWarnings();n.length&&e.push({mug:t,errors:n})})),e},fixSerializationWarnings:function(e){t.each(e||[],(function(e){e.mug.fixSerializationWarnings(e.errors)}))},isFormValid:function(e){return this.tree.isTreeValid(e)},findFirstMatchingChild:function(e,n){var a=e?this.tree.getNodeFromMug(e):this.tree.rootNode;return t.find(a.getChildrenMugs(),n)},insertMug:function(e,t,n){this.tree.insertMug(t,n,e)},moveMug:function(e,t,n){var a,i,r,o,s;if("rename"===t){if(a=n,!this.tree.getNodeFromMug(e))return void e.p.set("nodeID",a);i=e.p.nodeID,r=e.hashtagPath,o=s=e.parentMug}else{i=e.p.nodeID,r=e.hashtagPath,o=e.parentMug,this.insertMug(n,e,t);var l=e.spec.dataParent;l&&"pass"!==l.validationFunc(e)&&e.p.set("dataParent"),a=e.p.conflictedNodeId||i,s=e.parentMug}e.options.isControlOnly||(this.findFirstMatchingChild(s,(function(t){return t!==e&&t.p.nodeID===a}))?(e.p.conflictedNodeId=a,a=this.generate_question_id(a,e)):e.p.has("conflictedNodeId")&&(e.p.conflictedNodeId=null),e.p.nodeID!==a&&e.p.set("nodeID",a));var d=e.hashtagPath;this.vellum.handleMugRename(this,e,a,i,d,r,o),"rename"!==t&&this.fireChange(e)},walkMugs:function(e){this.tree.walk((function(t,n,a){null!==t&&e(t),a()}))},getDescendants:function(e){var t,n=this.getChildren(e);for(t=n.length-1;t>=0;t--)n=n.concat(this.getDescendants(n[t]));return n},handleMugRename:function(e,n,a,i,r,o){if(this._logicManager.updatePath(e.ufid,r,i),i){for(var s,l,d=this.getDescendants(e).concat([e]),u=t(d).map((function(e){return e.hashtagPath})),c=new RegExp("^"+RegExp.escape(i)+"/"),p={},f=0;f<d.length;f++)u[f]&&(s=(l=u[f])===i?r:l.replace(c,r+"/"),p[d[f].ufid]=[s,u[f]],this._updateMugPath(d[f],s,u[f]));if(this._logicManager.updatePaths(p),this.fixBrokenReferences(),a&&"Choice"!==e.__className){var h=this.findFirstMatchingChild(o,(function(e){return e.p.conflictedNodeId===a}));h&&this.moveMug(h,"rename",a)}return p}},changeMugType:function(e,t){this.mugTypes.changeType(e,t)},getChildren:function(e){var t=this.tree.getNodeFromMug(e);return(t?t.getChildren():[]).map((function(e){return e.getValue()}))},duplicateMug:function(e){var t=this._duplicateMug(e,e.parentMug),n=t[0],a=t[1];p.workflow("Form Builder","Copy",n.options.typeName);for(var i=0;i<a.length;i++){var r=a[i];this._logicManager.updatePath(r.mugId,r.from,r.to,n.hashtagPath)}return n},_duplicateMug:function(e,t,n){n=n||0;var a=this.mugTypes.make(e.__className,this,e);if(0===n){var i=e.p.nodeID;a.p.conflictedNodeId?a.p.conflictedNodeId=null:a.p.nodeID=this.generate_question_id(i,e),this.insertQuestion(a,e,"after",!0)}else this.insertQuestion(a,t,"into",!0);this.updateLogicReferences(a),this.vellum.duplicateMugProperties(a);for(var r=this.getChildren(e),o=[],s=0;s<r.length;s++)o=o.concat(this._duplicateMug(r[s],a,n+1)[1]);return o.push({mugId:e.ufid,from:e.hashtagPath,to:a.hashtagPath}),[a,o]},updateLogicReferences:function(e,t,n){this._logicManager.updateReferences(e,t,n)},shouldMugPropertyChange:function(e,t,n,a){return this.isLoadingXForm?function(){}:function(){e.fire({type:"property-changed",property:t,val:n,previous:a});var i={type:"mug-property-change",mug:e,property:t,val:n,previous:a};e.validate(t),this.fire(i),this.fireChange(e)}.bind(this)},createQuestion:function(e,t,n,a){var i=this.mugTypes.make(n,this);return a&&!i.options.isControlOnly&&(i.p.nodeID=this.generate_question_id()),"Choice"===i.__className&&(i.p.nodeID=""),this.insertQuestion(i,e,t,a),"Choice"===i.__className&&(i.dropMessage("labelItext","mug-labelItext-error"),i.dropMessage("nodeID","mug-nodeID-error")),i},insertQuestion:function(e,t,n,a){this.mugMap[e.ufid]=e,t=t||this.tree.getRootNode().getValue(),this.insertMug(t,e,n),this._updateMugPath(e),this.fire({type:"question-create",mug:e,refMug:t,position:n,isInternal:a}),a||e.options.afterInsert(this,e)},_updateMugPath:function(e,n,a){var i,r=this.mugMap;delete r[this.normalizeHashtag(n)],n&&this.removeHashtag(n),t.isUndefined(a)?(i=e.absolutePath,a=e.hashtagPath):(i=a.replace(/^#form/,this.getBasePath(!0)))===a&&(i=null),a&&(i&&this.addHashtag(a,i),r[this.normalizeHashtag(a)]=e)},_fixMugState:function(e){this.mugMap[e.ufid]=e;var t=e.absolutePath;t&&(this.addHashtag(e.hashtagPath,t),this.mugMap[this.normalizeHashtag(e.hashtagPath)]=e)},fixBrokenReferences:function(){var e=this.updateLogicReferences.bind(this);this._logicManager.forEachBrokenReference(e)},hasBrokenReferences:function(){return this._logicManager.hasBrokenReferences()},isReferencedByOtherMugs:function(e,n){var a=t.object(t.map(n,(function(e){return[e.ufid,null]})));return a[e.ufid]=null,this._logicManager.hasReferencingMug(e,(function(e){return!a.hasOwnProperty(e.ufid)}))},getAbsolutePath:function(e,t){return e&&!e.options.isControlOnly?this.tree.getAbsolutePath(e,t):null},getMugByUFID:function(e){return this.mugMap[e]},getMugByPath:function(e){return e?this.mugMap[this.normalizeHashtag(e)]:null},getIconByPath:function(e){var t=this.getMugByPath(e);return t?t.getIcon():null},removeMugsFromForm:function(e){var n=this,a={},i={};this.undomanager.resetUndo(),n._addToUndoManager(e),t.each(e,(function(e){n._removeMugFromForm(e,i,!1)})),this._logicManager.forEachReferencingProperty(i,(function(e,t){e&&!a.hasOwnProperty(e.ufid+" "+t)&&(a[e.ufid+" "+t]=null,n.updateLogicReferences(e,t))}))},_addToUndoManager:function(e){var n=this.tree,a={},i=[];t.each(e,(function e(t){if(!a.hasOwnProperty(t.ufid)){a[t.ufid]=null;var r=n.getNodeFromMug(t),o=t.parentMug,s=t.previousSibling,l=s===o?"first":"after";if(i.push([t,s,l]),r){var d=r.getChildrenMugs();d.length;for(var u=0;u<d.length;u++)e(d[u])}}})),this.undomanager.setUndo(i)},_removeMugFromForm:function(e,n,a){if(n.hasOwnProperty(e.ufid))return;n[e.ufid]=null;var i=this.tree.getNodeFromMug(e);const r=e.absolutePath;if(i){for(var o=i.getChildrenMugs(),s=0;s<o.length;s++)this._removeMugFromForm(o[s],n,!0);delete this.mugMap[this.normalizeHashtag(e.hashtagPath)],this.tree.removeMug(e)}this.enableInstanceRefCounting&&(this.instanceMetadata=t.filter(this.instanceMetadata,(function(t){return!t.dropReference(e)}))),this._logicManager.clearReferences(e),delete this.mugMap[e.ufid],this.fire({type:"question-remove",mug:e,absolutePath:r,isInternal:a})},isUniqueQuestionId:function(e,n){var a;if(n){var i=this.tree.getNodeFromMug(n);a=this.tree.getParentNode(i).getChildrenMugs()}else a=this.getMugList();return!t.any(a,(function(t){return t.p.nodeID===e}))},generate_question_id:function(e,t){if(!e)return this._make_label(t&&"Choice"===t.__className?"choice":"question",t);var n=/^copy-(\d+)-of-(.+)$/.exec(e);n&&(e=n[2]);for(var a=e,i=1;;i++){if(this.isUniqueQuestionId(a,t))return a;a="copy-"+i+"-of-"+e}},generate_item_label:function(e,n,a){var i,r=(e?this.tree.getNodeFromMug(e):this.tree.rootNode).getChildrenMugs();n||(n="choice"),arguments.length<3&&(a=r.length+1);do{i=n+a++}while(t.any(r,(function(e){return e.p.nodeID===i})));return i},_make_label:function(e,t){var n;do{n=e+this.question_counter,this.question_counter+=1}while(!this.isUniqueQuestionId(n,t));return n},getExportTSV:function(){this.vellum.beforeSerialize();var e=h.generateExportTSV(this);return this.vellum.afterSerialize(),e},undo:function(){this.undomanager.undo(),this.fixBrokenReferences(),this.vellum.selectSomethingOrHideProperties()},findUsages:function(e){return this._logicManager.findUsages(e)}},{Form:x,InstanceMetadata:g}}.apply(t,a))||(e.exports=i)},66827:(e,t,n)=>{var a,i;a=[n(13946),n(10375),n(98094)],void 0===(i=function(e,t,n){var a={keys:["displayPath"],tokenize:!0,tokenSeparator:/\/+/g,threshold:.4};function i(n){var i=this;function s(e){l(e),i.dataset.push(r(e.mug)),i.fusejs.set(i.dataset)}function l(t){i.dataset=e.filter(i.dataset,(function(e){return e.id!==t.mug.ufid}))}this.form=n,n.vellum.datasources.on("change",(function(){i.dataset=o(n),i.fusejs.set(i.dataset)}),null,null,n),n.on("change",(function(e){void 0===e.mug&&(i.dataset=o(n),i.fusejs.set(i.dataset))})),this.dataset||(this.dataset=o(n)),this.fusejs=new t(this.dataset,a),this.form.on("mug-property-change",(function(e){"nodeID"===e.property&&s(e)})).on("question-label-text-change",s).on("question-create",s).on("question-remove",l)}function r(e){if(e){var t=e.form.vellum.getMugDisplayName(e);return{id:e.ufid,name:e.absolutePath,hashtagPath:e.hashtagPath,absolutePath:e.absolutePath,displayPath:e.form.richText?e.hashtagPath:e.absolutePath,icon:e.options.icon,questionId:e.p.nodeID,displayLabel:n.truncate(t),label:t,mug:e}}return null}function o(t){var n=[];return t.richText&&(n=e.chain(t.vellum.datasources.getHashtagMap({})).map((function(e,t){return{name:t,hashtagPath:t,absolutePath:e,icon:"fcc fcc-fd-case-property",displayLabel:null,displayPath:t}})).value()),e.chain(t.getMugList()).map(r).filter((function(t){return t.name&&!e.isUndefined(t.displayLabel)})).value().concat(n)}return i.prototype={list:function(){return this.fusejs.list},search:function(e){return this.fusejs.search(e)}},i}.apply(t,a))||(e.exports=i)},38360:(e,t,n)=>{var a,i;a=[n(13946),n(10561),n(77229),n(37417),n(21877)],void 0===(i=function(e,t,n,a){var i=new XMLSerializer,r=n.parseXML,o="parent";t.vellum.plugin("ignore",{},{loadXML:function(n,a){if(this.data.ignore.ignoredNodes=[],n){var o=this,s=[],l=r(n),d=l.find('[vellum\\:ignore="retain"]');if(this.data.ignore.active=d.length,this.data.ignore.active){a.enableInstanceRefCounting=!1,this.data.ignore.ignoredMugs=[];var u=l.find("h\\:xdoc > h\\:head > model").first(),f=u.find("instance").first(),h=l.find("h\\:xdoc > h\\:body, h\\:xdoc > body").first();e.each([u,f,h],(function(e){e.length||window.console.log("WARNING",e.tagName,"not found")})),(d=d.not((function(n,a){var i=e.any(t(a).parents(),(function(n){return f.is(n)||h.is(n)||e.any(d,(function(e){return t(e).is(n)}))}));return i||"bind"!==a.nodeName?i:t(a).parent().is(u)}))).each((function(e,t){o.data.ignore.ignoredNodes.push(function(e){var t,n,a=e,r=[];for(t=c(e,"previous"),n=c(e,"next"),e=e.parentElement;e;)r.unshift(p(e)),e=e.parentElement;var o=i.serializeToString(a).replace(/xmlns="(.*?)"/,"");return{prev:t,next:n,path:r.join(" > "),nodeXML:"\n"+o}}(t)),s.push(t)})),e.each(s,(function(e){e.parentElement.removeChild(e)})),this.__callOld(i.serializeToString(l[0]),a)}else this.__callOld()}else this.__callOld()},createXML:function(){var n=this.__callOld(),a=this.data.ignore.ignoredNodes;if(!this.data.ignore.active)return n;var o=t(r(n));e.each(a,(function(e){"h\\:xdoc > h\\:body"===e.path?e.path="h\\:xdoc > body, h\\:xdoc > h\\:body":"h\\:xdoc > h\\:head"===e.path&&(e.path="h\\:xdoc > head, h\\:xdoc > h\\:head");var t=o.find(e.path),n=r(e.nodeXML)[0].childNodes[0],a=e.prev&&t.find(e.prev),i=e.next&&t.find(e.next);a&&a.length?a.first().after(n):i&&i.length?i.first().before(n):t.append(n)}));var s=0;return i.serializeToString(o[0]).replace(/ xmlns=""/g,"").replace(/ xmlns:vellum="(.+?)"/g,(function(e){return s++?"":e}))},getMugTypes:function(){var e=this.__callOld();return e.normal.Ignored=s,e},parseDataElement:function(e,n,i){if(this.data.ignore.active){var r=t(n);if("retain"===r.xmlAttr("vellum:ignore")){var o=e.mugTypes.make("Ignored",e);return o.p.nodeID=n.nodeName,o.p.rawDataAttributes=a.getAttributes(n),r.children().length?o.p.dataNodeXML=u(r).replace(/^<[^>]+>([^]*)<\/[^>]+>$/,"$1"):o.p.dataNodeXML="",this.data.ignore.ignoredMugs.push(o),o}}return this.__callOld()},parseBindElement:function(e,t,n){if(this.data.ignore.active){n=e.normalizeXPath(n);var i=e.getMugByPath(n);if(i||(i=l(n,e)),i&&"Ignored"===i.__className||"retain"===t.xmlAttr("vellum:ignore")){var r,s;if(i&&"Ignored"===i.__className)r=i.absolutePath,s="mug";else{var u=null;i&&(u=i.options.isSpecialGroup?i:i.parentMug),i=d(e,u),e.tree.insertMug(i,"into",u),e._fixMugState(i),r=u?u.absolutePath:e.getBasePath(!0),s=o,this.data.ignore.ignoredMugs.push(i)}return void i.p.binds.push({path:n.startsWith(r)?n.slice(r.length):n,relativeTo:n.startsWith(r)?s:null,attrs:a.getAttributes(t)})}}this.__callOld()},parseSetValue:function(e,t,n){if(this.data.ignore.active){n=e.normalizeXPath(n);var a=e.getMugByPath(n);if(a||(a=l(n,e)),a&&"Ignored"===a.__className||"retain"===t.xmlAttr("vellum:ignore")){if(a&&"Ignored"===a.__className)a.absolutePath;else{var i=null;a&&(i=a.options.isSpecialGroup?a:a.parentMug),a=d(e,i),e.tree.insertMug(a,"into",i),e._fixMugState(a),i?i.absolutePath:e.getBasePath(!0),this.data.ignore.ignoredMugs.push(a)}return void a.p.setValues.push({ref:t.xmlAttr("ref"),event:t.xmlAttr("event"),value:t.xmlAttr("value")})}}this.__callOld()},getControlNodeAdaptorFactory:function(e){var t=this.__callOld();if(this.data.ignore.active){var n=this.data.ignore.ignoredMugs;return function(e,i,r,o){function s(){var t;return c&&"Ignored"===c.__className||(c=d(r,o),n.push(c)),(t=e).length&&t[0].poppedAttributes&&t.xmlAttr(t[0].poppedAttributes),c.p.controlNode=u(e),c}s.skipPopulate=!0;var l=a.getPathFromControlElement(e,r,o,!0),c=r.getMugByPath(l);if("retain"===e.xmlAttr("vellum:ignore"))return s.ignoreDataNode=c&&"Ignored"!==c.__className,s;if(c&&"Ignored"===c.__className)return s;var p=Array.prototype.slice.call(arguments);return t&&t.apply(null,p)}}return t},getSections:function(e){return this.data.ignore.active&&"Ignored"===e.__className?[{slug:"advanced",type:"accordion",displayName:"Advanced",properties:["nodeID"],isCollapsed:!0,help:{title:gettext("Advanced"),text:gettext("This question represents advanced content that is not supported by the form builder. Please only change it if you have a specific need!")}}]:this.__callOld()},handleMugRename:function(t,n,a,i,r,o){const s=this.__callOld();if(this.data.ignore.active&&o){o=o.replace(/^#form\//,t.getBasePath(!0)+"/"),r=t.normalizeXPath(r);var l=RegExp.escape(o),d=new RegExp(l+"(\\W|$)","g"),u=r+"$1";e.each(this.data.ignore.ignoredNodes,(function(e){e.nodeXML=e.nodeXML.replace(d,u)})),e.each(this.data.ignore.ignoredMugs,(function(t){t.p.controlNode&&(t.p.controlNode=t.p.controlNode.replace(d,u)),e.each(t.p.binds,(function(t){t.attrs=e.object(e.map(t.attrs,(function(e,t){return[t,e.replace(d,u)]})))}))}))}return s}});var s={typeName:gettext("Ignored XML"),icon:"fa fa-question-circle",isTypeChangeable:!1,isRemoveable:!1,isCopyable:!1,ignoreHashtags:!0,isHashtaggable:!1,init:function(e){e.p.binds=[],e.p.setValues=[]},parseDataNode:function(e,n){return t([])},getTagName:function(e,t){return e.p.rawDataAttributes?t:null},writeDataNodeXML:function(e,t){t.p.dataNodeXML&&e.writeXML(t.p.dataNodeXML)},getBindList:function(t){return e.map(t.p.binds,(function(n){var a=e.clone(n.attrs),i="";if("mug"===n.relativeTo)i=t.absolutePath;else if(n.relativeTo===o){var r=t.parentMug;i=r?r.absolutePath:t.form.getBasePath(!0)}return a.nodeset=i+n.path,a}))},getSetValues:function(e){return e.p.setValues},writesOnlyCustomXML:!0,writeCustomXML:function(e,t){t.p.controlNode&&e.writeXML(t.p.controlNode)},spec:{label:{presence:"notallowed"},labelItext:{presence:"notallowed"},labelItextID:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},hintItextID:{presence:"notallowed"},helpItext:{presence:"notallowed"},helpItextID:{presence:"notallowed"},mediaItext:{presence:"notallowed"},otherItext:{presence:"notallowed"},appearance:{presence:"notallowed"}}};function l(e,t){for(var n=null,a=/[\/[][^\/[]+$/;!n&&e&&a.test(e);)(e=e.replace(a,""))&&(n=t.getMugByPath(e));return n}function d(e,t){var n=e.mugTypes.make("Ignored",e);return n.p.nodeID=e.generate_item_label(t,"ignored--",1),n}function u(e){var t=i.serializeToString(e[0]),n=t.indexOf(">");return-1===n?t:t.slice(0,n).replace(/ xmlns(:.*?)?="(.*?)"/g,"")+t.slice(n)}function c(e,t){var n=p(e[t+"ElementSibling"]);return n&&n+", "+n.replace(/\w+:([^:]*)$/,"$1")}function p(e){if(!e)return null;var n=t(e),a=n.xmlAttr("nodeset"),i=n.xmlAttr("ref"),r=n.xmlAttr("id");return"setvalue"===(n.prop("tagName")||"").toLowerCase()?'[event="'+n.xmlAttr("event")+'"][ref="'+i+'"]':a?'[nodeset="'+a+'"]':i?'[ref="'+i+'"]':r?'[id="'+r+'"]':e.nodeName.replace(":","\\:")}}.apply(t,a))||(e.exports=i)},85465:(e,t,n)=>{var a,i;a=[n(34078),n(50705),n(98094),n(77229),n(13946),n(10561),n(21877)],void 0===(i=function(e,t,n,a,i,r){"use strict";var o,s="http://opendatakit.org/xforms",l=["androidIntentAppId","docTemplate","androidIntentExtra","androidIntentResponse","unknownAttributes","intentXmlns"];function d(e,t){return{androidIntentAppId:t||"",intentXmlns:s,androidIntentExtra:{},androidIntentResponse:{},unknownAttributes:{},nodeID:e}}var u=function(e,t){var n={};return i.each(e.find(t),(function(e){var t,a=r(e),o=a.xmlAttr("key");t=a.xmlAttr("ref"),n.hasOwnProperty(o)?i.isArray(n[o])?n[o].push(t):n[o]=[n[o],t]:n[o]=t})),n},c=function(e,t,a,r){a&&i.each(a,(function(a,o){o&&i.each(i.isArray(a)?a:[a],(function(a){e.writeStartElement(t),e.writeAttributeString("key",o),r?n.writeHashtags(e,"ref",a,r):e.writeAttributeString("ref",a),e.writeEndElement()}))}))};function p(e,t,n){var a,r=(a=t.androidIntentAppId,i.find(o,(function(e){return e.value===a})));e.writeStartElement("odkx:intent"),e.writeAttributeString("xmlns:odkx",t.intentXmlns),e.writeAttributeString("id",t.nodeID),e.writeAttributeString("class",t.androidIntentAppId),r&&r.type&&e.writeAttributeString("type",r.type),i.each(t.unknownAttributes,(function(t,n){e.writeAttributeString(n,t)})),c(e,"extra",t.androidIntentExtra,n),t.docTemplate&&c(e,"extra",{"cc:print_template_reference":"'"+t.docTemplate+"'"}),c(e,"response",t.androidIntentResponse,n),e.writeEndElement("odkx:intent")}function f(e,t){if("AndroidIntent"===t.__className||"PrintIntent"===t.__className){var n=t.p.nodeID,a=e.hasOwnProperty(n)?e[n]:d(n);i.each(l,(function(e){t.p[e]||(t.p[e]=a[e])})),delete e[a.nodeID]}"org.commcare.dalvik.action.PRINT"===t.p.androidIntentAppId?t.form.changeMugType(t,"PrintIntent"):t.p.androidIntentAppId||(t.p.androidIntentAppId=o[0].value),"PrintIntent"===t.__className&&t.p.androidIntentExtra["cc:print_template_reference"]&&(t.p.docTemplate=t.p.androidIntentExtra["cc:print_template_reference"].replace(/^'|'$/g,""),delete t.p.androidIntentExtra["cc:print_template_reference"])}function h(e,t,n,a){a[t]=i.clone(n.p[t]),""===a[t][""]&&delete a[t][""]}var g=n.extend(e.defaultOptions,{typeName:gettext("Android App Callout"),dataType:"intent",tagName:"input",icon:"fcc fcc-fd-android-intent",isTypeChangeable:!1,init:function(e,t){e.p.intentXmlns=e.p.intentXmlns||s},spec:{androidIntentAppId:{lstring:gettext("External App"),visibility:"visible",widget:function(e,n){n.defaultOptions=o;var a=n.vellum.opts().features;return v(a)||x(a)?t.dropdown(e,n):t.dropdownWithInput(e,n)},noCustom:!0,placeholder:gettext("Insert Android Application ID"),deserialize:function(e,t,n){e.intent?(n.p.androidIntentAppId=e.intent.path||"",i.each([["intentXmlns","xmlns"],["androidIntentExtra","extra"],["androidIntentResponse","response"],["unknownAttributes","unknownAttributes"]],(function(t){var a=t[0],r=t[1];i.isEmpty(e.intent[r])||(n.p[a]=e.intent[r])}))):n.p[t]=e[t]},validationFunc:function(e){var t,a=e.form.vellum.opts(),r=a.features,s=a.core.externalLinks.changeSubscription,l=gettext("change your subscription");if(s=s?"["+l+"]("+s+")":l,v(r))return n.format(gettext("You no longer have access to built in or external integration in your application.\n\nBuilt in integrations are available on the Pro plan and higher. External integrations are available on the Advanced plan and higher. Before you can make a new version of your application, you must {link} or delete this question."),{link:s});if(x(r)&&(t=e.p.androidIntentAppId,i.chain(o).map((function(e){return e.value})).find((function(e){return e===t})).isUndefined().value()))return n.format(gettext("Your subscription only has access to built-in integration.\n\nExternal integrations are available on the Advanced plan and higher. Before you can make a new version of your application, you must {link} or delete this question."),{link:s});var d=i.filter(e.form.getMugList(),(function(e){return e.p.androidIntentAppId}));if(d.length>1){var u=i.countBy(d,(function(e){return e.p.nodeID}));i.each(d,(function(e){(u[e.p.nodeID]>1?e.messages.update("nodeID",{key:"intent-nodeID-duplicate",level:e.ERROR,message:gettext("Android app callouts of the same type must have different question ids.")}):e.dropMessage("nodeID","intent-nodeID-duplicate"))&&e.fire({type:"messages-changed",mug:e})}))}return"pass"}},androidIntentExtra:{lstring:gettext("Extra"),visibility:"visible",widget:t.baseKeyValue,serialize:h},androidIntentResponse:{lstring:gettext("Response"),visibility:"visible",widget:t.baseKeyValue,serialize:h},unknownAttributes:{visibility:"hidden",presence:"optional",serialize:h},intentXmlns:{visibility:"hidden",presence:"optional",lstring:gettext("Special Intent XMLNS attribute")}},getAppearanceAttribute:function(e){return"intent:"+e.p.nodeID}}),m=n.extend(g,{typeName:gettext("Print"),icon:"fa fa-print",init:function(e,t){g.init(e,t),e.p.androidIntentAppId="org.commcare.dalvik.action.PRINT"},spec:{docTemplate:{lstring:gettext("Document Template"),visibility:"visible",widget:function(e,n){var a=t.abstractMediaWidget(e,n);return a.getBaseMediaPath=function(){return"jr://file/commcare/text/"+e.p.nodeID},a}},androidIntentAppId:{visibility:"hidden"}}});function v(e){return!e.custom_intents&&!e.templated_intents}function x(e){return e.templated_intents&&!e.custom_intents}r.vellum.plugin("intents",{},{init:function(){var e=this.opts().intents;o=i.map(e&&e.templates,(function(e){return{value:e.id,text:e.name,type:e.mime}}))},loadXML:function(e){var t,n;this.data.intents.unmappedIntentTags=(t=a.parseXML(e).find("h\\:head, head").children("odkx\\:intent, intent"),n={},i.each(t,(function(e){var t,a,o;a=(t=r(e)).xmlAttr("id"),(o=d(a,t.xmlAttr("class"))).xmlns=t.xmlAttr("xmlns:odkx")||o.intentXmlns,o.androidIntentExtra=u(t,"extra"),o.androidIntentResponse=u(t,"response"),i.chain(e.attributes).filter((function(e){return!i.contains(["id","class","xmlns:odk"],e.nodeName)})).each((function(e){o.unknownAttributes[e.nodeName]=e.nodeValue})),n[a]=o})),n),this.__callOld()},contributeToHeadXML:function(e,t){this.__callOld(),function(e,t,n){i.each(e,(function(e){p(t,e)})),n.treeMap((function(e){var n=e.getValue();n&&"intent"===n.options.dataType&&p(t,n.p,n)}))}(this.data.intents.unmappedIntentTags,e,t.tree)},handleNewMug:function(e){var t=this.__callOld();return f(this.data.intents.unmappedIntentTags,e),t},handleMugParseFinish:function(e){this.__callOld(),f(this.data.intents.unmappedIntentTags,e)},getMugTypes:function(){var e=this.__callOld();return e.normal.AndroidIntent=g,e.normal.PrintIntent=m,e},getAdvancedQuestions:function(){var e=this.__callOld();return v(this.opts().features)||(e.push("AndroidIntent"),this.opts().features.printing&&e.push("PrintIntent")),e},getMainProperties:function(){var e=this.__callOld().concat(l);return x(this.opts().features)&&(e=i.without(e,"androidIntentExtra","androidIntentResponse")),e}})}.apply(t,a))||(e.exports=i)},29333:(e,t,n)=>{var a,i;a=[n(13946),n(10561),n(50705),n(21874),n(34078),n(37417),n(98094),n(20939),n(62183)],void 0===(i=function(e,t,n,a,i,r,o,s,l){var d,u,c,p,f=i.baseMugTypes.normal,h=/\[[^\[\]]*\]$/;function g(e,t){var n=t.form.getChildren(t);if(n.length)return n[0];var i=x(t),r=e.createQuestion(t,"into","Itemset",!0);if(i.length){var o=i[0].uri,s="instance('"+i[0].id+"')"+i[0].path;(r=y(r,a.autocompleteChoices(i,o))).p.filter="",r.p.itemsetData={instance:e.parseInstance(s,r,"itemsetData"),nodeset:s}}return r}d=o.extend(i.defaultOptions,{isControlOnly:!0,typeName:gettext("Lookup Table Data"),tagName:"itemset",icon:"fa fa-th",isTypeChangeable:!1,isRemoveable:!1,isCopyable:!1,getIcon:function(e){return"fa fa-th"},init:function(e,t,n){e.p.itemsetData={}},writeControlLabel:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){var n=t.p.itemsetData.nodeset,a=t.p.filter,i=t.p.valueRef,r=t.p.labelRef,s=t.p.sortRef;a&&(n+="["+a+"]"),o.writeHashtags(e,"nodeset",n||"",t),e.writeStartElement("label"),e.writeAttributeString("ref",r||""),e.writeEndElement(),e.writeStartElement("value"),e.writeAttributeString("ref",i||""),e.writeEndElement();var l=t.form.vellum.opts().features;s&&s.trim()&&l.sorted_itemsets&&(e.writeStartElement("sort"),e.writeAttributeString("ref",s),e.writeEndElement())},spec:{label:{presence:"notallowed"},labelItext:{presence:"notallowed"},labelItextID:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},hintItextID:{presence:"notallowed"},helpItext:{presence:"notallowed"},helpItextID:{presence:"notallowed"},mediaItext:{presence:"notallowed"},otherItext:{presence:"notallowed"},appearance:{presence:"notallowed"},itemsetData:{lstring:gettext("Lookup Table"),visibility:"visible_if_present",presence:"optional",widget:function(n,i){function r(t){return!t||e.all(e.map(t,e.isEmpty))}function o(e){var i=m(),r=a.autocompleteChoices(e,i?i.src:"");return s.autocomplete(t("#property-valueRef"),n,{choices:r}),s.autocomplete(t("#property-labelRef"),n,{choices:r}),s.autocomplete(t("#property-sortRef"),n,{choices:r}),r}function l(e){if(p=e,f=!0,h){var t=o(e);t&&t.length&&r(d.value)&&(n=y(n,t),d.hasOwnProperty("value")&&b())}}i=e.extend({},i,{onOptionsLoaded:l,dataSourcesFilter:c.dataSourcesFilter}),u&&(i.hasAdvancedEditor=!0,i.getSource=function(e){var t=m();return e.p.filter&&(t.query+="["+e.p.filter+"]"),t},i.setSource=function(e,t){var n=e,a=v(e.query);n.query=a.value,t.p.filter=a.filter,x(n)});var d={},p=[],f=!1,h=!1,g=a.fixtureWidget(n,i,gettext("Lookup Table")),m=g.getValue,x=g.setValue,b=g.handleChange;return g.handleChange=function(){o(p),b()},g.getValue=function(){var e=m();return{instance:t.trim(e.src)?{id:e.id,src:e.src}:{id:null,src:null},nodeset:e.query}},g.setValue=function(t){var n=d.hasOwnProperty("value");d.value=t,f&&!n&&r(t)?b():(t=e.isEmpty(t)?{instance:{}}:t,x({id:t.instance?t.instance.id:"",src:t.instance?t.instance.src:"",query:t.nodeset||""}))},h=!0,f&&l(p),g},serialize:function(e,t,n,a){return e.nodeset=i.serializeXPath(e.nodeset,t,n,a),e},deserialize:function(e,t,n,a){var r=e[t];if(r){if(i.updateInstances(e,n),r.instance&&r.instance.id&&r.instance.src){var o={};o[r.instance.id]=r.instance.src,n.form.updateKnownInstances(o)}var s={form:n.form,p:r};r.nodeset=i.deserializeXPath(r,"nodeset",s,a),r.valueRef&&(n.p.valueRef=r.valueRef),r.labelRef&&(n.p.labelRef=r.labelRef),r.sortRef&&(n.p.sortRef=r.sortRef)}return r},validationFunc:function(e){if(!e.options.lookupTablesEnabled)return o.format(gettext("You no longer have access to Lookup Tables in your application. Lookup Tables are available on the Standard plan and higher.\nBefore you can make a new version of your application, you must {link} or delete this question"),{link:p?"["+gettext("change your subscription")+"]("+p+")":gettext("change your subscription")});var t=e.p.itemsetData;return t.nodeset?(e.form.updateLogicReferences(e,"itemsetData",t.nodeset),"pass"):gettext("A data source must be selected.")}},valueRef:{lstring:"Value Field",widget:b,visibility:"visible",presence:"required",validationFunc:w("valueRef"),serialize:function(e,t,n,a){n.p.valueRef&&(a.itemsetData[0].valueRef=n.p.valueRef)}},labelRef:{lstring:gettext("Display Text Field"),widget:b,visibility:"visible",presence:"required",validationFunc:w("labelRef"),serialize:function(e,t,n,a){n.p.labelRef&&(a.itemsetData[0].labelRef=n.p.labelRef)}},sortRef:{lstring:gettext("Sort Field"),widget:b,visibility:function(e){return e.form.vellum.opts().features.sorted_itemsets},presence:"optional",validationFunc:w("sortRef"),serialize:function(e,t,n,a){n.p.sortRef&&(a.itemsetData[0].sortRef=n.p.sortRef)}},filter:{lstring:gettext("Filter"),presence:"optional",widget:n.xPath,xpathType:"bool",serialize:i.serializeXPath,deserialize:i.deserializeXPath,visibility:"visible",leftPlaceholder:"",autocompleteChoices:function(e){var t=x(e),n=e.p.itemsetData.instance.src;return a.autocompleteChoices(t,n)},help:gettext("This is an XPath expression that will filter the set of choices from the lookup table")}}});var m={presence:"optional",visibility:"hidden",serialize:function(t,n,a,i){return t=e.chain(a.form.getChildren(a)).map((function(e){return e.spec[n].serialize(e.p[n],n,e,i)})).filter(e.identity).value(),e.isEmpty(t)?void 0:t},deserialize:function(t,n,a,i){e.each(t[n],(function(r,o){var s=a.form.getChildren(a)[o]||g(a.form,a),l=e.clone(t);l[n]=r,s.p[n]=s.spec[n].deserialize(l,n,s,i)}))}};function v(e){var t=e.search(h);return-1!==t?{value:e.slice(0,t),filter:e.slice(t+1,-1)}:{value:e,filter:""}}function x(e){var t=e.form.vellum.datasources.getDataSources([]);return c.dataSourcesFilter&&(t=c.dataSourcesFilter(t)),t}function y(t,n){return t.p.labelRef||(e.contains(n,"name")?t.p.labelRef="name":t.p.labelRef=n[0]),t.p.valueRef||(e.contains(n,"@id")?t.p.valueRef="@id":t.p.valueRef=n.length>1?n[1]:n[0]),t}function b(e,t){var i=n.text(e,t),r=e.p.itemsetData,o=r?r.instance:null,l=o?o.src:"",d=a.autocompleteChoices(x(e),l);return s.autocomplete(i.input,e,{choices:d}),i}function w(t){return function(n){var i=n.p.itemsetData,r=n.p[t],s=i.instance,l=s?s.src:"",d=x(n),u=a.getPossibleFixtures(d),c=e.some(u,(function(e){return e.src===l})),p=a.autocompleteChoices(d,l),f=r.replace(/\[[^\[]+]/g,"");return c&&!e.contains(p,f)?o.format(gettext("{attr} was not found in the lookup table"),{attr:r}):"pass"}}t.vellum.plugin("itemset",{},{init:function(){c=this.opts().itemset,u=this.opts().features.advanced_itemsets,d.lookupTablesEnabled=this.opts().features.lookup_tables,p=this.opts().core.externalLinks.changeSubscription},getQuestionGroups:function(){var e=this.__callOld();return this.opts().features.lookup_tables&&e.splice(e.length-1,0,{group:["SelectDynamic",gettext("Lookup Tables")],questions:["SelectDynamic","MSelectDynamic"]}),e},getMugTypes:function(){var e=this.__callOld();return e.auxiliary.Itemset=d,e.normal=t.extend(e.normal,{MSelectDynamic:o.extend(f.MSelect,{typeName:gettext("Checkbox Lookup Table"),typeChangeError:function(e,t){return t.match(/^M?Select$/)?e.form.getChildren(e).length>0?gettext("Cannot change to Multiple/Single Choice question if it has Choices. Please remove all Choices and try again."):"":"SelectDynamic"===t?"":gettext("Can only change to a Multiple Choice Lookup Table")},validChildTypes:["Itemset"],maxChildren:1,afterInsert:g,canAddChoices:!1,spec:{itemsetData:m,valueRef:m,labelRef:m,sortRef:m,filter:m}}),SelectDynamic:o.extend(f.Select,{typeName:gettext("Multiple Choice Lookup Table"),typeChangeError:function(e,t){return t.match(/^M?Select$/)?e.form.getChildren(e).length>0?gettext("Cannot change to Multiple/Single Choice question if it has Choices. Please remove all Choices and try again."):"":"MSelectDynamic"===t?"":gettext("Can only change to a Checkbox Lookup Table")},validChildTypes:["Itemset"],maxChildren:1,afterInsert:g,canAddChoices:!1,spec:{itemsetData:m,valueRef:m,labelRef:m,sortRef:m,filter:m}})}),e},updateControlNodeAdaptorMap:function(e){this.__callOld();var t=r.makeControlOnlyMugAdaptor("Itemset");e.itemset=function(e,n,a,i){var r=function(n,a){"Select"===i.__className?a.changeMugType(i,"SelectDynamic"):"MSelect"===i.__className?a.changeMugType(i,"MSelectDynamic"):l.log("Unknown parent type: "+i.__className),n=t(n,a);var r=v(e.popAttr("vellum:nodeset")||e.popAttr("nodeset"));n.p.filter=r.filter,n.p.itemsetData={instance:a.parseInstance(r.value,n,"itemsetData"),nodeset:r.value},n.p.labelRef=e.children("label").xmlAttr("ref"),n.p.valueRef=e.children("value").xmlAttr("ref");var o=e.children("sort");return o.length&&(n.p.sortRef=o.xmlAttr("ref")),n};return r.ignoreDataNode=!0,r}},loadXML:function(){this.__callOld(),this.data.core.form.on("mug-property-change",(function(e){var t=e.mug;"Itemset"===t.__className&&"itemsetData"===e.property&&function(e,t,n){if(n&&n.instance&&n.instance.src&&e.form.dropInstanceReference(n.instance.src,e,"itemsetData.instance"),t&&t.instance&&t.instance.src){var a=e.form.addInstanceIfNotExists(t.instance,e,"itemsetData.instance");a!==t.instance.id&&(t.instance.id=a,t.nodeset=e.form.updateInstanceQuery(t.nodeset,a))}}(t,e.val,e.previous)}))},getMainProperties:function(){return this.__callOld().concat(["valueRef","labelRef","sortRef"])},getLogicProperties:function(){var e=this.__callOld();return e.push("filter"),e},changeMugType:function(e,t){var n=e.__className.match(/^M?Select/)&&t.match(/^M?SelectDynamic$/);this.__callOld(),n&&g(e.form,e)}})}.apply(t,a))||(e.exports=i)},16294:(e,t,n)=>{var a,i;a=[n(13946),n(10561),n(83876),n(98094),n(77229),n(21877)],void 0===(i=function(e,t,n,a,i){var r=1,o=function(t){this.forms=t.forms||[],this.id=t.id||"",this.autoId=!!e.isUndefined(t.autoId)||t.autoId,this.hasMarkdown=!e.isUndefined(t.hasMarkdown)&&t.hasMarkdown,this.itextModel=t.itextModel,this.key=String(r++),this.refCount=1};o.prototype={clone:function(){return new o({forms:e.map(this.forms,(function(e){return e.clone()})),id:this.id,autoId:this.autoId,itextModel:this.itextModel,hasMarkdown:this.hasMarkdown})},getForms:function(){return this.forms},getFormNames:function(){return this.forms.map((function(e){return e.name}))},hasForm:function(e){return-1!==this.getFormNames().indexOf(e)},getForm:function(e){return a.reduceToOne(this.forms,(function(t){return t.name===e}),"form name = "+e)},getOrCreateForm:function(e){try{return this.getForm(e)}catch(t){return this.addForm(e)}},addForm:function(e){if(!this.hasForm(e)){var t=new s({name:e,itextModel:this.itextModel});return this.forms.push(t),t}},removeForm:function(e){var t=this.getFormNames().indexOf(e);-1!==t&&this.forms.splice(t,1)},cloneForm:function(e,t){var n=this.getOrCreateForm(e).clone();n.name=t,this.forms.push(n)},get:function(t,n){if((e.isUndefined(t)||null===t)&&(t="default"),(e.isUndefined(n)||null===n)&&(n=this.itextModel.getDefaultLanguage()),this.hasForm(t))return this.getForm(t).getValue(n)},set:function(t,n,a){(e.isUndefined(n)||null===n)&&(n="default");var i=this.getOrCreateForm(n);if(e.isUndefined(a)||null===a){a=this.itextModel.getDefaultLanguage();var r=i.getValue(a);i.setValue(a,t),e.each(this.itextModel.languages,(function(e){var n=i.getValue(e);n&&n!==r||i.setValue(e,t)}))}else i.setValue(a,t)},defaultValue:function(){return this.get()},isEmpty:function(){return!this.forms||e.every(this.forms,(function(e){return e.isEmpty()}))},hasHumanReadableItext:function(){var t=this;return e.some(["default","long","short"].concat(n.SUPPORTED_MEDIA_TYPES),(function(n){return t.hasForm(n)&&e.every(t.itextModel.languages,(function(e){return t.get(n,e)}))}))},mapLogicExpressions:function(t){var n=this.getForms(),a=e.map(n,(function(n){return e.map(n.getOutputRefExpressions(),t)}));return e.flatten(a)},updateLogicExpressions:function(t,n){e.some(e.map(this.getForms(),(function(e){return e.forEachExpression(t)})))&&n.form.fire({type:"question-label-text-change",mug:n})}};var s=function(e){this.itextModel=e.itextModel,this.data=e.data||{},this.name=e.name||"default",this.outputExpressions=null};s.prototype={clone:function(){return new s({itextModel:this.itextModel,data:e.clone(this.data),name:this.name})},getValue:function(e){return this.data[e]},setValue:function(e,t){this.data[e]=i.humanize(t),this.outputExpressions=null},getValueOrDefault:function(e){if(this.data[e])return this.data[e];var t=this.itextModel.getDefaultLanguage();if(e!==t&&this.data[t])return this.data[t];for(var n in this.data)if(this.data.hasOwnProperty(n)&&this.data[n])return this.data[n];return""},isEmpty:function(){for(var e in this.data)if(this.data.hasOwnProperty(e)&&this.data[e])return!1;return!0},initUndefined:function(t){var n=this.itextModel.getDefaultLanguage(),a=this.data;t=this.getValueOrDefault(n)||t||"",e.each(this.itextModel.languages,(function(e){a.hasOwnProperty(e)||(a[e]=t)}))},getOutputRefExpressions:function(){return null===this.outputExpressions&&(this.outputExpressions=this._getOutputRefExpressions()),this.outputExpressions},_getOutputRefExpressions:function(){var e=[];return this.forEachExpression((function(t){t&&e.push(t)})),e},forEachExpression:function(n){var a,r,o=!1;for(var s in this.data)this.data.hasOwnProperty(s)&&this.data[s]&&(a=!1,r=i.query(this.data[s]),e.each(r.find("output"),(function(e){var i=(e=t(e)).is("[ref]")?"ref":"value",r="vellum:"+i,o=e.xmlAttr(r)||e.xmlAttr(i),s=n(o);void 0!==s&&s!==o&&(e.xmlAttr(i,s).removeAttr(r),a=!0)})),a&&(this.setValue(s,r.toString()),o=!0));return o}};var l=function(){a.eventuality(this),this.languages=[]};return l.prototype={getLanguages:function(){return this.languages},hasLanguage:function(e){return-1!==this.languages.indexOf(e)},addLanguage:function(e){this.hasLanguage(e)||this.languages.push(e)},removeLanguage:function(e){this.hasLanguage(e)&&this.languages.splice(this.languages.indexOf(e),1),this.getDefaultLanguage()===e&&this.setDefaultLanguage(this.languages.length>0?this.languages[0]:"")},setDefaultLanguage:function(e){this.defaultLanguage=e},getDefaultLanguage:function(){return this.defaultLanguage?this.defaultLanguage:this.languages.length>0?this.languages[0]:""},createItem:function(e,t,n){return new o({id:e,autoId:t,itextModel:this,forms:[new s({name:"default",itextModel:this})],hasMarkdown:n})},updateForMug:function(e){e.options.isDataOnly||(e.p.labelItext||"notallowed"===e.getPresence("labelItext")||((e.p.labelItext=this.createItem()).set(e.getLabelValue()),e.validate()),e.p.hintItext||"notallowed"===e.getPresence("hintItext")||(e.p.hintItext=this.createItem()),e.p.helpItext||"notallowed"===e.getPresence("helpItext")||(e.p.helpItext=this.createItem()),e.options.isRepeat&&e.options.customRepeatButtonText&&(e.p.addEmptyCaptionItext||(e.p.addEmptyCaptionItext=this.createItem()),e.p.addCaptionItext||(e.p.addCaptionItext=this.createItem()))),e.options.isControlOnly||"notallowed"===e.getPresence("constraintMsgItext")||e.p.constraintMsgItext||(e.p.constraintMsgItext=this.createItem())}},{form:s,item:o,model:l}}.apply(t,a))||(e.exports=i)},24173:(e,t,n)=>{var a,i;a=[n(13946),n(10561),n(77207),n(19443),n(50705),n(98094),n(76910),n(21877)],void 0===(i=function(e,t,n,a,i,r,o){var s=e.union(r.SUPPORTED_MEDIA_TYPES,["default","short","long"]),l=["Choice","Group","FieldList","Repeat"],d=function(n,a){var o=n.form.vellum.data.javaRosa.Itext,s={};r.eventuality(s),s.mug=n,s.itextType=a.itextType,s.languages=o.getLanguages(),s.defaultLang=o.getDefaultLanguage(),s.forms=a.forms||["default"],s.getItextItem=function(){return a.getItextByMug(s.mug)},s.setValue=function(e){},s.getValue=function(e){};var l=t("<div />").addClass("controls").addClass("messages"),d=t("<div />").addClass("itext-block-container").addClass("itext-block-"+s.itextType);return s.getFormGroupClass=function(e){return"itext-block-"+s.itextType+"-group-"+e},s.getFormGroupContainer=function(e){return t("<div />").addClass(s.getFormGroupClass(e)).addClass("itext-lang-group")},s.getForms=function(){return s.forms},s.refreshMessages=function(){if(a.messagesPath){var e=i.util.getMessages(n,a.messagesPath);l.empty().append(e)}},n.on("messages-changed",(function(){s.refreshMessages()}),null,"teardown-mug-properties"),s.getUIElement=function(){return e.each(s.getForms(),(function(t){var n=s.getFormGroupContainer(t),r=s.languages;a.vellum.data.javaRosa.showOnlyCurrentLang&&(r=e.intersection([a.vellum.data.javaRosa.Itext.defaultLanguage,a.vellum.data.core.currentItextDisplayLanguage],s.languages)),e.each(r,(function(r){var o=s.itextWidget(s.mug,r,t,e.extend(a,{parent:d}));o.init(),o.on("change",(function(){s.fire("change")}));var l=o.getUIElement();i.util.setWidget(l,o),n.append(l)})),d.append(n)})),d.append(l),d},s},u=function(r,l){var u=d(r,l);u.isCustomAllowed=l.isCustomAllowed,u.activeForms=u.getItextItem().getFormNames(),u.displayName=l.displayName,u.formToIcon=l.formToIcon||{},u.itextWidget=o.form,u.getForms=function(){var t=e.difference(u.activeForms,s),n=e.intersection(u.activeForms,u.forms);return e.union(t,n)};var c=u.getFormGroupContainer;u.getFormGroupContainer=function(e){var t=c(e);return t.addClass("itext-lang-group-config").addClass("well").data("formtype",e),t},u.getAddFormButtonClass=function(e){return"itext-block-"+u.itextType+"-add-form-"+e},u.getAddFormButtons=function(){var n=t("<div />").addClass("btn-group itext-options");return e.each(u.forms,(function(e){var a=t("<div />");a.text(" "+e).addClass(u.getAddFormButtonClass(e)).addClass("btn btn-default itext-option").click((function(){u.addItext(e)}));var i=u.formToIcon[e];i&&a.prepend(t("<i />").addClass(i).after(" ")),-1!==u.activeForms.indexOf(e)&&a.addClass("disabled"),n.append(a)})),u.isCustomAllowed&&n.append(u.getAddCustomItextButton()),n},u.getAddCustomItextButton=function(){var e=t("<button />").text(gettext("custom...")).addClass("btn btn-default").attr("type","button"),n="fd-new-itext-button";return e.click((function(){var e,i,o;e=r.form.vellum.generateNewModal(gettext("New Content Type"),[{title:gettext("Add"),cssClasses:n+" disabled ",attributes:{disabled:"disabled"}}]),i=t(a({label:gettext("Content Type")})),(o=t("<input />").attr("type","text").addClass("form-control")).keyup((function(){var e=t(this).val(),a=r.form.vellum.$f.find("."+n);e&&-1===s.indexOf(e)&&-1===u.activeForms.indexOf(e)?a.removeClass("disabled").addClass("btn-primary").prop("disabled",!1):a.addClass("disabled").removeClass("btn-primary").prop("disabled",!0)})),i.find(".controls").append(o),e.find(".modal-body").append(i),r.form.vellum.$f.find("."+n).click((function(){o.val()&&(u.addItext(o.val()),e.modal("hide"))})),e.modal("show"),e.one("shown.bs.modal",(function(){o.focus()}))})),e},u.deleteItextForm=function(t){var n=u.getItextItem();n&&n.removeForm(t),u.activeForms=e.without(u.activeForms,t),u.fire("change")},u.getDeleteFormButton=function(e){var a=t(n());return a.addClass("pull-right").addClass("delete-"+u.getFormGroupClass(e)).click((function(){var n=t("."+u.getFormGroupClass(e));u.deleteItextForm(e),n.remove(),t(this).remove(),t("."+u.getAddFormButtonClass(e)).removeClass("disabled")})),a},u.addItext=function(n){if(-1===u.activeForms.indexOf(n)){u.activeForms.push(n),u.fire("change"),t("."+u.getAddFormButtonClass(n)).addClass("disabled");var a=u.getFormGroupContainer(n);e.each(u.languages,(function(e){var t=u.itextWidget(u.mug,e,n,l);t.init(!0),t.on("change",(function(){u.fire("change")}));var r=t.getUIElement();i.util.setWidget(r,t),a.append(r)})),p.find(".new-itext-form-group").after(a),a.find(".col-sm-9").removeClass("col-sm-9").addClass("col-sm-8"),a.before(u.getDeleteFormButton(n))}};var p=t("<div />"),f=u.getUIElement;return u.getUIElement=function(){p=f();var e=t(a({label:u.displayName}));return e.addClass("new-itext-form-group").find(".controls").append(u.getAddFormButtons()),p.prepend(e),p.find(".itext-lang-group").each((function(){t(this).find(".col-sm-9").removeClass("col-sm-9").addClass("col-sm-8"),t(this).before(u.getDeleteFormButton(t(this).data("formtype")))})),p},u};return{configurable:u,label:function(t,n){var a=d(t,n);return!n.vellum.opts().features.markdown_in_groups&&e.contains(l,t.__className)||t.form.noMarkdown?a.itextWidget=o.label:a.itextWidget=o.markdown,a},media:function(t,n){var a=u(t,n),i=n.pathPrefix;return e.isString(n.pathPrefix)||(i="/"+n.itextType),a.getForms=function(){return e.intersection(a.activeForms,a.forms)},a.itextWidget=o.media(i+t.form.getBasePath()),a}}}.apply(t,a))||(e.exports=i)},76910:(e,t,n)=>{var a,i;a=[n(13946),n(10561),n(4489),n(33591),n(83876),n(50705),n(94459),n(98094),n(20939),n(21877)],void 0===(i=function(e,t,n,a,i,r,o,s,l){var d={image:"png",audio:"mp3",video:"3gp","video-inline":"3gp"},u=function(t,n,a,d){var u,c,p=t.form.vellum.data.javaRosa.Itext,f="itext-"+n+"-"+d.itextType,h=d.baseWidgetClass||r.richTextarea;d.language=n,d.idSuffix&&(f+=d.idSuffix),d.id=f,(c=(u=h(t,d)).input).addClass("jstree-drop"),"labelItext"===d.path&&(t.form.richText||c.keydown((function(e){if(e&&8===e.which||46===e.which){var t,n,a=u.getControl()[0],i=s.getCaretPosition(a),r=u.getValue(),o="<output";if(8===e.which?i>1&&"/>"===r.substr(i-2,2)&&(t=r.lastIndexOf(o,i),n=i):46===e.which&&r.substr(i,7)===o&&(n=-1===(n=r.indexOf("/>",i))?n:n+2,t=i),t||n&&-1!==t&&-1!==n){var l=r.slice(0,t)+r.slice(n,r.length);u.setValue(l),s.setCaretPosition(a,t),e.preventDefault()}}}))),e.contains(i.ITEXT_PROPERTIES,d.path)&&l.autocomplete(c,t,{category:"Output Value",insertTpl:'<output value="${name}" />',property:"labelItext",outputValue:!0,useRichText:t.form.richText}),u.displayName=d.displayName,u.itextType=d.itextType,u.form=a||"default",u.language=n,u.languageName=s.langCodeToName[u.language]||u.language,u.showOneLanguage=p.getLanguages().length<2,u.defaultLang=p.getDefaultLanguage(),u.isDefaultLang=u.language===u.defaultLang,u.isSyncedWithDefaultLang=!1,u.getItextItem=function(){return d.getItextByMug(u.mug)},u.getItextValue=function(e){var n,a=u.getItextItem();return e||(e=u.language),n=a&&a.get(u.form,e),t.form.richText?i.outputToHashtag(n,u.mug.form.xpath):i.outputToXPath(n,u.mug.form.xpath)},u.setItextValue=function(e){e=o.sanitizeInput(e);var t=u.getItextItem();e=i.outputToHashtag(e,u.mug.form.xpath),t&&(u.isDefaultLang&&u.mug.fire({type:"defaultLanguage-itext-changed",form:u.form,prevValue:t.get(u.form,u.language),value:e,itextType:u.itextType}),t.getForm(u.form).setValue(u.language,e))},u.getLangDesc=function(){return u.showOneLanguage?"":" ("+u.languageName+")"},u.getDisplayName=function(){return u.displayName+u.getLangDesc()},u.init=function(t){if(t){var n=u.getDefaultValue();u.getItextItem().getOrCreateForm(u.form),u.setValue(n),u.handleChange()}else{var a=u.getItextValue();e.isString(a)||(a=u.isDefaultLang?"":u.getItextValue(u.defaultLang)||""),u.setItextValue(a),u.setValue(a)}};var g=u.updateValue;return u.updateValue=function(){g(),u.getValue()||u.isDefaultLang||u.setItextValue(u.getItextValue(u.defaultLang))},u.toggleDefaultLangSync=function(e){u.isSyncedWithDefaultLang=!e&&!u.isDefaultLang},u.getDefaultValue=function(){return null},u.isDefaultLang||u.mug.on("defaultLanguage-itext-changed",(function(e){e.form===u.form&&e.itextType===u.itextType&&u.getItextValue()===e.prevValue&&(u.setItextValue(e.value),u.setValue(e.value))}),null,"teardown-mug-properties"),u.refreshMessages=function(){u.getMessagesContainer().empty().append(u.getMessages(t,u.id))},u.save=function(){u.setItextValue(u.getValue())},u},c=function(e,t,n,a){var i=u(e,t,n,a),r=i.handleChange;return i.handleChange=function(){var t=i.getItextItem(),n=t&&t.get(i.form,i.language);r();var a=t&&t.get(i.form,i.language);n!==a&&e.form.fire({type:"question-label-text-change",mug:e,text:a})},i},p=function(e,t,n,a){(a=a||{}).idSuffix="-"+n;var i=u(e,t,n,a);return i.getDisplayName=function(){return n+i.getLangDesc()},i};return{form:p,id:function(e,a){var o=r.text(e,a),s=o.input,l=null;function d(){return i.getDefaultItextId(e,o.path.replace(/Itext$/,""))}function u(){c(d()),f(!0)}var c=o.setValue;o.setValue=function(e){l=e,e.autoId?u():(c(e.id),f(!1))},o.getValue=function(){return l.id=s.val(),l.autoId=h(),l};var p=t("<input />").attr("type","checkbox");function f(e){p.prop("checked",e)}function h(){return p.prop("checked")}p.change((function(){t(this).prop("checked")&&(l.refCount>1&&(l.refCount--,l=l.clone()),u(),o.handleChange())}));var g=o.getUIElement;return o.getUIElement=function(){var e=g().css("position","relative"),a=t(n());return a.find("label").prepend(p),e.find(".controls").removeClass("col-sm-9").addClass("col-sm-8").after(a),e},o.input.keyup((function(){t(this).val()!==d()&&f(!1)})),e.on("property-changed",(function(e){h()&&"nodeID"===e.property&&s.val(d())}),null,"teardown-mug-properties"),o},label:c,markdown:function(e,n,r,o){var l,d,u=(o=o||{}).parent,p=c(e,n,r,o),f=p.setValue,h=p.getUIElement,g=p.handleChange,m=!0,v=o.vellum.opts().features.markdown_tables;return p.toggleMarkdown=function(){u.toggleClass("has-markdown"),p.mug.form.fire("change")},d=t("<div>").addClass("controls well markdown-output col-sm-9"),s.isRightToLeftLanguage(o.language)&&d.attr("dir","rtl"),p.handleChange=function(){g();var e=p.getValue(),t=p.getItextItem();i.looksLikeMarkdown(e,v)?m&&(u.removeClass("markdown-ignorant"),u.addClass("has-markdown")):e||u.removeClass("has-markdown"),t.hasMarkdown=l.is(":visible"),d.html(s.markdown(e)).closest(".form-group").removeClass("hide")},p.setValue=function(e,t){f(e,t),e||d.closest(".form-group").addClass("hide"),d.html(s.markdown(e))},p.getUIElement=function(){var e=h(),n=p.getValue(),r=t("<div />").addClass("col-sm-3"),c=t("<div />").addClass("col-sm-9"),f=t("<div />").addClass("form-group").addClass("markdown-group");return e.detach(".markdown-output"),f.append(r),c.append(d),f.append(c),e.append(f),e.find(".control-label").append(a({title:o.lstring})),l=e.find(".turn-markdown-off").click((function(){return m=!1,p.getItextItem().hasMarkdown=!1,p.toggleMarkdown(),!1})),e.find(".turn-markdown-on").click((function(){return m=!0,p.getItextItem().hasMarkdown=!0,p.toggleMarkdown(),!1})),p.getItextItem().hasMarkdown?u.addClass("has-markdown"):i.looksLikeMarkdown(n,v)?(d.html(s.markdown(n)),l.removeClass("hide")):u.addClass("markdown-ignorant"),e},p},media:function(e){return function(t,n,a,o){o.baseWidgetClass=r.text;var s=p(t,n,a,o);return s.getDefaultValue=function(){if(-1!==i.SUPPORTED_MEDIA_TYPES.indexOf(a)){var e=d[a];return s.getBaseMediaPath()+"."+e}return null},s.getBaseMediaPath=function(){return"jr://file/commcare/"+a+e+i.getDefaultItextRoot(s.mug)},s.mug.form.vellum.initMediaUploaderWidget(s),s}}}}.apply(t,a))||(e.exports=i)},73391:(e,t,n)=>{var a,i;a=[n(13946),n(10561),n(35674),n(36328),n(49832),n(98094),n(77229),n(53578),n(16294),n(24173),n(76910),n(94459),n(83876),n(21877)],void 0===(i=function(e,t,n,a,i,r,o,s,l,d,u,c,p){var f={image:"fa-regular fa-image",audio:"fa fa-volume-up",video:"fa fa-video-camera","video-inline":"fa fa-play"};t.vellum.plugin("javaRosa",{langs:["en"],displayLanguage:"en"},{init:function(){this.data.javaRosa.ItextItem=l.item,this.data.javaRosa.ItextForm=l.form,this.data.javaRosa.ICONS=f,this.data.javaRosa.showOnlyCurrentLang=this.opts().javaRosa.showOnlyCurrentLang},handleDropFinish:function(e,t,n,a){var o=e&&e.attr("name")&&0===e.attr("name").lastIndexOf("itext-",0),l=this;if(o){"Date"===(n&&n.options.typeName)?i.showMenu(a.clientX,a.clientY,(function(a){p.insertOutputRef(l,e,t,n,a)})):p.insertOutputRef(l,e,t,n);var d=r.getReferenceName(t);s.usage(d,"Drag and Drop","Label")}else l.__callOld()},handleNewMug:function(e){var t=this.__callOld();return this.data.javaRosa.Itext.updateForMug(e),t},_makeLanguageSelectorDropdown:function(){var n,i,o,s=this,l=this.data.javaRosa.Itext.getLanguages(),d=this.$f.find(".fd-questions-menu");(o=e.map(l,(function(e){return{code:e,name:r.langCodeToName[e]||e}})))[o.length]={code:"_ids",name:gettext("Question ID")},o.length<2||(d.find(".language-selector").remove(),d.find(".fd-bulk-update-menu").before(a({languages:o})),(n=d.find(".fd-display-item")).click((function(e){i.val(t(this).data("code")).change(),e.preventDefault()})),(i=d.parent().find(".fd-question-tree-display")).change((function(){var e=i.val();s._changeTreeDisplayLanguage(e),n.removeClass("selected").filter("[data-code="+e+"]").addClass("selected")})),i.val(this.data.core.currentItextDisplayLanguage).change())},_changeTreeDisplayLanguage:function(e){var n=this,a=this.data.core.form;this.data.core.currentItextDisplayLanguage=e,this.data.core.$tree.find("li").each((function(e,i){var r=t(i),o=a.getMugByUFID(r.prop("id"));if("_ids"===n.data.core.currentItextDisplayLanguage)n.jstree("rename_node",r,o.getNodeID());else if(o.p.labelItext){var s=n.getMugDisplayName(o);n.jstree("rename_node",r,s||n.opts().core.noTextString)}})),a&&a.fire({type:"change-display-language"})},loadXML:function(e){var n,a,i=this,r=this.opts().javaRosa.langs;if(this.data.javaRosa.Itext=n=new l.model,this.data.javaRosa.itextMap=a={},r&&r.length>0){for(var s=0;s<r.length;s++)n.addLanguage(r[s]);n.setDefaultLanguage(r[0])}if(e){var d=o.parseXML(e).find("h\\:head, head").find("itext");t(d).children().each((function(){var e=t(this),o=e.xmlAttr("lang");r&&-1===r.indexOf(o)?i.data.core.parseWarnings.push(gettext('You have languages in your form that are not specified in the "Languages" page of the application builder. The following language will be deleted on save unless you add it to the "Languages" page:')+" "+o):(n.addLanguage(o),e.children().each((function(){var e=t(this),i=e.xmlAttr("id"),r=a[i];r&&a.hasOwnProperty(i)||((r=n.createItem(i)).refCount=0,a[i]=r),e.children().each((function(){var e=t(this),n=e.xmlAttr("form");if(n){if("markdown"===n)return r.hasMarkdown=!0,void r.getOrCreateForm("default").setValue(o,e)}else if(n="default",r.hasMarkdown)return;r.getOrCreateForm(n).setValue(o,e)}))})))}))}this.data.core.currentItextDisplayLanguage=this.opts().javaRosa.displayLanguage||n.getDefaultLanguage(),this._makeLanguageSelectorDropdown(),this.__callOld(),delete this.data.javaRosa.itextMap,n.on("change",(function(){i.onFormChange()}))},onXFormLoaded:function(n){var a=this.opts().javaRosa.langs;p.forEachItextItem(n,(function(i,r){e(i.forms).each((function(i){e.each(a,(function(e){var a=i.getValue(e);if(a){a=c.sanitizeInput(a);var r=o.query(a);r.find("output").replaceWith((function(){var e=t(this),a=e.is("[value]")||!e.is("[ref]")?"value":"ref",i="vellum:"+a,r=e.xmlAttr(a),o=e.xmlAttr(i);return o?(r&&n.inferHashtagMeanings(o,r),r=o):r=function(e){try{return n.xpath.parse(e).toHashtag()}catch(t){return e}}(r),t("<output />").xmlAttr("value",r)})),i.setValue(e,r.toString())}}))}))})),this.__callOld()},populateControlMug:function(e,t){this.__callOld();var n=this.data.javaRosa.Itext,a=this.data.javaRosa.itextMap;function i(t){try{var n=e.form.xpath.parse(t);if(n instanceof e.form.xpath.models.XPathFuncExpr&&"jr:itext"===n.id)return n.args[0].value}catch(e){}return""}function r(t,i){var r=!t||t===p.getDefaultItextId(e,i);if(t){var o=a[t];if(o&&a.hasOwnProperty(t))return r||(o.autoId=!1),o.refCount++,o}return n.createItem(t,r)}function s(e,t){var n=e.xmlAttr("ref");return r(n?i(n):"",t)}var l=t.children("label"),d=t.children("hint"),u=t.children("help"),c=t.children("alert");if(l.length&&"notallowed"!==e.getPresence("label")){var f=s(l,"label"),h=o.humanize(l)||e.getLabelValue();f.getOrCreateForm("default").initUndefined(h),e.p.labelItext=f}if(d.length&&"notallowed"!==e.getPresence("hintLabel")&&(e.p.hintItext=s(d,"hint")),u.length&&"notallowed"!==e.getPresence("label")&&(e.p.helpItext=s(u,"help")),c.length&&"notallowed"!==e.getPresence("constraintMsgAttr"))e.p.constraintMsgItext=s(c,"constraintMsg");else if(e.p.constraintMsgAttr){var g=i(e.p.constraintMsgAttr);g&&(e.p.constraintMsgItext=r(g,"constraintMsg"),e.p.constraintMsgAttr=null)}e.options.isRepeat&&e.options.customRepeatButtonText&&function(e,t){var n=t.children("repeat"),a=n.children("jr\\:addEmptyCaption"),i=n.children("jr\\:addCaption");a.length&&(e.p.addEmptyCaptionItext=s(a,"addEmptyCaption")),i.length&&(e.p.addCaptionItext=s(i,"addCaption"))}(e,t)},handleMugParseFinish:function(e){this.__callOld(),this.data.javaRosa.Itext.updateForMug(e)},duplicateMugProperties:function(t){this.__callOld(),e.each(p.ITEXT_PROPERTIES,(function(e){var n=t.p[e];n&&n.autoId&&(t.p[e]=n.clone())}))},contributeToModelXML:function(e,n){function a(e,a){(a=o.query(a)).find("output").each((function(){!function(e){var a,i,r,o=t(e),s=o.is("[value]")||!o.is("[ref]")?"value":"ref",l="vellum:"+s,d=o.xmlAttr(l)||o.xmlAttr(s);try{i=(a=u.parse(d)).toHashtag(),r=a.toXPath()}catch(e){i=d,r=d}n.richText&&r!==i?o.xmlAttr(s,r).xmlAttr(l,i):o.xmlAttr(s,r).removeAttr(l)}(this)})),e.writeXML(a.toString())}var i,r,s,l,d,u=n.xpath,c=this.data.javaRosa.Itext,p=this.data.javaRosa.itextItemsFromBeforeSerialize,f=c.getLanguages();if(f.length>0){e.writeStartElement("itext");for(var h=0;h<f.length;h++){l=f[h],e.writeStartElement("translation"),e.writeAttributeString("lang",l),c.getDefaultLanguage()===l&&e.writeAttributeString("default","");for(var g=0;g<p.length;g++){i=p[g],e.writeStartElement("text"),e.writeAttributeString("id",i.id),r=i.getForms();for(var m=0;m<r.length;m++)d=(s=r[m]).getValueOrDefault(l),e.writeStartElement("value"),"default"!==s.name&&e.writeAttributeString("form",s.name),a(e,d),e.writeEndElement();i.hasMarkdown&&!this.data.core.form.noMarkdown&&(d=i.getForm("default").getValueOrDefault(l),e.writeStartElement("value"),e.writeAttributeString("form","markdown"),a(e,d),e.writeEndElement()),e.writeEndElement()}e.writeEndElement()}e.writeEndElement()}},beforeSerialize:function(){this.__callOld(),this.data.javaRosa.itextItemsFromBeforeSerialize=p.getItextItemsFromMugs(this.data.core.form)},afterSerialize:function(){this.__callOld(),delete this.data.javaRosa.itextItemsFromBeforeSerialize},beforeBulkInsert:function(e){this.__callOld(),this.data.javaRosa.itextById=p.getItextItemsFromMugs(e,!0)},afterBulkInsert:function(){this.__callOld(),delete this.data.javaRosa.itextById},getMugTypes:function(){var e=this.__callOld(),t=e.normal;return t.Group.spec=r.extend(t.Group.spec,{constraintMsgItext:{presence:"notallowed"}}),e},getMugSpec:function(){var n=this.__callOld(),a=this,i=n.databind,s=n.control;function l(e,t){return function(n){var a=n.p[e];if(!(a&&a.hasHumanReadableItext()||"required"!==n.getPresence(e)))return 1===a.itextModel.languages.length?r.format(gettext("{name} (or multimedia) is required."),{name:t}):r.format(gettext("{name} (or multimedia) is required for all languages."),{name:t});if(a&&!a.autoId&&!a.isEmpty()){if(!a.id)return r.format(gettext("{name} Itext ID is required."),{name:t});if(!r.isValidAttributeValue(a.id))return r.format(gettext("{name} is not a valid ID."),{name:a.id})}return"pass"}}function c(n){function i(e,n){var a=o.query(e);return a.find("output").each((function(){!function(e,n){var a=t(e),i=a.is("[value]")||!a.is("[ref]")?"value":"ref",r=a.xmlAttr(i);r&&a.xmlAttr(i,n.transformHashtags(r))}(this,n)})),a.toString()}return n.serialize=function(t,n,a,i){var r=!1;e.each(t.forms,(function(a){a.isEmpty()||(r=!0,e.each(t.itextModel.languages,(function(e){var t=n+":"+e+"-"+a.name;i[t]=a.getValue(e)})))})),r&&!t.autoId&&(i[n]=t.id),t.hasMarkdown&&(i[n+":hasMarkdown"]=t.hasMarkdown)},n.deserialize=function(t,n,r,o){var s=r.p[n],l=!1;if(t[n]){var d=r.form.vellum.data.javaRosa.itextById,u=t[n];d.hasOwnProperty(u)&&!d[u].autoId?(r.p[n]=s=d[u],s.refCount++):(s.id=t[n],s.autoId=!1,d[s.id]=s)}var c=s.itextModel.getDefaultLanguage(),f=s.itextModel.languages,h=e.object(p.SUPPORTED_MEDIA_TYPES,p.SUPPORTED_MEDIA_TYPES),g=a.data.uploader.objectMap||{};function m(e){return null==e?"":String(e)}t.id&&t.id.slice(t.id.lastIndexOf("/")+1);var v=e.memoize((function(a){return!e.find(f,(function(e){return t[n+":"+e+"-"+a]}))}));e.each(f,(function(a){var d=n.length+a.length+2,u=new RegExp("^"+RegExp.escape(n)+":"+RegExp.escape(a)+"-"),p={};e.each(t,(function(e,f){if(u.test(f)){var x=f.slice(d),y=h.hasOwnProperty(x);if(y&&!e&&v(x))return;if(!p.hasOwnProperty(x)){p[x]=!0;var b=n+":"+c+"-"+x,w=t.hasOwnProperty(b)?m(t[b]):m(e);s.set(w,x),!y&&w&&o.later((function(){s.set(i(w,o),x)}))}s.set(m(e),x,a),!y&&e&&o.later((function(){s.set(i(e,o),x,a)})),y&&!g.hasOwnProperty(e)&&r.addMessage(n,{key:"missing-multimedia-warning",level:r.WARNING,message:gettext("Multimedia was not copied; it must be uploaded separately.")}),l=!0}}))})),l&&!t[n]&&(s.id=p.getDefaultItextId(r,n.replace(/Itext$/,""))),t[n+":hasMarkdown"]&&(s.hasMarkdown=!0);var x="javaRosa-discarded-languages-warning",y=new RegExp("^"+RegExp.escape(n)+":(\\w+)-"),b=e.filter(e.map(e.keys(t),(function(e){var t=e.match(y);if(t&&-1===f.indexOf(t[1]))return t[1]})),e.identity);if(b.length){var w=o.errors.get(null,x);w?(w.langs=e.union(w.langs,b),w.message=gettext("Discarded languages:")+" "+w.langs.join(", ")):o.errors.update(null,{key:x,level:r.WARNING,langs:b,message:gettext("Discarded languages:")+" "+b.join(", ")})}r.validate(n)},n}function h(e){return e.trackLogicReferences=!0,e}function g(e){var t=e.p.constraintMsgItext;return e.p.constraintAttr||!t||t.isEmpty()?"pass":gettext("You cannot have a Validation Error Message with no Validation Condition!")}return i.constraintMsgAttr.visibility="hidden",i.constraintMsgItext=c({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Validation Message"),widget:h((function(e,n){return d.label(e,t.extend(n,{itextType:"constraintMsg",messagesPath:"constraintMsgItext",getItextByMug:function(e){return e.p.constraintMsgItext},displayName:gettext("Validation Message")}))})),validationFunc:function(e){var t=e.p.constraintMsgItext;if(!e.p.constraintAttr&&t&&t.id&&!t.autoId)return gettext("Can't have a Validation Message Itext ID without a Validation Condition");var n=l("constraintMsgItext","Validation Message")(e);return"pass"===n&&(n=g(e)),n}}),i.constraintAttr.validationFunc=g,i.constraintMsgItextID={visibility:"constraintMsgItext",presence:"optional",lstring:gettext("Validation Message Itext ID"),widget:u.id,widgetValuePath:"constraintMsgItext"},i.constraintMediaIText=function(e){return e.isSpecialGroup?void 0:{visibility:function(e){return e.isVisible("constraintAttr")},presence:"optional",lstring:gettext("Add Validation Media"),widget:function(e,n){return d.media(e,t.extend(n,{displayName:gettext("Add Validation Media"),itextType:"constraintMsg",getItextByMug:function(e){return e.p.constraintMsgItext},forms:p.SUPPORTED_MEDIA_TYPES,formToIcon:f}))}}},s.label.visibility="visible_if_present",s.hintLabel.visibility="visible_if_present",s.labelItext=c({visibility:"visible",presence:"optional",lstring:gettext("Display Text"),widget:h((function(e,n){return d.label(e,t.extend(n,{itextType:"label",messagesPath:"labelItext",getItextByMug:function(e){return e.p.labelItext},displayName:gettext("Display Text")}))})),validationFunc:l("labelItext",gettext("Display Text"))}),s.labelItextID={visibility:"labelItext",presence:"optional",lstring:gettext("Display Text Itext ID"),widget:u.id,widgetValuePath:"labelItext"},s.hintItext=c({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Hint Message"),widget:h((function(e,n){return d.label(e,t.extend(n,{itextType:"hint",messagesPath:"hintItext",getItextByMug:function(e){return e.p.hintItext},displayName:gettext("Hint Message")}))})),validationFunc:l("hintItext",gettext("Hint Message"))}),s.hintItextID={visibility:"hintItext",lstring:gettext("Hint Itext ID"),widget:u.id,widgetValuePath:"hintItext"},s.helpItext=c({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Help Message"),widget:h((function(e,n){var a=d.label(e,t.extend(n,{itextType:"help",messagesPath:"helpItext",getItextByMug:function(e){return e.p.helpItext},displayName:gettext("Help Message")}));return a})),validationFunc:l("helpItext",gettext("Help Message"))}),s.helpItextID={visibility:"helpItext",lstring:gettext("Help Itext ID"),widget:u.id,widgetValuePath:"helpItext"},s.addEmptyCaptionItext=c({visibility:"visible",presence:function(e){return e.options.isRepeat&&e.options.customRepeatButtonText?"optional":"notallowed"},lstring:gettext("Add New Item Button Text"),widget:h((function(e,n){var a=d.label(e,t.extend(n,{itextType:"addEmptyCaption",messagesPath:"addEmptyCaptionItext",getItextByMug:function(e){return e.p.addEmptyCaptionItext},displayName:gettext("Add New Item Button Text")}));return a})),validationFunc:l("addEmptyCaptionItext",gettext("Add New Item Button Text"))}),s.addEmptyCaptionItextID={visibility:"addEmptyCaptionItext",lstring:gettext("Add New Itext ID"),widget:u.id,widgetValuePath:"addEmptyCaptionItext"},s.addCaptionItext=c({visibility:"visible",presence:function(e){return e.options.isRepeat&&e.options.customRepeatButtonText?"optional":"notallowed"},lstring:gettext("Add Another Item Button Text"),widget:h((function(e,n){var a=d.label(e,t.extend(n,{itextType:"addCaption",messagesPath:"addCaptionItext",getItextByMug:function(e){return e.p.addCaptionItext},displayName:gettext("Add Another Item Button Text")}));return a})),validationFunc:l("addCaptionItext",gettext("Add Another Item Button Text"))}),s.addCaptionItextID={visibility:"addCaptionItext",lstring:gettext("Add Another Itext ID"),widget:u.id,widgetValuePath:"addCaptionItext"},s.otherItext=function(e){return e.isSpecialGroup?void 0:{visibility:"labelItext",presence:"optional",lstring:gettext("Add Other Content"),widget:function(e,n){return d.configurable(e,t.extend(n,{displayName:gettext("Add Other Content"),itextType:"label",getItextByMug:function(e){return e.p.labelItext},forms:["long","short"],isCustomAllowed:!0}))}}},s.mediaItext=function(e){return e.isSpecialGroup?void 0:{visibility:"labelItext",presence:"optional",lstring:gettext("Add Multimedia"),widget:function(e,n){return d.media(e,t.extend(n,{displayName:gettext("Add Multimedia"),itextType:"label",pathPrefix:"",getItextByMug:function(e){return e.p.labelItext},forms:p.SUPPORTED_MEDIA_TYPES,formToIcon:f}))}}},s.helpMediaIText=function(e){return e.isSpecialGroup?void 0:{visibility:"helpItext",presence:"optional",lstring:gettext("Add Help Media"),widget:function(e,n){return d.media(e,t.extend(n,{displayName:gettext("Add Help Media"),itextType:"help",getItextByMug:function(e){return e.p.helpItext},forms:p.SUPPORTED_MEDIA_TYPES,formToIcon:f}))}}},n},getMainProperties:function(){var e=this.__callOld();return e.splice(1+e.indexOf("label"),0,"labelItext"),e},getLogicProperties:function(){var e=this.__callOld();return e.splice(1+e.indexOf("constraintAttr"),0,"constraintMsgItext"),e},getMediaProperties:function(){var e=this.__callOld();return e.push("constraintMediaIText"),e},getAdvancedProperties:function(){var e=this.__callOld();return(e=e.concat(["labelItextID","constraintMsgItextID","hintItextID","hintItext","helpItextID","helpItext","addEmptyCaptionItextID","addEmptyCaptionItext","addCaptionItextID","addCaptionItext","helpMediaIText"])).concat(["otherItext"])},getToolsMenuItems:function(){var e=this;return this.__callOld().concat([{name:gettext("Edit Bulk Translations"),icon:"fa fa-language",action:function(t){e.showItextModal(t)}}])},showItextModal:function(e){var a,i,r,o=this,s=o.data.javaRosa.Itext,l=o.data.core.form;a=o.generateNewModal(gettext("Edit Bulk Translations"),[{title:gettext("Update Translations"),cssClasses:"btn-primary",action:function(){p.parseXLSItext(l,r.val(),s),a.modal("hide"),e()}}]),i=t(n({description:gettext("Copy these translations into a spreadsheet program like Excel. You can edit them there and then paste them back here when you're done. These will update the translations used in your form. Press 'Update Translations' to save changes, or 'Close' to cancel.")})),a.find(".modal-body").html(i),(r=i.find("textarea")).val(p.generateItextXLS(l,s)),a.modal("show"),a.one("shown.bs.modal",(function(){r.focus()}))}})}.apply(t,a))||(e.exports=i)},83876:(e,t,n)=>{var a,i;a=[n(13946),n(10561),n(43809),n(94459),n(77229),n(98094)],void 0===(i=function(e,t,n,a,i,r){var o=["default","audio","image","video","video-inline"],s=["labelItext","hintItext","helpItext","constraintMsgItext","addEmptyCaptionItext","addCaptionItext"],l=function(e){if("Choice"===e.__className){var t=new RegExp(r.invalidAttributeRegex.source,"g");return l(e.parentMug)+"-"+e.getNodeID().replace(t,"_")}var n=e.absolutePathNoRoot;return n||(n=e.parentMug?e.parentMug.absolutePathNoRoot+"/"+e.getNodeID():"/"+e.getNodeID()),n.slice(1)},d=function(e,t){return l(e)+"-"+t},u=function(t,n){var a={};t.tree.walk((function(t,i,r){t&&e.each(s,(function(e){var i=t.p[e];!i||i.key?i&&!a.hasOwnProperty(i.key)&&(a[i.key]=!0,n(i,t,e)):window.console.log("ignoring ItextItem without a key: "+i.id)})),r()}))},c=function(t,n){var a=n,i=[],r={},o=e.object(e.map(s,(function(e){return[e,e.replace("Itext","")]})));return u(t,(function(e,t,s){var l=e.isEmpty();if(!l||a){var u=e.autoId||!e.id?d(t,o[s]):e.id,c=u,p=2;if(r.hasOwnProperty(u)&&(l||e===r[u]))return;for(;r.hasOwnProperty(u);)u=c+p,p++;e.id=u,r[u]=e,n||i.push(e)}})),n?r:i},p=function(e,t){return t?'<output value="format-date(date('+e+"), '"+t+"')\"/>":'<output value="'+e+'" />'};function f(e){return function(n,a,r){if(n){var o=i.query(n);o.find("output").each((function(){var n=t(this),i=n.xmlAttr("value")||n.xmlAttr("ref");try{var r=a.parse(i);n.xmlAttr("value",r[e]())}catch(e){n.xmlAttr("value",i)}})),n=o.toString(),r&&(n=n.replace(/(<)|>/g,(function(e,t){return t?"&lt;":"&gt;"})))}return n}}return{ITEXT_PROPERTIES:s,SUPPORTED_MEDIA_TYPES:["image","audio","video","video-inline"],forEachItextItem:u,generateItextXLS:function(t,a){function i(t,n,a,i){var r=[t];return e.each(a,(function(t){e.each(n,(function(e){r.push(i(e,t))}))})),r}var r=o,s=a.getLanguages(),l=[];if(s.length>0){var d=c(t);l.push(function(e,t){return i("label",e,t,(function(e,t){return t+"_"+e}))}(s,r)),e.each(d,(function(e){l.push(function(e,t,n){return i(e.id,t,n,(function(t,n){return e.hasForm(n)?e.get(n,t):""}))}(e,s,r))}))}return n.tabDelimit(l)},getDefaultItextRoot:l,getDefaultItextId:d,getItextItemsFromMugs:c,getOutputRef:p,insertOutputRef:function(e,t,n,i,o){var s=p(n,o),l=e.data.core.form;l.richText?a.editor(t).insertOutput(s):r.insertTextAtCursor(t,s,!0),i&&(function(e,t,n,a,i){if("."===n){var o=t.p.getDefinition(e).lstring;t.addMessage(i,{key:"core-circular-reference-warning",level:t.WARNING,message:r.format(gettext("The {field} for a question is not allowed to reference the question itself. Please remove the {ref} from the {field} or your form will have errors."),{field:o,ref:a})})}}("label",i,n,gettext("output value"),t.attr("name")),function(e,t,n){if(!t.options.canOutputValue){var a=e.vellum.getCurrentlySelectedMug(),i=t.options.typeName;a&&a.addMessage(null,{key:"javaRosa-output-value-type-error",level:t.WARNING,message:r.format(gettext("{type} nodes cannot be used in an output value. Please remove the output value for '{path}' or your form will have errors."),{type:i,path:n})})}}(l,i,n))},looksLikeMarkdown:function(e,t){var n=/^\d+[\.\)] |^\* |~~.+~~|# |\*{1,3}\S.*\*{1,3}|\[.+\]\(\S+\)/m.test(e),a=!1;return t&&(a=/^(\|[^\n]+\|\r?\n)((?:\|\s*:?[-]+:?\s*)+\|)(\n(?:\|[^\n]+\|\r?\n?)*)?$/m.test(e)),n||a},parseXLSItext:function(a,i,r){var s,l,d,u,p=o,f=r.getLanguages(),h=n.makeRowParser(i),g=h();g&&(g=e.map(g,(function(e){var t=e.split(/[-_]/);return-1===p.indexOf(t[0])||-1===f.indexOf(t[1])?null:{form:t[0],lang:t[1]}})));var m=c(a,!0);for(l=h();l;l=h())if(u=m[l[0]])for(s=1;s<l.length;s++)(d=g[s])&&(u.hasForm(d.form)?u.getForm(d.form).setValue(d.lang,l[s]):t.trim(l[s])&&u.getOrCreateForm(d.form).setValue(d.lang,l[s]));r.fire("change")},outputToXPath:f("toXPath"),outputToHashtag:f("toHashtag")}}.apply(t,a))||(e.exports=i)},36283:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(29320)],void 0===(i=function(e,t){var n;e.fn.popAttr=function(e){var n=!1,a=this.xmlAttr(e);try{this.removeAttr(e),n=!0}catch(e){}return n&&!t.isUndefined(a)&&(this[0].poppedAttributes||(this[0].poppedAttributes={}),this[0].poppedAttributes[e]=a),a},e.fn.xmlAttr=function(e,n){if(t.isObject(e)){var a=this;return t.each(e,(function(e,t){a.xmlAttr(t,e)})),this}var i=arguments.length>1;if(e&&e.indexOf(":")>-1)return i?this.attr(e,n):this.attr(e);var r,o=this.get(0);if(o){if(i)return null===n?this.removeAttr(e):void 0!==n&&((r=document.createAttribute(e)).value=n,o.setAttributeNode(r)),this;if(r=o.attributes.getNamedItem(e))return r.value}return i?this:void 0},e.fn.stopLink=function(){return this.click((function(e){e.preventDefault()})),this},e.fn.fdHelp=function(){return this.append(e("<i />").addClass("fa fa-question-circle")).popover({trigger:"focus",html:!0,container:"body",sanitize:!1}).click((function(e){e.stopPropagation()})),this},e.fn.clickExceptAfterDrag=function(t){var n=e(this);function a(e){t.currentXY=[e.pageX,e.pageY],n.off("mousemove",a)}function i(e){var a=t.currentXY[0]-e.pageX,r=t.currentXY[1]-e.pageY;Math.sqrt(a*a+r*r)<3&&t(e),n.off("mouseup",i)}t.currentXY=[],n.on("mousedown",(function(e){a(e),n.on("mousemove",a).on("mouseup",i)}))},e.fn.disableSelection||e.fn.extend({disableSelection:(n="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(n+".ui-disableSelection",(function(e){e.preventDefault()}))}),enableSelection:function(){return this.off(".ui-disableSelection")}});var a=e.fn.popover.Constructor.prototype.leave;e.fn.popover.Constructor.prototype.leave=function(t){var n,i,r=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);a.call(this,t),t.currentTarget&&(n=e(".popover"),i=r.timeout,n.one("mouseenter",(function(){clearTimeout(i),n.one("mouseleave",(function(){e.fn.popover.Constructor.prototype.leave.call(r,r)}))})))}}.apply(t,a))||(e.exports=i)},64234:(e,t,n)=>{var a,i;a=[n(10561)],void 0===(i=function(e){const t=e.cleanData;e.cleanData=function(n){for(const t of n)try{e(t).triggerHandler("remove")}catch(e){}t(n)}}.apply(t,a))||(e.exports=i)},90952:(e,t,n)=>{var a,i;a=[n(10561),n(91460)],void 0===(i=function(e){"use strict";e.jstree.defaults.conditionalevents={should_activate:function(){return!0},redraw_node:function(){var e=Array.prototype.slice.call(arguments);return this.parent.redraw_node.apply(this.inst,e)}},e.jstree.plugins.conditionalevents=function(e,t){this.activate_node=function(){var e=Array.prototype.slice.call(arguments);this.settings.conditionalevents.should_activate.apply(this,e)&&t.activate_node.apply(this,e)},this.redraw_node=function(){var e=Array.prototype.slice.call(arguments),n={inst:this,parent:t};return this.settings.conditionalevents.redraw_node.apply(n,e)},this.edit=function(){}}}.apply(t,a))||(e.exports=i)},55889:(e,t,n)=>{var a,i;a=[n(10561),n(21877)],void 0===(i=function(e){e.vellum.plugin("lock",{},{loadXML:function(e){this.data.lock.locks={},this.__callOld()},parseBindElement:function(e,t,n){this.__callOld();var a=t.xmlAttr("vellum:lock");a&&"none"!==a&&(this.data.lock.locks[n]=a)},isPropertyLocked:function(e,t){if(this.__callOld())return!0;var n=this.data.lock.locks[e];return!!n&&(("node"===n||"value"===n)&&"nodeID"===t||"value"===n&&-1===t.indexOf("Itext"))},isMugPathMoveable:function(e){return this.__callOld()&&!this.data.lock.locks[e]},isMugRemoveable:function(e,t){return this.__callOld()&&!this.data.lock.locks[t]},isMugTypeChangeable:function(e,t){return this.__callOld()&&"value"!==this.data.lock.locks[t]}})}.apply(t,a))||(e.exports=i)},84854:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(98094)],void 0===(i=function(e,t,n){var a="#",i="#invalid/xpath ";function r(t,n){if(this._text=t||"",this._xpathParser=n,"string"==typeof this._text&&this._text.startsWith(i))this.parsed=null,this.error=i;else if(e.trim(t))try{this.parsed=this._xpathParser.parse(t)}catch(e){this.parsed=null,this.error=e}else this.parsed=null}function o(e,t){t.allowedDataNodeReferences=t.allowedDataNodeReferences||{},this.opts=t,this.form=e,this.forward={},this.reverse={},this.errors={}}return r.prototype={analyze:function(){var e,t=[],n=[],a=[],i=[],r=this._xpathParser.models.XPathInitialContextEnum.ROOT,o=this._xpathParser.models.XPathInitialContextEnum.RELATIVE,s=this._xpathParser.models.XPathInitialContextEnum.EXPR;if(this.paths=t,this.absolutePaths=n,this.hashtags=i,this.instanceRefs={},this.referencesSelf=!1,this.topLevelPaths=a,this.parsed)for(var l,d,u,c,p,f,h=[{xpath:this.parsed,insideFilter:!1}];h.length>0;){if(l=(p=h.shift()).xpath,f=p.insideFilter,l instanceof this._xpathParser.models.XPathPathExpr){if(t.push(l),f||a.push(l),f=!0,l.initial_context===r)n.push(l);else if(l.initial_context===o&&1===l.steps.length&&"self"===l.steps[0].axis)this.referencesSelf=!0;else if(l.initial_context===s)for(this._addInstanceRef(l.filter.expr)||h.push({xpath:l.filter.expr,insideFilter:f}),e=l.filter.predicates,d=0;d<e.length;d++)h.push({xpath:e[d],insideFilter:f})}else l instanceof this._xpathParser.models.XPathFuncExpr?this._addInstanceRef(l):l instanceof this._xpathParser.models.HashtagExpr&&i.push(l);for(u=l.getChildren(),d=0;d<u.length;d++)if(h.push({xpath:u[d],insideFilter:f}),u[d].predicates&&u[d].predicates.length)for(e=u[d].predicates,c=0;c<e.length;c++)h.push({xpath:e[c],insideFilter:f})}},_addInstanceRef:function(e){if("instance"===e.id&&1===e.args.length&&e.args[0]instanceof this._xpathParser.models.XPathStringLiteral){var t=e.args[0].value;return this.instanceRefs[t]=null,!0}return!1},getPaths:function(){return this.paths||this.analyze(),this.paths},getTopLevelPaths:function(){return this.topLevelPaths||this.analyze(),this.topLevelPaths},getHashtags:function(){return this.hashtags||this.analyze(),this.hashtags},updatePath:function(e,t){var n,a,i,r,o=this.getPaths().concat(this.getHashtags());for(a=0;a<o.length;a++)(n=o[a]).toHashtag()===e&&(i=this._xpathParser.parse(t),(r=n).toHashtag=i.toHashtag.bind(i),r.toXPath=i.toXPath.bind(i))},getText:function(){return this._text&&this.parsed?this.parsed.toHashtag():this._text}},o.prototype={clearReferences:function(e,n){function a(n,a){if(a.ref){if(a.mug!==e.ufid)throw new Error([e,a]);r[a.ref][a.mug]=t.filter(r[a.ref][a.mug],(function(e){return e.property!==n}))}}var i,r=this.reverse,o=this.forward,s=this.errors;e.form.dropAllInstanceReferences(e,n,!0),o.hasOwnProperty(e.ufid)?n?(o[e.ufid].hasOwnProperty(n)&&(i=t.partial(a,n),t.each(o[e.ufid][n],i)),o[e.ufid][n]=[]):(t.each(o[e.ufid],(function(e,n){i=t.partial(a,n),t.each(e,i)})),o[e.ufid]={}):o[e.ufid]={},s.hasOwnProperty(e.ufid)&&(n?delete this.errors[e.ufid][n]:delete this.errors[e.ufid])},_addReferences:function(e,o,s){s=this.form.getLogicalXPath(s||e.p[o]);var l,d=this,u=d.form,c=new r(s,u.xpath),p=[],f=[],h="",g=e.spec[o],m=g?g.lstring:o,v=this.reverse;return f.push({key:"logic-invalid-xpath-warning",level:e.WARNING,message:c.error===i?gettext("Invalid XPath expression."):""}),c.analyze(),!c.referencesSelf||g&&g.mayReferenceSelf||(h=n.format(gettext("The {property} for a question is not allowed to reference the question itself. Please remove the . from the {property} or your form will have errors."),{property:m})),f.push({key:"core-circular-reference-warning",level:e.WARNING,message:h}),l=c.absolutePaths.concat(c.hashtags).map((function(t){var n=t.toHashtag(),i=n.startsWith("#"),r=i?n:t.pathWithoutPredicates(),s=i?"":r.substring(1+r.indexOf("/",1)),l=u.getMugByPath(r),c=u.hasValidHashtagPrefix(n),f=c&&u.isValidHashtag(n);(l||f||e.options.ignoreReferenceWarning&&e.options.ignoreReferenceWarning(e)||-1!==d.opts.allowedDataNodeReferences.indexOf(s)||"dataParent"===o&&r===u.getBasePath().slice(0,-1))&&(l||!c||f)||p.push(n);var h=l?l.ufid:c?a:"",g={mug:e.ufid,ref:h,property:o,path:n,sourcePath:e.hashtagPath};return h&&(v.hasOwnProperty(h)?v[h].hasOwnProperty(e.ufid)||(v[h][e.ufid]=[]):(v[h]={},v[h][e.ufid]=[]),v[h][e.ufid].push(g)),g})),this.forward[e.ufid][o]=l,t.each(c.instanceRefs,(function(t,n){u.referenceInstance(n,e,o)})),t.each(c.hashtags,(function(t){u.referenceHashtag(t.toHashtag(),e,o)})),p.length>0?(this.errors[e.ufid]||(this.errors[e.ufid]={}),this.errors[e.ufid][o]=!0):this.errors[e.ufid]&&delete this.errors[e.ufid][o],f.push({key:"logic-bad-path-warning",level:e.WARNING,message:p.length?1===p.length?gettext("Unknown question:")+" "+p[0]:gettext("Unknown questions:")+"\n- "+p.join("\n- "):""}),f},addReferences:function(e,n,a){var i=this,r={};return this.clearReferences(e,n),!a&&e.p[n]&&t.isFunction(e.p[n].mapLogicExpressions)?e.p[n].mapLogicExpressions((function(a){var o=i._addReferences(e,n,a);return t.filter(o,(function(e){if(r.hasOwnProperty(e.key)){if(!r[e.key].message||!e.message)return e.message&&t.extend(r[e.key],e),!1}else r[e.key]=e;return!0}))})):this._addReferences(e,n,a)},updateReferences:function(e,n,a){function i(t){o[t]=r.addReferences(e,t,a)}var r=this,o={};n?i(n):t.each(e.logicReferenceAttrs,i),e.addMessages(o)},updatePath:function(e,t,n,a){if(t!==n){var i={};i[e]=[t,n],this.updatePaths(i,a)}},updatePaths:function(e,n){var a={},i=this.form;this.forEachReferencingProperty(e,(function(e,n,o){function s(e){if(!e)return e;var t=new r(e,i.xpath),n=t.getText();t.updatePath(o[0],o[1]);var a=t.getText();return a!==n?a:e}var l=e.ufid+" "+n+" "+o[0];if(!a.hasOwnProperty(l)){a[l]=null;var d=e.p[n];if(d&&t.isFunction(d.updateLogicExpressions))d.updateLogicExpressions(s,e);else{var u=s(d);d!==u&&e.p.set(n,u)}}}),n)},forEachBrokenReference:function(e){t.each(this.errors,(function(n,a){var i=this.form.getMugByUFID(a);i?n?t.each(n,(function(t,n){e(i,n)})):e(i):delete this.errors[a]}),this)},hasBrokenReferences:function(){return t.find(this.errors,(function(e){return t.some(e)}))},validateExternalReferences:function(){var e=this,n=t.chain(this.reverse[a]||{}).values().flatten(!0).filter((function(t){return!e.form.isValidHashtag(t.path)})).value();t.each(n,(function(t){var n=e.form.getMugByUFID(t.mug);e.updateReferences(n,t.property)}))},forEachReferencingProperty:function(e,n,a){var i=this.form,r=this.reverse;t.each(e,(function(e,o){r.hasOwnProperty(o)&&t.each(r[o],(function(r,o){var s=i.getMugByUFID(o);t.each(r,(function(t){a&&t.sourcePath!==a&&0!==t.sourcePath.indexOf(a+"/")||n(s,t.property,e)}))}))}))},hasReferencingMug:function(e,n){var a=this.form;return!!this.reverse.hasOwnProperty(e.ufid)&&t.find(this.reverse[e.ufid],(function(e,t){var i=a.getMugByUFID(t);return e.length&&i&&n(i)}))},reset:function(){this.forward={},this.reverse={}},caseReferences:function(){var e=this,n={},i={};t.each(t.flatten(t.values(this.reverse[a]||{})),(function(a){var i=e.form.normalizeXPath(a.sourcePath);if(null===i){var r=e.form.getMugByUFID(a.mug).parentMug;r&&(i=r.absolutePath)}n.hasOwnProperty(i)?t.contains(n[i],a.path)||n[i].push(a.path):n[i]=[a.path]}));var r=t.filter(this.form.getMugList(),(function(e){return void 0!==e.options.getCaseSaveData}));return t.each(r,(function(t){var n=e.form.getAbsolutePath(t);i[n]=t.options.getCaseSaveData(t)})),{load:n,save:i}},knownExternalReferences:function(){var e=this;return t.chain(this.reverse[a]||{}).values().flatten(!0).filter((function(t){return e.form.isValidHashtag(t.path)})).map((function(e){return[e.path,null]})).object().value()},findUsages:function(e){var n=this.form,i={},r=t.omit(this.reverse,a);return t.each(r,(function(a,r){var o=n.getMugByUFID(r),s={};!o||e&&e!==o.hashtagPath||(t.each(a,(function(e,a){t.each(e,(function(e){var t=n.getMugByUFID(a),i=t.hashtagPath,r=t.spec[e.property].lstring;i||(i=t.parentMug.hashtagPath),s[i]=r}))})),i[o.hashtagPath]=s)})),i}},{LogicManager:o,LogicExpression:r}}.apply(t,a))||(e.exports=i)},48803:(e,t,n)=>{var a,i;window.gettext||(window.gettext=function(e){return e},window.ngettext=function(e,t,n){return 1===n?e:t}),a=[n(21877),n(38360),n(85465),n(29333),n(73391),n(55382),n(55889),n(45304),n(76827),n(11374),n(98610),n(57100),n(98922),n(81437),n(33586),n(80037),n(65329),n(64234)],void 0===(i=function(){}.apply(t,a))||(e.exports=i)},7903:(e,t,n)=>{var a,i;a=[n(42922),n(13946)],void 0===(i=function(e,t){var n=e("zero").enable(["link","emphasis","strikethrough","heading","list","table"]),a=n.renderer.rules.link_open||function(e,t,n,a,i){return i.renderToken(e,t,n)};return n.renderer.rules.link_open=function(e,t,n,i,r){var o=e[t].attrIndex("target");return o<0?e[t].attrPush(["target","_blank"]):e[t].attrs[o][1]="_blank",a(e,t,n,i,r)},function(e){return t.isString(e)?(e=e.replace(/\\\\n/g,"\n"),n.render(e)):""}}.apply(t,a))||(e.exports=i)},11374:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(21874),n(34078),n(37417),n(77026),n(98094),n(21877)],void 0===(i=function(e,t,n,a,i,r,o){var s=a.baseMugTypes.normal.Repeat,l=[{key:"ids",event:"xforms-ready",path:"",query:"join(' ', {})"},{key:"count",event:"xforms-ready",path:"",query:"count-selected({}/@ids)"},{key:"index",event:"jr-insert",path:"/item",query:"int({}/@current_index)"},{key:"id",event:"jr-insert",path:"/item",query:"selected-at({}/@ids, ../@index)"}],d=/^ *join\(['"] ['"], *(.*)\) *$/i,u={supportsDataNodeRole:!0,isRepeat:!0,getPathName:function(e,t){return e.p.dataSource.idsQuery&&(t+="/item"),t},parseDataNode:function(e,t){return e.p.dataSource={idsQuery:"value for getPathName"},t.children("item").children()},dataChildFilter:function(e,t){return t.p.dataSource.idsQuery?[new r.Node(e,{getNodeID:function(){return"item"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{id:"",index:"","jr:template":""}}}})]:e},controlChildFilter:function(e,t){var n=t.hashtagPath,a=t.p.repeat_count;return(e=s.controlChildFilter(e,t))[0].getValue().options.writeCustomXML=function(e,t){a&&(o.writeHashtags(e,"jr:count",String(a),t),e.writeAttributeString("jr:noAddRemove","true()")),o.writeHashtags(e,"nodeset",n,t)},e},getExtraDataAttributes:function(e){return e.p.dataSource.idsQuery?{ids:"",count:"",current_index:"","vellum:role":"Repeat"}:s.getExtraDataAttributes(e)},getBindList:function(e){var t=e.absolutePath,n=s.getBindList(e);return e.p.dataSource.idsQuery&&n.splice(0,0,{nodeset:t.replace(/\/item$/,"/@current_index"),calculate:"count("+t+")"}),n},init:function(e,t){s.init(e,t),e.p.repeat_count="",e.p.setvalues={},e.p.originalPath=null,e.p.dataSource={},e.p.dataSourceChanged=!1,e.options.customRepeatButtonText=t.vellum.opts().features.use_custom_repeat_button_text},spec:{nodeID:{deserialize:function(e,n,i,r){var o=a.baseSpecs.databind.nodeID.deserialize;if(e.dataSource){var s=e.id.slice(0,e.id.lastIndexOf("/"))||e.id;return o(t.extend({},e,{id:s}),n,i,r)}return o(e,n,i,r)}},repeat_count:t.extend({},s.spec.repeat_count,{visibility:function(e){return!e.p.dataSource.idsQuery}}),dataSource:{lstring:gettext("Data Source"),visibility:"visible_if_present",presence:"optional",widget:function(t,a){var i=n.advancedDataSourceWidget(t,a,gettext("Model Iteration ID Query")),r=i.getValue,o=i.setValue;return i.input.attr({readonly:"readonly"}),i.getValue=function(){var t=r();return{instance:e.trim(t.src)?{id:t.id,src:t.src}:null,idsQuery:t.query}},i.setValue=function(e){o({id:(e=e||{}).instance?e.instance.id:"",src:e.instance?e.instance.src:"",query:e.idsQuery||""})},i},validationFunc:function(e){e.p.dataSource.idsQuery&&e.form.updateLogicReferences(e,"dataSource",e.p.dataSource.idsQuery)},serialize:function(e,t,n,i){if(e&&e.idsQuery)return{idsQuery:a.serializeXPath(e.idsQuery,t,n,i)}},deserialize:function(e,t,n,i){var r=e[t]||{};if(a.updateInstances(e,n),r&&r.instance&&r.instance.id&&r.instance.src){var o={};o[r.instance.id]=r.instance.src,n.form.updateKnownInstances(o)}var s={},l={form:n.form,p:s};return s.idsQuery=a.deserializeXPath(r,"idsQuery",l,i),s}}},ignoreReferenceWarning:function(e){return c(e)},getSetValues:function(e){var n=e.absolutePath,a=e.p.dataSource.idsQuery,i=[];if(a){n=n.replace(/\/item$/,""),e.p.repeat_count=n+"/@count";var r=e.parentMug&&e.parentMug.isInRepeat(),o=e.p.setvalues;t.each(l,(function(e){var t=r?"jr-insert":e.event,s=o[e.key];s||(s={}),s.ref=n+e.path+"/@"+e.key,s.value=e.query.replace("{}","ids"===e.key?a:n),s.event||(s.event=t),i.push({event:t,ref:s.ref,value:s.value})}))}return i}};function c(e){return e&&"Repeat"===e.__className&&e.p.dataSource.idsQuery}e.vellum.plugin("modeliteration",{},{getMugTypes:function(){var e=this.__callOld();return e.normal.Repeat=o.extend(s,u),e},updateControlNodeAdaptorMap:function(e){this.__callOld();var t=e.group;e.group=function(e,n,a,r){var o=t(e,n,a,r);if(o.repeat){var s,l=o.repeat,d=o.path;/\/item$/.test(d)&&(s=a.getMugByPath(d.substring(0,d.length-5)))&&"Repeat"===s.__className&&((o=function(e,t){return s.p.nodeset=d,s.p.repeat_count=l.popAttr("jr:count")||null,s.p.rawRepeatAttributes=i.getAttributes(l),s}).type="Repeat",o.path=d,o.repeat=l,o.ignoreDataNode=!0)}return o}},parseBindElement:function(e,t,n){var a=e.getMugByPath(n);if(!a){var i=n.replace(/\/@current_index$/,"/item");if(n!==i&&c(a=e.getMugByPath(i)))return}this.__callOld()},handleMugParseFinish:function(e){if(this.__callOld(),"Repeat"===e.__className){var n=e.absolutePath,a=null;if(e.p.dataSource.idsQuery&&(a=n.replace(/\/item$/,"")),e.p.originalPath=n,e.p.dataSource={},e.p.dataSourceChanged=!1,e.p.setvalues={},null!==a){var i=e.parentMug&&e.parentMug.isInRepeat(),r=t.object(t.map(e.form.getSetValues(),(function(e){return[e.event+" "+e.ref,e]})));t.each(l,(function(t){var n=i?"jr-insert":t.event,o=r[n+" "+a+t.path+"/@"+t.key];if(o&&(e.p.setvalues[t.key]=o,"ids"===t.key)){var s=(o=o.value)&&o.match(d);e.p.dataSource.idsQuery=s?s[1]:o}})),e.p.dataSource.idsQuery?e.p.dataSource.instance=e.form.parseInstance(e.p.dataSource.idsQuery,e,"dataSource"):e.p.dataSource.idsQuery="''",e.p.rawDataAttributes=t.omit(e.p.rawDataAttributes,["ids","count","current_index"]),function(e){if(e.p.setvalues){var n=t.groupBy(e.p.setvalues,"_id");e.form.dropSetValues((function(e){return n.hasOwnProperty(e._id)}))}}(e)}}},loadXML:function(){this.__callOld(),this.data.core.form.on("mug-property-change",(function(e){var t=e.mug;"Repeat"===t.__className&&"dataSource"===e.property&&(t.p.dataSourceChanged=!0,function(e,t,n){if(n&&n.instance&&n.instance.src&&e.form.dropInstanceReference(n.instance.src,e,"dataSource.instance"),t&&t.instance&&t.instance.src){var a=e.form.addInstanceIfNotExists(t.instance,e,"dataSource.instance");a!==t.instance.id&&(t.instance.id=a,t.idsQuery=e.form.updateInstanceQuery(t.idsQuery,a))}if(Boolean(t&&t.idsQuery)!==Boolean(n&&n.idsQuery)){var i,r=e.p.nodeID,o=e.hashtagPath,s=e.parentMug;t&&t.idsQuery?i=o.replace(/\/item$/,""):(i=o+"/item",/\/@count$/.test(e.p.repeat_count)&&(e.p.repeat_count="")),e.form.vellum.handleMugRename(e.form,e,r,r,o,i,s)}}(t,e.val,e.previous))}))}})}.apply(t,a))||(e.exports=i)},34078:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(77026),n(50705),n(84854),n(98094)],void 0===(i=function(e,t,n,a,i,r){function o(n,a,i,o){var l=null;r.eventuality(this),o&&(l=t.object(t.map(o,(function(n,a){return n&&"object"==typeof n&&(n=e.isPlainObject(n)?t.clone(n):n.clone()),[a,n]})))),this.ufid=r.get_guid(),this.form=a,this.messages=new s,this._baseSpec=i,this.setOptionsAndProperties(n,l)}function s(){this.messages={}}function l(e){this.__data={},this.__spec=e.spec,this.__mug=e.mug,this.shouldChange=function(){return function(){}}}function d(e,n,a,i){e&&/\binstance\(/.test(e)&&(i.instances=t.extend(i.instances||{},a.form.parseInstanceRefs(e)));try{e&&(e=a.form.xpath.parse(e.toString()).toHashtag())}catch(n){t.isString(e)&&!e.startsWith("#invalid/")&&(e="#invalid/xpath "+e)}return e||void 0}function u(e,n,a,i){c(e,a);var r=e[n];if(r)try{r=a.form.xpath.parse(r).toHashtag(),i.later((function(){a.p[n]=i.transformHashtags(r)}))}catch(e){t.isString(r)&&!r.startsWith("#invalid/")&&(r="#invalid/xpath "+r)}else null===r&&(r=void 0);return r}function c(e,n){e.hasOwnProperty("instances")&&!t.isEmpty(e.instances)&&n.form.updateKnownInstances(e.instances)}function p(e){e.p.conflictedNodeId=null}o.prototype={setOptionsAndProperties:function(n,a){var i=this,o=a||this.p&&this.p.getAttrs()||{},s=this.__className;this.logicReferenceAttrs=[],this.options=r.extend(g,n),this.__className=this.options.__className,this.showChangedMsg=!0,this.spec=function(n,a,i){var r=n.control,o=n.databind;i.isDataOnly?r={}:i.isControlOnly&&(o={});var s=e.extend(!0,{},o,r,a);return t.each(s,(function(e,n){t.isFunction(e)&&(e=e(i)),e?s[n]=e:delete s[n]})),s}(this._baseSpec,this.options.spec,this.options),t.each(this.spec,(function(e,t){e.deleteOnCopy&&(!0===e.deleteOnCopy||e.deleteOnCopy(o,s))&&delete o[t],"notallowed"!==i.getPresence(t)&&e.widget&&e.widget.trackLogicReferences&&i.logicReferenceAttrs.push(t)})),this.p=new l({spec:this.spec,mug:this}),this.options.init(this,this.form),this.p.setAttrs(o),this.p.shouldChange=this.form.shouldMugPropertyChange.bind(this.form)},getAppearanceAttribute:function(){return this.options.getAppearanceAttribute(this)},getIcon:function(){return this.options.getIcon(this)},validate:function(e){var n=this;return r.checkForFormSubmissions(n.form),this._withMessages((function(){var a=!1;return n.form.updateLogicReferences(n,e),e?a=n._validate(e):t.each(t.keys(n.p.__data),(function(e){a=n._validate(e)||a})),a}))},_validate:function(e){var t=this,n=t.spec[e];if(!n)return window.console.log("unexpected property: "+e),!1;var a=t.p[e],i=t.getPresence(e),o=n.lstring||e,s="";if(a||"required"!==i){if(a&&"notallowed"===i)s=gettext("{question} is not allowed.");else if(n.validationFunc){try{s=n.validationFunc(t)}catch(e){s=gettext("{question} validation failed")+"\n"+r.formatExc(e)}"pass"===s&&(s="")}}else s=gettext("{question} is required.");return this.messages.update(e,{key:"mug-"+e+"-error",level:this.ERROR,message:r.format(s||"",{question:o})})},ERROR:"error",WARNING:"warning",INFO:"info",addMessage:function(e,t){var n=this.messages;return this._withMessages((function(){return n.update(e,t)}))},dropMessage:function(e,t){var n=this.spec[e],a=this.addMessage(e,{key:t});return n&&n.dropMessage&&n.dropMessage(this,e,t),a},addMessages:function(e){var n=this;this._withMessages((function(){return t.reduce(e,(function(e,a,i){return t.reduce(a,(function(e,t){return n.messages.update(i,t)||e}),!1)||e}),!1)}))},_withMessages:function(e){var n=t.isUndefined(this._messagesChanged),a=!1;n&&(this._messagesChanged=!1);try{(a=e()||this._messagesChanged)&&(n?this.fire({type:"messages-changed",mug:this}):this._messagesChanged=!0)}finally{n&&delete this._messagesChanged}return a},getErrors:function(){var e=[];return this.messages.each((function(t){"info"!==t.level&&e.push(t.message)})),t.uniq(e)},hasErrors:function(){return 0!==this.getErrors().length},getSerializationWarnings:function(){var e=[];return this.messages.each((function(t){t.fixSerializationWarning&&e.push(t)})),e},fixSerializationWarnings:function(e){var n=this;t.each(e,(function(e){e.fixSerializationWarning(n)}))},getLabelValue:function(){return this.p.label||""},getNodeID:function(){return this.p.nodeID},getPresence:function(e){var n=this.spec[e];if(t.isUndefined(n))throw new Error("unknown property: $1.spec.$2".replace("$1",this.__className).replace("$2",e));return t.isFunction(n.presence)?n.presence(this):n.presence},isVisible:function(e){if("notallowed"===this.getPresence(e))return!1;var n=this.spec[e],a=n.visibility;if("visible"===a)return!0;if("visible_if_present"===a)return!t.isUndefined(this.p[e]);if("hidden"===a)return!1;if(t.isFunction(a))return a(this,n);if(this.spec.hasOwnProperty(a))return this.isVisible(a);throw new Error("unknown visibility: $1.spec.$2 = $3".replace("$1",this.__className).replace("$2",e).replace("$3",String(a)))},getDisplayName:function(t,n){void 0===n&&(n=!0);var a,i,r=this.p.labelItext,o=this.form.vellum.data.javaRosa.Itext.getDefaultLanguage(),s=this.p.conflictedNodeId||this.p.nodeID;return"ReadOnly"===this.__className?gettext("Unknown (read-only) question type"):"Itemset"===this.__className?gettext("Lookup Table Data"):r&&"_ids"!==t?(t=t||o)?(i=r.get("default",o),(a=r.get("default",t)||i)&&a!==s?(t!==o&&a===i&&(a+=" ["+o+"]"),n?e("<div>").text(a).html():a):s):gettext("No Translation Data"):s},serialize:function(){var e=this,n={type:e.__className};return t.each(e.spec,(function(a,i){if("notallowed"!==e.getPresence(i)){var r=e.p[i];a.serialize?(r=a.serialize(r,i,e,n),t.isUndefined(r)||(n[i]=r)):!r||t.isEmpty(r)&&(t.isObject(r)||t.isArray(r))||(n[i]=r)}})),n},deserialize:function(e,n){var a=this;t.each(a.spec,(function(i,r){if("notallowed"!==a.getPresence(r))if(i.deserialize){var o=i.deserialize(e,r,a,n);t.isUndefined(o)||(a.p[r]=o)}else e.hasOwnProperty(r)&&(a.p[r]=e[r])}))},teardownProperties:function(){this.fire({type:"teardown-mug-properties",mug:this})},isInRepeat:function(){return"Repeat"===this.__className||this.parentMug&&this.parentMug.isInRepeat()},isReferencedByOtherMugs:function(e){return this.form.isReferencedByOtherMugs(this,e)}},Object.defineProperty(o.prototype,"absolutePath",{get:function(){return this.form.getAbsolutePath(this)}}),Object.defineProperty(o.prototype,"absolutePathNoRoot",{get:function(){return this.form.getAbsolutePath(this,!0)}}),Object.defineProperty(o.prototype,"hashtagPath",{get:function(){return this.options.isHashtaggable&&this.absolutePathNoRoot?"#form"+this.absolutePathNoRoot:this.absolutePath}}),Object.defineProperty(o.prototype,"parentMug",{get:function(){var e=this.form.tree.getNodeFromMug(this);return e&&e.parent?e.parent.value:null}}),Object.defineProperty(o.prototype,"previousSibling",{get:function(){return this.form.tree.getPreviousSibling(this)}}),s.prototype={update:function(e,t){if(e=e||"",1===arguments.length)return!!this.messages.hasOwnProperty(e)&&(delete this.messages[e],!0);if(!this.messages.hasOwnProperty(e)&&!t.message)return!1;if(!t.key)throw new Error("missing key: "+JSON.stringify(t));for(var n=this.messages[e]||[],a=!1,i=n.length-1;i>=0;i--){var r=n[i];if(r.key===t.key){const e=this.getMessageText(r.message),o=this.getMessageText(t.message);if(r.level===t.level&&e===o)return!1;n.splice(i,1),a=!0;break}}if(t.message)n.push(t);else if(!a)return!1;return n.length?this.messages[e]=n:delete this.messages[e],!0},get:function(e,n){return arguments.length?n?t.find(this.messages[e||""],(function(e){return e.key===n}))||null:t.pluck(this.messages[e||""],"message"):t.flatten(t.map(this.messages,(function(e){return t.pluck(e,"message")})))},each:function(){var e,n;arguments.length>1?(e=arguments[0]||"",n=arguments[1],t.each(this.messages[e],n)):(n=arguments[0],t.each(this.messages,(function(e,a){t.each(e,(function(e){n(e,a)}))})))},isEmpty:function(){return t.isEmpty(this.messages)},getMessageText:function(e){return e&&e.hasOwnProperty("markdown")?e.markdown:e}},l.setBaseSpec=function(e){t.each(e,(function(e,t){Object.defineProperty(l.prototype,t,{get:function(){return this._get(t)},set:function(e){this._set(t,e)},configurable:!0})}))},l.prototype={getDefinition:function(e){return this.__spec[e]},getAttrs:function(){return t.clone(this.__data)},has:function(e){return this.__data.hasOwnProperty(e)},set:function(e,t){arguments.length>1?this.__data[e]=t:delete this.__data[e]},_get:function(e){return this.__data[e]},_set:function(e,t){var n=this.__spec[e],a=this.__data[e],i=this.__mug;if(n&&t!==a&&("notallowed"!==i.getPresence(e)||"DataBindOnly"===i.__className)){var r=this.shouldChange(i,e,t,a);r&&(n.setter?n.setter(i,e,t):this.__data[e]=t,r())}},setAttrs:function(e){var n=this;t(e).each((function(e,t){n[t]=e}))}};var f={case:!0,registration:!0,script:!0},h={databind:{nodeID:{visibility:"visible",presence:"required",lstring:gettext("Question ID"),setter:function(e,t,n){e.form.moveMug(e,"rename",n)},mugValue:function(e,t){if(1===arguments.length)return e.p.has("conflictedNodeId")?e.p.conflictedNodeId:e.p.nodeID;e.p.nodeID=t},widget:a.identifier,validationFunc:function(e){var t=e.p.nodeID.toLowerCase(),n={key:"mug-nodeID-reserved-name-warning",level:e.WARNING},a={key:"mug-nodeID-changed-warning",level:e.INFO},i="pass";return f.hasOwnProperty(t)&&(n.message=r.format(gettext("The ID '{nodeID}' may cause problems with form parsing. It is recommended to pick a different Question ID."),{nodeID:e.p.nodeID})),e.addMessage("nodeID",n),r.isValidElementName(e.p.nodeID)?"meta"===e.p.nodeID.toLowerCase()?i=gettext("'meta' is not a valid Question ID."):e.form.warnWhenChanged&&e.showChangedMsg&&e.__originalNodeID&&e.p.nodeID!==e.__originalNodeID&&(a.message=gettext("Making this change will create a new Question ID (and a new column in exports).")):i=r.format(gettext("{nodeID} is not a valid Question ID. It must start with a letter and contain only letters, numbers, and '-' or '_' characters."),{nodeID:e.p.nodeID}),e.addMessage("nodeID",a),i},dropMessage:function(e,t,n){"nodeID"===t&&"mug-conflictedNodeId-warning"===n&&p(e)},serialize:function(e,t,n,a){a.id=n.absolutePathNoRoot},deserialize:function(e,t,n,a){return e.id&&e.id!==n.p.nodeID&&(n.p.nodeID=e.id.slice(e.id.lastIndexOf("/")+1)||n.form.generate_question_id(null,n),e.conflictedNodeId)?a.later((function(){n.p.nodeID=e.conflictedNodeId})):a.later((function(){n.p.conflictedNodeId&&p(n)}))}},conflictedNodeId:{visibility:"hidden",presence:"optional",setter:function(e,t,n){var a=null;n?(e.p.set(t,n),a=gettext("This question has the same Question ID as another question in the same group. Please choose a unique Question ID.")):e.p.set(t),e.addMessage("nodeID",{key:"mug-conflictedNodeId-warning",level:e.WARNING,message:a,fixSerializationWarning:p})},deserialize:function(){}},dataValue:{visibility:"visible_if_present",presence:"optional",lstring:gettext("Default Data Value")},xmlnsAttr:{visibility:"visible",presence:"notallowed",lstring:gettext("Special Hidden Value XMLNS attribute")},rawDataAttributes:{presence:"optional",lstring:gettext("Extra Data Attributes")},relevantAttr:{visibility:"visible",presence:"optional",widget:a.xPath,xpathType:"bool",serialize:d,deserialize:u,lstring:gettext("Display Condition")},calculateAttr:{visibility:"visible_if_present",presence:"optional",widget:a.xPath,xpathType:"generic",serialize:d,deserialize:u,lstring:gettext("Calculate Condition")},constraintAttr:{visibility:"visible",presence:"optional",validationFunc:function(e){return h.databind.constraintMsgAttr.validationFunc(e)},widget:a.xPath,xpathType:"bool",mayReferenceSelf:!0,serialize:d,deserialize:u,lstring:gettext("Validation Condition")},constraintMsgAttr:{visibility:"visible",presence:"optional",validationFunc:function(e){return e.p.constraintMsgAttr&&!e.p.constraintAttr?gettext("You cannot have a Validation Error Message with no Validation Condition!"):"pass"},lstring:gettext("Validation Error Message")},requiredAttr:{visibility:"visible",presence:"optional",lstring:gettext("Required"),widget:a.checkbox,validationFunc:function(e){return h.databind.requiredCondition.validationFunc(e)}},requiredCondition:{visibility:"requiredAttr",presence:"optional",lstring:gettext("Required Condition"),widget:a.xPath,xpathType:"bool",serialize:d,deserialize:u,validationFunc:function(e){var n="mug-requiredCondition-warning",a=["requiredAttr","requiredCondition"];if(e.p.requiredCondition&&!e.p.requiredAttr){var i=gettext("The condition will be ignored unless you mark the question required.");t.each(a,(function(t){e.addMessage(t,{key:n,level:e.WARNING,message:i})}))}else t.each(a,(function(t){e.dropMessage(t,n)}));return"pass"}},nodeset:{visibility:"hidden",presence:"optional"},rawBindAttributes:{presence:"optional",lstring:gettext("Extra Bind Attributes")},defaultValue:{visibility:"visible",presence:"optional",lstring:gettext("Default Value"),widget:a.xPath,xpathType:"generic",serialize:d,deserialize:u,validationFunc:function(e){if(!e.form.vellum.opts().features.allow_data_reference_in_setvalue){var n=e.form.getHashtagsInXPath(e.p.defaultValue);if((n=t.filter(n,(function(e){return"form"===e.namespace}))).length)return gettext("You are referencing a node in this form. This can cause errors in the form")}return"pass"}},comment:{lstring:gettext("Comment"),visibility:"visible",widget:a.multilineText}},control:{appearance:{deleteOnCopy:!0,visibility:"visible",presence:"optional",lstring:gettext("Appearance Attribute")},label:{visibility:"visible",presence:"optional",lstring:gettext("Default Display Text"),validationFunc:function(e){return e.p.label||"required"!==e.getPresence("label")?"pass":gettext("Default Display Text is required")}},hintLabel:{visibility:"visible",presence:"optional",lstring:gettext("Hint Display Text")},rawControlAttributes:{presence:"optional",lstring:gettext("Extra Control Attributes")},rawControlXML:{presence:"optional",lstring:gettext("Raw XML")},dataParent:{lstring:gettext("Data Parent"),visibility:"visible",presence:"optional",setter:function(e,t,n){var a=e.hashtagPath;e.p.set(t,n),e.form._updateMugPath(e,a)},widget:a.droppableText,validationFunc:function(e){function t(e){return e?"limited"===e.options.possibleDataParent?e:t(e.parentMug):null}var n,a=e.p.dataParent,i=e.form;if(a)if(n=i.getMugByPath(a)){if(n===e||!n.options.possibleDataParent)return r.format(gettext("{path} is not a valid data parent"),{path:n.hashtagPath});if(t(e)!==t(n))return gettext("Data parent of question in repeat group must be (in) the same repeat group")}else if(i.getBasePath().slice(0,-1)!==a)return gettext("Must be valid path");return"pass"}}}},g={typeName:"Base",tagName:"input",isDataOnly:!1,isControlOnly:!1,isTypeChangeable:!0,typeChangeError:function(e,t){return""},changeTypeTransform:function(e){},isRemoveable:!0,isCopyable:!0,canOutputValue:!0,maxChildren:-1,icon:null,supportsDataNodeRole:!1,parseDataNode:function(e,t){return t.children()},controlNodeChildren:null,getPathName:null,getTagName:null,dataChildFilter:null,controlChildFilter:null,getExtraDataAttributes:null,writeDataNodeXML:null,getBindList:function(e){var n,a,i=e.p.constraintMsgItext;n=i&&!i.isEmpty()?"jr:itext('"+i.id+"')":e.p.constraintMsgAttr,a=e.p.requiredAttr&&e.p.requiredCondition||r.createXPathBoolFromJS(e.p.requiredAttr);var o={nodeset:e.hashtagPath,type:e.options.dataType,constraint:e.p.constraintAttr,"jr:constraintMsg":n,relevant:e.p.relevantAttr,required:a,requiredCondition:e.p.requiredCondition,calculate:e.p.calculateAttr};return t.each(e.p.rawBindAttributes,(function(e,n){o.hasOwnProperty(n)&&!t.isUndefined(o[n])||(o[n]=e)})),o.nodeset?[o]:[]},getSetValues:function(e){var t=[];return e.p.defaultValue&&(t=[{value:e.p.defaultValue,event:e.isInRepeat()?"jr-insert":"xforms-ready",ref:e.hashtagPath}]),t},writeControlLabel:!0,writeControlHint:!0,writeControlHelp:!0,writeControlAlert:!0,writeControlRefAttr:"ref",writeCustomXML:null,writesOnlyCustomXML:!1,afterInsert:function(e,t){},getAppearanceAttribute:function(e){return e.p.appearance},getIcon:function(e){return e.options.icon},isHashtaggable:!0,init:function(e,t){},spec:{}},m=r.extend(g,{isDataOnly:!0,typeName:gettext("Hidden Value"),icon:"fcc fcc-fd-variable",isTypeChangeable:!1,spec:{xmlnsAttr:{presence:"optional"},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{visibility:"visible"}}}),v=r.extend(g,{writesOnlyCustomXML:!0,writeCustomXML:function(t,n){return t.writeXML(e("<div>").append(n.p.rawControlXML).clone().html())},spec:{readOnlyControl:{visibility:"visible",widget:a.readOnlyControl}}}),x=r.extend(g,{typeName:gettext("Text"),dataType:"xsd:string",icon:"fcc fcc-fd-text",init:function(e,t){}}),y=r.extend(x,{typeName:gettext("Phone Number or Numeric ID"),icon:"fa fa-signal",init:function(e,t){x.init(e,t),e.p.appearance="numeric"},changeTypeTransform:function(e){e.p.appearance=void 0}}),b=r.extend(g,{typeName:gettext("Password"),dataType:"xsd:string",tagName:"secret",icon:"fa fa-key",canOutputValue:!1,init:function(e,t){}}),w=r.extend(g,{typeName:gettext("Integer"),dataType:"xsd:int",icon:"fcc fcc-fd-numeric",init:function(e,t){}}),_=r.extend(g,{typeName:gettext("Audio Capture"),dataType:"binary",tagName:"upload",icon:"fcc fcc-fd-audio-capture",mediaType:"audio/*",canOutputValue:!1,writeCustomXML:function(e,t){e.writeAttributeString("mediatype",t.options.mediaType)}}),M=r.extend(_,{typeName:gettext("Image Capture"),icon:"fa fa-camera",mediaType:"image/*",spec:{imageSize:{lstring:gettext("Image Size"),visibility:"visible",widget:a.dropdown,enabled:function(e){return e.options.resize_enabled},defaultOptions:[{text:gettext("Small"),value:"250"},{text:gettext("Medium"),value:"500"},{text:gettext("Large"),value:"1000"},{text:gettext("Original"),value:""}],help:gettext("This will resize the image before sending the form. Use this option to send smaller images in areas of poor connectivity.<ul><li>Small - 0.1 megapixels</li><li>Medium - 0.2 megapixels</li><li>Large - 0.5 megapixels</li></ul>")}},writeCustomXML:function(e,t){_.writeCustomXML(e,t),"Image"===t.__className&&t.p.imageSize&&e.writeAttributeString("jr:imageDimensionScaledMax",t.p.imageSize+"px")},init:function(e,t){_.init(e,t),""!==e.p.imageSize&&(e.p.imageSize=e.p.imageSize||250)}}),I=r.extend(_,{typeName:gettext("Micro-Image"),isTypeChangeable:!1,icon:"fa fa-camera",tagName:"input",mediaType:"image/*",init:function(e,t){_.init(e,t),e.p.appearance="micro-image"}}),C=r.extend(_,{typeName:gettext("Video Capture"),icon:"fa fa-video-camera",mediaType:"video/*"}),A=r.extend(M,{typeName:gettext("Signature Capture"),icon:"fcc fcc-fd-signature",spec:{imageSize:{visibility:"hidden"}},init:function(e,t){M.init(e,t),e.p.appearance="signature"},changeTypeTransform:function(e){e.p.appearance=void 0}}),k=r.extend(_,{typeName:gettext("Document Upload"),icon:"fa fa-file",mediaType:"application/*,text/*"}),P=r.extend(g,{typeName:gettext("GPS"),dataType:"geopoint",icon:"fa-solid fa-location-dot",init:function(e,t){}}),T=r.extend(g,{typeName:gettext("Barcode Scan"),dataType:"barcode",icon:"fa fa-barcode",init:function(e,t){}}),N=r.extend(g,{typeName:gettext("Date"),dataType:"xsd:date",icon:"fa-solid fa-calendar-days",init:function(e,t){}}),D=r.extend(g,{typeName:gettext("Date and Time"),dataType:"xsd:dateTime",icon:"fcc fcc-fd-datetime",init:function(e,t){}}),S=r.extend(g,{typeName:gettext("Time"),dataType:"xsd:time",icon:"fa-regular fa-clock",init:function(e,t){}}),E=r.extend(w,{typeName:gettext("Long"),dataType:"xsd:long",icon:"fcc fcc-fd-long",init:function(e,t){}}),R=r.extend(w,{typeName:gettext("Decimal"),dataType:"xsd:double",icon:"fcc fcc-fd-decimal",init:function(e,t){}}),O=r.extend(g,{isControlOnly:!0,typeName:gettext("Choice"),tagName:"item",icon:"fcc fcc-fd-single-circle",isTypeChangeable:!1,canOutputValue:!1,getIcon:function(e){return"Select"===e.parentMug.__className?"fcc fcc-fd-single-circle":"fcc fcc-fd-multi-box"},writeControlHint:!1,writeControlHelp:!1,writeControlAlert:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){var n=t.p.nodeID;n&&(e.writeStartElement("value"),e.writeString(n),e.writeEndElement())},init:function(e,t){},spec:{nodeID:{lstring:gettext("Choice Value"),visibility:"visible",presence:"required",widget:a.identifier,setter:null,validationFunc:function(e){if(/\s/.test(e.p.nodeID))return gettext("Whitespace in values is not allowed.");if(e.parentMug){var n=e.form.getChildren(e.parentMug);if(t.any(n,(function(t){return t!==e&&t.p.nodeID===e.p.nodeID})))return gettext("This choice value has been used in the same question")}return"pass"},serialize:function(e,t,n,a){var i=n.parentMug.absolutePathNoRoot;a.id=i+"/"+e},deserialize:function(e){return e.id&&e.id.slice(e.id.lastIndexOf("/")+1)}},labelItext:{presence:"required"},conflictedNodeId:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},helpItext:{presence:"notallowed"},defaultValue:{presence:"optional",visibility:"hidden"}}}),L=r.extend(g,{typeName:gettext("Label"),tagName:"trigger",icon:"fa fa-tag",init:function(e,t){e.p.appearance="minimal"},changeTypeTransform:function(e){e.p.appearance=void 0},spec:{dataValue:{presence:"optional"},defaultValue:{presence:"optional",visibility:"hidden"},requiredAttr:{deleteOnCopy:function(e,t){return"minimal"===e.appearance||"DataBindOnly"!==t},visibility:function(e){return"minimal"!==e.p.appearance}},requiredCondition:{deleteOnCopy:function(e,t){return"minimal"===e.appearance||"DataBindOnly"!==t}}}}),q=r.extend(g,{validChildTypes:["Choice"],controlNodeChildren:function(e){return e.children().not("label, value, hint, help, alert")},typeChangeError:function(e,t){return e.form.getChildren(e).length>0&&!t.match(/^M?Select$/)?gettext("Cannot change a Multiple/Single Choice question to a non-Choice question if it has Choices. Please remove all Choices and try again."):""},canAddChoices:!0,spec:{appearance:{deleteOnCopy:!1}},dataType:""}),F=r.extend(q,{typeName:gettext("Checkbox"),tagName:"select",icon:"fcc fcc-fd-multi-select",defaultOperator:"selected"}),V=r.extend(q,{typeName:gettext("Multiple Choice"),tagName:"select1",icon:"fcc fcc-fd-single-select",defaultOperator:null}),j=r.extend(g,{typeName:gettext("Group"),tagName:"group",icon:"fa fa-folder-open",isSpecialGroup:!0,isNestableGroup:!0,isTypeChangeable:!1,possibleDataParent:!0,canOutputValue:!1,controlNodeChildren:function(e){return e.children().not("label, value, hint, help, alert")},init:function(e,t){},spec:{hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},helpItext:{presence:"notallowed"},calculateAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},constraintMsgAttr:{presence:"notallowed"},dataValue:{presence:"notallowed"},requiredAttr:{presence:"notallowed"},defaultValue:{presence:"optional",visibility:"hidden"}}}),B=r.extend(j,{typeName:gettext("Question List"),icon:"fa fa-reorder",init:function(e,t){j.init(e,t),e.p.appearance="field-list"},changeTypeTransform:function(e){e.p.appearance=void 0}}),z=r.extend(j,{typeName:gettext("Repeat Group"),icon:"fa fa-retweet",possibleDataParent:"limited",controlNodeChildren:function(e){return e.children("repeat").children().not("jr\\:addEmptyCaption, jr\\:addCaption")},getExtraDataAttributes:function(e){return{"jr:template":""}},controlChildFilter:function(e,a){var i=a.hashtagPath,o=a.p.repeat_count,s=t.object(t.filter(t.map(a.p.rawRepeatAttributes,(function(e,t){return"jr:noaddremove"!==t.toLowerCase()?[t,e]:null})),t.identity));return[new n.Node(e,{getNodeID:function(){},getAppearanceAttribute:function(){},form:a.form,p:{rawControlAttributes:s,addEmptyCaptionItext:a.p.addEmptyCaptionItext,addCaptionItext:a.p.addCaptionItext},options:{tagName:"repeat",writeRepeatItexts:a.options.customRepeatButtonText,writeControlLabel:!1,writeControlHint:!1,writeControlHelp:!1,writeControlAlert:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){o&&(r.writeHashtags(e,"jr:count",String(o)),e.writeAttributeString("jr:noAddRemove","true()")),r.writeHashtags(e,"nodeset",i,t)}}})]},writeControlRefAttr:null,init:function(e,t){e.p.repeat_count=null},spec:{repeat_count:{lstring:gettext("Repeat Count"),visibility:"visible_if_present",presence:"optional",widget:a.droppableText,validationFunc:function(t){return!e.trim(t.p.repeat_count)&&function e(t){if(!t)return!1;var n=t.parentMug;return!(!n||"FieldList"!==n.__className)||e(n)}(t)?gettext("Repeat Count is required."):"pass"}},rawRepeatAttributes:{presence:"optional",lstring:gettext("Extra Repeat Attributes")}}});function U(n,a,i){var o=this,s=i.features.group_in_field_list;M.resize_enabled=i.features.image_resize,this.auxiliaryTypes=a.auxiliary,this.normalTypes=a.normal,this.baseSpec=n,l.setBaseSpec(r.extend.apply(null,[n.databind,n.control].concat(t.filter(t.pluck(r.extend(this.normalTypes,this.auxiliaryTypes),"spec"),t.identity)))),this.allTypes=e.extend({},this.auxiliaryTypes,this.normalTypes);var d=t.keys(this.allTypes),u=t.without.apply(t,[d].concat(t.keys(this.auxiliaryTypes)));s||(this.normalTypes.FieldList.validChildTypes=t.without.apply(t,[u].concat(t.without(t.map(this.allTypes,(function(e,t){return e.isNestableGroup?t:null})),null)))),t.each(this.auxiliaryTypes,(function(e){e.validChildTypes=[]})),t.each(this.normalTypes,(function(e,t){var n;e.validChildTypes||(n=e.isNestableGroup?u:[],e.validChildTypes=n)})),t.each(this.allTypes,(function(e,t){e.__className=t,o[t]=e}))}return U.prototype={make:function(e,t,n){var a=this.allTypes[e],i=n?n.p.getAttrs():null;return new o(a,t,this.baseSpec,i)},changeType:function(e,n){var a=e.form,i=a.getChildren(e),r=this.allTypes[e.__className].typeChangeError(e,n);if(r)throw new Error(r);this.allTypes[e.__className].changeTypeTransform(e),e.setOptionsAndProperties(this.allTypes[n]),-1!==n.indexOf("Select")&&t.each(i,(function(e){a.fire({type:"parent-question-type-change",childMug:e})})),e.validate(),a.fire({type:"question-type-change",qType:n,mug:e}),a.fireChange(e)}},{defaultOptions:g,baseMugTypes:{normal:{Audio:_,Barcode:T,DataBindOnly:m,Date:N,DateTime:D,Document:k,Double:R,FieldList:B,Geopoint:P,Group:j,Image:M,MicroImage:I,Int:w,Long:E,MSelect:F,PhoneNumber:y,ReadOnly:v,Repeat:z,Secret:b,Select:V,Signature:A,Text:x,Time:S,Trigger:L,Video:C},auxiliary:{Choice:O}},MugTypesManager:U,MugMessages:s,WARNING:o.WARNING,ERROR:o.ERROR,baseSpecs:h,deserializeXPath:u,serializeXPath:d,updateInstances:c}}.apply(t,a))||(e.exports=i)},37417:(e,t,n)=>{var a,i;a=[n(65392),n(98094),n(77229),n(10561),n(13946)],void 0===(i=function(e,t,n,a,i){function r(e){return i.chain(a(e)[0].attributes).map((function(e){return[e.nodeName,e.nodeValue]})).object().value()}function o(e){var t=function(t,n){return t?n.changeMugType(t,e):t=n.mugTypes.make(e,n),t};return t.type=e,t}function s(e){var t=function(t,n){return n.mugTypes.make(e,n)};return t.type=e,t.ignoreDataNode=!0,t}function l(e,t){if(!e)return t;var n=e.toLowerCase().replace(/\s/g,"");return"false()"!==n&&(!!n||t)}function d(e,t,n,a){if(!e)return null;var i,r,o=c(t,e,"ref",a),s=t.tree.getRootNode().getID();if(o||(o=c(t,e,"nodeset",a)),o||(i=c(t,e,"bind",a))&&(r=u(i,s,t),t.getMugByPath(r)?o=r:t.parseWarnings.push(gettext("Ambiguous bind:")+" "+i)),(o=o||i||null)&&"/"!==o[0]&&"#"!==o[0]&&"`"!==o[0])if(n){var l=n.hashtagPath;l&&(o=l+"/"+o)}else o=t.getBasePath()+o;return o}function u(e,t,n){var a;try{a=n.xpath.parse(e)}catch(t){return e}return a instanceof n.xpath.models.XPathPathExpr||a instanceof n.xpath.models.HashtagExpr?(a.initial_context===n.xpath.models.XPathInitialContextEnum.RELATIVE&&(a.steps.splice(0,0,n.xpath.models.XPathStep({axis:"child",test:t})),a.initial_context=n.xpath.models.XPathInitialContextEnum.ROOT),a.toHashtag()):e}function c(e,t,n,a){var i=(a?t.xmlAttr:t.popAttr).bind(t),r=i("vellum:"+n.replace(/:/g,"__")),o=i(n);return e.inferHashtagMeanings(r,o),e.normalizeHashtag(e.richText&&r?r:o)}return{init:function(e){var t,n,a,i,l,u=e.data.core;u.controlNodeAdaptorMap=(t={string:o("Text"),long:o("Long"),int:o("Int"),double:o("Double"),date:o("Date"),datetime:o("DateTime"),time:o("Time"),geopoint:o("Geopoint"),barcode:o("Barcode"),intent:o("AndroidIntent")},n=o("Select"),a=s("Choice"),i=o("Trigger"),l=function(e){return function(t,n){return(t=i(t,n)).p.appearance=e,t}},{secret:function(){return o("Secret")},select:function(){return o("MSelect")},select1:function(){return n},trigger:function(e,t){return l(t)},input:function(e,n){return"true()"===e.popAttr("readonly")?l(n):function(e,a){var i=e&&e.p.rawBindAttributes&&e.p.rawBindAttributes.type;if(i){if(i=(i=i.replace("xsd:","")).toLowerCase(),t.hasOwnProperty(i))return delete e.p.rawBindAttributes.type,"string"===i&&"numeric"===n?o("PhoneNumber")(e,a):t[i](e,a);if("micro-image"===n&&a.vellum.opts().features.case_micro_image)return o("MicroImage")(e,a)}return t.string(e,a)}},item:function(e){var t=function(t,n){return(t=a(t,n)).p.nodeID=e.children("value").text(),t};return t.type=a.type,t.ignoreDataNode=!0,t},group:function(e,t,n,a){var i;if("field-list"===t)i="FieldList";else{var s=e.children("repeat");if(1===s.length){var l=function(e,t){return(e=o("Repeat")(e,t)).p.repeat_count=c(t,s,"jr:count")||null,e.p.rawRepeatAttributes=r(s),e};return l.repeat=s,l.path=d(s,n,a),l.type="Repeat",l}i="Group"}return o(i)},upload:function(e,t,n,a){var i,r=e.popAttr("mediatype");if(!r)throw"Unable to parse binary question type. The question has no MediaType attribute assigned to it!";if("video/*"===(r=r.toLowerCase()))i="Video";else if("image/*"===r)i="signature"===t?"Signature":"Image";else if("audio/*"===r)i="Audio";else{if("application/*,text/*"!==r)throw"Unrecognized upload question type for Element: "+d(e,n,a);i="Document"}return o(i)}}),e.updateControlNodeAdaptorMap(u.controlNodeAdaptorMap)},parseXForm:function(n,s,l,p){var f=e.Form,h=e.InstanceMetadata,g=new f(s,l,s.mugTypes);if(g.parseErrors=[],g.parseWarnings=p,g.isLoadingXForm=!0,!n)return l.performAdditionalParsing(g,null),g.isLoadingXForm=!1,g;var m=t.parseXML(n),v=m.find("h\\:xdoc"),x=m.find(":root > h\\:head, :root > head"),y=x.children("h\\:title, title"),b=x.find("bind"),w=function(e){for(var t=e.find("instance"),n=!1,i=[],r=0;r<t.length;r++)if(a(t[r]).xmlAttr("id"))i.push(t[r]);else{if(n)throw"multiple unnamed instance elements found in the form! this is not allowed. please add id's to all but 1 instance.";i.splice(0,0,t[r]),n=!0}return i}(m),_=a(w[0]).children(),M=x.find("> model > setvalue");if(m.find("parsererror").length>0)throw gettext("PARSE ERROR!:")+m.find("parsererror").find("div").html();v.length||(v=x.parent());var I,C=v.xmlAttr("vellum:ignore");if(C=C?C.split(" "):[],i.contains(C,"richText")&&(g.richText=!1),i.contains(C,"markdown")&&(g.noMarkdown=!0),g.instanceMetadata=w.map((function(e){return h(r(e),a(e).children())})),g.updateKnownInstances(),g.richText&&!g.vellum.datasources.isReady()&&function(e,t,n){try{t=JSON.parse(a.trim(t.text()))}catch(e){t={}}try{n=JSON.parse(a.trim(n.text())).prefixes||{}}catch(e){n={}}i.isEmpty(n)||(e.hashtagTransformations=i.object(i.map(n,(function(e,t){return[t,function(t){return e+t}]})))),i.each(t,(function(t,a){e.initHashtag(a,function(e,t){if(!t){var a=/(#.+\/)([^\/]+)/.exec(e);if(a&&n.hasOwnProperty(a[1]))return n[a[1]]+a[2]}return t}(a,t))})),e.shouldInferHashtags=i.some(e.hashtagMap,(function(e){return null===e}))}(g,x.children("vellum\\:hashtags, hashtags"),x.children("vellum\\:hashtagTransforms, hashtagTransforms")),0===_.length&&g.parseErrors.push(gettext("No Data block was found in the form. Please check that your form is valid!")),function(e,n,i){var r,o=a(n),s=e.tree;r=function(t){var n=e.vellum.parseDataElement(e,this,t),i=n.options.parseDataNode(n,a(this),t);s.insertMug(n,"into",t),e._fixMugState(n),i.each((function(){r.call(this,n)}))},o[0]?e.setFormID(o[0].tagName):e.setFormID("data"),o.children().each((function(){r.call(this,null)})),e.formUuid=o.xmlAttr("xmlns"),e.formJRM=o.xmlAttr("xmlns:jrm"),e.formUIVersion=o.xmlAttr("uiVersion"),e.formVersion=o.xmlAttr("version");var l=e.vellum.opts().core.formName||o.xmlAttr("name")||i;l?e.formName=l:e.parseWarnings.push(gettext("Form does not have a Name! The default form name will be used")),e.formUuid&&"undefined"!==e.formUuid||(e.formUuid="http://openrosa.org/formdesigner/"+t.generate_xmlns_uuid()),e.formJRM||e.parseWarnings.push(gettext("Form JRM namespace attribute was not found in data block. One will be added automatically")),e.formUIVersion||e.parseWarnings.push(gettext("Form does not have a UIVersion attribute, one will be generated automatically")),e.formVersion||e.parseWarnings.push(gettext("Form does not have a Version attribute (in the data block), one will be added automatically"))}(g,_[0],y.length?y.text():""),function(e,t){var n=e.tree.getRootNode().getID();t.each((function(){var t=a(this),i=c(e,t,"nodeset")||c(e,t,"ref");e.vellum.parseBindElement(e,t,u(i,n,e))}))}(g,b),function(e,t){var n=e.tree.getRootNode().getID();t.each((function(){var t=a(this);e.vellum.parseSetValue(e,t,u(c(e,t,"ref",!0),n,e))}))}(g,M),function(e,t){function n(e){return e.value.ufid}function s(t,l){for(var u=function(e){var t=0,n=e.length;return function(){return t<n?e[t++]:null}}(t.children),c=function(t,n){var l=0,u=t.length;return function(){if(l>=u)return null;var c=a(t[l++]),p=function(e,t,n){var a,s=t[0].nodeName.toLowerCase(),l=t.popAttr("appearance"),u=null,c=e.vellum.getControlNodeAdaptorFactory(s);if(c&&(a=c(t,l,e,n)),a||(a=function(e){var t=function(t,n){return t=o("ReadOnly")(t,n),1===e.length&&e[0].poppedAttributes&&i.each(e[0].poppedAttributes,(function(t,n){e.xmlAttr(n,t)})),t.p.rawControlXML=e,t};return t.skipPopulate=!0,t}(t)),!a.ignoreDataNode){var p=a.path;p||(p=d(t,e,n)),u=e.getMugByPath(p)}u=a(u,e);var f=e.tree.getNodeFromMug(u);if(f){if(f.parent.value!==n){var h=f.parent,g=f.parent.value;u.p.dataParent=h.isRootNode?"#form":g.hashtagPath,f=e.tree.insertMug(u,"into",n)}}else u.options.isControlOnly=!0,f=e.tree.insertMug(u,"into",n),e.mugMap[u.ufid]=u;return l&&(u.p.appearance=l),a.skipPopulate||(e.vellum.populateControlMug(u,t),u.p.rawControlAttributes=r(t)),f}(e,c,n),f=p.value;return f.options.controlNodeChildren&&s(p,f.options.controlNodeChildren(c)),p}}(l,t.value),p=u(),f=c(),h=[],g={},m=!1;f;)p?(p===f&&(h.push(f),f=c()),g[n(p)]=null,p=u()):(m=m||g.hasOwnProperty(n(f)),h.push(f),f=c());m&&(t.children=i.union(h,t.children))}s(e.tree.getRootNode(),t)}(g,m.find(":root > h\\:body, :root > body").children()),g.parseErrors)for(I=0;I<g.parseErrors.length;I++)g.updateError({level:"error",message:g.parseErrors[I]});if(g.parseWarnings)for(I=0;I<g.parseWarnings.length;I++)g.updateError({level:"parse-warning",message:g.parseWarnings[I]});return l.performAdditionalParsing(g,m),g.isLoadingXForm=!1,g},parseDataElement:function(e,t,n,i){var o=a(t),s=t.nodeName,l=o.children().length?null:o.text(),d=o.popAttr("xmlns")||null,u=o.popAttr("vellum:comment")||null;(i=i||o.xmlAttr("vellum:role"))&&e.mugTypes.allTypes.hasOwnProperty(i)&&e.mugTypes.allTypes[i].supportsDataNodeRole?o.popAttr("vellum:role"):i="DataBindOnly";var c=e.mugTypes.make(i,e);return c.p.nodeID=s,c.__originalNodeID=s,c.p.dataValue=l||void 0,d&&d!==e.formUuid&&(c.p.xmlnsAttr=d),u&&(c.p.comment=u),c.p.rawDataAttributes=r(t),c},parseBindElement:function(e,n,a){var i=e.getMugByPath(a);if(i){var o,s,d=n.popAttr("required"),u={relevantAttr:c(e,n,"relevant"),calculateAttr:c(e,n,"calculate"),constraintAttr:c(e,n,"constraint"),constraintMsgAttr:(o=n,s="constraintMsg",o.popAttr("jr:"+s)||o.popAttr("jr\\:"+s)||null),requiredAttr:l(d),requiredCondition:c(e,n,"requiredCondition")||("true()"!==d&&"false()"!==d?d:void 0)},p=u.rawBindAttributes=r(n);p.type&&"xsd:integer"===p.type.toLowerCase()&&(p.type="xsd:int"),i.p.setAttrs(u)}else e.parseWarnings.push(t.format(gettext("Bind Node [{path}] found but has no associated Data node. This bind node will be discarded!"),{path:a}))},parseSetValue:function(e,t,n){var a=e.getMugByPath(n),i=t.xmlAttr("event"),r=c(e,t,"ref",!0),o=c(e,t,"value",!0);!a||"xforms-ready"!==i&&"jr-insert"!==i?e.addSetValue(i,r,o):a.p.defaultValue=o},populateControlMug:function(e,t){var a=t.children("label"),i=t.children("hint"),r=t.popAttr("jr:imageDimensionScaledMax");if(a.length&&"notallowed"!==e.getPresence("label")){var o=n.humanize(a);o&&(e.p.label=o)}i.length&&"notallowed"!==e.getPresence("hintLabel")&&(e.p.hintLabel=n.humanize(i)),"Image"===e.__className&&(e.p.imageSize=r?parseInt(r):"")},getAttributes:r,getPathFromControlElement:d,makeControlOnlyMugAdaptor:s,makeMugAdaptor:o}}.apply(t,a))||(e.exports=i)},94459:(e,t,n)=>{var a,i;a=[n,n(13946),n(10561),n(88654),n(66990),n(49832),n(48916),n(84854),n(98094),n(77229),n(53578),n(7512)],void 0===(i=function(e,t,a,i,r,o,s,l,d,u,c,p){var f=/^#form\//,h="#invalid/xpath ",g="​";function m(e){const t=(new DOMParser).parseFromString(e,"text/html"),n=document.createDocumentFragment();return Array.from(t.body.childNodes).forEach((e=>{"SPAN"===e.tagName&&(e.contentEditable=!1),n.appendChild(e)})),n}function v(e,t,n){function a(e){var t=0,n=Array.from(e.childNodes),i=n.length,r=null;return function e(){var o;if(r){if(null!==(o=r()))return o;if(r=null,n[t-1]&&"p"===n[t-1].nodeName.toLowerCase())return{node:n[t-1],length:1,isText:!1}}if(t>=i)return null;if(o=n[t],t++,o.nodeType===Node.ELEMENT_NODE){var s=o.nodeName.toLowerCase();if("p"===s)return r=a(o),e();if("span"===s||"br"===s)return{node:o,length:1,isText:!1};throw new Error("not implemented: "+s)}if(o.nodeType===Node.TEXT_NODE)return{node:o,length:o.textContent.length,isText:!0};throw new Error("unhandled element type: "+o.nodeType)}}function i(e,t){for(var n=e,a=t();a;){if(a.length>=n)return{node:a.node,offset:n,isText:a.isText};n-=a.length,a=t()}throw new Error("index is larger than content: "+e)}e.focus();var r=window.getSelection(),o=a(e),s=i(t,o),l=document.createRange();s.isText?l.setStart(s.node,s.offset):l.setStartAfter(s.node),n?(s=i(t+n,o=a(e))).isText?l.setEnd(s.node,s.offset):l.setEndAfter(s.node):l.collapse(!0),r.removeAllRanges(),r.addRange(l)}var x={dateFormat:{serialize:function(e,n){return t.template("format-date(date(<%=xpath%>), '<%=dateFormat%>')")({xpath:e,dateFormat:n.dateFormat})}},value:{serialize:function(e){return t.template('&lt;output value="<%=xpath%>" /&gt;')({xpath:e})}}},y=["dateFormat","value"];function b(e){var n=e.value;return t.each(y,(function(t){e[t]&&(n=x[t].serialize(n,e))})),n}function w(e,t){var n,i,r,o,s,d,u=function(e,t){if(!f.test(e)){if(t.isValidHashtag(e))return{classes:["label-datanode-external","fcc fcc-fd-case-property"]};if(t.hasValidHashtagPrefix(t.normalizeHashtag(e)))return{classes:["label-datanode-external-unknown","fa-solid fa-triangle-exclamation"]}}var n=t.getIconByPath(e);return n?{classes:["label-datanode-internal",n]}:{classes:["label-datanode-unknown","fcc fcc-help"]}}(t,e),c=u.classes[0],p=u.classes[1],h=(n=t,i=e.xpath,s=(o=new l.LogicExpression(n,i)).getTopLevelPaths(),d=o.getHashtags(),s.length?(r=s[0].steps)[r.length-1].name:(r=d[0].toHashtag().split("/"))[r.length-1]),g=a("<i>").addClass(p).html("&nbsp;"),m="bubble-"+Math.random().toString(36).slice(2,10);return a("<span>").addClass("label label-datanode "+c).attr("data-value",t).attr("contenteditable","false").attr("data-toggle","popover").attr("id",m).append(g).append(h)}function _(e,n){var i=T(a(n)),r=e.normalizeHashtag(i.value,!0),o=t.omit(i,"value"),s=r&&(f.test(r)||e.hasValidHashtagPrefix(r)),l=/\s/.test(r);return!s||s&&l?a("<span>").text(u.normalize(n)).html():a("<div>").append(document.createTextNode(g)).append(w(e,r).attr(o)).append(document.createTextNode(g)).html()}function M(e,t,n){var a,i,r=u.xhtml(e),o={};return a=n?function(){var e=d.get_guid();return o[e]=_(t,this),"{"+e+"}"}:function(){return _(t,this)},r.find("output").replaceWith(a),i=r.html(),n&&(i=I(i,o)),i}function I(e,t){return(e=a("<div />").text(u.humanize(e)).html()).replace(/{(.+?)}/g,(function(e,n){return t.hasOwnProperty(n)?a("<div>").append(t[n]).html():e}))}function C(e,t){var n;return A(e)?(e=e.slice(15),n=s.transform):n=t.transformHashtags,n(e,(function(e){return w(t,e).prop("outerHTML")}),!0)}function A(e){return e.startsWith(h)}function k(e,t,n){return e?function(e){return"<p>"+(e=e.replace(/\n/g,"</p><p>").replace(/  /g," &nbsp;"))+"</p>"}(((n=n||{}).isExpression?C:M)(e,t)):""}function P(e,t,n){return function(e,t,n){var i,r,o,l=u.xhtml(e),c={},p=l.find(".label-datanode");if(!p.length)return l.text();if(i=n?function(){var e=d.get_guid();return c[e]=a(this).data("value"),"{"+e+"}"}:function(){return b(a(this).data())},p.replaceWith(i),r=l.text(),n){o=r.replace(/{(.+?)}([\w.\-]?)/g,(function(e,t,n){return c.hasOwnProperty(t)?c[t]+(n?" "+n:""):e}));try{t.xpath.parse(o)}catch(e){o=h+s.escapeDelimiters(r).replace(/{(.+?)}/g,(function(e,t){return c.hasOwnProperty(t)?s.delimit(c[t]):e}))}r=o}return r}(function(e){return e.replace(/<p>&nbsp;<\/p>/gi,"\n").replace(/<p>/gi,"").replace(/<\/p>/gi,"\n").replace(/<br \/>/gi,"\n").replace(/(&nbsp;|\xa0|\u2005)/gi," ").replace(/(\u200B)/gi,"").replace(/\n$/,"")}(e),t,n)}function T(e){var t=e.xmlAttr("vellum:value")||e.xmlAttr("value")||e.xmlAttr("ref"),n=/^format-date\(date\(([^)]+)\),\s*'([^']+)'\)$/.exec(t);return n?{value:n[1],"data-date-format":n[2]}:{value:t}}var N={Y:"yyyy",y:"yy",m:"mm",n:"m",b:"mmm",d:"dd",e:"d",H:"HH",h:"H",M:"MM",S:"SS",3:"msec",a:"ddd"};function D(e){return e?e.replace(/(%[YymnbdeHhMS3a])/g,(function(e,t){return N.hasOwnProperty(t[1])?N[t[1]]:t})):gettext("no formatting")}function S(e){var t,s,l=a(e),p=l.closest(".form-control"),h=e.getAttribute("data-value"),g=(0,n(50705).util.getWidget)(p);if(g){var m=f.test(h),v=e.textContent.trim(),x=g.mug.form.normalizeHashtag(h),y=d.escape(x),b=g.mug.form.getMugByPath(h),w=b&&b.p.labelItext?b.p.labelItext.get():"",_=b&&0===b.__className.indexOf("Date"),M=d.get_guid();b||(w=g.mug.form.vellum.datasources.getNode(x,{}).description||""),(w=u.xhtml(w)).find("output").replaceWith((function(){var e=T(a(this)).value;return g.mug.form.normalizeHashtag(e)})),w=u.normalize(w),l.popover({trigger:"hover",container:"body",placement:"bottom",title:(t=y,s=l.attr("data-date-format"),(_||s)&&(t+=i({guid:M,text:d.escape(D(s))})),"<h3>"+d.escape(v)+'</h3><div class="text-muted">'+t+"</div>"),html:!0,sanitize:!1,content:r({text:w,ufid:b?b.ufid:""}),template:'<div contenteditable="false" class="popover rich-text-popover"><div class="popover-inner"><div class="popover-title"></div>'+(b||w?'<div class="popover-content"><p></p></div>':"")+"</div></div>",delay:{show:350,hide:200}}).on("shown.bs.popover",(function(){var e=m?"form":"case";if(c.fbUsage("Hovered over easy "+e+" reference"),c.workflow("Hovered over easy reference"),_||p.attr("data-date-format")){var t=a(this).offset(),n=t.left,i=t.top+a(this).height();a("#"+M).click((function(){return l.popover("hide"),o.showMenu(n,i,(function(e){p.attr("data-date-format",e)}),!0),!1}))}})),e.classList.add("popover-initialized"),l.on("destroy",(function(e){try{l.popover("destroy")}catch(e){}}))}}return{applyFormats:b,bubbleOutputs:M,sanitizeInput:function(e){if(!/<(?!output| )/g.test(e))return e;var t=u.xhtml(e),n={};return t.find("output").replaceWith((function(){var e=d.get_guid();return n[e]=this,"{"+e+"}"})),I(t.html(),n)},editor:function(e,t,i){var r=e[0];function o(e,t=!1){const n=document.activeElement===r;let a;if(!n&&h&&x){const t=document.elementFromPoint(h,x),n=t?t.closest(".label-datanode"):null;if(n)a=document.createRange(),a.setStartAfter(n),a.setEndAfter(n);else{const t=document.caretPositionFromPoint(h,x);if(t){a=document.createRange(),a.setStart(t.offsetNode,t.offset),a.collapse(!0);const n=t.offsetNode.parentNode;n&&"P"===n.tagName&&t.offsetNode.nodeType===Node.TEXT_NODE&&t.offset===t.offsetNode.nodeValue.length&&(e=e.replace(/^<p>/i,"").replace(/<\/p>$/i,""))}}}else n?a=window.getSelection().getRangeAt(0):(a=document.createRange(),a.selectNodeContents(r),a.collapse());if(a){const n=window.getSelection();if(n.removeAllRanges(),n.addRange(a),a.deleteContents(),t){const e=document.createTextNode(g);a.insertNode(e),a.setStartAfter(e)}const i=m(e),o=[];if(i.childNodes.forEach((e=>{e.getAttribute&&e.getAttribute("data-toggle")&&o.push(e)})),a.insertNode(i),a.collapse(),t){const e=document.createTextNode(g);a.insertNode(e),a.collapse()}o.forEach((e=>{S(e)})),r.focus();const s=new Event("input",{bubbles:!0,cancelable:!0});r.dispatchEvent(s),c.push()}}i&&i.disableNativeSpellChecker?r.setAttribute("spellcheck",!1):r.setAttribute("spellcheck",!0);var l=n(50705).util.getWidget;function d(e,t,n=0){n<5&&(null!=l(a(e))?t():setTimeout((()=>d(e,t,n+1)),500))}const u=e.data("ckwrapper");if(u)return u;const c=new p.ElementUndoStack(r);function f(e){const t=window.getSelection();if(!t.rangeCount)return;const n=t.getRangeAt(0);if(!n.collapsed)return;const a=n.startContainer,i=n.startOffset;if(a.nodeType===Node.TEXT_NODE){if(i===a.length&&a.nodeValue.endsWith(g)){const t=a.nextSibling;if(t&&"span"===t.nodeName.toLowerCase()&&"false"===t.contentEditable)if(39===e.keyCode){const e=t.nextSibling;e&&e.nodeType===Node.TEXT_NODE&&(n.setStart(e,1),n.collapse(!0))}else n.setStart(a,i-1),n.collapse(!0)}if(0===i&&a.nodeValue.startsWith(g)){const t=a.previousSibling;if(t&&"span"===t.nodeName.toLowerCase()&&"false"===t.contentEditable)if(37===e.keyCode){const e=t.previousSibling;n.setStart(e,e.nodeValue.length-1),n.collapse(!0)}else n.setStart(a,1),n.collapse(!0)}}}let h,x,y;if(r.addEventListener("keydown",(function(e){const t=e.key,n=e.ctrlKey,i=e.metaKey;"z"!==t&&"Z"!==t||!n&&!i||(e.preventDefault(),r.querySelectorAll('[data-toggle="popover"]').forEach((e=>{try{a(e).popover("hide")}catch(e){}})),e.shiftKey?c.redo():c.undo(),r.querySelectorAll('[data-toggle="popover"]').forEach((e=>S(e))))})),r.addEventListener("mouseup",f),r.addEventListener("keyup",f),r.addEventListener("input",(function(e){const t=r.querySelectorAll('span[contenteditable="false"]'),n=[];t.forEach((e=>{const t=e.previousSibling,a=e.nextSibling,i=!t||t.nodeType!==Node.TEXT_NODE||!t.nodeValue.endsWith(g),r=!a||a.nodeType!==Node.TEXT_NODE||!a.nodeValue.startsWith(g);(i||r)&&n.push(e)})),n.forEach((e=>{const t=e.previousSibling,n=e.nextSibling;t&&t.nodeType===Node.TEXT_NODE&&t.nodeValue.endsWith(g)&&(t.nodeValue=t.nodeValue.slice(0,-1),0===t.length&&t.remove()),n&&n.nodeType===Node.TEXT_NODE&&n.nodeValue.startsWith(g)&&(n.nodeValue=n.nodeValue.slice(1),0===n.length&&n.remove()),e.remove()})),c.push()})),r.addEventListener("mousemove",(e=>{h=e.clientX,x=e.clientY})),1===arguments.length)throw new Error("editor not initialized: "+a("<div>").append(e).html());if(1!==e.length)throw new Error("input should reference exactly one element, got "+e.length);(i=i||{}).createPopover||t.vellum.opts().features.disable_popovers||(i.createPopover=S),e.promise=new Promise((e=>{y=e}));const b={getValue:function(n){if(!n)return P(r.innerHTML,t,i.isExpression);e.promise.then((function(){n(P(r.innerHTML))}))},setValue:function(e,n){var a=k(e,t,i);return r.innerHTML=a,r.querySelectorAll('span[contenteditable="false"]').forEach((e=>{const t=e.previousSibling,n=e.nextSibling;t&&t.nodeType===Node.TEXT_NODE&&t.nodeValue.endsWith(g)||e.parentNode.insertBefore(document.createTextNode(g),e),n&&n.nodeType===Node.TEXT_NODE&&n.nodeValue.startsWith(g)||e.parentNode.insertBefore(document.createTextNode(g),e.nextSibling)})),c.push(),d(r,(()=>{r.querySelectorAll('[data-toggle="popover"]').forEach((e=>S(e)))})),n&&setTimeout(n,0),b},insertExpression:function(e){if(i.isExpression)o(C(e,t),!0);else{var n=w(t,e);o(a("<p>").append(n).html(),!0)}return b},insertOutput:function(e){if(i.isExpression)throw new Error("cannot insert output into expression editor");return o(M(e,t)),b},change:function(){return b},focus:function(){r.focus()},select:function(e,t){return v.call(null,r,e,t),b},on:function(){var e=Array.prototype.slice.call(arguments);if(2===e.length&&"change"===e[0]&&"function"==typeof e[1]){const t=function(t){e[1].apply()};r.addEventListener("input",t),r.addEventListener("paste",t),r.addEventListener("cut",t)}return b},destroy:function(){null!==e&&(e.removeData("ckwrapper"),e=null)}};function _(e){e.preventDefault();const n=window.getSelection();let a="";if(n.rangeCount>0){const r=n.getRangeAt(0),o=document.createElement("div");o.appendChild(r.cloneContents()),a=P(o.innerHTML,t,i.isExpression),"cut"===e.type&&r.deleteContents(),A(a)&&(a=s.transform(a.slice(15),(function(e){return e})))}e.clipboardData&&e.clipboardData.setData("text/plain",a)}function I(e){if(window.getSelection){const t=window.getSelection();if(t.getRangeAt&&t.rangeCount){let n=t.getRangeAt(0);n.deleteContents();const a=document.createElement("div");a.innerHTML=e;const i=document.createDocumentFragment();let r,o;for(;r=a.firstChild;)o=i.appendChild(r);n.insertNode(i),o&&(n=n.cloneRange(),n.setStartAfter(o),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}}return r.addEventListener("copy",_),r.addEventListener("cut",_),r.addEventListener("paste",(function(e){if(e.preventDefault(),e.clipboardData&&e.clipboardData.getData("text/plain")){const t=e.clipboardData.getData("text/plain"),n=document.createElement("div");n.textContent=t,I(n.innerHTML.replace(/\n/g,"<br />").replace(/  /g," &nbsp;"))}else if(e.clipboardData.getData("text/html")){let t=e.clipboardData.getData("text/html");const n=/<style[^>]*>.*?<\/style>/g;let a;do{a=t,t=t.replace(n,"")}while(t!==a);I(t)}})),e.data("ckwrapper",b),y(),b},htmlToFragment:m,fromRichText:P,toRichText:k,isInvalid:A,unescapeXPath:function(e,t){return A(e)&&(e=s.transform(e.slice(15),t.normalizeXPath.bind(t))),e},unescapeHashtags:function(e,t){return A(e)&&(e=s.transform(e.slice(15),t.normalizeHashtag.bind(t))),e}}}.apply(t,a))||(e.exports=i)},98610:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(34078),n(77026),n(98094),n(20939),n(50705),n(80001),n(34206),n(67501),n(63835),n(21877)],void 0===(i=function(e,t,n,a,i,r,o,s,l,d,u){function c(e){return!!e&&e.p.useCreate}function p(e){return!!e&&e.p.useClose}function f(e){return!!e&&e.p.useUpdate}function h(e){return!!e&&e.p.useIndex}function g(e){return!!e&&e.p.useAttachment}var m=function(n,a){var i=o.normal(n,a),s=a.id,l=a.template;return a.richText=!1,i.input=e('<div class="control-row" />').attr("name",s),i.getControl=function(){return i.input},i.refreshControl=function(t){t=t||i.getValue(),i.input.html(u({internal_template:l,props:t})),i.input.find("input").on("change keyup",(function(){i.handleChange()})),i.input.find(".fd-add-property").click(i.addProperty),i.input.find(".fd-remove-property").click(i.removeProperty),i.input.find("input").addClass("jstree-drop"),i.input.find("input").each((function(){r.autocomplete(e(this),n)}))},i.setValue=function(e){e=t.isUndefined(e)?{}:e,i.refreshControl(e)},i.updateValue=function(){""in i.getValue()||(i.input.find(".btn").removeClass("hide"),i.input.find(".fd-remove-property").removeClass("hide")),i.save()},i.removeProperty=function(t){e(this).parent().parent().parent().remove(),i.refreshControl(),i.save(),t.preventDefault()},i.addProperty=function(e){i.refreshControl(),e.preventDefault()},i},v=function(n,a){a.template=s;var i=m(n,a);return i.getValue=function(){var n={};return t.each(i.input.find(".fd-update-property"),(function(t){var a=e(t);n[a.find(".fd-update-property-name").val()]={calculate:a.find(".fd-update-property-source").val(),relevant:a.find(".fd-update-property-relevant").val()}})),n},i},x=/^[a-z0-9_-]+$/i,y={typeName:"Save to Case",isTypeChangeable:!1,isDataOnly:!0,supportsDataNodeRole:!0,icon:"fa fa-save",init:function(e,t){e.p.date_modified=e.p.date_modified||"/data/meta/timeEnd",e.p.user_id=e.p.user_id||"instance('commcaresession')/session/context/userid"},spec:{xmlnsAttr:{presence:"optional"},date_modified:{lstring:gettext("Date Modified"),visibility:"visible",presence:"required",widget:o.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath},user_id:{lstring:gettext("User ID"),visibility:"visible",presence:"optional",widget:o.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath},case_type:{lstring:gettext("Case Type"),visibility:"visible",presence:"optional",widget:o.text},case_id:{lstring:gettext("Case ID"),visibility:"visible",presence:"required",widget:o.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath},useCreate:{lstring:gettext("Create Case"),visibility:"visible",presence:"optional",widget:o.checkbox},createProperty:{lstring:gettext("Properties To Create"),visibility:"visible",presence:"optional",widget:v,validationFunc:function(e){if(e.p.useCreate){var n=t.without(t.keys(e.p.createProperty),""),a=["case_type","case_name"],r=t.union(a,["owner_id"]),o=t.difference(n,r),s=t.intersection(n,a),l=t.filter(n,(function(e){return!x.test(e)}));if(s.length!==a.length)return i.format(gettext("You must include {columns} columns to create a case"),{columns:a.join(", ")});if(o.length>0)return gettext("You can only use the following properties:")+" "+r.join(", ");if(l.length>0)return i.format(gettext("{props} are invalid properties"),{props:l.join(", ")})}return"pass"}},useClose:{lstring:gettext("Close Case"),visibility:"visible",presence:"optional",widget:o.checkbox},closeCondition:{lstring:gettext("Close Condition"),visibility:"visible",presence:"optional",widget:o.xPath,serialize:n.serializeXPath,deserialize:n.deserializeXPath},useUpdate:{lstring:gettext("Update Case"),visibility:"visible",presence:"optional",widget:o.checkbox},updateProperty:{lstring:gettext("Properties To Update"),visibility:"visible",presence:"optional",widget:v,validationFunc:function(e){if(e.p.useUpdate){var n=t.without(t.keys(e.p.updateProperty),""),a=t.filter(n,(function(e){return!x.test(e)}));if(a.length>0)return i.format(gettext("{props} are invalid properties"),{props:a.join(", ")})}return"pass"}},useIndex:{lstring:gettext("Use Index"),visibility:"visible",presence:"optional",widget:o.checkbox},indexProperty:{lstring:gettext("Index Properties"),visibility:"visible",presence:"optional",widget:function(n,a){a.template=l;var i=m(n,a);return i.getValue=function(){var n={};return t.each(i.input.find(".fd-index-property"),(function(t){var a=e(t);n[a.find(".fd-index-property-name").val()]={calculate:a.find(".fd-index-property-source").val(),case_type:a.find(".fd-index-property-case-type").val(),relationship:a.find(".fd-index-property-relationship").val()}})),n},i},validationFunc:function(e){if(e.p.useIndex){var n=t.without(t.keys(e.p.indexProperty),""),a=t.filter(n,(function(e){return!x.test(e)})),r=t.without(t.map(e.p.indexProperty,(function(e,t){return e.relationship})),""),o=t.filter(r,(function(e){return!t.contains(["child","extension"],e)}));if(a.length>0)return i.format(gettext("{props} are invalid properties"),{props:a.join(", ")});if(o.length>0)return gettext("Relationship must be child or extension")}return"pass"}},useAttachment:{lstring:gettext("Use Attachments"),visibility:"visible",presence:"optional",widget:o.checkbox},attachmentProperty:{lstring:gettext("Attachment Properties"),visibility:"visible",presence:"optional",widget:function(n,a){a.template=d;var i=m(n,a);return i.getValue=function(){var n={};return t.each(i.input.find(".fd-attachment-property"),(function(t){var a=e(t);n[a.find(".fd-attachment-property-name").val()]={calculate:a.find(".fd-attachment-property-source").val(),from:a.find(".fd-attachment-property-from").val(),name:a.find(".fd-attachment-name").val()}})),n},i},validationFunc:function(e){if(!e.p.useAttachment)return"pass";var n=t.without(t.keys(e.p.attachmentProperty),""),a=t.filter(n,(function(e){return!x.test(e)})),r=t.filter(n,(function(n){return!t.contains(["local","remote","inline"],e.p.attachmentProperty[n].from)})),o=t.filter(n,(function(t){var n=e.p.attachmentProperty[t],a=n.from,i=n.name;return"inline"===a&&!i}));return a.length>0?i.format(gettext("{props} are invalid properties"),{props:a.join(", ")}):r.length>0?gettext("The from attribute must be one of: local, remote, or inline"):o.length>0?gettext("Inlined attachments must have an attachment name"):"pass"}}},getExtraDataAttributes:function(e){return{"vellum:role":"SaveToCase","vellum:case_type":e.p.case_type||""}},dataChildFilter:function(e,n){function i(e,t,n){return t=t||[],new a.Node(t,{getNodeID:function(){return e},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return n}}})}function r(e,n){return t.chain(e).map((function(e,a){if(a)return i(a,[],t.pick(e,n))})).compact().value()}var o=[];return c(n)&&o.push(i("create",r(n.p.createProperty))),f(n)&&o.push(i("update",r(n.p.updateProperty))),p(n)&&o.push(i("close")),h(n)&&o.push(i("index",r(n.p.indexProperty,["case_type","relationship"]))),g(n)&&o.push(i("attachment",r(n.p.attachmentProperty,["from","name"]))),[new a.Node(o,{getNodeID:function(){return"case"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{xmlns:"http://commcarehq.org/case/transaction/v2",case_id:"",date_modified:"",user_id:""}}}})]},getBindList:function(e){var n=[];function a(n,a){return t.chain(a).omit("").map((function(t,a){return{nodeset:e.absolutePath+"/case/"+n+"/"+a,calculate:t.calculate,relevant:t.relevant}})).value()}return c(e)&&(e.isInRepeat()&&(n=n.concat({nodeset:e.absolutePath+"/case/@case_id",calculate:e.p.case_id})),n=n.concat(a("create",e.p.createProperty))),f(e)&&(n=n.concat(a("update",e.p.updateProperty))),p(e)&&n.push({nodeset:e.absolutePath+"/case/close",relevant:e.p.closeCondition}),h(e)&&(n=n.concat(a("index",e.p.indexProperty))),g(e)&&(n=n.concat(t.chain(e.p.attachmentProperty).omit("").map((function(t,n){return{nodeset:e.absolutePath+"/case/attachment/"+n+"/@src",calculate:t.calculate}})).value())),function(e){return c(e)||p(e)||f(e)||h(e)||g(e)}(e)&&(n.push({nodeset:e.absolutePath+"/case/@date_modified",calculate:e.p.date_modified,type:"xsd:dateTime"}),n.push({nodeset:e.absolutePath+"/case/@user_id",calculate:e.p.user_id}),c(e)||n.push({nodeset:e.absolutePath+"/case/@case_id",calculate:e.p.case_id})),n},parseDataNode:function(n,a){var i=a.xmlAttr("vellum:case_type"),r=a.children(),o=r.find("create"),s=r.find("close"),l=r.find("update"),d=r.find("index"),u=r.find("attachment");return i&&(n.p.case_type=i),o&&0!==o.length&&(n.p.useCreate=!0),l&&0!==l.length&&(n.p.useUpdate=!0),s&&0!==s.length&&(n.p.useClose=!0),d&&0!==d.length&&(n.p.useIndex=!0,n.p.indexProperty={},t.each(d.children(),(function(t){var a=e(t);n.p.indexProperty[a.prop("tagName")]={case_type:a.xmlAttr("case_type"),relationship:a.xmlAttr("relationship")}}))),u&&0!==u.length&&(n.p.useAttachment=!0,n.p.attachmentProperty||(n.p.attachmentProperty={}),t.each(u.children(),(function(t){var a=e(t);n.p.attachmentProperty[a.prop("tagName")]={from:a.xmlAttr("from"),name:a.xmlAttr("name")}}))),e([])},getSetValues:function(e){return c(e)&&!e.isInRepeat()?[{event:"xforms-ready",ref:e.absolutePath+"/case/@case_id",value:e.p.case_id}]:[]},getCaseSaveData:function(e){var n=t.union(t.keys(e.p.createProperty||{}),t.keys(e.p.updateProperty||{}));return{case_type:e.p.case_type||"",properties:t.filter(n,t.identity),create:e.p.useCreate||!1,close:e.p.useClose||!1}}},b={SaveToCase:[{slug:"main",displayName:gettext("Basic"),properties:["nodeID","date_modified","user_id","case_type","case_id"]},{slug:"create",displayName:gettext("Create"),properties:["useCreate","createProperty"],isCollapsed:function(e){return!c(e)}},{slug:"update",displayName:gettext("Update"),properties:["useUpdate","updateProperty"],isCollapsed:function(e){return!f(e)}},{slug:"close",displayName:gettext("Close"),properties:["useClose","closeCondition"],isCollapsed:function(e){return!p(e)}},{slug:"index",displayName:gettext("Index"),properties:["useIndex","indexProperty"],isCollapsed:function(e){return!h(e)}},{slug:"attachment",displayName:gettext("Attachments"),properties:["useAttachment","attachmentProperty"],isCollapsed:function(e){return!g(e)}}]};e.vellum.plugin("saveToCase",{},{getAdvancedQuestions:function(){return this.__callOld().concat(["SaveToCase"])},handleMugParseFinish:function(e){if(this.__callOld(),c(e)){var n=e.absolutePath+"/case/@case_id",a=t.find(e.form.getSetValues(),(function(e){return e.ref===n}));a&&(e.p.case_id=a.value,e.form.dropSetValues((function(e){return a===e})))}},getMugTypes:function(){var e=this.__callOld();return e.normal.SaveToCase=i.extend(n.defaultOptions,y),e},getSections:function(e){return b.hasOwnProperty(e.__className)?t.map(b[e.__className],(function(n){var a=t.clone(n);return t.isFunction(a.isCollapsed)&&(a.isCollapsed=a.isCollapsed(e)),a})):this.__callOld()},parseBindElement:function(e,t,n){var a=e.getMugByPath(n);if(!a){var i,r=/\/case\/(?:(create|update|index)\/([\w-]+)|(close|@date_modified|@user_id|@case_id))$/,o=n.match(r);if(o&&o.length>0&&(i=n.replace(r,""),(a=e.getMugByPath(i))&&"SaveToCase"===a.__className)){if(o[2]){var s=o[2],l={create:"createProperty",update:"updateProperty",index:"indexProperty",attachment:"attachmentProperty"}[o[1]];return a.p[l]||(a.p[l]={}),a.p[l][s]||(a.p[l][s]={}),a.p[l][s].calculate=t.xmlAttr("calculate"),void(t.xmlAttr("relevant")&&(a.p[l][s].relevant=t.xmlAttr("relevant")))}var d={close:{mugProp:"closeCondition",elAttr:"relevant"},"@date_modified":{mugProp:"date_modified",elAttr:"calculate"},"@user_id":{mugProp:"user_id",elAttr:"calculate"},"@case_id":{mugProp:"case_id",elAttr:"calculate"}}[o[3]];return void(a.p[d.mugProp]=t.xmlAttr(d.elAttr))}var u=/\/case\/attachment\/(\w+)\/@src$/,c=n.match(u);if(c&&(i=n.replace(u,""),(a=e.getMugByPath(i))&&"SaveToCase"===a.__className)){var p=a.p.attachmentProperty,f=c[1];return p[f]||(p[f]={}),void(a.p.attachmentProperty[f].calculate=t.xmlAttr("calculate"))}}this.__callOld()}})}.apply(t,a))||(e.exports=i)},54872:(e,t,n)=>{const a=n(13946);e.exports=a.template('<ul class="dropdown-menu multi-level" role="menu">\n    <% _.each(groups, function(group) { %>\n        <% if (group.questions.length > 1) { %>\n            <li class="dropdown-submenu">\n                <a tabindex="-1" class="fd-question-type" data-qtype="<%= group.defaultQuestion.slug %>">\n                    <i class="<%= group.defaultQuestion.icon %>"></i>\n                    <%= group.name %>\n                </a>\n                <ul class="dropdown-menu">\n        <% } %>\n                    <% _.each(group.questions, function(question) { %>\n                        <li>\n                            <a tabindex="-1" class="fd-question-type" data-qtype="<%= question.slug %>">\n                                <i class="<%= question.icon %>"></i> <%= question.name %>\n                            </a>\n                        </li>\n                    <% }) %>\n        <% if (group.questions.length > 1) { %>\n                </ul>\n            </li>\n        <% } %>\n    <% }); %>\n</ul>\n')},97356:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="alert alert-block <%=messageType.cssClass%>">\n    <button type="button" class="close" data-dismiss="alert">&times;</button>\n    <h4><% if (messageType.icon) { %><i class="<%=messageType.icon%>"></i> <% } %><%=messageType.title%></h4>\n    <ul>\n        <% _.each(messages, function (message) { %>\n        <li><%-message%></li>\n        <% }); %>\n    </ul>\n</div>\n')},47724:(e,t,n)=>{const a=n(13946);e.exports=a.template('<li>\n  <i class="<%= icon %>"></i> <%= displayPath %>\n    <% if (displayLabel) { %>\n      <br />\n      <span class="atwho-jrtext"><%= displayLabel %></span>\n    <% } %>\n</li>,\n')},4489:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-itextID-checkbox-container col-sm-1">\n    <label class="checkbox">\n        \x3c!-- checkbox goes here --\x3e\n        <%-gettext("auto?")%>\n    </label>\n</div>\n')},77207:(e,t,n)=>{const a=n(13946);e.exports=a.template('<button type="button" class="btn btn-danger"><i class="fa fa-remove"></i></button>\n')},37444:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-commander">\n    <i class="fa-solid fa-xmark fd-commander-close"></i>\n    <input type="text" class="form-control" placeholder="<%-gettext(\'Enter command\')%>" />\n</div>\n')},70516:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-source-container">\n    <p>\n        <%=description%>\n    </p>\n    <div id="form-differences">\n      <pre><%=xmldiff%></pre>\n    </div>\n</div>\n')},19443:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="form-group">\n    <label class="control-label col-sm-3"><div><%=label%></div></label>\n    <div class="controls col-sm-9"></div>\n</div>\n')},27133:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="form-group">\n    <label class="control-label col-sm-3">\n        <%=label%>\n    </label>\n    <div class="col-sm-9">\n        <input type="<%=type%>"<% if (type === \'text\') { %> class="form-control"<% } %> />\n    </div>\n</div>\n')},10023:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-copy-paste-help">\n    <h3><%-gettext("Copying and Pasting Questions")%></h3>\n    <div class="copy-paste-help">\n        <%-gettext("These actions are available via the browser\'s Edit menu, and you can also use:")%>\n        <div class="row">\n            <div class="col-sm-3">\n                <h1><%=metachar%>C</h1>\n                <span><%-gettext("for copy")%></span>\n            </div>\n            \x3c!--div class="col-sm-3">\n                <h1><%=metachar%>X</h1>\n                <span>for cut</span>\n            </div--\x3e\n            <div class="col-sm-3">\n                <h1><%=metachar%>V</h1>\n                <span><%-gettext("for paste")%></span>\n            </div>\n        </div>\n    </div>\n    <div class="copy-paste-box hide">\n        <p><%-gettext("Copy from or Paste into this text box:")%> <textarea></textarea></p>\n        <p><button class="btn btn-default insert-questions"><%-gettext("Insert Questions")%></button></p>\n    </div>\n    <h3><%-gettext("Selecting Multiple Questions")%></h3>\n    <div class="row">\n        <%\n            var key = metachar.endsWith("+") ? metachar.slice(0, -1) : metachar;\n            key = "<strong>" + key + "</strong>";\n            print(format(gettext("Hold {key} and click on each question."), {key: key}));\n        %>\n    </div>\n    <h3><%-gettext("Other Tips")%></h3>\n    <p><%-gettext("Questions can be copied between forms, and even to other apps.")%></p>\n</div>\n')},69740:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-data-source-editor-container form form-horizontal">\n\n    <fieldset class="data-source-advanced">\n        <legend>\n            <i class="fa fa-cog"></i> <%-gettext("Edit Data Source")%>\n        </legend>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Query Expression")%>\n            </label>\n            <div class="col-sm-10">\n                <textarea rows="5"\n                          name="query"\n                          class="form-control fd-data-source-query jstree-drop"></textarea>\n                <p class="help-block">\n                    <a target="_blank"\n                       href="https://help.commcarehq.org/display/commcarepublic/Common+Logic+and+Calculations">\n                        <i class="fa fa-info-circle"></i> <%-gettext("Guide to Common Logic and Calculations")%>\n                    </a>\n                </p>\n            </div>\n        </div>\n        <legend><%-gettext("Optional Instance Properties")%></legend>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Instance ID")%>\n            </label>\n            <div class="col-sm-10">\n                <input name="instance-id" type="text" class="form-control jstree-drop" />\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Instance URI")%>\n            </label>\n            <div class="col-sm-10">\n                <input name="instance-src" type="text" class="form-control jstree-drop" />\n            </div>\n        </div>\n    </fieldset>\n\n    <div class="form-actions form-actions-condensed fd-data-source-actions">\n        <div class="col-sm-2"></div>\n        <div class="col-sm-10">\n            <button type="button" class="btn btn-primary fd-data-source-save-button"><%-gettext("Save")%></button>\n            <button type="button" class="btn btn-default fd-data-source-cancel-button"><%-gettext("Cancel")%></button>\n        </div>\n    </div>\n    </div>\n</div>\n')},93436:(e,t,n)=>{const a=n(13946);e.exports=a.template('<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">\n    <li style="padding-left: 10px;"><strong><%-gettext("Date Format Options")%></strong></li>\n    <% _.each(formats, function (label, format) { %>\n        <li><a tabindex="-1" data-format="<%= format %>"><%= label %></a></li>\n    <% }); %>\n</ul>\n')},88654:(e,t,n)=>{const a=n(13946);e.exports=a.template(' (<a class="jstree-hover" id="<%= guid %>"><%= text %></a>)')},66990:(e,t,n)=>{const a=n(13946);e.exports=a.template('<p><%= text %></p>\n<% if (ufid) { %>\n    <p>\n        <a class="jstree-hover" data-ufid="<%= ufid %>">\n            <%-gettext("show in question list")%>\n        </a>\n    </p>\n<% } %>\n')},35674:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-source-container">\n    <p>\n        <%=description%>\n    </p>\n    <textarea class="form-control" rows="16"></textarea>\n</div>\n')},51705:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-external-sources-container">\n    <div class="fd-head fd-head-external-sources">\n        <div class="fd-head-max-indicator"><i class="fa-regular fa-circle-down"></i></div>\n        <h2><%-gettext("App Properties")%></h2>\n    </div>\n    <div class="fd-scrollable">\n        <div class="fd-external-resource-search">\n            <form class="form-inline">\n                <label class="control-label" for="fdExternalSearch"><i class="fa fa-search"></i></label>\n                <div class="fd-search-control">\n                    <input type="text"\n                        id="fdExternalSearch"\n                        class="form-control search-query"\n                        placeholder="<%-gettext("Search...")%>"\n                        style="width: calc(100% - 42px);"\n                        autocomplete="off" >\n                </div>\n            </form>\n        </div>\n        <div class="fd-external-sources-error container-fluid has-error hide">\n            <div class="help-block"></div>\n        </div>\n        <div class="fd-external-sources-tree"></div>\n    </div>\n</div>\n')},8426:(e,t,n)=>{const a=n(13946);e.exports=a.template('<table class="table table-hover">\n  <thead>\n    <th><%-gettext("Question")%></th>\n    <th><%-gettext("Used By")%></th>\n    <th><%-gettext("In Property")%></th>\n  </thead>\n  <% _.each(tableData, function(refs, question) { %>\n     <tr>\n       <td><a class="link-to-question"><%- question %></a></td>\n       <td></td>\n       <td></td>\n     </tr>\n     <% _.each(refs, function(propName, path) {%>\n       <tr class="usage-row">\n         <td></td>\n         <td><a class="link-to-question"><%- path %></a></td>\n         <td><%- propName %></td>\n       </tr>\n     <% }); %>\n   <% }); %>\n</table>\n')},51089:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-search">\n  <div class=\'form-inline\'>\n    <div>\n      <label class="control-label" for="findUsagesSearch">\n        <i class="fa fa-search"></i>\n      </label>\n      <div class="fd-search-control">\n        <input type="text"\n               class="form-control search-query"\n               id="findUsagesSearch"\n               placeholder="<%-gettext("Search...")%>"\n               style="width: calc(100% - 42px);"\n               autocomplete="off"/>\n      </div>\n    </div>\n  </div>\n</div>\n')},78267:(e,t,n)=>{const a=n(13946);e.exports=a.template("<ul>\n<% _.each(errors, function (error) { %>\n    <li>\n        <%= error.mug.getDisplayName(displayLanguage) %>\n        <ul>\n        <% _.each(error.errors, function (error) { %>\n            <li><%= error.message %></li>\n        <% }); %>\n        </ul>\n    </li>\n<% }); %>\n</ul>\n")},36328:(e,t,n)=>{const a=n(13946);e.exports=a.template('<li class="divider language-selector"></li>\n<li class="dropdown-header language-selector"><%-gettext("Display")%></li>\n<% _.each(languages, function(language) { %>\n<li><a tabindex="-1" class="fd-display-item language-selector" data-code="<%-language.code%>"><i class="fa fa-check"></i><%-language.name%><%\n    if (language.name !== language.code && language.code !== \'_ids\') {\n        %> (<%-language.code%>)<%\n    }\n    %></a></li><%\n}); %>\n')},68101:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-ui-container">\n    <div class="fd-content fd-content-left">\n        <div class="fd-tree">\n            <div class="fd-head">\n                <h2>\n                    <i class="fd-form-icon"></i>\n                    <span class="fd-head-text"><%-gettext("Questions")%></span>\n                </h2>\n                <div class="fd-head-menu-container">\n                    <div class="dropdown">\n                        <a class="dropdown-toggle"\n                           data-toggle="dropdown">\n                            <i class="fa fa-reorder"></i>\n                            <i class="fa fa-caret-down"></i>\n                        </a>\n                        <ul class="dropdown-menu checklist fd-questions-menu fd-scrollable-minimal" role="menu">\n                            <li>\n                                <a class="fd-button-copy">\n                                    <i class="fa fa-copy"></i>\n                                    <%-gettext("Copy")%><span class="hotkey"><%-Ctrl%>C</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class="fd-expand-all">\n                                    <i class="fa fa-angle-double-down"></i>\n                                    <%-gettext("Expand All")%><span class="hotkey"><%-Ctrl%><%-Alt%>=</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class="fd-collapse-all">\n                                    <i class="fa fa-angle-double-right"></i>\n                                    <%-gettext("Collapse All")%><span class="hotkey"><%-Ctrl%><%-Alt%>&ndash;</span>\n                                </a>\n                            </li>\n                            <li class="divider fd-bulk-update-menu"></li>\n                            <li class="dropdown-header fd-bulk-update-header">\n                              <%-gettext("Bulk Update All Questions")%>\n                            </li>\n                            <li class="divider fd-tools-menu"></li>\n                        </ul>\n                        <input type="hidden" class="fd-question-tree-display" />\n                    </div>\n                </div>\n            </div>\n            <div class="dropdown fd-add-question-dropdown">\n                <button class="fd-add-question dropdown-toggle btn btn-purple" data-toggle="dropdown">\n                    <i class="fa fa-plus"></i> <%-gettext("Add Question")%>\n                    <i class="fa fa-caret-down"></i>\n                </button>\n            </div>\n            <div class="fd-undo-container"> </div>\n            <div class="fd-scrollable fd-scrollable-tree">\n                <div class="fd-question-tree"></div>\n                <div class="hide fd-default-panel fd-default-qtree">\n                  <div class="helpbubble helpbubble-purple helpbubble-top-left">\n                    <p class="lead">\n                    <%\n                        var msg = gettext("Click {btn} to start building your form."),\n                            add = gettext("Add Question"),\n                            btn = \'<i class="fa fa-plus"></i> <strong>\' + add + \'</strong>\';\n                        print(format(msg, {btn: btn}));\n                    %>\n                    </p>\n                    <p class="fd-default-helptext"></p>\n                  </div>\n                </div>\n            </div>\n        </div>\n        <div class="fd-external-sources-divider fd-content-left-divider fd-content-horizontal-divider">\n          <i class="fa fa-ellipsis-h"></i>\n        </div>\n        <div class="fd-accessory-pane"></div>\n    </div>\n    <div class="fd-content fd-content-divider fd-content-vertical-divider"></div>\n    <div class="fd-content fd-content-right">\n        <div class="fd-form-actions btn-toolbar">\n            <div class="btn-group fd-save-button"></div>\n        </div>\n        <div class="fd-column fd-question-properties hide">\n            <div class="fd-head"><h2><%-gettext("Question Details")%></h2></div>\n            <div class="fd-props-toolbar"></div>\n            <div class="fd-scrollable fd-props-scrollable">\n                <form class="form form-horizontal fd-props-content"></form>\n            </div>\n        </div>\n        <div class="fd-xpath-editor fd-column hide">\n            <div class="fd-head"><h2><%-gettext("Expression Editor")%></h2></div>\n            <div class="fd-scrollable full">\n                <div class="fd-xpath-editor-content"></div>\n            </div>\n        </div>\n        <div class="fd-column hide fd-default-panel">\n        </div>\n    </div>\n\n    <div class="fd-messages"></div>\n</div>\n\x3c!-- Begin modal divs --\x3e\n<div class="fd-multimedia-modal-container"></div>\n<div class="fd-modal-generic-container"></div>\n\x3c!-- end modal divs --\x3e\n')},33591:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div>\n    <div class="fd-help pull-right">\n      <a tabindex="-1"\n        data-title="<%-title%>"\n        data-placement="right"\n        data-content="<%=gettext("Use text formatting to <strong>bold</strong> and <em>italicize</em> words, use bulleted lists, and <a target=\'_blank\' href=\'https://help.commcarehq.org/display/commcarepublic/Text+Formatting\'>more</a>")%>"\n      ></a>\n    </div>\n    <a class="turn-markdown-off markdown-trigger clearfix"><%-gettext("Turn Off Text Formatting")%></a>\n    <a class="turn-markdown-on markdown-trigger clearfix"><%-gettext("Turn On Text Formatting")%></a>\n</div>\n')},71694:(e,t,n)=>{const a=n(13946);e.exports=a.template('<button class="btn <%=cssClasses%><% if (defaultButton) { %> btn-default<% } %>">\n    <%= title %>\n</button>\n')},47649:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="modal fade">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title">\n                    <% if (headerIcon) { %>\n                        <i class="<%=headerIcon%>"></i>\n                    <% } %>\n                    <%=title%>\n                </h4>\n            </div>\n            <div class="modal-body form form-horizontal">\n            </div>\n            <div class="modal-footer">\n                <% if (closeButtonTitle) { %>\n                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">\n                    <%=closeButtonTitle%>\n                </button>\n                <% } %>\n            </div>\n        </div>\n    </div>\n</div>\n')},74533:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="control-row">\n    <div class="col-sm-12">\n        <button type="button" class="btn btn-default fd-mm-path-show pull-right">\n            <i class="fa fa-cog"></i>\n            <%-gettext("Advanced: Show Path")%>\n        </button>\n        <div class="fd-mm-upload-trigger"></div>\n    </div>\n</div>\n<div class="control-row">\n    <div class="fd-mm-path hide col-sm-12">\n        <button type="button" class="btn btn-default fd-mm-path-hide pull-right"><%-gettext("Hide Path")%></button>\n        <div class="fd-mm-path-input"></div>\n    </div>\n</div>\n')},73609:(e,t,n)=>{const a=n(13946);e.exports=a.template('<% if (errors.length > 0) { %>\n    <div class="alert alert-danger">\n        <% for (var e = 0; e < errors.length; e++) {\n            var error = errors[e]; %>\n            <p><%- error %></p>\n        <% } %>\n    </div>\n<% } %>\n')},99606:(e,t,n)=>{const a=n(13946);e.exports=a.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open Audio")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Audio Uploaded Successfully")%></span>\n</p>\n')},88793:(e,t,n)=>{const a=n(13946);e.exports=a.template('<p>\n    <img src="<%=url %>?thumb=100" alt="uploaded image" />\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens image in new tab.")%>"><%-gettext("View Full Size")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Image Uploaded Successfully")%></span>\n</p>\n')},68125:(e,t,n)=>{const a=n(13946);e.exports=a.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open HTML")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New HTML Document Uploaded Successfully")%></span>\n</p>\n')},31779:(e,t,n)=>{const a=n(13946);e.exports=a.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open Video")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Video Uploaded Successfully")%></span>\n</p>\n')},92589:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="modal fade" id="<%= modalId %>">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title"><%-gettext("Upload")%> <%= mediaType %></h4>\n            </div>\n            <div class="modal-body form form-horizontal">\n                <div class="form-group">\n                    <label class="col-sm-4 control-label">\n                        <%-gettext("Select new")%> <%= mediaType %>\n                    </label>\n                    <div class="col-sm-8">\n                        <button class="btn btn-primary" type="button"><%-gettext("Select File")%></button>\n                        <input type="file" class="hide" />\n                        <div class="hqm-upload-status"></div>\n                    </div>\n                </div>\n                <div class="form-group hqm-existing hide">\n                    <label class="col-sm-4 control-label">\n                        <%-gettext("Current")%> <%= mediaType %>\n                    </label>\n                    <div class="col-sm-8 hqm-existing-controls">\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <a class="btn btn-default" data-dismiss="modal"><%-gettext("Close")%></a>\n                <a class="btn btn-default disabled hqm-upload hqm-upload-confirm">\n                    <i class="fa-solid fa-cloud-arrow-up"></i>\n                    <i class="fa-solid fa-spin fa-refresh hide"></i>\n                    <%-gettext("Begin Upload")%>\n                </a>\n            </div>\n        </div>\n    </div>\n</div>\n')},50237:(e,t,n)=>{const a=n(13946);e.exports=a.template('<p class="fd-mm-no-ref">\n    <i class="<%=iconClass%>"></i>\n    <%-gettext("No Reference")%>\n</p>\n')},45080:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div style="clear: both;">\n    <div class="alert alert-success" style="margin-bottom: 2px; margin-top: 10px;">\n        <i class="fa fa-check"></i> <%= file_name %> <strong>[<%= file_size %> MB]</strong>\n    </div>\n    <p class="text-success hqm-begin">\n      <%=gettext("Ready to upload. Click <strong>Begin Upload</strong> below to start.")%>\n    </p>\n    <p class="text-danger hqm-error hide">\n        <span class="label label-danger"><%-gettext("There were errors.")%></span>\n    </p>\n    <div class="hqm-errors"></div>\n</div>\n')},23184:(e,t,n)=>{const a=n(13946);e.exports=a.template('<a href="#<%= uploaderId %>"\n   class="btn btn-primary"\n   data-toggle="modal">\n    <%- multimediaExists ? gettext("Replace") : gettext("Upload") %> <%=mediaType%>\n</a>\n')},78019:(e,t,n)=>{const a=n(13946);e.exports=a.template('<fieldset class="fd-question-fieldset<% if (isCollapsed) { %> hide<% } %>" data-slug="<%= fieldsetSlug %>">\n    <legend>\n        <% if (help) { %>\n        <div class="fd-help pull-right">\n            <a class="help" tabindex="-1"\n                data-title="<%=help.title%>"\n                data-content="<%=help.text%><p><a target=\'_blank\' href=\'<%=help.link%>\'>See More</a></p>"\n                data-placement="left">\n            </a>\n        </div>\n        <% } %>\n        <%=fieldsetTitle%>\n    </legend>\n    \x3c!-- todo: don\'t require passing a unique ID to this template or an\n    interface that exposes it (i.e., allow passing a non-unique id and then\n    append it to a random one, or something --\x3e\n    <div id="<%=fieldsetClass%>">\n        <div class="fd-fieldset-content"></div>\n    </div>\n</fieldset>\n')},10348:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-question-toolbar-container clearfix">\n    <% if (isCopyable) { %><div class="btn-toolbar pull-left"></div><% } %>\n    <div class="btn-toolbar pull-right">\n        <% if (isDeleteable) { %>\n            <button type="button" class="btn btn-danger fd-button-remove"  tabindex="-1">\n                <i class="fa-regular fa-trash-can"></i> <%-gettext("Delete")%>\n            </button>\n        <% } %>\n        <% if (sections.length) { %>\n            <div class="btn-group fd-section-changer">\n                <a class="btn btn-default dropdown-toggle" data-toggle="dropdown">\n                    <i class="fa fa-reorder"></i>\n                    <i class="fa fa-caret-down"></i>\n                </a>\n                <ul class="dropdown-menu dropdown-menu-right checklist">\n                    <li class="dropdown-header"><%-gettext("Show")%></li>\n                    <% _.each(sections, function(section) { %>\n                    <li>\n                        <a data-slug="<%= section.slug %>" <% if (section.show) { %>class="selected"<% } %>>\n                            <i class="fa fa-check"></i><%= section.displayName %>\n                        </a>\n                    </li>\n                    <% }); %>\n                </ul>\n            </div>\n        <% } %>\n    </div>\n</div>\n<div class="alert alert-info fd-question-comment"\n<% if (!comment) { %>\n  style="display: none"\n<% } %>\n><%= comment %></div>\n')},64226:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="btn-group question-type-changer">\n    <a class="btn btn-default dropdown-toggle current-question"\n        data-toggle="dropdown">\n        <i class="<%=currentQuestionIcon%>"></i> \n        <%= currentTypeName %> <span class="caret"></span>\n    </a>\n    <ul class="dropdown-menu">\n        <% if (questions.length === 0) { %>\n            <li class="dropdown-header"><%-gettext("Cannot Change Question Type")%></li>\n        <% } else { %>\n            <li class="dropdown-header"><%-gettext("Change Question Type To")%></li>\n            <% _.each(questions, function(question) { %>\n            <li>\n                <a class="change-question" data-qtype="<%=question.slug%>">\n                    <i class="<%=question.icon%>"></i> <%=question.name%>\n                </a>\n            </li>\n            <% }); %>\n        <% } %>\n\n    </ul>\n</div>\n')},11409:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="widget">\n    <div class="form-group">\n        <div class="control-label col-sm-3">\n            <label><%= labelText %></label>\n            <% if (help) { %>\n                <div class="fd-help">\n                    <a tabindex="-1"\n                        data-title="<%- labelText %>"\n                        data-content="<%- help.text %><% if (help.url) { %><p><a href=\'<%- help.url %>\' target=\'_blank\'>See more</a></p><% } %>"></a>\n                </div>\n            <% } %>\n        </div>\n        <div class="col-sm-9 controls">\n            \x3c!-- input will go here --\x3e\n            <div class="messages"></div>\n        </div>\n    </div>\n</div>\n')},69655:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-undo-delete alert alert-<%= errors.length ? "danger" : "success" %> fade in">\n  <button type="button" class="close">&times;</button>\n  <%-gettext("You have deleted a question.")%> <a class="fd-undo"><%-gettext("Undo")%></a>\n  <% if (errors.length) { %>\n    <p><%\n      print(format(\n        ngettext(\n          "Warning: {errs} is still referenced by other questions.",\n          "Warning: {errs} are still referenced by other questions.",\n          errors.length\n        ),\n        {errs: errors.join(", ")}\n      ))\n    %></p>\n  <% } %>\n</div>\n')},67501:(e,t,n)=>{const a=n(13946);e.exports=a.template('<% props[""] = {calculate: "", relevant: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-attachment-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Node Name")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Source")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-from form-control"\n               value="<%-v[\'from\']%>" type="text" placeholder="<%-gettext("From")%>"/>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-name form-control"\n               value="<%-v[\'name\']%>" type="text" placeholder="<%-gettext("Attachment Name")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},80237:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="well fd-kv">\n    <% pairs[""] = ""; %>\n    <% _.each(pairs, function (v, k) { _.each(_.isArray(v) ? v : [v], function (v) { %>\n        <div class="fd-kv-pair form-group">\n            <div class="col-sm-3">\n                <input class="fd-kv-key form-control" type="text" value="<%=k%>" placeholder="<%-gettext("key")%>" />\n            </div>\n            <div class="col-sm-1 fd-kv-arrow"><i class="fa fa-arrow-right"></i></div>\n            <div class="col-sm-7"><input class="fd-kv-val form-control jstree-drop" type="text" value="<%=v%>" placeholder="<%-gettext("value")%>" /></div>\n            <div class="col-sm-1">\n                <a class="btn fd-kv-remove-pair btn-sm btn-danger<% if (k ==\'\') { %> hide<% } %>">\n                    <i class="fa fa-remove"></i>\n                </a>\n            </div>\n        </div>\n    <% }); }); %>\n    <a class="btn btn-default fd-kv-add-pair hide"><i class="fa fa-plus"></i> <%=gettext("Add Key&rarr;Value Pair")%></a>\n</div>\n')},30918:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="fd-control-message alert alert-warning alert-block <%= msg.level %>">\n    <button type="button" class="close" data-dismiss="alert">&times;</button>\n    <% if (html) { %><%= html %><% } else { %><%- msg.message %><% } %>\n</div>\n')},34206:(e,t,n)=>{const a=n(13946);e.exports=a.template('<% props[""] = {calculate: "", relevant: "", case_type: "", relationship: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-index-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Relationship Identifier (e.g. parent or host)")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Referenced Case ID")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-case-type form-control"\n               value="<%-v[\'case_type\']%>" type="text" placeholder="<%-gettext("Referenced Case Type")%>"/>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-relationship form-control"\n               value="<%-v[\'relationship\']%>" type="text" placeholder="<%-gettext("Relationship (child or extension)")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},63835:(e,t,n)=>{const a=n(13946);e.exports=a.template('<div class="well well-small">\n  <%= internal_template({props: props}) %>\n  <a class="btn btn-default fd-add-property hide"><i class="fa fa-plus"></i> <%-gettext("Add Property")%></a>\n</div>\n<div class="messages" />\n')},80001:(e,t,n)=>{const a=n(13946);e.exports=a.template('<% props[""] = {calculate: "", relevant: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-update-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Property Name")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Calculation")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-relevant form-control"\n               value="<%-v[\'relevant\']%>" type="text" placeholder="<%-gettext("Relevant")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},77026:(e,t,n)=>{var a,i;a=[n(98094),n(13946)],void 0===(i=function(e,t){function n(e,t){this.value=t,this.children=e||[],this.parent=null}function a(t,a){e.eventuality(this),this.rootNode=new n(null,null),this.rootNode.isRootNode=!0,this.setRootID(t),this.treeType=a||"data"}return n.prototype={getChildren:function(){return this.children},getValue:function(){return this.value},addChild:function(e){e.parent=this,this.children.push(e)},insertChild:function(e,t){if(null===e)return null;t<0&&(t=0),e.parent=this,this.children.splice(t,0,e)},getSingleMatchingNode:function(e){var t;if(e(this.getValue()))return this;for(var n=0;n<this.children.length;n++)if(t=this.children[n].getSingleMatchingNode(e))return t;return null},removeChild:function(e){var t=this.children.indexOf(e);return-1!==t&&this.children.splice(t,1),e.parent=null,e},getID:function(){return this.isRootNode?this.rootNodeId:this.getValue().getNodeID()},getChildrenMugs:function(){var e,t=[];for(e in this.children)this.children.hasOwnProperty(e)&&t.push(this.children[e].getValue());return t},getStructure:function(){var e={};return e[this.getID()]=t.map(this.children,(function(e){return e.getStructure()})),e},treeMap:function(e,t,n){var a,i=e(this),r=this.getChildren();for(a in i&&t.push(i),r)r.hasOwnProperty(a)&&r[a].treeMap(e,t,n);return n&&n(this,i),t},walk:function(e){var t=this.getValue(),n=this.getChildren();e(t,this.getID(),(function(a){a&&(n=a(n,t));for(var i=0;i<n.length;i++)n[i].walk(e)}))},getAbsolutePath:function(e){if(this.isRootNode)return e?"":"/"+this.getID();var t,n=this.value,a=n.p.dataParent;if(a){var i=n.form.getMugByPath(a);t=i&&i!==n?n.form.getAbsolutePath(i,e):e?"":"/"+this.getRootNode().rootNodeId}else if(null===(t=this.parent.getAbsolutePath(e)))return null;var r=this.getID();return n.options.getPathName&&(r=n.options.getPathName(n,r)),(t||"")+"/"+r},validateTree:function(e){var t;if(!this.getValue())throw"Tree contains node with no values!";if(!e(this.getValue()))return!1;for(t in this.getChildren())if(this.getChildren().hasOwnProperty(t)&&!this.getChildren()[t].validateTree(e))return!1;return!0},getRootNode:function(){return this.isRootNode?this:this.parent.getRootNode()}},a.prototype={setRootID:function(e){this.rootNode.rootNodeId=e},getParentNode:function(e){return this.rootNode===e?this.rootNode:e&&e.parent},getStructure:function(){return this.rootNode.getStructure()},getNodeFromMug:function(e){return e["_node_"+this.treeType]},_removeNodeFromTree:function(e){var t=this.getParentNode(e);t&&(t.removeChild(e),this.fire({type:"change"}))},insertMug:function(e,t,a,i){var r,o,s=a?this.getNodeFromMug(a):this.rootNode,l=this.getNodeFromMug(e);switch(l&&this.rootNode===l.getRootNode()?this._removeNodeFromTree(l):(l=new n(null,e),e["_node_"+this.treeType]=l),t){case"before":case"inside":r=(o=this.getParentNode(s)).children.indexOf(s),o.insertChild(l,r);break;case null:case"after":r=(o=this.getParentNode(s)).children.indexOf(s),o.insertChild(l,r+1);break;case"into":case"last":s.addChild(l);break;case"first":s.insertChild(l,0);break;case"index":s.insertChild(l,i);break;default:throw"in insertMug() position argument MUST be null, 'before', 'after', 'into', 'first' or 'last'. Argument was: "+t}return this.fire({type:"change",mug:e}),l},getAbsolutePath:function(e,t){var n=this.getNodeFromMug(e);return n?n.getAbsolutePath(t):null},getPreviousSibling:function(e){var t=this,n=t.getNodeFromMug(e),a=e.parentMug,i=a?t.getNodeFromMug(a):t.getRootNode(),r=i.children.indexOf(n);return 0===r?a:i.children[r-1].getValue()},findSibling:function(e,t,n){var a,i,r,o=this.getNodeFromMug(e);if(!o)throw"mug not found in "+this.treeType+" tree";if(-1===(i=(a=this.getParentNode(o).getChildrenMugs()).indexOf(e)))throw"mug not found in its parent's children";if("before"===t){for(r=i-1;r>=0;r--)if(n(a[r]))return a[r]}else for(r=i+1;r<a.length;r++)if(n(a[r]))return a[r];return null},removeMug:function(e){this._removeNodeFromTree(this.getNodeFromMug(e))},getRootChildren:function(){return this.rootNode.getChildrenMugs()},treeMap:function(e,t){return this.rootNode.treeMap(e,[],t)},walk:function(e){this.rootNode.walk(e)},isTreeValid:function(e){var t,n=this.rootNode.getChildren();for(t in n)if(n.hasOwnProperty(t)&&!n[t].validateTree(e))return!1;return!0},getRootNode:function(){return this.rootNode}},a.Node=n,a}.apply(t,a))||(e.exports=i)},43809:(e,t,n)=>{var a,i;a=[n(13946)],void 0===(i=function(e){var t=/[\r\n\u2028\u2029"\t]/;function n(n){return n=null===n||e.isUndefined(n)?"":String(n),t.test(n)&&(n='"'+n.replace(/"/g,'""')+'"'),n}return{escape:n,makeRowParser:function(t){var n=/(.*)(?:\n|\r\n|\r|\u2028|\u2029)/gm,a=/(.*?)(?:\t|(\n|\r\n|\r|\u2028|\u2029|$))/g,i=/^("(?:[^"]|"")*")(?:\t|(\n|\r\n|\r|\u2028|\u2029|$))/,r=/""/g,o=t.length,s=0;function l(e){if(e<=s)throw new Error("last index "+s+" -> "+e);s=e}return function(){if(s>=o)return null;n.lastIndex=s;var d=n.exec(t);return d&&-1===d[1].indexOf('"')?(l(n.lastIndex),d[1].split("\t")):function(){var n,d,u=[];a.lastIndex=s;do{'"'===(n=a.exec(t))[1][0]&&(d=i.exec(t.slice(s)))&&d[1]&&((n=d)[1]=n[1].slice(1,-1).replace(r,'"'),a.lastIndex=s+n[0].length),u.push(n[1]),l(a.lastIndex)}while(s<o&&e.isUndefined(n[2]));return u}()}},tabDelimit:function(t){return e.map(t,(function(t){return e.map(t,n).join("\t")})).join("\n")}}}.apply(t,a))||(e.exports=i)},7512:(e,t)=>{var n;void 0===(n=function(){function e(){this.undoItems=[],this.redoItems=[],this.isUpdating=!1,this.lastPushTime=null}function t(t){this.element=t,this.undoStack=new e}function n(e){const t=window.getSelection();if(0===t.rangeCount)return null;const n=t.getRangeAt(0),a=n.startContainer,i=n.startOffset;if(!e.contains(a))return null;const r=[];let o=a;for(;o!==e;){const e=o.parentNode;if(!e)break;const t=Array.from(e.childNodes).indexOf(o);r.unshift(t),o=e}return{nodePath:r,startOffset:i}}function a(e,t){if(!t)return;let n=e;t.nodePath.forEach((t=>{n=n.childNodes[t]?n.childNodes[t]:e}));const a=document.createRange();try{a.setStart(n,t.startOffset),a.setEnd(n,t.startOffset);const e=window.getSelection();e.removeAllRanges(),e.addRange(a)}catch(e){}}function i(e){const t=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}return e.prototype={push:function(e,t=!0){return!this.isUpdating&&(t&&this.undoItems.length>0&&null!==this.lastPushTime&&Date.now()-this.lastPushTime<500?this.undoItems[this.undoItems.length-1]=e:this.undoItems.push(e),this.lastPushTime=t?Date.now():null,this.redoItems=[],!0)},peek:function(e){let t=null;if(this.undoItems.length>0&&(t=this.undoItems[this.undoItems.length-1]),e&&"function"==typeof e){this.isUpdating=!0;try{e(t)}finally{this.lastPushTime=null,this.isUpdating=!1}}},undo:function(e){let t=null;if(this.undoItems.length>1&&(this.redoItems.push(this.undoItems.pop()),t=this.undoItems[this.undoItems.length-1]),e&&"function"==typeof e){this.isUpdating=!0;try{e(t)}finally{this.lastPushTime=null,this.isUpdating=!1}}},redo:function(e){let t=null;if(this.redoItems.length>0){const e=this.redoItems.pop();this.undoItems.push(e),t=e}if(e&&"function"==typeof e){this.isUpdating=!0;try{e(t)}finally{this.lastPushTime=null,this.isUpdating=!1}}}},t.prototype={push:function(e=!0){const t={value:this.element.innerHTML,cursor:n(this.element)};this.undoStack.push(t,e)},peek:function(){let e=null;return this.undoStack.peek((t=>{e=t})),e},reset:function(){this.undoStack.peek((e=>{null!==e&&(this.element.innerHTML=e.value,a(this.element,e.cursor))}))},undo:function(){this.undoStack.undo((e=>{null!==e&&(this.element.innerHTML=e.value,a(this.element,e.cursor),i(this.element))}))},redo:function(){this.undoStack.redo((e=>{null!==e&&(this.element.innerHTML=e.value,a(this.element,e.cursor),i(this.element))}))}},{UndoStack:e,ElementUndoStack:t}}.apply(t,[]))||(e.exports=n)},33629:(e,t,n)=>{var a,i;a=[n(10561),n(13946),n(98094),n(69655)],void 0===(i=function(e,t,n,a){function i(){var t=e(".fd-undo-delete");return!!t.hasClass("in")&&t.length}function r(r){var o,s;r.length&&!i()?(o=t.map(r,(function(e){return e[0]})),s=t.filter(t.map(o,(function(e){return e.isReferencedByOtherMugs(o)?e.p.nodeID:""})),t.identity),e(".fd-undo-container").append(a({errors:s,format:n.format}))):0===r.length&&i()&&e(".fd-undo-delete").remove()}function o(){this.undoStack=[],n.eventuality(this)}return o.prototype={resetUndo:function(e,t,n){this.undoStack=e?[[e,t,n]]:[],r(this.undoStack),this.fire({type:"reset"})},setUndo:function(e){this.undoStack=this.undoStack.concat(e),r(this.undoStack)},undo:function(){t.each(this.undoStack,(function(e){var t=e[0],n=e[1],a=e[2];t.form.insertQuestion(t,n,a,!0)})),this.resetUndo()}},o}.apply(t,a))||(e.exports=i)},57100:(e,t,n)=>{var a,i;a=[n,e,n(13946),n(10561),n(92589),n(23184),n(45080),n(73609),n(88793),n(99606),n(31779),n(68125),n(50237),n(74533),n(21877)],void 0===(i=function(e,t,n,a,i,r,o,s,l,d,u,c,p,f){"use strict";var h={image:gettext("Image"),audio:gettext("Audio"),video:gettext("Video"),"video-inline":gettext("Inline Video"),text:gettext("HTML")},g={image:l,audio:d,video:u,"video-inline":u,text:c},m={image:"CommCareImage",audio:"CommCareAudio",video:"CommCareVideo","video-inline":"CommCareVideo",text:"CommCareMultimedia"},v={image:"fd_hqimage",audio:"fd_hqaudio",video:"fd_hqvideo","video-inline":"fd_hqInlineVideo",text:"fd_hqtext"},x=/(\.[^\/.]+)?$/,y=function(e,t,a){var i,r=n.isFunction(e.getItextValue),o=n.isFunction(e.getItextItem),s=r?e.getItextValue():e.getValue();if(!o||r||s||e.isDefaultLang||(s=e.getItextItem().get(e.form,e.defaultLang)),s in t){var l=t[s];i=g[e.form]({url:l.url})}else i=p({iconClass:a[e.form]});return i},b=function(e,t){var n,i=e.getItextValue?e.getItextValue():e.getValue();return(n=a(r({multimediaExists:i in t,uploaderId:v[e.form],mediaType:h[e.form]}))).click((function(){e.mediaRef.updateController(e),e.getUploaderModal().find(".hqm-upload-status").empty(),e.updateModalExistingFile(t)})),n};a.vellum.plugin("uploader",{objectMap:!1,uploadUrls:{image:!1,audio:!1,video:!1,"video-inline":!1,text:!1}},{init:function(){var e=this.opts().uploader,t=e.uploadUrls,n=e.objectMap&&e.uploadUrls&&e.uploadUrls.image;this.data.uploader.uploadEnabled=n,this.data.uploader.objectMap=e.objectMap,n&&(this.data.uploader.uploadControllers={image:this.initUploadController({uploaderSlug:"fd_hqimage",mediaType:"image",uploadUrl:t.image}),audio:this.initUploadController({uploaderSlug:"fd_hqaudio",mediaType:"audio",uploadUrl:t.audio}),video:this.initUploadController({uploaderSlug:"fd_hqvideo",mediaType:"video",uploadUrl:t.video}),"video-inline":this.initUploadController({uploaderSlug:"fd_hqInlineVideo",mediaType:"video-inline",uploadUrl:t.video}),text:this.initUploadController({uploaderSlug:"fd_hqtext",mediaType:"text",uploadUrl:t.text})})},initMediaUploaderWidget:function(e){this.__callOld(),this.data.uploader.uploadEnabled&&function(e,t,i){if(e.mediaRef=function(e,t,a){var i={};return i.mediaType=e,i.updateRef=function(e){i.path=e,i.linkedObj=t[e]},i.isMediaMatched=function(){return n.isObject(i.linkedObj)},i.getUrl=function(){return i.linkedObj?i.linkedObj.url:void 0},i.updateController=function(e){var t=a[i.mediaType];t.currentReference=i,t.updateMediaPath=function(){var n=t.uploadParams;n.path=e.getRandomizedMediaPath(n.path),e.updateReference(n.path)},t.uploadParams={path:i.path,media_type:m[i.mediaType],old_ref:i.isMediaMatched()?i.linkedObj.m_id:"",replace_attachment:!0}},i}(e.form,t,i),!e.getBaseMediaPath)throw new Error("required method not found: widget.getBaseMediaPath()");e.getRandomizedMediaPath=function(t){var n=x.exec(t)[0].toLowerCase()||".xyz",a=Math.random().toString(36).slice(2,8);return e.getBaseMediaPath()+"-"+a+n};var r=e.getItextValue||e.getValue,o=e.getControl(),s=a("<div />"),l=e.getUIElement,d=a("<div />").addClass("fd-mm-preview-container"),u=e.mug.form.vellum.data.javaRosa.ICONS;e.getUploaderModal=function(){return a("#"+v[e.form])},e.updateModalExistingFile=function(t,n){var i=e.mug.form.vellum.data.javaRosa.ICONS,r=e.getUploaderModal(),o=r.find(".hqm-existing");e.mediaRef.getUrl()&&e.mediaRef.isMediaMatched()?(o.removeClass("hide"),o.find(".hqm-existing-controls").html(y(e,t,i)),n&&r.find(".hqm-upload-completed").removeClass("hide")):(o.addClass("hide"),o.find(".hqm-existing-controls").empty()),a(".existing-media").tooltip({placement:"bottom"})},e.getUIElement=function(){var n=(s=l()).find(".controls"),i=a("<div />").addClass("fd-mm-upload-container");return n.empty().addClass("control-row").data("form",e.form),e.updateReference(),d.html(y(e,t,u)),n.append(d),i.html(f()),i.find(".fd-mm-upload-trigger").append(b(e,t)),i.find(".fd-mm-path-input").append(o),i.find(".fd-mm-path-show").click((function(e){a(this).addClass("hide"),i.find(".fd-mm-path").removeClass("hide"),e.preventDefault()})),i.find(".fd-mm-path-hide").click((function(e){a(this).parent().addClass("hide"),i.find(".fd-mm-path-show").removeClass("hide"),e.preventDefault()})),o.on("change keyup",(function(){e.updateMultimediaBlockUI(t)})),s.on("mediaUploadComplete",(function(n,a){e.handleUploadComplete(n,a,t)})),n.append(i),o.on("change keyup",e.updateValue),s},e.handleUploadComplete=function(t,n,a){n.ref&&n.ref.path&&(r()!==n.ref.path&&(e.getControl().val(n.ref.path),e.handleChange()),a[n.ref.path]=n.ref),e.updateMultimediaBlockUI(a),e.updateModalExistingFile(a,!0)},e.updateMultimediaBlockUI=function(t){d.html(y(e,t,u)).find(".existing-media").tooltip(),s.find(".fd-mm-upload-trigger").empty().append(b(e,t)),e.updateReference()},e.updateReference=function(t){var n=t||r();s.attr("data-hqmediapath",n),e.mediaRef.updateRef(n)}}(e,this.data.uploader.objectMap,this.data.uploader.uploadControllers)},initUploadController:function(e){var t=a(i({mediaType:e.mediaType,modalId:e.uploaderSlug}));this.$f.find(".fd-multimedia-modal-container").append(t);var r=!0;t.on("hide.bs.modal",(function(e){r||e.preventDefault()}));var l=t.find(".btn-primary"),d=t.find("input[type='file']"),u=t.find(".hqm-upload-confirm"),c=function(e,t){e?u.removeClass("disabled"):u.addClass("disabled"),t?(u.find(".fa-spin").removeClass("hide"),u.find(".fa-cloud-arrow-up").addClass("hide")):(u.find(".fa-spin").addClass("hide"),u.find(".fa-cloud-arrow-up").removeClass("hide"))};l.click((function(){d.click()})),d.change((function(){var e=t.find(".hqm-upload-status");if(d.get(0).files.length){var n=d.get(0).files[0];e.html(o({file_size:(n.size/1048576).toFixed(3),file_name:n.name})),c(!0,!1)}else e.empty(),c(!1,!1)}));var p={};return u.click((function(){c(!1,!0),r=!1;var i=d.get(0).files[0],o=new FormData;o.append("Filedata",i),p.updateMediaPath();var l="."+i.name.split(".").pop().toLowerCase();p.uploadParams.path=p.uploadParams.path.replace(/(\.[^/.]+)?$/,l),n.each(p.uploadParams,(function(e,t){o.append(t,e)}));var u=t.find(".hqm-upload-status");a.ajax({url:e.uploadUrl,type:"POST",data:o,contentType:!1,processData:!1,enctype:"multipart/form-data",success:function(e){e=JSON.parse(e),a('[data-hqmediapath^="'+e.ref.path.replace(/\.\w+$/,".")+'"]').trigger("mediaUploadComplete",e),u.empty(),c(!1,!1),r=!0},error:function(e){e=JSON.parse(e.responseText),u.find(".hqm-error").show(),u.find(".hqm-errors").html(s({errors:e.errors})),u.find(".hqm-begin").hide(),c(!1,!1),r=!0}})})),p}})}.apply(t,a))||(e.exports=i)},98094:(e,t,n)=>{var a,i;a=[n,n(89339),n(13946),n(70426),n(7903),n(77229),n(10561),n(36283)],void 0===(i=function(e,t,a,i,r,o,s){RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};var l={isMac:/Mac/.test(navigator.platform)},d=l.isMac,u={";":";","≠":"=","–":"-","=":"=","-":"-",186:";",187:"=",189:"-"};return l.getKeyChord=function(e){var t=d&&e.metaKey||!d&&e.ctrlKey,n=d&&e.ctrlKey||!d&&e.metaKey,a=String(e.key),i=e.which;return u.hasOwnProperty(i)?a=u[i]:u.hasOwnProperty(a)?a=u[a]:1!==a.length&&"Unidentified"!==a||(a=i>=48&&i<=57||i>=65&&i<=90?String.fromCharCode(i):i>=96&&a<=105?String.fromCharCode(i-48):i),(t?"Ctrl+":"")+(e.altKey?"Alt+":"")+(e.shiftKey?"Shift+":"")+(n?"Meta+":"")+a},l.extend=function(){var e=Array.prototype.slice.call(arguments);return s.extend.apply(null,[!0,{}].concat(e))},l.langCodeToName={},a.each(t,(function(e){var t=e.names[0];l.langCodeToName[e.three]=t,l.langCodeToName[e.two]=t})),l.formatExc=function(e){return e&&e.stack?e+"\n"+e.stack:String(e)},l.validAttributeRegex=/^[^<&'">]*$/,l.invalidAttributeRegex=/[<&'">]/,l.isValidAttributeValue=function(e){return l.validAttributeRegex.test(e)},l.eventuality=function(e){var t={},n={};return e.fire=function(e){var n,a,i,r,o="string"==typeof e?e:e.type;if(t.hasOwnProperty(o))for(n=t[o],r=0;r<n.length;r+=1)"string"==typeof(a=(i=n[r]).method)&&(a=this[a]),a.apply(this,i.parameters||[e]);return this},e.on=function(i,r,o,s,l){arguments.length<5&&(l=null);var d={method:r,parameters:o,context:l};return t.hasOwnProperty(i)?t[i].push(d):t[i]=[d],s&&(n[s]||(n[s]=[]),-1===n[s].indexOf(l)&&(n[s].push(l),e.on(s,(function(){e.unbind(l),n[s]=a.filter(n[s],(function(e){return e!==l}))}),null,null,l))),this},e.unbind=function(e,n){return a.isUndefined(n)?t=a.object(a.map(t,(function(t,n,i){return[n,t=a.filter(t,(function(t){return t.context!==e}))]}))):t.hasOwnProperty(n)&&(t[n]=a.filter(t[n],(function(t){return t.context!==e}))),this},e},l.escape=function(e){return s("<div>").text(e).html()},l.get_guid=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()},l.generate_xmlns_uuid=function(){var e,t,n=[];for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",t=0;t<36;t++)n[t]||(e=Math.floor(16*Math.random()),n[t]="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[19===t?3&e|8:15&e]);return n.toString().replace(/,/g,"")},l.isValidElementName=function(e){return/^(?!XML)[a-zA-Z][\w-]*$/.test(e)},l.createXPathBoolFromJS=function(e){return!0===e||"true"===e?"true()":!1===e||"false"===e?"false()":null},l.getOneOrFail=function(e,t){if(0===e.length)throw l.format(gettext("No match for {info} found!"),{info:t});if(e.length>1)throw l.format(gettext("Multiple matches for {info} found!"),{info:t});return e[0]},l.reduceToOne=function(e,t,n){return l.getOneOrFail(a(e).filter(t),n)},l.getCaretPosition=function(e){var t=0;if(e.createTextRange){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else void 0!==e.selectionStart&&(t=e.selectionStart);return t},l.setCaretPosition=function(e,t,n){if(null==n&&(n=t),e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var a=e.createTextRange();a.collapse(!0),a.moveStart("character",t),a.moveEnd("character",n),a.select()}},l.insertTextAtCursor=function(e,t,n){var a=e[0],i=l.getCaretPosition(a),r=a.value.substring(0,i),o=a.value.substring(i,a.value.length),s=n?i:i+t.length;e.val(r+t+o).change(),i+=t.length,l.setCaretPosition(a,s,i)},l.parseXML=o.parseXML,l.htmlXMLDiff=function(e,t){function n(e){return(e=e.replace(/^\t+/gm,(function(e){return e.replace(/\t/g,"  ")}))).match(/\n$/)||(e+="\n"),e}e=n(e),t=n(t);const a=new i,r=a.diff_main(e,t);let o=a.diff_prettyHtml(r);return o=o.replaceAll("&para;<br>","<br>"),o},l.markdown=r,l.truncate=function(e,t){return t=t||25,e&&e.length>t?e.slice(0,t)+"&hellip;":e},l.writeHashtags=function(e,t,i,r){if(a.isString(i))if(""===i||r.options&&r.options.ignoreHashtags)e.writeAttributeString(t,i);else{var o,s,l=r.form,d=t.replace(":","__");try{var u=l.xpath.parse(i);o=u.toXPath(),s=u.toHashtag()}catch(e){l.richText?(s=i,o=n(94459).unescapeXPath(i,l)):s=o=i}s!==o?(l.richText&&e.writeAttributeString("vellum:"+d,s),e.writeAttributeString(t,o)):e.writeAttributeString(t,i)}},l.isRightToLeftLanguage=function(e){return a.contains(["ara","arc","div","fas","heb","pus","snd","uig","urd","yid"],e)},l.getReferenceName=function(e){var t=/^#([^\/]+)\//.exec(e);return t?(t=t[1][0].toUpperCase()+t[1].substring(1).toLowerCase())+" Reference":"Form Reference"},l.format=function(e,t){return e.replace(/\{([a-z][\w_]*)\}/gi,(function(e,n){return t.hasOwnProperty(n)?t[n]:e}))},l.checkForFormSubmissions=a.throttle((function(e){e.warnWhenChanged||e.isCurrentlyCheckingForSubmissions||(e.isCurrentlyCheckingForSubmissions=!0,s.ajax({url:e.submissionUrl,type:"GET",dataType:"json",success:function(t){t.form_has_submissions&&(e.warnWhenChanged=!0,e.walkMugs((function(e){e.validate()})))},complete:function(){e.isCurrentlyCheckingForSubmissions=!1}}))}),1e4),l}.apply(t,a))||(e.exports=i)},50705:(e,t,n)=>{var a,i;a=[n(11409),n(80237),n(30918),n(13946),n(10561),n(20939),n(98094),n(94459),n(53578)],void 0===(i=function(e,t,n,a,i,r,o,s,l){var d=function(e,t){var n={};return t.richText=!0,n.options=t,n.mug=e,n.id=t.id,o.eventuality(n),n.isDisabled=function(){return!!n.path&&(a.isFunction(e.spec[n.path].enabled)?!e.spec[n.path].enabled(e):e.form.vellum.isPropertyLocked(e.hashtagPath,n.path))},n.getDisplayName=function(){return this.definition.lstring?this.definition.lstring:this.path},n.getControl=function(){throw"must be overridden"},n.setValue=function(e){},n.getValue=function(){},n.getHelp=function(){return this.definition&&this.definition.help?{text:this.definition.help,url:this.definition.helpURL}:null},n.refreshMessages=function(){},n.postRender=function(){},n.handleChange=function(){n.updateValue(),e.showChangedMsg=!0,n.path&&e.validate(n.path),n.fire("change")},n.updateValue=function(){n.save()},n.save=function(){throw"Not Implemented"},n.getUIElement=function(){return y(n.getControl(),n.getDisplayName(),!!n.isDisabled(),n.getHelp())},n.addInstanceRef=function(t,a){if(!a&&!(a=n.path))throw new Error("widget has no path: "+n);return e.form.addInstanceIfNotExists(t,e,a)},n},u=function(e,t){var n=t.widgetValuePath||t.path,a=t.id||"property-"+n,r=t.disabled||!1,o=d(e,t);return o.mugValue=t.mugValue||function(e,t){if(1===arguments.length)return e.p[n];e.p[n]=t},o.path=n,o.definition=e.p.getDefinition(t.path),o.currentValue=o.mugValue(e),o.id=a,o.saving=!1,o.input=i("<input />").attr("name",a).attr("id",a).prop("disabled",r),o.getControl=function(){return o.input},o.getMessagesContainer=function(){return o.getControl().closest(".widget").find(".messages:last")},o.getMessages=function(e,t){return b(e,t)},o.refreshMessages=function(){var t=o.getMessages(e,n),a=o.getMessagesContainer();a.empty(),t.length?(a.append(t),a.removeClass("hide")):a.addClass("hide")},e.on("messages-changed",(function(){o.refreshMessages()}),null,"teardown-mug-properties"),o.save=function(){o.saving=!0;try{o.mugValue(e,o.getValue())}finally{o.saving=!1}},o},c=function(e,t){var n=u(e,t),a=n.input;return a.attr("type","text").addClass("form-control"),t.placeholder&&a.attr("placeholder",t.placeholder),o.isRightToLeftLanguage(t.language)&&a.attr("dir","rtl"),n.setValue=function(t){t&&(t=t.replace(/\n/g,"&#10;"));var i=o.getCaretPosition(a[0]),r=a.val();t&&n.hasLogicReferences?a.val(e.form.normalizeXPath(t)):a.val(t),a.is(":focus")&&r.length===t.length&&o.setCaretPosition(a[0],i,i)},n.getValue=function(){var t=a.val().replace(/&#10;/g,"\n");return t&&n.hasLogicReferences?e.form.normalizeHashtag(t):t},a.on("change input",(function(){n.handleChange()})),n},p=function(e,t){var n=u(e,t);return n.input=i("<textarea></textarea>").attr("name",n.id).attr("id",n.id).attr("rows","2").addClass("form-control").on("change input",(function(e){n.handleChange()})).keyup((function(e){9===e.which&&this.select()})),o.isRightToLeftLanguage(t.language)&&n.input.attr("dir","rtl"),n.getControl=function(){return n.input},n.setValue=function(e){n.input.val(e)},n.getValue=function(){return n.input.val()},n},f=function(e,t){var n=u(e,t);n.input=i("<div />").attr("contenteditable",!0).attr("name",n.id).addClass("form-control jstree-drop").addClass(t.singleLine?"fd-input":"fd-textarea");var a={isExpression:t.widget===m||t.widget===g,disableNativeSpellChecker:t.disableNativeSpellChecker,rtl:o.isRightToLeftLanguage(t.language)},r=s.editor(n.input,e.form,a);return e.on("teardown-mug-properties",r.destroy,null,"teardown-mug-properties"),r.on("change",(function(){n.handleChange()})),n.input.on("inserted.atwho",(function(e,t,n){i(this).find(".atwho-inserted").children().unwrap()})),n.getControl=function(){return n.input},n.setValue=r.setValue,n.getValue=r.getValue,n},h=function(e,t){return e.form.richText?(t.singleLine=!0,f(e,t)):c(e,t)},g=function(e,t){const n=t.placeholder?t.placeholder:gettext("Drag question here"),a=h(e,t);return a.input.addClass("jstree-drop").attr("placeholder",n).change((function(){a.handleChange()})),a.hasLogicReferences=!0,a};g.trackLogicReferences=!0;var m=function(e,t){t.disableNativeSpellChecker=!0;var n=h(e,t),a=n.getValue,o=n.setValue;return n.getValue=function(){return i.trim(a())},n.getUIElement=function(){var i,r=n.getControl(),s=y(r,n.getDisplayName(),!!n.isDisabled(),n.getHelp());return r.addClass("jstree-drop"),t.autocompleteChoices&&(i=function(){return t.autocompleteChoices(e)}),x(s,(function(){n.options.displayXPathEditor({leftPlaceholder:t.leftPlaceholder,rightPlaceholder:t.rightPlaceholder,leftAutocompleteChoices:i,value:a(),xpathType:n.definition.xpathType,onLoad:function(e){w(e,n),e.find(".property-name").text(t.lstring||"Expression")},done:function(e){!1!==e&&(o(e),n.handleChange())},mug:e}),l.fbUsage("Logic",t.lstring)}),!!n.isDisabled())},r.autocomplete(n.input,e,{property:t.path,useRichText:e.form.richText}),n.hasLogicReferences=!0,n};m.trackLogicReferences=!0;var v=function(e,t){var n=u(e,t);n.dropdown=n.input=i("<select />").attr("name",n.id).addClass("form-control");var r=n.input;return n.setValue=function(e){var a=n.equivalentOption(e);a?r.val(a.value):t.noCustom?r.prop("selectedIndex",-1):(n.addCustomIfNeeded(e),r.val(e))},n.getValue=function(){return r.val()},n.updateValue=function(){n.save()},r.change((function(){n.handleChange()})),n.addOption=function(e,t){var n=i("<option />").attr("value",e).text(t);this.dropdown.append(n)},n.addOptions=function(e){var t=this;a.forEach(e,(function(e){t.addOption(e.value,e.text)}))},n.clearOptions=function(){this.dropdown.empty()},n.getOptions=function(){return a.map(n.dropdown.find("option"),(function(e){return{value:e.value,text:e.text}}))},n.equivalentOption=function(e){function t(e){try{return JSON.parse(e)}catch(t){return e}}return e=t(e),a.find(n.getOptions(),(function(n){return a.isEqual(t(n.value),e)}))},n.addCustomIfNeeded=function(e){var a=i("[name=property-androidIntentAppId]").find("option").filter((function(){return i(this).text()===gettext("Custom")}));t.useValueAsCustomName?n.addOption(e,e):0===a.length?n.addOption(e,gettext("Custom")):a.val(e)},t.defaultOptions&&n.addOptions(t.defaultOptions),n},x=function(e,t,n){var r=e.find("input");a.isUndefined(n)&&(n=!!r&&r.prop("disabled"));var o=i("<button />").addClass("fd-edit-button").html("<i class='fa fa-edit'></i>").stopLink().addClass("btn btn-default btn-block").attr("type","button").prop("disabled",n).click(t),s=i("<div />").addClass("col-sm-1").append(o);return e.css("position","relative"),e.find(".controls").removeClass("col-sm-9").addClass("col-sm-8").after(s),e},y=function(t,n,a,r){var o=i(e({labelText:n,help:r}));return t.find("*").addBack().prop("disabled",!!a),o.find(".controls").prepend(t),r&&!r.url&&o.find(".fd-help a").click((function(e){e.preventDefault()})),o};function b(e,t){var a=i(),r={};return e.messages.each(t,(function(s){const l=e.messages.getMessageText(s.message);if(r.hasOwnProperty(l))return;r[l]=!0;let d="";s.message.hasOwnProperty("markdown")?d=o.markdown(s.message.markdown):/n/.test(s.message)&&(d=o.markdown(s.message));const u=i(n({msg:s,html:d}));u.find("button.close").click((function(){e.dropMessage(t,s.key),"mug-nodeID-changed-warning"===s.key&&(e.showChangedMsg=!1)})),a=a.add(u)})),a}function w(e,t){return e.data("vellum_widget",t),e}return{base:d,normal:u,text:c,multilineText:p,richTextarea:function(e,t){return e.form.richText?(t.singleLine=!1,f(e,t)):p(e,t)},identifier:function(e,t){var n=c(e,t),i=n.updateValue,r=n.handleChange;function o(){var t=e.form.vellum.nodeIDFromLabel(e);n.input.attr("placeholder",t)}return n.updateValue=function(){var e=n.getValue();-1!==e.indexOf(" ")&&n.setValue(e.replace(/\s/g,"_")),""===e&&o(),i()},n._setURLHash=a.debounce((function(e){e.form.vellum._setURLHash(e)}),500),n.handleChange=function(){r(),n._setURLHash(e),e.p.nodeID||e.dropMessage("nodeID","mug-nodeID-error")},e.on("property-changed",(function(t){"conflictedNodeId"!==t.property||n.saving||n.setValue(n.mugValue(e))}),null,"teardown-mug-properties"),e.form.on("question-label-text-change",(function(t){e.p.nodeID||o()}),null,null,n),e.on("teardown-mug-properties",(function(){e.form.unbind(n)}),null,"teardown-mug-properties"),n},droppableText:g,checkbox:function(e,t){var n=u(e,t),a=n.input;return a.attr("type","checkbox"),n.setValue=function(e){a.prop("checked",e)},n.getValue=function(){return a.prop("checked")},a.change((function(){n.handleChange()})),n},dropdown:v,dropdownWithInput:function(e,t){var n=v(e,t),a=n.handleChange;n.input=n.text=i("<input />").addClass("form-control").attr({type:"text",name:n.id+"-text"});var r=i('<div class="control-row row">').append(i("<div class='col-sm-4'>").append(n.dropdown)).append(i("<div class='col-sm-8'>").append(n.text));return n.setValue=function(e){var t=n.equivalentOption(e);n.addCustomIfNeeded(e),t?(n.dropdown.val(t.value),n.text.attr("readonly",!0),n.text.val(t.value)):(n.dropdown.val(e),n.text.attr("readonly",!1),n.text.val(e))},n.getValue=function(){return n.text.val()},n.getControl=function(){return r},n.dropdown.change((function(){var e=n.dropdown.find(":selected");n.text.attr("readonly",e.text()!==gettext("Custom")),n.text.val(e.val()),a()})),n.text.change((function(){var e=n.dropdown.find(":selected");n.text.attr("readonly",!1),e.val(n.text.val()),a()})),n},xPath:m,baseKeyValue:function(e,n){var r=d(e,n),o=n.widgetValuePath||n.path,s=n.id||"property-"+o;function l(){var e={};return a.each(r.kvInput.find(".fd-kv-pair"),(function(t){var n=i(t),r=n.find(".fd-kv-key").val(),o=n.find(".fd-kv-val").val();e.hasOwnProperty(r)?a.isArray(e[r])?e[r].push(o):e[r]=[e[r],o]:e[r]=o})),e}return r.definition=e.p.getDefinition(n.path),n.richText=!1,r.mugValue=n.mugValue||function(e,t){if(1===arguments.length)return e.p[o];e.p[o]=t},r.currentValue=r.mugValue(e),r.kvInput=i('<div class="control-row" />').attr("name",s),r.getControl=function(){return r.isDisabled(),r.kvInput},r.setValue=function(e){r.kvInput.html(t({pairs:a.clone(e)})),r.kvInput.find("input").on("change keyup",(function(){r.handleChange()})),r.kvInput.find(".fd-kv-add-pair").click((function(e){r.refreshControl(),e.preventDefault()})),r.kvInput.find(".fd-kv-remove-pair").click((function(e){i(this).parent().parent().remove(),r.refreshControl(),r.save(),e.preventDefault()}))},r.getValue=function(){return a.omit(l(),"")},r.updateValue=function(){l().hasOwnProperty("")||(r.kvInput.find(".btn").removeClass("hide"),r.kvInput.find(".fd-kv-remove-pair").removeClass("hide")),r.save()},r.refreshControl=function(){r.setValue(r.getValue())},r.save=function(){r.saving=!0;try{r.mugValue(e,r.getValue())}finally{r.saving=!1}},r},readOnlyControl:function(e,t){t.id="readonly-control";var n=d(e,t);return n.definition={},n.currentValue=i("<div>").append(e.p.rawControlXML).clone().html(),n.getControl=function(){return i("<p />").text(this.currentValue)},n},abstractMediaWidget:function(e,t){var n=u(e,t);return n.form="text",n.getValue=function(){return n.input.val()},n.setValue=function(e){return n.input.val(e)},n.getBaseMediaPath=function(){throw new Error("abstract method not implemented: widget.getBaseMediaPath()")},n.mug.form.vellum.initMediaUploaderWidget(n),n},util:{getWidget:function(e,t){for(var n,a=e;a&&a.length;){if((n=a.data("vellum_widget"))&&(!t||t===a.vellum("get")))return n;a=a.parent()}return null},setWidget:w,getMessages:b,getUIElementWithEditButton:x,getUIElement:y}}}.apply(t,a))||(e.exports=i)},98922:(e,t,n)=>{var a,i;a=[n(10561),n(21877),n(36283)],void 0===(i=function(e){function t(t){t.on("DOMMouseScroll mousewheel",(function(t){var n=e(this),a=this.scrollTop,i=this.scrollHeight,r=n.height(),o=t.originalEvent.wheelDelta,s=o>0,l=function(){return t.stopPropagation(),t.preventDefault(),t.returnValue=!1,!1};return!s&&-o>i-r-a?(n.scrollTop(i),l()):s&&o>a?(n.scrollTop(0),l()):void 0}))}function n(t,n,a){var i,r,o,s;t.hasClass("fd-content-vertical-divider")?(o=n.offset().left<t.offset().left,i="pageX",r="width",s="col-resize"):(o=n.offset().top<t.offset().top,i="pageY",r="height",s="row-resize");var l=o?1:-1;t.mousedown((function(t){var o=n.data("min-size")||0,s=n[r](),d=function(e){var d=e[i]-t[i];n[r](Math.max(s+d*l,o)),n.resize(),a()};e(window).disableSelection().on("mousemove",d).one("mouseup",(function(){e(this).enableSelection(),e(this).off("mousemove",d)}))})).hover((function(e){e.target.style.cursor=s}))}return e.vellum.plugin("windowManager",{minHeight:200,bottomOffset:0},{init:function(){var a=this,i=this.opts().windowManager,r=function(){a.adjustToWindow()};t(this.$f.find(".fd-scrollable")),n(this.$f.find(".fd-content-divider"),this.$f.find(".fd-content-left"),r),n(this.$f.find(".fd-content-left-divider"),this.$f.find(".fd-accessory-pane"),r),this.data.windowManager.offset={top:i.topOffset||this.$f.offset().top-1,bottom:i.bottomOffset||0,left:i.leftOffset||this.$f.offset().left},this.data.windowManager.fullscreen=i.fullscreen,this.data.windowManager.adjustToWindow=r,e(window).resize(r),e(document).scroll(r),e(r),a.adjustToWindow()},adjustToWindow:function(){if(this.$f.is(":visible")){var t,n=e(window).height()-this.getCurrentTopOffset(),a=0===this.getCurrentTopOffset()?"fixed":"static",i=this.$f.find(".fd-ui-container");this.data.windowManager.fullscreen?(i.parent().css({height:null,width:null}),i.css({height:null,width:null}),i.addClass("full-screen"),e("body").addClass("vellum-full-screen"),i.parent().css({top:0,bottom:0,left:0,right:0,backgroundColor:"white"}),i.css("width",e(window).width())):(i.removeClass("full-screen"),e("body").removeClass("vellum-full-screen"),i.parent().css({top:"",bottom:"",left:"",right:"",backgroundColor:"white"}),i.css("width",i.parent().width())),i.parent().css("height",n+"px"),n-=this.getCurrentBottomOffset(),i.css("height",n+"px"),i.css("position",a).css("left",this.getCurrentLeftOffset()+"px"),t=i.width();var r=Math.max(n,this.opts().windowManager.minHeight),o=r,s=r-this.$f.find(".fd-head").outerHeight(!1),l=this.$f.find(".fd-accessory-pane");i.find(".fd-content").css("height",r+"px");var d=i.find(".fd-content-left .fd-tree");if(d.children(":not(.fd-scrollable)").each((function(t,n){o-=e(n).outerHeight(!1)})),l.children().length){var u=l.outerHeight(!1),c=u-l.find(".fd-head").outerHeight(!0);o-=2+u+this.$f.find(".fd-content-left-divider").outerHeight(!0),l.find(".fd-scrollable").css("height",c+"px"),l.show(),this.$f.find(".fd-content-left-divider").show()}else l.hide(),this.$f.find(".fd-content-left-divider").hide();d.find(".fd-scrollable").css("height",o+"px"),d.find(".fd-scrollable-minimal").css("max-height",o+"px"),i.find(".fd-content-right").css("width",t-this.getLeftWidth()+"px").find(".fd-scrollable.full").css("height",s+"px"),i.find(".fd-props-scrollable").css("height",s-i.find(".fd-props-toolbar").outerHeight(!0)-i.find(".fd-form-actions").outerHeight(!1)+"px")}},getLeftWidth:function(){return 2+this.$f.find(".fd-content-left").outerWidth(!1)+this.$f.find(".fd-content-divider").outerWidth(!0)},getCurrentTopOffset:function(){if(this.data.windowManager.fullscreen)return 0;var t=e(window).scrollTop(),n=this.data.windowManager.offset,a="function"==typeof n.top?n.top():n.top;return Math.min(Math.max(a-t,0),a)},getCurrentBottomOffset:function(){if(this.data.windowManager.fullscreen)return 0;var e=this.data.windowManager.offset;return"function"==typeof e.bottom?e.bottom():e.bottom},getCurrentLeftOffset:function(){if(this.data.windowManager.fullscreen)return 0;var t=e(window).scrollLeft(),n=this.data.windowManager.offset,a="function"==typeof n.left?n.left():n.left;return Math.min(a-t,a)}}),{preventDoubleScrolling:t}}.apply(t,a))||(e.exports=i)},77229:(e,t,n)=>{var a,i;a=[n(10561),n(13946)],void 0===(i=function(e,t){function n(t,n=!1){var a=i(t||""),r=document.implementation.createHTMLDocument().createElement("div");return n?e(r).append(a):e(r).html(a)}function a(a,r){if(!a)return"";if(t.isString(a)){if(!/[<>&]/.test(a))return a;a=function(e){return e.replace(/<(([\w:.-]+)(?:\s[^<]*?|))\/>/g,"<$1></$2>")}(i(a)),a=r?e(a):n(a,!0)}var o=new XMLSerializer,s=a[0];void 0===s&&(s=a);var l=o.serializeToString(s);return l.startsWith("<output")&&(l="<div>"+l+"</div>"),l.replace(/ xmlns="http:\/\/www.w3.org\/1999\/xhtml"/g,"").replace(/^<([\w:.-]+)(?:\s+[\w:.-]+=(["'])[^]*?\2)*\s*(?:\/>|>([^]*)<\/\1>)$/g,"$3").replace(/(<([\w:.-]+)(?:\s[^>]*|))><\/\2>/g,"$1 />").replace(/(<(output)(?:\s[^>]*|))>([\w\W]+)<\/output>/g,"$1 />$3").replace(/&nbsp;|\xa0/g," ").replace(/ xmlns:vellum="http:\/\/commcarehq.org\/xforms\/vellum"([ \/>])/g,"$1")}function i(e){return e.replace(/<(([\w:.-]+)(?:\s[^>]*|))\/>/g,"<$1></$2>")}return{humanize:function(e,n){return e?t.isString(e)&&-1===e.indexOf("&")&&!/<([\w:.-]+)(?:\s[^>]*|)><\/\1>/.test(e)?e:a(e,n).replace(/(?:&lt;(=?\s)|(\s)&gt;|&amp;([^&;\s]+;|.|$))/g,(function(e,t,n,a){return t?"<"+t:n?n+">":";"===a.slice(a.length-1)?e:"&"+a})):""},normalize:a,parseXML:function(t){return t?(t=t.replace(/<(h:)?html\b/,"<h:xdoc").replace(/<\/(h:)?html\b>/,"</h:xdoc>"),e(e.parseXML(t))):e()},query:function(t){var n,a='<xml xmlns="http://www.w3.org/1999/xhtml" xmlns:vellum="http://commcarehq.org/xforms/vellum">'+(t=i(t))+"</xml>";try{n=e(e.parseXML(a))}catch(a){n=e("<xml></xml>").html(t)}return n.toString=function(){return(new XMLSerializer).serializeToString(n[0]).replace(/^<xml\b[^>]*>/,"").replace(/<\/xml>$/,"").replace(/(<([\w:.-]+)(?:\s[^>]*|))><\/\2>/g,"$1 />").replace(/(<(output)(?:\s[^>]*|))>([\w\W]+)<\/output>/g,"$1 />$3").replace(/"\/>/g,'" />').replace(/&nbsp;|\xa0/g," ")},n},xhtml:n}}.apply(t,a))||(e.exports=i)},17867:(e,t,n)=>{var a,i;a=[n(13946),n(82776)],void 0===(i=function(e,t){return{makeXPathModels:function(e,n){return n=n||function(e){return e},t.makeXPathModels(n({isValidNamespace:function(t){return e.hashtagNamespaces.hasOwnProperty(t)},hashtagToXPath:function(t){var n=e.hashtagMap[t];if(n)return n;var a=t.lastIndexOf("/");if(-1!==a){var i=t.substring(0,a+1),r=t.substring(a+1);if(e.hashtagTransformations.hasOwnProperty(i))return e.hashtagTransformations[i](r)}return t},toHashtag:function(t){var n=t.toXPath();return e.invertedHashtagMap.hasOwnProperty(n)?e.invertedHashtagMap[n]:null}}))},createParser:function(e){var n=new t.Parser;return n.yy.xpathmodels=e,n.models=n.yy.xpathmodels,n},parser:function(e,t){var n=this.makeXPathModels(e,t);return this.createParser(n)}}}.apply(t,a))||(e.exports=i)},18819:e=>{"use strict";e.exports="data:image/gif;base64,R0lGODlhCwAHAIAAACgoKP///yH5BAEAAAEALAAAAAALAAcAAAINjI+AC7rWHIsPtmoxLAA7"},58612:e=>{"use strict";e.exports="data:image/gif;base64,R0lGODlhCwAHAIAAACgoKP///yH5BAEAAAEALAAAAAALAAcAAAIORI4JlrqN1oMSnmmZDQUAOw=="},4095:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAMAAAB/qqA+AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMNAMM9s3UAAAAXSURBVHjajcEBAQAAAIKg/H/aCQZ70AUBjAATb6YPDgAAAABJRU5ErkJggg=="},32466:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAACAQMAAABv1h6PAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjAAMHBgAAiABBI4gz9AAAAABJRU5ErkJggg=="},51037:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAACAQMAAAB49I5GAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjAAMOBgAAGAAJMwQHdQAAAABJRU5ErkJggg=="},67475:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAACAQMAAAAD0EyKAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjgIIGBgABCgCBvVLXcAAAAABJRU5ErkJggg=="},3010:e=>{"use strict";e.exports="data:image/svg+xml;utf8,<svg xmlns=%27http://www.w3.org/2000/svg%27><filter id=%27jstree-grayscale%27><feColorMatrix type=%27matrix%27 values=%270.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0%27/></filter></svg>#jstree-grayscale"},50477:()=>{}}]);