"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[414],{6414:(e,n,t)=>{t.r(n);var r=t(8324),a=t.n(r),o=t(1134),i=a().assert;describe("The plugin manager",(function(){it("should ignore unknown plugins",(function(e){o.A.init({plugins:["plugin-will-not-be-found"],core:{onReady:function(){i(!this.isPluginEnabled("plugin-will-not-be-found"),"loaded unknown plugin"),e()}}})}))}))},1134:(e,n,t)=>{t.d(n,{A:()=>D});var r=t(8449),a=t(8324),o=t.n(a),i=t(6848),l=t.n(i),u=t(3794),s=t.n(u),c=t(4523),d=t(561),f=t.n(d),p=t(1437),g=t.n(p),v=t(3809),m=t.n(v),h=t(705),y=t.n(h),A=t(7229),w=t.n(A),x=(t(1460),t(8803),o().assert),b=["Form Builder clip","version 1"];function j(e,n,t){if((t=c.Ay.defaults(t||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var r=w().parseXML(n).find("data").attr("xmlns");e=e.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+r+'"')}var a,o,i,u,s=(a=e,o=n,i=l().xml(a),u=l().xml(o),l().isEquivalent(i,u,{element_order:!0}));t.not&&(s=!s),s||_(e=I(e),n=I(n),"XML "+(t.not?"should not be equivalent":"mismatch"))}function _(e,n,t){if(e!==n){var r=s().createPatch("",e,n,"actual","expected");r=r.replace(/^Index:/,t||"Not equal:"),x(!1,function(e){var n={"-":31,"+":32};return e.replace(/^.+?$/gm,(function(e){return"["+(n[e[0]]||0)+"m"+e+"[0m"}))}(r))}}function I(e){return(e=e.replace(/^\t+/gm,(function(e){return e.replace(/\t/g,"  ")}))).match(/\n$/)||(e+="\n"),e}function S(e){return E("getCurrentMugInput",e)}function k(e){var n=f()("#vellum").vellum("get"),t=c.Ay.isString(e)?f()("[name="+e+"]"):e;return y().util.getWidget(t,n)}function E(){var e=Array.prototype.slice.call(arguments),n=f()("#vellum");return n.vellum.apply(n,e)}function M(){var e=[],n=c.Ay.map(arguments,(function(n){var t=c.Ay.isString(n)?q(n):n;if(!t||!t.ufid)throw new Error("mug not found: "+n);return e.push(t),t.ufid}));return E("jstree","deselect_all",!0),E("jstree","select_node",n),f()(".collapse-toggle.collapsed").click(),e}function q(e){0!==e.indexOf("/")&&(e="/data/"+e);var n=E("getMugByPath",e);if(!n){var t=e.split("/"),r=E("getMugByPath",t.slice(0,-1).join("/"));if(r&&r.__className.indexOf("Select")>-1){var a=E("getData").core.form.getChildren(r),o=t[t.length-1];if(1===a.length&&"itemset"===o&&"itemset"===a[0].options.tagName)return a[0];for(var i=0;i<a.length;i++)if(a[i].p.nodeID===o)return a[i]}}return n}x.equal=x.strictEqual,x.notEqual=x.notStrictEqual;const D={options:r.A,asyncatch:function(e){return function(){try{var n=Array.prototype.slice.call(arguments);return e.apply(this,n)}catch(e){throw e&&e.stack?new Error(e.stack):e}}},init:function(e){e=e||{};var n=f().extend(!0,{},r.A.options,e),t=f().fn.animate;f().fn.animate=function(e,n,r,a){t.apply(this,[e,0,r,a])},e.javaRosa&&e.javaRosa.langs&&(n.javaRosa.langs=e.javaRosa.langs),n.plugins=c.Ay.without(n.plugins,"atwho"),e.plugins&&(n.plugins=e.plugins),n&&n.features&&c.Ay.isUndefined(n.features.disable_popovers)&&(n.features.disable_popovers=!0),n.core=n.core||{};var a=n.core.saveUrl||function(){};n.core.saveUrl=function(e){return e.xform,a(e)};var o=f()("#vellum"),i=o.vellum("get");i&&(i.destroy(),f()("body > div.modal, body > div.modal-backdrop").remove()),o.empty().vellum(n)},call:E,loadXML:function(e,n,t,r){var a=[],o=E("getData");return r||window.history.replaceState(null,null," "),o.core.parseWarnings=[],E("loadXML",e,n||{}),t?c.Ay.isRegExp(t)&&(a=c.Ay.filter(o.core.parseWarnings,(function(e){return!t.test(e)}))):a=o.core.parseWarnings,x(!a.length,"unexpected parse warnings:\n- "+a.join("\n- ")),delete o.core.parseWarnings,o.core.form},saveAndReload:function(e){E("loadXFormOrError",E("createXML"),e)},getMug:q,getInput:S,getWidget:k,getMediaUploader:function(e){var n,t={},r=k(e);if(!r)throw new Error("media uploader widget not found");if(c.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(t){return(n=e.closest(t)).length})),!n)throw new Error("media uploader element not found");return t.upload=function(e){var t={ref:{path:r.getRandomizedMediaPath(e)},errors:[]};n.trigger("mediaUploadComplete",t)},t},assertEqual:_,assertInputCount:function(e,n,t){c.Ay.isString(e)?(t=" for "+(t?t+" ":"")+e,e=S(e)):t=t?" for "+t:"",x.equal(e.length,n,"wrong number of inputs"+t)},assertXmlEqual:j,assertXmlNotEqual:function(e,n,t){(t=t||{}).not=!0,j(e,n,t)},assertJSTreeState:function(){var e=Array.prototype.slice.call(arguments).join("\n")+"\n";_(function e(n,t){var r,a,o,i=[];for("#"===n.id?t=-1:i.push(Array(2*t+1).join(" ")+n.text),r=0,a=n.children.length;r<a;r++)o=E("jstree","get_node",n.children[r]),i.push(e(o,t+1));return i.join("\n")}(E("jstree","get_node","#"))+"\n",e,"Unexpected jstree state")},assertTreeState:function(e){var n=Array.prototype.slice.call(arguments,1).join("\n")+"\n";_(function e(n,t){var r,a,o,i=[];for(n.isRootNode?t=-1:i.push(Array(2*t+1).join(" ")+n.value.p.nodeID),r=0,a=n.children.length;r<a;r++)o=n.children[r],i.push(e(o,t+1));return i.join("\n")}(e.rootNode,0)+"\n",n,"Unexpected tree state")},addQuestion:function(e,n,t){t=c.Ay.extend({},t),this.prevId&&M(this.prevId);var r=E("addQuestion",e);return n||r.p.nodeID||(n=E("nodeIDFromLabel",r)),n&&(x(c.Ay.isUndefined(t.nodeID),"unexpected attribute for "+e+"["+n+"]"),r.p.labelItext&&r.p.labelItext.set(r.getLabelValue()),r.p.nodeID=n,"Choice"!==e||t.hasOwnProperty("labelItext")||(t.labelItext=n)),c.Ay.each(t,(function(e,n){c.Ay.isBoolean(e)||(e=String(e)),/.+Itext/.test(n)?r.p[n].set(e):r.p[n]=e})),c.Ay.each(E("getSections",r),(function(e){E("collapseSection",e.slug,!1)})),r},paste:function(e,n,t){c.Ay.isString(e)||(e=m().tabDelimit([b].concat(e))),t&&window.console.log(e),x.deepEqual(g().paste(e),n||[])},clickQuestion:M,selectAll:function(){E("jstree","select_all")},deleteQuestion:function(){var e=c.Ay.map(arguments,(function(e){var n=q(e);return x(n,"mug not found: "+e),n}));E("getData").core.form.removeMugsFromForm(e),c.Ay.each(arguments,(function(e){x(!q(e),"mug not removed: "+e)}))},saveButtonEnabled:function(e){var n=E("getData").core.saveButton;if(!c.Ay.isUndefined(e)){var t=e?"save":"saved";n.setStateWhenReady(t),x.equal(n.state,t,"sanity check failed")}return"save"===n.state},expandGroup:function(e){E("jstree","open_node",e.ufid),E("jstree","redraw_node",e.ufid,!0,!1,!1)},collapseGroup:function(e){E("jstree","close_node",e.ufid),E("jstree","redraw_node",e.ufid,!0,!1,!1)},getMessages:function(e){var n=[],t=null;if(c.Ay.isString(e)){var r=e;e=q(r),x(e,"mug not found: "+r)}return e.messages.each((function(e,r){r!==t&&(n.push(r+":"),t=r),n.push("  - "+e.message)})),n.join("\n")},findNode:function(e,n,t){if(c.Ay.isString(n)){var r=n;n=function(e){return e.text===r}}return function t(r){var a,o,i;if(n(r))return r;for(a=0,o=r.children.length;a<o;a++)if(i=t(e.get_node(r.children[a])))return i;return null}(t||e.get_node("#"))},isTreeNodeValid:function(e){if(c.Ay.isString(e)){var n=e;e=q(n),x(e,"mug not found: "+n)}return 0===f()("#vellum").find("#"+e.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return f()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:w().parseXML}}}]);