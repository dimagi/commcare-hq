"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[414],{6414:(e,n,t)=>{t.r(n);var r=t(8324),a=t.n(r),o=t(1134),i=a().assert;describe("The plugin manager",(function(){it("should ignore unknown plugins",(function(e){o.A.init({plugins:["plugin-will-not-be-found"],core:{onReady:function(){i(!this.isPluginEnabled("plugin-will-not-be-found"),"loaded unknown plugin"),e()}}})}))}))},1134:(e,n,t)=>{t.d(n,{A:()=>S});var r=t(8449),a=t(8324),o=t.n(a),i=t(6848),l=t.n(i),u=t(3794),s=t(4523),c=t(561),d=t.n(c),f=t(1437),p=t(3809),g=t(705),v=t(7229),m=(t(1460),t(9747),o().assert),h=["Form Builder clip","version 1"];function y(e,n,t){if((t=s.Ay.defaults(t||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var r=v.A.parseXML(n).find("data").attr("xmlns");e=e.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+r+'"')}var a,o,i,u,c=(a=e,o=n,i=l().xml(a),u=l().xml(o),l().isEquivalent(i,u,{element_order:!0}));t.not&&(c=!c),c||A(e=w(e),n=w(n),"XML "+(t.not?"should not be equivalent":"mismatch"))}function A(e,n,t){if(e!==n){var r=(0,u.createPatch)("",e,n,"actual","expected");r=r.replace(/^Index:/,t||"Not equal:"),m(!1,function(e){var n={"-":31,"+":32};return e.replace(/^.+?$/gm,(function(e){return"["+(n[e[0]]||0)+"m"+e+"[0m"}))}(r))}}function w(e){return(e=e.replace(/^\t+/gm,(function(e){return e.replace(/\t/g,"  ")}))).match(/\n$/)||(e+="\n"),e}function x(e){return j("getCurrentMugInput",e)}function b(e){var n=d()("#vellum").vellum("get"),t=s.Ay.isString(e)?d()("[name="+e+"]"):e;return g.A.util.getWidget(t,n)}function j(){var e=Array.prototype.slice.call(arguments),n=d()("#vellum");return n.vellum.apply(n,e)}function _(){var e=[],n=s.Ay.map(arguments,(function(n){var t=s.Ay.isString(n)?I(n):n;if(!t||!t.ufid)throw new Error("mug not found: "+n);return e.push(t),t.ufid}));return j("jstree","deselect_all",!0),j("jstree","select_node",n),d()(".collapse-toggle.collapsed").click(),e}function I(e){0!==e.indexOf("/")&&(e="/data/"+e);var n=j("getMugByPath",e);if(!n){var t=e.split("/"),r=j("getMugByPath",t.slice(0,-1).join("/"));if(r&&r.__className.indexOf("Select")>-1){var a=j("getData").core.form.getChildren(r),o=t[t.length-1];if(1===a.length&&"itemset"===o&&"itemset"===a[0].options.tagName)return a[0];for(var i=0;i<a.length;i++)if(a[i].p.nodeID===o)return a[i]}}return n}m.equal=m.strictEqual,m.notEqual=m.notStrictEqual;const S={options:r.A,asyncatch:function(e){return function(){try{var n=Array.prototype.slice.call(arguments);return e.apply(this,n)}catch(e){throw e&&e.stack?new Error(e.stack):e}}},init:function(e){e=e||{};var n=d().extend(!0,{},r.A.options,e),t=d().fn.animate;d().fn.animate=function(e,n,r,a){t.apply(this,[e,0,r,a])},e.javaRosa&&e.javaRosa.langs&&(n.javaRosa.langs=e.javaRosa.langs),n.plugins=s.Ay.without(n.plugins,"atwho"),e.plugins&&(n.plugins=e.plugins),n&&n.features&&s.Ay.isUndefined(n.features.disable_popovers)&&(n.features.disable_popovers=!0),n.core=n.core||{};var a=n.core.saveUrl||function(){};n.core.saveUrl=function(e){return e.xform,a(e)};var o=d()("#vellum"),i=o.vellum("get");i&&(i.destroy(),d()("body > div.modal, body > div.modal-backdrop").remove()),o.empty().vellum(n)},call:j,loadXML:function(e,n,t,r,a=!0){var o=[],i=j("getData");return r||window.history.replaceState(null,null," "),i.core.parseWarnings=[],j("loadXML",e,n||{},{reset:a}),t?s.Ay.isRegExp(t)&&(o=s.Ay.filter(i.core.parseWarnings,(function(e){return!t.test(e)}))):o=i.core.parseWarnings,m(!o.length,"unexpected parse warnings:\n- "+o.join("\n- ")),delete i.core.parseWarnings,i.core.form},saveAndReload:function(e){j("loadXFormOrError",j("createXML"),e)},getMug:I,getInput:x,getWidget:b,getMediaUploader:function(e){var n,t={},r=b(e);if(!r)throw new Error("media uploader widget not found");if(s.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(t){return(n=e.closest(t)).length})),!n)throw new Error("media uploader element not found");return t.upload=function(e){var t={ref:{path:r.getRandomizedMediaPath(e)},errors:[]};n.trigger("mediaUploadComplete",t)},t},assertEqual:A,assertInputCount:function(e,n,t){s.Ay.isString(e)?(t=" for "+(t?t+" ":"")+e,e=x(e)):t=t?" for "+t:"",m.equal(e.length,n,"wrong number of inputs"+t)},assertXmlEqual:y,assertXmlNotEqual:function(e,n,t){(t=t||{}).not=!0,y(e,n,t)},assertJSTreeState:function(){var e=Array.prototype.slice.call(arguments).join("\n")+"\n";A(function e(n,t){var r,a,o,i=[];for("#"===n.id?t=-1:i.push(Array(2*t+1).join(" ")+n.text),r=0,a=n.children.length;r<a;r++)o=j("jstree","get_node",n.children[r]),i.push(e(o,t+1));return i.join("\n")}(j("jstree","get_node","#"))+"\n",e,"Unexpected jstree state")},assertTreeState:function(e){var n=Array.prototype.slice.call(arguments,1).join("\n")+"\n";A(function e(n,t){var r,a,o,i=[];for(n.isRootNode?t=-1:i.push(Array(2*t+1).join(" ")+n.value.p.nodeID),r=0,a=n.children.length;r<a;r++)o=n.children[r],i.push(e(o,t+1));return i.join("\n")}(e.rootNode,0)+"\n",n,"Unexpected tree state")},addQuestion:function(e,n,t){t=s.Ay.extend({},t),this.prevId&&_(this.prevId);var r=j("addQuestion",e);return n||r.p.nodeID||(n=j("nodeIDFromLabel",r)),n&&(m(s.Ay.isUndefined(t.nodeID),"unexpected attribute for "+e+"["+n+"]"),r.p.labelItext&&r.p.labelItext.set(r.getLabelValue()),r.p.nodeID=n,"Choice"!==e||t.hasOwnProperty("labelItext")||(t.labelItext=n)),s.Ay.each(t,(function(e,n){s.Ay.isBoolean(e)||(e=String(e)),/.+Itext/.test(n)?r.p[n].set(e):r.p[n]=e})),s.Ay.each(j("getSections",r),(function(e){j("collapseSection",e.slug,!1)})),r},paste:function(e,n,t){s.Ay.isString(e)||(e=p.A.tabDelimit([h].concat(e))),t&&window.console.log(e),m.deepEqual(f.A.paste(e),n||[])},clickQuestion:_,selectAll:function(){j("jstree","select_all")},deleteQuestion:function(){var e=s.Ay.map(arguments,(function(e){var n=I(e);return m(n,"mug not found: "+e),n}));j("getData").core.form.removeMugsFromForm(e),s.Ay.each(arguments,(function(e){m(!I(e),"mug not removed: "+e)}))},saveButtonEnabled:function(e){var n=j("getData").core.saveButton;if(!s.Ay.isUndefined(e)){var t=e?"save":"saved";n.setStateWhenReady(t),m.equal(n.state,t,"sanity check failed")}return"save"===n.state},expandGroup:function(e){j("jstree","open_node",e.ufid),j("jstree","redraw_node",e.ufid,!0,!1,!1)},collapseGroup:function(e){j("jstree","close_node",e.ufid),j("jstree","redraw_node",e.ufid,!0,!1,!1)},getMessages:function(e){var n=[],t=null;if(s.Ay.isString(e)){var r=e;e=I(r),m(e,"mug not found: "+r)}return e.messages.each((function(e,r){r!==t&&(n.push(r+":"),t=r),n.push("  - "+e.message)})),n.join("\n")},findNode:function(e,n,t){if(s.Ay.isString(n)){var r=n;n=function(e){return e.text===r}}return function t(r){var a,o,i;if(n(r))return r;for(a=0,o=r.children.length;a<o;a++)if(i=t(e.get_node(r.children[a])))return i;return null}(t||e.get_node("#"))},isTreeNodeValid:function(e){if(s.Ay.isString(e)){var n=e;e=I(n),m(e,"mug not found: "+n)}return 0===d()("#vellum").find("#"+e.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return d()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:v.A.parseXML}}}]);