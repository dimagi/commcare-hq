"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[54],{4054:(t,e,l)=>{var n=l(8324),a=l.n(n),o=l(561),i=l.n(o),u=l(4523),r=l(1134),d=l(9675),s=l(1437),c=l.n(s),x=l(3809),p=l.n(x),m=a().assert,f=r.A.call,h=["Form Builder clip","version 1"];function g(t,e,l){u.Ay.isString(e)||(e=p().tabDelimit([h].concat(e))),r.A.assertEqual(t+"\n",e+"\n",l||"cut or copy mismatch")}function b(t,e,l){u.Ay.isString(t)||(t=p().tabDelimit([h].concat(t))),l&&window.console.log(t),m.deepEqual(c().paste(t),e||[])}describe("The copy-paste plugin",(function(){before((function(t){r.A.init({features:{custom_intents:!0,use_custom_repeat_button_text:!0},javaRosa:{langs:["en","hin"]},core:{onReady:function(){m(this.isPluginEnabled("copyPaste"),"copyPaste plugin should be enabled"),t()}}})})),u.Ay.each([{message:"a text question",xml:'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/8DBFAFCF-D243-464F-8396-3417A69B4D2E" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<txt />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/txt" nodeset="/data/txt" type="xsd:string" constraint="1 = 0" relevant="x = y" jr:constraintMsg="jr:itext(\'txt-constraintMsg\')" required="true()" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="txt-label">\n\t\t\t\t\t\t<value>English Text</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="txt-constraintMsg">\n\t\t\t\t\t\t<value>Nope</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="txt-label">\n\t\t\t\t\t\t<value>Hindi Text</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="txt-constraintMsg">\n\t\t\t\t\t\t<value>Nope</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/txt" ref="/data/txt">\n\t\t\t<label ref="jr:itext(\'txt-label\')" />\n\t\t\t<alert ref="jr:itext(\'txt-constraintMsg\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',serial:p().tabDelimit([h,["id","type","labelItext:en-default","labelItext:hin-default","constraintMsgItext:en-default","constraintMsgItext:hin-default","constraintAttr","constraintMsgAttr","relevantAttr","requiredAttr"],["/txt","Text","English Text","Hindi Text","Nope","Nope","1 = 0","jr:itext('txt-constraintMsg')","x = y","true"]])},{message:"two text questions",xml:'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/3760D84C-832E-48D0-80A8-FC206F09A767" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<text />\n\t\t\t\t\t<choice />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/text" nodeset="/data/text" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/choice" nodeset="/data/choice" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="default-label">\n\t\t\t\t\t\t<value>text with image</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="choice-label">\n\t\t\t\t\t\t<value>Do you like it?</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="choice-true-label">\n\t\t\t\t\t\t<value>Yes</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="choice-false-label">\n\t\t\t\t\t\t<value>No</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="default-label">\n\t\t\t\t\t\t<value>text with image</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="choice-label">\n\t\t\t\t\t\t<value>Do you like it?</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="choice-true-label">\n\t\t\t\t\t\t<value>Yes</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="choice-false-label">\n\t\t\t\t\t\t<value>No</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/text" ref="/data/text">\n\t\t\t<label ref="jr:itext(\'default-label\')" />\n\t\t</input>\n\t\t<select1 vellum:ref="#form/choice" ref="/data/choice">\n\t\t\t<label ref="jr:itext(\'choice-label\')" />\n\t\t\t<item>\n\t\t\t\t<label ref="jr:itext(\'choice-true-label\')" />\n\t\t\t\t<value>true</value>\n\t\t\t</item>\n\t\t\t<item>\n\t\t\t\t<label ref="jr:itext(\'choice-false-label\')" />\n\t\t\t\t<value>false</value>\n\t\t\t</item>\n\t\t</select1>\n\t</h:body>\n</h:html>\n',select:["text","choice"],serial:p().tabDelimit([h,["id","type","labelItext:en-default","labelItext:hin-default","labelItext"],["/text","Text","text with image","text with image","default-label"],["/choice","Select","Do you like it?","Do you like it?","null"],["/choice/true","Choice","Yes","Yes","null"],["/choice/false","Choice","No","No","null"]])},{message:"two choices with shared itext",xml:'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/3760D84C-832E-48D0-80A8-FC206F09A767" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<box />\n\t\t\t\t\t<fox />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/box" nodeset="/data/box" />\n\t\t\t<bind vellum:nodeset="#form/fox" nodeset="/data/fox" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="box-label">\n\t\t\t\t\t\t<value>In a box?</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="yes-label">\n\t\t\t\t\t\t<value>Yes</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="no-label">\n\t\t\t\t\t\t<value>No</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="fox-label">\n\t\t\t\t\t\t<value>With a fox?</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="box-label">\n\t\t\t\t\t\t<value>In a box?</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="yes-label">\n\t\t\t\t\t\t<value>Yes</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="no-label">\n\t\t\t\t\t\t<value>No</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="fox-label">\n\t\t\t\t\t\t<value>With a fox?</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/box" ref="/data/box">\n\t\t\t<label ref="jr:itext(\'box-label\')" />\n\t\t\t<item>\n\t\t\t\t<label ref="jr:itext(\'yes-label\')" />\n\t\t\t\t<value>yes</value>\n\t\t\t</item>\n\t\t\t<item>\n\t\t\t\t<label ref="jr:itext(\'no-label\')" />\n\t\t\t\t<value>no</value>\n\t\t\t</item>\n\t\t</select1>\n\t\t<select1 vellum:ref="#form/fox" ref="/data/fox">\n\t\t\t<label ref="jr:itext(\'fox-label\')" />\n\t\t\t<item>\n\t\t\t\t<label ref="jr:itext(\'yes-label\')" />\n\t\t\t\t<value>yes</value>\n\t\t\t</item>\n\t\t\t<item>\n\t\t\t\t<label ref="jr:itext(\'no-label\')" />\n\t\t\t\t<value>no</value>\n\t\t\t</item>\n\t\t</select1>\n\t</h:body>\n</h:html>\n',select:["box","fox"],serial:p().tabDelimit([h,["id","type","labelItext:en-default","labelItext:hin-default","labelItext"],["/box","Select","In a box?","In a box?","null"],["/box/yes","Choice","Yes","Yes","yes-label"],["/box/no","Choice","No","No","no-label"],["/fox","Select","With a fox?","With a fox?","null"],["/fox/yes","Choice","Yes","Yes","yes-label"],["/fox/no","Choice","No","No","no-label"]])},{message:"a question with many itext forms",xml:'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/ABC48248-64D6-4E47-9473-8C6DB669E9DA" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<text />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/text" nodeset="/data/text" type="xsd:string" constraint="1 = 0" jr:constraintMsg="jr:itext(\'text-constraintMsg\')" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="default-label">\n\t\t\t\t\t\t<value>default</value>\n\t\t\t\t\t\t<value form="audio">jr://file/commcare/audio/data/text.mp3</value>\n\t\t\t\t\t\t<value form="custom">custom</value>\n\t\t\t\t\t\t<value form="image">jr://file/commcare/image/data/text.png</value>\n\t\t\t\t\t\t<value form="long">long</value>\n\t\t\t\t\t\t<value form="short">short</value>\n\t\t\t\t\t\t<value form="video">jr://file/commcare/video/data/text.3gp</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="default-hint">\n\t\t\t\t\t\t<value>hint</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="default-help">\n\t\t\t\t\t\t<value>help</value>\n\t\t\t\t\t\t<value form="audio">jr://file/commcare/audio/help/data/text.mp3</value>\n\t\t\t\t\t\t<value form="image">jr://file/commcare/image/help/data/text.png</value>\n\t\t\t\t\t\t<value form="video">jr://file/commcare/video/help/data/text.3gp</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="text-constraintMsg">\n\t\t\t\t\t\t<value>valid</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="default-label">\n\t\t\t\t\t\t<value>default</value>\n\t\t\t\t\t\t<value form="audio">jr://file/commcare/audio/data/text.mp3</value>\n\t\t\t\t\t\t<value form="custom">custom</value>\n\t\t\t\t\t\t<value form="image">jr://file/commcare/image/data/text.png</value>\n\t\t\t\t\t\t<value form="long">long</value>\n\t\t\t\t\t\t<value form="short">short</value>\n\t\t\t\t\t\t<value form="video">jr://file/commcare/video/data/text.3gp</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="default-hint">\n\t\t\t\t\t\t<value>hint</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="default-help">\n\t\t\t\t\t\t<value>help</value>\n\t\t\t\t\t\t<value form="audio">jr://file/commcare/audio/help/data/text.mp3</value>\n\t\t\t\t\t\t<value form="image">jr://file/commcare/image/help/data/text.png</value>\n\t\t\t\t\t\t<value form="video">jr://file/commcare/video/help/data/text.3gp</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="text-constraintMsg">\n\t\t\t\t\t\t<value>valid</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/text" ref="/data/text">\n\t\t\t<label ref="jr:itext(\'default-label\')" />\n\t\t\t<hint ref="jr:itext(\'default-hint\')">hint label</hint>\n\t\t\t<help ref="jr:itext(\'default-help\')" />\n\t\t\t<alert ref="jr:itext(\'text-constraintMsg\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',serial:p().tabDelimit([h,["id","type","labelItext:en-default","labelItext:hin-default","labelItext:en-audio","labelItext:hin-audio","labelItext:en-custom","labelItext:hin-custom","labelItext:en-image","labelItext:hin-image","labelItext:en-long","labelItext:hin-long","labelItext:en-short","labelItext:hin-short","labelItext:en-video","labelItext:hin-video","labelItext","constraintMsgItext:en-default","constraintMsgItext:hin-default","helpItext:en-default","helpItext:hin-default","helpItext:en-audio","helpItext:hin-audio","helpItext:en-image","helpItext:hin-image","helpItext:en-video","helpItext:hin-video","helpItext","hintItext:en-default","hintItext:hin-default","hintItext","constraintAttr","constraintMsgAttr","hintLabel"],["/text","Text","default","default","jr://file/commcare/audio/data/text.mp3","jr://file/commcare/audio/data/text.mp3","custom","custom","jr://file/commcare/image/data/text.png","jr://file/commcare/image/data/text.png","long","long","short","short","jr://file/commcare/video/data/text.3gp","jr://file/commcare/video/data/text.3gp","default-label","valid","valid","help","help","jr://file/commcare/audio/help/data/text.mp3","jr://file/commcare/audio/help/data/text.mp3","jr://file/commcare/image/help/data/text.png","jr://file/commcare/image/help/data/text.png","jr://file/commcare/video/help/data/text.3gp","jr://file/commcare/video/help/data/text.3gp","default-help","hint","hint","default-hint","1 = 0","jr:itext('text-constraintMsg')","hint label"]])}],(function(t){it("should copy "+t.message,(function(){r.A.loadXML(t.xml),t.select&&r.A.clickQuestion.apply(null,t.select),g(c().copy(),t.serial)})),it("should paste "+t.message,(function(){r.A.loadXML(""),m.deepEqual(c().paste(t.serial),[]),r.A.assertXmlEqual(f("createXML"),t.xml,{normalize_xmlns:!0})}))})),it("should copy two text questions in a group",(function(){r.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/3760D84C-832E-48D0-80A8-FC206F09A767" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<label />\n\t\t\t\t\t<group>\n\t\t\t\t\t\t<text />\n\t\t\t\t\t\t<choice />\n\t\t\t\t\t</group>\n\t\t\t\t\t<likes />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/label" nodeset="/data/label" />\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<bind vellum:nodeset="#form/group/text" nodeset="/data/group/text" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/group/choice" nodeset="/data/group/choice" />\n\t\t\t<bind vellum:nodeset="#form/likes" nodeset="/data/likes" vellum:calculate="if(#form/group/choice = \'true\', 1, 0)" calculate="if(/data/group/choice = \'true\', 1, 0)" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="label-label">\n\t\t\t\t\t\t<value>This is English</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group-label">\n\t\t\t\t\t\t<value>Group</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="text-label">\n\t\t\t\t\t\t<value>text with image</value>\n\t\t\t\t\t\t<value form="image">jr://file/commcare/image/data/en-text.png</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/choice-label">\n\t\t\t\t\t\t<value>Do you like it?</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/choice-true-label">\n\t\t\t\t\t\t<value>Yes</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/choice-false-label">\n\t\t\t\t\t\t<value>No</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t\t<translation lang="hin">\n\t\t\t\t\t<text id="label-label">\n\t\t\t\t\t\t<value>This is Hindi</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group-label">\n\t\t\t\t\t\t<value>Group</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="text-label">\n\t\t\t\t\t\t<value>„Å≤„Çâ„Åå„Å™</value>\n\t\t\t\t\t\t<value form="image">jr://file/commcare/image/data/hin-text.png</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/choice-label">\n\t\t\t\t\t\t<value>Do you like it?</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/choice-true-label">\n\t\t\t\t\t\t<value>Yes</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/choice-false-label">\n\t\t\t\t\t\t<value>No</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<trigger vellum:ref="#form/label" ref="/data/label" appearance="minimal">\n\t\t\t<label ref="jr:itext(\'label-label\')" />\n\t\t</trigger>\n\t\t<group vellum:ref="#form/group" ref="/data/group">\n\t\t\t<label ref="jr:itext(\'group-label\')" />\n\t\t\t<input vellum:ref="#form/group/text" ref="/data/group/text">\n\t\t\t\t<label ref="jr:itext(\'text-label\')" />\n\t\t\t</input>\n\t\t\t<select1 vellum:ref="#form/group/choice" ref="/data/group/choice">\n\t\t\t\t<label ref="jr:itext(\'group/choice-label\')" />\n\t\t\t\t<item>\n\t\t\t\t\t<label ref="jr:itext(\'group/choice-true-label\')" />\n\t\t\t\t\t<value>true</value>\n\t\t\t\t</item>\n\t\t\t\t<item>\n\t\t\t\t\t<label ref="jr:itext(\'group/choice-false-label\')" />\n\t\t\t\t\t<value>false</value>\n\t\t\t\t</item>\n\t\t\t</select1>\n\t\t</group>\n\t</h:body>\n</h:html>\n'),r.A.clickQuestion("group/text","group/choice"),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","labelItext:en-image","labelItext:hin-image","labelItext"],["/group/text","Text","text with image","„Å≤„Çâ„Åå„Å™","jr://file/commcare/image/data/en-text.png","jr://file/commcare/image/data/hin-text.png","text-label"],["/group/choice","Select","Do you like it?","Do you like it?","null","null","null"],["/group/choice/true","Choice","Yes","Yes","null","null","null"],["/group/choice/false","Choice","No","No","null","null","null"]])})),it("should paste two questions with the same id",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text1","text1"],["/text","Text","text2","text2"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text1","text1"],["/copy-1-of-text","Text","text2","text2"]])})),it("should auto-rename pasted question with duplicate id",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text1","text1"]]),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text2","text2"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text1","text1"],["/copy-1-of-text","Text","text2","text2"]])})),it("should copy conflicted question id",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text1","text1"],["/other","Text","text2","text2"]]);var t=r.A.getMug("other");t.p.nodeID="text",m(t.messages.get("nodeID","mug-conflictedNodeId-warning"),"expected confict warning"),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","conflictedNodeId"],["/text","Text","text1","text1","null"],["/copy-1-of-text","Text","text2","text2","text"]])})),it("should paste two questions with the same id (one in group)",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text","text"],["/group","Group","group","group"],["/group/text","Text","text","text"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text","text"],["/group","Group","group","group"],["/group/text","Text","text","text"]])})),it("should paste three groups after text question",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text","text"]]),r.A.clickQuestion("text"),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/group1","Group","group","group"],["/group2","Group","group","group"],["/group3","Group","group","group"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text","text"],["/group1","Group","group","group"],["/group2","Group","group","group"],["/group3","Group","group","group"]])})),it("should paste three groups into group",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/group","Group","group","group"]]),r.A.clickQuestion("group"),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/group1","Group","group","group"],["/group2","Group","group","group"],["/group3","Group","group","group"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/group","Group","group","group"],["/group/group1","Group","group","group"],["/group/group2","Group","group","group"],["/group/group3","Group","group","group"]])})),it("should resolve pasted question with conflicting question ID",(function(){r.A.loadXML(""),b([["id","type","calculateAttr","conflictedNodeId"],["/radius","DataBindOnly",'"42"',"null"],["/copy-1-of-pi","DataBindOnly",'"3.1415"',"pi"],["/circumference","DataBindOnly","2 * #form/copy-1-of-pi * #form/radius","null"]]),r.A.selectAll(),g(c().copy(),[["id","type","calculateAttr"],["/radius","DataBindOnly",'"42"'],["/pi","DataBindOnly",'"3.1415"'],["/circumference","DataBindOnly","2 * #form/pi * #form/radius"]])})),it("should not paste item into tree root",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/select/item","Choice","item1","item1"]],["Cannot insert Choice into tree root"]),r.A.selectAll(),g(c().copy(),"")})),it("should not paste text into select",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/select","Select","select","select"],["/select/item1","Choice","item1","item1"]]),r.A.clickQuestion("select/item1"),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text","text"]],["Cannot insert Text into Multiple Choice"]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/select","Select","select","select"],["/select/item1","Choice","item1","item1"]])})),it("should paste question with empty id",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["","Text","text","text"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/question1","Text","text","text"]])})),it("should paste question with / id",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/","Text","text","text"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/question2","Text","text","text"]])})),it("should not paste item into or after text",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text","text"]]),r.A.selectAll(),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/select/item","Choice","item1","item1"]],["Cannot insert Choice into or after Text"]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","text","text"]])})),it("should not overwrite itext with auto-id",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","auto","auto"]]),r.A.clickQuestion("text"),b([["id","type","labelItext:en-default","labelItext:hin-default","labelItext"],["/text2","Text","non","non","text-label"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","labelItext"],["/text","Text","auto","auto","null"],["/text2","Text","non","non","text-label"]]),f("createXML");var t=r.A.getMug("text"),e=r.A.getMug("text2");m.equal(t.p.labelItext.autoId,!0),m.equal(t.p.labelItext.id,"text-label"),m.equal(t.p.labelItext.get(),"auto"),m.equal(e.p.labelItext.autoId,!1),m.equal(e.p.labelItext.id,"text-label2"),m.equal(e.p.labelItext.get(),"non")})),it("should not fill empty itext forms",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default"],["/text1","Text","Label"],["/text2","Text",""],["/text3","Text","null"],["/text4","Text"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text1","Text","Label","Label"],["/text2","Text","null","null"],["/text3","Text","null","null"],["/text4","Text","null","null"]])})),it("should not fill empty default itext forms",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","","Label"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","","Label"]])})),it("should not paste defaults into empty itext items",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default","constraintMsgItext:en-default","constraintMsgItext:hin-default","constraintAttr"],["/text1","Text","text1","text1","validate","validate","x = y"],["/text2","Text","text2","text2","null","null","null"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","constraintMsgItext:en-default","constraintMsgItext:hin-default","constraintAttr"],["/text1","Text","text1","text1","validate","validate","x = y"],["/text2","Text","text2","text2","null","null","null"]])})),it("should not paste empty itext media forms",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default","labelItext:en-image","labelItext:hin-image"],["/text1","Text","text1","text1","jr://...","jr://..."],["/text2","Text","text2","text2","null","null"]]),r.A.clickQuestion("text1");var t=i()(".fd-mm-upload-container:visible");m(t.length,"text1 media uploader should be visible"),r.A.clickQuestion("text2"),t=i()(".fd-mm-upload-container:visible"),m.equal(t.length,0,"text2 media uploader should be hidden"),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","labelItext:en-image","labelItext:hin-image"],["/text1","Text","text1","text1","jr://...","jr://..."],["/text2","Text","text2","text2","null","null"]])})),it("should ignore extra cells in header row",(function(){r.A.loadXML(""),b(p().tabDelimit([h.concat(["",""]),["id","type","labelItext:en-default","labelItext"],["/text1","Text","text","text-id"]])),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","labelItext"],["/text1","Text","text","text","text-id"]])})),it("should ignore empty itext ID",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext"],["/text1","Text","text"],["/text2","Text"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text1","Text","text","text"],["/text2","Text","null","null"]])})),it("should remove questions on cut",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext"],["/text1","Text","text","text-id"]]),r.A.selectAll(),g(c().cut(),[["id","type","labelItext:en-default","labelItext:hin-default","labelItext"],["/text1","Text","text","text","text-id"]]),r.A.selectAll(),g(c().cut(),"")})),it("should copy dynamic select with itemset data",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","itemsetData"],["/select","SelectDynamic","select",'[{"instance":null,"nodeset":"/items","labelRef":"@name","valueRef":"@id"}]']]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","itemsetData"],["/select","SelectDynamic","select","select",'[{"instance":null,"nodeset":"/items","labelRef":"@name","valueRef":"@id"}]']])})),it("should not cut itemset (External Data)",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","itemsetData"],["/select","SelectDynamic","select",'[{"instance":null,"nodeset":"/items","labelRef":"@name","valueRef":"@id"}]']]),r.A.clickQuestion("select/itemset"),g(c().cut(),""),m(r.A.getMug("select/itemset"),"itemset should not be cut")})),it("should copy dynamic select with itemset data and instance",(function(){var t=[["id","type","labelItext:en-default","labelItext:hin-default","instances","itemsetData"],["/select","SelectDynamic","select","select",'{"foo":{"src":"jr://foo"}}','[{"instance":{"id":"foo","src":"jr://foo"},"nodeset":"instance(\'foo\')/foo/items","labelRef":"@name","valueRef":"@id"}]']];r.A.loadXML(""),b(t),r.A.selectAll(),g(c().copy(),t)})),it("should copy dynamic select with itemset data and filter",(function(){var t=[["id","type","labelItext:en-default","labelItext:hin-default","filter","instances","itemsetData"],["/select","SelectDynamic","select","select","[\"type = instance('fum')/fum/@type\"]",'{"foo":{"src":"jr://foo"},"fum":{"src":"jr://fum"}}','[{"instance":{"id":"foo","src":"jr://foo"},"nodeset":"instance(\'foo\')/foo/items","labelRef":"@name","valueRef":"@id"}]']];r.A.loadXML(""),b(t),r.A.selectAll(),g(c().copy(),t)})),it("should show validation errors in tree after paste",(function(){r.A.loadXML(""),b([["id","type","calculateAttr"],["/two","DataBindOnly","2"],["/double_trouble","DataBindOnly","/data/two * /data/trouble"]]),m(r.A.isTreeNodeValid("two"),r.A.getMessages("two")),m(!r.A.isTreeNodeValid("double_trouble"),"double_trouble should not be valid")})),it("should show warning on paste missing multimedia",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-audio"],["/text","Text","jr://file/commcare/audio/data/question1.mp3"]]);var t=r.A.getMug("text");m(t.messages.get("labelItext","missing-multimedia-warning"),"text should have missing-multimedia-warning")})),it("should copy questions in tree order",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default"],["/text1","Text","text1"],["/text2","Text","text2"],["/text3","Text","text3"],["/group","Group","group"],["/group/text1","Text","text1"],["/group/text2","Text","text2"],["/group/text3","Text","text3"]]),r.A.clickQuestion("text3","group/text2","group/text1","text1"),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text1","Text","text1","text1"],["/text3","Text","text3","text3"],["/group/text1","Text","text1","text1"],["/group/text2","Text","text2","text2"]])})),it("should paste questions in tree order",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default"],["/question1","Text","question1","question1"],["/question2","Select","question2","question2"],["/question2/item1","Choice","item1","item1"],["/question2/item2","Choice","item2","item2"],["/question3","Int","question3","question3"],["/question4","Date","question4","question4"],["/question5","DataBindOnly","null","null"]]),r.A.clickQuestion("question1","question2","question3","question4","question5"),c().paste(c().copy()),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/question1","Text","question1","question1"],["/question2","Select","question2","question2"],["/question2/item1","Choice","item1","item1"],["/question2/item2","Choice","item2","item2"],["/question3","Int","question3","question3"],["/question4","Date","question4","question4"],["/question5","DataBindOnly","null","null"],["/copy-1-of-question1","Text","question1","question1"],["/copy-1-of-question2","Select","question2","question2"],["/copy-1-of-question2/item1","Choice","item1","item1"],["/copy-1-of-question2/item2","Choice","item2","item2"],["/copy-1-of-question3","Int","question3","question3"],["/copy-1-of-question4","Date","question4","question4"],["/copy-1-of-question5","DataBindOnly","null","null"]])})),it("should warn about discarded languages",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:es-default","labelItext:fr-default"],["/text","Text","english","spanish","french"]],["Discarded languages: es, fr"]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default"],["/text","Text","english","english"]]),m(r.A.isTreeNodeValid("text"),r.A.getMessages("text"))})),it("should paste and copy a model iteration repeat group",(function(){var t=[["id","type","labelItext:en-default","labelItext:hin-default","addCaptionItext:en-default","addCaptionItext:hin-default","addEmptyCaptionItext:en-default","addEmptyCaptionItext:hin-default","dataSource","instances"],["/repeat/item","Repeat","repeat","repeat","add another","add another","add new","add new",'{"idsQuery":"instance(\'products\')/products/product/@id"}','{"products":{"src":"jr://commtrack:products"}}']];r.A.loadXML(""),b(t),r.A.selectAll(),g(c().copy(),t),m(r.A.isTreeNodeValid("repeat/item"),r.A.getMessages("repeat/item"))})),it("should paste (legacy format) and copy a model iteration repeat group",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default","dataSource"],["/repeat/item","Repeat","repeat","repeat",'{"instance":{"id":"products","src":"jr://commtrack:products"},"idsQuery":"instance(\'products\')/products/product/@id"}']]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","dataSource","instances"],["/repeat/item","Repeat","repeat","repeat",'{"idsQuery":"instance(\'products\')/products/product/@id"}','{"products":{"src":"jr://commtrack:products"}}']]),m(r.A.isTreeNodeValid("repeat/item"),r.A.getMessages("repeat/item"))})),it("should paste and copy an Android App Callout",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default","intentXmlns","androidIntentAppId","androidIntentExtra","androidIntentResponse","unknownAttributes"],["/app","AndroidIntent","app","app","commcare.org/xforms","app-id",JSON.stringify({key1:"val1",key2:"val2"}),JSON.stringify({key3:"val3"}),JSON.stringify({type:"robin"})]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","androidIntentAppId","androidIntentExtra","androidIntentResponse","intentXmlns","unknownAttributes"],["/app","AndroidIntent","app","app","app-id",JSON.stringify({key1:"val1",key2:"val2"}),JSON.stringify({key3:"val3"}),"commcare.org/xforms",JSON.stringify({type:"robin"})]])})),it("should paste and copy an Android App Callout (old format)",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default","intent"],["/app","AndroidIntent","app","app",JSON.stringify({path:"app-id",xmlns:"commcare.org/xforms",extra:{key1:"val1",key2:"val2"},response:{key3:"val3"},unknownAttributes:{type:"robin"}})]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","androidIntentAppId","androidIntentExtra","androidIntentResponse","intentXmlns","unknownAttributes"],["/app","AndroidIntent","app","app","app-id",JSON.stringify({key1:"val1",key2:"val2"}),JSON.stringify({key3:"val3"}),"commcare.org/xforms",JSON.stringify({type:"robin"})]])})),it("should paste and copy a Balance",(function(){r.A.loadXML(""),b([["id","type","date","entityId","entryId","quantity","sectionId"],["/bal","Balance","now()","case","product","qty","/balance-id"]]),r.A.loadXML(f("createXML")),r.A.selectAll(),g(c().copy(),[["id","type","date","entityId","entryId","quantity","rawDataAttributes","sectionId"],["/bal","Balance","now()","case","product","qty",'{"entity-id":"","date":""}',"/balance-id"]]);var t="balance[@type='bal']";m(r.A.isTreeNodeValid(t),r.A.getMessages(t))})),it("should paste and copy a Transfer",(function(){r.A.loadXML(""),b([["id","type","date","dest","entryId","quantity","sectionId","src"],["/tx","Transfer","now()","dst","product","qty","/balance","src"]]),r.A.loadXML(f("createXML")),r.A.selectAll(),g(c().copy(),[["id","type","date","dest","entryId","quantity","rawDataAttributes","sectionId","src"],["/tx","Transfer","now()","dst","product","qty",'{"date":"","src":"","dest":""}',"/balance","src"]]);var t="transfer[@type='tx']";m(r.A.isTreeNodeValid(t),r.A.getMessages(t))})),it("should not overwrite manually typed question ID with copy-N-of-...",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default"],["/text","Text","text"],["/text","Text","text"]]);var t=i()("[name=property-nodeID]");t.val("other").change(),m.equal(t.val(),"other")})),it("should paste markdown correctly",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hasMarkdown"],["/text","Text","*text*",!0],["/text2","Text","text2",!1]]),r.A.clickQuestion("text"),m(r.A.markdownVisible()),r.A.clickQuestion("text2"),m(!r.A.markdownVisible())})),it("should paste invalid xpaths correctly",(function(t){r.A.loadXML(""),b([["id","type","calculateAttr"],["/invalid","DataBindOnly","(42"],["/invalid2","DataBindOnly","#invalid/xpath (42"],["/invalid3","DataBindOnly","#invalid/xpath (#form/invalid"]]),r.A.clickQuestion("invalid"),r.A.clickQuestion("invalid2");var e=r.A.getMug("invalid"),l=r.A.getMug("invalid2"),n=r.A.getMug("invalid3");m.strictEqual(e.p.calculateAttr,"#invalid/xpath (42"),m.strictEqual(l.p.calculateAttr,"#invalid/xpath (42"),m.strictEqual(n.p.calculateAttr,"#invalid/xpath (#form/invalid");var a=r.A.getWidget("property-calculateAttr");a.input.promise.then((function(){m.strictEqual(a.getValue(),"(42"),r.A.selectAll(),g(c().copy(),[["id","type","calculateAttr"],["/invalid","DataBindOnly","#invalid/xpath (42"],["/invalid2","DataBindOnly","#invalid/xpath (42"],["/invalid3","DataBindOnly","#invalid/xpath (#form/invalid"]]),t()}))})),it("should paste valid xpaths correctly",(function(t){r.A.loadXML(""),b([["id","type","calculateAttr"],["/invalid","DataBindOnly","(42"],["/valid","DataBindOnly","#form/invalid"]]),r.A.clickQuestion("valid");var e=r.A.getMug("invalid"),l=r.A.getMug("valid");m.strictEqual(e.p.calculateAttr,"#invalid/xpath (42"),m.strictEqual(l.p.calculateAttr,"#form/invalid");var n=r.A.getWidget("property-calculateAttr");n.input.promise.then((function(){m.strictEqual(n.getValue(),"#form/invalid"),m.strictEqual(i()("[name=property-calculateAttr]").find("span.label").data("value"),"#form/invalid"),r.A.selectAll(),g(c().copy(),[["id","type","calculateAttr"],["/invalid","DataBindOnly","#invalid/xpath (42"],["/valid","DataBindOnly","#form/invalid"]]),t()}))})),it("should not add calculate condition to text node on paste",(function(){r.A.loadXML(""),b([["id","type","calculateAttr"],["/group","Group","null"],["/group/hidden","DataBindOnly","1"],["/group/text","Text","null"]]);var t=r.A.getMug("group/text");m(!t.isVisible("calculateAttr"),"calculateAttr should not be visible")})),it("should maintain reference to pasted question",(function(){r.A.loadXML(""),b([["id","type","calculateAttr"],["/group","Group","null"],["/group/number","Int","null"],["/group/hidden","DataBindOnly","#form/group/number + 1"],["/text","Text","null"]]),b([["id","type","calculateAttr"],["/group","Group","null"],["/group/number","Int","null"],["/group/hidden","DataBindOnly","#form/group/number + 1"]]),r.A.selectAll(),g(c().copy(),[["id","type","calculateAttr"],["/group","Group","null"],["/group/number","Int","null"],["/group/hidden","DataBindOnly","#form/group/number + 1"],["/text","Text","null"],["/copy-1-of-group","Group","null"],["/copy-1-of-group/number","Int","null"],["/copy-1-of-group/hidden","DataBindOnly","#form/copy-1-of-group/number + 1"]])})),it("should maintain reference to question pasted in group",(function(){r.A.loadXML(""),b([["id","type","calculateAttr"],["/one","Int","null"],["/two","Int","null"],["/hidden","DataBindOnly","#form/one + #form/two + 1"],["/sub","Group","null"]]),b([["id","type","calculateAttr"],["/two","Int","null"],["/hidden","DataBindOnly","#form/one + #form/two + 1"]]),r.A.selectAll(),g(c().copy(),[["id","type","calculateAttr"],["/one","Int","null"],["/two","Int","null"],["/hidden","DataBindOnly","#form/one + #form/two + 1"],["/sub","Group","null"],["/sub/two","Int","null"],["/sub/hidden","DataBindOnly","#form/one + #form/sub/two + 1"]])})),it("should maintain reference to question referenced by itemset",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","itemsetData"],["/items","DataBindOnly","null","null"],["/select","SelectDynamic","select",'[{"instance":null,"nodeset":"#form/items","labelRef":"@name","valueRef":"@id"}]'],["/sub","Group","null","null"]]),b([["id","type","labelItext:en-default","itemsetData"],["/items","DataBindOnly","null","null"],["/select","SelectDynamic","select",'[{"instance":null,"nodeset":"#form/items","labelRef":"@name","valueRef":"@id"}]']]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","itemsetData"],["/items","DataBindOnly","null","null","null"],["/select","SelectDynamic","select","select",'[{"instance":null,"nodeset":"#form/items","labelRef":"@name","valueRef":"@id"}]'],["/sub","Group","null","null","null"],["/sub/items","DataBindOnly","null","null","null"],["/sub/select","SelectDynamic","select","select",'[{"instance":null,"nodeset":"#form/sub/items","labelRef":"@name","valueRef":"@id"}]']])})),it("should maintain reference to question referenced by model iteration",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","labelItext:hin-default","dataSource"],["/ids","DataBindOnly","null","null","null"],["/repeat/item","Repeat","repeat","repeat",'{"idsQuery":"#form/ids"}'],["/sub","Group","null","null","null"]]),b([["id","type","labelItext:en-default","labelItext:hin-default","dataSource"],["/ids","DataBindOnly","null","null","null"],["/repeat/item","Repeat","repeat","repeat",'{"idsQuery":"#form/ids"}']]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","dataSource"],["/ids","DataBindOnly","null","null","null"],["/repeat/item","Repeat","repeat","repeat",'{"idsQuery":"#form/ids"}'],["/sub","Group","null","null","null"],["/sub/ids","DataBindOnly","null","null","null"],["/sub/repeat/item","Repeat","repeat","repeat",'{"idsQuery":"#form/sub/ids"}']])})),it("should maintain reference in output value",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-default","appearance"],["/name","Text","Name","null"],["/label","Trigger",'<output value="#form/name" />',"minimal"],["/sub","Group","null"]]),b([["id","type","labelItext:en-default","appearance"],["/name","Text","Name","null"],["/label","Trigger",'<output value="#form/name" />',"minimal"]]),r.A.selectAll(),g(c().copy(),[["id","type","labelItext:en-default","labelItext:hin-default","appearance"],["/name","Text","Name","Name","null"],["/label","Trigger",'<output value="#form/name" />','<output value="#form/name" />',"minimal"],["/sub","Group","null","null","null"],["/sub/name","Text","Name","Name","null"],["/sub/label","Trigger",'<output value="#form/sub/name" />','<output value="#form/sub/name" />',"minimal"]])})),describe("with instances without src",(function(){before((function(t){r.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){m(this.isPluginEnabled("copyPaste"),"copyPaste plugin should be enabled"),t()}}})}));var t=[["id","type","labelItext:en-default","appearance","calculateAttr","instances"],["/score","Int","What was your score","null","null","null"],["/output","DataBindOnly","null","null","instance('scores')/score[@high > #form/score][@low < #form/score]",'{"scores":{"children":"<score low=\\"0.0\\" high=\\"500.0\\">You\'re really bad</score><score low=\\"500.0\\" high=\\"99999999.0\\">You\'re really good</score>"}}'],["/result","Trigger",'<output value="#form/output" />',"minimal","null","null"]];it("should properly paste",(function(){r.A.loadXML(""),b(t),r.A.assertXmlEqual(f("createXML"),d,{normalize_xmlns:!0})})),it("should properly copy",(function(){r.A.loadXML(d),r.A.selectAll(),g(c().copy(),t)}))})),describe("with multimedia",(function(){before((function(t){r.A.init({javaRosa:{langs:["en","hin"]},uploader:{objectMap:{"jr://file/commcare/audio/data/question1.mp3":!0}},core:{onReady:function(){m(this.isPluginEnabled("copyPaste"),"copyPaste plugin should be enabled"),t()}}})})),it("should not show warning on paste existing multimedia",(function(){r.A.loadXML(""),b([["id","type","labelItext:en-audio"],["/text","Text","jr://file/commcare/audio/data/question1.mp3"]]);var t=r.A.getMessages("text");m(!t,t)}))}))})),describe("The copy-paste string conversions should",(function(){function t(t,e){var l=JSON.stringify(t),n=JSON.stringify(e);it("stringify("+l+") -> "+n,(function(){m.deepEqual(c().stringify(t),e)})),it(" valuify("+n+") -> "+l,(function(){m.deepEqual(c().valuify(e),t)}))}t(null,"null"),t(!0,"true"),t(!1,"false"),t("null",'"null"'),t("true",'"true"'),t("false",'"false"'),t([],"[]"),t({},"{}"),t("",""),t("x","x"),t('"','"'),t("[\n]",'"[\\n]"'),t("{\n}",'"{\\n}"'),t('"\n"','"\\"\\n\\""'),t(0,"0"),t(1,"1"),t(350,"350"),t(.5,"0.5"),t(-1.2e-10,"-1.2e-10"),t("0",'"0"'),t("1",'"1"'),t("350",'"350"'),t("0.5",'"0.5"'),t("-1.2e-10",'"-1.2e-10"'),function(e){t(e,e)}(),t("{1} ","{1} "),t("{1} {2}",'"{1} {2}"'),t("[1] [2]",'"[1] [2]"'),t("01",'"01"')}))},1134:(t,e,l)=>{l.d(e,{A:()=>k});var n=l(8449),a=l(8324),o=l.n(a),i=l(6848),u=l.n(i),r=l(3794),d=l.n(r),s=l(4523),c=l(561),x=l.n(c),p=l(1437),m=l.n(p),f=l(3809),h=l.n(f),g=l(705),b=l.n(g),v=l(7229),y=l.n(v),A=(l(1460),l(8803),o().assert),I=["Form Builder clip","version 1"];function w(t,e,l){if((l=s.Ay.defaults(l||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var n=y().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+n+'"')}var a,o,i,r,d=(a=t,o=e,i=u().xml(a),r=u().xml(o),u().isEquivalent(i,r,{element_order:!0}));l.not&&(d=!d),d||q(t=j(t),e=j(e),"XML "+(l.not?"should not be equivalent":"mismatch"))}function q(t,e,l){if(t!==e){var n=d().createPatch("",t,e,"actual","expected");n=n.replace(/^Index:/,l||"Not equal:"),A(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(n))}}function j(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function M(t){return D("getCurrentMugInput",t)}function T(t){var e=x()("#vellum").vellum("get"),l=s.Ay.isString(t)?x()("[name="+t+"]"):t;return b().util.getWidget(l,e)}function D(){var t=Array.prototype.slice.call(arguments),e=x()("#vellum");return e.vellum.apply(e,t)}function L(){var t=[],e=s.Ay.map(arguments,(function(e){var l=s.Ay.isString(e)?X(e):e;if(!l||!l.ufid)throw new Error("mug not found: "+e);return t.push(l),l.ufid}));return D("jstree","deselect_all",!0),D("jstree","select_node",e),x()(".collapse-toggle.collapsed").click(),t}function X(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=D("getMugByPath",t);if(!e){var l=t.split("/"),n=D("getMugByPath",l.slice(0,-1).join("/"));if(n&&n.__className.indexOf("Select")>-1){var a=D("getData").core.form.getChildren(n),o=l[l.length-1];if(1===a.length&&"itemset"===o&&"itemset"===a[0].options.tagName)return a[0];for(var i=0;i<a.length;i++)if(a[i].p.nodeID===o)return a[i]}}return e}A.equal=A.strictEqual,A.notEqual=A.notStrictEqual;const k={options:n.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=x().extend(!0,{},n.A.options,t),l=x().fn.animate;x().fn.animate=function(t,e,n,a){l.apply(this,[t,0,n,a])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=s.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&s.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var a=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,a(t)};var o=x()("#vellum"),i=o.vellum("get");i&&(i.destroy(),x()("body > div.modal, body > div.modal-backdrop").remove()),o.empty().vellum(e)},call:D,loadXML:function(t,e,l,n){var a=[],o=D("getData");return n||window.history.replaceState(null,null," "),o.core.parseWarnings=[],D("loadXML",t,e||{}),l?s.Ay.isRegExp(l)&&(a=s.Ay.filter(o.core.parseWarnings,(function(t){return!l.test(t)}))):a=o.core.parseWarnings,A(!a.length,"unexpected parse warnings:\n- "+a.join("\n- ")),delete o.core.parseWarnings,o.core.form},saveAndReload:function(t){D("loadXFormOrError",D("createXML"),t)},getMug:X,getInput:M,getWidget:T,getMediaUploader:function(t){var e,l={},n=T(t);if(!n)throw new Error("media uploader widget not found");if(s.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(l){return(e=t.closest(l)).length})),!e)throw new Error("media uploader element not found");return l.upload=function(t){var l={ref:{path:n.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",l)},l},assertEqual:q,assertInputCount:function(t,e,l){s.Ay.isString(t)?(l=" for "+(l?l+" ":"")+t,t=M(t)):l=l?" for "+l:"",A.equal(t.length,e,"wrong number of inputs"+l)},assertXmlEqual:w,assertXmlNotEqual:function(t,e,l){(l=l||{}).not=!0,w(t,e,l)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";q(function t(e,l){var n,a,o,i=[];for("#"===e.id?l=-1:i.push(Array(2*l+1).join(" ")+e.text),n=0,a=e.children.length;n<a;n++)o=D("jstree","get_node",e.children[n]),i.push(t(o,l+1));return i.join("\n")}(D("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";q(function t(e,l){var n,a,o,i=[];for(e.isRootNode?l=-1:i.push(Array(2*l+1).join(" ")+e.value.p.nodeID),n=0,a=e.children.length;n<a;n++)o=e.children[n],i.push(t(o,l+1));return i.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,l){l=s.Ay.extend({},l),this.prevId&&L(this.prevId);var n=D("addQuestion",t);return e||n.p.nodeID||(e=D("nodeIDFromLabel",n)),e&&(A(s.Ay.isUndefined(l.nodeID),"unexpected attribute for "+t+"["+e+"]"),n.p.labelItext&&n.p.labelItext.set(n.getLabelValue()),n.p.nodeID=e,"Choice"!==t||l.hasOwnProperty("labelItext")||(l.labelItext=e)),s.Ay.each(l,(function(t,e){s.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?n.p[e].set(t):n.p[e]=t})),s.Ay.each(D("getSections",n),(function(t){D("collapseSection",t.slug,!1)})),n},paste:function(t,e,l){s.Ay.isString(t)||(t=h().tabDelimit([I].concat(t))),l&&window.console.log(t),A.deepEqual(m().paste(t),e||[])},clickQuestion:L,selectAll:function(){D("jstree","select_all")},deleteQuestion:function(){var t=s.Ay.map(arguments,(function(t){var e=X(t);return A(e,"mug not found: "+t),e}));D("getData").core.form.removeMugsFromForm(t),s.Ay.each(arguments,(function(t){A(!X(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=D("getData").core.saveButton;if(!s.Ay.isUndefined(t)){var l=t?"save":"saved";e.setStateWhenReady(l),A.equal(e.state,l,"sanity check failed")}return"save"===e.state},expandGroup:function(t){D("jstree","open_node",t.ufid),D("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){D("jstree","close_node",t.ufid),D("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],l=null;if(s.Ay.isString(t)){var n=t;t=X(n),A(t,"mug not found: "+n)}return t.messages.each((function(t,n){n!==l&&(e.push(n+":"),l=n),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,l){if(s.Ay.isString(e)){var n=e;e=function(t){return t.text===n}}return function l(n){var a,o,i;if(e(n))return n;for(a=0,o=n.children.length;a<o;a++)if(i=l(t.get_node(n.children[a])))return i;return null}(l||t.get_node("#"))},isTreeNodeValid:function(t){if(s.Ay.isString(t)){var e=t;t=X(e),A(t,"mug not found: "+e)}return 0===x()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return x()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:y().parseXML}},9675:t=>{t.exports='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/C1D14B65-7FA3-4A88-B5C6-217B6DBB3BB2" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<score />\n\t\t\t\t\t<output />\n\t\t\t\t\t<result />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance id="scores">\n\t\t\t\t<score low="0.0" high="500.0">You\'re really bad</score>\n\t\t\t\t<score low="500.0" high="99999999.0">You\'re really good</score>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/score" nodeset="/data/score" type="xsd:int" />\n\t\t\t<bind vellum:nodeset="#form/output" nodeset="/data/output" vellum:calculate="instance(\'scores\')/score[@high &gt; #form/score][@low &lt; #form/score]" calculate="instance(\'scores\')/score[@high &gt; /data/score][@low &lt; /data/score]" />\n\t\t\t<bind vellum:nodeset="#form/result" nodeset="/data/result" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="score-label">\n\t\t\t\t\t\t<value>What was your score</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="result-label">\n\t\t\t\t\t\t<value><output vellum:value="#form/output" value="/data/output" /></value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/score" ref="/data/score">\n\t\t\t<label ref="jr:itext(\'score-label\')" />\n\t\t</input>\n\t\t<trigger vellum:ref="#form/result" ref="/data/result" appearance="minimal">\n\t\t\t<label ref="jr:itext(\'result-label\')" />\n\t\t</trigger>\n\t</h:body>\n</h:html>\n'}}]);