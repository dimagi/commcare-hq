(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[428],{9848:(e,t,n)=>{var a=n(561),i={init:function(e){var t={disabled:!1,csrftoken:e.csrftoken,$save:a("<span/>").text(i.message.SAVE).click((function(e){t.fire("save",e)})).addClass("btn btn-info"),$retry:a("<span/>").text(i.message.RETRY).click((function(e){t.fire("save",e)})).addClass("btn btn-info"),$saving:a("<span/>").text(i.message.SAVING).prepend('<i class="fa fa-refresh icon-spin"></i> ').addClass("btn btn-info disabled"),$saved:a("<span/>").text(i.message.SAVED).addClass("btn btn-info disabled"),ui:a("<div/>").addClass("pull-right"),setStateWhenReady:function(e){"saving"===this.state?this.nextState=e:this.setState(e)},setState:function(e){this.state!==e&&(this.state=e,this.$save.detach(),this.$saving.detach(),this.$saved.detach(),this.$retry.detach(),"save"===e?this.ui.append(this.$save):"saving"===e?this.ui.append(this.$saving):"saved"===e?this.ui.append(this.$saved):"retry"===e&&this.ui.append(this.$retry),this.fire("state:change"))},ajaxOptions:function(e){var t=(e=e||{}).beforeSend||function(){},n=e.success||function(){},a=e.error||function(){},r=this;return e.beforeSend=function(e){r.csrftoken&&!this.crossDomain&&e.setRequestHeader("X-CSRFToken",r.csrftoken),r.setState("saving"),r.nextState="saved",t.apply(this,arguments)},e.success=function(e){r.setState(r.nextState),n.apply(this,arguments)},e.error=function(e){r.nextState=null,r.setState("retry"),alert(i.message.ERROR_SAVING),a.apply(this,arguments)},e},ajax:function(e){if("function"==typeof(e=t.ajaxOptions(e)).url){e.beforeSend();var n=e.url(e.data);e.success(n||{})}else a.ajax(e)},beforeunload:function(){var n="html"==t.ui.parents()[t.ui.parents().length-1].tagName.toLowerCase();if("saved"!==t.state&&n)return e.unsavedMessage||""}};return r(t),t.setState("saved"),t.on("change",(function(){this.setStateWhenReady("save")})),t.on("disable",(function(){this.disabled=!0,this.$save.addClass("disabled"),this.$saving.addClass("disabled"),this.$retry.addClass("disabled")})),t.on("enable",(function(){this.disabled=!1,this.$save.removeClass("disabled"),this.$saving.removeClass("disabled"),this.$retry.removeClass("disabled")})),t.on("save",(function(n){if(!t.disabled)if(e.save)e.save(n);else if(e.saveRequest){var a=t.ajaxOptions();a.beforeSend(),e.saveRequest(n).success(a.success).error(a.error)}})),t},initForm:function(e,t){var n=e.attr("action"),a=i.init({unsavedMessage:t.unsavedMessage,save:function(){a.ajax({url:n,type:"POST",dataType:"json",data:e.serialize(),success:t.success})}}),r=function(){a.fire("change")};return e.find("*").change(r),e.find("input, textarea").bind("textchange",r),a},message:{SAVE:"Save",SAVING:"Saving",SAVED:"Saved",RETRY:"Try Again",ERROR_SAVING:"There was an error saving"}},r=function(e){"use strict";var t={};return e.on=function(n,a){return void 0===t[n]&&(t[n]=[]),t[n].push(a),e},e.fire=function(n,a){var i;if(void 0!==t[n])for(i=0;i<t[n].length;i+=1)t[n][i].apply(e,[a]);return e},e};t.init=i.init},5311:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(1601),i=n.n(a),r=n(6314),o=n.n(r)()(i());o.push([e.id,'.clearfix {\n  *zoom: 1;\n}\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: "";\n  line-height: 0;\n}\n.clearfix:after {\n  clear: both;\n}\n.hide-text {\n  font: 0/0 a;\n  color: transparent;\n  text-shadow: none;\n  background-color: transparent;\n  border: 0;\n}\n.input-block-level {\n  display: block;\n  width: 100%;\n  min-height: 30px;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n}\n.atwho-view ul {\n  overflow: hidden;\n}\n.atwho-jrtext {\n  padding-left: 1em;\n  color: gray;\n}\n.cur > .atwho-jrtext {\n  padding-left: 1em;\n  color: white;\n}\n.dropdown-menu a > i {\n  display: inline-block;\n  width: 16px;\n}\n.checklist i.fa-check {\n  display: none;\n  width: auto;\n}\n.checklist .selected i.fa-check {\n  display: inline-block;\n  margin-left: -14px;\n  margin-right: 2px;\n}\n.dropdown-submenu {\n  position: relative;\n}\n.dropdown-submenu > a:after {\n  display: block;\n  content: " ";\n  float: right;\n  width: 0;\n  height: 0;\n  border-color: transparent transparent transparent #ccc;\n  border-style: solid;\n  border-width: 5px 0 5px 5px;\n  margin-top: 5px;\n  margin-right: -10px;\n}\n.dropdown-submenu > .dropdown-menu {\n  top: 0;\n  left: 100%;\n  margin-top: -6px;\n  margin-left: -1px;\n  border-radius: 0 6px 6px 6px;\n}\n.dropdown-submenu:hover > .dropdown-menu {\n  display: block;\n}\n.dropdown-submenu:hover > a:after {\n  border-left-color: #fff;\n}\n.fd-input {\n  -moz-appearance: textfield;\n  -webkit-appearance: textfield;\n  border: 1px solid #cccccc;\n  border-radius: 4px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -webkit-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -moz-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -o-transition: border linear 0.2s, box-shadow linear 0.2s;\n  transition: border linear 0.2s, box-shadow linear 0.2s;\n  height: 28px;\n  padding: 6px 12px;\n  font-size: 12px;\n  background: #ffffff;\n  vertical-align: middle;\n  color: #555555;\n  white-space: nowrap;\n  overflow: hidden;\n}\n.fd-input:focus {\n  border-color: rgba(82, 168, 236, 0.8);\n  outline: 0;\n  outline: thin dotted \\9;\n  /* IE6-9 */\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n}\n.fd-textarea {\n  -moz-appearance: textfield;\n  -webkit-appearance: textfield;\n  border: 1px solid #cccccc;\n  border-radius: 4px;\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\n  -webkit-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -moz-transition: border linear 0.2s, box-shadow linear 0.2s;\n  -o-transition: border linear 0.2s, box-shadow linear 0.2s;\n  transition: border linear 0.2s, box-shadow linear 0.2s;\n  height: 28px;\n  padding: 6px 12px;\n  font-size: 12px;\n  background: #ffffff;\n  vertical-align: middle;\n  color: #555555;\n  white-space: nowrap;\n  overflow: hidden;\n  -moz-appearance: textfield-multiline;\n  min-height: 4em;\n  height: 4.5em;\n  overflow: auto;\n  resize: both;\n  white-space: normal;\n  word-break: break-word;\n}\n.fd-textarea:focus {\n  border-color: rgba(82, 168, 236, 0.8);\n  outline: 0;\n  outline: thin dotted \\9;\n  /* IE6-9 */\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n  box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\n}\n.fd-textarea.fd-xpath-editor-text {\n  height: 13em;\n  font-family: monospace;\n}\n.fd-search {\n  background-color: #f2f2f1;\n  margin-bottom: 5px;\n}\n.fd-search > .form-inline {\n  position: relative;\n  padding: 0px 12px;\n}\n.fd-search > .form-inline i {\n  line-height: 42px;\n}\n.fd-search .control-label {\n  padding-top: 0px;\n}\n.fd-search .fd-search-control {\n  position: absolute;\n  top: 5px;\n  margin-left: 18px;\n  width: 100%;\n}\n.fd-commander {\n  background-color: #f2f2f1;\n  padding: 5px;\n  display: flex;\n  align-items: center;\n}\n.fd-commander input {\n  border: 1px solid #d6d6d4;\n  height: 19px;\n  width: calc(100% - 15px);\n}\n.fd-commander .fd-commander-close {\n  background: none;\n  border: none;\n  color: #373534;\n  position: absolute;\n  right: 8px;\n  cursor: pointer;\n}\n.jstree-drop-active {\n  border: 2px solid #004ebc !important;\n  background: rgba(188, 222, 255, 0.3);\n  box-shadow: 0 0 8px 2px rgba(0, 78, 188, 0.4);\n  transition: box-shadow 0.2s, border 0.2s, background 0.2s;\n}\n.label-datanode {\n  text-shadow: none;\n  line-height: 16px;\n  padding: 0 2px;\n  margin: 0px 2px;\n  margin-bottom: 2px;\n  font-size: 12px;\n  border: 1px solid;\n  vertical-align: middle;\n  font-weight: 400;\n}\n.label-datanode:hover {\n  cursor: pointer;\n  color: #ffffff;\n}\n.label-datanode .close {\n  color: #00799a;\n  opacity: 0.4;\n  font-weight: 500;\n  line-height: 13px;\n  font-size: 18px;\n  padding: 0 5px;\n  padding-bottom: 3px;\n  margin-right: -3px;\n}\n.label-datanode .close:hover {\n  opacity: 0.9;\n}\n.label-datanode .fcc {\n  padding: 0 3px;\n  font-size: 0.8em;\n}\n.label-datanode-internal {\n  color: #00799a;\n  border-color: #88d0d2;\n  background-color: #d2edee;\n}\n.label-datanode-internal .close {\n  color: #00799a;\n}\n.label-datanode-internal:hover {\n  background-color: #1ea2a7;\n  border-color: #1a8d92;\n}\n.label-datanode-internal:hover .close {\n  color: #d2edee;\n}\n.label-datanode-external {\n  color: #373534;\n  border-color: #c1c1bc;\n  background-color: #e6e6e4;\n}\n.label-datanode-external .close {\n  color: #373534;\n}\n.label-datanode-external:hover {\n  background-color: #685c53;\n}\n.label-datanode-external:hover .close {\n  color: #d6d6d4;\n}\n.label-datanode-external-unknown {\n  color: #685300;\n  border-color: #eed161;\n  background-color: #f6e5a6;\n}\n.label-datanode-external-unknown .close {\n  color: #685300;\n}\n.label-datanode-external-unknown:hover {\n  background-color: #f9c700;\n}\n.label-datanode-external-unknown:hover .close {\n  color: #f8ecbd;\n}\n.label-datanode-unknown {\n  color: #812627;\n  border-color: #c6948e;\n  background-color: #e8d4d2;\n}\n.label-datanode-unknown .close {\n  color: #812627;\n}\n.label-datanode-unknown:hover {\n  background-color: #e53e30;\n}\n.label-datanode-unknown:hover .close {\n  color: #efcfcb;\n}\n.datanode-tree-bubble {\n  font-size: 11px;\n  color: #ffffff;\n  line-height: 18px;\n  display: inline-block;\n  padding: 0px 5px;\n  border-radius: 3px;\n}\n.datanode-tree-bubble .fcc {\n  font-size: 9px;\n}\n.datanode-tree-bubble-internal {\n  color: #00799a;\n  background-color: #ccf3f4;\n}\n.datanode-tree-bubble-external {\n  color: #373534;\n  background-color: #f2f2f1;\n}\n.datanode-tree-bubble-internal.on {\n  background-color: #00bdc5;\n  color: #ffffff;\n}\n.datanode-tree-bubble-external.on {\n  background-color: #685c53;\n  color: #ffffff;\n}\n.cke_widget_wrapper:hover > .label-datanode {\n  outline: none !important;\n  -webkit-box-shadow: 0px 0px 8px #004ebc;\n  -moz-box-shadow: 0px 0px 8px #004ebc;\n  box-shadow: 0px 0px 8px #004ebc;\n}\n.cke_widget_focused .label-datanode {\n  outline: none !important;\n  -webkit-box-shadow: 0px 0px 8px #002c5f;\n  -moz-box-shadow: 0px 0px 8px #002c5f;\n  box-shadow: 0px 0px 8px #002c5f;\n  border-color: #0073f8;\n}\n.cke_widget_drag_handler_container {\n  top: -2px !important;\n  background: transparent !important;\n}\n.cke_widget_drag_handler {\n  width: 100% !important;\n  height: 100% !important;\n}\n.itext-block-container.has-markdown .markdown-group {\n  display: block !important;\n}\n.itext-block-container.has-markdown .turn-markdown-off,\n.itext-block-container.has-markdown .markdown-output:not(:empty),\n.itext-block-container.has-markdown .fd-help {\n  display: inline-block !important;\n}\n.itext-block-container.has-markdown .turn-markdown-on {\n  display: none !important;\n}\n.itext-block-container:not(.has-markdown) .markdown-group,\n.itext-block-container:not(.has-markdown) .turn-markdown-off,\n.itext-block-container:not(.has-markdown) .markdown-output {\n  display: none !important;\n}\n.itext-block-container:not(.has-markdown) .turn-markdown-on,\n.itext-block-container:not(.has-markdown) .fd-help {\n  display: inline-block !important;\n}\n.itext-block-container.markdown-ignorant .turn-markdown-off,\n.itext-block-container.markdown-ignorant .turn-markdown-on,\n.itext-block-container.markdown-ignorant .markdown-output,\n.itext-block-container.markdown-ignorant .fd-help {\n  display: none !important;\n}\n.markdown-output {\n  width: 100%;\n  margin: 0;\n}\n.markdown-output table {\n  padding: 0;\n}\n.markdown-output table tr {\n  border-top: 1px solid #cccccc;\n  background-color: white;\n  margin: 0;\n  padding: 0;\n}\n.markdown-output table tr th {\n  font-weight: bold;\n  border: 1px solid #cccccc;\n  text-align: left;\n  margin: 0;\n  padding: 6px 13px;\n}\n.markdown-output table tr th:first-child {\n  margin-top: 0;\n}\n.markdown-output table tr th:last-child {\n  margin-bottom: 0;\n}\n.markdown-output table tr td {\n  border: 1px solid #cccccc;\n  text-align: left;\n  margin: 0;\n  padding: 6px 13px;\n}\n.markdown-output table tr td:first-child {\n  margin-top: 0;\n}\n.markdown-output table tr td:last-child {\n  margin-bottom: 0;\n}\n.markdown-output table tr:nth-child(2n) {\n  background-color: #f8f8f8;\n}\n.fd-valid-alert-icon {\n  color: #d83a2e;\n}\n.fd-form-saving {\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  opacity: 0.8;\n  background-color: #000;\n  z-index: 2000;\n}\n.fd-form-saving > div {\n  opacity: 1;\n  position: fixed;\n  top: calc(50% -  32px / 2);\n  left: calc(50% -  32px / 2);\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  width: 32px;\n  height: 32px;\n  -webkit-border-radius: 4px;\n  -moz-border-radius: 4px;\n  border-radius: 4px;\n  background-color: #fff;\n  font-size: 22px;\n  text-align: center;\n}\n.fd-full-screen-modal .modal-dialog {\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  margin: 0;\n  width: auto;\n}\n.fd-full-screen-modal .modal-dialog .modal-content {\n  position: absolute;\n  top: 20px;\n  bottom: 20px;\n  left: 20px;\n  right: 20px;\n}\n.fd-full-screen-modal .modal-dialog .modal-content .modal-body {\n  overflow-y: auto;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container {\n  text-align: center;\n  width: 115px;\n  float: left;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container img,\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref {\n  border: 1px solid #eee;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container img {\n  padding: 0.5em;\n  background-color: #fff;\n  margin-bottom: 10px;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref {\n  color: #999;\n  background-color: #fff;\n  padding: 10px;\n}\n.formdesigner .fd-ui-container .fd-mm-preview-container .fd-mm-no-ref i {\n  display: block;\n  font-size: 56px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container {\n  margin-left: 125px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container > .control-row {\n  margin: 0px 0px 10px 0;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container > .control-row:first-child {\n  height: 25px;\n}\n.formdesigner .fd-ui-container .fd-mm-upload-container .fd-mm-path-input {\n  margin-right: 92px;\n}\n.rich-text-popover {\n  -webkit-border-radius: 3px;\n  -moz-border-radius: 3px;\n  border-radius: 3px;\n  word-wrap: break-word;\n  min-width: 236px;\n  max-width: 276px;\n}\n.rich-text-popover .popover-title h3 {\n  font-weight: 600;\n  font-size: 14px;\n  margin: 0;\n}\n.rich-text-popover .popover-title .text-muted {\n  margin-top: 5px;\n  line-height: 1.3em;\n}\n.rich-text-popover.top,\n.rich-text-popover.right,\n.rich-text-popover.bottom,\n.rich-text-popover.left {\n  margin: 0;\n}\n.rich-text-popover.bottom {\n  margin-top: 5px;\n}\n.rich-text-popover.top {\n  margin-bottom: -10px;\n}\n.rich-text-popover.right {\n  margin-left: 5px;\n}\n.rich-text-popover .arrow,\n.rich-text-popover .arrow:after {\n  display: none;\n}\n.popover-content .alert {\n  margin-bottom: 0;\n}\n.formdesigner .fd-ui-container .fd-props-toolbar {\n  margin-bottom: 5px;\n  border-bottom: 1px solid #F4F4F4;\n  padding: 12px;\n}\n.formdesigner .fd-ui-container .fd-props-toolbar .fd-question-comment {\n  margin-top: 10px;\n  white-space: pre-line;\n}\n.formdesigner .fd-ui-container .fd-props-content {\n  padding: 0 12px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-help {\n  width: 25px;\n  font-size: 21px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-help a:hover {\n  text-decoration: none;\n  color: #46a546;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-copy-paste-help .row {\n  padding: 0 2em;\n  margin-bottom: 2em;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-copy-paste-help .copy-paste-box textarea {\n  width: 100%;\n  height: 100px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset {\n  position: relative;\n  min-width: 0px;\n  /* for chrome */\n  display: table-column;\n  /* for firefox */\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset:first-child {\n  margin-top: 20px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset:first-child legend {\n  display: none;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset legend {\n  min-height: 30px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset legend .fd-help {\n  right: 0;\n  top: 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .control-label .fd-help {\n  position: relative;\n  top: -8px;\n  height: 15px;\n  display: inline-block;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .control-label label {\n  vertical-align: top;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .messages .alert {\n  margin: 10px 0 0 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-fieldset-content .itext-block-container .btn-danger {\n  margin: 10px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-itextID-checkbox-container {\n  width: 55px;\n  padding: 0 5px;\n  background-color: #f1f9f1;\n  -webkit-border-radius: 5px;\n  -moz-border-radius: 5px;\n  border-radius: 5px;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv {\n  margin-bottom: 0;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv .fd-kv-arrow {\n  text-align: center;\n}\n.formdesigner .fd-ui-container .fd-props-content .fd-question-fieldset .fd-kv .fd-kv-arrow i {\n  margin-top: 8px;\n}\nbody.vellum-full-screen {\n  overflow-y: hidden;\n}\n.formdesigner .fd-ui-container {\n  top: 0;\n  width: 100%;\n  background-color: white;\n}\n.formdesigner .fd-ui-container.full-screen {\n  z-index: 1031;\n}\n.formdesigner .fd-ui-container .fd-content {\n  float: left;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left {\n  width: 30%;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left .fd-add-question {\n  max-width: 140px;\n  width: 90%;\n  margin: 10px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-left .fd-accessory-pane {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-head {\n  height: 31px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-head h2 {\n  line-height: 30px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .well {\n  padding: 10px;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .well .col-sm-1 {\n  padding: 0;\n}\n.formdesigner .fd-ui-container .fd-content.fd-content-right .fd-form-actions {\n  background-color: #004ebc !important;\n  padding: 5px 8px 8px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-default-panel {\n  padding-left: 12px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head {\n  color: #fff;\n  background-color: #002c5f;\n  font-size: 17px;\n  height: 25px;\n  position: relative;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-max-indicator {\n  position: absolute;\n  right: 10px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-max-indicator i {\n  color: #d6d6d4;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head:hover .fd-head-max-indicator i {\n  color: #fff;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head > h2 {\n  font-size: 12.6px;\n  padding: 1px 12px 0;\n  margin: 0;\n  font-weight: normal;\n  line-height: 23px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  position: absolute;\n  left: 0;\n  right: 38px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container {\n  position: absolute;\n  right: 0px;\n  top: 0px;\n  line-height: 23px;\n  font-size: 12.6px;\n  min-width: 50px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-toggle {\n  color: #fff;\n  cursor: pointer;\n  display: block;\n  padding: 0 12px;\n  text-decoration: none;\n  background-color: #002c5f;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-toggle:hover {\n  text-decoration: none;\n  background-color: #004ebc;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-menu a {\n  min-width: 170px;\n}\n.formdesigner .fd-ui-container .fd-content .fd-head .fd-head-menu-container .dropdown .dropdown-menu a > .hotkey {\n  float: right;\n}\n.formdesigner .fd-ui-container .fd-content-vertical-divider {\n  width: 5px;\n  background: #004ebc;\n}\n.formdesigner .fd-ui-container .fd-content-horizontal-divider {\n  height: 10px;\n  margin: 1px 0;\n  background: #F4F4F4;\n  text-align: center;\n  font-size: 16px;\n  color: #777;\n  position: relative;\n}\n.formdesigner .fd-ui-container .fd-content-horizontal-divider i {\n  display: inline-block;\n  position: absolute;\n}\n.formdesigner .fd-ui-container .fd-messages {\n  position: fixed;\n  bottom: 40px;\n  left: 0;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-messages .alert {\n  -webkit-box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  -moz-box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.4);\n  margin: 20px;\n  height: auto;\n  overflow: auto;\n  max-height: 200px;\n}\n.formdesigner .fd-ui-container .fd-scrollable,\n.formdesigner .fd-ui-container .fd-scrollable-minimal {\n  overflow-x: hidden;\n  overflow-y: auto;\n  transform: translate3d(0, 0, 0);\n}\n.formdesigner .fd-ui-container .fd-scrollable {\n  height: 606px;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-scrollable-minimal {\n  max-height: 606px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor {\n  color: #37475d;\n  line-height: 27px;\n  height: 26px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-hovered,\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-clicked {\n  border: none;\n  background: #eaeff5;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor.jstree-clicked {\n  -webkit-box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n  -moz-box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n  box-shadow: 0px 0px 4px rgba(21, 87, 162, 0.6);\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .jstree-anchor > .jstree-icon,\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:before {\n  background: none;\n  font-size: 0.85em;\n  color: #004ebc;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice {\n  display: block;\n  margin-left: 50px;\n  cursor: pointer;\n  padding: 0 5px;\n  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n  line-height: 24px;\n  height: 24px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:before {\n  margin-right: 6px;\n  font: normal normal normal 14px/1 FontAwesome;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .add_choice:hover {\n  border: none;\n  background-color: #eaeff5;\n  width: 95px;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node.jstree-closed .add_choice {\n  display: none;\n}\n.formdesigner .fd-ui-container .jstree .jstree-node .fd-valid-alert-icon {\n  margin-right: 3px;\n  margin-left: -3px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head {\n  height: 46px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head h2 {\n  line-height: 46px;\n  font-size: 14px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-head .fd-head-menu-container {\n  line-height: 46px;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-scrollable {\n  overflow-x: auto;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-scrollable .jstree {\n  margin: 5px 0;\n}\n.formdesigner .fd-ui-container .fd-tree .fd-undo-delete {\n  margin-bottom: 0px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-head.fd-head-external-sources {\n  cursor: pointer;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-head.fd-head-external-sources h2 {\n  font-size: 12px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search {\n  background-color: #f2f2f1;\n  margin-bottom: 5px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search > form {\n  position: relative;\n  padding: 0px 12px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search > form i {\n  line-height: 42px;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-resource-search .fd-search-control {\n  position: absolute;\n  top: 5px;\n  margin-left: 18px;\n  width: 100%;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor {\n  color: #373534;\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor.jstree-clicked {\n  background-color: #f2f2f1;\n  -webkit-box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n  -moz-box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n  box-shadow: 0px 0px 4px rgba(104, 92, 83, 0.8);\n}\n.formdesigner .fd-ui-container .fd-external-sources-container .fd-external-sources-tree .jstree-anchor > .jstree-icon {\n  color: #685c53;\n}\n.formdesigner .fd-ui-container .fd-undo-delete p {\n  margin-top: 1em;\n}\n#jstree-dnd {\n  max-width: 300px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n',""]);const s=o},426:function(e){function t(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var n=-1;t.Diff,t.prototype.diff_main=function(e,t,n,a){void 0===a&&(a=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=a;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[0,e]]:[];void 0===n&&(n=!0);var r=n,o=this.diff_commonPrefix(e,t),s=e.substring(0,o);e=e.substring(o),t=t.substring(o),o=this.diff_commonSuffix(e,t);var l=e.substring(e.length-o);e=e.substring(0,e.length-o),t=t.substring(0,t.length-o);var d=this.diff_compute_(e,t,r,i);return s&&d.unshift([0,s]),l&&d.push([0,l]),this.diff_cleanupMerge(d),d},t.prototype.diff_compute_=function(e,t,a,i){var r;if(!e)return[[1,t]];if(!t)return[[n,e]];var o=e.length>t.length?e:t,s=e.length>t.length?t:e,l=o.indexOf(s);if(-1!=l)return r=[[1,o.substring(0,l)],[0,s],[1,o.substring(l+s.length)]],e.length>t.length&&(r[0][0]=r[2][0]=n),r;if(1==s.length)return[[n,e],[1,t]];var d=this.diff_halfMatch_(e,t);if(d){var u=d[0],c=d[1],p=d[2],f=d[3],h=d[4],g=this.diff_main(u,p,a,i),m=this.diff_main(c,f,a,i);return g.concat([[0,h]],m)}return a&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},t.prototype.diff_lineMode_=function(e,t,a){e=(c=this.diff_linesToChars_(e,t)).chars1,t=c.chars2;var i=c.lineArray,r=this.diff_main(e,t,!1,a);this.diff_charsToLines_(r,i),this.diff_cleanupSemantic(r),r.push([0,""]);for(var o=0,s=0,l=0,d="",u="";o<r.length;){switch(r[o][0]){case 1:l++,u+=r[o][1];break;case n:s++,d+=r[o][1];break;case 0:if(s>=1&&l>=1){r.splice(o-s-l,s+l),o=o-s-l;for(var c,p=(c=this.diff_main(d,u,!1,a)).length-1;p>=0;p--)r.splice(o,0,c[p]);o+=c.length}l=0,s=0,d="",u=""}o++}return r.pop(),r},t.prototype.diff_bisect_=function(e,t,a){for(var i=e.length,r=t.length,o=Math.ceil((i+r)/2),s=o,l=2*o,d=new Array(l),u=new Array(l),c=0;c<l;c++)d[c]=-1,u[c]=-1;d[s+1]=0,u[s+1]=0;for(var p=i-r,f=p%2!=0,h=0,g=0,m=0,v=0,y=0;y<o&&!((new Date).getTime()>a);y++){for(var x=-y+h;x<=y-g;x+=2){for(var b=s+x,A=(I=x==-y||x!=y&&d[b-1]<d[b+1]?d[b+1]:d[b-1]+1)-x;I<i&&A<r&&e.charAt(I)==t.charAt(A);)I++,A++;if(d[b]=I,I>i)g+=2;else if(A>r)h+=2;else if(f&&(_=s+p-x)>=0&&_<l&&-1!=u[_]&&I>=(M=i-u[_]))return this.diff_bisectSplit_(e,t,I,A,a)}for(var w=-y+m;w<=y-v;w+=2){for(var M,_=s+w,C=(M=w==-y||w!=y&&u[_-1]<u[_+1]?u[_+1]:u[_-1]+1)-w;M<i&&C<r&&e.charAt(i-M-1)==t.charAt(r-C-1);)M++,C++;if(u[_]=M,M>i)v+=2;else if(C>r)m+=2;else if(!f){var I;if((b=s+p-w)>=0&&b<l&&-1!=d[b])if(A=s+(I=d[b])-b,I>=(M=i-M))return this.diff_bisectSplit_(e,t,I,A,a)}}}return[[n,e],[1,t]]},t.prototype.diff_bisectSplit_=function(e,t,n,a,i){var r=e.substring(0,n),o=t.substring(0,a),s=e.substring(n),l=t.substring(a),d=this.diff_main(r,o,!1,i),u=this.diff_main(s,l,!1,i);return d.concat(u)},t.prototype.diff_linesToChars_=function(e,t){var n=[],a={};function i(e){for(var t="",i=0,r=-1,o=n.length;r<e.length-1;){-1==(r=e.indexOf("\n",i))&&(r=e.length-1);var s=e.substring(i,r+1);i=r+1,(a.hasOwnProperty?a.hasOwnProperty(s):void 0!==a[s])?t+=String.fromCharCode(a[s]):(t+=String.fromCharCode(o),a[s]=o,n[o++]=s)}return t}return n[0]="",{chars1:i(e),chars2:i(t),lineArray:n}},t.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var a=e[n][1],i=[],r=0;r<a.length;r++)i[r]=t[a.charCodeAt(r)];e[n][1]=i.join("")}},t.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,a=Math.min(e.length,t.length),i=a,r=0;n<i;)e.substring(r,i)==t.substring(r,i)?r=n=i:a=i,i=Math.floor((a-n)/2+n);return i},t.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,a=Math.min(e.length,t.length),i=a,r=0;n<i;)e.substring(e.length-i,e.length-r)==t.substring(t.length-i,t.length-r)?r=n=i:a=i,i=Math.floor((a-n)/2+n);return i},t.prototype.diff_commonOverlap_=function(e,t){var n=e.length,a=t.length;if(0==n||0==a)return 0;n>a?e=e.substring(n-a):n<a&&(t=t.substring(0,n));var i=Math.min(n,a);if(e==t)return i;for(var r=0,o=1;;){var s=e.substring(i-o),l=t.indexOf(s);if(-1==l)return r;o+=l,0!=l&&e.substring(i-o)!=t.substring(0,o)||(r=o,o++)}},t.prototype.diff_halfMatch_=function(e,t){if(this.Diff_Timeout<=0)return null;var n=e.length>t.length?e:t,a=e.length>t.length?t:e;if(n.length<4||2*a.length<n.length)return null;var i=this;function r(e,t,n){for(var a,r,o,s,l=e.substring(n,n+Math.floor(e.length/4)),d=-1,u="";-1!=(d=t.indexOf(l,d+1));){var c=i.diff_commonPrefix(e.substring(n),t.substring(d)),p=i.diff_commonSuffix(e.substring(0,n),t.substring(0,d));u.length<p+c&&(u=t.substring(d-p,d)+t.substring(d,d+c),a=e.substring(0,n-p),r=e.substring(n+c),o=t.substring(0,d-p),s=t.substring(d+c))}return 2*u.length>=e.length?[a,r,o,s,u]:null}var o,s,l,d,u,c=r(n,a,Math.ceil(n.length/4)),p=r(n,a,Math.ceil(n.length/2));return c||p?(o=p?c&&c[4].length>p[4].length?c:p:c,e.length>t.length?(s=o[0],l=o[1],d=o[2],u=o[3]):(d=o[0],u=o[1],s=o[2],l=o[3]),[s,l,d,u,o[4]]):null},t.prototype.diff_cleanupSemantic=function(e){for(var t=!1,a=[],i=0,r=null,o=0,s=0,l=0,d=0,u=0;o<e.length;)0==e[o][0]?(a[i++]=o,s=d,l=u,d=0,u=0,r=e[o][1]):(1==e[o][0]?d+=e[o][1].length:u+=e[o][1].length,r&&r.length<=Math.max(s,l)&&r.length<=Math.max(d,u)&&(e.splice(a[i-1],0,[n,r]),e[a[i-1]+1][0]=1,i--,o=--i>0?a[i-1]:-1,s=0,l=0,d=0,u=0,r=null,t=!0)),o++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),o=1;o<e.length;){if(e[o-1][0]==n&&1==e[o][0]){var c=e[o-1][1],p=e[o][1],f=this.diff_commonOverlap_(c,p),h=this.diff_commonOverlap_(p,c);f>=h?(f>=c.length/2||f>=p.length/2)&&(e.splice(o,0,[0,p.substring(0,f)]),e[o-1][1]=c.substring(0,c.length-f),e[o+1][1]=p.substring(f),o++):(h>=c.length/2||h>=p.length/2)&&(e.splice(o,0,[0,c.substring(0,h)]),e[o-1][0]=1,e[o-1][1]=p.substring(0,p.length-h),e[o+1][0]=n,e[o+1][1]=c.substring(h),o++),o++}o++}},t.prototype.diff_cleanupSemanticLossless=function(e){function n(e,n){if(!e||!n)return 6;var a=e.charAt(e.length-1),i=n.charAt(0),r=a.match(t.nonAlphaNumericRegex_),o=i.match(t.nonAlphaNumericRegex_),s=r&&a.match(t.whitespaceRegex_),l=o&&i.match(t.whitespaceRegex_),d=s&&a.match(t.linebreakRegex_),u=l&&i.match(t.linebreakRegex_),c=d&&e.match(t.blanklineEndRegex_),p=u&&n.match(t.blanklineStartRegex_);return c||p?5:d||u?4:r&&!s&&l?3:s||l?2:r||o?1:0}for(var a=1;a<e.length-1;){if(0==e[a-1][0]&&0==e[a+1][0]){var i=e[a-1][1],r=e[a][1],o=e[a+1][1],s=this.diff_commonSuffix(i,r);if(s){var l=r.substring(r.length-s);i=i.substring(0,i.length-s),r=l+r.substring(0,r.length-s),o=l+o}for(var d=i,u=r,c=o,p=n(i,r)+n(r,o);r.charAt(0)===o.charAt(0);){i+=r.charAt(0),r=r.substring(1)+o.charAt(0),o=o.substring(1);var f=n(i,r)+n(r,o);f>=p&&(p=f,d=i,u=r,c=o)}e[a-1][1]!=d&&(d?e[a-1][1]=d:(e.splice(a-1,1),a--),e[a][1]=u,c?e[a+1][1]=c:(e.splice(a+1,1),a--))}a++}},t.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,t.whitespaceRegex_=/\s/,t.linebreakRegex_=/[\r\n]/,t.blanklineEndRegex_=/\n\r?\n$/,t.blanklineStartRegex_=/^\r?\n\r?\n/,t.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,a=[],i=0,r=null,o=0,s=!1,l=!1,d=!1,u=!1;o<e.length;)0==e[o][0]?(e[o][1].length<this.Diff_EditCost&&(d||u)?(a[i++]=o,s=d,l=u,r=e[o][1]):(i=0,r=null),d=u=!1):(e[o][0]==n?u=!0:d=!0,r&&(s&&l&&d&&u||r.length<this.Diff_EditCost/2&&s+l+d+u==3)&&(e.splice(a[i-1],0,[n,r]),e[a[i-1]+1][0]=1,i--,r=null,s&&l?(d=u=!0,i=0):(o=--i>0?a[i-1]:-1,d=u=!1),t=!0)),o++;t&&this.diff_cleanupMerge(e)},t.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,a=0,i=0,r=0,o="",s="";a<e.length;)switch(e[a][0]){case 1:r++,s+=e[a][1],a++;break;case n:i++,o+=e[a][1],a++;break;case 0:i+r>1?(0!==i&&0!==r&&(0!==(t=this.diff_commonPrefix(s,o))&&(a-i-r>0&&0==e[a-i-r-1][0]?e[a-i-r-1][1]+=s.substring(0,t):(e.splice(0,0,[0,s.substring(0,t)]),a++),s=s.substring(t),o=o.substring(t)),0!==(t=this.diff_commonSuffix(s,o))&&(e[a][1]=s.substring(s.length-t)+e[a][1],s=s.substring(0,s.length-t),o=o.substring(0,o.length-t))),0===i?e.splice(a-r,i+r,[1,s]):0===r?e.splice(a-i,i+r,[n,o]):e.splice(a-i-r,i+r,[n,o],[1,s]),a=a-i-r+(i?1:0)+(r?1:0)+1):0!==a&&0==e[a-1][0]?(e[a-1][1]+=e[a][1],e.splice(a,1)):a++,r=0,i=0,o="",s=""}""===e[e.length-1][1]&&e.pop();var l=!1;for(a=1;a<e.length-1;)0==e[a-1][0]&&0==e[a+1][0]&&(e[a][1].substring(e[a][1].length-e[a-1][1].length)==e[a-1][1]?(e[a][1]=e[a-1][1]+e[a][1].substring(0,e[a][1].length-e[a-1][1].length),e[a+1][1]=e[a-1][1]+e[a+1][1],e.splice(a-1,1),l=!0):e[a][1].substring(0,e[a+1][1].length)==e[a+1][1]&&(e[a-1][1]+=e[a+1][1],e[a][1]=e[a][1].substring(e[a+1][1].length)+e[a+1][1],e.splice(a+1,1),l=!0)),a++;l&&this.diff_cleanupMerge(e)},t.prototype.diff_xIndex=function(e,t){var a,i=0,r=0,o=0,s=0;for(a=0;a<e.length&&(1!==e[a][0]&&(i+=e[a][1].length),e[a][0]!==n&&(r+=e[a][1].length),!(i>t));a++)o=i,s=r;return e.length!=a&&e[a][0]===n?s:s+(t-o)},t.prototype.diff_prettyHtml=function(e){for(var t=[],a=/&/g,i=/</g,r=/>/g,o=/\n/g,s=0;s<e.length;s++){var l=e[s][0],d=e[s][1].replace(a,"&amp;").replace(i,"&lt;").replace(r,"&gt;").replace(o,"&para;<br>");switch(l){case 1:t[s]='<ins style="background:#e6ffe6;">'+d+"</ins>";break;case n:t[s]='<del style="background:#ffe6e6;">'+d+"</del>";break;case 0:t[s]="<span>"+d+"</span>"}}return t.join("")},t.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)1!==e[n][0]&&(t[n]=e[n][1]);return t.join("")},t.prototype.diff_text2=function(e){for(var t=[],a=0;a<e.length;a++)e[a][0]!==n&&(t[a]=e[a][1]);return t.join("")},t.prototype.diff_levenshtein=function(e){for(var t=0,a=0,i=0,r=0;r<e.length;r++){var o=e[r][0],s=e[r][1];switch(o){case 1:a+=s.length;break;case n:i+=s.length;break;case 0:t+=Math.max(a,i),a=0,i=0}}return t+Math.max(a,i)},t.prototype.diff_toDelta=function(e){for(var t=[],a=0;a<e.length;a++)switch(e[a][0]){case 1:t[a]="+"+encodeURI(e[a][1]);break;case n:t[a]="-"+e[a][1].length;break;case 0:t[a]="="+e[a][1].length}return t.join("\t").replace(/%20/g," ")},t.prototype.diff_fromDelta=function(e,t){for(var a=[],i=0,r=0,o=t.split(/\t/g),s=0;s<o.length;s++){var l=o[s].substring(1);switch(o[s].charAt(0)){case"+":try{a[i++]=[1,decodeURI(l)]}catch(e){throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var d=parseInt(l,10);if(isNaN(d)||d<0)throw new Error("Invalid number in diff_fromDelta: "+l);var u=e.substring(r,r+=d);"="==o[s].charAt(0)?a[i++]=[0,u]:a[i++]=[n,u];break;default:if(o[s])throw new Error("Invalid diff operation in diff_fromDelta: "+o[s])}}if(r!=e.length)throw new Error("Delta length ("+r+") does not equal source text length ("+e.length+").");return a},t.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},t.prototype.match_bitap_=function(e,t,n){if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var a=this.match_alphabet_(t),i=this;function r(e,a){var r=e/t.length,o=Math.abs(n-a);return i.Match_Distance?r+o/i.Match_Distance:o?1:r}var o=this.Match_Threshold,s=e.indexOf(t,n);-1!=s&&(o=Math.min(r(0,s),o),-1!=(s=e.lastIndexOf(t,n+t.length))&&(o=Math.min(r(0,s),o)));var l,d,u=1<<t.length-1;s=-1;for(var c,p=t.length+e.length,f=0;f<t.length;f++){for(l=0,d=p;l<d;)r(f,n+d)<=o?l=d:p=d,d=Math.floor((p-l)/2+l);p=d;var h=Math.max(1,n-d+1),g=Math.min(n+d,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<f)-1;for(var v=g;v>=h;v--){var y=a[e.charAt(v-1)];if(m[v]=0===f?(m[v+1]<<1|1)&y:(m[v+1]<<1|1)&y|(c[v+1]|c[v])<<1|1|c[v+1],m[v]&u){var x=r(f,v-1);if(x<=o){if(o=x,!((s=v-1)>n))break;h=Math.max(1,2*n-s)}}}if(r(f+1,n)>o)break;c=m}return s},t.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},t.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),a=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)a+=this.Patch_Margin,n=t.substring(e.start2-a,e.start2+e.length1+a);a+=this.Patch_Margin;var i=t.substring(e.start2-a,e.start2);i&&e.diffs.unshift([0,i]);var r=t.substring(e.start2+e.length1,e.start2+e.length1+a);r&&e.diffs.push([0,r]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+r.length,e.length2+=i.length+r.length}},t.prototype.patch_make=function(e,a,i){var r,o;if("string"==typeof e&&"string"==typeof a&&void 0===i)r=e,(o=this.diff_main(r,a,!0)).length>2&&(this.diff_cleanupSemantic(o),this.diff_cleanupEfficiency(o));else if(e&&"object"==typeof e&&void 0===a&&void 0===i)o=e,r=this.diff_text1(o);else if("string"==typeof e&&a&&"object"==typeof a&&void 0===i)r=e,o=a;else{if("string"!=typeof e||"string"!=typeof a||!i||"object"!=typeof i)throw new Error("Unknown call format to patch_make.");r=e,o=i}if(0===o.length)return[];for(var s=[],l=new t.patch_obj,d=0,u=0,c=0,p=r,f=r,h=0;h<o.length;h++){var g=o[h][0],m=o[h][1];switch(d||0===g||(l.start1=u,l.start2=c),g){case 1:l.diffs[d++]=o[h],l.length2+=m.length,f=f.substring(0,c)+m+f.substring(c);break;case n:l.length1+=m.length,l.diffs[d++]=o[h],f=f.substring(0,c)+f.substring(c+m.length);break;case 0:m.length<=2*this.Patch_Margin&&d&&o.length!=h+1?(l.diffs[d++]=o[h],l.length1+=m.length,l.length2+=m.length):m.length>=2*this.Patch_Margin&&d&&(this.patch_addContext_(l,p),s.push(l),l=new t.patch_obj,d=0,p=f,u=c)}1!==g&&(u+=m.length),g!==n&&(c+=m.length)}return d&&(this.patch_addContext_(l,p),s.push(l)),s},t.prototype.patch_deepCopy=function(e){for(var n=[],a=0;a<e.length;a++){var i=e[a],r=new t.patch_obj;r.diffs=[];for(var o=0;o<i.diffs.length;o++)r.diffs[o]=i.diffs[o].slice();r.start1=i.start1,r.start2=i.start2,r.length1=i.length1,r.length2=i.length2,n[a]=r}return n},t.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var a=this.patch_addPadding(e);t=a+t+a,this.patch_splitMax(e);for(var i=0,r=[],o=0;o<e.length;o++){var s,l,d=e[o].start2+i,u=this.diff_text1(e[o].diffs),c=-1;if(u.length>this.Match_MaxBits?-1!=(s=this.match_main(t,u.substring(0,this.Match_MaxBits),d))&&(-1==(c=this.match_main(t,u.substring(u.length-this.Match_MaxBits),d+u.length-this.Match_MaxBits))||s>=c)&&(s=-1):s=this.match_main(t,u,d),-1==s)r[o]=!1,i-=e[o].length2-e[o].length1;else if(r[o]=!0,i=s-d,u==(l=-1==c?t.substring(s,s+u.length):t.substring(s,c+this.Match_MaxBits)))t=t.substring(0,s)+this.diff_text2(e[o].diffs)+t.substring(s+u.length);else{var p=this.diff_main(u,l,!1);if(u.length>this.Match_MaxBits&&this.diff_levenshtein(p)/u.length>this.Patch_DeleteThreshold)r[o]=!1;else{this.diff_cleanupSemanticLossless(p);for(var f,h=0,g=0;g<e[o].diffs.length;g++){var m=e[o].diffs[g];0!==m[0]&&(f=this.diff_xIndex(p,h)),1===m[0]?t=t.substring(0,s+f)+m[1]+t.substring(s+f):m[0]===n&&(t=t.substring(0,s+f)+t.substring(s+this.diff_xIndex(p,h+m[1].length))),m[0]!==n&&(h+=m[1].length)}}}}return[t=t.substring(a.length,t.length-a.length),r]},t.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",a=1;a<=t;a++)n+=String.fromCharCode(a);for(a=0;a<e.length;a++)e[a].start1+=t,e[a].start2+=t;var i=e[0],r=i.diffs;if(0==r.length||0!=r[0][0])r.unshift([0,n]),i.start1-=t,i.start2-=t,i.length1+=t,i.length2+=t;else if(t>r[0][1].length){var o=t-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],i.start1-=o,i.start2-=o,i.length1+=o,i.length2+=o}return 0==(r=(i=e[e.length-1]).diffs).length||0!=r[r.length-1][0]?(r.push([0,n]),i.length1+=t,i.length2+=t):t>r[r.length-1][1].length&&(o=t-r[r.length-1][1].length,r[r.length-1][1]+=n.substring(0,o),i.length1+=o,i.length2+=o),n},t.prototype.patch_splitMax=function(e){for(var a=this.Match_MaxBits,i=0;i<e.length;i++)if(!(e[i].length1<=a)){var r=e[i];e.splice(i--,1);for(var o=r.start1,s=r.start2,l="";0!==r.diffs.length;){var d=new t.patch_obj,u=!0;for(d.start1=o-l.length,d.start2=s-l.length,""!==l&&(d.length1=d.length2=l.length,d.diffs.push([0,l]));0!==r.diffs.length&&d.length1<a-this.Patch_Margin;){var c=r.diffs[0][0],p=r.diffs[0][1];1===c?(d.length2+=p.length,s+=p.length,d.diffs.push(r.diffs.shift()),u=!1):c===n&&1==d.diffs.length&&0==d.diffs[0][0]&&p.length>2*a?(d.length1+=p.length,o+=p.length,u=!1,d.diffs.push([c,p]),r.diffs.shift()):(p=p.substring(0,a-d.length1-this.Patch_Margin),d.length1+=p.length,o+=p.length,0===c?(d.length2+=p.length,s+=p.length):u=!1,d.diffs.push([c,p]),p==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(p.length))}l=(l=this.diff_text2(d.diffs)).substring(l.length-this.Patch_Margin);var f=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==f&&(d.length1+=f.length,d.length2+=f.length,0!==d.diffs.length&&0===d.diffs[d.diffs.length-1][0]?d.diffs[d.diffs.length-1][1]+=f:d.diffs.push([0,f])),u||e.splice(++i,0,d)}}},t.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},t.prototype.patch_fromText=function(e){var a=[];if(!e)return a;for(var i=e.split("\n"),r=0,o=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<i.length;){var s=i[r].match(o);if(!s)throw new Error("Invalid patch string: "+i[r]);var l=new t.patch_obj;for(a.push(l),l.start1=parseInt(s[1],10),""===s[2]?(l.start1--,l.length1=1):"0"==s[2]?l.length1=0:(l.start1--,l.length1=parseInt(s[2],10)),l.start2=parseInt(s[3],10),""===s[4]?(l.start2--,l.length2=1):"0"==s[4]?l.length2=0:(l.start2--,l.length2=parseInt(s[4],10)),r++;r<i.length;){var d=i[r].charAt(0);try{var u=decodeURI(i[r].substring(1))}catch(e){throw new Error("Illegal escape in patch_fromText: "+u)}if("-"==d)l.diffs.push([n,u]);else if("+"==d)l.diffs.push([1,u]);else if(" "==d)l.diffs.push([0,u]);else{if("@"==d)break;if(""!==d)throw new Error('Invalid patch mode "'+d+'" in: '+u)}r++}}return a},t.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},t.patch_obj.prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case 1:e="+";break;case n:e="-";break;case 0:e=" "}t[a+1]=e+encodeURI(this.diffs[a][1])+"\n"}return t.join("").replace(/%20/g," ")},this.diff_match_patch=t,this.DIFF_DELETE=n,this.DIFF_INSERT=1,this.DIFF_EQUAL=0,e.exports=t},939:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var a=n(4523),i=n(561),r=n.n(i),o=n(4459),s=n(3578),l=n.n(s),d=n(9659),u=n(7724),c=n.n(u),p=(n(2023),{});function f(e,t,n){var i=t.form;return{at:e,displayTpl:c(),insertTpl:n.insertTpl,limit:10,maxLen:30,startWithSpace:!1,tabSelectsMatch:n.tabSelectsMatch,callbacks:{matcher:function(e,t){var n;return(n=new RegExp("([\\sâ€‹]+|^)"+RegExp.escape(e)+"([\\w/-]*)$","gi").exec(t))?n[2]:null},filter:function(e,n,r){return o=e?i.fuse.search(e):i.fuse.list(),a.Ay.filter(o,(function(e){return t.ufid!==e.id&&e.name&&!a.Ay.isUndefined(e.displayLabel)}));var o},sorter:function(e,t,n){return a.Ay.map(t,(function(e,t){return e.atwho_order=t,e}))},beforeInsert:function(e,t){var a=d.A.getReferenceName(e);return l().usage(a,"Autocomplete",n.property),e},afterMatchFailed:function(e,t){if(n.useRichText&&t.html()){var a=t.html().trim().replace(/^.*\s/,""),r=i.isValidHashtag(a)||i.hasValidHashtagPrefix(a);r&&n.functionOverrides.insert.call(this,a);var o=this._unwrap(t.text(t.text()).contents().first());r||this._setRange("after",o)}return!1}},functionOverrides:n.functionOverrides}}p.autocomplete=function(e,t,n){t.form.vellum.data.atwho&&(n&&n.choices?p._dropdownAutocomplete(e,n.choices):p._questionAutocomplete(e,t,n),t.on("teardown-mug-properties",(function(){e.data("atwho")&&e.atwho("destroy")}),null,"teardown-mug-properties"))},p._dropdownAutocomplete=function(e,t){var n={at:"",data:t,limit:10,maxLen:1/0,suffix:"",tabSelectsMatch:!1,callbacks:{filter:function(e,t,n){return a.Ay.filter(t,(function(t){return-1!==t.name.indexOf(e)}))},matcher:function(t,n,a){return e.val()},beforeInsert:function(t,n){e.data("selected-value",t)}}};e.one("focus",(function(){e.atwho(n).on("inserted.atwho",(function(t,n,a){r()(this).find(".atwho-inserted").children().unwrap(),e.attr("contenteditable")?o.A.editor(e).setValue(e.data("selected-value")).change():e.val(e.data("selected-value")).change()}))}))},p._questionAutocomplete=function(e,t,n){function i(){e.one("focus",(function(){e.atwho(f(t.form.getBasePath(),t,n)),n.useHashtags&&e.atwho(f("#",t,n))}))}(n=a.Ay.defaults(n||{},{insertTpl:"${name}",property:"",outputValue:!1,useRichText:!1,useHashtags:!1,tabSelectsMatch:!1,functionOverrides:{}})).useRichText&&(n.useHashtags=!0,n.functionOverrides.insert=function(t,n){this.query.el.remove(),o.A.editor(e).insertExpression(t),this.$inputor.is(":focus")||this.$inputor.focus()}),n.useHashtags&&(n.insertTpl="${hashtagPath}"),i(),e.on("inserted.atwho",(function(e,t,n){r()(this).find(".atwho-inserted").children().unwrap()})),t.form.on("change-display-language",(function(){e.data("atwho")&&(e.atwho("destroy"),i())}))},r().vellum.plugin("atwho",{},{});const h=p},3586:(e,t,n)=>{"use strict";n.d(t,{A:()=>v});var a=n(561),i=n.n(a),r=n(4523),o=n(3578),s=n.n(o),l=n(939),d=n(9659),u=n(7444),c=n.n(u),p={},f={};function h(e){e.addQuestionButton.show(),e.container.hide(),e.input.val("").removeClass("alert-danger")}function g(e){function t(e,t){if(!t)throw new Error("getArg parameter is required");return{regexp:r.Ay.chain(e).map((function(e){return RegExp.escape(e.name)})).sortBy((function(e){return-e.length})).value().join("|"),items:e,getArg:t}}function n(e){var t,n;for(e=e.trim(),t=0;t<c.length;t++)if(n=c[t].exec(e))return{tokens:r.Ay.tail(n),config:c[t].config}}var a=i().fn.atwho.default.callbacks,o=p.getQuestionMap(e),s=r.Ay.map(o,(function(e){return{name:e.typeName,icon:e.icon}})),l=r.Ay.map(["after","before","first in","in"],(function(e){return{name:e}})),d={in:"into","first in":"first"},u={regexp:/[#\/][^\s]+/.source,getArg:function(t){var n;if(t){if(!(n=e.getMugByPath(t)))throw new Error("bad path: "+t)}else n=e.getCurrentlySelectedMug();return n}},c=[],f=[],h=[{name:"add question",args:[t(s,(function(e){if(e=e.toLowerCase(),o.hasOwnProperty(e))return o[e].__className})),t(l,(function(e){return e&&(e=e.toLowerCase(),d.hasOwnProperty(e)&&(e=d[e])),e})),u],run:function(t){!t[2]&&/^(before|after)$/i.test(t[1])&&(t[1]=void 0);try{return e.addQuestion.apply(e,t)}catch(e){}}},{name:"select question",args:[u],run:function(t){var n=t[0];if(n&&e.ensureCurrentMugIsSaved())return e.setCurrentMug(n),e.scrollTreeTo(n.ufid),e.focusFirstInput(),n}}];return r.Ay.each(h,(function(e){var t=[],n=[],a=f.length;r.Ay.each(e.args,(function(e){if(e.items){var i=t.concat(["(.*)$"]),r=new RegExp("^"+i.join("\\s+"),"i");r.items=e.items,f.splice(a,0,r)}t.push("(?:"+e.regexp+")"),n.length<1?n.push("^("+e.regexp+")"):n.push("(?:\\s+("+e.regexp+")")})),n.push.apply(n,r.Ay.map(n,(function(){return")?"}))),n[n.length-1]="$";var i=new RegExp(n.join(""),"i");i.config=e,c.push(i)})),{tokenize:n,dispatch:function(e){var t,a=n(e);if(a){try{t=r.Ay.map(a.tokens,(function(e,t){return a.config.args[t].getArg(e)}))}catch(e){return}var i=a.config.run(t);return i&&{name:a.config.name,value:i}}},atwhoConfig:{at:"",data:[],limit:50,maxLen:1/0,displayTpl:'<li><i class="${icon}"></i> ${name}</li>',insertTpl:"${full}",suffix:" ",searchKey:i().fn.atwho.default.searchKey,tabSelectsMatch:!0,callbacks:{matcher:function(e,t){return t},filter:function(e,t,n){var i=[];return r.Ay.each(f,(function(t){var o=t.exec(e);if(o){var s=o[o.length-1],l=s?e.slice(0,-s.length):e,d=s.trimLeft(),u=a.filter(d,t.items,n);u=r.Ay.map(u,(function(e){return{name:e.name,icon:e.icon,full:l+e.name}})),d&&(d=d.toLowerCase(),u=r.Ay.sortBy(u,(function(e){var t=e.name.toLowerCase().indexOf(d);return t>=0?t:1/0}))),Array.prototype.push.apply(i,u)}})),i},sorter:function(e,t){return t}}}}}function m(e){if(e.input.atwho("isSelecting"))r.Ay.defer(m,e);else{var t=e.input.val(),n=p.doCommand(t,e.vellum);n?(h(e),s().usage("Commander",n.name)):(e.input.addClass("alert-danger"),s().usage("Commander","bad command"))}}i().vellum.plugin("commander",{},{init:function(){var e=this,t=e.data.commander;t.vellum=e,t.container=i()(c()()),t.addQuestionButton=e.$f.find(".fd-add-question"),t.input=t.container.find("input"),t.input.on("keydown",(function(e){var n=d.A.getKeyChord(e);f.hasOwnProperty(n)?(f[n](t),e.preventDefault()):t.input.removeClass("alert-danger")})),t.container.find(".fd-commander-close").click((function(e){h(t)})),i()(".fd-add-question-dropdown").append(t.container.hide())},getToolsMenuItems:function(){var e=this.__callOld();return e.splice(e.length-1,0,{name:gettext("Command Bar"),icon:"fa fa-terminal",hotkey:"Ctrl+;",action:function(){!function(e){(function(e){e.atwhoConfig||(r.Ay.extend(e,g(e.vellum)),e.input.atwho(e.atwhoConfig),l.A.autocomplete(e.input,{form:e.vellum.data.core.form,on:r.Ay.identity},{useHashtags:!0,tabSelectsMatch:!0}),e.vellum.data.core.form.on("change-display-language",(function(){e.input.atwho(e.atwhoConfig)})),e.input.on("inserted.atwho",(function(e){e.preventDefault()})))})(e),e.addQuestionButton.hide();const t=e.addQuestionButton.outerHeight(!0);e.container.css("min-height",t+"px"),e.container.show(),e.input.focus().select()}(this.data.commander)}}),e}}),f.Tab=function(){},f.Enter=m,f.Return=m,f.Escape=h,f.Esc=h,p.getCompletions=function(e,t){var n=g(t).atwhoConfig;return n.callbacks.filter(e,null,n.searchKey)},p.tokenize=function(e,t){return g(t).tokenize(e)},p.doCommand=function(e,t){var n=t.data.commander;return n.dispatch||r.Ay.extend(n,g(t)),n.dispatch(e)},p.getQuestionMap=function(e){var t=e.data.commander,n=e.data.core.mugTypes;return t.hasOwnProperty("questions")||(t.questions=r.Ay.chain(e.data.core.QUESTIONS_IN_TOOLBAR).map((function(e){var t=n[e];return[t.typeName.toLowerCase(),t]})).object().value(),t.questions.choice=n.Choice),t.questions};const v=p},1437:(e,t,n)=>{"use strict";n.d(t,{A:()=>T});var a,i=n(561),r=n.n(i),o=n(4523),s=n(23),l=n.n(s),d=n(4078),u=n(3809),c=n(9659),p=n(3578),f=n.n(p),h=(n(2023),["Form Builder clip","version 1"]),g=r()("<textarea></textarea>").css({position:"absolute",width:0,height:0}).css({top:-1e4,left:-1e4}).appendTo("body"),m=/Chrome/.test(navigator.userAgent),v=/Safari/.test(navigator.userAgent)&&!m;function y(e,t){0===e.length&&(e=r()("body")),g.css({top:e.offset().top}),g.val(t),g.focus(),g.select()}function x(e,t){e.focus();var n=g.val();return t&&n&&g.val(""),n}var b=/^(null|true|false|\[[^]*\]|\{[^]*\}|"[^]*"|-?\d+(\.\d+)?([Ee][+-]?\d+)?)$/;function A(e){return o.Ay.isString(e)&&!b.test(e)?e:JSON.stringify(e)}function w(e){return b.test(e)?JSON.parse(e):e}function M(e){var t="1",n=/^(.*)Itext(?::([^-]+)-(.*))?$/.exec(e);return n&&(t="0","label"===n[1]&&(n[1]="!"),"default"===n[3]?n[3]="!":n[3]||(n[3]="~"),e=n[1]+" "+n[3]+" "+n[2]),t+e}function _(e){var t=a.data.core.mugTypes.allTypes[e];return t&&t.typeName||e}function C(e,t){for(var n,i;;){if(!e.parent||t.id.startsWith(e.id+"/")){i=e.id&&!t.id.startsWith(e.id+"/"),n=a.getInsertTargetAndPosition(e.mug,t.type,i);break}e=e.parent}if(n){for(;e.mug!==n.mug;){if(!e.parent)return n.error=gettext("Cannot insert $1 into $2").replace("$1",_(t.type)).replace("$2",_(e.mug.parentMug.__className)),n;e=e.parent}"after"===n.position?n.parent=e.parent:"last"===n.position||"into"===n.position?n.parent=e:n.error="Cannot insert $1 $2 $3".replace("$1",_(t.type)).replace("$2",n.position).replace("$3",_(n.mug.__className))}else n={},e.mug?n.error=gettext("Cannot insert $1 into or after $2").replace("$1",_(t.type)).replace("$2",_(e.mug.__className)):n.error=c.A.format(gettext("Cannot insert {type} into tree root"),{type:_(t.type)});return n}function I(){var e=k(!0),t=a.getCurrentlySelectedMug(!0);return f().usage("Copy Paste","Cut",t.length),f().workflow("Cut questions in form builder"),(t=o.Ay.filter(t,(function(e){return e.options.isCopyable})))&&t.length&&a.data.core.form.removeMugsFromForm(t),e}function k(e){var t=a.getCurrentlySelectedMug(!0,!0),n={};if(e||(f().usage("Copy Paste","Copy",t.length),f().workflow("Copy questions in form builder")),!t||!t.length)return"";var i={id:!0,type:!0},r=[],s=t[0].form,l=o.Ay.filter(o.Ay.flatten(o.Ay.map(t,(function e(t){if(!n.hasOwnProperty(t.ufid)&&(n[t.ufid]=!0,t.options.isCopyable)){var a=t.serialize(),l=s.getChildren(t);return o.Ay.each(a,(function(e,t){i.hasOwnProperty(t)||(r.push(t),i[t]=!0)})),l.length&&(a=[a].concat(o.Ay.map(l,e))),a}}))),o.Ay.identity);return 0===l.length?"":(r=["id","type"].concat(o.Ay.sortBy(r,M)),u.A.tabDelimit([h,r].concat(o.Ay.map(l,(function(e){return o.Ay.map(r,(function(t){var n=e[t];return A(o.Ay.isUndefined(n)?null:n)}))})))))}function P(e){f().workflow("Paste questions in form builder");var t=u.A.makeRowParser(e);if(!o.Ay.isEqual(t().slice(0,2),h))return[gettext("Unsupported paste format")];var n,i,r=a.data.core.mugTypes.allTypes,s=a.data.core.form,l=function(e){function t(e){var t=e.replace(/^#form/,"");return a.hasOwnProperty(t)?a[t].hashtagPath:e}var n=new d.A.MugMessages,a={},i=[],r={length:0,context:{addError:function(e){n.update(null,{key:e,level:d.A.ERROR,message:e})},errors:n,later:function(e){i.push(e)},transformHashtags:function(n){return e.transformHashtags(n,t)}},addMug:function(e,t){a[e]=t,r.length++},getErrors:n.get.bind(n),finish:function(){o.Ay.each(i,(function(e){e()}))}};return r}(s),c=l.context,p=a.getCurrentlySelectedMug(!0,!0),g=p.length?p[p.length-1]:null,m=t(),v=t(),y={id:null,mug:g,parent:null};for(a.beforeBulkInsert(s);v;v=t()){try{n=o.Ay.object(m,o.Ay.map(v,(function(e){return w(e)})))}catch(e){c.addError(gettext("Unsupported paste format:")+" "+v.join(", "));continue}r.hasOwnProperty(n.type)?(i=C(y,n)).hasOwnProperty("error")?c.addError(i.error):((g=s.createQuestion(i.mug,i.position,n.type,!0)).deserialize(n,c),l.addMug(n.id,g),y={id:n.id,mug:g,parent:i.parent}):c.addError(gettext("Unknown question type:")+" "+v.join(", "))}return l.finish(),a.afterBulkInsert(s),g&&i&&a.setCurrentMug(g),f().usage("Copy Paste","Paste",l.length),l.getErrors()}r().vellum.plugin("copyPaste",{cut:I,copy:k,paste:P},{init:function(){var e=this.opts().copyPaste;a=this,r()(document).on("cut copy paste keydown",(function(t){"cut"===t.type||"Ctrl+X"===c.A.getKeyChord(t)||("copy"===t.type||"Ctrl+C"===c.A.getKeyChord(t)?function(e){var t=r()(":focus");if(t.is(".jstree-anchor")){var n=e.copy();n&&(y(t,n),setTimeout((function(){x(t)}),10))}}(e):"paste"!==t.type&&"Ctrl+V"!==c.A.getKeyChord(t)||function(e){var t=r()(":focus");(0===t.length||t.parents(".fd-tree").length||t.is(g))&&(y(t),setTimeout((function(){var n=x(t,!0);if(n){var i=e.paste(n);i.length&&a._resetMessages([{level:"parse-warning",message:i}])}}),0))}(e))}))},displayMultipleSelectionView:function(){function e(){n.hide(),a.removeClass("hide"),i.val(k(!0))}this.__callOld();var t=r()(l()({metachar:c.A.isMac?"âŒ˜":"Ctrl+",format:c.A.format})),n=t.find(".copy-paste-help"),a=t.find(".copy-paste-box"),i=a.find("textarea");v?(e(),setTimeout((function(){i.focus().select()}),1)):n.click((function(){e(),i.focus().select()})),i.focus((function(){i.select().mouseup((function(){return i.off("mouseup"),!1}))})).keyup((function(e){9===e.which&&i.select()})),t.find(".insert-questions").click((function(){P(i.val())})),this.$f.find(".fd-props-content").html(t)}});const T={cut:I,copy:k,paste:P,stringify:A,valuify:w}},2023:(e,t,n)=>{"use strict";var a=n(9848),i=n(4523),r=n(561),o=n.n(r),s=n(5237),l=n.n(s),d=n(8101),u=n.n(d),c=n(4872),p=n.n(c),f=n(5674),h=n.n(f),g=n(516),m=n.n(g),v=n(7133),y=n.n(v),x=n(8267),b=n.n(x),A=n(8019),w=n.n(A),M=n(4226),_=n.n(M),C=n(348),I=n.n(C),k=n(7356),P=n.n(k),T=n(7649),S=n.n(T),N=n(1694),E=n.n(N),D=n(8426),R=n.n(D),O=n(1089),L=n.n(O),q=["core","intents","javaRosa","lock","ignore","uploader","windowManager","copyPaste","commander"];function F(e,t,n){if("init"!==n||"core"===e)if(0!==n.indexOf("_"))t.plugin=e,t.old=this[n],this[n]=function(){var e=t,n=Array.prototype.slice.call(arguments),a=this.__callOld;this.__callOld=function(){return e.old.apply(this,arguments.length?Array.prototype.slice.call(arguments):n)};try{return e.apply(this,n)}finally{this.__callOld=a}},this[n].old=t.old,this[n].plugin=e;else{if(void 0!==this[n])throw"private plugin method "+e+"."+n+" would overwrite existing: "+this[n];this[n]=t}}o().fn.vellum=function(e){var t,n="string"==typeof e,a=Array.prototype.slice.call(arguments,1);if(n){if("get"===e){for(var i=this;i&&i.length;){if((t=i.data("vellum_instance"))instanceof o().vellum._instance)return t;i=i.parent()}return null}return(t=this.data("vellum_instance"))[e].apply(t,a)}return this.each((function(){var t=new(o().vellum._instance)(o()(this),e);o().data(this,"vellum_instance",t)})),this},o().vellum={defaults:{},_plugins:{},_fn:{},_instance:function(e,t){t.plugins=i.Ay.filter(i.Ay.union(q,t.plugins||[]),(function(e){return!i.Ay.isUndefined(o().vellum._plugins[e])})),t=o().extend(!0,{},o().vellum.defaults,t);var n=this;this.$f=e,this.data={},this.opts=function(){return o().extend(!0,{},t)},this.getData=function(){return this.data}.bind(this),this.isPluginEnabled=function(e){return-1!==t.plugins.indexOf(e)},i.Ay.each(t.plugins,(function(e,t){n.data[e]={};var a=o().vellum._plugins[e];a&&i.Ay.each(a,(function(a,i){0===t?n[i]=a:F.call(n,e,a,i)}))})),i.Ay.each(t.plugins,(function(e){var t=o().vellum._plugins[e].init;t&&t.apply(n)})),n.postInit()},plugin:function(e,t,n){return o().vellum.defaults[e]=t,o().vellum._plugins[e]=n,o()}};var V=n(4078),j=n(705),B=n(4459),z=n(8262),U=n(7229),X=n(5382),H=n(9659),$=n(3876),Q=n(3578),W=n.n(Q),G=n(939),Y=n(2183),K=n(426),J=n.n(K),Z=n(1396),ee=n.n(Z);n(1460),o().jstree.defaults.conditionalevents={should_activate:function(){return!0},redraw_node:function(){var e=Array.prototype.slice.call(arguments);return this.parent.redraw_node.apply(this.inst,e)}},o().jstree.plugins.conditionalevents=function(e,t){this.activate_node=function(){var e=Array.prototype.slice.call(arguments);this.settings.conditionalevents.should_activate.apply(this,e)&&t.activate_node.apply(this,e)},this.redraw_node=function(){var e=Array.prototype.slice.call(arguments),n={inst:this,parent:t};return this.settings.conditionalevents.redraw_node.apply(n,e)},this.edit=function(){}};var te=n(5072),ne=n.n(te),ae=n(7825),ie=n.n(ae),re=n(7659),oe=n.n(re),se=n(5056),le=n.n(se),de=n(540),ue=n.n(de),ce=n(1113),pe=n.n(ce),fe=n(5311),he={};he.styleTagTransform=pe(),he.setAttributes=le(),he.insert=oe().bind(null,"head"),he.domAPI=ie(),he.insertStyleElement=ue(),ne()(fe.A,he),fe.A&&fe.A.locals&&fe.A.locals,n(9199),n(8671),n(9320),n(2591),n(6129),n(9103),n(875),n(9385),setTimeout((function(){Promise.resolve().then(n.t.bind(n,5237,23)).then((()=>{n.e(576).then(n.t.bind(n,576,23)),n.e(319).then(n.bind(n,5319))}))}),0);var ge=H.A.isMac,me={Ctrl:"Ctrl+",Alt:"Alt+",Shift:"Shift+"};ge&&(me={Ctrl:"âŒ˜",Alt:"âŒ¥",Shift:"â‡§"});var ve,ye={error:{cssClass:"alert-danger",title:gettext("Error"),icon:"fa fa-exclamation-circle"},"parse-warning":{cssClass:"alert-warning",title:gettext("Warning"),icon:"fa fa-warning"},"form-warning":{cssClass:"alert-warning",title:gettext("Form Warning"),icon:"fa fa-info-circle"},info:{cssClass:"alert-info",title:gettext("Notification"),icon:"fa fa-info-circle"}},xe={isCurrentlySelectedMugValid:function(){var e=this.getCurrentlySelectedMug();return!e||(e.validate(),!e.hasErrors())},init:function(){this.data.core.mugTypes=new V.A.MugTypesManager(this.getMugSpec(),this.getMugTypes(),this.opts());var e=this,t=this.opts().core.bindBeforeUnload;this.data.core.saveButton=a.init({save:function(t){var n=t&&t.altKey;n&&!window.confirm(gettext("Holding the ALT key while clicking save invokes an inefficient save procedure. Do this only if a normal save fails."))||(e.ensureCurrentMugIsSaved((function(){W().workflow("Clicked Save in the form builder"),e.validateAndSaveXForm(n)})),e.data.core.form.walkMugs((function(e){e.__originalNodeID=e.p.nodeID,e.dropMessage("nodeID","mug-nodeID-changed-warning")})))},unsavedMessage:gettext("Are you sure you want to exit? All unsaved changes will be lost!"),csrftoken:e.opts().csrftoken});var n=i.Ay.debounce((function(){var t,n="<div class='alert alert-danger'>{error}<br/>{action}</div>",a="<i class='fd-valid-alert-icon fa fa-warning'></i>";return e.data.core.form.hasBrokenReferences()?(t=gettext("Look for questions marked with $1 and check they don't reference deleted questions."),{title:gettext("Errors in Form"),content:H.A.format(n,{error:gettext("Form has reference errors."),action:t.replace("$1",a)})}):e.isCurrentlySelectedMugValid()?{title:"",content:""}:(t=gettext("Look for questions marked with $1 and fix the errors."),{title:"Validation Failed",content:H.A.format(n,{error:gettext("Form has validation errors."),action:t.replace("$1",a)})})}),500,!0);e.data.core.saveButton.ui.popover({title:function(){return n().title},content:function(){return n().content},html:!0,placement:"bottom",container:"body",trigger:"hover",sanitize:!1}),e.data.core.saveButton.ui.on("click",(function(){o()(this).popover("hide")})),t(this.data.core.saveButton.beforeunload),this.data.core.lastSavedXForm=this.opts().core.form,this.$f.addClass("formdesigner");var r=i.Ay.extend({format:H.A.format},me);this.$f.empty().append(u()(r)),o()(document).on("keydown",(function(t){var n=H.A.getKeyChord(t);(xe.hotkeys[n]||i.Ay.identity).call(e,t)})),o()(document).on("click",".jstree-hover",(function(t){t.preventDefault();var n=o()(this).data("ufid");e.scrollTreeTo(n),W().fbUsage("Clicked link to show in tree"),W().workflow("Clicked on easy reference popover's link to show in tree")})),o()(window).on("hashchange",(function(){e.selectSomethingOrHideProperties(!0,window.location.hash)})),this._init_toolbar(),this._init_add_question(),this._createJSTree(),this.datasources=X.A.init(this.opts().core.dataSourcesEndpoint,this.opts().core.invalidCaseProperties)},postInit:function(){var e=this;function t(){e.opts().core.onReady.apply(e)}e.opts().features.allow_bulk_form_actions&&this._init_bulk_update_questions(),this._init_extra_tools(),z.A.init(this),this.loadXFormOrError(this.opts().core.form,(function(){setTimeout(t,0)}))},hotkeys:{"Ctrl+Alt+=":function(){this.data.core.$tree.jstree("open_all")},"Ctrl+Alt+-":function(){this.data.core.$tree.jstree("close_all")}},getMugTypes:function(){return V.A.baseMugTypes},_init_add_question:function(){var e=this,t=e.$f.find(".fd-add-question-dropdown");this.data.core.QUESTIONS_IN_TOOLBAR=[],i.Ay.each(e.getQuestionGroups(),(function(t){t.questions=i.Ay.map(t.questions,(function(t){var n=e.data.core.mugTypes[t],a=[t,n.typeName,n.icon];return e.data.core.QUESTIONS_IN_TOOLBAR.push(t),a}))})),t.find(".fd-add-question").after(o()(p()({groups:i.Ay.map(e.getQuestionGroups(),(function(t){var n=e.data.core.mugTypes[t.group[0]];return{name:t.group[1]||n.typeName,defaultQuestion:{slug:t.group[0],name:t.group[1]||n.typeName,icon:t.group[2]||n.icon},questions:i.Ay.map(t.questions,(function(t){var n=e.data.core.mugTypes[t];return{slug:t,name:n.typeName,icon:n.icon}}))}}))}))),t.find(".fd-question-type").click((function(t){o()(this).hasClass("disabled")||e.addQuestion(o()(this).data("qtype")),t.preventDefault()}))},_init_toolbar:function(){var e=this.$f.find(".fd-save-button");this.data.core.saveButton.ui.appendTo(e)},getQuestionGroups:function(){let e={group:["Image",gettext("Multimedia Capture")],questions:["Image","Audio","Video","Signature"]};return this.opts().features.support_document_upload&&e.questions.push("Document"),this.opts().features.case_micro_image&&e.questions.push("MicroImage"),[{group:["Text"],questions:["Text"]},{group:["Select",gettext("Multiple Choice")],questions:["Select","MSelect"]},{group:["Int",gettext("Number")],questions:["Int","PhoneNumber","Double"]},{group:["Date",gettext("Date")],questions:["Date","Time","DateTime"]},{group:["Group",gettext("Groups")],questions:["Group","Repeat","FieldList"]},e,{group:["Trigger"],questions:["Trigger"]},{group:["DataBindOnly",gettext("Hidden Value")],questions:["DataBindOnly"]},{group:["Geopoint",gettext("Advanced"),""],textOnly:!0,questions:this.getAdvancedQuestions()}]},getAdvancedQuestions:function(){return["Geopoint","Barcode","Secret"]},_init_bulk_update_questions:function(){var e=this,t=this.getBulkUpdateMenuItems(),n=this.$f.find(".fd-bulk-update-header");n.nextUntil(".divider").remove(),(0,i.Ay)(t).each((function(t){var a=o()(H.A.format("<a tabindex='-1' href='#'>{name}</a>",i.Ay.extend(t))).click((function(n){n.preventDefault(),e.showConfirmBulkActionModal(t.confirmMessage,t.confirmAction)})),r=o()("<li></li>").append(a);n.after(r),n=r}))},getBulkUpdateMenuItems:function(){var e=this,t=[{name:gettext("Make Required"),confirmMessage:gettext("You are about to make all existing questions on this form required. This action will overwrite the current configuration of this form and can only be undone by editing individual questions."),confirmAction:function(){e.makeAllQuestionsRequired()}}];return e.data.core.databrowser&&t.push({name:gettext("Load Default Values"),confirmMessage:gettext("You are about to set matching case properties as Default Values for all existing questions. This action will overwrite existing Default Values for all questions with matching case properties and can only be undone by editing individual questions."),confirmAction:function(){e.defaultMatchingQuestionsToCaseProperties()}}),t},makeAllQuestionsRequired:function(){this.data.core.form.walkMugs((function(e){e.spec.requiredAttr&&e.isVisible("requiredAttr")&&(e.p.requiredAttr=!0)})),this.refreshCurrentMug()},defaultMatchingQuestionsToCaseProperties:function(){var e=this,t=e.datasources.getHashtagMap({});e.data.core.form.walkMugs((function(e){if(e.isVisible("defaultValue")){var n="#case/"+e.p.nodeID,a="#user/"+e.p.nodeID;t.hasOwnProperty(n)?e.p.defaultValue=n:t.hasOwnProperty(a)&&(e.p.defaultValue=a)}})),e.refreshCurrentMug()},showConfirmBulkActionModal:function(e,t){var n,a=this;(n=this.generateNewModal(gettext("Are you sure you want to perform this action?"),[{title:gettext("Continue"),cssClasses:"btn-primary",action:function(){a.closeModal(),t()}}],gettext("Cancel"))).find(".modal-body").html(o()("<p></p>").text(e)),n.modal("show")},_init_extra_tools:function(){var e=this,t=this.getToolsMenuItems(),n=this.$f.find(".fd-tools-menu");n.nextUntil(".divider").remove(),(0,i.Ay)(t).each((function(t){var a=t.hotkey||"",r="";a&&(xe.hotkeys[a]=function(){t.action.apply(e,(function(){}))},r="<span class='hotkey'>"+(r=a.replace(/(Ctrl|Alt|Shift)\+/g,(function(e,t){return me[t]||t})))+"</span>");var s=o()(H.A.format("<a tabindex='-1' href='#'><i class='{icon}'></i> {name}{key}</a>",i.Ay.extend({key:r},t))).click((function(n){n.preventDefault(),e.ensureCurrentMugIsSaved((function(){W().fbUsage("Tools",t.name),t.action.call(e,(function(){e.refreshVisibleData()}))}))})),l=o()("<li></li>").append(s);n.after(l),n=l})),this.$f.find(".fd-expand-all").click((function(){e.data.core.$tree.jstree("open_all")})),this.$f.find(".fd-collapse-all").click((function(){e.data.core.$tree.jstree("close_all")})),this.$f.find(".fd-button-copy").click((function(){W().usage("Copy Paste","Copy Button"),W().workflow("Clicked Copy Button in form builder"),e.ensureCurrentMugIsSaved((function(){e.displayMultipleSelectionView();var t=e.jstree("get_selected");t.length&&o()("#"+t[0]+" a").focus()}))})),this.$f.find(".fd-content-right").on("click",".fd-section-changer .dropdown-menu a",(function(t){var n=o()(t.target);e.collapseSection(n.data("slug"),n.hasClass("selected"))}))},toggleFullScreen:function(){var e=this,t=gettext("Expand Editor"),n=gettext("Shrink Editor"),a=new RegExp(RegExp.escape(t)+"|"+RegExp.escape(n)),r=o()(i.Ay.find(e.$f.find(".fd-tools-menu").nextAll(),(function(e){return o()(e).find("a").text().match(a)}))).find("a"),s=r.html();W().fbUsage("Full Screen Mode",e.opts().core.formid),e.data.windowManager.fullscreen?(e.data.windowManager.fullscreen=!1,r.html(s.replace(new RegExp(RegExp.escape(n)),t))):(e.data.windowManager.fullscreen=!0,r.html(s.replace(new RegExp(RegExp.escape(t)),n))),r.find("i").toggleClass("fa-down-left-and-up-right-to-center").toggleClass("fa-up-right-and-down-left-from-center"),e.adjustToWindow(),e.opts().windowManager.toggleFullScreenCallback&&e.opts().windowManager.toggleFullScreenCallback(e.data.windowManager.fullscreen)},getToolsMenuItems:function(){var e=this;return[{name:gettext("Expand Editor"),icon:"fa-solid fa-up-right-and-down-left-from-center",hotkey:"Ctrl+Alt+F",action:function(t){e.toggleFullScreen()}},{name:gettext("Export Form Contents"),icon:"fa-regular fa-file-excel",action:function(t){e.showExportModal(t)}},{name:gettext("Edit Source XML"),icon:"fa fa-edit",action:function(t){e.showSourceXMLModal(t)}},{name:gettext("Form Properties"),icon:"fa-regular fa-rectangle-list",action:function(t){e.showFormPropertiesModal(t)}},{name:gettext("Find Usages"),icon:"fa fa-search",action:function(t){e.findUsages(t)}}]},refreshVisibleData:function(){var e=this;this.data.core.form.getMugList().map((function(t){e.refreshMugName(t)})),this.refreshCurrentMug()},refreshCurrentMug:function(){var e=this.getCurrentlySelectedMug();e&&this.displayMugProperties(e)},getMugDisplayName:function(e){var t=this.data.core.currentItextDisplayLanguage||this.data.javaRosa.Itext.getDefaultLanguage(),n=e.getDisplayName(t,!1);return n&&e._core_cachedDisplayNameKey===n?e._core_cachedDisplayNameValue:(e._core_cachedDisplayNameKey=n,n=e.form.richText?B.A.bubbleOutputs(n,this.data.core.form,!1):$.A.outputToXPath(n,e.form.xpath,!0),e._core_cachedDisplayNameValue=n,n)},_resizeFullScreenModal:function(e){var t,n,a;t=e.find(".modal-header").outerHeight(!1),n=e.find(".modal-footer").outerHeight(!1),a=o()(window).height()-40-(n-t)-126,e.find(".modal-body").css("height",a+"px")},showSourceXMLModal:function(e){var t,n,a,i,r=this,s=this.data.core.form.isFormValid((function(e){return e.validate(),!e.hasErrors()}))?"":" <i class='fd-valid-alert-icon fa fa-warning'></i> "+gettext("Validation failed. Form may not perform correctly on your device!");t=this.generateNewModal(gettext("Edit Form's Source XML")+s,[{title:gettext("Update Source"),cssClasses:"btn-primary",action:function(){i.save(),r.loadXFormOrError(a.val(),(function(){t.modal("hide"),e()}),!0)}}]),n=o()(h()({description:gettext("This is the raw XML. You can edit or paste into this box to make changes to your form. Press 'Update Source' to save changes, or 'Close' to cancel.")})),t.addClass("fd-full-screen-modal").find(".modal-body").removeClass("form-horizontal").removeClass("form").html(n),this._resizeFullScreenModal(t),a=n.find("textarea"),this.data.core.formLoadingFailed?a.val(this.data.core.failedLoadXML):a.val(this.createXML(!0)),i=l().fromTextArea(a.get(0),{mode:"xml",lineNumbers:!0,viewportMargin:1/0}),t.modal("show"),t.one("shown.bs.modal",(function(){var e=t.find(".modal-body"),n=e.height(),a=e.find("p").outerHeight(!0);i.setSize("100%",n-a),i.refresh(),i.focus()}))},showExportModal:function(e){var t,n;t=this.generateNewModal(gettext("Export Form Contents"),[]),n=o()(h()({description:gettext("Copy and paste this content into a spreadsheet program like Excel to easily share your form with others.")})),t.find(".modal-body").html(n);var a=n.find("textarea");a.val(this.data.core.form.getExportTSV()),t.modal("show"),t.one("shown.bs.modal",(function(){a.focus()}))},showOverwriteWarning:function(e,t,n){var a,i,r=this;a=r.generateNewModal(gettext("Lost Work Warning"),[{title:gettext("Overwrite their work"),cssClasses:"btn-primary",defaultButton:!0,action:function(){o()("#form-differences").hide(),e(t,"full"),r.closeModal()}},{title:gettext("Show XML Differences"),cssClasses:"btn-info",action:function(){o()("#form-differences").show(),a.addClass("fd-full-screen-modal").removeClass("form-horizontal").find(".modal-body").html(i),r._resizeFullScreenModal(a),a.find(".btn-info").prop("disabled",!0)}}],gettext("Cancel"),"fa fa-warning"),i=o()(m()({description:gettext("Looks like someone else has edited this form since you loaded the page. Are you sure you want to overwrite their work?"),xmldiff:H.A.htmlXMLDiff(t,n||"")})),a.find(".modal-body").html(i),o()("#form-differences").hide(),a.modal("show")},showFormPropertiesModal:function(){var e=this,t=this.generateNewModal(gettext("Edit Form Properties"),[]),n=t.find(".modal-body"),a=[{label:gettext("Disable Text Formatting"),slug:"noMarkdown",type:"checkbox",value:function(e,t){return t?e.prop("checked",t):e.prop("checked")}}];this.opts().features.rich_text&&a.push({label:gettext("Use Easy References"),slug:"richText",type:"checkbox",value:function(e,t){return t?e.prop("checked",t):e.prop("checked")}}),i.Ay.each(a,(function(t){var a=o()(y()({label:t.label,type:t.type||"text"}));n.append(a),a.find("input").val(e.data.core.form[t.slug]).on("change",(function(){var n=o()(this),a=n.val();t.value&&(a=t.value(n)),e.data.core.form.setAttr(t.slug,a),e.refreshVisibleData()})),t.value&&t.value(a.find("input"),e.data.core.form[t.slug])})),t.modal("show"),t.one("shown.bs.modal",(function(){n.find("input:first").focus().select()}))},findUsages:function(){var e=this,t=this.generateNewModal(gettext("Use of each question"),[]),n=t.find(".modal-body"),a=e.data.core.form,r=a.findUsages();t.addClass("fd-full-screen-modal"),n.append(o()(L()())),n.append(o()(R()({tableData:r}))),this._resizeFullScreenModal(t),t.modal("show"),n.find(".link-to-question").click((function(){var n=o()(this).text();return t.modal("hide"),e.setCurrentMug(a.getMugByPath(n)),!1})),n.find("#findUsagesSearch").on("keypress inserted.atwho",i.Ay.debounce((function(){var e=o().trim(this.value),t={};e?i.Ay.each(r,(function(n,a){a.includes(e)?t[a]=n:i.Ay.each(n,(function(n,i){i.includes(e)&&(t[a]||(t[a]={}),t[a][i]=n)}))})):t=r,n.find("table").remove(),n.append(o()(R()({tableData:t})))}),250)),G.A.autocomplete(o()("#findUsagesSearch"),e.getCurrentlySelectedMug(),{useRichText:!0})},closeModal:function(e,t){var n=this,a=n.$f.find(".fd-modal-generic-container .modal");e&&a.one("hidden.bs.modal",(function(){e.apply(n)})),t&&a.removeClass("fade"),a.modal("hide")},generateNewModal:function(e,t,n,a){void 0===n&&(n=gettext("Close")),t.reverse(),t=i.Ay.map(t,(function(e){return e.cssClasses=e.cssClasses||"",e}));var r=this,s=r.$f.find(".fd-modal-generic-container");r.closeModal(void 0,!0);var l=o()(S()({title:e,closeButtonTitle:n,headerIcon:a}));return l.one("shown.bs.modal",(function(){l.find(".btn-default:last").focus()})),i.Ay.each(t,(function(e){e.defaultButton=e.defaultButton||!1,e.action=e.action||function(){r.closeModal()},l.find(".modal-footer").prepend(o()(E()(e)).click(e.action))})),s.html(l),l}},be=function(){var e=o()("<div><div><i class='fa fa-spin fa-spinner'></i></div></div>");e.addClass("fd-form-saving"),o()("body").append(e)},Ae=function(){o()(".fd-form-saving").remove()};function we(e,t){var n=t.p.getDefinition(e);return n&&t.isVisible(e)?{widget:n.widget||j.A.text,options:o().extend(!0,{path:e},n)}:null}xe.handleDropFinish=function(e,t,n,a){var i=e.closest(".xpath-expression-row").find(".op-select");if(e){j.A.util.getWidget(e,this).options.richText&&this.data.core.form.richText?B.A.editor(e).insertExpression(t):e.val(e.val()+t).change();var r,o=H.A.getReferenceName(t);switch(e[0].id){case"property-relevantAttr":r="Display";break;case"property-constraintAttr":r="Validation";break;case"property-calculateAttr":r="Calculation";break;default:r="Expression Editor"}W().usage(o,"Drag and Drop",r)}n&&i&&n.options.defaultOperator&&i.val(n.options.defaultOperator)},xe._createJSTree=function(){ve={"#":{valid_children:this.data.core.mugTypes.Group.validChildTypes},default:{icon:"fa fa-question-circle",max_children:0,valid_children:[]}},(0,i.Ay)(this.data.core.mugTypes.allTypes).each((function(e,t){ve[t]={icon:e.icon,max_children:e.maxChildren,valid_children:e.validChildTypes}}));var e,t=this;this.data.core.$tree=e=this.$f.find(".fd-question-tree"),e.jstree({core:{data:[],worker:!1,multiple:!0,strings:{"New node":this.opts().core.noTextString},check_callback:function(e,n,a,i,r){return"move_node"!==e||t.checkMove(n.id,n.type,a.id,a.type,i)}},dnd:{copy:!1,inside_pos:"last"},types:ve,conditionalevents:{should_activate:function(){return t.ensureCurrentMugIsSaved()},redraw_node:function(e){var t=Array.prototype.slice.call(arguments),n=this.parent.redraw_node.apply(this.inst,t);return e=this.inst.get_node(e),n&&e.data&&e.data.errors&&o()(n).find("a > i").first().after(e.data.errors),n}},plugins:["themes","types","dnd","conditionalevents","actions"]}).on("select_node.jstree deselect_node.jstree",(function(e,n){var a=t.jstree("get_selected");if(a.length)if(a.length<2){var i=t.data.core.form.getMugByUFID(a[0]);t.displayMugProperties(i),t._setURLHash(i)}else t.displayMultipleSelectionView();else t.hideQuestionProperties()})).on("open_node.jstree",(function(e,n){window.event&&window.event.altKey&&t.jstree("open_all",n.node);var a=t.data.core.form.getMugByUFID(n.node.id);t.data.core.form.getDescendants(a).map((function(e){t.refreshMugName(e)}))})).on("close_node.jstree",(function(e,n){window.event&&window.event.altKey&&t.jstree("close_all",n.node)})).on("move_node.jstree",(function(e,n){var a=t.data.core.form,i=a.getMugByUFID(n.node.id),r="#"!==n.parent?a.getMugByUFID(n.parent):null,o=t.getRelativePosition(r,n.position);a.moveMug(i,o.position,o.mug),n.node.icon=i.getIcon(),t.refreshCurrentMug()})).on("model.jstree",(function(e,n){(0,i.Ay)(n.nodes).each((function(e){var n=t.jstree("get_node",e);n.data.mug&&(n.icon=n.data.mug.getIcon())}))}))},o()(document).one("dnd_move.vakata.jstree",(function(e,t){o()(document).on("dnd_move.vakata.jstree",(function(e,t){o()(".jstree-drop").addClass("jstree-drop-active");var n=o()(t.data.obj),a=o()(t.event.target);o().jstree.reference(a)||a.vellum("get")!==n.vellum("get")||(a.closest(".jstree-drop").length?t.helper.find(".jstree-icon").removeClass("jstree-er").addClass("jstree-ok"):t.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"))})).on("dnd_stop.vakata.jstree",(function(e,t){o()(".jstree-drop").removeClass("jstree-drop-active");var n=o()(t.data.obj).vellum("get"),a=o()(t.event.target);if(!o().jstree.reference(a)&&a.closest(".jstree-drop").length&&n===a.vellum("get")&&t.data.origin){var i=t.data.origin.get_node(t.data.nodes[0]);i.data&&i.data.handleDrop&&i.data.handleDrop(a.closest(".jstree-drop"),t.event)}}))})),xe.scrollTreeTo=function(e){this.jstree("_open_to",e),this.jstree("hover_node",e);var t=o()(".jstree-hovered");if(t.length){var n=t.closest(".fd-scrollable"),a=n.offset().top,i=n.height(),r=t.offset().top,s=t.height(),l=r-t.closest(".fd-question-tree").offset().top;(r<a||r+s>a+i)&&n.scrollTop(l-(i-s)/2)}},xe.getRelativePosition=function(e,t){if(!i.Ay.isNumber(t))return{mug:e,position:t};if(0===t)return{mug:e,position:"first"};var n=this.jstree("get_node",e?e.ufid:"#");return t>n.children.length?{mug:e,position:"last"}:{mug:this.jstree("get_node",n.children[t-1]).data.mug,position:"after"}},xe.checkMove=function(e,t,n,a,i){var r=this.data.core.form,o=r.getMugByUFID(n),s=r.getMugByUFID(e);return!!s&&("inside"===i&&(i="into"),!!this.isMugPathMoveable(s.hashtagPath)||("into"===i||"last"===i||"first"===i?s.parentMug===o:s.parentMug===o.parentMug))},xe.onFormChange=function(e){this.data.core.saveButton.fire("change"),this.notifyUserActivity()},xe.notifyUserActivity=function(){var e=Date.now(),t=this.opts().core.activityTimeout||3e5,n=this.opts().core.activityUrl;n&&(this.data.core.activityTimestamp?e-this.data.core.activityTimestamp>=t&&(this.data.core.activityTimestamp=e,i.Ay.isFunction(n)?n():o().get(n)):this.data.core.activityTimestamp=e)},xe.jstree=function(){var e=this.data.core.$tree;return e.jstree.apply(e,arguments)},xe.getCurrentlySelectedMug=function(e,t){var n=this.jstree("get_selected"),a=this.data.core.form;if(e){if(t&&n.length>1){var r=i.Ay.object(i.Ay.map(n,(function(e){return[e,!0]}))),o=n.length,s=[];return a.tree.walk((function(e,t,n){e&&r.hasOwnProperty(e.ufid)&&s.push(e),s.length!==o&&n()})),s}return i.Ay.map(n,a.getMugByUFID.bind(a))}return n.length?a.getMugByUFID(n[0]):null},xe.getCurrentMugInput=function(e){return this.$f.find("[name=property-"+e+"]")},xe.mugToXPathReference=function(e){return"Choice"===e.__className?"'"+e.p.nodeID+"'":e.ufid===this.getCurrentlySelectedMug().ufid?".":e.form.richText?e.hashtagPath:e.absolutePath},xe.nodeIDFromLabel=function(e){var t=this.getMugDisplayName(e)||"";return t=(t=(t=(t=(t=(t=(t=(t=o()("<div/>").html(t).text()).toLowerCase()).trim()).replace(/\s+/g,"_")).replace(/[^\w\-]/g,"")).replace(/^[^a-z]*/i,"")).replace(/_*$/g,"")).substring(0,75),e.form.generate_question_id(t,e)},xe.ensureCurrentMugIsSaved=function(e){var t=this.getCurrentlySelectedMug();return this.data.core.hasXPathEditorChanged?(this.alert(gettext("Unsaved Changes in Editor"),gettext("You have UNSAVED changes in the Expression Editor. Please save changes before continuing.")),!1):(t&&!t.p.nodeID&&(t.p.nodeID=this.nodeIDFromLabel(t)),(e||function(){})(),!0)},xe.loadXFormOrError=function(e,t,n){t=t||function(){};var a=this;a.opts().core.formLoadingCallback?a.opts().core.formLoadingCallback():be(),window.setTimeout((function(){a.data.core.formLoadingFailed=!1;try{a.data.core.parseWarnings=[],a.loadXML(e,{}),delete a.data.core.parseWarnings,a.data.core.form.fire("form-load-finished"),e?n&&a.data.core.saveButton.fire("change"):(a.$f.find(".fd-content-right .fd-column").addClass("hide"),a.$f.find(".fd-default-panel").removeClass("hide")),a.opts().core.formIconClass?a.$f.find(".fd-form-icon").addClass(a.opts().core.formIconClass):a.$f.find(".fd-form-icon").addClass("fa fa-edit"),a.opts().core.defaultHelpTextTemplateId&&a.$f.find(".fd-default-helptext").html(o()(a.opts().core.defaultHelpTextTemplateId).html()).addClass("alert alert-info"),o()(".fd-tree .fd-head-text").text(a.data.core.form.formName),a.opts().core.formLoadedCallback?a.opts().core.formLoadedCallback():Ae()}catch(t){window.console.log(H.A.formatExc(t));var i=t.toString();-1!==i.indexOf("Invalid XML")&&(i=gettext("Parsing Error. Please check that your form is valid XML.")),a.hideQuestionProperties();var r=a.generateNewModal(gettext("Error"),[],gettext("OK"),"fa fa-warning");throw r.find(".modal-body").text(i),r.modal("show"),a.data.core.formLoadingFailed=!0,a.data.core.failedLoadXML=e,a.opts().core.formLoadedCallback?a.opts().core.formLoadedCallback():Ae(),t}t()}),this.opts().core.loadDelay)},xe.loadXML=function(e,t,n){var a,r=this,s=window.location.hash;r.data.core.$tree.children().children().each((function(e,t){r.jstree("delete_node",t)})),t=i.Ay.extend({mugTypes:this.data.core.mugTypes,allowedDataNodeReferences:this.opts().core.allowedDataNodeReferences,enableInstanceRefCounting:!0},t),this.data.core.form&&this.data.core.form.disconnectDataSources(),this.data.core.form=a=z.A.parseXForm(e,t,this,r.data.core.parseWarnings,n),this.onXFormLoaded(a),e&&(r._resetMessages(r.data.core.form.errors),r._populateTree(s)),a.on("question-type-change",(function(e){r.jstree("set_type",e.mug.ufid,e.qType),e.mug===r.getCurrentlySelectedMug()&&r.refreshCurrentMug()})).on("parent-question-type-change",(function(e){r.jstree("set_icon",e.childMug.ufid,e.childMug.getIcon())})).on("question-remove",(function(e){e.mug&&(e.mug.unbind(r.data.core),e.mug===r._propertiesMug&&(r._propertiesMug.teardownProperties(),r._propertiesMug=null));var t=r.getCurrentlySelectedMug();if(e.mug&&e.mug.parentMug&&e.mug.parentMug===t&&r.displayMugProperties(t),!e.isInternal){var n=r.jstree("get_prev_dom",e.mug.ufid);r.jstree("delete_node",e.mug.ufid),n?r.jstree("select_node",n):r.selectSomethingOrHideProperties()}e.mug._node_control=void 0,o()(".fd-undo").click((function(){return r.ensureCurrentMugIsSaved(a.undo.bind(a)),!1})),o()(".fd-undo-container").on("click",".close",(function(){a.undomanager.resetUndo()}))})).on("question-create",(function(e){r.handleNewMug(e.mug,e.refMug,e.position),r.setTreeActions(e.mug);var t=r.getCurrentlySelectedMug();e.mug&&e.mug.parentMug&&e.mug.parentMug===t&&r.displayMugProperties(t),e.isInternal||r.setCurrentMug(e.mug)})).on("change",(function(e){r.onFormChange(e.mug)})).on("question-label-text-change",(function(e){r.refreshMugName(e.mug),r.toggleConstraintItext(e.mug)})).on("change-display-language",(function(e){var t=r.getCurrentlySelectedMug();t&&r.refreshMugName(t)})).on("mug-property-change",(function(e){r.refreshMugName(e.mug),r.toggleConstraintItext(e.mug),"comment"===e.property&&e.val&&(r.$f.find(".fd-question-comment").show(),r.$f.find(".fd-question-comment").text(e.val))}))},xe.onXFormLoaded=function(e){e.warnWhenChanged=this.opts().core.hasSubmissions,e.submissionUrl=this.opts().core.hasSubmissionsUrl},xe.refreshMugName=function(e){var t=this.getMugDisplayName(e);t!==this.jstree("get_text",e.ufid)&&this.jstree("rename_node",e.ufid,t);var n=this.getCurrentlySelectedMug();n&&e.ufid===n.ufid&&this.$f.find(".fd-question-properties .fd-head h2").html(t)},xe.toggleConstraintItext=function(e){var t=this.getCurrentlySelectedMug();if(!t||t.ufid===e.ufid){var n=e.p.constraintMsgItext&&(!e.p.constraintMsgItext.isEmpty()||e.p.constraintAttr),a=o()(".itext-block-constraintMsg");n?a.removeClass("hide"):a.addClass("hide")}},xe._populateTree=function(e){var t=this;this.data.core.form.walkMugs((function(e){t.handleMugParseFinish(e),t.createQuestion(e,e.parentMug,"into")&&(!e.validate()&&e.hasErrors()&&t.setTreeValidationIcon(e),t.setTreeActions(e))})),t.selectSomethingOrHideProperties(!0,e)},xe.selectSomethingOrHideProperties=function(e,t){if(e&&this.jstree("deselect_all"),!this.jstree("get_selected").length){var n,a=this.data.core.$tree.find("li");if(t){var i=this.getMugByPath(t)||void 0,r=i&&i.ufid;r&&(n=a.filter("[id= "+r+"]"))}return n&&n.length>0?(this.jstree("select_node",n[0]),this.scrollTreeTo(n[0].id),!0):a.length>0?(this.jstree("select_node",a[0]),this.scrollTreeTo(a[0].id),!0):(this.jstree("deselect_all"),this.hideQuestionProperties(),this.$f.find(".fd-content-right .fd-column").addClass("hide"),this.$f.find(".fd-default-panel").removeClass("hide"),!1)}return!0},xe.addQuestion=function(e,t,n){var a,i=this;return this.ensureCurrentMugIsSaved((function(){if(t){if(!/^(before|after|into|first|last)$/.test(t))throw new Error("bad position: "+t);if(!i.isInsertAllowed(e,t,n))throw new Error("cannot insert "+e+" "+t+" "+(n?n.hashtagPath:"root node"))}else{var r=i.getInsertTargetAndPosition(i.getCurrentlySelectedMug(),e);if(!r)throw new Error("cannot add "+e+" at the current position");t=r.position,n=r.mug}W().workflow("Added question in form builder"),a=i.data.core.form.createQuestion(n,t,e),i.scrollTreeTo(a.ufid),i.focusFirstInput()})),a},xe.focusFirstInput=function(){var e=this.$f.find(".fd-question-properties .form-group:first");if(e.length){var t=e.find("input, textarea");t.length?t.focus():(t=e.find(".fd-textarea, .fd-input"),B.A.editor(t).focus())}},xe.adjustToWindow=function(){this.data.windowManager.adjustToWindow()},xe.getInsertTargetAndPosition=function(e,t,n){for(var a,i=n?"after":"last";e;){if("after"===i){if(!(a=e.parentMug)){if(!this.isInsertAllowed(t,i,e))return null;break}}else a=e;if(this.jstree("is_closed",a.ufid))e=a,i="after";else{if(-1!==ve[a.__className].valid_children.indexOf(t))break;"after"!==i?i="after":e=e.parentMug}}return e||this.isInsertAllowed(t,i,e)?{mug:e,position:i}:null},xe.isInsertAllowed=function(e,t,n){var a="#";if(n)if("after"===t||"before"===t)n.parentMug&&(a=n.parentMug.__className);else{if("into"!==t&&"first"!==t&&"last"!==t)throw new Error("validation of insert "+t+" "+n.__className+" not implemented");a=n.__className}else if("into"!==t&&"first"!==t&&"last"!==t)throw new Error("validation of insert "+t+" root node not implemented");return-1!==ve[a].valid_children.indexOf(e)},xe.handleNewMug=function(e,t,n){this.createQuestion(e,t,n)},xe.createQuestion=function(e,t,n){var a=this;return e.on("messages-changed",(function(e){a.setTreeValidationIcon(e.mug)}),null,null,this.data.core),a.jstree("create_node",t?"#"+t.ufid:"#",{text:this.getMugDisplayName(e),type:e.__className,data:{mug:e,handleDrop:function(t,n){var i=a.mugToXPathReference(e);a.handleDropFinish(t,i,e,n)}},li_attr:{id:e.ufid,rel:e.__className},state:{opened:!0}},"into"===n?"last":n)},xe.handleMugParseFinish=function(e){},xe.getMugByPath=function(e){return this.data.core.form.getMugByPath(e)},xe.setCurrentMug=function(e){this.jstree("deselect_all",!0).jstree("select_node",e.ufid)},xe.displayMugProperties=function(e){var t=this.$f.find(".fd-question-properties");this.$f.find(".fd-default-panel").addClass("hide"),this.showContentRight(),t.addClass("hide"),this._setPropertiesMug(e);var n=this.$f.find(".fd-props-content").empty(),a=this.getSections(e),r=o()("<div class='messages' />");this.$f.find(".fd-props-toolbar").html(this.getMugToolbar(e));for(var s=0;s<a.length;s++){var l=i.Ay.clone(a[s]);l.mug=e,l.properties=(0,i.Ay)(l.properties).map((function(t){return we(t,e)})).filter(i.Ay.identity),l.properties.length&&this.getSectionDisplay(e,l).appendTo(n)}function d(){r.empty().append(j.A.util.getMessages(e,null))}n.children().length?r.insertAfter(n.children().first()):r.appendTo(n),e.on("messages-changed",d,null,"teardown-mug-properties"),d(),this.$f.find(".fd-content-right .fd-column").addClass("hide"),t.removeClass("hide"),this.adjustToWindow(),this.$f.find(".fd-help a").fdHelp(),this.refreshMugName(e),this.toggleConstraintItext(e)},xe._setURLHash=function(e){e&&void 0!==e.getNodeID()&&e.hashtagPath&&e.hashtagPath.startsWith("#")&&!e.hashtagPath.endsWith("/")?window.history.replaceState(null,null,e.hashtagPath):window.history.replaceState(null,null," ")},xe._setPropertiesMug=function(e){if(this._propertiesMug){this._propertiesMug.teardownProperties();try{this._propertiesMug.validate()}catch(e){}}this._propertiesMug=e},xe.displayMultipleSelectionView=function(){var e=this.getCurrentlySelectedMug(!0);this.showContentRight(),this.hideQuestionProperties(),this._setPropertiesMug(null),this.$f.find(".fd-props-toolbar").html(this.getMugToolbar(e,!0)),this.$f.find(".fd-props-content").empty(),this.showQuestionProperties()},xe.showContentRight=function(){this.$f.find(".fd-content-right").show()},xe.hideContentRight=function(){this.$f.find(".fd-content-right").hide()},xe.showQuestionProperties=function(){this.$f.find(".fd-content-right .fd-column").addClass("hide"),this.$f.find(".fd-question-properties").removeClass("hide")},xe.hideQuestionProperties=function(){this.$f.find(".fd-question-properties").addClass("hide")},xe.displaySecondaryEditor=function(e){var t=this,n=this.$f.find(".fd-xpath-editor");n.find(".fd-head h2").text(e.headerText),e.DEBUG_MODE=!1,this.hideQuestionProperties();var a=e.done;e.done=function(e){a(e),t.data.core.hasXPathEditorChanged?(t.data.core.hasXPathEditorChanged=!1,n.addClass("hide"),t.refreshCurrentMug()):(n.addClass("hide"),t.showQuestionProperties())};var i=e.change;e.change=function(e){t.data.core.hasXPathEditorChanged=!0,i&&i(e)},t.$f.find(".fd-content-right .fd-column").addClass("hide"),n.removeClass("hide"),e.loadEditor(t.$f.find(".fd-xpath-editor-content"),e)},xe.displayXPathEditor=function(e){e.headerText=gettext("Expression Editor"),e.loadEditor=function(e,t){n.e(319).then(n.bind(n,5319)).then((n=>{n.default.showXPathEditor(e,t)}))},this.displaySecondaryEditor(e)},xe.alert=function(e,t,n){if(n=n||[],!this.data.core.isAlertVisible){var a=this;this.data.core.isAlertVisible=!0,n.length||n.push({title:gettext("OK"),defaultButton:!0});var i=this.generateNewModal(e,n,!1,"fa fa-warning");this.data.core.$modal=i,i.removeClass("fade"),t instanceof o()?i.find(".modal-body").append(t):i.find(".modal-body").append(o()("<p />").text(t)),i.modal("show").on("hide.bs.modal",(function(){a.data.core.isAlertVisible=!1}))}},xe.alertUser=function(e){this._resetMessages([{level:"info",message:e}])},xe.setTreeValidationIcon=function(e){var t=e.ufid&&this.jstree("get_node",e.ufid);if(t){var n=e.getErrors();if(n.length){var a=n.join("\n").replace(/"/g,"'");t.data.errors='<i class="fd-valid-alert-icon fa fa-warning" title="'+a+'"></i>'}else t.data.errors=null;this.jstree("redraw_node",t)}},xe._resetMessages=function(e){var t,n=this.$f.find(".fd-messages");if(e.length>0){t=e[e.length-1];var a=function(){var e;n.html(P()({messageType:ye[t.level],messages:(e=t.message,"string"!=typeof e&&e instanceof Array||(e=[""+e]),e)})).fadeIn(500)};n.is(":visible")?n.fadeOut(500,a):a()}},xe.sectionIsCollapsed=function(e){var t="collapse-"+e.slug;return"main"!==e.slug&&(localStorage.hasOwnProperty(t)?localStorage.getItem(t):e.isCollapsed)},xe.collapseSection=function(e,t){var n=o()(".fd-question-fieldset[data-slug='"+e+"']"),a=o()(".fd-section-changer [data-slug='"+e+"']");t?(n.addClass("hide"),a.removeClass("selected")):(n.removeClass("hide"),a.addClass("selected")),localStorage.setItem("collapse-"+e,t?"1":"")},xe.getSectionDisplay=function(e,t){var n=this,a=n.sectionIsCollapsed(t),i=o()(w()({fieldsetClass:"fd-question-edit-"+t.slug||0,fieldsetTitle:t.displayName,fieldsetSlug:t.slug,isCollapsed:!!a,help:t.help})),r=i.find(".fd-fieldset-content");return t.properties.map((function(t){var a=t.widget(e,o().extend(t.options,{vellum:n,displayXPathEditor:function(e){n.data.core.currentlyEditedProperty=t.options.path,n.displayXPathEditor(e)}}));a.setValue(a.currentValue),a.on("change",(function(){n.onFormChange(e)}));var i=a.getUIElement();j.A.util.setWidget(i,a),r.append(i),a.postRender&&a.postRender(),a.refreshMessages()})),i},xe.getMugToolbar=function(e,t){var n=this,a=this.data.core.form,r=t?e:[e],s=o()(I()({comment:t?"":B.A.sanitizeInput(e.p.comment),isDeleteable:r&&r.length&&i.Ay.every(r,(function(e){return n.isMugRemoveable(e,e.hashtagPath)})),isCopyable:!t&&e.options.isCopyable,sections:t?[]:i.Ay.chain(n.getSections(e)).rest().filter((function(t){return i.Ay.some(i.Ay.map(t.properties,(function(t){return we(t,e)})))})).map((function(e){return i.Ay.extend({show:!n.sectionIsCollapsed(e)},e)})).value()}));return s.find(".fd-button-remove").click((function(){var e=n.getCurrentlySelectedMug(!0,!0);a.removeMugsFromForm(e),n.refreshCurrentMug()})),t||(s.find(".btn-toolbar.pull-left").prepend(this.getQuestionTypeChanger(e)),e.p.comment&&s.find(".fd-question-comment").show()),s},xe.getQuestionTypeChanger=function(e){var t=this,n=this.isMugTypeChangeable(e,e.hashtagPath),a=o()(_()({currentQuestionIcon:e.getIcon(),currentTypeName:e.options.typeName,questions:n?function(e){for(var n=e.__className,a=t.data.core.mugTypes[n],i=t.data.core.QUESTIONS_IN_TOOLBAR,r=[],o=0;o<i.length;o++){var s=i[o],l=t.data.core.mugTypes[s];n===s||a.typeChangeError(e,s)||!l.isTypeChangeable||l.typeChangeError(e,n)||r.push({slug:i[o],name:l.typeName,icon:l.icon})}return r}(e):[]}));return a.find(".change-question").click((function(n){try{t.changeMugType(e,o()(this).data("qtype"))}catch(e){window.alert(H.A.format(gettext("Sorry, {err}"),{err:e}))}n.preventDefault()})),a.addClass("fd-question-changer"),a},xe.changeMugType=function(e,t){this.data.core.form.changeMugType(e,t),this.setTreeActions(e)},xe.setTreeActions=function(e){var t=this,n=t.data.core.$tree,a="add_choice";e.options.canAddChoices?n.jstree(!0).add_action(e.ufid,{id:a,class:"fa fa-plus add_choice",text:" "+gettext("Add Choice"),after:!0,selector:"a",event:"click",callback:function(n,a,i,r){t.ensureCurrentMugIsSaved((function(){t.setCurrentMug(e),t.addQuestion("Choice")}))}}):n.jstree(!0).remove_action(e.ufid,a)},xe.createXML=function(e){return this.data.core.form.createXML(e)},xe.canSerializeXForm=function(e,t){var n=this,a=this.data.core.form,i=this.data.core.currentItextDisplayLanguage,r=a.getSerializationWarnings();if(r.length){var s=o()(b()({errors:r,displayLanguage:i}));return e=e?" "+gettext("and")+" "+e:"",this.alert(gettext("There are errors in the form"),s,[{title:gettext("Fix Manually"),action:function(){n.data.core.$modal.modal("hide")}},{title:gettext("Fix Automatically")+e,cssClasses:"btn-primary",defaultButton:!0,action:function(){a.fixSerializationWarnings(r),n.data.core.$modal.modal("hide"),t(),n.refreshVisibleData()}}]),!1}return!0},xe.validateAndSaveXForm=function(e){var t=this;if(this.canSerializeXForm(gettext("Save"),(function(){t.validateAndSaveXForm(e)}))){var n=this.createXML();try{U.A.parseXML(n)}catch(r){var a=gettext("It looks like your form is not valid XML. This can often happen if you use a reserved character in one of your questions. Characters to look out for are <, >, and &. You can still save, but you CANNOT LOAD THIS FORM again until you fix the XML by hand. What would you like to do?"),i=t.generateNewModal(gettext("Form Validation Error"),[{title:gettext("Fix the problem (recommended)"),cssClasses:"btn-primary",action:function(){t.closeModal()}},{title:gettext("Save anyway"),cssClasses:"btn-default",action:function(){t.closeModal(),t.send(n,e?"full":null)}}],!1,"fa fa-warning");return i.find(".modal-body").html(a),void i.modal("show")}this.send(n,e?"full":null)}},xe.send=function(e,t){var n,a,r=this,o=this.opts().core,s=!1,l="patch"===(t=t||o.saveType)?o.patchUrl:o.saveUrl;if(be(),"patch"===t){s=!0;var d=new(J());(n=d.patch_toText(d.patch_make(this.data.core.lastSavedXForm,e))).length>e.length&&o.saveUrl&&(t="full",l=o.saveUrl)}a="patch"===t?{patch:n}:{xform:e},(a=this.augmentSentData(a,t)).case_references=JSON.stringify(this.data.core.form._logicManager.caseReferences()),s&&(a.sha1=ee().SHA1(this.data.core.lastSavedXForm).toString()),this.data.core.saveButton.ajax({type:"POST",url:l,data:a,dataType:"json",error:function(){Ae()},success:function(t){if(s){if("conflict"===t.status){r.data.core.saveButton.fire("change");var n=r.opts().features.full_save_on_missing_conflict_xform;return void(i.Ay.isUndefined(t.xform)&&n?r.send(e,"full"):(Ae(),r.showOverwriteWarning(r.send.bind(r),e,t.xform)))}ee().SHA1(e).toString()!==t.sha1&&(Y.A.error("sha1's didn't match"),r.send(e,"full"))}Ae(),r.onFormSave(t),r.data.core.lastSavedXForm=e,r._setURLHash(r._propertiesMug)}})},xe.getSections=function(e){return[{slug:"main",displayName:gettext("Basic"),properties:this.getMainProperties(),help:{title:gettext("Basic"),text:"<p>"+H.A.format(gettext("The {displaytext} appears in the application. This text will not appear in data exports."),{displaytext:"<strong>"+gettext("Display Text")+"</strong>"})+"</p> ",link:"https://confluence.dimagi.com/display/commcarepublic/Form+Builder"}},{slug:"data_source",displayName:gettext("Data Source"),properties:this.getDataSourceProperties(),isCollapsed:!0,help:{title:gettext("Data Source"),text:gettext("You can configure an external data source like a case list or lookup table to use as the choices for a multiple choice question.")}},{slug:"logic",displayName:gettext("Logic"),properties:this.getLogicProperties(),isCollapsed:!0,help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"}},{displayName:gettext("Media"),slug:"content",properties:this.getMediaProperties(),isCollapsed:!0,help:{title:gettext("Media"),text:gettext("This will allow you to add images, audio or video media to a question, or other custom content."),link:"https://confluence.dimagi.com/display/commcarepublic/Multimedia+in+CommCare"}},{slug:"advanced",type:"accordion",displayName:gettext("Advanced"),properties:this.getAdvancedProperties(),isCollapsed:!0,help:{title:gettext("Advanced"),text:gettext("These are advanced settings and are not needed for most applications.  Please only change these if you have a specific need!"),link:"https://confluence.dimagi.com/display/commcarepublic/Application+Building"}}]},xe.getMainProperties=function(){return["label","calculateAttr","nodeID","requiredAttr","readOnlyControl","itemsetData","imageSize"]},xe.getDataSourceProperties=function(){return[]},xe.getMediaProperties=function(){return["mediaItext"]},xe.getLogicProperties=function(){return["relevantAttr","constraintAttr","repeat_count","defaultValue","requiredCondition"]},xe.getAdvancedProperties=function(){return["dataSource","dataValue","xmlnsAttr","label","hintLabel","constraintMsgAttr","dataParent","appearance","comment"]},xe.getMugSpec=function(){return V.A.baseSpecs},xe.isMugRemoveable=function(e,t){return e.options.isRemoveable},xe.isPropertyLocked=function(e,t){return!1},xe.isMugPathMoveable=function(e){return!0},xe.isMugTypeChangeable=function(e,t){return e.options.isTypeChangeable},xe.handleMugRename=function(e,t,n,a,i,r,o){return e.handleMugRename(t,n,a,i,r,o)},xe.duplicateMugProperties=function(e){},xe.beforeSerialize=function(){},xe.afterSerialize=function(){},xe.beforeBulkInsert=function(e){},xe.afterBulkInsert=function(e){this.refreshVisibleData()},xe.parseDataElement=function(e,t,n,a){return z.A.parseDataElement(e,t,n,a)},xe.parseBindElement=function(e,t,n){z.A.parseBindElement(e,t,n)},xe.parseSetValue=function(e,t,n){z.A.parseSetValue(e,t,n)},xe.performAdditionalParsing=function(e,t,n){},xe.getControlNodeAdaptorFactory=function(e){return this.data.core.controlNodeAdaptorMap[e]},xe.populateControlMug=function(e,t){return z.A.populateControlMug(e,t)},xe.updateControlNodeAdaptorMap=function(e){},xe.contributeToModelXML=function(e,t){},xe.contributeToHeadXML=function(e,t){},xe.onFormSave=function(e){const t=this.opts().core.onFormSave;"function"==typeof t&&t(e)},xe.augmentSentData=function(e,t){return e},xe.contributeToAdditionalXML=function(e,t){},xe.initMediaUploaderWidget=function(e){},xe.destroy=function(){},o().vellum.plugin("core",{form:null,loadDelay:500,patchUrl:!1,hasSubmissions:!1,hasSubmissionsUrl:!1,saveUrl:!1,saveType:"full",staticPrefix:"",allowedDataNodeReferences:[],noTextString:"[no text]",onReady:function(){},onFormSave:function(e){},bindBeforeUnload:function(e){o()(window).on("beforeunload",e)}},xe)},5304:(e,t,n)=>{"use strict";n.d(t,{A:()=>f});var a=n(561),i=n.n(a),r=n(4523),o=n(705),s=n(8922),l=n(1705),d=n.n(l),u={};function c(e){var t=e.$f.find(".fd-external-sources-container"),n=t.find(".fd-external-resource-search input"),a=t.find(".fd-external-sources-tree");e.data.core.databrowser.errorContainer=t,a.on("after_open.jstree",(function(){i()(".jstree-anchor").popover()})),a.on("redraw.jstree",(function(){i()(".jstree-anchor").popover()})),a.jstree({core:{data:function(t,n){function a(){var t=e.datasources.getDataNodes([]);n.call(i,function(e,t){function n(e,n,a,i){for(var r,s=o.A.util.getWidget(a,t),l=s.mug.form.richText&&e.hashtag?e.hashtag:e.xpath;n;)n.id&&n.uri&&(r=s.addInstanceRef({id:n.id,src:n.uri}))!==n.id&&(l=s.mug.form.updateInstanceQuery(l,r,n.id)),n=n._parent;t.handleDropFinish(a,l,void 0,i)}var a=50;return r.Ay.chain(e).map((function e(t){var i=function(){return r.Ay.map(t.getNodes(),e)},o=!!t.recursive||i();return{text:t.name,icon:t.recursive||o.length?"fcc fcc-fd-external-case":"fcc fcc-fd-case-property",state:{opened:!t.recursive&&o.length<=a},children:o,data:{handleDrop:r.Ay.partial(n,t,t.sourceInfo),getNodes:t.recursive?i:null},a_attr:{"data-content":t.description,"data-container":"body","data-trigger":"hover"}}})).map((function e(t){var n=r.Ay.filter(t.children,(function(e){return e.children.length}));return t.children=r.Ay.filter(t.children,(function(e){return 0===e.children.length})),n=r.Ay.flatten(r.Ay.map(n,e)),[t].concat(n)})).flatten().value()}(t,e))}var i=this;t.data&&t.data.getNodes?n.call(this,t.data.getNodes()):e.datasources.isReady()?a():e.datasources.on("change",a,null,"change")},worker:!1,multiple:!1,check_callback:function(e,t,n,a,i){return!1}},search:{show_only_matches:!0},conditionalevents:{should_activate:function(){return!1}},plugins:["themes","conditionalevents","dnd","search"]}),n.keyup(r.Ay.debounce((function(){a.jstree(!0).search(n.val())}),250))}function p(e){var t=e.$f.find(".fd-accessory-pane"),n=t.find(".fd-head-external-sources").outerHeight(!0);if(t.height()>n)t.css("height",n+"px"),t.find(".fd-head-external-sources .fd-head-max-indicator i").removeClass("fa-circle-down").addClass("fa-circle-up"),i()(window).resize();else{var a=e.$f.find(".fd-tree"),r=e.data.core.databrowser.panelHeight||.33*a.height();t.css("height",r+"px"),t.find(".fd-head-external-sources .fd-head-max-indicator i").removeClass("fa-circle-up").addClass("fa-circle-down"),i()(window).resize(),u.initDataBrowser(e)}}i().vellum.plugin("databrowser",{},{init:function(){var e,t,n,a=this,o=this.$f.find(".fd-tree"),l=this.$f.find(".fd-accessory-pane");a.data.core.databrowser={errorContainer:l,panelHeight:null},u.initDataBrowser=r.Ay.once(c),l.append(i()(d()())),e=l.find(".fd-head-external-sources"),t=e.outerHeight(!0)||0,l.data("min-size",t).height(Math.min(.33*o.height(),12*t)).resize((function(){l.height()>t+100&&(a.data.core.databrowser.panelHeight=l.height(),n=l.height()/i()(".fd-content-left").height())})),n=l.height()/i()(".fd-content-left").height(),i()(window).scroll((function(){l.height()>t&&(l.height(i()(".fd-content-left").height()*n),a.data.core.databrowser.panelHeight=l.height())})),l.find("#fdExternalSearch").on("keyup keypress",(function(e){if(13===(e.keyCode||e.which))return e.preventDefault(),!1})),u.initDataBrowser(a),s.A.preventDoubleScrolling(l.find(".fd-scrollable")),a.datasources.on("error",(function(e){var t=a.data.core.databrowser.errorContainer;if(t){var n=gettext("Could not load app properties.")+"<br>";400===e.xhr.status?n+=e.xhr.responseText:n+=gettext("If this error persists, please report an issue."),t.find(".fd-external-sources-error").removeClass("hide").find(".help-block").html(n),t.find(".fd-external-sources-tree").addClass("hide")}}));var f=r.Ay.partial(p,a);l.parent().find(".fd-external-sources-divider").clickExceptAfterDrag(f),e.click(f)}});const f=u},5382:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var a=n(561),i=n.n(a),r=n(4523),o=n(9659),s={};function l(e){function t(t){e.cache={sources:t.length?t:[{id:"",uri:"",path:"",name:gettext("Not Found"),structure:{}}]},e.loading=!1,e.fire("change")}e.endpoint?r.Ay.isString(e.endpoint)?(e.loading=!0,i().ajax({type:"GET",url:e.endpoint,dataType:"json",success:t,error:function(t,n,a){e.fire({type:"error",xhr:t,errorType:n,error:a}),window.console.log(o.A.formatExc(a||n)),e.retryTimeout<8001&&(setTimeout((function(){l(e)}),e.retryTimeout),e.retryTimeout=2*e.retryTimeout)},data:{}})):e.endpoint(t):t([])}function d(e,t,n){var a=e.cache;if(a.hasOwnProperty(t))return a[t];var i=s[t](e);return void 0!==i?(a[t]=i,i):n}s.sources=function(e){return e.loading||l(e),e.cache.sources},s.dataNodes=function(e){function t(e,t){if(e.length<=t)return e;let n="",a=e;for(;a.length>t;)n+=a.slice(0,t)+"\n",a=a.slice(t,a.length);return n+="\n"+a,n}function n(e,n){let a=e.split(" "),i="";for(let e of a)i+=t(e,n),i+=" ";return i.trim()}function a(t,a,o,d){return function(t,u){if(r.Ay.contains(e.invalidCaseProperties,u))return null;var c=a?a+"/"+u:u,p=function(e,t,n,a){var o={name:e.name||t,description:e.description||"",recursive:!1},d=e,u=null;if(!e.structure&&e.reference){var c=e.reference;if(d=s[c.source||a.id]){a=r.Ay.extend(r.Ay.omit(d,"structure"),{_parent:a,hashtag:c.hashtag});var p=n;if(n="instance('"+d.id+"')"+d.path,c.subset_filter&&c.subset_key&&c.subset&&(n+="["+c.subset_key+" = '"+c.subset+"']"),n+="["+c.key+" = "+p+"]",d.subsets&&c.subset){var f={id:c.subset};c.subset_key&&(f.key=c.subset_key),d=r.Ay.findWhere(d.subsets,f)||d}var h=d.name||d.id;h&&(o.name=h),l.hasOwnProperty(d.id)?o.recursive=!0:l[d.id]=!0}}return o.getNodes=function(){return null===u&&(u=i(d,n,a)),u},o}(t,u,c,o),f=p.name;return{name:f,description:n(p.description,43),hashtag:o.hashtag&&!d?o.hashtag+"/"+f:null,parentPath:a,xpath:c,index:d||!1,sourceInfo:o,getNodes:p.getNodes,recursive:p.recursive}}}function i(e,t,n){var o=r.Ay.chain(e&&e.structure).map((function(e,r){return e.merge?i(e,t+"/"+r,{_parent:n}):a(0,t,n)(e,r)})).flatten().compact().sortBy("text").value();return e&&e.related&&(o=r.Ay.chain(e.related).map((function(e,i){var r,o;return r={reference:e},o=e.index||"/index",a(0,t+o,n,!0)(r,i)})).sortBy("text").value().concat(o)),o}var o,s=d(e,"sources"),l={};if(s&&(s=s=r.Ay.indexBy(s,"id")).commcaresession){var u=s.commcaresession,c=r.Ay.omit(u,"structure"),p="instance('"+u.id+"')"+u.path;o=a(0,null,c)(u,p).getNodes()}return o},s.hashtags=function(e){var t=d(e,"dataNodes");return t?function e(t,n){return r.Ay.each(t,(function(t){t.index||(n.nodeMap[t.hashtag||t.xpath]=t),t.hashtag&&!t.index&&(n.map[t.hashtag]=t.xpath,n.transforms[t.sourceInfo.hashtag+"/"]=function(e){return t.parentPath+"/"+e}),t.recursive||e(t.getNodes(),n)})),n}(t,{map:{},nodeMap:{},transforms:{}}):void 0},s.nodeMap=function(e){var t=d(e,"hashtags");return t&&t.nodeMap},s.hashtagMap=function(e){var t=d(e,"hashtags");return t&&t.map},s.hashtagTransforms=function(e){var t=d(e,"hashtags");return t&&t.transforms};const u={init:function(e,t){var n=o.A.eventuality({endpoint:e,invalidCaseProperties:t});return n.reset=function(){n.retryTimeout=1e3,n.cache={}},n.isReady=function(){return void 0!==d(n,"sources")},n.getDataSources=function(e){return d(n,"sources",e)},n.getDataNodes=function(e){return d(n,"dataNodes",e)},n.getHashtagMap=function(e){return d(n,"hashtagMap",e)},n.getHashtagTransforms=function(e){return d(n,"hashtagTransforms",e)},n.getNode=function(e,t){var a=d(n,"nodeMap",{});return a.hasOwnProperty(e)?a[e]:t},n.onChangeReady=function(e){var t={};return n.isReady()&&e(),n.on("change",e,null,null,t),function(){n.unbind(t,"change")}},n.reset(),e&&r.Ay.isString(e)&&l(n),n}}},9832:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(561),i=n.n(a),r=n(3436),o=n.n(r);const s={showMenu:function(e,t,n,a){var r={"":gettext("No Formatting"),"%e/%n/%y":"d/m/yy e.g. 30/1/14","%a, %b %e, %Y":"ddd, mmm d, yyyy e.g. Thu, Jan 30, 2014"},s=i()(o()({formats:r}));i()("body").append(s),s.find("li a").click((function(){var e=i()(this).data("format");try{n(e)}finally{s.remove()}return!1})),s.css({top:t,left:e}).show(),a&&s.mouseleave((function(){s.fadeOut(400,(function(){s.remove()}))}))}}},2183:(e,t,n)=>{"use strict";let a;n.d(t,{A:()=>i}),a=n(4523).Ay.isUndefined(console)?{log:function(){},error:function(){}}:{log:function(){console.log.apply(console,arguments)},error:function(){console.error.apply(console,arguments)}};const i=a},8916:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(4523),i=n(7867),r="`",o=/^[\w.\-]/;const s={escapeDelimiters:function(e){return e.replace(/`/g,"``")},delimit:function(e){if(-1!==e.indexOf(r))throw new Error("cannot delimit: "+e);return r+e+r},transform:function(e,t,n){if(!e)return e;var a=function(e){for(var t=0,n=e.length,a=[];t<n-1;++t){var i=e.charCodeAt(t);i>=55296&&i<=56319&&(i=e.charCodeAt(t+1))>=56320&&i<=57343?(a.push(e.slice(t,t+2)),++t):a.push(e.charAt(t))}return a.push(e.charAt(t)),a}(e);t=t||function(e){return e};for(var i=0,s=a.length,l="",d="",u=0;u<s;u++){var c=a[u],p=a[u+1];0===i?c===r&&p===r?(l+=r,u++):c===r?i=1:l+=c:1===i&&(c===r?(i=0,l+=t(d),!n&&p&&o.test(p)&&(l+=" "),d=""):void 0!==p&&(d+=c))}return 1===i&&(l+=r+d),l},makeHashtagTransform:function(e){function t(e){var t=e.toHashtag;return e.toHashtag=function(e){var n=t(e);return null===n?null:s(n)},e}var n=i.A.makeXPathModels(e,t),r=i.A.createParser(n),o=n.HashtagExpr,s=a.Ay.identity;return n.HashtagExpr=function(e){return o.call(this,e),t(this),this},function(e,t){s=t;try{return r.parse(e).toHashtag()}catch(t){return e}finally{s=a.Ay.identity}}}}},6294:(e,t,n)=>{"use strict";n.d(t,{A:()=>f});var a=n(4523),i=n(561),r=n.n(i),o=n(3876),s=n(9659),l=n(7229),d=(n(2023),1),u=function(e){this.forms=e.forms||[],this.id=e.id||"",this.autoId=!!a.Ay.isUndefined(e.autoId)||e.autoId,this.hasMarkdown=!a.Ay.isUndefined(e.hasMarkdown)&&e.hasMarkdown,this.itextModel=e.itextModel,this.key=String(d++),this.refCount=1};u.prototype={clone:function(){return new u({forms:a.Ay.map(this.forms,(function(e){return e.clone()})),id:this.id,autoId:this.autoId,itextModel:this.itextModel,hasMarkdown:this.hasMarkdown})},getForms:function(){return this.forms},getFormNames:function(){return this.forms.map((function(e){return e.name}))},hasForm:function(e){return-1!==this.getFormNames().indexOf(e)},getForm:function(e){return s.A.reduceToOne(this.forms,(function(t){return t.name===e}),"form name = "+e)},getOrCreateForm:function(e){try{return this.getForm(e)}catch(t){return this.addForm(e)}},addForm:function(e){if(!this.hasForm(e)){var t=new c({name:e,itextModel:this.itextModel});return this.forms.push(t),t}},removeForm:function(e){var t=this.getFormNames().indexOf(e);-1!==t&&this.forms.splice(t,1)},cloneForm:function(e,t){var n=this.getOrCreateForm(e).clone();n.name=t,this.forms.push(n)},get:function(e,t){if((a.Ay.isUndefined(e)||null===e)&&(e="default"),(a.Ay.isUndefined(t)||null===t)&&(t=this.itextModel.getDefaultLanguage()),this.hasForm(e))return this.getForm(e).getValue(t)},set:function(e,t,n){(a.Ay.isUndefined(t)||null===t)&&(t="default");var i=this.getOrCreateForm(t);if(a.Ay.isUndefined(n)||null===n){n=this.itextModel.getDefaultLanguage();var r=i.getValue(n);i.setValue(n,e),a.Ay.each(this.itextModel.languages,(function(t){var n=i.getValue(t);n&&n!==r||i.setValue(t,e)}))}else i.setValue(n,e)},defaultValue:function(){return this.get()},isEmpty:function(){return!this.forms||a.Ay.every(this.forms,(function(e){return e.isEmpty()}))},hasHumanReadableItext:function(){var e=this;return a.Ay.some(["default","long","short"].concat(o.A.SUPPORTED_MEDIA_TYPES),(function(t){return e.hasForm(t)&&a.Ay.every(e.itextModel.languages,(function(n){return e.get(t,n)}))}))},mapLogicExpressions:function(e){var t=this.getForms(),n=a.Ay.map(t,(function(t){return a.Ay.map(t.getOutputRefExpressions(),e)}));return a.Ay.flatten(n)},updateLogicExpressions:function(e,t){a.Ay.some(a.Ay.map(this.getForms(),(function(t){return t.forEachExpression(e)})))&&t.form.fire({type:"question-label-text-change",mug:t})}};var c=function(e){this.itextModel=e.itextModel,this.data=e.data||{},this.name=e.name||"default",this.outputExpressions=null};c.prototype={clone:function(){return new c({itextModel:this.itextModel,data:a.Ay.clone(this.data),name:this.name})},getValue:function(e){return this.data[e]},setValue:function(e,t){this.data[e]=l.A.humanize(t),this.outputExpressions=null},getValueOrDefault:function(e){if(this.data[e])return this.data[e];var t=this.itextModel.getDefaultLanguage();if(e!==t&&this.data[t])return this.data[t];for(var n in this.data)if(this.data.hasOwnProperty(n)&&this.data[n])return this.data[n];return""},isEmpty:function(){for(var e in this.data)if(this.data.hasOwnProperty(e)&&this.data[e])return!1;return!0},initUndefined:function(e){var t=this.itextModel.getDefaultLanguage(),n=this.data;e=this.getValueOrDefault(t)||e||"",a.Ay.each(this.itextModel.languages,(function(t){n.hasOwnProperty(t)||(n[t]=e)}))},getOutputRefExpressions:function(){return null===this.outputExpressions&&(this.outputExpressions=this._getOutputRefExpressions()),this.outputExpressions},_getOutputRefExpressions:function(){var e=[];return this.forEachExpression((function(t){t&&e.push(t)})),e},forEachExpression:function(e){var t,n,i=!1;for(var o in this.data)this.data.hasOwnProperty(o)&&this.data[o]&&(t=!1,n=l.A.query(this.data[o]),a.Ay.each(n.find("output"),(function(n){var a=(n=r()(n)).is("[ref]")?"ref":"value",i="vellum:"+a,o=n.xmlAttr(i)||n.xmlAttr(a),s=e(o);void 0!==s&&s!==o&&(n.xmlAttr(a,s).removeAttr(i),t=!0)})),t&&(this.setValue(o,n.toString()),i=!0));return i}};var p=function(){s.A.eventuality(this),this.languages=[]};p.prototype={getLanguages:function(){return this.languages},hasLanguage:function(e){return-1!==this.languages.indexOf(e)},addLanguage:function(e){this.hasLanguage(e)||this.languages.push(e)},removeLanguage:function(e){this.hasLanguage(e)&&this.languages.splice(this.languages.indexOf(e),1),this.getDefaultLanguage()===e&&this.setDefaultLanguage(this.languages.length>0?this.languages[0]:"")},setDefaultLanguage:function(e){this.defaultLanguage=e},getDefaultLanguage:function(){return this.defaultLanguage?this.defaultLanguage:this.languages.length>0?this.languages[0]:""},createItem:function(e,t,n){return new u({id:e,autoId:t,itextModel:this,forms:[new c({name:"default",itextModel:this})],hasMarkdown:n})},updateForMug:function(e){e.options.isDataOnly||(e.p.labelItext||"notallowed"===e.getPresence("labelItext")||((e.p.labelItext=this.createItem()).set(e.getLabelValue()),e.validate()),e.p.hintItext||"notallowed"===e.getPresence("hintItext")||(e.p.hintItext=this.createItem()),e.p.helpItext||"notallowed"===e.getPresence("helpItext")||(e.p.helpItext=this.createItem()),e.options.isRepeat&&e.options.customRepeatButtonText&&(e.p.addEmptyCaptionItext||(e.p.addEmptyCaptionItext=this.createItem()),e.p.addCaptionItext||(e.p.addCaptionItext=this.createItem()))),e.options.isControlOnly||"notallowed"===e.getPresence("constraintMsgItext")||e.p.constraintMsgItext||(e.p.constraintMsgItext=this.createItem())}};const f={form:c,item:u,model:p}},3876:(e,t,n)=>{"use strict";n.d(t,{A:()=>y});var a=n(4523),i=n(561),r=n.n(i),o=n(3809),s=n(4459),l=n(7229),d=n(9659),u=["default","audio","image","video","video-inline"],c=["labelItext","hintItext","helpItext","constraintMsgItext","addEmptyCaptionItext","addCaptionItext"],p=function(e){if("Choice"===e.__className){var t=new RegExp(d.A.invalidAttributeRegex.source,"g");return p(e.parentMug)+"-"+e.getNodeID().replace(t,"_")}var n=e.absolutePathNoRoot;return n||(n=e.parentMug?e.parentMug.absolutePathNoRoot+"/"+e.getNodeID():"/"+e.getNodeID()),n.slice(1)},f=function(e,t){return p(e)+"-"+t},h=function(e,t){var n={};e.tree.walk((function(e,i,r){e&&a.Ay.each(c,(function(a){var i=e.p[a];!i||i.key?i&&!n.hasOwnProperty(i.key)&&(n[i.key]=!0,t(i,e,a)):window.console.log("ignoring ItextItem without a key: "+i.id)})),r()}))},g=function(e,t){var n=t,i=[],r={},o=a.Ay.object(a.Ay.map(c,(function(e){return[e,e.replace("Itext","")]})));return h(e,(function(e,a,s){var l=e.isEmpty();if(!l||n){var d=e.autoId||!e.id?f(a,o[s]):e.id,u=d,c=2;if(r.hasOwnProperty(d)&&(l||e===r[d]))return;for(;r.hasOwnProperty(d);)d=u+c,c++;e.id=d,r[d]=e,t||i.push(e)}})),t?r:i},m=function(e,t){return t?'<output value="format-date(date('+e+"), '"+t+"')\"/>":'<output value="'+e+'" />'};function v(e){return function(t,n,a){if(t){var i=l.A.query(t);i.find("output").each((function(){var t=r()(this),a=t.xmlAttr("value")||t.xmlAttr("ref");try{var i=n.parse(a);t.xmlAttr("value",i[e]())}catch(e){t.xmlAttr("value",a)}})),t=i.toString(),a&&(t=t.replace(/(<)|>/g,(function(e,t){return t?"&lt;":"&gt;"})))}return t}}const y={ITEXT_PROPERTIES:c,SUPPORTED_MEDIA_TYPES:["image","audio","video","video-inline"],forEachItextItem:h,generateItextXLS:function(e,t){function n(e,t,n,i){var r=[e];return a.Ay.each(n,(function(e){a.Ay.each(t,(function(t){r.push(i(t,e))}))})),r}var i=u,r=t.getLanguages(),s=[];if(r.length>0){var l=g(e);s.push(function(e,t){return n("label",e,t,(function(e,t){return t+"_"+e}))}(r,i)),a.Ay.each(l,(function(e){s.push(function(e,t,a){return n(e.id,t,a,(function(t,n){return e.hasForm(n)?e.get(n,t):""}))}(e,r,i))}))}return o.A.tabDelimit(s)},getDefaultItextRoot:p,getDefaultItextId:f,getItextItemsFromMugs:g,getOutputRef:m,insertOutputRef:function(e,t,n,a,i){var r=m(n,i),o=e.data.core.form;o.richText?s.A.editor(t).insertOutput(r):d.A.insertTextAtCursor(t,r,!0),a&&(function(e,t,n,a,i){if("."===n){var r=t.p.getDefinition(e).lstring;t.addMessage(i,{key:"core-circular-reference-warning",level:t.WARNING,message:d.A.format(gettext("The {field} for a question is not allowed to reference the question itself. Please remove the {ref} from the {field} or your form will have errors."),{field:r,ref:a})})}}("label",a,n,gettext("output value"),t.attr("name")),function(e,t,n){if(!t.options.canOutputValue){var a=e.vellum.getCurrentlySelectedMug(),i=t.options.typeName;a&&a.addMessage(null,{key:"javaRosa-output-value-type-error",level:t.WARNING,message:d.A.format(gettext("{type} nodes cannot be used in an output value. Please remove the output value for '{path}' or your form will have errors."),{type:i,path:n})})}}(o,a,n))},looksLikeMarkdown:function(e,t){var n=/^\d+[\.\)] |^\* |~~.+~~|# |\*{1,3}\S.*\*{1,3}|\[.+\]\(\S+\)/m.test(e),a=!1;return t&&(a=/^(\|[^\n]+\|\r?\n)((?:\|\s*:?[-]+:?\s*)+\|)(\n(?:\|[^\n]+\|\r?\n?)*)?$/m.test(e)),n||a},parseXLSItext:function(e,t,n){var i,s,l,d,c=u,p=n.getLanguages(),f=o.A.makeRowParser(t),h=f();h&&(h=a.Ay.map(h,(function(e){var t=e.split(/[-_]/);return-1===c.indexOf(t[0])||-1===p.indexOf(t[1])?null:{form:t[0],lang:t[1]}})));var m=g(e,!0);for(s=f();s;s=f())if(d=m[s[0]])for(i=1;i<s.length;i++)(l=h[i])&&(d.hasForm(l.form)?d.getForm(l.form).setValue(l.lang,s[i]):r().trim(s[i])&&d.getOrCreateForm(l.form).setValue(l.lang,s[i]));n.fire("change")},outputToXPath:v("toXPath"),outputToHashtag:v("toHashtag")}},6283:(e,t,n)=>{"use strict";var a,i=n(561),r=n.n(i),o=n(4523);n(9320),r().fn.popAttr=function(e){var t=!1,n=this.xmlAttr(e);try{this.removeAttr(e),t=!0}catch(e){}return t&&!o.Ay.isUndefined(n)&&(this[0].poppedAttributes||(this[0].poppedAttributes={}),this[0].poppedAttributes[e]=n),n},r().fn.xmlAttr=function(e,t){if(o.Ay.isObject(e)){var n=this;return o.Ay.each(e,(function(e,t){n.xmlAttr(t,e)})),this}var a=arguments.length>1;if(e&&e.indexOf(":")>-1)return a?this.attr(e,t):this.attr(e);var i,r=this.get(0);if(r){if(a)return null===t?this.removeAttr(e):void 0!==t&&((i=document.createAttribute(e)).value=t,r.setAttributeNode(i)),this;if(i=r.attributes.getNamedItem(e))return i.value}return a?this:void 0},r().fn.stopLink=function(){return this.click((function(e){e.preventDefault()})),this},r().fn.fdHelp=function(){return this.append(r()("<i />").addClass("fa fa-question-circle")).popover({trigger:"focus",html:!0,container:"body",sanitize:!1}).click((function(e){e.stopPropagation()})),this},r().fn.clickExceptAfterDrag=function(e){var t=r()(this);function n(a){e.currentXY=[a.pageX,a.pageY],t.off("mousemove",n)}function a(n){var i=e.currentXY[0]-n.pageX,r=e.currentXY[1]-n.pageY;Math.sqrt(i*i+r*r)<3&&e(n),t.off("mouseup",a)}e.currentXY=[],t.on("mousedown",(function(e){n(e),t.on("mousemove",n).on("mouseup",a)}))},r().fn.disableSelection||r().fn.extend({disableSelection:(a="onselectstart"in document.createElement("div")?"selectstart":"mousedown",function(){return this.on(a+".ui-disableSelection",(function(e){e.preventDefault()}))}),enableSelection:function(){return this.off(".ui-disableSelection")}});var s=r().fn.popover.Constructor.prototype.leave;r().fn.popover.Constructor.prototype.leave=function(e){var t,n,a=e instanceof this.constructor?e:r()(e.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);s.call(this,e),e.currentTarget&&(t=r()(".popover"),n=a.timeout,t.one("mouseenter",(function(){clearTimeout(n),t.one("mouseleave",(function(){r().fn.popover.Constructor.prototype.leave.call(a,a)}))})))}},4854:(e,t,n)=>{"use strict";n.d(t,{A:()=>c});var a=n(561),i=n.n(a),r=n(4523),o=n(9659),s="#",l="#invalid/xpath ";function d(e,t){if(this._text=e||"",this._xpathParser=t,"string"==typeof this._text&&this._text.startsWith(l))this.parsed=null,this.error=l;else if(i().trim(e))try{this.parsed=this._xpathParser.parse(e)}catch(e){this.parsed=null,this.error=e}else this.parsed=null}function u(e,t){t.allowedDataNodeReferences=t.allowedDataNodeReferences||{},this.opts=t,this.form=e,this.forward={},this.reverse={},this.errors={}}d.prototype={analyze:function(){var e,t=[],n=[],a=[],i=[],r=this._xpathParser.models.XPathInitialContextEnum.ROOT,o=this._xpathParser.models.XPathInitialContextEnum.RELATIVE,s=this._xpathParser.models.XPathInitialContextEnum.EXPR;if(this.paths=t,this.absolutePaths=n,this.hashtags=i,this.instanceRefs={},this.referencesSelf=!1,this.topLevelPaths=a,this.parsed)for(var l,d,u,c,p,f,h=[{xpath:this.parsed,insideFilter:!1}];h.length>0;){if(l=(p=h.shift()).xpath,f=p.insideFilter,l instanceof this._xpathParser.models.XPathPathExpr){if(t.push(l),f||a.push(l),f=!0,l.initial_context===r)n.push(l);else if(l.initial_context===o&&1===l.steps.length&&"self"===l.steps[0].axis)this.referencesSelf=!0;else if(l.initial_context===s)for(this._addInstanceRef(l.filter.expr)||h.push({xpath:l.filter.expr,insideFilter:f}),e=l.filter.predicates,d=0;d<e.length;d++)h.push({xpath:e[d],insideFilter:f})}else l instanceof this._xpathParser.models.XPathFuncExpr?this._addInstanceRef(l):l instanceof this._xpathParser.models.HashtagExpr&&i.push(l);for(u=l.getChildren(),d=0;d<u.length;d++)if(h.push({xpath:u[d],insideFilter:f}),u[d].predicates&&u[d].predicates.length)for(e=u[d].predicates,c=0;c<e.length;c++)h.push({xpath:e[c],insideFilter:f})}},_addInstanceRef:function(e){if("instance"===e.id&&1===e.args.length&&e.args[0]instanceof this._xpathParser.models.XPathStringLiteral){var t=e.args[0].value;return this.instanceRefs[t]=null,!0}return!1},getPaths:function(){return this.paths||this.analyze(),this.paths},getTopLevelPaths:function(){return this.topLevelPaths||this.analyze(),this.topLevelPaths},getHashtags:function(){return this.hashtags||this.analyze(),this.hashtags},updatePath:function(e,t){var n,a,i,r,o=this.getPaths().concat(this.getHashtags());for(a=0;a<o.length;a++)(n=o[a]).toHashtag()===e&&(i=this._xpathParser.parse(t),(r=n).toHashtag=i.toHashtag.bind(i),r.toXPath=i.toXPath.bind(i))},getText:function(){return this._text&&this.parsed?this.parsed.toHashtag():this._text}},u.prototype={clearReferences:function(e,t){function n(t,n){if(n.ref){if(n.mug!==e.ufid)throw new Error([e,n]);i[n.ref][n.mug]=r.Ay.filter(i[n.ref][n.mug],(function(e){return e.property!==t}))}}var a,i=this.reverse,o=this.forward,s=this.errors;e.form.dropAllInstanceReferences(e,t,!0),o.hasOwnProperty(e.ufid)?t?(o[e.ufid].hasOwnProperty(t)&&(a=r.Ay.partial(n,t),r.Ay.each(o[e.ufid][t],a)),o[e.ufid][t]=[]):(r.Ay.each(o[e.ufid],(function(e,t){a=r.Ay.partial(n,t),r.Ay.each(e,a)})),o[e.ufid]={}):o[e.ufid]={},s.hasOwnProperty(e.ufid)&&(t?delete this.errors[e.ufid][t]:delete this.errors[e.ufid])},_addReferences:function(e,t,n){n=this.form.getLogicalXPath(n||e.p[t]);var a,i=this,u=i.form,c=new d(n,u.xpath),p=[],f=[],h="",g=e.spec[t],m=g?g.lstring:t,v=this.reverse;return f.push({key:"logic-invalid-xpath-warning",level:e.WARNING,message:c.error===l?gettext("Invalid XPath expression."):""}),c.analyze(),!c.referencesSelf||g&&g.mayReferenceSelf||(h=o.A.format(gettext("The {property} for a question is not allowed to reference the question itself. Please remove the . from the {property} or your form will have errors."),{property:m})),f.push({key:"core-circular-reference-warning",level:e.WARNING,message:h}),a=c.absolutePaths.concat(c.hashtags).map((function(n){var a=n.toHashtag(),r=a.startsWith("#"),o=r?a:n.pathWithoutPredicates(),l=r?"":o.substring(1+o.indexOf("/",1)),d=u.getMugByPath(o),c=u.hasValidHashtagPrefix(a),f=c&&u.isValidHashtag(a);(d||f||e.options.ignoreReferenceWarning&&e.options.ignoreReferenceWarning(e)||-1!==i.opts.allowedDataNodeReferences.indexOf(l)||"dataParent"===t&&o===u.getBasePath().slice(0,-1))&&(d||!c||f)||p.push(a);var h=d?d.ufid:c?s:"",g={mug:e.ufid,ref:h,property:t,path:a,sourcePath:e.hashtagPath};return h&&(v.hasOwnProperty(h)?v[h].hasOwnProperty(e.ufid)||(v[h][e.ufid]=[]):(v[h]={},v[h][e.ufid]=[]),v[h][e.ufid].push(g)),g})),this.forward[e.ufid][t]=a,r.Ay.each(c.instanceRefs,(function(n,a){u.referenceInstance(a,e,t)})),r.Ay.each(c.hashtags,(function(n){u.referenceHashtag(n.toHashtag(),e,t)})),p.length>0?(this.errors[e.ufid]||(this.errors[e.ufid]={}),this.errors[e.ufid][t]=!0):this.errors[e.ufid]&&delete this.errors[e.ufid][t],f.push({key:"logic-bad-path-warning",level:e.WARNING,message:p.length?1===p.length?gettext("Unknown question:")+" "+p[0]:gettext("Unknown questions:")+"\n- "+p.join("\n- "):""}),f},addReferences:function(e,t,n){var a=this,i={};return this.clearReferences(e,t),!n&&e.p[t]&&r.Ay.isFunction(e.p[t].mapLogicExpressions)?e.p[t].mapLogicExpressions((function(n){var o=a._addReferences(e,t,n);return r.Ay.filter(o,(function(e){if(i.hasOwnProperty(e.key)){if(!i[e.key].message||!e.message)return e.message&&r.Ay.extend(i[e.key],e),!1}else i[e.key]=e;return!0}))})):this._addReferences(e,t,n)},updateReferences:function(e,t,n){function a(t){o[t]=i.addReferences(e,t,n)}var i=this,o={};t?a(t):r.Ay.each(e.logicReferenceAttrs,a),e.addMessages(o)},updatePath:function(e,t,n,a){if(t!==n){var i={};i[e]=[t,n],this.updatePaths(i,a)}},updatePaths:function(e,t){var n={},a=this.form;this.forEachReferencingProperty(e,(function(e,t,i){function o(e){if(!e)return e;var t=new d(e,a.xpath),n=t.getText();t.updatePath(i[0],i[1]);var r=t.getText();return r!==n?r:e}var s=e.ufid+" "+t+" "+i[0];if(!n.hasOwnProperty(s)){n[s]=null;var l=e.p[t];if(l&&r.Ay.isFunction(l.updateLogicExpressions))l.updateLogicExpressions(o,e);else{var u=o(l);l!==u&&e.p.set(t,u)}}}),t)},forEachBrokenReference:function(e){r.Ay.each(this.errors,(function(t,n){var a=this.form.getMugByUFID(n);a?t?r.Ay.each(t,(function(t,n){e(a,n)})):e(a):delete this.errors[n]}),this)},hasBrokenReferences:function(){return r.Ay.find(this.errors,(function(e){return r.Ay.some(e)}))},validateExternalReferences:function(){var e=this,t=r.Ay.chain(this.reverse[s]||{}).values().flatten(!0).filter((function(t){return!e.form.isValidHashtag(t.path)})).value();r.Ay.each(t,(function(t){var n=e.form.getMugByUFID(t.mug);e.updateReferences(n,t.property)}))},forEachReferencingProperty:function(e,t,n){var a=this.form,i=this.reverse;r.Ay.each(e,(function(e,o){i.hasOwnProperty(o)&&r.Ay.each(i[o],(function(i,o){var s=a.getMugByUFID(o);r.Ay.each(i,(function(a){n&&a.sourcePath!==n&&0!==a.sourcePath.indexOf(n+"/")||t(s,a.property,e)}))}))}))},hasReferencingMug:function(e,t){var n=this.form;return!!this.reverse.hasOwnProperty(e.ufid)&&r.Ay.find(this.reverse[e.ufid],(function(e,a){var i=n.getMugByUFID(a);return e.length&&i&&t(i)}))},reset:function(){this.forward={},this.reverse={}},caseReferences:function(){var e=this,t={},n={};r.Ay.each(r.Ay.flatten(r.Ay.values(this.reverse[s]||{})),(function(n){var a=e.form.normalizeXPath(n.sourcePath);if(null===a){var i=e.form.getMugByUFID(n.mug).parentMug;i&&(a=i.absolutePath)}t.hasOwnProperty(a)?r.Ay.contains(t[a],n.path)||t[a].push(n.path):t[a]=[n.path]}));var a=r.Ay.filter(this.form.getMugList(),(function(e){return void 0!==e.options.getCaseSaveData}));return r.Ay.each(a,(function(t){var a=e.form.getAbsolutePath(t);n[a]=t.options.getCaseSaveData(t)})),{load:t,save:n}},knownExternalReferences:function(){var e=this;return r.Ay.chain(this.reverse[s]||{}).values().flatten(!0).filter((function(t){return e.form.isValidHashtag(t.path)})).map((function(e){return[e.path,null]})).object().value()},findUsages:function(e){var t=this.form,n={},a=r.Ay.omit(this.reverse,s);return r.Ay.each(a,(function(a,i){var o=t.getMugByUFID(i),s={};!o||e&&e!==o.hashtagPath||(r.Ay.each(a,(function(e,n){r.Ay.each(e,(function(e){var a=t.getMugByUFID(n),i=a.hashtagPath,r=a.spec[e.property].lstring;i||(i=a.parentMug.hashtagPath),s[i]=r}))})),n[o.hashtagPath]=s)})),n}};const c={LogicManager:u,LogicExpression:d}},9747:(e,t,n)=>{"use strict";n(2667),n(2023);var a=n(4523),i=n(561),r=n.n(i),o=n(7229),s=n(8262),l=new XMLSerializer,d=o.A.parseXML,u="parent";r().vellum.plugin("ignore",{},{loadXML:function(e,t){if(this.data.ignore.ignoredNodes=[],e){var n=this,i=[],o=d(e),s=o.find('[vellum\\:ignore="retain"]');if(this.data.ignore.active=s.length,this.data.ignore.active){t.enableInstanceRefCounting=!1,this.data.ignore.ignoredMugs=[];var u=o.find("h\\:xdoc > h\\:head > model").first(),c=u.find("instance").first(),p=o.find("h\\:xdoc > h\\:body, h\\:xdoc > body").first();a.Ay.each([u,c,p],(function(e){e.length||window.console.log("WARNING",e.tagName,"not found")})),(s=s.not((function(e,t){var n=a.Ay.any(r()(t).parents(),(function(e){return c.is(e)||p.is(e)||a.Ay.any(s,(function(t){return r()(t).is(e)}))}));return n||"bind"!==t.nodeName?n:r()(t).parent().is(u)}))).each((function(e,t){n.data.ignore.ignoredNodes.push(function(e){var t,n,a=e,i=[];for(t=g(e,"previous"),n=g(e,"next"),e=e.parentElement;e;)i.unshift(m(e)),e=e.parentElement;var r=l.serializeToString(a).replace(/xmlns="(.*?)"/,"");return{prev:t,next:n,path:i.join(" > "),nodeXML:"\n"+r}}(t)),i.push(t)})),a.Ay.each(i,(function(e){e.parentElement.removeChild(e)})),this.__callOld(l.serializeToString(o[0]),t)}else this.__callOld()}else this.__callOld()},createXML:function(){var e=this.__callOld(),t=this.data.ignore.ignoredNodes;if(!this.data.ignore.active)return e;var n=r()(d(e));a.Ay.each(t,(function(e){"h\\:xdoc > h\\:body"===e.path?e.path="h\\:xdoc > body, h\\:xdoc > h\\:body":"h\\:xdoc > h\\:head"===e.path&&(e.path="h\\:xdoc > head, h\\:xdoc > h\\:head");var t=n.find(e.path),a=d(e.nodeXML)[0].childNodes[0],i=e.prev&&t.find(e.prev),r=e.next&&t.find(e.next);i&&i.length?i.first().after(a):r&&r.length?r.first().before(a):t.append(a)}));var i=0;return l.serializeToString(n[0]).replace(/ xmlns=""/g,"").replace(/ xmlns:vellum="(.+?)"/g,(function(e){return i++?"":e}))},getMugTypes:function(){var e=this.__callOld();return e.normal.Ignored=c,e},parseDataElement:function(e,t,n){if(this.data.ignore.active){var a=r()(t);if("retain"===a.xmlAttr("vellum:ignore")){var i=e.mugTypes.make("Ignored",e);return i.p.nodeID=t.nodeName,i.p.rawDataAttributes=s.A.getAttributes(t),a.children().length?i.p.dataNodeXML=h(a).replace(/^<[^>]+>([^]*)<\/[^>]+>$/,"$1"):i.p.dataNodeXML="",this.data.ignore.ignoredMugs.push(i),i}}return this.__callOld()},parseBindElement:function(e,t,n){if(this.data.ignore.active){n=e.normalizeXPath(n);var a=e.getMugByPath(n);if(a||(a=p(n,e)),a&&"Ignored"===a.__className||"retain"===t.xmlAttr("vellum:ignore")){var i,r;if(a&&"Ignored"===a.__className)i=a.absolutePath,r="mug";else{var o=null;a&&(o=a.options.isSpecialGroup?a:a.parentMug),a=f(e,o),e.tree.insertMug(a,"into",o),e._fixMugState(a),i=o?o.absolutePath:e.getBasePath(!0),r=u,this.data.ignore.ignoredMugs.push(a)}return void a.p.binds.push({path:n.startsWith(i)?n.slice(i.length):n,relativeTo:n.startsWith(i)?r:null,attrs:s.A.getAttributes(t)})}}this.__callOld()},parseSetValue:function(e,t,n){if(this.data.ignore.active){n=e.normalizeXPath(n);var a=e.getMugByPath(n);if(a||(a=p(n,e)),a&&"Ignored"===a.__className||"retain"===t.xmlAttr("vellum:ignore")){if(a&&"Ignored"===a.__className)a.absolutePath;else{var i=null;a&&(i=a.options.isSpecialGroup?a:a.parentMug),a=f(e,i),e.tree.insertMug(a,"into",i),e._fixMugState(a),i?i.absolutePath:e.getBasePath(!0),this.data.ignore.ignoredMugs.push(a)}return void a.p.setValues.push({ref:t.xmlAttr("ref"),event:t.xmlAttr("event"),value:t.xmlAttr("value")})}}this.__callOld()},getControlNodeAdaptorFactory:function(e){var t=this.__callOld();if(this.data.ignore.active){var n=this.data.ignore.ignoredMugs;return function(e,a,i,r){function o(){var t;return d&&"Ignored"===d.__className||(d=f(i,r),n.push(d)),(t=e).length&&t[0].poppedAttributes&&t.xmlAttr(t[0].poppedAttributes),d.p.controlNode=h(e),d}o.skipPopulate=!0;var l=s.A.getPathFromControlElement(e,i,r,!0),d=i.getMugByPath(l);if("retain"===e.xmlAttr("vellum:ignore"))return o.ignoreDataNode=d&&"Ignored"!==d.__className,o;if(d&&"Ignored"===d.__className)return o;var u=Array.prototype.slice.call(arguments);return t&&t.apply(null,u)}}return t},getSections:function(e){return this.data.ignore.active&&"Ignored"===e.__className?[{slug:"advanced",type:"accordion",displayName:"Advanced",properties:["nodeID"],isCollapsed:!0,help:{title:gettext("Advanced"),text:gettext("This question represents advanced content that is not supported by the form builder. Please only change it if you have a specific need!")}}]:this.__callOld()},handleMugRename:function(e,t,n,i,r,o){const s=this.__callOld();if(this.data.ignore.active&&o){o=o.replace(/^#form\//,e.getBasePath(!0)+"/"),r=e.normalizeXPath(r);var l=RegExp.escape(o),d=new RegExp(l+"(\\W|$)","g"),u=r+"$1";a.Ay.each(this.data.ignore.ignoredNodes,(function(e){e.nodeXML=e.nodeXML.replace(d,u)})),a.Ay.each(this.data.ignore.ignoredMugs,(function(e){e.p.controlNode&&(e.p.controlNode=e.p.controlNode.replace(d,u)),a.Ay.each(e.p.binds,(function(e){e.attrs=a.Ay.object(a.Ay.map(e.attrs,(function(e,t){return[t,e.replace(d,u)]})))}))}))}return s}});var c={typeName:gettext("Ignored XML"),icon:"fa fa-question-circle",isTypeChangeable:!1,isRemoveable:!1,isCopyable:!1,ignoreHashtags:!0,isHashtaggable:!1,init:function(e){e.p.binds=[],e.p.setValues=[]},parseDataNode:function(e,t){return r()([])},getTagName:function(e,t){return e.p.rawDataAttributes?t:null},writeDataNodeXML:function(e,t){t.p.dataNodeXML&&e.writeXML(t.p.dataNodeXML)},getBindList:function(e){return a.Ay.map(e.p.binds,(function(t){var n=a.Ay.clone(t.attrs),i="";if("mug"===t.relativeTo)i=e.absolutePath;else if(t.relativeTo===u){var r=e.parentMug;i=r?r.absolutePath:e.form.getBasePath(!0)}return n.nodeset=i+t.path,n}))},getSetValues:function(e){return e.p.setValues},writesOnlyCustomXML:!0,writeCustomXML:function(e,t){t.p.controlNode&&e.writeXML(t.p.controlNode)},spec:{label:{presence:"notallowed"},labelItext:{presence:"notallowed"},labelItextID:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},hintItextID:{presence:"notallowed"},helpItext:{presence:"notallowed"},helpItextID:{presence:"notallowed"},mediaItext:{presence:"notallowed"},otherItext:{presence:"notallowed"},appearance:{presence:"notallowed"}}};function p(e,t){for(var n=null,a=/[\/[][^\/[]+$/;!n&&e&&a.test(e);)(e=e.replace(a,""))&&(n=t.getMugByPath(e));return n}function f(e,t){var n=e.mugTypes.make("Ignored",e);return n.p.nodeID=e.generate_item_label(t,"ignored--",1),n}function h(e){var t=l.serializeToString(e[0]),n=t.indexOf(">");return-1===n?t:t.slice(0,n).replace(/ xmlns(:.*?)?="(.*?)"/g,"")+t.slice(n)}function g(e,t){var n=m(e[t+"ElementSibling"]);return n&&n+", "+n.replace(/\w+:([^:]*)$/,"$1")}function m(e){if(!e)return null;var t=r()(e),n=t.xmlAttr("nodeset"),a=t.xmlAttr("ref"),i=t.xmlAttr("id");return"setvalue"===(t.prop("tagName")||"").toLowerCase()?'[event="'+t.xmlAttr("event")+'"][ref="'+a+'"]':n?'[nodeset="'+n+'"]':a?'[ref="'+a+'"]':i?'[id="'+i+'"]':e.nodeName.replace(":","\\:")}var v,y=n(4078),x=n(705),b=n(9659),A="http://opendatakit.org/xforms",w=["androidIntentAppId","docTemplate","androidIntentExtra","androidIntentResponse","unknownAttributes","intentXmlns"];function M(e,t){return{androidIntentAppId:t||"",intentXmlns:A,androidIntentExtra:{},androidIntentResponse:{},unknownAttributes:{},nodeID:e}}var _=function(e,t){var n={};return a.Ay.each(e.find(t),(function(e){var t,i=r()(e),o=i.xmlAttr("key");t=i.xmlAttr("ref"),n.hasOwnProperty(o)?a.Ay.isArray(n[o])?n[o].push(t):n[o]=[n[o],t]:n[o]=t})),n},C=function(e,t,n,i){n&&a.Ay.each(n,(function(n,r){r&&a.Ay.each(a.Ay.isArray(n)?n:[n],(function(n){e.writeStartElement(t),e.writeAttributeString("key",r),i?b.A.writeHashtags(e,"ref",n,i):e.writeAttributeString("ref",n),e.writeEndElement()}))}))};function I(e,t,n){var i,r=(i=t.androidIntentAppId,a.Ay.find(v,(function(e){return e.value===i})));e.writeStartElement("odkx:intent"),e.writeAttributeString("xmlns:odkx",t.intentXmlns),e.writeAttributeString("id",t.nodeID),e.writeAttributeString("class",t.androidIntentAppId),r&&r.type&&e.writeAttributeString("type",r.type),a.Ay.each(t.unknownAttributes,(function(t,n){e.writeAttributeString(n,t)})),C(e,"extra",t.androidIntentExtra,n),t.docTemplate&&C(e,"extra",{"cc:print_template_reference":"'"+t.docTemplate+"'"}),C(e,"response",t.androidIntentResponse,n),e.writeEndElement("odkx:intent")}function k(e,t){if("AndroidIntent"===t.__className||"PrintIntent"===t.__className){var n=t.p.nodeID,i=e.hasOwnProperty(n)?e[n]:M(n);a.Ay.each(w,(function(e){t.p[e]||(t.p[e]=i[e])})),delete e[i.nodeID]}"org.commcare.dalvik.action.PRINT"===t.p.androidIntentAppId?t.form.changeMugType(t,"PrintIntent"):t.p.androidIntentAppId||(t.p.androidIntentAppId=v[0].value),"PrintIntent"===t.__className&&t.p.androidIntentExtra["cc:print_template_reference"]&&(t.p.docTemplate=t.p.androidIntentExtra["cc:print_template_reference"].replace(/^'|'$/g,""),delete t.p.androidIntentExtra["cc:print_template_reference"])}function P(e,t,n,i){i[t]=a.Ay.clone(n.p[t]),""===i[t][""]&&delete i[t][""]}var T=b.A.extend(y.A.defaultOptions,{typeName:gettext("Android App Callout"),dataType:"intent",tagName:"input",icon:"fcc fcc-fd-android-intent",isTypeChangeable:!1,init:function(e,t){e.p.intentXmlns=e.p.intentXmlns||A},spec:{androidIntentAppId:{lstring:gettext("External App"),visibility:"visible",widget:function(e,t){t.defaultOptions=v;var n=t.vellum.opts().features;return N(n)||E(n)?x.A.dropdown(e,t):x.A.dropdownWithInput(e,t)},noCustom:!0,placeholder:gettext("Insert Android Application ID"),deserialize:function(e,t,n){e.intent?(n.p.androidIntentAppId=e.intent.path||"",a.Ay.each([["intentXmlns","xmlns"],["androidIntentExtra","extra"],["androidIntentResponse","response"],["unknownAttributes","unknownAttributes"]],(function(t){var i=t[0],r=t[1];a.Ay.isEmpty(e.intent[r])||(n.p[i]=e.intent[r])}))):n.p[t]=e[t]},validationFunc:function(e){var t,n=e.form.vellum.opts(),i=n.features,r=n.core.externalLinks.changeSubscription,o=gettext("change your subscription");if(r=r?"["+o+"]("+r+")":o,N(i))return b.A.format(gettext("You no longer have access to built in or external integration in your application.\n\nBuilt in integrations are available on the Pro plan and higher. External integrations are available on the Advanced plan and higher. Before you can make a new version of your application, you must {link} or delete this question."),{link:r});if(E(i)&&(t=e.p.androidIntentAppId,a.Ay.chain(v).map((function(e){return e.value})).find((function(e){return e===t})).isUndefined().value()))return b.A.format(gettext("Your subscription only has access to built-in integration.\n\nExternal integrations are available on the Advanced plan and higher. Before you can make a new version of your application, you must {link} or delete this question."),{link:r});var s=a.Ay.filter(e.form.getMugList(),(function(e){return e.p.androidIntentAppId}));if(s.length>1){var l=a.Ay.countBy(s,(function(e){return e.p.nodeID}));a.Ay.each(s,(function(e){(l[e.p.nodeID]>1?e.messages.update("nodeID",{key:"intent-nodeID-duplicate",level:e.ERROR,message:gettext("Android app callouts of the same type must have different question ids.")}):e.dropMessage("nodeID","intent-nodeID-duplicate"))&&e.fire({type:"messages-changed",mug:e})}))}return"pass"}},androidIntentExtra:{lstring:gettext("Extra"),visibility:"visible",widget:x.A.baseKeyValue,serialize:P},androidIntentResponse:{lstring:gettext("Response"),visibility:"visible",widget:x.A.baseKeyValue,serialize:P},unknownAttributes:{visibility:"hidden",presence:"optional",serialize:P},intentXmlns:{visibility:"hidden",presence:"optional",lstring:gettext("Special Intent XMLNS attribute")}},getAppearanceAttribute:function(e){return"intent:"+e.p.nodeID}}),S=b.A.extend(T,{typeName:gettext("Print"),icon:"fa fa-print",init:function(e,t){T.init(e,t),e.p.androidIntentAppId="org.commcare.dalvik.action.PRINT"},spec:{docTemplate:{lstring:gettext("Document Template"),visibility:"visible",widget:function(e,t){var n=x.A.abstractMediaWidget(e,t);return n.getBaseMediaPath=function(){return"jr://file/commcare/text/"+e.p.nodeID},n}},androidIntentAppId:{visibility:"hidden"}}});function N(e){return!e.custom_intents&&!e.templated_intents}function E(e){return e.templated_intents&&!e.custom_intents}r().vellum.plugin("intents",{},{init:function(){var e=this.opts().intents;v=a.Ay.map(e&&e.templates,(function(e){return{value:e.id,text:e.name,type:e.mime}}))},loadXML:function(e){var t,n;this.data.intents.unmappedIntentTags=(t=o.A.parseXML(e).find("h\\:head, head").children("odkx\\:intent, intent"),n={},a.Ay.each(t,(function(e){var t,i,o;i=(t=r()(e)).xmlAttr("id"),(o=M(i,t.xmlAttr("class"))).xmlns=t.xmlAttr("xmlns:odkx")||o.intentXmlns,o.androidIntentExtra=_(t,"extra"),o.androidIntentResponse=_(t,"response"),a.Ay.chain(e.attributes).filter((function(e){return!a.Ay.contains(["id","class","xmlns:odk"],e.nodeName)})).each((function(e){o.unknownAttributes[e.nodeName]=e.nodeValue})),n[i]=o})),n),this.__callOld()},contributeToHeadXML:function(e,t){this.__callOld(),function(e,t,n){a.Ay.each(e,(function(e){I(t,e)})),n.treeMap((function(e){var n=e.getValue();n&&"intent"===n.options.dataType&&I(t,n.p,n)}))}(this.data.intents.unmappedIntentTags,e,t.tree)},handleNewMug:function(e){var t=this.__callOld();return k(this.data.intents.unmappedIntentTags,e),t},handleMugParseFinish:function(e){this.__callOld(),k(this.data.intents.unmappedIntentTags,e)},getMugTypes:function(){var e=this.__callOld();return e.normal.AndroidIntent=T,e.normal.PrintIntent=S,e},getAdvancedQuestions:function(){var e=this.__callOld();return N(this.opts().features)||(e.push("AndroidIntent"),this.opts().features.printing&&e.push("PrintIntent")),e},getMainProperties:function(){var e=this.__callOld().concat(w);return E(this.opts().features)&&(e=a.Ay.without(e,"androidIntentExtra","androidIntentResponse")),e}});var D=n(9740),R=n.n(D);function O(e,t){var n=r()(R()()),a=n.find("[name=instance-id]"),i=n.find("[name=instance-src]"),o=n.find("[name=query]");function s(){return{id:a.val(),src:i.val(),query:o.val()}}e.empty().append(n),t.source&&(a.val(t.source.id||""),i.val(t.source.src||""),o.val(t.source.query||"")),t.change&&(a.on("change keyup",(function(){t.change(s())})),i.on("change keyup",(function(){t.change(s())})),o.on("change keyup",(function(){t.change(s())})));var l=function(n){e.find(".fd-data-source-editor").hide(),t.done(n)};n.find(".fd-data-source-save-button").click((function(){l(s())})),n.find(".fd-data-source-cancel-button").click((function(){l()})),t.onLoad&&t.onLoad(n)}function L(e){function t(e,n){return a.Ay.map(e,(function(e,i){var r=[],o={id:n.id,src:n.src,query:n.query+"/"+i,name:n.name+" - "+(e.name||i)};return a.Ay.isEmpty(e.structure)||e.no_option||(r=[o]),r.concat(t(e.structure,o))}))}return a.Ay.flatten(a.Ay.map(e,(function(e){var n={id:e.id,src:e.uri,query:"instance('"+e.id+"')"+e.path,name:e.name||e.id};return[n].concat(t(e.structure,n))})))}const q={advancedDataSourceWidget:function(e,t,n){var i=x.A.text(e,t),o=x.A.util.getUIElement,s=x.A.util.getUIElementWithEditButton,l=i.getValue,d=i.setValue,u=null;function c(){return u.query=l(),u}function p(e){u=e,d(e.query||"")}return i.options.richText=!1,i.getUIElement=function(){var t=s(o(i.input,n),(function(){e.form.vellum.displaySecondaryEditor({source:c(),headerText:n,loadEditor:O,onLoad:function(e){x.A.util.setWidget(e,i)},done:function(e){a.Ay.isUndefined(e)||(p(e),i.handleChange())}})}));return r()("<div></div>").append(t)},i.getValue=c,i.setValue=p,i},fixtureWidget:function(e,t,n){var i=gettext("Lookup table was not found in the project"),o=JSON.stringify({src:"",id:"",query:""});function s(e){return!e||a.Ay.all(a.Ay.map(e,a.Ay.isEmpty))}function l(){var e=c();return e?JSON.parse(e):o}function d(e){var t=o;s(e)||(t=JSON.stringify(e),u.equivalentOption(t)||u.addOption(t,i)),p(t),g=!0}var u=x.A.dropdown(e,t),c=u.getValue,p=u.setValue,f=t.getSource?t.getSource:l,h=t.setSource?t.setSource:d,g=!1;u.options.richText=!1,u.addOption(o,gettext("Loading..."));var m=e.form.vellum.datasources.onChangeReady((function(){var n,i=e.form.vellum.datasources.getDataSources();t.dataSourcesFilter&&(i=t.dataSourcesFilter(i)),g&&(n=l()),u.clearOptions();var r=L(i);u.addOptions(function(e){return a.Ay.map(e,(function(e){return{value:JSON.stringify(a.Ay.omit(e,"name")),text:e.name}}))}(r)),g&&!s(n)?d(n):r&&r.length&&d(a.Ay.omit(r[0],"name")),t.onOptionsLoaded&&t.onOptionsLoaded(i)}));return e.on("teardown-mug-properties",m,null,"teardown-mug-properties"),t.hasAdvancedEditor&&(u.getUIElement=function(){var t=x.A.util.getUIElementWithEditButton(x.A.util.getUIElement(u.input,n),(function(){e.form.vellum.displaySecondaryEditor({source:f(e),headerText:n,loadEditor:O,onLoad:function(e){x.A.util.setWidget(e,u)},done:function(t){a.Ay.isUndefined(t)||(h(t,e),u.handleChange())}})}));return t.find(".fd-edit-button").text("..."),r()("<div></div>").append(t)}),u.getValue=l,u.setValue=d,u},autocompleteChoices:function(e,t){var n=a.Ay.find(e,(function(e){return e.uri===t}));return n?function(e){return e?a.Ay.flatten(function e(t){return a.Ay.map(t,(function(t,n){return[n].concat(a.Ay.map(e(t.structure),(function(e){return n+"/"+e})))}))}(e.structure)):[]}(n):[]},getPossibleFixtures:L};var F,V,j,B,z=n(939),U=n(2183),X=y.A.baseMugTypes.normal,H=/\[[^\[\]]*\]$/;function $(e,t){var n=t.form.getChildren(t);if(n.length)return n[0];var a=G(t),i=e.createQuestion(t,"into","Itemset",!0);if(a.length){var r=a[0].uri,o="instance('"+a[0].id+"')"+a[0].path;(i=Y(i,q.autocompleteChoices(a,r))).p.filter="",i.p.itemsetData={instance:e.parseInstance(o,i,"itemsetData"),nodeset:o}}return i}F=b.A.extend(y.A.defaultOptions,{isControlOnly:!0,typeName:gettext("Lookup Table Data"),tagName:"itemset",icon:"fa fa-th",isTypeChangeable:!1,isRemoveable:!1,isCopyable:!1,getIcon:function(e){return"fa fa-th"},init:function(e,t,n){e.p.itemsetData={}},writeControlLabel:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){var n=t.p.itemsetData.nodeset,a=t.p.filter,i=t.p.valueRef,r=t.p.labelRef,o=t.p.sortRef;a&&(n+="["+a+"]"),b.A.writeHashtags(e,"nodeset",n||"",t),e.writeStartElement("label"),e.writeAttributeString("ref",r||""),e.writeEndElement(),e.writeStartElement("value"),e.writeAttributeString("ref",i||""),e.writeEndElement();var s=t.form.vellum.opts().features;o&&o.trim()&&s.sorted_itemsets&&(e.writeStartElement("sort"),e.writeAttributeString("ref",o),e.writeEndElement())},spec:{label:{presence:"notallowed"},labelItext:{presence:"notallowed"},labelItextID:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},hintItextID:{presence:"notallowed"},helpItext:{presence:"notallowed"},helpItextID:{presence:"notallowed"},mediaItext:{presence:"notallowed"},otherItext:{presence:"notallowed"},appearance:{presence:"notallowed"},itemsetData:{lstring:gettext("Lookup Table"),visibility:"visible_if_present",presence:"optional",widget:function(e,t){function n(e){return!e||a.Ay.all(a.Ay.map(e,a.Ay.isEmpty))}function i(t){var n=p(),a=q.autocompleteChoices(t,n?n.src:"");return z.A.autocomplete(r()("#property-valueRef"),e,{choices:a}),z.A.autocomplete(r()("#property-labelRef"),e,{choices:a}),z.A.autocomplete(r()("#property-sortRef"),e,{choices:a}),a}function o(t){if(l=t,d=!0,u){var a=i(t);a&&a.length&&n(s.value)&&(e=Y(e,a),s.hasOwnProperty("value")&&h())}}t=a.Ay.extend({},t,{onOptionsLoaded:o,dataSourcesFilter:j.dataSourcesFilter}),V&&(t.hasAdvancedEditor=!0,t.getSource=function(e){var t=p();return e.p.filter&&(t.query+="["+e.p.filter+"]"),t},t.setSource=function(e,t){var n=e,a=W(e.query);n.query=a.value,t.p.filter=a.filter,f(n)});var s={},l=[],d=!1,u=!1,c=q.fixtureWidget(e,t,gettext("Lookup Table")),p=c.getValue,f=c.setValue,h=c.handleChange;return c.handleChange=function(){i(l),h()},c.getValue=function(){var e=p();return{instance:r().trim(e.src)?{id:e.id,src:e.src}:{id:null,src:null},nodeset:e.query}},c.setValue=function(e){var t=s.hasOwnProperty("value");s.value=e,d&&!t&&n(e)?h():(e=a.Ay.isEmpty(e)?{instance:{}}:e,f({id:e.instance?e.instance.id:"",src:e.instance?e.instance.src:"",query:e.nodeset||""}))},u=!0,d&&o(l),c},serialize:function(e,t,n,a){return e.nodeset=y.A.serializeXPath(e.nodeset,t,n,a),e},deserialize:function(e,t,n,a){var i=e[t];if(i){if(y.A.updateInstances(e,n),i.instance&&i.instance.id&&i.instance.src){var r={};r[i.instance.id]=i.instance.src,n.form.updateKnownInstances(r)}var o={form:n.form,p:i};i.nodeset=y.A.deserializeXPath(i,"nodeset",o,a),i.valueRef&&(n.p.valueRef=i.valueRef),i.labelRef&&(n.p.labelRef=i.labelRef),i.sortRef&&(n.p.sortRef=i.sortRef)}return i},validationFunc:function(e){if(!e.options.lookupTablesEnabled)return b.A.format(gettext("You no longer have access to Lookup Tables in your application. Lookup Tables are available on the Standard plan and higher.\nBefore you can make a new version of your application, you must {link} or delete this question"),{link:B?"["+gettext("change your subscription")+"]("+B+")":gettext("change your subscription")});var t=e.p.itemsetData;return t.nodeset?(e.form.updateLogicReferences(e,"itemsetData",t.nodeset),"pass"):gettext("A data source must be selected.")}},valueRef:{lstring:"Value Field",widget:K,visibility:"visible",presence:"required",validationFunc:J("valueRef"),serialize:function(e,t,n,a){n.p.valueRef&&(a.itemsetData[0].valueRef=n.p.valueRef)}},labelRef:{lstring:gettext("Display Text Field"),widget:K,visibility:"visible",presence:"required",validationFunc:J("labelRef"),serialize:function(e,t,n,a){n.p.labelRef&&(a.itemsetData[0].labelRef=n.p.labelRef)}},sortRef:{lstring:gettext("Sort Field"),widget:K,visibility:function(e){return e.form.vellum.opts().features.sorted_itemsets},presence:"optional",validationFunc:J("sortRef"),serialize:function(e,t,n,a){n.p.sortRef&&(a.itemsetData[0].sortRef=n.p.sortRef)}},filter:{lstring:gettext("Filter"),presence:"optional",widget:x.A.xPath,xpathType:"bool",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,visibility:"visible",leftPlaceholder:"",autocompleteChoices:function(e){var t=G(e),n=e.p.itemsetData.instance.src;return q.autocompleteChoices(t,n)},help:gettext("This is an XPath expression that will filter the set of choices from the lookup table")}}});var Q={presence:"optional",visibility:"hidden",serialize:function(e,t,n,i){return e=a.Ay.chain(n.form.getChildren(n)).map((function(e){return e.spec[t].serialize(e.p[t],t,e,i)})).filter(a.Ay.identity).value(),a.Ay.isEmpty(e)?void 0:e},deserialize:function(e,t,n,i){a.Ay.each(e[t],(function(r,o){var s=n.form.getChildren(n)[o]||$(n.form,n),l=a.Ay.clone(e);l[t]=r,s.p[t]=s.spec[t].deserialize(l,t,s,i)}))}};function W(e){var t=e.search(H);return-1!==t?{value:e.slice(0,t),filter:e.slice(t+1,-1)}:{value:e,filter:""}}function G(e){var t=e.form.vellum.datasources.getDataSources([]);return j.dataSourcesFilter&&(t=j.dataSourcesFilter(t)),t}function Y(e,t){return e.p.labelRef||(a.Ay.contains(t,"name")?e.p.labelRef="name":e.p.labelRef=t[0]),e.p.valueRef||(a.Ay.contains(t,"@id")?e.p.valueRef="@id":e.p.valueRef=t.length>1?t[1]:t[0]),e}function K(e,t){var n=x.A.text(e,t),a=e.p.itemsetData,i=a?a.instance:null,r=i?i.src:"",o=q.autocompleteChoices(G(e),r);return z.A.autocomplete(n.input,e,{choices:o}),n}function J(e){return function(t){var n=t.p.itemsetData,i=t.p[e],r=n.instance,o=r?r.src:"",s=G(t),l=q.getPossibleFixtures(s),d=a.Ay.some(l,(function(e){return e.src===o})),u=q.autocompleteChoices(s,o),c=i.replace(/\[[^\[]+]/g,"");return d&&!a.Ay.contains(u,c)?b.A.format(gettext("{attr} was not found in the lookup table"),{attr:i}):"pass"}}r().vellum.plugin("itemset",{},{init:function(){j=this.opts().itemset,V=this.opts().features.advanced_itemsets,F.lookupTablesEnabled=this.opts().features.lookup_tables,B=this.opts().core.externalLinks.changeSubscription},getQuestionGroups:function(){var e=this.__callOld();return this.opts().features.lookup_tables&&e.splice(e.length-1,0,{group:["SelectDynamic",gettext("Lookup Tables")],questions:["SelectDynamic","MSelectDynamic"]}),e},getMugTypes:function(){var e=this.__callOld();return e.auxiliary.Itemset=F,e.normal=r().extend(e.normal,{MSelectDynamic:b.A.extend(X.MSelect,{typeName:gettext("Checkbox Lookup Table"),typeChangeError:function(e,t){return t.match(/^M?Select$/)?e.form.getChildren(e).length>0?gettext("Cannot change to Multiple/Single Choice question if it has Choices. Please remove all Choices and try again."):"":"SelectDynamic"===t?"":gettext("Can only change to a Multiple Choice Lookup Table")},validChildTypes:["Itemset"],maxChildren:1,afterInsert:$,canAddChoices:!1,spec:{itemsetData:Q,valueRef:Q,labelRef:Q,sortRef:Q,filter:Q}}),SelectDynamic:b.A.extend(X.Select,{typeName:gettext("Multiple Choice Lookup Table"),typeChangeError:function(e,t){return t.match(/^M?Select$/)?e.form.getChildren(e).length>0?gettext("Cannot change to Multiple/Single Choice question if it has Choices. Please remove all Choices and try again."):"":"MSelectDynamic"===t?"":gettext("Can only change to a Checkbox Lookup Table")},validChildTypes:["Itemset"],maxChildren:1,afterInsert:$,canAddChoices:!1,spec:{itemsetData:Q,valueRef:Q,labelRef:Q,sortRef:Q,filter:Q}})}),e},updateControlNodeAdaptorMap:function(e){this.__callOld();var t=s.A.makeControlOnlyMugAdaptor("Itemset");e.itemset=function(e,n,a,i){var r=function(n,a){"Select"===i.__className?a.changeMugType(i,"SelectDynamic"):"MSelect"===i.__className?a.changeMugType(i,"MSelectDynamic"):U.A.log("Unknown parent type: "+i.__className),n=t(n,a);var r=W(e.popAttr("vellum:nodeset")||e.popAttr("nodeset"));n.p.filter=r.filter,n.p.itemsetData={instance:a.parseInstance(r.value,n,"itemsetData"),nodeset:r.value},n.p.labelRef=e.children("label").xmlAttr("ref"),n.p.valueRef=e.children("value").xmlAttr("ref");var o=e.children("sort");return o.length&&(n.p.sortRef=o.xmlAttr("ref")),n};return r.ignoreDataNode=!0,r}},loadXML:function(){this.__callOld(),this.data.core.form.on("mug-property-change",(function(e){var t=e.mug;"Itemset"===t.__className&&"itemsetData"===e.property&&function(e,t,n){if(n&&n.instance&&n.instance.src&&e.form.dropInstanceReference(n.instance.src,e,"itemsetData.instance"),t&&t.instance&&t.instance.src){var a=e.form.addInstanceIfNotExists(t.instance,e,"itemsetData.instance");a!==t.instance.id&&(t.instance.id=a,t.nodeset=e.form.updateInstanceQuery(t.nodeset,a))}}(t,e.val,e.previous)}))},getMainProperties:function(){return this.__callOld().concat(["valueRef","labelRef","sortRef"])},getLogicProperties:function(){var e=this.__callOld();return e.push("filter"),e},changeMugType:function(e,t){var n=e.__className.match(/^M?Select/)&&t.match(/^M?SelectDynamic$/);this.__callOld(),n&&$(e.form,e)}});var Z=n(5674),ee=n.n(Z),te=n(6328),ne=n.n(te),ae=n(9832),ie=n(3578),re=n.n(ie),oe=n(6294),se=n(7207),le=n.n(se),de=n(9443),ue=n.n(de),ce=n(4489),pe=n.n(ce),fe=n(3591),he=n.n(fe),ge=n(3876),me=n(4459),ve={image:"png",audio:"mp3",video:"3gp","video-inline":"3gp"},ye=function(e,t,n,i){var r,o,s=e.form.vellum.data.javaRosa.Itext,l="itext-"+t+"-"+i.itextType,d=i.baseWidgetClass||x.A.richTextarea;i.language=t,i.idSuffix&&(l+=i.idSuffix),i.id=l,(o=(r=d(e,i)).input).addClass("jstree-drop"),"labelItext"===i.path&&(e.form.richText||o.keydown((function(e){if(e&&8===e.which||46===e.which){var t,n,a=r.getControl()[0],i=b.A.getCaretPosition(a),o=r.getValue(),s="<output";if(8===e.which?i>1&&"/>"===o.substr(i-2,2)&&(t=o.lastIndexOf(s,i),n=i):46===e.which&&o.substr(i,7)===s&&(n=-1===(n=o.indexOf("/>",i))?n:n+2,t=i),t||n&&-1!==t&&-1!==n){var l=o.slice(0,t)+o.slice(n,o.length);r.setValue(l),b.A.setCaretPosition(a,t),e.preventDefault()}}}))),a.Ay.contains(ge.A.ITEXT_PROPERTIES,i.path)&&z.A.autocomplete(o,e,{category:"Output Value",insertTpl:'<output value="${name}" />',property:"labelItext",outputValue:!0,useRichText:e.form.richText}),r.displayName=i.displayName,r.itextType=i.itextType,r.form=n||"default",r.language=t,r.languageName=b.A.langCodeToName[r.language]||r.language,r.showOneLanguage=s.getLanguages().length<2,r.defaultLang=s.getDefaultLanguage(),r.isDefaultLang=r.language===r.defaultLang,r.isSyncedWithDefaultLang=!1,r.getItextItem=function(){return i.getItextByMug(r.mug)},r.getItextValue=function(t){var n,a=r.getItextItem();return t||(t=r.language),n=a&&a.get(r.form,t),e.form.richText?ge.A.outputToHashtag(n,r.mug.form.xpath):ge.A.outputToXPath(n,r.mug.form.xpath)},r.setItextValue=function(e){e=me.A.sanitizeInput(e);var t=r.getItextItem();e=ge.A.outputToHashtag(e,r.mug.form.xpath),t&&(r.isDefaultLang&&r.mug.fire({type:"defaultLanguage-itext-changed",form:r.form,prevValue:t.get(r.form,r.language),value:e,itextType:r.itextType}),t.getForm(r.form).setValue(r.language,e))},r.getLangDesc=function(){return r.showOneLanguage?"":" ("+r.languageName+")"},r.getDisplayName=function(){return r.displayName+r.getLangDesc()},r.init=function(e){if(e){var t=r.getDefaultValue();r.getItextItem().getOrCreateForm(r.form),r.setValue(t),r.handleChange()}else{var n=r.getItextValue();a.Ay.isString(n)||(n=r.isDefaultLang?"":r.getItextValue(r.defaultLang)||""),r.setItextValue(n),r.setValue(n)}};var u=r.updateValue;return r.updateValue=function(){u(),r.getValue()||r.isDefaultLang||r.setItextValue(r.getItextValue(r.defaultLang))},r.toggleDefaultLangSync=function(e){r.isSyncedWithDefaultLang=!e&&!r.isDefaultLang},r.getDefaultValue=function(){return null},r.isDefaultLang||r.mug.on("defaultLanguage-itext-changed",(function(e){e.form===r.form&&e.itextType===r.itextType&&r.getItextValue()===e.prevValue&&(r.setItextValue(e.value),r.setValue(e.value))}),null,"teardown-mug-properties"),r.refreshMessages=function(){r.getMessagesContainer().empty().append(r.getMessages(e,r.id))},r.save=function(){r.setItextValue(r.getValue())},r},xe=function(e,t,n,a){var i=ye(e,t,n,a),r=i.handleChange;return i.handleChange=function(){var t=i.getItextItem(),n=t&&t.get(i.form,i.language);r();var a=t&&t.get(i.form,i.language);n!==a&&e.form.fire({type:"question-label-text-change",mug:e,text:a})},i},be=function(e,t,n,a){(a=a||{}).idSuffix="-"+n;var i=ye(e,t,n,a);return i.getDisplayName=function(){return n+i.getLangDesc()},i};const Ae={form:be,id:function(e,t){var n=x.A.text(e,t),a=n.input,i=null;function o(){return ge.A.getDefaultItextId(e,n.path.replace(/Itext$/,""))}function s(){l(o()),u(!0)}var l=n.setValue;n.setValue=function(e){i=e,e.autoId?s():(l(e.id),u(!1))},n.getValue=function(){return i.id=a.val(),i.autoId=c(),i};var d=r()("<input />").attr("type","checkbox");function u(e){d.prop("checked",e)}function c(){return d.prop("checked")}d.change((function(){r()(this).prop("checked")&&(i.refCount>1&&(i.refCount--,i=i.clone()),s(),n.handleChange())}));var p=n.getUIElement;return n.getUIElement=function(){var e=p().css("position","relative"),t=r()(pe()());return t.find("label").prepend(d),e.find(".controls").removeClass("col-sm-9").addClass("col-sm-8").after(t),e},n.input.keyup((function(){r()(this).val()!==o()&&u(!1)})),e.on("property-changed",(function(e){c()&&"nodeID"===e.property&&a.val(o())}),null,"teardown-mug-properties"),n},label:xe,markdown:function(e,t,n,a){var i,o,s=(a=a||{}).parent,l=xe(e,t,n,a),d=l.setValue,u=l.getUIElement,c=l.handleChange,p=!0,f=a.vellum.opts().features.markdown_tables;return l.toggleMarkdown=function(){s.toggleClass("has-markdown"),l.mug.form.fire("change")},o=r()("<div>").addClass("controls well markdown-output col-sm-9"),b.A.isRightToLeftLanguage(a.language)&&o.attr("dir","rtl"),l.handleChange=function(){c();var e=l.getValue(),t=l.getItextItem();ge.A.looksLikeMarkdown(e,f)?p&&(s.removeClass("markdown-ignorant"),s.addClass("has-markdown")):e||s.removeClass("has-markdown"),t.hasMarkdown=i.is(":visible"),o.html(b.A.markdown(e)).closest(".form-group").removeClass("hide")},l.setValue=function(e,t){d(e,t),e||o.closest(".form-group").addClass("hide"),o.html(b.A.markdown(e))},l.getUIElement=function(){var e=u(),t=l.getValue(),n=r()("<div />").addClass("col-sm-3"),d=r()("<div />").addClass("col-sm-9"),c=r()("<div />").addClass("form-group").addClass("markdown-group");return e.detach(".markdown-output"),c.append(n),d.append(o),c.append(d),e.append(c),e.find(".control-label").append(he()({title:a.lstring})),i=e.find(".turn-markdown-off").click((function(){return p=!1,l.getItextItem().hasMarkdown=!1,l.toggleMarkdown(),!1})),e.find(".turn-markdown-on").click((function(){return p=!0,l.getItextItem().hasMarkdown=!0,l.toggleMarkdown(),!1})),l.getItextItem().hasMarkdown?s.addClass("has-markdown"):ge.A.looksLikeMarkdown(t,f)?(o.html(b.A.markdown(t)),i.removeClass("hide")):s.addClass("markdown-ignorant"),e},l},media:function(e){return function(t,n,a,i){i.baseWidgetClass=x.A.text;var r=be(t,n,a,i);return r.getDefaultValue=function(){if(-1!==ge.A.SUPPORTED_MEDIA_TYPES.indexOf(a)){var e=ve[a];return r.getBaseMediaPath()+"."+e}return null},r.getBaseMediaPath=function(){return"jr://file/commcare/"+a+e+ge.A.getDefaultItextRoot(r.mug)},r.mug.form.vellum.initMediaUploaderWidget(r),r}}};var we=a.Ay.union(b.A.SUPPORTED_MEDIA_TYPES,["default","short","long"]),Me=["Choice","Group","FieldList","Repeat"],_e=function(e,t){var n=e.form.vellum.data.javaRosa.Itext,i={};b.A.eventuality(i),i.mug=e,i.itextType=t.itextType,i.languages=n.getLanguages(),i.defaultLang=n.getDefaultLanguage(),i.forms=t.forms||["default"],i.getItextItem=function(){return t.getItextByMug(i.mug)},i.setValue=function(e){},i.getValue=function(e){};var o=r()("<div />").addClass("controls").addClass("messages"),s=r()("<div />").addClass("itext-block-container").addClass("itext-block-"+i.itextType);return i.getFormGroupClass=function(e){return"itext-block-"+i.itextType+"-group-"+e},i.getFormGroupContainer=function(e){return r()("<div />").addClass(i.getFormGroupClass(e)).addClass("itext-lang-group")},i.getForms=function(){return i.forms},i.refreshMessages=function(){if(t.messagesPath){var n=x.A.util.getMessages(e,t.messagesPath);o.empty().append(n)}},e.on("messages-changed",(function(){i.refreshMessages()}),null,"teardown-mug-properties"),i.getUIElement=function(){return a.Ay.each(i.getForms(),(function(e){var n=i.getFormGroupContainer(e),r=i.languages;t.vellum.data.javaRosa.showOnlyCurrentLang&&(r=a.Ay.intersection([t.vellum.data.javaRosa.Itext.defaultLanguage,t.vellum.data.core.currentItextDisplayLanguage],i.languages)),a.Ay.each(r,(function(r){var o=i.itextWidget(i.mug,r,e,a.Ay.extend(t,{parent:s}));o.init(),o.on("change",(function(){i.fire("change")}));var l=o.getUIElement();x.A.util.setWidget(l,o),n.append(l)})),s.append(n)})),s.append(o),s},i},Ce=function(e,t){var n=_e(e,t);n.isCustomAllowed=t.isCustomAllowed,n.activeForms=n.getItextItem().getFormNames(),n.displayName=t.displayName,n.formToIcon=t.formToIcon||{},n.itextWidget=Ae.form,n.getForms=function(){var e=a.Ay.difference(n.activeForms,we),t=a.Ay.intersection(n.activeForms,n.forms);return a.Ay.union(e,t)};var i=n.getFormGroupContainer;n.getFormGroupContainer=function(e){var t=i(e);return t.addClass("itext-lang-group-config").addClass("well").data("formtype",e),t},n.getAddFormButtonClass=function(e){return"itext-block-"+n.itextType+"-add-form-"+e},n.getAddFormButtons=function(){var e=r()("<div />").addClass("btn-group itext-options");return a.Ay.each(n.forms,(function(t){var a=r()("<div />");a.text(" "+t).addClass(n.getAddFormButtonClass(t)).addClass("btn btn-default itext-option").click((function(){n.addItext(t)}));var i=n.formToIcon[t];i&&a.prepend(r()("<i />").addClass(i).after(" ")),-1!==n.activeForms.indexOf(t)&&a.addClass("disabled"),e.append(a)})),n.isCustomAllowed&&e.append(n.getAddCustomItextButton()),e},n.getAddCustomItextButton=function(){var t=r()("<button />").text(gettext("custom...")).addClass("btn btn-default").attr("type","button"),a="fd-new-itext-button";return t.click((function(){var t,i,o;t=e.form.vellum.generateNewModal(gettext("New Content Type"),[{title:gettext("Add"),cssClasses:a+" disabled ",attributes:{disabled:"disabled"}}]),i=r()(ue()({label:gettext("Content Type")})),(o=r()("<input />").attr("type","text").addClass("form-control")).keyup((function(){var t=r()(this).val(),i=e.form.vellum.$f.find("."+a);t&&-1===we.indexOf(t)&&-1===n.activeForms.indexOf(t)?i.removeClass("disabled").addClass("btn-primary").prop("disabled",!1):i.addClass("disabled").removeClass("btn-primary").prop("disabled",!0)})),i.find(".controls").append(o),t.find(".modal-body").append(i),e.form.vellum.$f.find("."+a).click((function(){o.val()&&(n.addItext(o.val()),t.modal("hide"))})),t.modal("show"),t.one("shown.bs.modal",(function(){o.focus()}))})),t},n.deleteItextForm=function(e){var t=n.getItextItem();t&&t.removeForm(e),n.activeForms=a.Ay.without(n.activeForms,e),n.fire("change")},n.getDeleteFormButton=function(e){var t=r()(le()());return t.addClass("pull-right").addClass("delete-"+n.getFormGroupClass(e)).click((function(){var t=r()("."+n.getFormGroupClass(e));n.deleteItextForm(e),t.remove(),r()(this).remove(),r()("."+n.getAddFormButtonClass(e)).removeClass("disabled")})),t},n.addItext=function(e){if(-1===n.activeForms.indexOf(e)){n.activeForms.push(e),n.fire("change"),r()("."+n.getAddFormButtonClass(e)).addClass("disabled");var i=n.getFormGroupContainer(e);a.Ay.each(n.languages,(function(a){var r=n.itextWidget(n.mug,a,e,t);r.init(!0),r.on("change",(function(){n.fire("change")}));var o=r.getUIElement();x.A.util.setWidget(o,r),i.append(o)})),o.find(".new-itext-form-group").after(i),i.find(".col-sm-9").removeClass("col-sm-9").addClass("col-sm-8"),i.before(n.getDeleteFormButton(e))}};var o=r()("<div />"),s=n.getUIElement;return n.getUIElement=function(){o=s();var e=r()(ue()({label:n.displayName}));return e.addClass("new-itext-form-group").find(".controls").append(n.getAddFormButtons()),o.prepend(e),o.find(".itext-lang-group").each((function(){r()(this).find(".col-sm-9").removeClass("col-sm-9").addClass("col-sm-8"),r()(this).before(n.getDeleteFormButton(r()(this).data("formtype")))})),o},n};const Ie=Ce,ke=function(e,t){var n=_e(e,t);return!t.vellum.opts().features.markdown_in_groups&&a.Ay.contains(Me,e.__className)||e.form.noMarkdown?n.itextWidget=Ae.label:n.itextWidget=Ae.markdown,n},Pe=function(e,t){var n=Ce(e,t),i=t.pathPrefix;return a.Ay.isString(t.pathPrefix)||(i="/"+t.itextType),n.getForms=function(){return a.Ay.intersection(n.activeForms,n.forms)},n.itextWidget=Ae.media(i+e.form.getBasePath()),n};var Te={image:"fa-regular fa-image",audio:"fa fa-volume-up",video:"fa fa-video-camera","video-inline":"fa fa-play"};r().vellum.plugin("javaRosa",{langs:["en"],displayLanguage:"en"},{init:function(){this.data.javaRosa.ItextItem=oe.A.item,this.data.javaRosa.ItextForm=oe.A.form,this.data.javaRosa.ICONS=Te,this.data.javaRosa.showOnlyCurrentLang=this.opts().javaRosa.showOnlyCurrentLang},handleDropFinish:function(e,t,n,a){var i=e&&e.attr("name")&&0===e.attr("name").lastIndexOf("itext-",0),r=this;if(i){"Date"===(n&&n.options.typeName)?ae.A.showMenu(a.clientX,a.clientY,(function(a){ge.A.insertOutputRef(r,e,t,n,a)})):ge.A.insertOutputRef(r,e,t,n);var o=b.A.getReferenceName(t);re().usage(o,"Drag and Drop","Label")}else r.__callOld()},handleNewMug:function(e){var t=this.__callOld();return this.data.javaRosa.Itext.updateForMug(e),t},_makeLanguageSelectorDropdown:function(){var e,t,n,i=this,o=this.data.javaRosa.Itext.getLanguages(),s=this.$f.find(".fd-questions-menu");(n=a.Ay.map(o,(function(e){return{code:e,name:b.A.langCodeToName[e]||e}})))[n.length]={code:"_ids",name:gettext("Question ID")},n.length<2||(s.find(".language-selector").remove(),s.find(".fd-bulk-update-menu").before(ne()({languages:n})),(e=s.find(".fd-display-item")).click((function(e){t.val(r()(this).data("code")).change(),e.preventDefault()})),(t=s.parent().find(".fd-question-tree-display")).change((function(){var n=t.val();i._changeTreeDisplayLanguage(n),e.removeClass("selected").filter("[data-code="+n+"]").addClass("selected")})),t.val(this.data.core.currentItextDisplayLanguage).change())},_changeTreeDisplayLanguage:function(e){var t=this,n=this.data.core.form;this.data.core.currentItextDisplayLanguage=e,this.data.core.$tree.find("li").each((function(e,a){var i=r()(a),o=n.getMugByUFID(i.prop("id"));if("_ids"===t.data.core.currentItextDisplayLanguage)t.jstree("rename_node",i,o.getNodeID());else if(o.p.labelItext){var s=t.getMugDisplayName(o);t.jstree("rename_node",i,s||t.opts().core.noTextString)}})),n&&n.fire({type:"change-display-language"})},loadXML:function(e){var t,n,a=this,i=this.opts().javaRosa.langs;if(this.data.javaRosa.Itext=t=new oe.A.model,this.data.javaRosa.itextMap=n={},i&&i.length>0){for(var s=0;s<i.length;s++)t.addLanguage(i[s]);t.setDefaultLanguage(i[0])}if(e){var l=o.A.parseXML(e).find("h\\:head, head").find("itext");r()(l).children().each((function(){var e=r()(this),a=e.xmlAttr("lang");i&&-1===i.indexOf(a)||(t.addLanguage(a),e.children().each((function(){var e=r()(this),i=e.xmlAttr("id"),o=n[i];o&&n.hasOwnProperty(i)||((o=t.createItem(i)).refCount=0,n[i]=o),e.children().each((function(){var e=r()(this),t=e.xmlAttr("form");if(t){if("markdown"===t)return o.hasMarkdown=!0,void o.getOrCreateForm("default").setValue(a,e)}else if(t="default",o.hasMarkdown)return;o.getOrCreateForm(t).setValue(a,e)}))})))}))}this.data.core.currentItextDisplayLanguage=this.opts().javaRosa.displayLanguage||t.getDefaultLanguage(),this._makeLanguageSelectorDropdown(),this.__callOld(),delete this.data.javaRosa.itextMap,t.on("change",(function(){a.onFormChange()}))},onXFormLoaded:function(e){var t=this.opts().javaRosa.langs;ge.A.forEachItextItem(e,(function(n,i){(0,a.Ay)(n.forms).each((function(n){a.Ay.each(t,(function(t){var a=n.getValue(t);if(a){a=me.A.sanitizeInput(a);var i=o.A.query(a);i.find("output").replaceWith((function(){var t=r()(this),n=t.is("[value]")||!t.is("[ref]")?"value":"ref",a="vellum:"+n,i=t.xmlAttr(n),o=t.xmlAttr(a);return o?(i&&e.inferHashtagMeanings(o,i),i=o):i=function(t){try{return e.xpath.parse(t).toHashtag()}catch(e){return t}}(i),r()("<output />").xmlAttr("value",i)})),n.setValue(t,i.toString())}}))}))})),this.__callOld()},populateControlMug:function(e,t){this.__callOld();var n=this.data.javaRosa.Itext,a=this.data.javaRosa.itextMap;function i(t){try{var n=e.form.xpath.parse(t);if(n instanceof e.form.xpath.models.XPathFuncExpr&&"jr:itext"===n.id)return n.args[0].value}catch(e){}return""}function r(t,i){var r=!t||t===ge.A.getDefaultItextId(e,i);if(t){var o=a[t];if(o&&a.hasOwnProperty(t))return r||(o.autoId=!1),o.refCount++,o}return n.createItem(t,r)}function s(e,t){var n=e.xmlAttr("ref");return r(n?i(n):"",t)}var l=t.children("label"),d=t.children("hint"),u=t.children("help"),c=t.children("alert");if(l.length&&"notallowed"!==e.getPresence("label")){var p=s(l,"label"),f=o.A.humanize(l)||e.getLabelValue();p.getOrCreateForm("default").initUndefined(f),e.p.labelItext=p}if(d.length&&"notallowed"!==e.getPresence("hintLabel")&&(e.p.hintItext=s(d,"hint")),u.length&&"notallowed"!==e.getPresence("label")&&(e.p.helpItext=s(u,"help")),c.length&&"notallowed"!==e.getPresence("constraintMsgAttr"))e.p.constraintMsgItext=s(c,"constraintMsg");else if(e.p.constraintMsgAttr){var h=i(e.p.constraintMsgAttr);h&&(e.p.constraintMsgItext=r(h,"constraintMsg"),e.p.constraintMsgAttr=null)}e.options.isRepeat&&e.options.customRepeatButtonText&&function(e,t){var n=t.children("repeat"),a=n.children("jr\\:addEmptyCaption"),i=n.children("jr\\:addCaption");a.length&&(e.p.addEmptyCaptionItext=s(a,"addEmptyCaption")),i.length&&(e.p.addCaptionItext=s(i,"addCaption"))}(e,t)},handleMugParseFinish:function(e){this.__callOld(),this.data.javaRosa.Itext.updateForMug(e)},duplicateMugProperties:function(e){this.__callOld(),a.Ay.each(ge.A.ITEXT_PROPERTIES,(function(t){var n=e.p[t];n&&n.autoId&&(e.p[t]=n.clone())}))},contributeToModelXML:function(e,t){function n(e,n){(n=o.A.query(n)).find("output").each((function(){!function(e){var n,a,i,o=r()(e),s=o.is("[value]")||!o.is("[ref]")?"value":"ref",l="vellum:"+s,d=o.xmlAttr(l)||o.xmlAttr(s);try{a=(n=u.parse(d)).toHashtag(),i=n.toXPath()}catch(e){a=d,i=d}t.richText&&i!==a?o.xmlAttr(s,i).xmlAttr(l,a):o.xmlAttr(s,i).removeAttr(l)}(this)})),e.writeXML(n.toString())}var a,i,s,l,d,u=t.xpath,c=this.data.javaRosa.Itext,p=this.data.javaRosa.itextItemsFromBeforeSerialize,f=c.getLanguages();if(f.length>0){e.writeStartElement("itext");for(var h=0;h<f.length;h++){l=f[h],e.writeStartElement("translation"),e.writeAttributeString("lang",l),c.getDefaultLanguage()===l&&e.writeAttributeString("default","");for(var g=0;g<p.length;g++){a=p[g],e.writeStartElement("text"),e.writeAttributeString("id",a.id),i=a.getForms();for(var m=0;m<i.length;m++)d=(s=i[m]).getValueOrDefault(l),e.writeStartElement("value"),"default"!==s.name&&e.writeAttributeString("form",s.name),n(e,d),e.writeEndElement();a.hasMarkdown&&!this.data.core.form.noMarkdown&&(d=a.getForm("default").getValueOrDefault(l),e.writeStartElement("value"),e.writeAttributeString("form","markdown"),n(e,d),e.writeEndElement()),e.writeEndElement()}e.writeEndElement()}e.writeEndElement()}},beforeSerialize:function(){this.__callOld(),this.data.javaRosa.itextItemsFromBeforeSerialize=ge.A.getItextItemsFromMugs(this.data.core.form)},afterSerialize:function(){this.__callOld(),delete this.data.javaRosa.itextItemsFromBeforeSerialize},beforeBulkInsert:function(e){this.__callOld(),this.data.javaRosa.itextById=ge.A.getItextItemsFromMugs(e,!0)},afterBulkInsert:function(){this.__callOld(),delete this.data.javaRosa.itextById},getMugTypes:function(){var e=this.__callOld(),t=e.normal;return t.Group.spec=b.A.extend(t.Group.spec,{constraintMsgItext:{presence:"notallowed"}}),e},getMugSpec:function(){var e=this.__callOld(),t=this,n=e.databind,i=e.control;function s(e,t){return function(n){var a=n.p[e];if(!(a&&a.hasHumanReadableItext()||"required"!==n.getPresence(e)))return 1===a.itextModel.languages.length?b.A.format(gettext("{name} (or multimedia) is required."),{name:t}):b.A.format(gettext("{name} (or multimedia) is required for all languages."),{name:t});if(a&&!a.autoId&&!a.isEmpty()){if(!a.id)return b.A.format(gettext("{name} Itext ID is required."),{name:t});if(!b.A.isValidAttributeValue(a.id))return b.A.format(gettext("{name} is not a valid ID."),{name:a.id})}return"pass"}}function l(e){function n(e,t){var n=o.A.query(e);return n.find("output").each((function(){!function(e,t){var n=r()(e),a=n.is("[value]")||!n.is("[ref]")?"value":"ref",i=n.xmlAttr(a);i&&n.xmlAttr(a,t.transformHashtags(i))}(this,t)})),n.toString()}return e.serialize=function(e,t,n,i){var r=!1;a.Ay.each(e.forms,(function(n){n.isEmpty()||(r=!0,a.Ay.each(e.itextModel.languages,(function(e){var a=t+":"+e+"-"+n.name;i[a]=n.getValue(e)})))})),r&&!e.autoId&&(i[t]=e.id),e.hasMarkdown&&(i[t+":hasMarkdown"]=e.hasMarkdown)},e.deserialize=function(e,i,r,o){var s=r.p[i],l=!1;if(e[i]){var d=r.form.vellum.data.javaRosa.itextById,u=e[i];d.hasOwnProperty(u)&&!d[u].autoId?(r.p[i]=s=d[u],s.refCount++):(s.id=e[i],s.autoId=!1,d[s.id]=s)}var c=s.itextModel.getDefaultLanguage(),p=s.itextModel.languages,f=a.Ay.object(ge.A.SUPPORTED_MEDIA_TYPES,ge.A.SUPPORTED_MEDIA_TYPES),h=t.data.uploader.objectMap||{};function g(e){return null==e?"":String(e)}e.id&&e.id.slice(e.id.lastIndexOf("/")+1);var m=a.Ay.memoize((function(t){return!a.Ay.find(p,(function(n){return e[i+":"+n+"-"+t]}))}));a.Ay.each(p,(function(t){var d=i.length+t.length+2,u=new RegExp("^"+RegExp.escape(i)+":"+RegExp.escape(t)+"-"),p={};a.Ay.each(e,(function(a,v){if(u.test(v)){var y=v.slice(d),x=f.hasOwnProperty(y);if(x&&!a&&m(y))return;if(!p.hasOwnProperty(y)){p[y]=!0;var b=i+":"+c+"-"+y,A=e.hasOwnProperty(b)?g(e[b]):g(a);s.set(A,y),!x&&A&&o.later((function(){s.set(n(A,o),y)}))}s.set(g(a),y,t),!x&&a&&o.later((function(){s.set(n(a,o),y,t)})),x&&!h.hasOwnProperty(a)&&r.addMessage(i,{key:"missing-multimedia-warning",level:r.WARNING,message:gettext("Multimedia was not copied; it must be uploaded separately.")}),l=!0}}))})),l&&!e[i]&&(s.id=ge.A.getDefaultItextId(r,i.replace(/Itext$/,""))),e[i+":hasMarkdown"]&&(s.hasMarkdown=!0);var v="javaRosa-discarded-languages-warning",y=new RegExp("^"+RegExp.escape(i)+":(\\w+)-"),x=a.Ay.filter(a.Ay.map(a.Ay.keys(e),(function(e){var t=e.match(y);if(t&&-1===p.indexOf(t[1]))return t[1]})),a.Ay.identity);if(x.length){var b=o.errors.get(null,v);b?(b.langs=a.Ay.union(b.langs,x),b.message=gettext("Discarded languages:")+" "+b.langs.join(", ")):o.errors.update(null,{key:v,level:r.WARNING,langs:x,message:gettext("Discarded languages:")+" "+x.join(", ")})}r.validate(i)},e}function d(e){return e.trackLogicReferences=!0,e}function u(e){var t=e.p.constraintMsgItext;return e.p.constraintAttr||!t||t.isEmpty()?"pass":gettext("You cannot have a Validation Error Message with no Validation Condition!")}return n.constraintMsgAttr.visibility="hidden",n.constraintMsgItext=l({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Validation Message"),widget:d((function(e,t){return ke(e,r().extend(t,{itextType:"constraintMsg",messagesPath:"constraintMsgItext",getItextByMug:function(e){return e.p.constraintMsgItext},displayName:gettext("Validation Message")}))})),validationFunc:function(e){var t=e.p.constraintMsgItext;if(!e.p.constraintAttr&&t&&t.id&&!t.autoId)return gettext("Can't have a Validation Message Itext ID without a Validation Condition");var n=s("constraintMsgItext","Validation Message")(e);return"pass"===n&&(n=u(e)),n}}),n.constraintAttr.validationFunc=u,n.constraintMsgItextID={visibility:"constraintMsgItext",presence:"optional",lstring:gettext("Validation Message Itext ID"),widget:Ae.id,widgetValuePath:"constraintMsgItext"},n.constraintMediaIText=function(e){return e.isSpecialGroup?void 0:{visibility:function(e){return e.isVisible("constraintAttr")},presence:"optional",lstring:gettext("Add Validation Media"),widget:function(e,t){return Pe(e,r().extend(t,{displayName:gettext("Add Validation Media"),itextType:"constraintMsg",getItextByMug:function(e){return e.p.constraintMsgItext},forms:ge.A.SUPPORTED_MEDIA_TYPES,formToIcon:Te}))}}},i.label.visibility="visible_if_present",i.hintLabel.visibility="visible_if_present",i.labelItext=l({visibility:"visible",presence:"optional",lstring:gettext("Display Text"),widget:d((function(e,t){return ke(e,r().extend(t,{itextType:"label",messagesPath:"labelItext",getItextByMug:function(e){return e.p.labelItext},displayName:gettext("Display Text")}))})),validationFunc:s("labelItext",gettext("Display Text"))}),i.labelItextID={visibility:"labelItext",presence:"optional",lstring:gettext("Display Text Itext ID"),widget:Ae.id,widgetValuePath:"labelItext"},i.hintItext=l({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Hint Message"),widget:d((function(e,t){return ke(e,r().extend(t,{itextType:"hint",messagesPath:"hintItext",getItextByMug:function(e){return e.p.hintItext},displayName:gettext("Hint Message")}))})),validationFunc:s("hintItext",gettext("Hint Message"))}),i.hintItextID={visibility:"hintItext",lstring:gettext("Hint Itext ID"),widget:Ae.id,widgetValuePath:"hintItext"},i.helpItext=l({visibility:"visible",presence:function(e){return e.options.isSpecialGroup?"notallowed":"optional"},lstring:gettext("Help Message"),widget:d((function(e,t){var n=ke(e,r().extend(t,{itextType:"help",messagesPath:"helpItext",getItextByMug:function(e){return e.p.helpItext},displayName:gettext("Help Message")}));return n})),validationFunc:s("helpItext",gettext("Help Message"))}),i.helpItextID={visibility:"helpItext",lstring:gettext("Help Itext ID"),widget:Ae.id,widgetValuePath:"helpItext"},i.addEmptyCaptionItext=l({visibility:"visible",presence:function(e){return e.options.isRepeat&&e.options.customRepeatButtonText?"optional":"notallowed"},lstring:gettext("Add New Item Button Text"),widget:d((function(e,t){var n=ke(e,r().extend(t,{itextType:"addEmptyCaption",messagesPath:"addEmptyCaptionItext",getItextByMug:function(e){return e.p.addEmptyCaptionItext},displayName:gettext("Add New Item Button Text")}));return n})),validationFunc:s("addEmptyCaptionItext",gettext("Add New Item Button Text"))}),i.addEmptyCaptionItextID={visibility:"addEmptyCaptionItext",lstring:gettext("Add New Itext ID"),widget:Ae.id,widgetValuePath:"addEmptyCaptionItext"},i.addCaptionItext=l({visibility:"visible",presence:function(e){return e.options.isRepeat&&e.options.customRepeatButtonText?"optional":"notallowed"},lstring:gettext("Add Another Item Button Text"),widget:d((function(e,t){var n=ke(e,r().extend(t,{itextType:"addCaption",messagesPath:"addCaptionItext",getItextByMug:function(e){return e.p.addCaptionItext},displayName:gettext("Add Another Item Button Text")}));return n})),validationFunc:s("addCaptionItext",gettext("Add Another Item Button Text"))}),i.addCaptionItextID={visibility:"addCaptionItext",lstring:gettext("Add Another Itext ID"),widget:Ae.id,widgetValuePath:"addCaptionItext"},i.otherItext=function(e){return e.isSpecialGroup?void 0:{visibility:"labelItext",presence:"optional",lstring:gettext("Add Other Content"),widget:function(e,t){return Ie(e,r().extend(t,{displayName:gettext("Add Other Content"),itextType:"label",getItextByMug:function(e){return e.p.labelItext},forms:["long","short"],isCustomAllowed:!0}))}}},i.mediaItext=function(e){return e.isSpecialGroup?void 0:{visibility:"labelItext",presence:"optional",lstring:gettext("Add Multimedia"),widget:function(e,t){return Pe(e,r().extend(t,{displayName:gettext("Add Multimedia"),itextType:"label",pathPrefix:"",getItextByMug:function(e){return e.p.labelItext},forms:ge.A.SUPPORTED_MEDIA_TYPES,formToIcon:Te}))}}},i.helpMediaIText=function(e){return e.isSpecialGroup?void 0:{visibility:"helpItext",presence:"optional",lstring:gettext("Add Help Media"),widget:function(e,t){return Pe(e,r().extend(t,{displayName:gettext("Add Help Media"),itextType:"help",getItextByMug:function(e){return e.p.helpItext},forms:ge.A.SUPPORTED_MEDIA_TYPES,formToIcon:Te}))}}},e},getMainProperties:function(){var e=this.__callOld();return e.splice(1+e.indexOf("label"),0,"labelItext"),e},getLogicProperties:function(){var e=this.__callOld();return e.splice(1+e.indexOf("constraintAttr"),0,"constraintMsgItext"),e},getMediaProperties:function(){var e=this.__callOld();return e.push("constraintMediaIText"),e},getAdvancedProperties:function(){var e=this.__callOld();return(e=e.concat(["labelItextID","constraintMsgItextID","hintItextID","hintItext","helpItextID","helpItext","addEmptyCaptionItextID","addEmptyCaptionItext","addCaptionItextID","addCaptionItext","helpMediaIText"])).concat(["otherItext"])},getToolsMenuItems:function(){var e=this;return this.__callOld().concat([{name:gettext("Edit Bulk Translations"),icon:"fa fa-language",action:function(t){e.showItextModal(t)}}])},showItextModal:function(e){var t,n,a,i=this,o=i.data.javaRosa.Itext,s=i.data.core.form;t=i.generateNewModal(gettext("Edit Bulk Translations"),[{title:gettext("Update Translations"),cssClasses:"btn-primary",action:function(){ge.A.parseXLSItext(s,a.val(),o),t.modal("hide"),e()}}]),n=r()(ee()({description:gettext("Copy these translations into a spreadsheet program like Excel. You can edit them there and then paste them back here when you're done. These will update the translations used in your form. Press 'Update Translations' to save changes, or 'Close' to cancel.")})),t.find(".modal-body").html(n),(a=n.find("textarea")).val(ge.A.generateItextXLS(s,o)),t.modal("show"),t.one("shown.bs.modal",(function(){a.focus()}))}}),n(5382),r().vellum.plugin("lock",{},{loadXML:function(e){this.data.lock.locks={},this.__callOld()},parseBindElement:function(e,t,n){this.__callOld();var a=t.xmlAttr("vellum:lock");a&&"none"!==a&&(this.data.lock.locks[n]=a)},isPropertyLocked:function(e,t){if(this.__callOld())return!0;var n=this.data.lock.locks[e];return!!n&&(("node"===n||"value"===n)&&"nodeID"===t||"value"===n&&-1===t.indexOf("Itext"))},isMugPathMoveable:function(e){return this.__callOld()&&!this.data.lock.locks[e]},isMugRemoveable:function(e,t){return this.__callOld()&&!this.data.lock.locks[t]},isMugTypeChangeable:function(e,t){return this.__callOld()&&"value"!==this.data.lock.locks[t]}}),n(5304);var Se=n(7026),Ne="http://commcarehq.org/ledger/v1",Ee=0,De=[{attr:"entryId",path:"entry/@id"},{attr:"quantity",path:"entry/@quantity"},{attr:"src",path:"@src"},{attr:"dest",path:"@dest"},{attr:"date",path:"@date"}],Re={Balance:[{attr:"entryId",path:"entry/@id"},{attr:"quantity",path:"entry/@quantity"},{attr:"entityId",path:"@entity-id"},{attr:"date",path:"@date"}],Transfer:De,Dispense:De,Receive:De},Oe=a.Ay.mapObject(Re,(function(e){return a.Ay.object(a.Ay.map(e,(function(e){return[e.path,e.attr]})))})),Le={slug:"main",displayName:gettext("Basic"),properties:["nodeID","src","dest","sectionId","entryId","quantity","date"],help:{title:gettext("Basic"),text:"<p>"+b.A.format(gettext("The {questionid} is an internal identifier for a question. It does not appear on the phone. It is the name of the question in data exports."),{questionid:"<strong>"+gettext("Question ID")+"</strong>"})+"</p>",link:"https://help.commcarehq.org/display/commcarepublic/Transactions"}},qe={slug:"logic",displayName:gettext("Logic"),help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"},properties:["relevantAttr"]},Fe={Balance:[a.Ay.extend({},Le,{properties:["nodeID","entityId","sectionId","entryId","quantity"]}),qe],Transfer:[Le,qe],Dispense:[Le,qe],Receive:[Le,qe]},Ve=b.A.extend(y.A.defaultOptions,{isDataOnly:!0,isTypeChangeable:!1,supportsDataNodeRole:!0,parseDataNode:function(e,t){return e.p.nodeID=e.p.rawDataAttributes.type||"tx-"+Ee++,delete e.p.rawDataAttributes.type,e.p.sectionId=e.p.rawDataAttributes["section-id"],delete e.p.rawDataAttributes["section-id"],r()([])},getPathName:function(e,t){return e.options.getTagName()+"[@type='"+t+"']"},dataChildFilter:function(e,t){return[new Se.A.Node(e,{getNodeID:function(){return"entry"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{id:"",quantity:""}}}})]},getBindList:function(e){var t=[{nodeset:e.hashtagPath,relevant:e.p.relevantAttr}];return a.Ay.each(Re[e.__className],(function(n){var a=e.p[n.attr];a&&t.push({nodeset:e.hashtagPath+"/"+n.path,calculate:a})})),t},isHashtaggable:!1,spec:{date:{lstring:gettext("Date"),visibility:"visible",presence:"optional",widget:x.A.xPath,xpathType:"generic",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext("The date and time of the action, e.g., now() or today()")},sectionId:{lstring:gettext("Balance ID"),visibility:"visible",presence:"optional",widget:x.A.text,help:gettext("The name of the balance you are tracking. This is an internal identifier which does not appear on the phone.")},entryId:{lstring:gettext("Product"),visibility:"visible",presence:"optional",widget:x.A.xPath,xpathType:"generic",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext('A reference to a product ID, e.g., "/data/products/current_product"')},quantity:{lstring:gettext("Quantity"),visibility:"visible",presence:"optional",widget:x.A.xPath,xpathType:"generic",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext("A reference to an integer question in this form.")},relevantAttr:{visibility:"visible",presence:"optional",widget:x.A.xPath,xpathType:"bool",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,lstring:gettext("Display Condition")}}}),je=b.A.extend(Ve,{typeName:"Balance",getTagName:function(){return"balance"},getExtraDataAttributes:function(e){var t=e.p.rawDataAttributes||{};return{xmlns:Ne,type:e.p.nodeID,"entity-id":t["entity-id"]||"","section-id":e.p.sectionId,date:t.date||""}},icon:"fcc fcc-fd-hash",init:function(e,t){e.p.entityId="",e.p.sectionId="",e.p.entryId="",e.p.quantity="",e.p.date="now()",We(e,t)},spec:{xmlnsAttr:{presence:"optional",serialize:function(){},deserialize:function(){}},nodeID:{serialize:Ge},entityId:{lstring:gettext("Case"),visibility:"visible",presence:"optional",widget:x.A.xPath,xpathType:"generic",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext("XPath expression for the case ID associated with this balance.")},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}}}),Be=function(e){var t={key:"commtrack-transfer-src-dest-error",level:e.ERROR};return e.p.dest&&e.p.src||(t.message=gettext("Transfer must have both Source Case and Destination Case defined.")),e.addMessages({src:[t],dest:[t]}),"pass"},ze=b.A.extend(Ve,{typeName:"Transfer",getTagName:function(){return"transfer"},isTypeChangeable:!0,typeChangeError:function(e,t){return"Balance"!==t&&"Balance"!==e.__className&&Qe(e)&&Qe({__className:t})?"":gettext("Cannot change $1 to $2").replace("$1",e.__className).replace("$2",t)},getExtraDataAttributes:function(e){var t=e.p.rawDataAttributes||{},n={xmlns:Ne,type:e.p.nodeID,date:t.date||"","section-id":e.p.sectionId};return e.p.src&&r().trim(e.p.src)?n.src=t.src||"":delete t.src,e.p.dest&&r().trim(e.p.dest)?n.dest=t.dest||"":delete t.dest,n},icon:"fa-solid fa-right-left",init:function(e,t){e.p.src="",e.p.dest="",e.p.sectionId="",e.p.entryId="",e.p.quantity="",e.p.date="now()",We(e,t)},spec:{nodeID:{serialize:Ge},xmlnsAttr:{presence:"optional",serialize:function(){},deserialize:function(){}},src:{lstring:gettext("Source Case"),visibility:"visible",presence:"required",widget:x.A.xPath,xpathType:"generic",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext("XPath expression for the case ID issuing the transaction."),validationFunc:Be},dest:{lstring:gettext("Destination Case"),visibility:"visible",presence:"required",widget:x.A.xPath,xpathType:"generic",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext("XPath expression for the case ID receiving the transaction."),validationFunc:Be},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}}}),Ue=b.A.extend(ze,{typeName:"Dispense",icon:"fa fa-sign-out",spec:{src:{validationFunc:function(e){return e.p.src?"pass":gettext("Dispense must have a Source Case.")}},dest:{presence:"notallowed"}}}),Xe=b.A.extend(ze,{typeName:"Receive",icon:"fa fa-sign-in",spec:{src:{presence:"notallowed"},dest:{validationFunc:function(e){return e.p.dest?"pass":gettext("Receive must have a Destination Case.")}}}}),He=a.Ay.chain(Re).map((function(e){return a.Ay.map(e,(function(e){return RegExp.escape(e.path)}))})).flatten().uniq().value(),$e=new RegExp("/("+He.join("|")+")$");function Qe(e){return e&&Re.hasOwnProperty(e.__className)}function We(e,t){t.addInstanceIfNotExists({id:"ledger",src:"jr://instance/ledgerdb"},e,"")}function Ge(e,t,n,a){var i=n.parentMug?n.absolutePathNoRoot+"/":"/";a.id=i+n.p.nodeID}r().vellum.plugin("commtrack",{},{getAdvancedQuestions:function(){return this.__callOld().concat(["Balance","Transfer","Dispense","Receive"])},getMugTypes:function(){var e=this.__callOld();return e.normal.Balance=je,e.normal.Transfer=ze,e.normal.Dispense=Ue,e.normal.Receive=Xe,e},parseDataElement:function(e,t,n,i){var o=t.nodeName;if(!i&&("transfer"===o||"balance"===o)&&r()(t).xmlAttr("xmlns")===Ne){if("transfer"===o){var s=r()(t);i=a.Ay.isUndefined(s.xmlAttr("src"))?"Receive":a.Ay.isUndefined(s.xmlAttr("dest"))?"Dispense":"Transfer"}else i="Balance";return this.__callOld(e,t,n,i)}return this.__callOld()},parseBindElement:function(e,t,n){var a=e.getMugByPath(n);if(a){if(Qe(a))return void(a.p.relevantAttr=t.xmlAttr("relevant"))}else{var i=n.replace($e,"");if(n!==i&&Qe(a=e.getMugByPath(i))){var r=n.match($e)[1],o=Oe[a.__className][r];return void(a.p[o]=t.xmlAttr("calculate"))}}this.__callOld()},parseSetValue:function(e,t,n){var a=e.getMugByPath(n);if(!a){var i=n.replace($e,"");if(n!==i&&Qe(a=e.getMugByPath(i))){var r=n.match($e)[1],o=Oe[a.__className][r];return void(a.p[o]=t.xmlAttr("value"))}}this.__callOld()},getSections:function(e){return Fe.hasOwnProperty(e.__className)?a.Ay.map(Fe[e.__className],(function(e){return a.Ay.clone(e)})):this.__callOld()}});var Ye=y.A.baseMugTypes.normal.Repeat,Ke=[{key:"ids",event:"xforms-ready",path:"",query:"join(' ', {})"},{key:"count",event:"xforms-ready",path:"",query:"count-selected({}/@ids)"},{key:"index",event:"jr-insert",path:"/item",query:"int({}/@current_index)"},{key:"id",event:"jr-insert",path:"/item",query:"selected-at({}/@ids, ../@index)"}],Je=/^ *join\(['"] ['"], *(.*)\) *$/i,Ze={supportsDataNodeRole:!0,isRepeat:!0,getPathName:function(e,t){return e.p.dataSource.idsQuery&&(t+="/item"),t},parseDataNode:function(e,t){return e.p.dataSource={idsQuery:"value for getPathName"},t.children("item").children()},dataChildFilter:function(e,t){return t.p.dataSource.idsQuery?[new Se.A.Node(e,{getNodeID:function(){return"item"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{id:"",index:"","jr:template":""}}}})]:e},controlChildFilter:function(e,t){var n=t.hashtagPath,a=t.p.repeat_count;return(e=Ye.controlChildFilter(e,t))[0].getValue().options.writeCustomXML=function(e,t){a&&(b.A.writeHashtags(e,"jr:count",String(a),t),e.writeAttributeString("jr:noAddRemove","true()")),b.A.writeHashtags(e,"nodeset",n,t)},e},getExtraDataAttributes:function(e){return e.p.dataSource.idsQuery?{ids:"",count:"",current_index:"","vellum:role":"Repeat"}:Ye.getExtraDataAttributes(e)},getBindList:function(e){var t=e.absolutePath,n=Ye.getBindList(e);return e.p.dataSource.idsQuery&&n.splice(0,0,{nodeset:t.replace(/\/item$/,"/@current_index"),calculate:"count("+t+")"}),n},init:function(e,t){Ye.init(e,t),e.p.repeat_count="",e.p.setvalues={},e.p.originalPath=null,e.p.dataSource={},e.p.dataSourceChanged=!1,e.options.customRepeatButtonText=t.vellum.opts().features.use_custom_repeat_button_text},spec:{nodeID:{deserialize:function(e,t,n,i){var r=y.A.baseSpecs.databind.nodeID.deserialize;if(e.dataSource){var o=e.id.slice(0,e.id.lastIndexOf("/"))||e.id;return r(a.Ay.extend({},e,{id:o}),t,n,i)}return r(e,t,n,i)}},repeat_count:a.Ay.extend({},Ye.spec.repeat_count,{visibility:function(e){return!e.p.dataSource.idsQuery}}),dataSource:{lstring:gettext("Data Source"),visibility:"visible_if_present",presence:"optional",widget:function(e,t){var n=q.advancedDataSourceWidget(e,t,gettext("Model Iteration ID Query")),a=n.getValue,i=n.setValue;return n.input.attr({readonly:"readonly"}),n.getValue=function(){var e=a();return{instance:r().trim(e.src)?{id:e.id,src:e.src}:null,idsQuery:e.query}},n.setValue=function(e){i({id:(e=e||{}).instance?e.instance.id:"",src:e.instance?e.instance.src:"",query:e.idsQuery||""})},n},validationFunc:function(e){e.p.dataSource.idsQuery&&e.form.updateLogicReferences(e,"dataSource",e.p.dataSource.idsQuery)},serialize:function(e,t,n,a){if(e&&e.idsQuery)return{idsQuery:y.A.serializeXPath(e.idsQuery,t,n,a)}},deserialize:function(e,t,n,a){var i=e[t]||{};if(y.A.updateInstances(e,n),i&&i.instance&&i.instance.id&&i.instance.src){var r={};r[i.instance.id]=i.instance.src,n.form.updateKnownInstances(r)}var o={},s={form:n.form,p:o};return o.idsQuery=y.A.deserializeXPath(i,"idsQuery",s,a),o}}},ignoreReferenceWarning:function(e){return et(e)},getSetValues:function(e){var t=e.absolutePath,n=e.p.dataSource.idsQuery,i=[];if(n){t=t.replace(/\/item$/,""),e.p.repeat_count=t+"/@count";var r=e.parentMug&&e.parentMug.isInRepeat(),o=e.p.setvalues;a.Ay.each(Ke,(function(e){var a=r?"jr-insert":e.event,s=o[e.key];s||(s={}),s.ref=t+e.path+"/@"+e.key,s.value=e.query.replace("{}","ids"===e.key?n:t),s.event||(s.event=a),i.push({event:a,ref:s.ref,value:s.value})}))}return i}};function et(e){return e&&"Repeat"===e.__className&&e.p.dataSource.idsQuery}r().vellum.plugin("modeliteration",{},{getMugTypes:function(){var e=this.__callOld();return e.normal.Repeat=b.A.extend(Ye,Ze),e},updateControlNodeAdaptorMap:function(e){this.__callOld();var t=e.group;e.group=function(e,n,a,i){var r=t(e,n,a,i);if(r.repeat){var o,l=r.repeat,d=r.path;/\/item$/.test(d)&&(o=a.getMugByPath(d.substring(0,d.length-5)))&&"Repeat"===o.__className&&((r=function(e,t){return o.p.nodeset=d,o.p.repeat_count=l.popAttr("jr:count")||null,o.p.rawRepeatAttributes=s.A.getAttributes(l),o}).type="Repeat",r.path=d,r.repeat=l,r.ignoreDataNode=!0)}return r}},parseBindElement:function(e,t,n){var a=e.getMugByPath(n);if(!a){var i=n.replace(/\/@current_index$/,"/item");if(n!==i&&et(a=e.getMugByPath(i)))return}this.__callOld()},handleMugParseFinish:function(e){if(this.__callOld(),"Repeat"===e.__className){var t=e.absolutePath,n=null;if(e.p.dataSource.idsQuery&&(n=t.replace(/\/item$/,"")),e.p.originalPath=t,e.p.dataSource={},e.p.dataSourceChanged=!1,e.p.setvalues={},null!==n){var i=e.parentMug&&e.parentMug.isInRepeat(),r=a.Ay.object(a.Ay.map(e.form.getSetValues(),(function(e){return[e.event+" "+e.ref,e]})));a.Ay.each(Ke,(function(t){var a=i?"jr-insert":t.event,o=r[a+" "+n+t.path+"/@"+t.key];if(o&&(e.p.setvalues[t.key]=o,"ids"===t.key)){var s=(o=o.value)&&o.match(Je);e.p.dataSource.idsQuery=s?s[1]:o}})),e.p.dataSource.idsQuery?e.p.dataSource.instance=e.form.parseInstance(e.p.dataSource.idsQuery,e,"dataSource"):e.p.dataSource.idsQuery="''",e.p.rawDataAttributes=a.Ay.omit(e.p.rawDataAttributes,["ids","count","current_index"]),function(e){if(e.p.setvalues){var t=a.Ay.groupBy(e.p.setvalues,"_id");e.form.dropSetValues((function(e){return t.hasOwnProperty(e._id)}))}}(e)}}},loadXML:function(){this.__callOld(),this.data.core.form.on("mug-property-change",(function(e){var t=e.mug;"Repeat"===t.__className&&"dataSource"===e.property&&(t.p.dataSourceChanged=!0,function(e,t,n){if(n&&n.instance&&n.instance.src&&e.form.dropInstanceReference(n.instance.src,e,"dataSource.instance"),t&&t.instance&&t.instance.src){var a=e.form.addInstanceIfNotExists(t.instance,e,"dataSource.instance");a!==t.instance.id&&(t.instance.id=a,t.idsQuery=e.form.updateInstanceQuery(t.idsQuery,a))}if(Boolean(t&&t.idsQuery)!==Boolean(n&&n.idsQuery)){var i,r=e.p.nodeID,o=e.hashtagPath,s=e.parentMug;t&&t.idsQuery?i=o.replace(/\/item$/,""):(i=o+"/item",/\/@count$/.test(e.p.repeat_count)&&(e.p.repeat_count="")),e.form.vellum.handleMugRename(e.form,e,r,r,o,i,s)}}(t,e.val,e.previous))}))}});var tt=n(1),nt=n.n(tt),at=n(4206),it=n.n(at),rt=n(7501),ot=n.n(rt),st=n(3835),lt=n.n(st);function dt(e){return!!e&&e.p.useCreate}function ut(e){return!!e&&e.p.useClose}function ct(e){return!!e&&e.p.useUpdate}function pt(e){return!!e&&e.p.useIndex}function ft(e){return!!e&&e.p.useAttachment}var ht=function(e,t){var n=x.A.normal(e,t),i=t.id,o=t.template;return t.richText=!1,n.input=r()('<div class="control-row" />').attr("name",i),n.getControl=function(){return n.input},n.refreshControl=function(t){t=t||n.getValue(),n.input.html(lt()({internal_template:o,props:t})),n.input.find("input").on("change keyup",(function(){n.handleChange()})),n.input.find(".fd-add-property").click(n.addProperty),n.input.find(".fd-remove-property").click(n.removeProperty),n.input.find("input").addClass("jstree-drop"),n.input.find("input").each((function(){z.A.autocomplete(r()(this),e)}))},n.setValue=function(e){e=a.Ay.isUndefined(e)?{}:e,n.refreshControl(e)},n.updateValue=function(){""in n.getValue()||(n.input.find(".btn").removeClass("hide"),n.input.find(".fd-remove-property").removeClass("hide")),n.save()},n.removeProperty=function(e){r()(this).parent().parent().parent().remove(),n.refreshControl(),n.save(),e.preventDefault()},n.addProperty=function(e){n.refreshControl(),e.preventDefault()},n},gt=function(e,t){t.template=nt();var n=ht(e,t);return n.getValue=function(){var e={};return a.Ay.each(n.input.find(".fd-update-property"),(function(t){var n=r()(t);e[n.find(".fd-update-property-name").val()]={calculate:n.find(".fd-update-property-source").val(),relevant:n.find(".fd-update-property-relevant").val()}})),e},n},mt=/^[a-z0-9_-]+$/i,vt={typeName:"Save to Case",isTypeChangeable:!1,isDataOnly:!0,supportsDataNodeRole:!0,icon:"fa fa-save",init:function(e,t){e.p.date_modified=e.p.date_modified||"/data/meta/timeEnd",e.p.user_id=e.p.user_id||"instance('commcaresession')/session/context/userid"},spec:{xmlnsAttr:{presence:"optional"},date_modified:{lstring:gettext("Date Modified"),visibility:"visible",presence:"required",widget:x.A.xPath,serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath},user_id:{lstring:gettext("User ID"),visibility:"visible",presence:"optional",widget:x.A.xPath,serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath},case_type:{lstring:gettext("Case Type"),visibility:"visible",presence:"optional",widget:x.A.text},case_id:{lstring:gettext("Case ID"),visibility:"visible",presence:"required",widget:x.A.xPath,serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath},useCreate:{lstring:gettext("Create Case"),visibility:"visible",presence:"optional",widget:x.A.checkbox},createProperty:{lstring:gettext("Properties To Create"),visibility:"visible",presence:"optional",widget:gt,validationFunc:function(e){if(e.p.useCreate){var t=a.Ay.without(a.Ay.keys(e.p.createProperty),""),n=["case_type","case_name"],i=a.Ay.union(n,["owner_id"]),r=a.Ay.difference(t,i),o=a.Ay.intersection(t,n),s=a.Ay.filter(t,(function(e){return!mt.test(e)}));if(o.length!==n.length)return b.A.format(gettext("You must include {columns} columns to create a case"),{columns:n.join(", ")});if(r.length>0)return gettext("You can only use the following properties:")+" "+i.join(", ");if(s.length>0)return b.A.format(gettext("{props} are invalid properties"),{props:s.join(", ")})}return"pass"}},useClose:{lstring:gettext("Close Case"),visibility:"visible",presence:"optional",widget:x.A.checkbox},closeCondition:{lstring:gettext("Close Condition"),visibility:"visible",presence:"optional",widget:x.A.xPath,serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath},useUpdate:{lstring:gettext("Update Case"),visibility:"visible",presence:"optional",widget:x.A.checkbox},updateProperty:{lstring:gettext("Properties To Update"),visibility:"visible",presence:"optional",widget:gt,validationFunc:function(e){if(e.p.useUpdate){var t=a.Ay.without(a.Ay.keys(e.p.updateProperty),""),n=a.Ay.filter(t,(function(e){return!mt.test(e)}));if(n.length>0)return b.A.format(gettext("{props} are invalid properties"),{props:n.join(", ")})}return"pass"}},useIndex:{lstring:gettext("Use Index"),visibility:"visible",presence:"optional",widget:x.A.checkbox},indexProperty:{lstring:gettext("Index Properties"),visibility:"visible",presence:"optional",widget:function(e,t){t.template=it();var n=ht(e,t);return n.getValue=function(){var e={};return a.Ay.each(n.input.find(".fd-index-property"),(function(t){var n=r()(t);e[n.find(".fd-index-property-name").val()]={calculate:n.find(".fd-index-property-source").val(),case_type:n.find(".fd-index-property-case-type").val(),relationship:n.find(".fd-index-property-relationship").val()}})),e},n},validationFunc:function(e){if(e.p.useIndex){var t=a.Ay.without(a.Ay.keys(e.p.indexProperty),""),n=a.Ay.filter(t,(function(e){return!mt.test(e)})),i=a.Ay.without(a.Ay.map(e.p.indexProperty,(function(e,t){return e.relationship})),""),r=a.Ay.filter(i,(function(e){return!a.Ay.contains(["child","extension"],e)}));if(n.length>0)return b.A.format(gettext("{props} are invalid properties"),{props:n.join(", ")});if(r.length>0)return gettext("Relationship must be child or extension")}return"pass"}},useAttachment:{lstring:gettext("Use Attachments"),visibility:"visible",presence:"optional",widget:x.A.checkbox},attachmentProperty:{lstring:gettext("Attachment Properties"),visibility:"visible",presence:"optional",widget:function(e,t){t.template=ot();var n=ht(e,t);return n.getValue=function(){var e={};return a.Ay.each(n.input.find(".fd-attachment-property"),(function(t){var n=r()(t);e[n.find(".fd-attachment-property-name").val()]={calculate:n.find(".fd-attachment-property-source").val(),from:n.find(".fd-attachment-property-from").val(),name:n.find(".fd-attachment-name").val()}})),e},n},validationFunc:function(e){if(!e.p.useAttachment)return"pass";var t=a.Ay.without(a.Ay.keys(e.p.attachmentProperty),""),n=a.Ay.filter(t,(function(e){return!mt.test(e)})),i=a.Ay.filter(t,(function(t){return!a.Ay.contains(["local","remote","inline"],e.p.attachmentProperty[t].from)})),r=a.Ay.filter(t,(function(t){var n=e.p.attachmentProperty[t],a=n.from,i=n.name;return"inline"===a&&!i}));return n.length>0?b.A.format(gettext("{props} are invalid properties"),{props:n.join(", ")}):i.length>0?gettext("The from attribute must be one of: local, remote, or inline"):r.length>0?gettext("Inlined attachments must have an attachment name"):"pass"}}},getExtraDataAttributes:function(e){return{"vellum:role":"SaveToCase","vellum:case_type":e.p.case_type||""}},dataChildFilter:function(e,t){function n(e,t,n){return t=t||[],new Se.A.Node(t,{getNodeID:function(){return e},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return n}}})}function i(e,t){return a.Ay.chain(e).map((function(e,i){if(i)return n(i,[],a.Ay.pick(e,t))})).compact().value()}var r=[];return dt(t)&&r.push(n("create",i(t.p.createProperty))),ct(t)&&r.push(n("update",i(t.p.updateProperty))),ut(t)&&r.push(n("close")),pt(t)&&r.push(n("index",i(t.p.indexProperty,["case_type","relationship"]))),ft(t)&&r.push(n("attachment",i(t.p.attachmentProperty,["from","name"]))),[new Se.A.Node(r,{getNodeID:function(){return"case"},p:{rawDataAttributes:null},options:{getExtraDataAttributes:function(e){return{xmlns:"http://commcarehq.org/case/transaction/v2",case_id:"",date_modified:"",user_id:""}}}})]},getBindList:function(e){var t=[];function n(t,n){return a.Ay.chain(n).omit("").map((function(n,a){return{nodeset:e.absolutePath+"/case/"+t+"/"+a,calculate:n.calculate,relevant:n.relevant}})).value()}return dt(e)&&(e.isInRepeat()&&(t=t.concat({nodeset:e.absolutePath+"/case/@case_id",calculate:e.p.case_id})),t=t.concat(n("create",e.p.createProperty))),ct(e)&&(t=t.concat(n("update",e.p.updateProperty))),ut(e)&&t.push({nodeset:e.absolutePath+"/case/close",relevant:e.p.closeCondition}),pt(e)&&(t=t.concat(n("index",e.p.indexProperty))),ft(e)&&(t=t.concat(a.Ay.chain(e.p.attachmentProperty).omit("").map((function(t,n){return{nodeset:e.absolutePath+"/case/attachment/"+n+"/@src",calculate:t.calculate}})).value())),function(e){return dt(e)||ut(e)||ct(e)||pt(e)||ft(e)}(e)&&(t.push({nodeset:e.absolutePath+"/case/@date_modified",calculate:e.p.date_modified,type:"xsd:dateTime"}),t.push({nodeset:e.absolutePath+"/case/@user_id",calculate:e.p.user_id}),dt(e)||t.push({nodeset:e.absolutePath+"/case/@case_id",calculate:e.p.case_id})),t},parseDataNode:function(e,t){var n=t.xmlAttr("vellum:case_type"),i=t.children(),o=i.find("create"),s=i.find("close"),l=i.find("update"),d=i.find("index"),u=i.find("attachment");return n&&(e.p.case_type=n),o&&0!==o.length&&(e.p.useCreate=!0),l&&0!==l.length&&(e.p.useUpdate=!0),s&&0!==s.length&&(e.p.useClose=!0),d&&0!==d.length&&(e.p.useIndex=!0,e.p.indexProperty={},a.Ay.each(d.children(),(function(t){var n=r()(t);e.p.indexProperty[n.prop("tagName")]={case_type:n.xmlAttr("case_type"),relationship:n.xmlAttr("relationship")}}))),u&&0!==u.length&&(e.p.useAttachment=!0,e.p.attachmentProperty||(e.p.attachmentProperty={}),a.Ay.each(u.children(),(function(t){var n=r()(t);e.p.attachmentProperty[n.prop("tagName")]={from:n.xmlAttr("from"),name:n.xmlAttr("name")}}))),r()([])},getSetValues:function(e){return dt(e)&&!e.isInRepeat()?[{event:"xforms-ready",ref:e.absolutePath+"/case/@case_id",value:e.p.case_id}]:[]},getCaseSaveData:function(e){var t=a.Ay.union(a.Ay.keys(e.p.createProperty||{}),a.Ay.keys(e.p.updateProperty||{}));return{case_type:e.p.case_type||"",properties:a.Ay.filter(t,a.Ay.identity),create:e.p.useCreate||!1,close:e.p.useClose||!1}}},yt={SaveToCase:[{slug:"main",displayName:gettext("Basic"),properties:["nodeID","date_modified","user_id","case_type","case_id"]},{slug:"create",displayName:gettext("Create"),properties:["useCreate","createProperty"],isCollapsed:function(e){return!dt(e)}},{slug:"update",displayName:gettext("Update"),properties:["useUpdate","updateProperty"],isCollapsed:function(e){return!ct(e)}},{slug:"close",displayName:gettext("Close"),properties:["useClose","closeCondition"],isCollapsed:function(e){return!ut(e)}},{slug:"index",displayName:gettext("Index"),properties:["useIndex","indexProperty"],isCollapsed:function(e){return!pt(e)}},{slug:"attachment",displayName:gettext("Attachments"),properties:["useAttachment","attachmentProperty"],isCollapsed:function(e){return!ft(e)}}]};r().vellum.plugin("saveToCase",{},{getAdvancedQuestions:function(){return this.__callOld().concat(["SaveToCase"])},handleMugParseFinish:function(e){if(this.__callOld(),dt(e)){var t=e.absolutePath+"/case/@case_id",n=a.Ay.find(e.form.getSetValues(),(function(e){return e.ref===t}));n&&(e.p.case_id=n.value,e.form.dropSetValues((function(e){return n===e})))}},getMugTypes:function(){var e=this.__callOld();return e.normal.SaveToCase=b.A.extend(y.A.defaultOptions,vt),e},getSections:function(e){return yt.hasOwnProperty(e.__className)?a.Ay.map(yt[e.__className],(function(t){var n=a.Ay.clone(t);return a.Ay.isFunction(n.isCollapsed)&&(n.isCollapsed=n.isCollapsed(e)),n})):this.__callOld()},parseBindElement:function(e,t,n){var a=e.getMugByPath(n);if(!a){var i,r=/\/case\/(?:(create|update|index)\/([\w-]+)|(close|@date_modified|@user_id|@case_id))$/,o=n.match(r);if(o&&o.length>0&&(i=n.replace(r,""),(a=e.getMugByPath(i))&&"SaveToCase"===a.__className)){if(o[2]){var s=o[2],l={create:"createProperty",update:"updateProperty",index:"indexProperty",attachment:"attachmentProperty"}[o[1]];return a.p[l]||(a.p[l]={}),a.p[l][s]||(a.p[l][s]={}),a.p[l][s].calculate=t.xmlAttr("calculate"),void(t.xmlAttr("relevant")&&(a.p[l][s].relevant=t.xmlAttr("relevant")))}var d={close:{mugProp:"closeCondition",elAttr:"relevant"},"@date_modified":{mugProp:"date_modified",elAttr:"calculate"},"@user_id":{mugProp:"user_id",elAttr:"calculate"},"@case_id":{mugProp:"case_id",elAttr:"calculate"}}[o[3]];return void(a.p[d.mugProp]=t.xmlAttr(d.elAttr))}var u=/\/case\/attachment\/(\w+)\/@src$/,c=n.match(u);if(c&&(i=n.replace(u,""),(a=e.getMugByPath(i))&&"SaveToCase"===a.__className)){var p=a.p.attachmentProperty,f=c[1];return p[f]||(p[f]={}),void(a.p.attachmentProperty[f].calculate=t.xmlAttr("calculate"))}}this.__callOld()}});var xt=n(2589),bt=n.n(xt),At=n(3184),wt=n.n(At),Mt=n(5080),_t=n.n(Mt),Ct=n(3609),It=n.n(Ct),kt=n(8793),Pt=n.n(kt),Tt=n(9606),St=n.n(Tt),Nt=n(1779),Et=n.n(Nt),Dt=n(8125),Rt=n.n(Dt),Ot=n(2618),Lt=n.n(Ot),qt=n(4533),Ft=n.n(qt),Vt={image:gettext("Image"),audio:gettext("Audio"),video:gettext("Video"),"video-inline":gettext("Inline Video"),text:gettext("HTML")},jt={image:Pt(),audio:St(),video:Et(),"video-inline":Et(),text:Rt()},Bt={image:"CommCareImage",audio:"CommCareAudio",video:"CommCareVideo","video-inline":"CommCareVideo",text:"CommCareMultimedia"},zt={image:"fd_hqimage",audio:"fd_hqaudio",video:"fd_hqvideo","video-inline":"fd_hqInlineVideo",text:"fd_hqtext"},Ut=/(\.[^\/.]+)?$/,Xt=function(e,t,n){var i,r=a.Ay.isFunction(e.getItextValue),o=a.Ay.isFunction(e.getItextItem),s=r?e.getItextValue():e.getValue();if(!o||r||s||e.isDefaultLang||(s=e.getItextItem().get(e.form,e.defaultLang)),s in t){var l=t[s];i=jt[e.form]({url:l.url})}else i=Lt()({iconClass:n[e.form]});return i},Ht=function(e,t){var n,a=e.getItextValue?e.getItextValue():e.getValue();return(n=r()(wt()({multimediaExists:a in t,uploaderId:zt[e.form],mediaType:Vt[e.form]}))).click((function(){e.mediaRef.updateController(e),e.getUploaderModal().find(".hqm-upload-status").empty(),e.updateModalExistingFile(t)})),n};r().vellum.plugin("uploader",{objectMap:!1,uploadUrls:{image:!1,audio:!1,video:!1,"video-inline":!1,text:!1}},{init:function(){var e=this.opts().uploader,t=e.uploadUrls,n=e.objectMap&&e.uploadUrls&&e.uploadUrls.image;this.data.uploader.uploadEnabled=n,this.data.uploader.objectMap=e.objectMap,n&&(this.data.uploader.uploadControllers={image:this.initUploadController({uploaderSlug:"fd_hqimage",mediaType:"image",uploadUrl:t.image}),audio:this.initUploadController({uploaderSlug:"fd_hqaudio",mediaType:"audio",uploadUrl:t.audio}),video:this.initUploadController({uploaderSlug:"fd_hqvideo",mediaType:"video",uploadUrl:t.video}),"video-inline":this.initUploadController({uploaderSlug:"fd_hqInlineVideo",mediaType:"video-inline",uploadUrl:t.video}),text:this.initUploadController({uploaderSlug:"fd_hqtext",mediaType:"text",uploadUrl:t.text})})},initMediaUploaderWidget:function(e){this.__callOld(),this.data.uploader.uploadEnabled&&function(e,t,n){if(e.mediaRef=function(e,t,n){var i={};return i.mediaType=e,i.updateRef=function(e){i.path=e,i.linkedObj=t[e]},i.isMediaMatched=function(){return a.Ay.isObject(i.linkedObj)},i.getUrl=function(){return i.linkedObj?i.linkedObj.url:void 0},i.updateController=function(e){var t=n[i.mediaType];t.currentReference=i,t.updateMediaPath=function(){var n=t.uploadParams;n.path=e.getRandomizedMediaPath(n.path),e.updateReference(n.path)},t.uploadParams={path:i.path,media_type:Bt[i.mediaType],old_ref:i.isMediaMatched()?i.linkedObj.m_id:"",replace_attachment:!0}},i}(e.form,t,n),!e.getBaseMediaPath)throw new Error("required method not found: widget.getBaseMediaPath()");e.getRandomizedMediaPath=function(t){var n=Ut.exec(t)[0].toLowerCase()||".xyz",a=Math.random().toString(36).slice(2,8);return e.getBaseMediaPath()+"-"+a+n};var i=e.getItextValue||e.getValue,o=e.getControl(),s=r()("<div />"),l=e.getUIElement,d=r()("<div />").addClass("fd-mm-preview-container"),u=e.mug.form.vellum.data.javaRosa.ICONS;e.getUploaderModal=function(){return r()("#"+zt[e.form])},e.updateModalExistingFile=function(t,n){var a=e.mug.form.vellum.data.javaRosa.ICONS,i=e.getUploaderModal(),o=i.find(".hqm-existing");e.mediaRef.getUrl()&&e.mediaRef.isMediaMatched()?(o.removeClass("hide"),o.find(".hqm-existing-controls").html(Xt(e,t,a)),n&&i.find(".hqm-upload-completed").removeClass("hide")):(o.addClass("hide"),o.find(".hqm-existing-controls").empty()),r()(".existing-media").tooltip({placement:"bottom"})},e.getUIElement=function(){var n=(s=l()).find(".controls"),a=r()("<div />").addClass("fd-mm-upload-container");return n.empty().addClass("control-row").data("form",e.form),e.updateReference(),d.html(Xt(e,t,u)),n.append(d),a.html(Ft()()),a.find(".fd-mm-upload-trigger").append(Ht(e,t)),a.find(".fd-mm-path-input").append(o),a.find(".fd-mm-path-show").click((function(e){r()(this).addClass("hide"),a.find(".fd-mm-path").removeClass("hide"),e.preventDefault()})),a.find(".fd-mm-path-hide").click((function(e){r()(this).parent().addClass("hide"),a.find(".fd-mm-path-show").removeClass("hide"),e.preventDefault()})),o.on("change keyup",(function(){e.updateMultimediaBlockUI(t)})),s.on("mediaUploadComplete",(function(n,a){e.handleUploadComplete(n,a,t)})),n.append(a),o.on("change keyup",e.updateValue),s},e.handleUploadComplete=function(t,n,a){n.ref&&n.ref.path&&(i()!==n.ref.path&&(e.getControl().val(n.ref.path),e.handleChange()),a[n.ref.path]=n.ref),e.updateMultimediaBlockUI(a),e.updateModalExistingFile(a,!0)},e.updateMultimediaBlockUI=function(t){d.html(Xt(e,t,u)).find(".existing-media").tooltip(),s.find(".fd-mm-upload-trigger").empty().append(Ht(e,t)),e.updateReference()},e.updateReference=function(t){var n=t||i();s.attr("data-hqmediapath",n),e.mediaRef.updateRef(n)}}(e,this.data.uploader.objectMap,this.data.uploader.uploadControllers)},initUploadController:function(e){var t=r()(bt()({mediaType:e.mediaType,modalId:e.uploaderSlug}));this.$f.find(".fd-multimedia-modal-container").append(t);var n=!0;t.on("hide.bs.modal",(function(e){n||e.preventDefault()}));var i=t.find(".btn-primary"),o=t.find("input[type='file']"),s=t.find(".hqm-upload-confirm"),l=function(e,t){e?s.removeClass("disabled"):s.addClass("disabled"),t?(s.find(".fa-spin").removeClass("hide"),s.find(".fa-cloud-arrow-up").addClass("hide")):(s.find(".fa-spin").addClass("hide"),s.find(".fa-cloud-arrow-up").removeClass("hide"))};i.click((function(){o.click()})),o.change((function(){var e=t.find(".hqm-upload-status");if(o.get(0).files.length){var n=o.get(0).files[0];e.html(_t()({file_size:(n.size/1048576).toFixed(3),file_name:n.name})),l(!0,!1)}else e.empty(),l(!1,!1)}));var d={};return s.click((function(){l(!1,!0),n=!1;var i=o.get(0).files[0],s=new FormData;s.append("Filedata",i),d.updateMediaPath();var u="."+i.name.split(".").pop().toLowerCase();d.uploadParams.path=d.uploadParams.path.replace(/(\.[^/.]+)?$/,u),a.Ay.each(d.uploadParams,(function(e,t){s.append(t,e)}));var c=t.find(".hqm-upload-status");r().ajax({url:e.uploadUrl,type:"POST",data:s,contentType:!1,processData:!1,enctype:"multipart/form-data",success:function(e){e=JSON.parse(e),r()('[data-hqmediapath^="'+e.ref.path.replace(/\.\w+$/,".")+'"]').trigger("mediaUploadComplete",e),c.empty(),l(!1,!1),n=!0},error:function(e){e=JSON.parse(e.responseText),c.find(".hqm-error").show(),c.find(".hqm-errors").html(It()({errors:e.errors})),c.find(".hqm-begin").hide(),l(!1,!1),n=!0}})})),d}}),n(8922),n(1437),n(3586);let $t="http://commcareconnect.com/data/v1/learn",Qt={slug:"main",displayName:gettext("Basic"),properties:["nodeID"]},Wt={slug:"logic",displayName:gettext("Logic"),help:{title:gettext("Logic"),text:gettext("Use logic to control when questions are asked and what answers are valid. You can add logic to display a question based on a previous answer, to make the question required or ensure the answer is in a valid range."),link:"https://confluence.dimagi.com/display/commcarepublic/Common+Logic+and+Calculations"},properties:["relevantAttr"]},Gt={xmlnsAttr:{presence:"optional",serialize:()=>{},deserialize:()=>{}},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{presence:"notallowed"}},Yt={isTypeChangeable:!1,isDataOnly:!0,supportsDataNodeRole:!0,getExtraDataAttributes:e=>({"vellum:role":e.__className}),getBindList:e=>{let t=Kt[e.__className];return[{nodeset:e.hashtagPath,relevant:e.p.relevantAttr}].concat(t.childNodes.filter((e=>!e.writeToData)).map((n=>({nodeset:`${e.absolutePath}/${t.rootName}/${n.id}`,calculate:e.p[n.id]}))))},parseDataNode:(e,t)=>{let n=t.children(),a=Kt[e.__className];if(1===n.length){let t=n[0];t.nodeName===a.rootName&&t.getAttribute("xmlns")===$t&&r()(t).children().each(((t,n)=>{let i=a.childNodes.find((e=>e.id===n.nodeName));i&&i.writeToData&&(e.p[n.nodeName]=r()(n).text())}))}return r()([])},dataChildFilter:(e,t)=>(e=Kt[t.__className].childNodes.map((e=>{let n={rawDataAttributes:null};return e.writeToData&&(n.dataValue=t.p[e.id]),new Se.A.Node([],{getNodeID:()=>e.id,p:n,options:{getExtraDataAttributes:()=>{}}})})),[new Se.A.Node(e,{getNodeID:()=>Kt[t.__className].rootName,p:{rawDataAttributes:null},options:{getExtraDataAttributes:()=>({xmlns:$t,id:t.p.nodeID})}})])},Kt={ConnectLearnModule:{rootName:"module",childNodes:[{id:"name",writeToData:!0},{id:"description",writeToData:!0},{id:"time_estimate",writeToData:!0}],mugOptions:b.A.extend(Yt,{typeName:"Learn Module",icon:"fa fa-graduation-cap",init:e=>{e.p.name="",e.p.description="",e.p.time_estimate=""},spec:b.A.extend(Gt,{nodeID:{lstring:gettext("Module ID")},name:{lstring:gettext("Name"),visibility:"visible",presence:"required",widget:x.A.text},description:{lstring:gettext("Description"),visibility:"visible",presence:"required",widget:x.A.richTextarea},time_estimate:{lstring:gettext("Time Estimate"),visibility:"visible",presence:"required",widget:x.A.text,validationFunc:e=>{let t=e.p.time_estimate;return t&&t.match(/^\d+$/)?"pass":gettext("Must be an integer")},help:gettext("Estimated time to complete the module in hours.")},relevantAttr:{visibility:"visible",presence:"optional",widget:x.A.xPath,xpathType:"bool",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[a.Ay.extend({},Qt,{properties:["nodeID","name","description","time_estimate"]}),a.Ay.clone(Wt)]},ConnectAssessment:{rootName:"assessment",childNodes:[{id:"user_score"}],mugOptions:b.A.extend(Yt,{typeName:"Assessment Score",icon:"fa-brands fa-leanpub",init:e=>{e.p.user_score=""},spec:b.A.extend(Gt,{nodeID:{lstring:gettext("Assessment ID")},user_score:{lstring:gettext("User Score"),visibility:"visible",presence:"required",widget:x.A.xPath,serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext("XPath expression for the users assessment score.")},relevantAttr:{visibility:"visible",presence:"optional",widget:x.A.xPath,xpathType:"bool",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[a.Ay.extend({},Qt,{properties:["nodeID","user_score"]}),a.Ay.clone(Wt)]},ConnectDeliverUnit:{rootName:"deliver",childNodes:[{id:"name",writeToData:!0},{id:"entity_id"},{id:"entity_name"}],mugOptions:b.A.extend(Yt,{typeName:"Deliver Unit",icon:"fa fa-briefcase",init:e=>{e.p.name="",e.p.entity_id="",e.p.entity_name=""},spec:b.A.extend(Gt,{nodeID:{lstring:gettext("Delivery Unit ID")},name:{lstring:gettext("Name"),visibility:"visible",presence:"required",widget:x.A.text},entity_id:{lstring:gettext("Entity ID"),visibility:"visible",presence:"optional",widget:x.A.xPath,serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext("XPath expression for the entity ID associated with this Delivery Unit e.g. the case ID.")},entity_name:{lstring:gettext("Entity Name"),visibility:"visible",presence:"optional",widget:x.A.xPath,serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,help:gettext("XPath expression for the name of the entity associated with this Delivery Unit.")},relevantAttr:{visibility:"visible",presence:"optional",widget:x.A.xPath,xpathType:"bool",serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,lstring:gettext("Display Condition")}})}),sections:[a.Ay.extend({},Qt,{properties:["nodeID","name","entity_id","entity_name"]}),a.Ay.clone(Wt)]}};r().vellum.plugin("commcareConnect",{},{getAdvancedQuestions:function(){return this.__callOld().concat(Object.keys(Kt))},getMugTypes:function(){let e=this.__callOld();return Object.entries(Kt).forEach((([t,n])=>{e.normal[t]=b.A.extend(y.A.defaultOptions,n.mugOptions)})),e},getSections:function(e){return Object.hasOwn(Kt,e.__className)?a.Ay.map(Kt[e.__className].sections,(e=>a.Ay.clone(e))):this.__callOld()},parseBindElement:function(e,t,n){let a=e.getMugByPath(n);if(a){if(Object.hasOwn(Kt,a.__className))return void(a.p.relevantAttr=t.xmlAttr("relevant"))}else if(Object.entries(Kt).some((([i,r])=>{let o=r.childNodes.map((e=>e.id)).join("|"),s=new RegExp(`/${r.rootName}/(${o})`),l=n.match(s);if(l&&l.length>0){let r=l[1];if(a=e.getMugByPath(n.replace(s,"")),a&&a.__className===i)return a.p[r]=t.xmlAttr("calculate"),!0}})))return;this.__callOld()}});const Jt=function(e,t){const n={},a={},i={};new Set([...Object.keys(e),...Object.keys(t)]).forEach((r=>{r in e?r in t&&t[r].forEach((t=>{const a=e[r].find((e=>t.question_path===e.question_path));a?a.update_mode!==t.update_mode&&(i[r]=i[r]||[],i[r].push(t)):(n[r]=n[r]||[],n[r].push(t))})):t[r].forEach((e=>{n[r]=n[r]||[],n[r].push(e)})),r in t?r in e&&e[r].forEach((e=>{t[r].find((t=>t.question_path===e.question_path))||(a[r]=a[r]||[],a[r].push(e))})):e[r].forEach((e=>{a[r]=a[r]||[],a[r].push(e)}))}));let r={};return Object.keys(n).length&&(r.add=n),Object.keys(a).length&&(r.delete=a),Object.keys(i).length&&(r.update=i),r};function Zt(e,t){const n=t.vellum.caseManager.getProperties().map((e=>({text:e,value:e})));t.defaultOptions=n,t.useValueAsCustomName=!0;const a=x.A.dropdown(e,t);a.postRender=function(){a.input.select2({tags:!0,allowClear:!0,placeholder:""}),a.input.on("remove",(function(){a.input.data("select2")&&a.input.select2("destroy")}))};const i=a.updateValue;return a.updateValue=function(){const e=a.getValue(),t=/\s/g;e&&-1!==e.search(t)&&a.setValue(e.replace(t,"_")),i()},a}const en="mug-caseProperty-conflict";function tn(e,t){const n={key:en,message:b.A.format(gettext('"{caseProperty}" is assigned by another question. You can still save the form, but will need to have only one question for any case property in order to build the application'),{caseProperty:t}),level:e.WARNING};e.addMessage("caseProperty",n)}class nn{updateMappingsFromXML(e,t,n,a){if(a||(t.caseMappings={},t.caseMappingsByQuestion={}),!n)return;const i=n.find(":root > vellum\\:case_mappings");if(i.length>0){const e=i.children().toArray();t.caseMappings=this.buildMappingsFromXMLElements(e),t.caseMappingsByQuestion=this.buildQuestionMappingsFromCaseMappings(t.caseMappings)}new rn(e,t).pruneInvalidMappings()}buildMappingsFromXMLElements(e){const t={};return e.forEach((e=>{const n=e.attributes.property.value,a=[];r()(e).children().each(((e,t)=>{a.push(this.buildQuestionFromXMLElement(t))})),t[n]=a})),t}buildQuestionFromXMLElement(e){const t={};for(let n=0;n<e.attributes.length;n++){const a=e.attributes.item(n);t[a.name]=a.value}return t}buildQuestionMappingsFromCaseMappings(e){const t={};return Object.entries(e).forEach((([e,n])=>{n.forEach((n=>{const a=n.question_path;t[a]=t[a]||[],t[a].push(e)}))})),t}}class an{constructor(e){this.writer=e}writeCaseMappingsElement(e){e.hasOwnProperty("caseMappings")&&(this.writer.writeStartElement("vellum:case_mappings"),Object.entries(e.caseMappings).forEach((([e,t])=>{this.writeMappingElement(e,t)})),this.writer.writeEndElement())}writeMappingElement(e,t){this.writer.writeStartElement("mapping"),this.writer.writeAttributeString("property",e),t.forEach((e=>this.writeQuestionElement(e))),this.writer.writeEndElement()}writeQuestionElement(e){this.writer.writeStartElement("question"),Object.entries(e).forEach((([e,t])=>{this.writer.writeAttributeString(e,t)})),this.writer.writeEndElement()}}class rn{constructor(e,t){this.form=e,this.data=t}updateFormMappings(e,t,n){this.replaceFormQuestionMappings(e,t,n),this.replaceFormPropertyMappings(e,t,n)}replaceFormQuestionMappings(e,t,n){this.data.caseMappingsByQuestion[e]=this.data.caseMappingsByQuestion[e]||[];const a=this.data.caseMappingsByQuestion[e];let i=0;t&&(i=a.findIndex((e=>e===t)),a.splice(i,1)),n?a.splice(i,0,n):0===a.length&&delete this.data.caseMappingsByQuestion[e]}replaceFormPropertyMappings(e,t,n){let a=t?this.data.caseMappings[t]:[],i=null,r=a.findIndex((t=>t.question_path===e));-1!==r&&(i=a[r],a.splice(r,1),0===a.length?delete this.data.caseMappings[t]:1===a.length&&this.form.getMugByPath(a[0].question_path).dropMessage("caseProperty",en),this.form.getMugByPath(i.question_path).dropMessage("caseProperty",en)),n&&(this.data.caseMappings[n]=this.data.caseMappings[n]||[],i||(i={question_path:e}),this.data.caseMappings[n].push(i),this.data.caseMappings[n].length>=2&&this.data.caseMappings[n].forEach((e=>{tn(this.form.getMugByPath(e.question_path),n)})))}moveMappings(e,t){if(!this.data.hasOwnProperty("caseMappingsByQuestion"))return;const n=this.data.caseMappingsByQuestion[e]||[];0!==n.length&&(delete this.data.caseMappingsByQuestion[e],t&&(this.data.caseMappingsByQuestion[t]=n),n.forEach((n=>{const a=this.data.caseMappings[n],i=a.findIndex((t=>t.question_path===e));-1!==i&&(t?a[i].question_path=t:(a.splice(i,1),0===a.length?delete this.data.caseMappings[n]:1===a.length&&this.form.getMugByPath(a[0].question_path).dropMessage("caseProperty",en)))})))}removeMappings(e){this.moveMappings(e,null)}pruneInvalidMappings(){Object.keys(this.data.caseMappingsByQuestion).forEach((e=>{this.form.getMugByPath(e)||this.removeMappings(e)}))}}class on{constructor(e,t){this.baseProperties=new Set(e),this.customProperties={},this.viewFormUrl=t}addProperty(e){this.baseProperties.has(e)||(this.customProperties[e]=this.customProperties[e]||0,this.customProperties[e]++)}removeProperty(e){this.customProperties.hasOwnProperty(e)&&(this.customProperties[e]--,this.customProperties[e]<=0&&delete this.customProperties[e])}getProperties(){return Array.from(this.baseProperties.values()).concat(Object.keys(this.customProperties))}}r().vellum.plugin("caseManagement",{},{init:function(){const e=this.data.caseManagement;e.properties=this.opts().caseManagement.properties,e.baseline=this.opts().caseManagement.mappings||{},e.view_form_url=this.opts().caseManagement.view_form_url,this.caseManager=new on(this.opts().caseManagement.properties,this.opts().caseManagement.view_form_url)},loadXML:function(){this.__callOld();const e=this,t=this.data.core.form;t.on("question-remove",(function(n){new rn(t,e.data.caseManagement).removeMappings(n.absolutePath)})),t.on("question-create",(function(n){const a=new rn(t,e.data.caseManagement),i=n.mug,r=i.p.caseProperty;r&&a.updateFormMappings(i.absolutePath,null,r)}))},performAdditionalParsing:function(e,t,n){this.__callOld();const a=this.data.caseManagement,i=new nn;if(a.caseMappings){const r=!(n&&n.reset);i.updateMappingsFromXML(e,a,t,r)}else a.caseMappings=JSON.parse(JSON.stringify(a.baseline)),a.caseMappingsByQuestion=i.buildQuestionMappingsFromCaseMappings(a.caseMappings)},contributeToAdditionalXML:function(e,t){this.__callOld(),new an(e).writeCaseMappingsElement(this.data.caseManagement)},getMugTypes:function(){const e=this.__callOld();return[e.normal.Trigger,e.normal.Group,e.normal.Repeat,e.normal.FieldList].forEach((e=>e.spec.caseProperty={presence:"notallowed"})),e},getSections:function(e){const t=this.__callOld(e);return t.splice(1,0,{slug:"caseManagement",displayName:gettext("Case Management"),properties:["caseProperty"],help:{title:gettext("Case Management"),text:gettext("Saving a question as a case property makes it accessible and reusable across your application. To manage all your case properties from this form, click on the Manage Case button. "),link:"https://dimagi.atlassian.net/wiki/spaces/commcarepublic/pages/2143955170/Case+Management+Overview"}}),t},getMugSpec:function(){const e=this.__callOld(),t=this,n=Object.assign(e.databind,{caseProperty:{visibility:"visible",widget:Zt,presence:"optional",enabled:function(e){const n=t.data.caseManagement;if(!e.absolutePath||!n.caseMappingsByQuestion)return!0;const a=n.caseMappingsByQuestion[e.absolutePath];return!a||a.length<=1},lstring:gettext("Case Property"),serialize:y.A.serializeXPath,deserialize:y.A.deserializeXPath,setter:function(e,n,a){new rn(e.form,t.data.caseManagement).updateFormMappings(e.absolutePath,e.p[n],a);const i=e.p[n];i&&t.caseManager.removeProperty(i),a&&t.caseManager.addProperty(a),e.p.set(n,a)},validationFunc:function(e){const n=e.p.caseProperty,a=t.opts().caseManagement.reserved_words;return n&&-1!==a.indexOf(n)?{markdown:b.A.format(gettext("**{word}** is a reserved word"),{word:n})}:"pass"}}}),a=n.nodeID.setter;return n.nodeID.setter=function(e,n,i){const r=e.absolutePath;a(e,n,i);const o=e.absolutePath;new rn(e.form,t.data.caseManagement).moveMappings(r,o)},e},handleMugParseFinish:function(e){if(this.__callOld(),!e.absolutePath)return;const t=this.data.caseManagement,n=t.caseMappingsByQuestion[e.absolutePath];n&&n.length>0&&(e.p.set("caseProperty",n[0]),n.length>1&&function(e,t){const n={key:"mug-caseProperty-multipleAssignments",message:{markdown:b.A.format(gettext("This question is used to update multiple case properties. If you wish to update these case properties, please visit the [Manage Case Page]({url})"),{url:t})},level:e.INFO};e.addMessage("caseProperty",n)}(e,t.view_form_url),n.forEach((n=>{t.caseMappings[n].length>=2&&tn(e,n)})))},handleMugRename:function(e,t,n,a,i,r){const o=this.__callOld(),s=e.getBasePath();function l(e){return e.replace(/^#form\//,s)}const d=new rn(e,this.data.caseManagement);return Object.values(o).forEach((([e,t])=>{const n=l(e),a=l(t);d.moveMappings(n,a)})),o},onFormSave:function(e){this.__callOld();const t=this.data.caseManagement;t.baseline=JSON.parse(JSON.stringify(t.caseMappings))},augmentSentData:function(e,t){const n=this.__callOld(),a=this.data.caseManagement,i=Jt(a.baseline,a.caseMappings);return n.mapping_diff=JSON.stringify(i),n}});const sn=r().cleanData;r().cleanData=function(e){for(const t of e)try{r()(t).triggerHandler("remove")}catch(e){window.console.error("Error in 'remove' handler for element:",t,e)}sn(e)}},4078:(e,t,n)=>{"use strict";n.d(t,{A:()=>Q});var a=n(561),i=n.n(a),r=n(4523),o=n(7026),s=n(705),l=n(9659);function d(e,t,n,a){var o=null;l.A.eventuality(this),a&&(o=r.Ay.object(r.Ay.map(a,(function(e,t){return e&&"object"==typeof e&&(e=i().isPlainObject(e)?r.Ay.clone(e):e.clone()),[t,e]})))),this.ufid=l.A.get_guid(),this.form=t,this.messages=new u,this._baseSpec=n,this.setOptionsAndProperties(e,o)}function u(){this.messages={}}function c(e){this.__data={},this.__spec=e.spec,this.__mug=e.mug,this.shouldChange=function(){return function(){}}}function p(e,t,n,a){e&&/\binstance\(/.test(e)&&(a.instances=r.Ay.extend(a.instances||{},n.form.parseInstanceRefs(e)));try{e&&(e=n.form.xpath.parse(e.toString()).toHashtag())}catch(t){r.Ay.isString(e)&&!e.startsWith("#invalid/")&&(e="#invalid/xpath "+e)}return e||void 0}function f(e,t,n,a){h(e,n);var i=e[t];if(i)try{i=n.form.xpath.parse(i).toHashtag(),a.later((function(){n.p[t]=a.transformHashtags(i)}))}catch(e){r.Ay.isString(i)&&!i.startsWith("#invalid/")&&(i="#invalid/xpath "+i)}else null===i&&(i=void 0);return i}function h(e,t){e.hasOwnProperty("instances")&&!r.Ay.isEmpty(e.instances)&&t.form.updateKnownInstances(e.instances)}function g(e){e.p.conflictedNodeId=null}d.prototype={setOptionsAndProperties:function(e,t){var n=this,a=t||this.p&&this.p.getAttrs()||{},o=this.__className;this.logicReferenceAttrs=[],this.options=l.A.extend(y,e),this.__className=this.options.__className,this.showChangedMsg=!0,this.spec=function(e,t,n){var a=e.control,o=e.databind;n.isDataOnly?a={}:n.isControlOnly&&(o={});var s=i().extend(!0,{},o,a,t);return r.Ay.each(s,(function(e,t){r.Ay.isFunction(e)&&(e=e(n)),e?s[t]=e:delete s[t]})),s}(this._baseSpec,this.options.spec,this.options),r.Ay.each(this.spec,(function(e,t){e.deleteOnCopy&&(!0===e.deleteOnCopy||e.deleteOnCopy(a,o))&&delete a[t],"notallowed"!==n.getPresence(t)&&e.widget&&e.widget.trackLogicReferences&&n.logicReferenceAttrs.push(t)})),this.p=new c({spec:this.spec,mug:this}),this.options.init(this,this.form),this.p.setAttrs(a),this.p.shouldChange=this.form.shouldMugPropertyChange.bind(this.form)},getAppearanceAttribute:function(){return this.options.getAppearanceAttribute(this)},getIcon:function(){return this.options.getIcon(this)},validate:function(e){var t=this;return l.A.checkForFormSubmissions(t.form),this._withMessages((function(){var n=!1;return t.form.updateLogicReferences(t,e),e?n=t._validate(e):r.Ay.each(r.Ay.keys(t.p.__data),(function(e){n=t._validate(e)||n})),n}))},_validate:function(e){var t=this,n=t.spec[e];if(!n)return window.console.log("unexpected property: "+e),!1;var a=t.p[e],i=t.getPresence(e),r=n.lstring||e,o="";if(a||"required"!==i){if(a&&"notallowed"===i)o=gettext("{question} is not allowed.");else if(n.validationFunc){try{o=n.validationFunc(t)}catch(e){o=gettext("{question} validation failed")+"\n"+l.A.formatExc(e)}"pass"===o&&(o="")}}else o=gettext("{question} is required.");return o&&o.hasOwnProperty("markdown")?o.markdown=this._replaceQuestionText(o.markdown,r):o=this._replaceQuestionText(o,r),this.messages.update(e,{key:"mug-"+e+"-error",level:this.ERROR,message:o})},_replaceQuestionText:function(e,t){return l.A.format(e||"",{question:t})},ERROR:"error",WARNING:"warning",INFO:"info",addMessage:function(e,t){var n=this.messages;return this._withMessages((function(){return n.update(e,t)}))},dropMessage:function(e,t){var n=this.spec[e],a=this.addMessage(e,{key:t});return n&&n.dropMessage&&n.dropMessage(this,e,t),a},addMessages:function(e){var t=this;this._withMessages((function(){return r.Ay.reduce(e,(function(e,n,a){return r.Ay.reduce(n,(function(e,n){return t.messages.update(a,n)||e}),!1)||e}),!1)}))},_withMessages:function(e){var t=r.Ay.isUndefined(this._messagesChanged),n=!1;t&&(this._messagesChanged=!1);try{(n=e()||this._messagesChanged)&&(t?this.fire({type:"messages-changed",mug:this}):this._messagesChanged=!0)}finally{t&&delete this._messagesChanged}return n},getErrors:function(){var e=[];return this.messages.each((function(t){"info"!==t.level&&e.push(t.message)})),r.Ay.uniq(e)},hasErrors:function(){return 0!==this.getErrors().length},getSerializationWarnings:function(){var e=[];return this.messages.each((function(t){t.fixSerializationWarning&&e.push(t)})),e},fixSerializationWarnings:function(e){var t=this;r.Ay.each(e,(function(e){e.fixSerializationWarning(t)}))},getLabelValue:function(){return this.p.label||""},getNodeID:function(){return this.p.nodeID},getPresence:function(e){var t=this.spec[e];if(r.Ay.isUndefined(t))throw new Error("unknown property: $1.spec.$2".replace("$1",this.__className).replace("$2",e));return r.Ay.isFunction(t.presence)?t.presence(this):t.presence},isVisible:function(e){if("notallowed"===this.getPresence(e))return!1;var t=this.spec[e],n=t.visibility;if("visible"===n)return!0;if("visible_if_present"===n)return!r.Ay.isUndefined(this.p[e]);if("hidden"===n)return!1;if(r.Ay.isFunction(n))return n(this,t);if(this.spec.hasOwnProperty(n))return this.isVisible(n);throw new Error("unknown visibility: $1.spec.$2 = $3".replace("$1",this.__className).replace("$2",e).replace("$3",String(n)))},getDisplayName:function(e,t){void 0===t&&(t=!0);var n,a,r=this.p.labelItext,o=this.form.vellum.data.javaRosa.Itext.getDefaultLanguage(),s=this.p.conflictedNodeId||this.p.nodeID;return"ReadOnly"===this.__className?gettext("Unknown (read-only) question type"):"Itemset"===this.__className?gettext("Lookup Table Data"):r&&"_ids"!==e?(e=e||o)?(a=r.get("default",o),(n=r.get("default",e)||a)&&n!==s?(e!==o&&n===a&&(n+=" ["+o+"]"),t?i()("<div>").text(n).html():n):s):gettext("No Translation Data"):s},serialize:function(){var e=this,t={type:e.__className};return r.Ay.each(e.spec,(function(n,a){if("notallowed"!==e.getPresence(a)){var i=e.p[a];n.serialize?(i=n.serialize(i,a,e,t),r.Ay.isUndefined(i)||(t[a]=i)):!i||r.Ay.isEmpty(i)&&(r.Ay.isObject(i)||r.Ay.isArray(i))||(t[a]=i)}})),t},deserialize:function(e,t){var n=this;r.Ay.each(n.spec,(function(a,i){if("notallowed"!==n.getPresence(i))if(a.deserialize){var o=a.deserialize(e,i,n,t);r.Ay.isUndefined(o)||(n.p[i]=o)}else e.hasOwnProperty(i)&&(n.p[i]=e[i])}))},teardownProperties:function(){this.fire({type:"teardown-mug-properties",mug:this})},isInRepeat:function(){return"Repeat"===this.__className||this.parentMug&&this.parentMug.isInRepeat()},isReferencedByOtherMugs:function(e){return this.form.isReferencedByOtherMugs(this,e)}},Object.defineProperty(d.prototype,"absolutePath",{get:function(){return this.form.getAbsolutePath(this)}}),Object.defineProperty(d.prototype,"absolutePathNoRoot",{get:function(){return this.form.getAbsolutePath(this,!0)}}),Object.defineProperty(d.prototype,"hashtagPath",{get:function(){return this.options.isHashtaggable&&this.absolutePathNoRoot?"#form"+this.absolutePathNoRoot:this.absolutePath}}),Object.defineProperty(d.prototype,"parentMug",{get:function(){var e=this.form.tree.getNodeFromMug(this);return e&&e.parent?e.parent.value:null}}),Object.defineProperty(d.prototype,"previousSibling",{get:function(){return this.form.tree.getPreviousSibling(this)}}),u.prototype={update:function(e,t){if(e=e||"",1===arguments.length)return!!this.messages.hasOwnProperty(e)&&(delete this.messages[e],!0);if(!this.messages.hasOwnProperty(e)&&!t.message)return!1;if(!t.key)throw new Error("missing key: "+JSON.stringify(t));for(var n=this.messages[e]||[],a=!1,i=n.length-1;i>=0;i--){var r=n[i];if(r.key===t.key){const e=this.getMessageText(r.message),o=this.getMessageText(t.message);if(r.level===t.level&&e===o)return!1;n.splice(i,1),a=!0;break}}if(t.message)n.push(t);else if(!a)return!1;return n.length?this.messages[e]=n:delete this.messages[e],!0},get:function(e,t){return arguments.length?t?r.Ay.find(this.messages[e||""],(function(e){return e.key===t}))||null:r.Ay.pluck(this.messages[e||""],"message"):r.Ay.flatten(r.Ay.map(this.messages,(function(e){return r.Ay.pluck(e,"message")})))},each:function(){var e,t;arguments.length>1?(e=arguments[0]||"",t=arguments[1],r.Ay.each(this.messages[e],t)):(t=arguments[0],r.Ay.each(this.messages,(function(e,n){r.Ay.each(e,(function(e){t(e,n)}))})))},isEmpty:function(){return r.Ay.isEmpty(this.messages)},getMessageText:function(e){return e&&e.hasOwnProperty("markdown")?e.markdown:e}},c.setBaseSpec=function(e){r.Ay.each(e,(function(e,t){Object.defineProperty(c.prototype,t,{get:function(){return this._get(t)},set:function(e){this._set(t,e)},configurable:!0})}))},c.prototype={getDefinition:function(e){return this.__spec[e]},getAttrs:function(){return r.Ay.clone(this.__data)},has:function(e){return this.__data.hasOwnProperty(e)},set:function(e,t){arguments.length>1?this.__data[e]=t:delete this.__data[e]},_get:function(e){return this.__data[e]},_set:function(e,t){var n=this.__spec[e],a=this.__data[e],i=this.__mug;if(n&&t!==a&&("notallowed"!==i.getPresence(e)||"DataBindOnly"===i.__className)){var r=this.shouldChange(i,e,t,a);r&&(n.setter?n.setter(i,e,t):this.__data[e]=t,r())}},setAttrs:function(e){var t=this;(0,r.Ay)(e).each((function(e,n){t[n]=e}))}};var m={case:!0,registration:!0,script:!0},v={databind:{nodeID:{visibility:"visible",presence:"required",lstring:gettext("Question ID"),setter:function(e,t,n){e.form.moveMug(e,"rename",n)},mugValue:function(e,t){if(1===arguments.length)return e.p.has("conflictedNodeId")?e.p.conflictedNodeId:e.p.nodeID;e.p.nodeID=t},widget:s.A.identifier,validationFunc:function(e){var t=e.p.nodeID.toLowerCase(),n={key:"mug-nodeID-reserved-name-warning",level:e.WARNING},a={key:"mug-nodeID-changed-warning",level:e.INFO},i="pass";return m.hasOwnProperty(t)&&(n.message=l.A.format(gettext("The ID '{nodeID}' may cause problems with form parsing. It is recommended to pick a different Question ID."),{nodeID:e.p.nodeID})),e.addMessage("nodeID",n),l.A.isValidElementName(e.p.nodeID)?"meta"===e.p.nodeID.toLowerCase()?i=gettext("'meta' is not a valid Question ID."):e.form.warnWhenChanged&&e.showChangedMsg&&e.__originalNodeID&&e.p.nodeID!==e.__originalNodeID&&(a.message=gettext("Making this change will create a new Question ID (and a new column in exports).")):i=l.A.format(gettext("{nodeID} is not a valid Question ID. It must start with a letter and contain only letters, numbers, and '-' or '_' characters."),{nodeID:e.p.nodeID}),e.addMessage("nodeID",a),i},dropMessage:function(e,t,n){"nodeID"===t&&"mug-conflictedNodeId-warning"===n&&g(e)},serialize:function(e,t,n,a){a.id=n.absolutePathNoRoot},deserialize:function(e,t,n,a){return e.id&&e.id!==n.p.nodeID&&(n.p.nodeID=e.id.slice(e.id.lastIndexOf("/")+1)||n.form.generate_question_id(null,n),e.conflictedNodeId)?a.later((function(){n.p.nodeID=e.conflictedNodeId})):a.later((function(){n.p.conflictedNodeId&&g(n)}))}},conflictedNodeId:{visibility:"hidden",presence:"optional",setter:function(e,t,n){var a=null;n?(e.p.set(t,n),a=gettext("This question has the same Question ID as another question in the same group. Please choose a unique Question ID.")):e.p.set(t),e.addMessage("nodeID",{key:"mug-conflictedNodeId-warning",level:e.WARNING,message:a,fixSerializationWarning:g})},deserialize:function(){}},dataValue:{visibility:"visible_if_present",presence:"optional",lstring:gettext("Default Data Value")},xmlnsAttr:{visibility:"visible",presence:"notallowed",lstring:gettext("Special Hidden Value XMLNS attribute")},rawDataAttributes:{presence:"optional",lstring:gettext("Extra Data Attributes")},relevantAttr:{visibility:"visible",presence:"optional",widget:s.A.xPath,xpathType:"bool",serialize:p,deserialize:f,lstring:gettext("Display Condition")},calculateAttr:{visibility:"visible_if_present",presence:"optional",widget:s.A.xPath,xpathType:"generic",serialize:p,deserialize:f,lstring:gettext("Calculate Condition")},constraintAttr:{visibility:"visible",presence:"optional",validationFunc:function(e){return v.databind.constraintMsgAttr.validationFunc(e)},widget:s.A.xPath,xpathType:"bool",mayReferenceSelf:!0,serialize:p,deserialize:f,lstring:gettext("Validation Condition")},constraintMsgAttr:{visibility:"visible",presence:"optional",validationFunc:function(e){return e.p.constraintMsgAttr&&!e.p.constraintAttr?gettext("You cannot have a Validation Error Message with no Validation Condition!"):"pass"},lstring:gettext("Validation Error Message")},requiredAttr:{visibility:"visible",presence:"optional",lstring:gettext("Required"),widget:s.A.checkbox,validationFunc:function(e){return v.databind.requiredCondition.validationFunc(e)}},requiredCondition:{visibility:"requiredAttr",presence:"optional",lstring:gettext("Required Condition"),widget:s.A.xPath,xpathType:"bool",serialize:p,deserialize:f,validationFunc:function(e){var t="mug-requiredCondition-warning",n=["requiredAttr","requiredCondition"];if(e.p.requiredCondition&&!e.p.requiredAttr){var a=gettext("The condition will be ignored unless you mark the question required.");r.Ay.each(n,(function(n){e.addMessage(n,{key:t,level:e.WARNING,message:a})}))}else r.Ay.each(n,(function(n){e.dropMessage(n,t)}));return"pass"}},nodeset:{visibility:"hidden",presence:"optional"},rawBindAttributes:{presence:"optional",lstring:gettext("Extra Bind Attributes")},defaultValue:{visibility:"visible",presence:"optional",lstring:gettext("Default Value"),widget:s.A.xPath,xpathType:"generic",serialize:p,deserialize:f,validationFunc:function(e){if(!e.form.vellum.opts().features.allow_data_reference_in_setvalue){var t=e.form.getHashtagsInXPath(e.p.defaultValue);if((t=r.Ay.filter(t,(function(e){return"form"===e.namespace}))).length)return gettext("You are referencing a node in this form. This can cause errors in the form")}return"pass"}},comment:{lstring:gettext("Comment"),visibility:"visible",widget:s.A.multilineText}},control:{appearance:{deleteOnCopy:!0,visibility:"visible",presence:"optional",lstring:gettext("Appearance Attribute")},label:{visibility:"visible",presence:"optional",lstring:gettext("Default Display Text"),validationFunc:function(e){return e.p.label||"required"!==e.getPresence("label")?"pass":gettext("Default Display Text is required")}},hintLabel:{visibility:"visible",presence:"optional",lstring:gettext("Hint Display Text")},rawControlAttributes:{presence:"optional",lstring:gettext("Extra Control Attributes")},rawControlXML:{presence:"optional",lstring:gettext("Raw XML")},dataParent:{lstring:gettext("Data Parent"),visibility:"visible",presence:"optional",setter:function(e,t,n){var a=e.hashtagPath;e.p.set(t,n),e.form._updateMugPath(e,a)},widget:s.A.droppableText,validationFunc:function(e){function t(e){return e?"limited"===e.options.possibleDataParent?e:t(e.parentMug):null}var n,a=e.p.dataParent,i=e.form;if(a)if(n=i.getMugByPath(a)){if(n===e||!n.options.possibleDataParent)return l.A.format(gettext("{path} is not a valid data parent"),{path:n.hashtagPath});if(t(e)!==t(n))return gettext("Data parent of question in repeat group must be (in) the same repeat group")}else if(i.getBasePath().slice(0,-1)!==a)return gettext("Must be valid path");return"pass"}}}},y={typeName:"Base",tagName:"input",isDataOnly:!1,isControlOnly:!1,isTypeChangeable:!0,typeChangeError:function(e,t){return""},changeTypeTransform:function(e){},isRemoveable:!0,isCopyable:!0,canOutputValue:!0,maxChildren:-1,icon:null,supportsDataNodeRole:!1,parseDataNode:function(e,t){return t.children()},controlNodeChildren:null,getPathName:null,getTagName:null,dataChildFilter:null,controlChildFilter:null,getExtraDataAttributes:null,writeDataNodeXML:null,getBindList:function(e){var t,n,a=e.p.constraintMsgItext;t=a&&!a.isEmpty()?"jr:itext('"+a.id+"')":e.p.constraintMsgAttr,n=e.p.requiredAttr&&e.p.requiredCondition||l.A.createXPathBoolFromJS(e.p.requiredAttr);var i={nodeset:e.hashtagPath,type:e.options.dataType,constraint:e.p.constraintAttr,"jr:constraintMsg":t,relevant:e.p.relevantAttr,required:n,requiredCondition:e.p.requiredCondition,calculate:e.p.calculateAttr};return r.Ay.each(e.p.rawBindAttributes,(function(e,t){i.hasOwnProperty(t)&&!r.Ay.isUndefined(i[t])||(i[t]=e)})),i.nodeset?[i]:[]},getSetValues:function(e){var t=[];return e.p.defaultValue&&(t=[{value:e.p.defaultValue,event:e.isInRepeat()?"jr-insert":"xforms-ready",ref:e.hashtagPath}]),t},writeControlLabel:!0,writeControlHint:!0,writeControlHelp:!0,writeControlAlert:!0,writeControlRefAttr:"ref",writeCustomXML:null,writesOnlyCustomXML:!1,afterInsert:function(e,t){},getAppearanceAttribute:function(e){return e.p.appearance},getIcon:function(e){return e.options.icon},isHashtaggable:!0,init:function(e,t){},spec:{}},x=l.A.extend(y,{isDataOnly:!0,typeName:gettext("Hidden Value"),icon:"fcc fcc-fd-variable",isTypeChangeable:!1,spec:{xmlnsAttr:{presence:"optional"},requiredAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},calculateAttr:{visibility:"visible"}}}),b=l.A.extend(y,{writesOnlyCustomXML:!0,writeCustomXML:function(e,t){return e.writeXML(i()("<div>").append(t.p.rawControlXML).clone().html())},spec:{readOnlyControl:{visibility:"visible",widget:s.A.readOnlyControl}}}),A=l.A.extend(y,{typeName:gettext("Text"),dataType:"xsd:string",icon:"fcc fcc-fd-text",init:function(e,t){}}),w=l.A.extend(A,{typeName:gettext("Phone Number or Numeric ID"),icon:"fa fa-signal",init:function(e,t){A.init(e,t),e.p.appearance="numeric"},changeTypeTransform:function(e){e.p.appearance=void 0}}),M=l.A.extend(y,{typeName:gettext("Password"),dataType:"xsd:string",tagName:"secret",icon:"fa fa-key",canOutputValue:!1,init:function(e,t){}}),_=l.A.extend(y,{typeName:gettext("Integer"),dataType:"xsd:int",icon:"fcc fcc-fd-numeric",init:function(e,t){}}),C=l.A.extend(y,{typeName:gettext("Audio Capture"),dataType:"binary",tagName:"upload",icon:"fcc fcc-fd-audio-capture",mediaType:"audio/*",canOutputValue:!1,writeCustomXML:function(e,t){e.writeAttributeString("mediatype",t.options.mediaType)}}),I=l.A.extend(C,{typeName:gettext("Image Capture"),icon:"fa fa-camera",mediaType:"image/*",spec:{imageSize:{lstring:gettext("Image Size"),visibility:"visible",widget:s.A.dropdown,enabled:function(e){return e.options.resize_enabled},defaultOptions:[{text:gettext("Small"),value:"250"},{text:gettext("Medium"),value:"500"},{text:gettext("Large"),value:"1000"},{text:gettext("Original"),value:""}],help:gettext("This will resize the image before sending the form. Use this option to send smaller images in areas of poor connectivity.<ul><li>Small - 0.1 megapixels</li><li>Medium - 0.2 megapixels</li><li>Large - 0.5 megapixels</li></ul>")}},writeCustomXML:function(e,t){C.writeCustomXML(e,t),"Image"===t.__className&&t.p.imageSize&&e.writeAttributeString("jr:imageDimensionScaledMax",t.p.imageSize+"px")},init:function(e,t){C.init(e,t),""!==e.p.imageSize&&(e.p.imageSize=e.p.imageSize||250)}}),k=l.A.extend(C,{typeName:gettext("Micro-Image"),isTypeChangeable:!1,icon:"fa fa-camera",tagName:"input",mediaType:"image/*",init:function(e,t){C.init(e,t),e.p.appearance="micro-image"}}),P=l.A.extend(C,{typeName:gettext("Video Capture"),icon:"fa fa-video-camera",mediaType:"video/*"}),T=l.A.extend(I,{typeName:gettext("Signature Capture"),icon:"fcc fcc-fd-signature",spec:{imageSize:{visibility:"hidden"}},init:function(e,t){I.init(e,t),e.p.appearance="signature"},changeTypeTransform:function(e){e.p.appearance=void 0}}),S=l.A.extend(C,{typeName:gettext("Document Upload"),icon:"fa fa-file",mediaType:"application/*,text/*"}),N=l.A.extend(y,{typeName:gettext("GPS"),dataType:"geopoint",icon:"fa-solid fa-location-dot",init:function(e,t){}}),E=l.A.extend(y,{typeName:gettext("Barcode Scan"),dataType:"barcode",icon:"fa fa-barcode",init:function(e,t){}}),D=l.A.extend(y,{typeName:gettext("Date"),dataType:"xsd:date",icon:"fa-solid fa-calendar-days",init:function(e,t){}}),R=l.A.extend(y,{typeName:gettext("Date and Time"),dataType:"xsd:dateTime",icon:"fcc fcc-fd-datetime",init:function(e,t){}}),O=l.A.extend(y,{typeName:gettext("Time"),dataType:"xsd:time",icon:"fa-regular fa-clock",init:function(e,t){}}),L=l.A.extend(_,{typeName:gettext("Long"),dataType:"xsd:long",icon:"fcc fcc-fd-long",init:function(e,t){}}),q=l.A.extend(_,{typeName:gettext("Decimal"),dataType:"xsd:double",icon:"fcc fcc-fd-decimal",init:function(e,t){}}),F=l.A.extend(y,{isControlOnly:!0,typeName:gettext("Choice"),tagName:"item",icon:"fcc fcc-fd-single-circle",isTypeChangeable:!1,canOutputValue:!1,getIcon:function(e){return"Select"===e.parentMug.__className?"fcc fcc-fd-single-circle":"fcc fcc-fd-multi-box"},writeControlHint:!1,writeControlHelp:!1,writeControlAlert:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){var n=t.p.nodeID;n&&(e.writeStartElement("value"),e.writeString(n),e.writeEndElement())},init:function(e,t){},spec:{nodeID:{lstring:gettext("Choice Value"),visibility:"visible",presence:"required",widget:s.A.identifier,setter:null,validationFunc:function(e){if(/\s/.test(e.p.nodeID))return gettext("Whitespace in values is not allowed.");if(e.parentMug){var t=e.form.getChildren(e.parentMug);if(r.Ay.any(t,(function(t){return t!==e&&t.p.nodeID===e.p.nodeID})))return gettext("This choice value has been used in the same question")}return"pass"},serialize:function(e,t,n,a){var i=n.parentMug.absolutePathNoRoot;a.id=i+"/"+e},deserialize:function(e){return e.id&&e.id.slice(e.id.lastIndexOf("/")+1)}},labelItext:{presence:"required"},conflictedNodeId:{presence:"notallowed"},hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},helpItext:{presence:"notallowed"},defaultValue:{presence:"optional",visibility:"hidden"}}}),V=l.A.extend(y,{typeName:gettext("Label"),tagName:"trigger",icon:"fa fa-tag",init:function(e,t){e.p.appearance="minimal"},changeTypeTransform:function(e){e.p.appearance=void 0},spec:{dataValue:{presence:"optional"},defaultValue:{presence:"optional",visibility:"hidden"},requiredAttr:{deleteOnCopy:function(e,t){return"minimal"===e.appearance||"DataBindOnly"!==t},visibility:function(e){return"minimal"!==e.p.appearance}},requiredCondition:{deleteOnCopy:function(e,t){return"minimal"===e.appearance||"DataBindOnly"!==t}}}}),j=l.A.extend(y,{validChildTypes:["Choice"],controlNodeChildren:function(e){return e.children().not("label, value, hint, help, alert")},typeChangeError:function(e,t){return e.form.getChildren(e).length>0&&!t.match(/^M?Select$/)?gettext("Cannot change a Multiple/Single Choice question to a non-Choice question if it has Choices. Please remove all Choices and try again."):""},canAddChoices:!0,spec:{appearance:{deleteOnCopy:!1}},dataType:""}),B=l.A.extend(j,{typeName:gettext("Checkbox"),tagName:"select",icon:"fcc fcc-fd-multi-select",defaultOperator:"selected"}),z=l.A.extend(j,{typeName:gettext("Multiple Choice"),tagName:"select1",icon:"fcc fcc-fd-single-select",defaultOperator:null}),U=l.A.extend(y,{typeName:gettext("Group"),tagName:"group",icon:"fa fa-folder-open",isSpecialGroup:!0,isNestableGroup:!0,isTypeChangeable:!1,possibleDataParent:!0,canOutputValue:!1,controlNodeChildren:function(e){return e.children().not("label, value, hint, help, alert")},init:function(e,t){},spec:{hintLabel:{presence:"notallowed"},hintItext:{presence:"notallowed"},helpItext:{presence:"notallowed"},calculateAttr:{presence:"notallowed"},constraintAttr:{presence:"notallowed"},constraintMsgAttr:{presence:"notallowed"},dataValue:{presence:"notallowed"},requiredAttr:{presence:"notallowed"},defaultValue:{presence:"optional",visibility:"hidden"}}}),X=l.A.extend(U,{typeName:gettext("Question List"),icon:"fa fa-reorder",init:function(e,t){U.init(e,t),e.p.appearance="field-list"},changeTypeTransform:function(e){e.p.appearance=void 0}}),H=l.A.extend(U,{typeName:gettext("Repeat Group"),icon:"fa fa-retweet",possibleDataParent:"limited",controlNodeChildren:function(e){return e.children("repeat").children().not("jr\\:addEmptyCaption, jr\\:addCaption")},getExtraDataAttributes:function(e){return{"jr:template":""}},controlChildFilter:function(e,t){var n=t.hashtagPath,a=t.p.repeat_count,i=r.Ay.object(r.Ay.filter(r.Ay.map(t.p.rawRepeatAttributes,(function(e,t){return"jr:noaddremove"!==t.toLowerCase()?[t,e]:null})),r.Ay.identity));return[new o.A.Node(e,{getNodeID:function(){},getAppearanceAttribute:function(){},form:t.form,p:{rawControlAttributes:i,addEmptyCaptionItext:t.p.addEmptyCaptionItext,addCaptionItext:t.p.addCaptionItext},options:{tagName:"repeat",writeRepeatItexts:t.options.customRepeatButtonText,writeControlLabel:!1,writeControlHint:!1,writeControlHelp:!1,writeControlAlert:!1,writeControlRefAttr:null,writeCustomXML:function(e,t){a&&(l.A.writeHashtags(e,"jr:count",String(a)),e.writeAttributeString("jr:noAddRemove","true()")),l.A.writeHashtags(e,"nodeset",n,t)}}})]},writeControlRefAttr:null,init:function(e,t){e.p.repeat_count=null},spec:{repeat_count:{lstring:gettext("Repeat Count"),visibility:"visible_if_present",presence:"optional",widget:s.A.droppableText,validationFunc:function(e){return!i().trim(e.p.repeat_count)&&function e(t){if(!t)return!1;var n=t.parentMug;return!(!n||"FieldList"!==n.__className)||e(n)}(e)?gettext("Repeat Count is required."):"pass"}},rawRepeatAttributes:{presence:"optional",lstring:gettext("Extra Repeat Attributes")}}});function $(e,t,n){var a=this,o=n.features.group_in_field_list;Image.resize_enabled=n.features.image_resize,this.auxiliaryTypes=t.auxiliary,this.normalTypes=t.normal,this.baseSpec=e,c.setBaseSpec(l.A.extend.apply(null,[e.databind,e.control].concat(r.Ay.filter(r.Ay.pluck(l.A.extend(this.normalTypes,this.auxiliaryTypes),"spec"),r.Ay.identity)))),this.allTypes=i().extend({},this.auxiliaryTypes,this.normalTypes);var s=r.Ay.keys(this.allTypes),d=r.Ay.without.apply(r.Ay,[s].concat(r.Ay.keys(this.auxiliaryTypes)));o||(this.normalTypes.FieldList.validChildTypes=r.Ay.without.apply(r.Ay,[d].concat(r.Ay.without(r.Ay.map(this.allTypes,(function(e,t){return e.isNestableGroup?t:null})),null)))),r.Ay.each(this.auxiliaryTypes,(function(e){e.validChildTypes=[]})),r.Ay.each(this.normalTypes,(function(e,t){var n;e.validChildTypes||(n=e.isNestableGroup?d:[],e.validChildTypes=n)})),r.Ay.each(this.allTypes,(function(e,t){e.__className=t,a[t]=e}))}$.prototype={make:function(e,t,n){var a=this.allTypes[e],i=n?n.p.getAttrs():null;return new d(a,t,this.baseSpec,i)},changeType:function(e,t){var n=e.form,a=n.getChildren(e),i=this.allTypes[e.__className].typeChangeError(e,t);if(i)throw new Error(i);this.allTypes[e.__className].changeTypeTransform(e),e.setOptionsAndProperties(this.allTypes[t]),-1!==t.indexOf("Select")&&r.Ay.each(a,(function(e){n.fire({type:"parent-question-type-change",childMug:e})})),e.validate(),n.fire({type:"question-type-change",qType:t,mug:e}),n.fireChange(e)}};const Q={defaultOptions:y,baseMugTypes:{normal:{Audio:C,Barcode:E,DataBindOnly:x,Date:D,DateTime:R,Document:S,Double:q,FieldList:X,Geopoint:N,Group:U,Image:I,MicroImage:k,Int:_,Long:L,MSelect:B,PhoneNumber:w,ReadOnly:b,Repeat:H,Secret:M,Select:z,Signature:T,Text:A,Time:O,Trigger:V,Video:P},auxiliary:{Choice:F}},MugTypesManager:$,MugMessages:u,WARNING:d.WARNING,ERROR:d.ERROR,baseSpecs:v,deserializeXPath:f,serializeXPath:p,updateInstances:h}},8262:(e,t,n)=>{"use strict";n.d(t,{A:()=>H});var a=n(4523),i=n(561),r=n.n(i),o=n(7026),s=n(4854),l=n(4459),d=n(7867),u=n(8916),c=n(375),p=n.n(c),f=n(9659),h={keys:["displayPath"],tokenize:!0,tokenSeparator:/\/+/g,threshold:.4};function g(e){var t=this;function n(e){i(e),t.dataset.push(m(e.mug)),t.fusejs.set(t.dataset)}function i(e){t.dataset=a.Ay.filter(t.dataset,(function(t){return t.id!==e.mug.ufid}))}this.form=e,e.vellum.datasources.on("change",(function(){t.dataset=v(e),t.fusejs.set(t.dataset)}),null,null,e),e.on("change",(function(n){void 0===n.mug&&(t.dataset=v(e),t.fusejs.set(t.dataset))})),this.dataset||(this.dataset=v(e)),this.fusejs=new(p())(this.dataset,h),this.form.on("mug-property-change",(function(e){"nodeID"===e.property&&n(e)})).on("question-label-text-change",n).on("question-create",n).on("question-remove",i)}function m(e){if(e){var t=e.form.vellum.getMugDisplayName(e);return{id:e.ufid,name:e.absolutePath,hashtagPath:e.hashtagPath,absolutePath:e.absolutePath,displayPath:e.form.richText?e.hashtagPath:e.absolutePath,icon:e.options.icon,questionId:e.p.nodeID,displayLabel:f.A.truncate(t),label:t,mug:e}}return null}function v(e){var t=[];return e.richText&&(t=a.Ay.chain(e.vellum.datasources.getHashtagMap({})).map((function(e,t){return{name:t,hashtagPath:t,absolutePath:e,icon:"fcc fcc-fd-case-property",displayLabel:null,displayPath:t}})).value()),a.Ay.chain(e.getMugList()).map(m).filter((function(e){return e.name&&!a.Ay.isUndefined(e.displayLabel)})).value().concat(t)}g.prototype={list:function(){return this.fusejs.list},search:function(e){return this.fusejs.search(e)}};const y=g;var x=n(9655),b=n.n(x);function A(){var e=r()(".fd-undo-delete");return!!e.hasClass("in")&&e.length}function w(e){var t,n;e.length&&!A()?(t=a.Ay.map(e,(function(e){return e[0]})),n=a.Ay.filter(a.Ay.map(t,(function(e){return e.isReferencedByOtherMugs(t)?e.p.nodeID:""})),a.Ay.identity),r()(".fd-undo-container").append(b()({errors:n,format:f.A.format}))):0===e.length&&A()&&r()(".fd-undo-delete").remove()}function M(){this.undoStack=[],f.A.eventuality(this)}M.prototype={resetUndo:function(e,t,n){this.undoStack=e?[[e,t,n]]:[],w(this.undoStack),this.fire({type:"reset"})},setUndo:function(e){this.undoStack=this.undoStack.concat(e),w(this.undoStack)},undo:function(){a.Ay.each(this.undoStack,(function(e){var t=e[0],n=e[1],a=e[2];t.form.insertQuestion(t,n,a,!0)})),this.resetUndo()}};const _=M;var C=n(3578),I=n.n(C),k=n(6999),P=n.n(k),T=function(e,t){var n=t.attributes;for(var a in n)n.hasOwnProperty(a)&&n[a]&&e.writeAttributeString(a,n[a])};const S=function(e,t){var n=new(P())("UTF-8","1.0");e.vellum.beforeSerialize(),n.writeStartDocument(),n.writeStartElement("h:html"),function(e,t){e.writeAttributeString("xmlns:h","http://www.w3.org/1999/xhtml"),e.writeAttributeString("xmlns:orx","http://openrosa.org/jr/xforms"),e.writeAttributeString("xmlns","http://www.w3.org/2002/xforms"),e.writeAttributeString("xmlns:xsd","http://www.w3.org/2001/XMLSchema"),e.writeAttributeString("xmlns:jr","http://openrosa.org/javarosa"),e.writeAttributeString("xmlns:vellum","http://commcarehq.org/xforms/vellum");var n=[];t.mayDisableRichText&&!t.richText&&n.push("richText"),t.noMarkdown&&n.push("markdown"),n.length&&e.writeAttributeString("vellum:ignore",n.join(" "))}(n,e),n.writeStartElement("h:head"),n.writeStartElement("h:title"),n.writeString(e.formName),n.writeEndElement(),n.writeStartElement("model"),n.writeStartElement("instance"),T(n,e.instanceMetadata[0]);var i,o,s=e.dataTree();(function(e,t,n){t.walk((function(t,a,i){if(!t||!t.options.getTagName||null!==(a=t.options.getTagName(t,a))){if(n.writeStartElement(a),t){var r=t.p.rawDataAttributes,o=null;for(var s in t.options.getExtraDataAttributes&&(o=t.options.getExtraDataAttributes(t)),r)r.hasOwnProperty(s)&&n.writeAttributeString(s,r[s]);var l=t.p.dataValue,d=t.p.xmlnsAttr;if(l&&n.writeString(l),t.options.writeDataNodeXML&&t.options.writeDataNodeXML(n,t),t.p.comment&&n.writeAttributeString("vellum:comment",t.p.comment),d&&n.writeAttributeString("xmlns",d),o)for(s in o)o.hasOwnProperty(s)&&n.writeAttributeString(s,o[s])}else!function(e,t){var n,a;(a=e.formJRM)||(a="http://dev.commcarehq.org/jr/xforms"),(n=e.formUuid)||(n="http://openrosa.org/formdesigner/"+f.A.generate_xmlns_uuid()),t.writeAttributeString("xmlns:jrm",a),t.writeAttributeString("xmlns",n),t.writeAttributeString("uiVersion",e.formUIVersion||"1"),t.writeAttributeString("version",e.formVersion||"1"),t.writeAttributeString("name",e.formName||gettext("New Form"))}(e,n);i(t&&t.options.dataChildFilter),n.writeEndElement()}}))})(e,s,n),n.writeEndElement();for(var l=1;l<e.instanceMetadata.length;l++)i=n,(o=e.instanceMetadata[l]).internal||(i.writeStartElement("instance"),T(i,o),o.children.length&&i.writeXML(r()("<div>").append(o.children).clone().html()),i.writeEndElement());(function(e,t){e.walk((function(e,n,i){e&&e.options.getBindList&&a.Ay.each(e.options.getBindList(e),(function(n){t.writeStartElement("bind"),a.Ay.each(n,(function(n,a){n&&f.A.writeHashtags(t,a,n,e)})),t.writeEndElement()})),i()}))})(s,n),function(e,t,n){function i(e,t){n.writeStartElement("setvalue"),n.writeAttributeString("event",e.event),f.A.writeHashtags(n,"ref",e.ref,t),f.A.writeHashtags(n,"value",e.value,t),n.writeEndElement()}a.Ay.each(t.getSetValues(),(function(e){i(e,{form:t})})),e.walk((function(e,t,n){e&&e.options.getSetValues&&a.Ay.each(e.options.getSetValues(e),(function(t){i(t,e)})),n()}))}(s,e,n),e.vellum.contributeToModelXML(n,e),n.writeEndElement();var d=e.knownExternalReferences();e.richText&&!a.Ay.isEmpty(d)&&(n.writeStartElement("vellum:hashtags"),n.writeString(JSON.stringify(d)),n.writeEndElement());var u=e.knownHashtagTransforms();return e.richText&&!a.Ay.isEmpty(d)&&(n.writeStartElement("vellum:hashtagTransforms"),n.writeString(JSON.stringify(u)),n.writeEndElement()),e.vellum.contributeToHeadXML(n,e),n.writeEndElement(),n.writeStartElement("h:body"),function(e,t){e.tree.walk((function(e,n,a){if(e){var i=e.options;if(!i.isDataOnly)if(i.writesOnlyCustomXML)i.writeCustomXML(t,e);else{t.writeStartElement(e.options.tagName.toLowerCase()),i.writeControlLabel&&function(e,t){var n,a=t.p.labelItext;a&&a.id&&(n="jr:itext('"+a.id+"')",a.isEmpty()&&"optional"===t.getPresence("labelItext")&&(n="")),(n||t.p.label)&&(e.writeStartElement("label"),n&&e.writeAttributeString("ref",n),t.p.label&&e.writeString(t.p.label),e.writeEndElement())}(t,e),i.writeControlHint&&function(e,t){var n=t.p.hintLabel,a=t.p.hintItext;if(n||a&&!a.isEmpty()){if(e.writeStartElement("hint"),n&&e.writeString(n),a&&!a.isEmpty()){var i="jr:itext('"+a.id+"')";e.writeAttributeString("ref",i)}e.writeEndElement()}}(t,e),i.writeControlHelp&&function(e,t){var n=t.p.helpItext;if(n&&!n.isEmpty()){e.writeStartElement("help");var a="jr:itext('"+n.id+"')";e.writeAttributeString("ref",a),e.writeEndElement()}}(t,e),i.writeControlAlert&&function(e,t){var n=t.p.constraintMsgItext;if(n&&!n.isEmpty()){e.writeStartElement("alert");var a="jr:itext('"+n.id+"')";e.writeAttributeString("ref",a),e.writeEndElement()}}(t,e),i.writeRepeatItexts&&function(e,t){var n=t.p.addEmptyCaptionItext;if(n&&!n.isEmpty()){e.writeStartElement("jr:addEmptyCaption");var a="jr:itext('"+n.id+"')";e.writeAttributeString("ref",a),e.writeEndElement()}var i=t.p.addCaptionItext;if(i&&!i.isEmpty()){e.writeStartElement("jr:addCaption");var r="jr:itext('"+i.id+"')";e.writeAttributeString("ref",r),e.writeEndElement()}}(t,e);var r=e.p.rawControlAttributes;for(var o in r)r.hasOwnProperty(o)&&t.writeAttributeString(o,r[o]);if(i.writeCustomXML&&i.writeCustomXML(t,e),i.writeControlRefAttr){var s=e.hashtagPath;f.A.writeHashtags(t,i.writeControlRefAttr,s,e)}var l=e.getAppearanceAttribute();l&&t.writeAttributeString("appearance",l),a(i.controlChildFilter),t.writeEndElement()}}else a()}))}(e,n),n.writeEndElement(),t&&e.vellum.contributeToAdditionalXML(n,e),n.writeEndElement(),n.writeEndDocument(),e.vellum.afterSerialize(),n.flush()};var N;Promise.all([n.e(307).then(n.bind(n,1307))]).then((([e])=>{N=e.default}));var E=function(e,t,n,i){var r={},o={};return r.attributes=e,r.children=t||[],r.addReference=function(e,t){o&&(e?(o[e.ufid]||(o[e.ufid]={}),o[e.ufid][t||"."]=null):o=null)},r.dropReference=function(e,t){return!(!o||!o[e.ufid])&&(t?(delete o[e.ufid][t],a.Ay.isEmpty(o[e.ufid])&&delete o[e.ufid]):delete o[e.ufid],a.Ay.isEmpty(o))},a.Ay.isUndefined(n)||r.addReference(n,i),r},D=/(^)instance\((['"])([^'"]+)\2\)/i,R=/^#([^\/]+)/;function O(e,t,n){var i=this;this.setValues=[],this._setValueId=1,this._logicManager=new s.A.LogicManager(this,{allowedDataNodeReferences:e.allowedDataNodeReferences}),this.vellum=t,this.mugTypes=n,this.formName=t.opts().core.formName||gettext("New Form"),this.noMarkdown=!1,this.mugMap={},this.instanceMetadata=[E({})],this.knownInstances={},this.richText=!!t.opts().features.rich_text,this.mayDisableRichText=this.richText,this._inferHashtags=function(e){function t(e,t){function n(e){return t+"/"+e}return[e,function(t){return l[e]=n,n(t)}]}var n="instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]",i="instance('casedb')/cases/case[@case_id = "+n+"/index/parent]",r="instance('casedb')/cases/case[@case_id = "+i+"/index/parent]",o={hashtagTransformations:a.Ay.object([t("#case/",n),t("#case/parent/",i),t("#case/grandparent/",r),t("#user/","instance('casedb')/cases/case[@case_type = 'commcare-user'][hq_user_id = instance('commcaresession')/session/context/userid]")])},s=null,l=null,u=d.A.parser(o,(function(e){var t=e.hashtagToXPath;return e.hashtagToXPath=function(e){var n=t(e);return n!==o.hashtagMap[e]&&(o.hashtagMap[e]=n,s[e]=n),n},e}));return function(t,n){var i;s={},l={},o.hashtagMap=a.Ay.clone(e.hashtagMap),o.hashtagNamespaces=e.hashtagNamespaces;try{i=u.parse(t).toXPath()}catch(e){window.console.log(f.A.formatExc(e))}i===n&&a.Ay.some(s)&&(a.Ay.each(s,(function(t,n){e.initHashtag(n,t)})),a.Ay.each(l,(function(t,n){e.hashtagTransformations.hasOwnProperty(n)||(e.hashtagTransformations[n]=t)})))}}(this),this.shouldInferHashtags=this.richText,t.datasources.on("change",this._updateHashtags.bind(this),null,null,this),this._updateHashtags(),this.transformHashtags=u.A.makeHashtagTransform(this),this.tree=new o.A("data","control"),this.addHashtag("#form","/data"),this.tree.on("change",(function(e){i.fireChange(e.mug)})),this.enableInstanceRefCounting=e.enableInstanceRefCounting,this.errors=[],this.question_counter=1,this.xpath=d.A.parser(this),this.undomanager=new _,this.undomanager.on("reset",(function(e){i.vellum.adjustToWindow()})),f.A.eventuality(this),this.on("form-load-finished",(function(){i.fuse=new y(i)})).on("question-create",(function(){i.undomanager.resetUndo()})),this.disconnectDataSources=function(){t.datasources.unbind(i,"change")}}O.prototype={_updateHashtags:function(){var e=this,t=e.vellum,n=e.hashtagMap;e.hashtagNamespaces={form:!0},e.richText?(e.hashtagMap=a.Ay.clone(t.datasources.getHashtagMap({})),e.invertedHashtagMap=a.Ay.invert(e.hashtagMap),e.hashtagTransformations=t.datasources.getHashtagTransforms({}),e.hasCaseHashtags=t.datasources.isReady(),e.shouldInferHashtags=!e.hasCaseHashtags,a.Ay.each(e.hashtagTransformations,(function(t,n){e.hashtagNamespaces[R.exec(n)[1]]=!0}))):(e.hashtagMap={},e.invertedHashtagMap={},e.hashtagTransformations={}),e.updateKnownInstances(a.Ay.chain(t.datasources.getDataSources([])).map((function(e){return[e.id,e.uri]})).object().value()),n&&a.Ay.each(n,(function(t,n){n.startsWith("#form/")&&e.addHashtag(n,t)})),e.fixBrokenReferences(),this._logicManager.validateExternalReferences()},inferHashtagMeanings:function(e,t){e&&d.A&&this.shouldInferHashtags&&this._inferHashtags(e,t)},isValidHashtag:function(e){return e=this.normalizeHashtag(e),this.hashtagMap.hasOwnProperty(e)},hasValidHashtagPrefix:function(e){var t=e.lastIndexOf("/");return-1!==t&&e.length>t+1&&this.hashtagTransformations.hasOwnProperty(e.substring(0,t+1))},addHashtag:function(e,t){this.hashtagMap[e]=t,this.invertedHashtagMap[t]=e},initHashtag:function(e,t){this.hashtagMap[e]||(this.addHashtag(e,t),this.hashtagNamespaces[R.exec(e)[1]]=!0)},removeHashtag:function(e){this.hashtagMap.hasOwnProperty(e)&&(delete this.invertedHashtagMap[this.hashtagMap[e]],delete this.hashtagMap[e])},normalize:function(e,t,n){if(!t||this.richText&&l.A.isInvalid(t))return t;try{return this.xpath.parse(t)[e]()}catch(e){return n?null:t}},normalizeHashtag:function(e,t){return this.normalize("toHashtag",e,t)},normalizeXPath:function(e){return this.normalize("toXPath",e)},getHashtagsInXPath:function(e){try{return new s.A.LogicExpression(e,this.xpath).getHashtags()}catch(e){return[]}},getLogicalXPath:function(e){var t=e,n=this;if(e=String(e),t&&n.richText&&function(e){if(!l.A.isInvalid(e))return!1;var t=l.A.unescapeHashtags(e,n);if(t)try{n.xpath.parse(t)}catch(t){if(/\bExpecting '.+', got 'LBRACK'$/.test(String(t)))return/`#[\w/]+`\s*\[.+\]/.test(e)}return!1}(e)){e=l.A.unescapeXPath(e,n);try{return n.xpath.parse(e),e}catch(e){}}return t},knownExternalReferences:function(){return this._logicManager.knownExternalReferences()},knownHashtagTransforms:function(){var e={},t=this.hashtagTransformations;return a.Ay.isEmpty(this.hashtagTransformations)||(e.prefixes=a.Ay.object(a.Ay.map(t,(function(e,t){return[t,e("")]})))),e},referenceHashtag:function(e,t,n){this.hasValidHashtagPrefix(e)&&(this.referenceInstance("casedb",t,n),this.referenceInstance("commcaresession",t,n))},dataTree:function(){var e=this.getBasePath().slice(1,-1),t=new o.A(e,"data"),n={},i=this;return this.tree.walk((function(e,a,i){if(e){if(e.options.isControlOnly)return;if(e.p.dataParent){var r=e.p.dataParent;n[r]?n[r].push(e):n[r]=[e]}else t.insertMug(e,"into",e.parentMug)}i()})),a.Ay.each(n,(function(e,n){for(var a=i.mugMap[i.normalizeHashtag(n)],r=0,o=e.length;r<o;r++)t.insertMug(e[r],"into",a)})),t},getBasePath:function(e){return"/"+this.tree.getRootNode().getID()+(e?"":"/")},fireChange:function(e){this.fire({type:"change",mug:e})},addInstanceIfNotExists:function(e,t,n){var i;if(e.src){if(!(i=a.Ay.find(this.instanceMetadata,(function(t){return t.attributes.src===e.src})))){var r=a.Ay.indexBy(this.instanceMetadata,(function(e){return e.attributes.id}));(i=e.id&&r.hasOwnProperty(e.id)?r[e.id]:null)&&i.internal?(i.internal=!1,i.attributes.src=e.src):((e=a.Ay.clone(e)).id=function(e,t){for(var n=(e||"data")+"-",a=1;!e||t.hasOwnProperty(e);)e=n+a,a++;return e}(e.id,r),i=null),this.knownInstances[e.id]={src:e.src}}}else{if(!e.id)throw new Error("unsupported: non-primary instance without id or src");(i=a.Ay.find(this.instanceMetadata,(function(t){return t.attributes.id===e.id})))?i.internal&&this.knownInstances.hasOwnProperty(e.id)&&(i.internal=!1,i.attributes.src=this.knownInstances[e.id].src):this.knownInstances.hasOwnProperty(e.id)&&a.Ay.defaults(e,this.knownInstances[e.id])}return i?(this.enableInstanceRefCounting&&i.addReference(t,n),i.attributes.id):(i=E({src:e.src,id:e.id},e.children,t||null,n),e.src||e.children||(i.internal=!0),this.instanceMetadata.push(i),e.id)},parseInstance:function(e,t,n){var i=e.match(D),r=null;if(i){var o=i[3],s=this.referenceInstance(o,t,n);s&&(r=a.Ay.clone(s.attributes))}return r},parseInstanceRefs:function(e,t,n){var i=new s.A.LogicExpression(e,this.xpath),o=this.knownInstances,l={};return i.analyze(),a.Ay.each(i.instanceRefs,(function(e,t){o.hasOwnProperty(t)&&o[t]&&(l[t]=f.A.extend(o[t]),l[t].children&&(l[t].children=r()("<div>").append(l[t].children).html()))})),l},referenceInstance:function(e,t,n){function i(t){return t.attributes.id===e}var r=a.Ay.find(this.instanceMetadata,i);return this.enableInstanceRefCounting&&(r?r.addReference(t,n):(e=this.addInstanceIfNotExists({id:e},t,n),r=a.Ay.find(this.instanceMetadata,i))),r||null},updateInstanceQuery:function(e,t,n){var a=D;return n&&(a=new RegExp("(^|\\W)instance\\((['\"])"+RegExp.escape(n)+"\\2\\)","ig")),e.replace(a,"$1instance('"+t+"')")},updateKnownInstances:function(e){var t=this.knownInstances;if(e){var n=a.Ay.indexBy(this.instanceMetadata,(function(e){return e.attributes.id}));a.Ay.each(e,(function(e,i){if(e&&!t.hasOwnProperty(i)){e.children?t[i]={children:r()(e.children)}:a.Ay.isString(e)?t[i]={src:e}:t[i]=e;var o=n[i];o&&o.internal&&(o.internal=!1,o.attributes.src=t[i].src)}}))}else a.Ay.each(this.instanceMetadata,(function(e){e.attributes.id&&(e.attributes.src?t[e.attributes.id]={src:e.attributes.src}:e.children&&(t[e.attributes.id]={children:e.children}))}))},dropInstanceReference:function(e,t,n){if(!this.enableInstanceRefCounting||!t)return!1;var i=a.Ay.find(this.instanceMetadata,(function(t){return t.attributes.src===e}));return!(!i||!i.dropReference(t,n)||(this.instanceMetadata=a.Ay.without(this.instanceMetadata,i),0))},dropAllInstanceReferences:function(e,t){this.instanceMetadata=a.Ay.filter(this.instanceMetadata,(function(n){return!n.dropReference(e,t)}))},addSetValue:function(e,t,n){var i=a.Ay.find(this.setValues,(function(n){return n.event===e&&n.ref===t}));return i?i.value=n:(i={_id:this._setValueId++,event:e,ref:t,value:n},this.setValues.push(i)),i},getSetValues:function(){return this.setValues},dropSetValues:function(e){this.setValues=a.Ay.reject(this.setValues,e)},setFormID:function(e){this.tree.setRootID(e),this.addHashtag("#form","/"+e)},setAttr:function(e,t){this[e]=t,"richText"===e&&t&&!this.hasCaseHashtags&&this._updateHashtags(),this.fire({type:"change"})},createXML:function(e){return S(this,e)},getMugList:function(){return this.tree.treeMap((function(e){if(!e.isRootNode)return e.getValue()}))},updateError:function(e){var t,n;if((n={}).message=(t=e).message,n.key=t.key,n.level=t.level||"form-warning",n.options=t,n.isMatch=function(e){return!(!this.key||!e.key)&&this.key===e.key},(e=n).key){for(var a=null,i=0;i<this.errors.length;i++)e.isMatch(this.errors[i])&&(a=this.errors.splice(i,1,e));a||this.errors.push(e)}else this.errors.push(e)},getSerializationWarnings:function(){var e=[];return this.walkMugs((function(t){var n=t.getSerializationWarnings();n.length&&e.push({mug:t,errors:n})})),e},fixSerializationWarnings:function(e){a.Ay.each(e||[],(function(e){e.mug.fixSerializationWarnings(e.errors)}))},isFormValid:function(e){return this.tree.isTreeValid(e)},findFirstMatchingChild:function(e,t){var n=e?this.tree.getNodeFromMug(e):this.tree.rootNode;return a.Ay.find(n.getChildrenMugs(),t)},insertMug:function(e,t,n){this.tree.insertMug(t,n,e)},moveMug:function(e,t,n){var a,i,r,o,s;if("rename"===t){if(a=n,!this.tree.getNodeFromMug(e))return void e.p.set("nodeID",a);i=e.p.nodeID,r=e.hashtagPath,o=s=e.parentMug}else{i=e.p.nodeID,r=e.hashtagPath,o=e.parentMug,this.insertMug(n,e,t);var l=e.spec.dataParent;l&&"pass"!==l.validationFunc(e)&&e.p.set("dataParent"),a=e.p.conflictedNodeId||i,s=e.parentMug}e.options.isControlOnly||(this.findFirstMatchingChild(s,(function(t){return t!==e&&t.p.nodeID===a}))?(e.p.conflictedNodeId=a,a=this.generate_question_id(a,e)):e.p.has("conflictedNodeId")&&(e.p.conflictedNodeId=null),e.p.nodeID!==a&&e.p.set("nodeID",a));var d=e.hashtagPath;this.vellum.handleMugRename(this,e,a,i,d,r,o),"rename"!==t&&this.fireChange(e)},walkMugs:function(e){this.tree.walk((function(t,n,a){null!==t&&e(t),a()}))},getDescendants:function(e){var t,n=this.getChildren(e);for(t=n.length-1;t>=0;t--)n=n.concat(this.getDescendants(n[t]));return n},handleMugRename:function(e,t,n,i,r,o){const s={};if(this._logicManager.updatePath(e.ufid,r,i),!i)return s;for(var l,d,u=this.getDescendants(e).concat([e]),c=(0,a.Ay)(u).map((function(e){return e.hashtagPath})),p=new RegExp("^"+RegExp.escape(i)+"/"),f=0;f<u.length;f++)c[f]&&(l=(d=c[f])===i?r:d.replace(p,r+"/"),s[u[f].ufid]=[l,c[f]],this._updateMugPath(u[f],l,c[f]));if(this._logicManager.updatePaths(s),this.fixBrokenReferences(),n&&"Choice"!==e.__className){var h=this.findFirstMatchingChild(o,(function(e){return e.p.conflictedNodeId===n}));h&&this.moveMug(h,"rename",n)}return s},changeMugType:function(e,t){this.mugTypes.changeType(e,t)},getChildren:function(e){var t=this.tree.getNodeFromMug(e);return(t?t.getChildren():[]).map((function(e){return e.getValue()}))},duplicateMug:function(e){var t=this._duplicateMug(e,e.parentMug),n=t[0],a=t[1];I().workflow("Form Builder","Copy",n.options.typeName);for(var i=0;i<a.length;i++){var r=a[i];this._logicManager.updatePath(r.mugId,r.from,r.to,n.hashtagPath)}return n},_duplicateMug:function(e,t,n){n=n||0;var a=this.mugTypes.make(e.__className,this,e);if(0===n){var i=e.p.nodeID;a.p.conflictedNodeId?a.p.conflictedNodeId=null:a.p.nodeID=this.generate_question_id(i,e),this.insertQuestion(a,e,"after",!0)}else this.insertQuestion(a,t,"into",!0);this.updateLogicReferences(a),this.vellum.duplicateMugProperties(a);for(var r=this.getChildren(e),o=[],s=0;s<r.length;s++)o=o.concat(this._duplicateMug(r[s],a,n+1)[1]);return o.push({mugId:e.ufid,from:e.hashtagPath,to:a.hashtagPath}),[a,o]},updateLogicReferences:function(e,t,n){this._logicManager.updateReferences(e,t,n)},shouldMugPropertyChange:function(e,t,n,a){return this.isLoadingXForm?function(){}:function(){e.fire({type:"property-changed",property:t,val:n,previous:a});var i={type:"mug-property-change",mug:e,property:t,val:n,previous:a};e.validate(t),this.fire(i),this.fireChange(e)}.bind(this)},createQuestion:function(e,t,n,a){var i=this.mugTypes.make(n,this);return a&&!i.options.isControlOnly&&(i.p.nodeID=this.generate_question_id()),"Choice"===i.__className&&(i.p.nodeID=""),this.insertQuestion(i,e,t,a),"Choice"===i.__className&&(i.dropMessage("labelItext","mug-labelItext-error"),i.dropMessage("nodeID","mug-nodeID-error")),i},insertQuestion:function(e,t,n,a){this.mugMap[e.ufid]=e,t=t||this.tree.getRootNode().getValue(),this.insertMug(t,e,n),this._updateMugPath(e),this.fire({type:"question-create",mug:e,refMug:t,position:n,isInternal:a}),a||e.options.afterInsert(this,e)},_updateMugPath:function(e,t,n){var i,r=this.mugMap;delete r[this.normalizeHashtag(t)],t&&this.removeHashtag(t),a.Ay.isUndefined(n)?(i=e.absolutePath,n=e.hashtagPath):(i=n.replace(/^#form/,this.getBasePath(!0)))===n&&(i=null),n&&(i&&this.addHashtag(n,i),r[this.normalizeHashtag(n)]=e)},_fixMugState:function(e){this.mugMap[e.ufid]=e;var t=e.absolutePath;t&&(this.addHashtag(e.hashtagPath,t),this.mugMap[this.normalizeHashtag(e.hashtagPath)]=e)},fixBrokenReferences:function(){var e=this.updateLogicReferences.bind(this);this._logicManager.forEachBrokenReference(e)},hasBrokenReferences:function(){return this._logicManager.hasBrokenReferences()},isReferencedByOtherMugs:function(e,t){var n=a.Ay.object(a.Ay.map(t,(function(e){return[e.ufid,null]})));return n[e.ufid]=null,this._logicManager.hasReferencingMug(e,(function(e){return!n.hasOwnProperty(e.ufid)}))},getAbsolutePath:function(e,t){return e&&!e.options.isControlOnly?this.tree.getAbsolutePath(e,t):null},getMugByUFID:function(e){return this.mugMap[e]},getMugByPath:function(e){return e?this.mugMap[this.normalizeHashtag(e)]:null},getIconByPath:function(e){var t=this.getMugByPath(e);return t?t.getIcon():null},removeMugsFromForm:function(e){var t=this,n={},i={};this.undomanager.resetUndo(),t._addToUndoManager(e),a.Ay.each(e,(function(e){t._removeMugFromForm(e,i,!1)})),this._logicManager.forEachReferencingProperty(i,(function(e,a){e&&!n.hasOwnProperty(e.ufid+" "+a)&&(n[e.ufid+" "+a]=null,t.updateLogicReferences(e,a))}))},_addToUndoManager:function(e){var t=this.tree,n={},i=[];a.Ay.each(e,(function e(a){if(!n.hasOwnProperty(a.ufid)){n[a.ufid]=null;var r=t.getNodeFromMug(a),o=a.parentMug,s=a.previousSibling,l=s===o?"first":"after";if(i.push([a,s,l]),r){var d=r.getChildrenMugs();d.length;for(var u=0;u<d.length;u++)e(d[u])}}})),this.undomanager.setUndo(i)},_removeMugFromForm:function(e,t,n){if(t.hasOwnProperty(e.ufid))return;t[e.ufid]=null;var i=this.tree.getNodeFromMug(e);const r=e.absolutePath;if(i){for(var o=i.getChildrenMugs(),s=0;s<o.length;s++)this._removeMugFromForm(o[s],t,!0);delete this.mugMap[this.normalizeHashtag(e.hashtagPath)],this.tree.removeMug(e)}this.enableInstanceRefCounting&&(this.instanceMetadata=a.Ay.filter(this.instanceMetadata,(function(t){return!t.dropReference(e)}))),this._logicManager.clearReferences(e),delete this.mugMap[e.ufid],this.fire({type:"question-remove",mug:e,absolutePath:r,isInternal:n})},isUniqueQuestionId:function(e,t){var n;if(t){var i=this.tree.getNodeFromMug(t);n=this.tree.getParentNode(i).getChildrenMugs()}else n=this.getMugList();return!a.Ay.any(n,(function(t){return t.p.nodeID===e}))},generate_question_id:function(e,t){if(!e)return this._make_label(t&&"Choice"===t.__className?"choice":"question",t);var n=/^copy-(\d+)-of-(.+)$/.exec(e);n&&(e=n[2]);for(var a=e,i=1;;i++){if(this.isUniqueQuestionId(a,t))return a;a="copy-"+i+"-of-"+e}},generate_item_label:function(e,t,n){var i,r=(e?this.tree.getNodeFromMug(e):this.tree.rootNode).getChildrenMugs();t||(t="choice"),arguments.length<3&&(n=r.length+1);do{i=t+n++}while(a.Ay.any(r,(function(e){return e.p.nodeID===i})));return i},_make_label:function(e,t){var n;do{n=e+this.question_counter,this.question_counter+=1}while(!this.isUniqueQuestionId(n,t));return n},getExportTSV:function(){this.vellum.beforeSerialize();var e=N.generateExportTSV(this);return this.vellum.afterSerialize(),e},undo:function(){this.undomanager.undo(),this.fixBrokenReferences(),this.vellum.selectSomethingOrHideProperties()},findUsages:function(e){return this._logicManager.findUsages(e)}};const L={Form:O,InstanceMetadata:E};var q=n(7229);function F(e){return a.Ay.chain(r()(e)[0].attributes).map((function(e){return[e.nodeName,e.nodeValue]})).object().value()}function V(e){var t=function(t,n){return t?n.changeMugType(t,e):t=n.mugTypes.make(e,n),t};return t.type=e,t}function j(e){var t=function(t,n){return n.mugTypes.make(e,n)};return t.type=e,t.ignoreDataNode=!0,t}function B(e,t){if(!e)return t;var n=e.toLowerCase().replace(/\s/g,"");return"false()"!==n&&(!!n||t)}function z(e,t,n,a){if(!e)return null;var i,r,o=X(t,e,"ref",a),s=t.tree.getRootNode().getID();if(o||(o=X(t,e,"nodeset",a)),o||(i=X(t,e,"bind",a))&&(r=U(i,s,t),t.getMugByPath(r)?o=r:t.parseWarnings.push(gettext("Ambiguous bind:")+" "+i)),(o=o||i||null)&&"/"!==o[0]&&"#"!==o[0]&&"`"!==o[0])if(n){var l=n.hashtagPath;l&&(o=l+"/"+o)}else o=t.getBasePath()+o;return o}function U(e,t,n){var a;try{a=n.xpath.parse(e)}catch(t){return e}return a instanceof n.xpath.models.XPathPathExpr||a instanceof n.xpath.models.HashtagExpr?(a.initial_context===n.xpath.models.XPathInitialContextEnum.RELATIVE&&(a.steps.splice(0,0,n.xpath.models.XPathStep({axis:"child",test:t})),a.initial_context=n.xpath.models.XPathInitialContextEnum.ROOT),a.toHashtag()):e}function X(e,t,n,a){var i=(a?t.xmlAttr:t.popAttr).bind(t),r=i("vellum:"+n.replace(/:/g,"__")),o=i(n);return e.inferHashtagMeanings(r,o),e.normalizeHashtag(e.richText&&r?r:o)}const H={init:function(e){var t,n,a,i,r,o=e.data.core;o.controlNodeAdaptorMap=(t={string:V("Text"),long:V("Long"),int:V("Int"),double:V("Double"),date:V("Date"),datetime:V("DateTime"),time:V("Time"),geopoint:V("Geopoint"),barcode:V("Barcode"),intent:V("AndroidIntent")},n=V("Select"),a=j("Choice"),i=V("Trigger"),r=function(e){return function(t,n){return(t=i(t,n)).p.appearance=e,t}},{secret:function(){return V("Secret")},select:function(){return V("MSelect")},select1:function(){return n},trigger:function(e,t){return r(t)},input:function(e,n){return"true()"===e.popAttr("readonly")?r(n):function(e,a){var i=e&&e.p.rawBindAttributes&&e.p.rawBindAttributes.type;if(i){if(i=(i=i.replace("xsd:","")).toLowerCase(),t.hasOwnProperty(i))return delete e.p.rawBindAttributes.type,"string"===i&&"numeric"===n?V("PhoneNumber")(e,a):t[i](e,a);if("micro-image"===n&&a.vellum.opts().features.case_micro_image)return V("MicroImage")(e,a)}return t.string(e,a)}},item:function(e){var t=function(t,n){return(t=a(t,n)).p.nodeID=e.children("value").text(),t};return t.type=a.type,t.ignoreDataNode=!0,t},group:function(e,t,n,a){var i;if("field-list"===t)i="FieldList";else{var r=e.children("repeat");if(1===r.length){var o=function(e,t){return(e=V("Repeat")(e,t)).p.repeat_count=X(t,r,"jr:count")||null,e.p.rawRepeatAttributes=F(r),e};return o.repeat=r,o.path=z(r,n,a),o.type="Repeat",o}i="Group"}return V(i)},upload:function(e,t,n,a){var i,r=e.popAttr("mediatype");if(!r)throw"Unable to parse binary question type. The question has no MediaType attribute assigned to it!";if("video/*"===(r=r.toLowerCase()))i="Video";else if("image/*"===r)i="signature"===t?"Signature":"Image";else if("audio/*"===r)i="Audio";else{if("application/*,text/*"!==r)throw"Unrecognized upload question type for Element: "+z(e,n,a);i="Document"}return V(i)}}),e.updateControlNodeAdaptorMap(o.controlNodeAdaptorMap)},parseXForm:function(e,t,n,i,o){var s=L.InstanceMetadata,l=new(0,L.Form)(t,n,t.mugTypes);if(l.parseErrors=[],l.parseWarnings=i,l.isLoadingXForm=!0,!e)return n.performAdditionalParsing(l,null,o),l.isLoadingXForm=!1,l;var d=f.A.parseXML(e),u=d.find("h\\:xdoc"),c=d.find(":root > h\\:head, :root > head"),p=c.children("h\\:title, title"),h=c.find("bind"),g=function(e){for(var t=e.find("instance"),n=!1,a=[],i=0;i<t.length;i++)if(r()(t[i]).xmlAttr("id"))a.push(t[i]);else{if(n)throw"multiple unnamed instance elements found in the form! this is not allowed. please add id's to all but 1 instance.";a.splice(0,0,t[i]),n=!0}return a}(d),m=r()(g[0]).children(),v=c.find("> model > setvalue");if(d.find("parsererror").length>0)throw gettext("PARSE ERROR!:")+d.find("parsererror").find("div").html();u.length||(u=c.parent());var y,x=u.xmlAttr("vellum:ignore");if(x=x?x.split(" "):[],a.Ay.contains(x,"richText")&&(l.richText=!1),a.Ay.contains(x,"markdown")&&(l.noMarkdown=!0),l.instanceMetadata=g.map((function(e){return s(F(e),r()(e).children())})),l.updateKnownInstances(),l.richText&&!l.vellum.datasources.isReady()&&function(e,t,n){try{t=JSON.parse(r().trim(t.text()))}catch(e){t={}}try{n=JSON.parse(r().trim(n.text())).prefixes||{}}catch(e){n={}}a.Ay.isEmpty(n)||(e.hashtagTransformations=a.Ay.object(a.Ay.map(n,(function(e,t){return[t,function(t){return e+t}]})))),a.Ay.each(t,(function(t,a){e.initHashtag(a,function(e,t){if(!t){var a=/(#.+\/)([^\/]+)/.exec(e);if(a&&n.hasOwnProperty(a[1]))return n[a[1]]+a[2]}return t}(a,t))})),e.shouldInferHashtags=a.Ay.some(e.hashtagMap,(function(e){return null===e}))}(l,c.children("vellum\\:hashtags, hashtags"),c.children("vellum\\:hashtagTransforms, hashtagTransforms")),0===m.length&&l.parseErrors.push(gettext("No Data block was found in the form. Please check that your form is valid!")),function(e,t,n){var a,i=r()(t),o=e.tree;a=function(t){var n=e.vellum.parseDataElement(e,this,t),i=n.options.parseDataNode(n,r()(this),t);o.insertMug(n,"into",t),e._fixMugState(n),i.each((function(){a.call(this,n)}))},i[0]?e.setFormID(i[0].tagName):e.setFormID("data"),i.children().each((function(){a.call(this,null)})),e.formUuid=i.xmlAttr("xmlns"),e.formJRM=i.xmlAttr("xmlns:jrm"),e.formUIVersion=i.xmlAttr("uiVersion"),e.formVersion=i.xmlAttr("version");var s=e.vellum.opts().core.formName||i.xmlAttr("name")||n;s?e.formName=s:e.parseWarnings.push(gettext("Form does not have a Name! The default form name will be used")),e.formUuid&&"undefined"!==e.formUuid||(e.formUuid="http://openrosa.org/formdesigner/"+f.A.generate_xmlns_uuid()),e.formJRM||e.parseWarnings.push(gettext("Form JRM namespace attribute was not found in data block. One will be added automatically")),e.formUIVersion||e.parseWarnings.push(gettext("Form does not have a UIVersion attribute, one will be generated automatically")),e.formVersion||e.parseWarnings.push(gettext("Form does not have a Version attribute (in the data block), one will be added automatically"))}(l,m[0],p.length?p.text():""),function(e,t){var n=e.tree.getRootNode().getID();t.each((function(){var t=r()(this),a=X(e,t,"nodeset")||X(e,t,"ref");e.vellum.parseBindElement(e,t,U(a,n,e))}))}(l,h),function(e,t){var n=e.tree.getRootNode().getID();t.each((function(){var t=r()(this);e.vellum.parseSetValue(e,t,U(X(e,t,"ref",!0),n,e))}))}(l,v),function(e,t){function n(e){return e.value.ufid}function i(t,o){for(var s=function(e){var t=0,n=e.length;return function(){return t<n?e[t++]:null}}(t.children),l=function(t,n){var o=0,s=t.length;return function(){if(o>=s)return null;var l=r()(t[o++]),d=function(e,t,n){var i,r=t[0].nodeName.toLowerCase(),o=t.popAttr("appearance"),s=null,l=e.vellum.getControlNodeAdaptorFactory(r);if(l&&(i=l(t,o,e,n)),i||(i=function(e){var t=function(t,n){return t=V("ReadOnly")(t,n),1===e.length&&e[0].poppedAttributes&&a.Ay.each(e[0].poppedAttributes,(function(t,n){e.xmlAttr(n,t)})),t.p.rawControlXML=e,t};return t.skipPopulate=!0,t}(t)),!i.ignoreDataNode){var d=i.path;d||(d=z(t,e,n)),s=e.getMugByPath(d)}s=i(s,e);var u=e.tree.getNodeFromMug(s);if(u){if(u.parent.value!==n){var c=u.parent,p=u.parent.value;s.p.dataParent=c.isRootNode?"#form":p.hashtagPath,u=e.tree.insertMug(s,"into",n)}}else s.options.isControlOnly=!0,u=e.tree.insertMug(s,"into",n),e.mugMap[s.ufid]=s;return o&&(s.p.appearance=o),i.skipPopulate||(e.vellum.populateControlMug(s,t),s.p.rawControlAttributes=F(t)),u}(e,l,n),u=d.value;return u.options.controlNodeChildren&&i(d,u.options.controlNodeChildren(l)),d}}(o,t.value),d=s(),u=l(),c=[],p={},f=!1;u;)d?(d===u&&(c.push(u),u=l()),p[n(d)]=null,d=s()):(f=f||p.hasOwnProperty(n(u)),c.push(u),u=l());f&&(t.children=a.Ay.union(c,t.children))}i(e.tree.getRootNode(),t)}(l,d.find(":root > h\\:body, :root > body").children()),l.parseErrors)for(y=0;y<l.parseErrors.length;y++)l.updateError({level:"error",message:l.parseErrors[y]});if(l.parseWarnings)for(y=0;y<l.parseWarnings.length;y++)l.updateError({level:"parse-warning",message:l.parseWarnings[y]});return n.performAdditionalParsing(l,d,o),l.isLoadingXForm=!1,l},parseDataElement:function(e,t,n,a){var i=r()(t),o=t.nodeName,s=i.children().length?null:i.text(),l=i.popAttr("xmlns")||null,d=i.popAttr("vellum:comment")||null;(a=a||i.xmlAttr("vellum:role"))&&e.mugTypes.allTypes.hasOwnProperty(a)&&e.mugTypes.allTypes[a].supportsDataNodeRole?i.popAttr("vellum:role"):a="DataBindOnly";var u=e.mugTypes.make(a,e);return u.p.nodeID=o,u.__originalNodeID=o,u.p.dataValue=s||void 0,l&&l!==e.formUuid&&(u.p.xmlnsAttr=l),d&&(u.p.comment=d),u.p.rawDataAttributes=F(t),u},parseBindElement:function(e,t,n){var a=e.getMugByPath(n);if(a){var i,r,o=t.popAttr("required"),s={relevantAttr:X(e,t,"relevant"),calculateAttr:X(e,t,"calculate"),constraintAttr:X(e,t,"constraint"),constraintMsgAttr:(i=t,r="constraintMsg",i.popAttr("jr:"+r)||i.popAttr("jr\\:"+r)||null),requiredAttr:B(o),requiredCondition:X(e,t,"requiredCondition")||("true()"!==o&&"false()"!==o?o:void 0)},l=s.rawBindAttributes=F(t);l.type&&"xsd:integer"===l.type.toLowerCase()&&(l.type="xsd:int"),a.p.setAttrs(s)}else e.parseWarnings.push(f.A.format(gettext("Bind Node [{path}] found but has no associated Data node. This bind node will be discarded!"),{path:n}))},parseSetValue:function(e,t,n){var a=e.getMugByPath(n),i=t.xmlAttr("event"),r=X(e,t,"ref",!0),o=X(e,t,"value",!0);!a||"xforms-ready"!==i&&"jr-insert"!==i?e.addSetValue(i,r,o):a.p.defaultValue=o},populateControlMug:function(e,t){var n=t.children("label"),a=t.children("hint"),i=t.popAttr("jr:imageDimensionScaledMax");if(n.length&&"notallowed"!==e.getPresence("label")){var r=q.A.humanize(n);r&&(e.p.label=r)}a.length&&"notallowed"!==e.getPresence("hintLabel")&&(e.p.hintLabel=q.A.humanize(a)),"Image"===e.__className&&(e.p.imageSize=i?parseInt(i):"")},getAttributes:F,getPathFromControlElement:z,makeControlOnlyMugAdaptor:j,makeMugAdaptor:V}},4459:(e,t,n)=>{"use strict";n.d(t,{A:()=>V});var a=n(4523),i=n(561),r=n.n(i),o=n(8654),s=n.n(o),l=n(6990),d=n.n(l),u=n(9832),c=n(8916),p=n(4854),f=n(9659),h=n(7229),g=n(3578),m=n.n(g),v=n(7512),y=n(705),x=/^#form\//,b="#invalid/xpath ",A="â€‹";function w(e){const t=(new DOMParser).parseFromString(e,"text/html"),n=document.createDocumentFragment();return Array.from(t.body.childNodes).forEach((e=>{"SPAN"===e.tagName&&(e.contentEditable=!1),n.appendChild(e)})),n}function M(e,t,n){function a(e){var t=0,n=Array.from(e.childNodes),i=n.length,r=null;return function e(){var o;if(r){if(null!==(o=r()))return o;if(r=null,n[t-1]&&"p"===n[t-1].nodeName.toLowerCase())return{node:n[t-1],length:1,isText:!1}}if(t>=i)return null;if(o=n[t],t++,o.nodeType===Node.ELEMENT_NODE){var s=o.nodeName.toLowerCase();if("p"===s)return r=a(o),e();if("span"===s||"br"===s)return{node:o,length:1,isText:!1};throw new Error("not implemented: "+s)}if(o.nodeType===Node.TEXT_NODE)return{node:o,length:o.textContent.length,isText:!0};throw new Error("unhandled element type: "+o.nodeType)}}function i(e,t){for(var n=e,a=t();a;){if(a.length>=n)return{node:a.node,offset:n,isText:a.isText};n-=a.length,a=t()}throw new Error("index is larger than content: "+e)}e.focus();var r=window.getSelection(),o=a(e),s=i(t,o),l=document.createRange();s.isText?l.setStart(s.node,s.offset):l.setStartAfter(s.node),n?(s=i(t+n,o=a(e))).isText?l.setEnd(s.node,s.offset):l.setEndAfter(s.node):l.collapse(!0),r.removeAllRanges(),r.addRange(l)}var _={dateFormat:{serialize:function(e,t){return a.Ay.template("format-date(date(<%=xpath%>), '<%=dateFormat%>')")({xpath:e,dateFormat:t.dateFormat})}},value:{serialize:function(e){return a.Ay.template('&lt;output value="<%=xpath%>" /&gt;')({xpath:e})}}},C=["dateFormat","value"];function I(e){var t=e.value;return a.Ay.each(C,(function(n){e[n]&&(t=_[n].serialize(t,e))})),t}function k(e,t){var n,a,i,o,s,l,d=function(e,t){if(!x.test(e)){if(t.isValidHashtag(e))return{classes:["label-datanode-external","fcc fcc-fd-case-property"]};if(t.hasValidHashtagPrefix(t.normalizeHashtag(e)))return{classes:["label-datanode-external-unknown","fa-solid fa-triangle-exclamation"]}}var n=t.getIconByPath(e);return n?{classes:["label-datanode-internal",n]}:{classes:["label-datanode-unknown","fcc fcc-help"]}}(t,e),u=d.classes[0],c=d.classes[1],f=(n=t,a=e.xpath,s=(o=new p.A.LogicExpression(n,a)).getTopLevelPaths(),l=o.getHashtags(),s.length?(i=s[0].steps)[i.length-1].name:(i=l[0].toHashtag().split("/"))[i.length-1]),h=r()("<i>").addClass(c).html("&nbsp;"),g="bubble-"+Math.random().toString(36).slice(2,10);return r()("<span>").addClass("label label-datanode "+u).attr("data-value",t).attr("contenteditable","false").attr("data-toggle","popover").attr("id",g).append(h).append(f)}function P(e,t){var n=O(r()(t)),i=e.normalizeHashtag(n.value,!0),o=a.Ay.omit(n,"value"),s=i&&(x.test(i)||e.hasValidHashtagPrefix(i)),l=/\s/.test(i);return!s||s&&l?r()("<span>").text(h.A.normalize(t)).html():r()("<div>").append(document.createTextNode(A)).append(k(e,i).attr(o)).append(document.createTextNode(A)).html()}function T(e,t,n){var a,i,r=h.A.xhtml(e),o={};return a=n?function(){var e=f.A.get_guid();return o[e]=P(t,this),"{"+e+"}"}:function(){return P(t,this)},r.find("output").replaceWith(a),i=r.html(),n&&(i=S(i,o)),i}function S(e,t){return(e=r()("<div />").text(h.A.humanize(e)).html()).replace(/{(.+?)}/g,(function(e,n){return t.hasOwnProperty(n)?r()("<div>").append(t[n]).html():e}))}function N(e,t){var n;return E(e)?(e=e.slice(15),n=c.A.transform):n=t.transformHashtags,n(e,(function(e){return k(t,e).prop("outerHTML")}),!0)}function E(e){return e.startsWith(b)}function D(e,t,n){return e?function(e){return"<p>"+(e=e.replace(/\n/g,"</p><p>").replace(/  /g," &nbsp;"))+"</p>"}(((n=n||{}).isExpression?N:T)(e,t)):""}function R(e,t,n){return function(e,t,n){var a,i,o,s=h.A.xhtml(e),l={},d=s.find(".label-datanode");if(!d.length)return s.text();if(a=n?function(){var e=f.A.get_guid();return l[e]=r()(this).data("value"),"{"+e+"}"}:function(){return I(r()(this).data())},d.replaceWith(a),i=s.text(),n){o=i.replace(/{(.+?)}([\w.\-]?)/g,(function(e,t,n){return l.hasOwnProperty(t)?l[t]+(n?" "+n:""):e}));try{t.xpath.parse(o)}catch(e){o=b+c.A.escapeDelimiters(i).replace(/{(.+?)}/g,(function(e,t){return l.hasOwnProperty(t)?c.A.delimit(l[t]):e}))}i=o}return i}(function(e){return e.replace(/<p>&nbsp;<\/p>/gi,"\n").replace(/<div>/gi,"\n").replace(/<p>/gi,"").replace(/<\/p>/gi,"\n").replace(/<br \/>/gi,"\n").replace(/(&nbsp;|\xa0|\u2005)/gi," ").replace(/(\u200B)/gi,"").replace(/\n$/,"")}(e),t,n)}function O(e){var t=e.xmlAttr("vellum:value")||e.xmlAttr("value")||e.xmlAttr("ref"),n=/^format-date\(date\(([^)]+)\),\s*'([^']+)'\)$/.exec(t);return n?{value:n[1],"data-date-format":n[2]}:{value:t}}var L={Y:"yyyy",y:"yy",m:"mm",n:"m",b:"mmm",d:"dd",e:"d",H:"HH",h:"H",M:"MM",S:"SS",3:"msec",a:"ddd"};function q(e){return e?e.replace(/(%[YymnbdeHhMS3a])/g,(function(e,t){return L.hasOwnProperty(t[1])?L[t[1]]:t})):gettext("no formatting")}function F(e){var t,n,a=r()(e),i=a.closest(".form-control"),o=e.getAttribute("data-value"),l=y.A.util.getWidget(i);if(l){var c=x.test(o),p=e.textContent.trim(),g=l.mug.form.normalizeHashtag(o),v=f.A.escape(g),b=l.mug.form.getMugByPath(o),A=b&&b.p.labelItext?b.p.labelItext.get():"",w=b&&0===b.__className.indexOf("Date"),M=f.A.get_guid();b||(A=l.mug.form.vellum.datasources.getNode(g,{}).description||""),(A=h.A.xhtml(A)).find("output").replaceWith((function(){var e=O(r()(this)).value;return l.mug.form.normalizeHashtag(e)})),A=h.A.normalize(A),a.popover({trigger:"hover",container:"body",placement:"bottom",title:(t=v,n=a.attr("data-date-format"),(w||n)&&(t+=s()({guid:M,text:f.A.escape(q(n))})),"<h3>"+f.A.escape(p)+'</h3><div class="text-muted">'+t+"</div>"),html:!0,sanitize:!1,content:d()({text:A,ufid:b?b.ufid:""}),template:'<div contenteditable="false" class="popover rich-text-popover"><div class="popover-inner"><div class="popover-title"></div>'+(b||A?'<div class="popover-content"><p></p></div>':"")+"</div></div>",delay:{show:350,hide:200}}).on("shown.bs.popover",(function(){var e=c?"form":"case";if(m().fbUsage("Hovered over easy "+e+" reference"),m().workflow("Hovered over easy reference"),w||i.attr("data-date-format")){var t=r()(this).offset(),n=t.left,o=t.top+r()(this).height();r()("#"+M).click((function(){return a.popover("hide"),u.A.showMenu(n,o,(function(e){i.attr("data-date-format",e)}),!0),!1}))}})),e.classList.add("popover-initialized"),a.on("destroy",(function(e){try{a.popover("destroy")}catch(e){}}))}}const V={applyFormats:I,bubbleOutputs:T,sanitizeInput:function(e){if(!/<(?!output| )/g.test(e))return e;var t=h.A.xhtml(e),n={};return t.find("output").replaceWith((function(){var e=f.A.get_guid();return n[e]=this,"{"+e+"}"})),S(t.html(),n)},editor:function(e,t,n){var a=e[0];function i(e,t=!1){const n=document.activeElement===a;let i;if(!n&&p&&f){const t=document.elementFromPoint(p,f),n=t?t.closest(".label-datanode"):null;if(n)i=document.createRange(),i.setStartAfter(n),i.setEndAfter(n);else{const t=document.caretPositionFromPoint(p,f);if(t){i=document.createRange(),i.setStart(t.offsetNode,t.offset),i.collapse(!0);const n=t.offsetNode.parentNode;n&&"P"===n.tagName&&t.offsetNode.nodeType===Node.TEXT_NODE&&t.offset===t.offsetNode.nodeValue.length&&(e=e.replace(/^<p>/i,"").replace(/<\/p>$/i,""))}}}else n?i=window.getSelection().getRangeAt(0):(i=document.createRange(),i.selectNodeContents(a),i.collapse(!0));if(i){const n=window.getSelection();if(n.removeAllRanges(),n.addRange(i),i.deleteContents(),t){const e=document.createTextNode(A);i.insertNode(e),i.setStartAfter(e)}const r=w(e),o=[];if(r.childNodes.forEach((e=>{e.getAttribute&&e.getAttribute("data-toggle")&&o.push(e)})),i.insertNode(r),i.collapse(),t){const e=document.createTextNode("â€‹ ");i.insertNode(e),i.collapse()}o.forEach((e=>{F(e)})),a.focus();const s=new Event("input",{bubbles:!0,cancelable:!0});a.dispatchEvent(s),d.push()}}n&&n.disableNativeSpellChecker?a.setAttribute("spellcheck",!1):a.setAttribute("spellcheck",!0),new MutationObserver((e=>{for(const t of e)"childList"===t.type&&t.removedNodes.forEach((e=>{1===e.nodeType&&e.hasAttribute("data-toggle")&&"popover"===e.getAttribute("data-toggle")&&r()(e).popover("hide")}))})).observe(a,{childList:!0,subtree:!0});var o=y.A.util.getWidget;function s(e,t,n=0){n<5&&(null!=o(r()(e))?t():setTimeout((()=>s(e,t,n+1)),500))}const l=e.data("editorWrapper");if(l)return l;const d=new v.A.ElementUndoStack(a);function u(e){const t=window.getSelection();if(!t.rangeCount)return;const n=t.getRangeAt(0);if(!n.collapsed)return;const a=n.startContainer,i=n.startOffset;if(a.nodeType===Node.TEXT_NODE){if(i===a.length&&a.nodeValue.endsWith(A)){const t=a.nextSibling;if(t&&"span"===t.nodeName.toLowerCase()&&"false"===t.contentEditable)if(39===e.keyCode){const e=t.nextSibling;e&&e.nodeType===Node.TEXT_NODE&&(n.setStart(e,1),n.collapse(!0))}else n.setStart(a,i-1),n.collapse(!0);else t||"true"!==a.parentNode.getAttribute("contenteditable")||(n.setStart(a,i-1),n.collapse(!0))}if(0===i&&a.nodeValue.startsWith(A)){const t=a.previousSibling;if(t&&"span"===t.nodeName.toLowerCase()&&"false"===t.contentEditable)if(37===e.keyCode){const e=t.previousSibling;n.setStart(e,e.nodeValue.length-1),n.collapse(!0)}else n.setStart(a,1),n.collapse(!0)}}}let p,f,h;if(a.addEventListener("keydown",(function(e){const t=e.key,n=e.ctrlKey,i=e.metaKey;"z"!==t&&"Z"!==t||!n&&!i||(e.preventDefault(),a.querySelectorAll('[data-toggle="popover"]').forEach((e=>{try{r()(e).popover("hide")}catch(e){}})),e.shiftKey?d.redo():d.undo(),a.querySelectorAll('[data-toggle="popover"]').forEach((e=>F(e))))})),a.addEventListener("mouseup",u),a.addEventListener("keyup",u),a.addEventListener("input",(function(e){const t=a.querySelectorAll('span[contenteditable="false"]'),n=[];t.forEach((e=>{const t=e.previousSibling,a=e.nextSibling,i=!t||t.nodeType!==Node.TEXT_NODE||!t.nodeValue.endsWith(A),r=!a||a.nodeType!==Node.TEXT_NODE||!a.nodeValue.startsWith(A);(i||r)&&n.push(e),a&&a.nodeType===Node.TEXT_NODE&&"true"===a.parentNode.getAttribute("contenteditable")&&a.parentNode.lastChild===a&&a.nodeValue===A&&n.push(e)})),n.forEach((e=>{const t=e.previousSibling,n=e.nextSibling;t&&t.nodeType===Node.TEXT_NODE&&t.nodeValue.endsWith(A)&&(t.nodeValue=t.nodeValue.slice(0,-1),0===t.length&&t.remove()),n&&n.nodeType===Node.TEXT_NODE&&n.nodeValue.startsWith(A)&&(n.parentNode.lastChild!==n||n.nodeValue!==A)&&(n.nodeValue=n.nodeValue.slice(1),0===n.length&&n.remove()),e.remove()})),d.push()})),a.addEventListener("mousemove",(e=>{p=e.clientX,f=e.clientY})),1===arguments.length)throw new Error("editor not initialized: "+r()("<div>").append(e).html());if(1!==e.length)throw new Error("input should reference exactly one element, got "+e.length);(n=n||{}).createPopover||t.vellum.opts().features.disable_popovers||(n.createPopover=F),e.promise=new Promise((e=>{h=e}));const g={getValue:function(i){if(!i)return R(a.innerHTML,t,n.isExpression);e.promise.then((function(){i(R(a.innerHTML))}))},setValue:function(e,i){var r=D(e,t,n);return a.innerHTML=r,a.querySelectorAll('span[contenteditable="false"]').forEach((e=>{const t=e.previousSibling,n=e.nextSibling;t&&t.nodeType===Node.TEXT_NODE&&t.nodeValue.endsWith(A)||e.parentNode.insertBefore(document.createTextNode(A),e),n&&n.nodeType===Node.TEXT_NODE&&n.nodeValue.startsWith(A)||e.parentNode.insertBefore(document.createTextNode(A),e.nextSibling)})),a.innerHTML+=A,d.push(),s(a,(()=>{a.querySelectorAll('[data-toggle="popover"]').forEach((e=>F(e)))})),i&&setTimeout(i,0),g},insertExpression:function(e){if(n.isExpression)i(N(e,t),!0);else{var a=k(t,e);i(r()("<p>").append(a).html(),!0)}return g},insertOutput:function(e){if(n.isExpression)throw new Error("cannot insert output into expression editor");return i(T(e,t)),g},change:function(){return g},focus:function(){a.focus()},select:function(e,t){return M.call(null,a,e,t),g},on:function(){var e=Array.prototype.slice.call(arguments);if(2===e.length&&"change"===e[0]&&"function"==typeof e[1]){const t=function(t){e[1].apply()};a.addEventListener("input",t),a.addEventListener("paste",t),a.addEventListener("cut",t)}return g},destroy:function(){null!==e&&(e.removeData("editorWrapper"),e=null)}};function m(e){e.preventDefault();const a=window.getSelection();let i="";if(a.rangeCount>0){const r=a.getRangeAt(0),o=document.createElement("div");o.appendChild(r.cloneContents()),i=R(o.innerHTML,t,n.isExpression),"cut"===e.type&&r.deleteContents(),E(i)&&(i=c.A.transform(i.slice(15),(function(e){return e})))}e.clipboardData&&e.clipboardData.setData("text/plain",i)}function x(e){if(window.getSelection){const t=window.getSelection();if(t.getRangeAt&&t.rangeCount){let n=t.getRangeAt(0);n.deleteContents();const i=document.createElement("div");i.innerHTML=e;const r=document.createDocumentFragment();let o,s;for(;o=i.firstChild;)s=r.appendChild(o);n.insertNode(r),s&&(n=n.cloneRange(),n.setStartAfter(s),n.collapse(!0),t.removeAllRanges(),t.addRange(n)),a.innerHTML.endsWith(A)||(a.innerHTML+=A)}}}return a.addEventListener("copy",m),a.addEventListener("cut",m),a.addEventListener("paste",(function(e){if(e.preventDefault(),e.clipboardData&&e.clipboardData.getData("text/plain")){const t=e.clipboardData.getData("text/plain"),n=document.createElement("div");n.textContent=t,x(n.innerHTML.replace(/\n/g,"<br />").replace(/  /g," &nbsp;"))}else if(e.clipboardData.getData("text/html")){let t=e.clipboardData.getData("text/html");const n=/<style[^>]*>.*?<\/style>/g;let a;do{a=t,t=t.replace(n,"")}while(t!==a);x(t)}})),a.addEventListener("focus",(function(){const e=a.lastChild;if(e&&e.length>0){const t=window.getSelection(),n=document.createRange();n.setStart(e,e.length-1),n.collapse(!0),t.removeAllRanges(),t.addRange(n)}})),e.data("editorWrapper",g),h(),g},htmlToFragment:w,fromRichText:R,toRichText:D,isInvalid:E,unescapeXPath:function(e,t){return E(e)&&(e=c.A.transform(e.slice(15),t.normalizeXPath.bind(t))),e},unescapeHashtags:function(e,t){return E(e)&&(e=c.A.transform(e.slice(15),t.normalizeHashtag.bind(t))),e}}},4872:(e,t,n)=>{const a=n(3946);e.exports=a.template('<ul class="dropdown-menu multi-level" role="menu">\n    <% _.each(groups, function(group) { %>\n        <% if (group.questions.length > 1) { %>\n            <li class="dropdown-submenu">\n                <a tabindex="-1" class="fd-question-type" data-qtype="<%= group.defaultQuestion.slug %>">\n                    <i class="<%= group.defaultQuestion.icon %>"></i>\n                    <%= group.name %>\n                </a>\n                <ul class="dropdown-menu">\n        <% } %>\n                    <% _.each(group.questions, function(question) { %>\n                        <li>\n                            <a tabindex="-1" class="fd-question-type" data-qtype="<%= question.slug %>">\n                                <i class="<%= question.icon %>"></i> <%= question.name %>\n                            </a>\n                        </li>\n                    <% }) %>\n        <% if (group.questions.length > 1) { %>\n                </ul>\n            </li>\n        <% } %>\n    <% }); %>\n</ul>\n')},7356:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="alert alert-block <%=messageType.cssClass%>">\n    <button type="button" class="close" data-dismiss="alert">&times;</button>\n    <h4><% if (messageType.icon) { %><i class="<%=messageType.icon%>"></i> <% } %><%=messageType.title%></h4>\n    <ul>\n        <% _.each(messages, function (message) { %>\n        <li><%-message%></li>\n        <% }); %>\n    </ul>\n</div>\n')},7724:(e,t,n)=>{const a=n(3946);e.exports=a.template('<li>\n  <i class="<%= icon %>"></i> <%= displayPath %>\n    <% if (displayLabel) { %>\n      <br />\n      <span class="atwho-jrtext"><%= displayLabel %></span>\n    <% } %>\n</li>,\n')},4489:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-itextID-checkbox-container col-sm-1">\n    <label class="checkbox">\n        \x3c!-- checkbox goes here --\x3e\n        <%-gettext("auto?")%>\n    </label>\n</div>\n')},7207:(e,t,n)=>{const a=n(3946);e.exports=a.template('<button type="button" class="btn btn-danger"><i class="fa fa-remove"></i></button>\n')},7444:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-commander">\n    <i class="fa-solid fa-xmark fd-commander-close"></i>\n    <input type="text" class="form-control" placeholder="<%-gettext(\'Enter command\')%>" />\n</div>\n')},516:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-source-container">\n    <p>\n        <%=description%>\n    </p>\n    <div id="form-differences">\n      <pre><%=xmldiff%></pre>\n    </div>\n</div>\n')},9443:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="form-group">\n    <label class="control-label col-sm-3"><div><%=label%></div></label>\n    <div class="controls col-sm-9"></div>\n</div>\n')},7133:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="form-group">\n    <label class="control-label col-sm-3">\n        <%=label%>\n    </label>\n    <div class="col-sm-9">\n        <input type="<%=type%>"<% if (type === \'text\') { %> class="form-control"<% } %> />\n    </div>\n</div>\n')},23:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-copy-paste-help">\n    <h3><%-gettext("Copying and Pasting Questions")%></h3>\n    <div class="copy-paste-help">\n        <%-gettext("These actions are available via the browser\'s Edit menu, and you can also use:")%>\n        <div class="row">\n            <div class="col-sm-3">\n                <h1><%=metachar%>C</h1>\n                <span><%-gettext("for copy")%></span>\n            </div>\n            \x3c!--div class="col-sm-3">\n                <h1><%=metachar%>X</h1>\n                <span>for cut</span>\n            </div--\x3e\n            <div class="col-sm-3">\n                <h1><%=metachar%>V</h1>\n                <span><%-gettext("for paste")%></span>\n            </div>\n        </div>\n    </div>\n    <div class="copy-paste-box hide">\n        <p><%-gettext("Copy from or Paste into this text box:")%> <textarea></textarea></p>\n        <p><button class="btn btn-default insert-questions"><%-gettext("Insert Questions")%></button></p>\n    </div>\n    <h3><%-gettext("Selecting Multiple Questions")%></h3>\n    <div class="row">\n        <%\n            var key = metachar.endsWith("+") ? metachar.slice(0, -1) : metachar;\n            key = "<strong>" + key + "</strong>";\n            print(format(gettext("Hold {key} and click on each question."), {key: key}));\n        %>\n    </div>\n    <h3><%-gettext("Other Tips")%></h3>\n    <p><%-gettext("Questions can be copied between forms, and even to other apps.")%></p>\n</div>\n')},9740:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-data-source-editor-container form form-horizontal">\n\n    <fieldset class="data-source-advanced">\n        <legend>\n            <i class="fa fa-cog"></i> <%-gettext("Edit Data Source")%>\n        </legend>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Query Expression")%>\n            </label>\n            <div class="col-sm-10">\n                <textarea rows="5"\n                          name="query"\n                          class="form-control fd-data-source-query jstree-drop"></textarea>\n                <p class="help-block">\n                    <a target="_blank"\n                       href="https://help.commcarehq.org/display/commcarepublic/Common+Logic+and+Calculations">\n                        <i class="fa fa-info-circle"></i> <%-gettext("Guide to Common Logic and Calculations")%>\n                    </a>\n                </p>\n            </div>\n        </div>\n        <legend><%-gettext("Optional Instance Properties")%></legend>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Instance ID")%>\n            </label>\n            <div class="col-sm-10">\n                <input name="instance-id" type="text" class="form-control jstree-drop" />\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("Instance URI")%>\n            </label>\n            <div class="col-sm-10">\n                <input name="instance-src" type="text" class="form-control jstree-drop" />\n            </div>\n        </div>\n    </fieldset>\n\n    <div class="form-actions form-actions-condensed fd-data-source-actions">\n        <div class="col-sm-2"></div>\n        <div class="col-sm-10">\n            <button type="button" class="btn btn-primary fd-data-source-save-button"><%-gettext("Save")%></button>\n            <button type="button" class="btn btn-default fd-data-source-cancel-button"><%-gettext("Cancel")%></button>\n        </div>\n    </div>\n    </div>\n</div>\n')},3436:(e,t,n)=>{const a=n(3946);e.exports=a.template('<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">\n    <li style="padding-left: 10px;"><strong><%-gettext("Date Format Options")%></strong></li>\n    <% _.each(formats, function (label, format) { %>\n        <li><a tabindex="-1" data-format="<%= format %>"><%= label %></a></li>\n    <% }); %>\n</ul>\n')},8654:(e,t,n)=>{const a=n(3946);e.exports=a.template(' (<a class="jstree-hover" id="<%= guid %>"><%= text %></a>)')},6990:(e,t,n)=>{const a=n(3946);e.exports=a.template('<p><%= text %></p>\n<% if (ufid) { %>\n    <p>\n        <a class="jstree-hover" data-ufid="<%= ufid %>">\n            <%-gettext("show in question list")%>\n        </a>\n    </p>\n<% } %>\n')},5674:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-source-container">\n    <p>\n        <%=description%>\n    </p>\n    <textarea class="form-control" rows="16"></textarea>\n</div>\n')},1705:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-external-sources-container">\n    <div class="fd-head fd-head-external-sources">\n        <div class="fd-head-max-indicator"><i class="fa-regular fa-circle-down"></i></div>\n        <h2><%-gettext("App Properties")%></h2>\n    </div>\n    <div class="fd-scrollable">\n        <div class="fd-external-resource-search">\n            <form class="form-inline">\n                <label class="control-label" for="fdExternalSearch"><i class="fa fa-search"></i></label>\n                <div class="fd-search-control">\n                    <input type="text"\n                        id="fdExternalSearch"\n                        class="form-control search-query"\n                        placeholder="<%-gettext("Search...")%>"\n                        style="width: calc(100% - 42px);"\n                        autocomplete="off" >\n                </div>\n            </form>\n        </div>\n        <div class="fd-external-sources-error container-fluid has-error hide">\n            <div class="help-block"></div>\n        </div>\n        <div class="fd-external-sources-tree"></div>\n    </div>\n</div>\n')},8426:(e,t,n)=>{const a=n(3946);e.exports=a.template('<table class="table table-hover">\n  <thead>\n    <th><%-gettext("Question")%></th>\n    <th><%-gettext("Used By")%></th>\n    <th><%-gettext("In Property")%></th>\n  </thead>\n  <% _.each(tableData, function(refs, question) { %>\n     <tr>\n       <td><a class="link-to-question"><%- question %></a></td>\n       <td></td>\n       <td></td>\n     </tr>\n     <% _.each(refs, function(propName, path) {%>\n       <tr class="usage-row">\n         <td></td>\n         <td><a class="link-to-question"><%- path %></a></td>\n         <td><%- propName %></td>\n       </tr>\n     <% }); %>\n   <% }); %>\n</table>\n')},1089:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-search">\n  <div class=\'form-inline\'>\n    <div>\n      <label class="control-label" for="findUsagesSearch">\n        <i class="fa fa-search"></i>\n      </label>\n      <div class="fd-search-control">\n        <input type="text"\n               class="form-control search-query"\n               id="findUsagesSearch"\n               placeholder="<%-gettext("Search...")%>"\n               style="width: calc(100% - 42px);"\n               autocomplete="off"/>\n      </div>\n    </div>\n  </div>\n</div>\n')},8267:(e,t,n)=>{const a=n(3946);e.exports=a.template("<ul>\n<% _.each(errors, function (error) { %>\n    <li>\n        <%= error.mug.getDisplayName(displayLanguage) %>\n        <ul>\n        <% _.each(error.errors, function (error) { %>\n            <li><%= error.message %></li>\n        <% }); %>\n        </ul>\n    </li>\n<% }); %>\n</ul>\n")},6328:(e,t,n)=>{const a=n(3946);e.exports=a.template('<li class="divider language-selector"></li>\n<li class="dropdown-header language-selector"><%-gettext("Display")%></li>\n<% _.each(languages, function(language) { %>\n<li><a tabindex="-1" class="fd-display-item language-selector" data-code="<%-language.code%>"><i class="fa fa-check"></i><%-language.name%><%\n    if (language.name !== language.code && language.code !== \'_ids\') {\n        %> (<%-language.code%>)<%\n    }\n    %></a></li><%\n}); %>\n')},8101:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-ui-container">\n    <div class="fd-content fd-content-left">\n        <div class="fd-tree">\n            <div class="fd-head">\n                <h2>\n                    <i class="fd-form-icon"></i>\n                    <span class="fd-head-text"><%-gettext("Questions")%></span>\n                </h2>\n                <div class="fd-head-menu-container">\n                    <div class="dropdown">\n                        <a class="dropdown-toggle"\n                           data-toggle="dropdown">\n                            <i class="fa fa-reorder"></i>\n                            <i class="fa fa-caret-down"></i>\n                        </a>\n                        <ul class="dropdown-menu checklist fd-questions-menu fd-scrollable-minimal" role="menu">\n                            <li>\n                                <a class="fd-button-copy">\n                                    <i class="fa fa-copy"></i>\n                                    <%-gettext("Copy")%><span class="hotkey"><%-Ctrl%>C</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class="fd-expand-all">\n                                    <i class="fa fa-angle-double-down"></i>\n                                    <%-gettext("Expand All")%><span class="hotkey"><%-Ctrl%><%-Alt%>=</span>\n                                </a>\n                            </li>\n                            <li>\n                                <a class="fd-collapse-all">\n                                    <i class="fa fa-angle-double-right"></i>\n                                    <%-gettext("Collapse All")%><span class="hotkey"><%-Ctrl%><%-Alt%>&ndash;</span>\n                                </a>\n                            </li>\n                            <li class="divider fd-bulk-update-menu"></li>\n                            <li class="dropdown-header fd-bulk-update-header">\n                              <%-gettext("Bulk Update All Questions")%>\n                            </li>\n                            <li class="divider fd-tools-menu"></li>\n                        </ul>\n                        <input type="hidden" class="fd-question-tree-display" />\n                    </div>\n                </div>\n            </div>\n            <div class="dropdown fd-add-question-dropdown">\n                <button class="fd-add-question dropdown-toggle btn btn-purple" data-toggle="dropdown">\n                    <i class="fa fa-plus"></i> <%-gettext("Add Question")%>\n                    <i class="fa fa-caret-down"></i>\n                </button>\n            </div>\n            <div class="fd-undo-container"> </div>\n            <div class="fd-scrollable fd-scrollable-tree">\n                <div class="fd-question-tree"></div>\n                <div class="hide fd-default-panel fd-default-qtree">\n                  <div class="helpbubble helpbubble-purple helpbubble-top-left">\n                    <p class="lead">\n                    <%\n                        var msg = gettext("Click {btn} to start building your form."),\n                            add = gettext("Add Question"),\n                            btn = \'<i class="fa fa-plus"></i> <strong>\' + add + \'</strong>\';\n                        print(format(msg, {btn: btn}));\n                    %>\n                    </p>\n                    <p class="fd-default-helptext"></p>\n                  </div>\n                </div>\n            </div>\n        </div>\n        <div class="fd-external-sources-divider fd-content-left-divider fd-content-horizontal-divider">\n          <i class="fa fa-ellipsis-h"></i>\n        </div>\n        <div class="fd-accessory-pane"></div>\n    </div>\n    <div class="fd-content fd-content-divider fd-content-vertical-divider"></div>\n    <div class="fd-content fd-content-right">\n        <div class="fd-form-actions btn-toolbar">\n            <div class="btn-group fd-save-button"></div>\n        </div>\n        <div class="fd-column fd-question-properties hide">\n            <div class="fd-head"><h2><%-gettext("Question Details")%></h2></div>\n            <div class="fd-props-toolbar"></div>\n            <div class="fd-scrollable fd-props-scrollable">\n                <form class="form form-horizontal fd-props-content"></form>\n            </div>\n        </div>\n        <div class="fd-xpath-editor fd-column hide">\n            <div class="fd-head"><h2><%-gettext("Expression Editor")%></h2></div>\n            <div class="fd-scrollable full">\n                <div class="fd-xpath-editor-content"></div>\n            </div>\n        </div>\n        <div class="fd-column hide fd-default-panel">\n        </div>\n    </div>\n\n    <div class="fd-messages"></div>\n</div>\n\x3c!-- Begin modal divs --\x3e\n<div class="fd-multimedia-modal-container"></div>\n<div class="fd-modal-generic-container"></div>\n\x3c!-- end modal divs --\x3e\n')},3591:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div>\n    <div class="fd-help pull-right">\n      <a tabindex="-1"\n        data-title="<%-title%>"\n        data-placement="right"\n        data-content="<%=gettext("Use text formatting to <strong>bold</strong> and <em>italicize</em> words, use bulleted lists, and <a target=\'_blank\' href=\'https://help.commcarehq.org/display/commcarepublic/Text+Formatting\'>more</a>")%>"\n      ></a>\n    </div>\n    <a class="turn-markdown-off markdown-trigger clearfix"><%-gettext("Turn Off Text Formatting")%></a>\n    <a class="turn-markdown-on markdown-trigger clearfix"><%-gettext("Turn On Text Formatting")%></a>\n</div>\n')},1694:(e,t,n)=>{const a=n(3946);e.exports=a.template('<button class="btn <%=cssClasses%><% if (defaultButton) { %> btn-default<% } %>">\n    <%= title %>\n</button>\n')},7649:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="modal fade">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title">\n                    <% if (headerIcon) { %>\n                        <i class="<%=headerIcon%>"></i>\n                    <% } %>\n                    <%=title%>\n                </h4>\n            </div>\n            <div class="modal-body form form-horizontal">\n            </div>\n            <div class="modal-footer">\n                <% if (closeButtonTitle) { %>\n                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">\n                    <%=closeButtonTitle%>\n                </button>\n                <% } %>\n            </div>\n        </div>\n    </div>\n</div>\n')},4533:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="control-row">\n    <div class="col-sm-12">\n        <button type="button" class="btn btn-default fd-mm-path-show pull-right">\n            <i class="fa fa-cog"></i>\n            <%-gettext("Advanced: Show Path")%>\n        </button>\n        <div class="fd-mm-upload-trigger"></div>\n    </div>\n</div>\n<div class="control-row">\n    <div class="fd-mm-path hide col-sm-12">\n        <button type="button" class="btn btn-default fd-mm-path-hide pull-right"><%-gettext("Hide Path")%></button>\n        <div class="fd-mm-path-input"></div>\n    </div>\n</div>\n')},3609:(e,t,n)=>{const a=n(3946);e.exports=a.template('<% if (errors.length > 0) { %>\n    <div class="alert alert-danger">\n        <% for (var e = 0; e < errors.length; e++) {\n            var error = errors[e]; %>\n            <p><%- error %></p>\n        <% } %>\n    </div>\n<% } %>\n')},9606:(e,t,n)=>{const a=n(3946);e.exports=a.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open Audio")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Audio Uploaded Successfully")%></span>\n</p>\n')},8793:(e,t,n)=>{const a=n(3946);e.exports=a.template('<p>\n    <img src="<%=url %>?thumb=100" alt="uploaded image" />\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens image in new tab.")%>"><%-gettext("View Full Size")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Image Uploaded Successfully")%></span>\n</p>\n')},8125:(e,t,n)=>{const a=n(3946);e.exports=a.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open HTML")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New HTML Document Uploaded Successfully")%></span>\n</p>\n')},1779:(e,t,n)=>{const a=n(3946);e.exports=a.template('<p>\n    <a href="<%= url %>"\n       class="btn btn-default existing-media"\n       target="_blank"\n       data-toggle="tooltip" data-title="<%-gettext("Opens file in new tab.")%>"><%-gettext("Open Video")%></a>\n</p>\n<p class="text-success hqm-upload-completed hide">\n    <span class="label label-success"><%-gettext("New Video Uploaded Successfully")%></span>\n</p>\n')},2589:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="modal fade" id="<%= modalId %>">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title"><%-gettext("Upload")%> <%= mediaType %></h4>\n            </div>\n            <div class="modal-body form form-horizontal">\n                <div class="form-group">\n                    <label class="col-sm-4 control-label">\n                        <%-gettext("Select new")%> <%= mediaType %>\n                    </label>\n                    <div class="col-sm-8">\n                        <button class="btn btn-primary" type="button"><%-gettext("Select File")%></button>\n                        <input type="file" class="hide" />\n                        <div class="hqm-upload-status"></div>\n                    </div>\n                </div>\n                <div class="form-group hqm-existing hide">\n                    <label class="col-sm-4 control-label">\n                        <%-gettext("Current")%> <%= mediaType %>\n                    </label>\n                    <div class="col-sm-8 hqm-existing-controls">\n                    </div>\n                </div>\n            </div>\n            <div class="modal-footer">\n                <a class="btn btn-default" data-dismiss="modal"><%-gettext("Close")%></a>\n                <a class="btn btn-default disabled hqm-upload hqm-upload-confirm">\n                    <i class="fa-solid fa-cloud-arrow-up"></i>\n                    <i class="fa-solid fa-spin fa-refresh hide"></i>\n                    <%-gettext("Begin Upload")%>\n                </a>\n            </div>\n        </div>\n    </div>\n</div>\n')},2618:(e,t,n)=>{const a=n(3946);e.exports=a.template('<p class="fd-mm-no-ref">\n    <i class="<%=iconClass%>"></i>\n    <%-gettext("No Reference")%>\n</p>\n')},5080:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div style="clear: both;">\n    <div class="alert alert-success" style="margin-bottom: 2px; margin-top: 10px;">\n        <i class="fa fa-check"></i> <%= file_name %> <strong>[<%= file_size %> MB]</strong>\n    </div>\n    <p class="text-success hqm-begin">\n      <%=gettext("Ready to upload. Click <strong>Begin Upload</strong> below to start.")%>\n    </p>\n    <p class="text-danger hqm-error hide">\n        <span class="label label-danger"><%-gettext("There were errors.")%></span>\n    </p>\n    <div class="hqm-errors"></div>\n</div>\n')},3184:(e,t,n)=>{const a=n(3946);e.exports=a.template('<a href="#<%= uploaderId %>"\n   class="btn btn-primary"\n   data-toggle="modal">\n    <%- multimediaExists ? gettext("Replace") : gettext("Upload") %> <%=mediaType%>\n</a>\n')},8019:(e,t,n)=>{const a=n(3946);e.exports=a.template('<fieldset class="fd-question-fieldset<% if (isCollapsed) { %> hide<% } %>" data-slug="<%= fieldsetSlug %>">\n    <legend>\n        <% if (help) { %>\n        <div class="fd-help pull-right">\n            <a class="help" tabindex="-1"\n                data-title="<%=help.title%>"\n                data-content="<%=help.text%><p><a target=\'_blank\' href=\'<%=help.link%>\'>See More</a></p>"\n                data-placement="left">\n            </a>\n        </div>\n        <% } %>\n        <%=fieldsetTitle%>\n    </legend>\n    \x3c!-- todo: don\'t require passing a unique ID to this template or an\n    interface that exposes it (i.e., allow passing a non-unique id and then\n    append it to a random one, or something --\x3e\n    <div id="<%=fieldsetClass%>">\n        <div class="fd-fieldset-content"></div>\n    </div>\n</fieldset>\n')},348:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-question-toolbar-container clearfix">\n    <% if (isCopyable) { %><div class="btn-toolbar pull-left"></div><% } %>\n    <div class="btn-toolbar pull-right">\n        <% if (isDeleteable) { %>\n            <button type="button" class="btn btn-danger fd-button-remove"  tabindex="-1">\n                <i class="fa-regular fa-trash-can"></i> <%-gettext("Delete")%>\n            </button>\n        <% } %>\n        <% if (sections.length) { %>\n            <div class="btn-group fd-section-changer">\n                <a class="btn btn-default dropdown-toggle" data-toggle="dropdown">\n                    <i class="fa fa-reorder"></i>\n                    <i class="fa fa-caret-down"></i>\n                </a>\n                <ul class="dropdown-menu dropdown-menu-right checklist">\n                    <li class="dropdown-header"><%-gettext("Show")%></li>\n                    <% _.each(sections, function(section) { %>\n                    <li>\n                        <a data-slug="<%= section.slug %>" <% if (section.show) { %>class="selected"<% } %>>\n                            <i class="fa fa-check"></i><%= section.displayName %>\n                        </a>\n                    </li>\n                    <% }); %>\n                </ul>\n            </div>\n        <% } %>\n    </div>\n</div>\n<div class="alert alert-info fd-question-comment"\n<% if (!comment) { %>\n  style="display: none"\n<% } %>\n><%= comment %></div>\n')},4226:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="btn-group question-type-changer">\n    <a class="btn btn-default dropdown-toggle current-question"\n        data-toggle="dropdown">\n        <i class="<%=currentQuestionIcon%>"></i> \n        <%= currentTypeName %> <span class="caret"></span>\n    </a>\n    <ul class="dropdown-menu">\n        <% if (questions.length === 0) { %>\n            <li class="dropdown-header"><%-gettext("Cannot Change Question Type")%></li>\n        <% } else { %>\n            <li class="dropdown-header"><%-gettext("Change Question Type To")%></li>\n            <% _.each(questions, function(question) { %>\n            <li>\n                <a class="change-question" data-qtype="<%=question.slug%>">\n                    <i class="<%=question.icon%>"></i> <%=question.name%>\n                </a>\n            </li>\n            <% }); %>\n        <% } %>\n\n    </ul>\n</div>\n')},1409:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="widget">\n    <div class="form-group">\n        <div class="control-label col-sm-3">\n            <label><%= labelText %></label>\n            <% if (help) { %>\n                <div class="fd-help">\n                    <a tabindex="-1"\n                        data-title="<%- labelText %>"\n                        data-content="<%- help.text %><% if (help.url) { %><p><a href=\'<%- help.url %>\' target=\'_blank\'>See more</a></p><% } %>"></a>\n                </div>\n            <% } %>\n        </div>\n        <div class="col-sm-9 controls">\n            \x3c!-- input will go here --\x3e\n            <div class="messages"></div>\n        </div>\n    </div>\n</div>\n')},9655:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-undo-delete alert alert-<%= errors.length ? "danger" : "success" %> fade in">\n  <button type="button" class="close">&times;</button>\n  <%-gettext("You have deleted a question.")%> <a class="fd-undo"><%-gettext("Undo")%></a>\n  <% if (errors.length) { %>\n    <p><%\n      print(format(\n        ngettext(\n          "Warning: {errs} is still referenced by other questions.",\n          "Warning: {errs} are still referenced by other questions.",\n          errors.length\n        ),\n        {errs: errors.join(", ")}\n      ))\n    %></p>\n  <% } %>\n</div>\n')},7501:(e,t,n)=>{const a=n(3946);e.exports=a.template('<% props[""] = {calculate: "", relevant: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-attachment-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Node Name")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Source")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-property-from form-control"\n               value="<%-v[\'from\']%>" type="text" placeholder="<%-gettext("From")%>"/>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-attachment-name form-control"\n               value="<%-v[\'name\']%>" type="text" placeholder="<%-gettext("Attachment Name")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},237:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="well fd-kv">\n    <% pairs[""] = ""; %>\n    <% _.each(pairs, function (v, k) { _.each(_.isArray(v) ? v : [v], function (v) { %>\n        <div class="fd-kv-pair form-group">\n            <div class="col-sm-3">\n                <input class="fd-kv-key form-control" type="text" value="<%=k%>" placeholder="<%-gettext("key")%>" />\n            </div>\n            <div class="col-sm-1 fd-kv-arrow"><i class="fa fa-arrow-right"></i></div>\n            <div class="col-sm-7"><input class="fd-kv-val form-control jstree-drop" type="text" value="<%=v%>" placeholder="<%-gettext("value")%>" /></div>\n            <div class="col-sm-1">\n                <a class="btn fd-kv-remove-pair btn-sm btn-danger<% if (k ==\'\') { %> hide<% } %>">\n                    <i class="fa fa-remove"></i>\n                </a>\n            </div>\n        </div>\n    <% }); }); %>\n    <a class="btn btn-default fd-kv-add-pair hide"><i class="fa fa-plus"></i> <%=gettext("Add Key&rarr;Value Pair")%></a>\n</div>\n')},918:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="fd-control-message alert alert-warning alert-block <%= msg.level %>">\n    <button type="button" class="close" data-dismiss="alert">&times;</button>\n    <% if (html) { %><%= html %><% } else { %><%- msg.message %><% } %>\n</div>\n')},4206:(e,t,n)=>{const a=n(3946);e.exports=a.template('<% props[""] = {calculate: "", relevant: "", case_type: "", relationship: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-index-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Relationship Identifier (e.g. parent or host)")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Referenced Case ID")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-case-type form-control"\n               value="<%-v[\'case_type\']%>" type="text" placeholder="<%-gettext("Referenced Case Type")%>"/>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-index-property-relationship form-control"\n               value="<%-v[\'relationship\']%>" type="text" placeholder="<%-gettext("Relationship (child or extension)")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},3835:(e,t,n)=>{const a=n(3946);e.exports=a.template('<div class="well well-small">\n  <%= internal_template({props: props}) %>\n  <a class="btn btn-default fd-add-property hide"><i class="fa fa-plus"></i> <%-gettext("Add Property")%></a>\n</div>\n<div class="messages" />\n')},1:(e,t,n)=>{const a=n(3946);e.exports=a.template('<% props[""] = {calculate: "", relevant: ""}; %>\n\n<% _.each(props, function (v, k) { %>\n  <div class="fd-update-property">\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-name form-control"\n               value="<%-k%>" type="text" placeholder="<%-gettext("Property Name")%>"/>\n      </div>\n      <div class="col-sm-1">\n        <a class="btn fd-remove-property btn-sm btn-danger">\n          <i class="fa fa-remove"></i>\n        </a>\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-source form-control"\n               value="<%-v[\'calculate\']%>" type="text" placeholder="<%-gettext("Calculation")%>" />\n      </div>\n    </div>\n    <div class="form-group">\n      <div class="col-sm-11">\n        <input class="fd-update-property-relevant form-control"\n               value="<%-v[\'relevant\']%>" type="text" placeholder="<%-gettext("Relevant")%>"/>\n      </div>\n    </div>\n  </div>\n<% }); %>\n')},7026:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(9659),i=n(4523);function r(e,t){this.value=t,this.children=e||[],this.parent=null}function o(e,t){a.A.eventuality(this),this.rootNode=new r(null,null),this.rootNode.isRootNode=!0,this.setRootID(e),this.treeType=t||"data"}r.prototype={getChildren:function(){return this.children},getValue:function(){return this.value},addChild:function(e){e.parent=this,this.children.push(e)},insertChild:function(e,t){if(null===e)return null;t<0&&(t=0),e.parent=this,this.children.splice(t,0,e)},getSingleMatchingNode:function(e){var t;if(e(this.getValue()))return this;for(var n=0;n<this.children.length;n++)if(t=this.children[n].getSingleMatchingNode(e))return t;return null},removeChild:function(e){var t=this.children.indexOf(e);return-1!==t&&this.children.splice(t,1),e.parent=null,e},getID:function(){return this.isRootNode?this.rootNodeId:this.getValue().getNodeID()},getChildrenMugs:function(){var e,t=[];for(e in this.children)this.children.hasOwnProperty(e)&&t.push(this.children[e].getValue());return t},getStructure:function(){var e={};return e[this.getID()]=i.Ay.map(this.children,(function(e){return e.getStructure()})),e},treeMap:function(e,t,n){var a,i=e(this),r=this.getChildren();for(a in i&&t.push(i),r)r.hasOwnProperty(a)&&r[a].treeMap(e,t,n);return n&&n(this,i),t},walk:function(e){var t=this.getValue(),n=this.getChildren();e(t,this.getID(),(function(a){a&&(n=a(n,t));for(var i=0;i<n.length;i++)n[i].walk(e)}))},getAbsolutePath:function(e){if(this.isRootNode)return e?"":"/"+this.getID();var t,n=this.value,a=n.p.dataParent;if(a){var i=n.form.getMugByPath(a);t=i&&i!==n?n.form.getAbsolutePath(i,e):e?"":"/"+this.getRootNode().rootNodeId}else if(null===(t=this.parent.getAbsolutePath(e)))return null;var r=this.getID();return n.options.getPathName&&(r=n.options.getPathName(n,r)),(t||"")+"/"+r},validateTree:function(e){var t;if(!this.getValue())throw"Tree contains node with no values!";if(!e(this.getValue()))return!1;for(t in this.getChildren())if(this.getChildren().hasOwnProperty(t)&&!this.getChildren()[t].validateTree(e))return!1;return!0},getRootNode:function(){return this.isRootNode?this:this.parent.getRootNode()}},o.prototype={setRootID:function(e){this.rootNode.rootNodeId=e},getParentNode:function(e){return this.rootNode===e?this.rootNode:e&&e.parent},getStructure:function(){return this.rootNode.getStructure()},getNodeFromMug:function(e){return e["_node_"+this.treeType]},_removeNodeFromTree:function(e){var t=this.getParentNode(e);t&&(t.removeChild(e),this.fire({type:"change"}))},insertMug:function(e,t,n,a){var i,o,s=n?this.getNodeFromMug(n):this.rootNode,l=this.getNodeFromMug(e);switch(l&&this.rootNode===l.getRootNode()?this._removeNodeFromTree(l):(l=new r(null,e),e["_node_"+this.treeType]=l),t){case"before":case"inside":i=(o=this.getParentNode(s)).children.indexOf(s),o.insertChild(l,i);break;case null:case"after":i=(o=this.getParentNode(s)).children.indexOf(s),o.insertChild(l,i+1);break;case"into":case"last":s.addChild(l);break;case"first":s.insertChild(l,0);break;case"index":s.insertChild(l,a);break;default:throw"in insertMug() position argument MUST be null, 'before', 'after', 'into', 'first' or 'last'. Argument was: "+t}return this.fire({type:"change",mug:e}),l},getAbsolutePath:function(e,t){var n=this.getNodeFromMug(e);return n?n.getAbsolutePath(t):null},getPreviousSibling:function(e){var t=this,n=t.getNodeFromMug(e),a=e.parentMug,i=a?t.getNodeFromMug(a):t.getRootNode(),r=i.children.indexOf(n);return 0===r?a:i.children[r-1].getValue()},findSibling:function(e,t,n){var a,i,r,o=this.getNodeFromMug(e);if(!o)throw"mug not found in "+this.treeType+" tree";if(-1===(i=(a=this.getParentNode(o).getChildrenMugs()).indexOf(e)))throw"mug not found in its parent's children";if("before"===t){for(r=i-1;r>=0;r--)if(n(a[r]))return a[r]}else for(r=i+1;r<a.length;r++)if(n(a[r]))return a[r];return null},removeMug:function(e){this._removeNodeFromTree(this.getNodeFromMug(e))},getRootChildren:function(){return this.rootNode.getChildrenMugs()},treeMap:function(e,t){return this.rootNode.treeMap(e,[],t)},walk:function(e){this.rootNode.walk(e)},isTreeValid:function(e){var t,n=this.rootNode.getChildren();for(t in n)if(n.hasOwnProperty(t)&&!n[t].validateTree(e))return!1;return!0},getRootNode:function(){return this.rootNode}},o.Node=r;const s=o},3809:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var a=n(4523),i=/[\r\n\u2028\u2029"\t]/;function r(e){return e=null===e||a.Ay.isUndefined(e)?"":String(e),i.test(e)&&(e='"'+e.replace(/"/g,'""')+'"'),e}const o={escape:r,makeRowParser:function(e){var t=/(.*)(?:\n|\r\n|\r|\u2028|\u2029)/gm,n=/(.*?)(?:\t|(\n|\r\n|\r|\u2028|\u2029|$))/g,i=/^("(?:[^"]|"")*")(?:\t|(\n|\r\n|\r|\u2028|\u2029|$))/,r=/""/g,o=e.length,s=0;function l(e){if(e<=s)throw new Error("last index "+s+" -> "+e);s=e}return function(){if(s>=o)return null;t.lastIndex=s;var d=t.exec(e);return d&&-1===d[1].indexOf('"')?(l(t.lastIndex),d[1].split("\t")):function(){var t,d,u=[];n.lastIndex=s;do{'"'===(t=n.exec(e))[1][0]&&(d=i.exec(e.slice(s)))&&d[1]&&((t=d)[1]=t[1].slice(1,-1).replace(r,'"'),n.lastIndex=s+t[0].length),u.push(t[1]),l(n.lastIndex)}while(s<o&&a.Ay.isUndefined(t[2]));return u}()}},tabDelimit:function(e){return a.Ay.map(e,(function(e){return a.Ay.map(e,r).join("\t")})).join("\n")}}},7512:(e,t,n)=>{"use strict";function a(){this.undoItems=[],this.redoItems=[],this.isUpdating=!1,this.lastPushTime=null}function i(e){this.element=e,this.undoStack=new a}function r(e){const t=window.getSelection();if(0===t.rangeCount)return null;const n=t.getRangeAt(0),a=n.startContainer,i=n.startOffset;if(!e.contains(a))return null;const r=[];let o=a;for(;o!==e;){const e=o.parentNode;if(!e)break;const t=Array.from(e.childNodes).indexOf(o);r.unshift(t),o=e}return{nodePath:r,startOffset:i}}function o(e,t){if(!t)return;let n=e;t.nodePath.forEach((t=>{n=n.childNodes[t]?n.childNodes[t]:e}));const a=document.createRange();try{a.setStart(n,t.startOffset),a.setEnd(n,t.startOffset);const e=window.getSelection();e.removeAllRanges(),e.addRange(a)}catch(e){}}function s(e){const t=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}n.d(t,{A:()=>l}),a.prototype={push:function(e,t=!0){return!this.isUpdating&&(t&&this.undoItems.length>0&&null!==this.lastPushTime&&Date.now()-this.lastPushTime<500?this.undoItems[this.undoItems.length-1]=e:this.undoItems.push(e),this.lastPushTime=t?Date.now():null,this.redoItems=[],!0)},peek:function(e){let t=null;if(this.undoItems.length>0&&(t=this.undoItems[this.undoItems.length-1]),e&&"function"==typeof e){this.isUpdating=!0;try{e(t)}finally{this.lastPushTime=null,this.isUpdating=!1}}},undo:function(e){let t=null;if(this.undoItems.length>1&&(this.redoItems.push(this.undoItems.pop()),t=this.undoItems[this.undoItems.length-1]),e&&"function"==typeof e){this.isUpdating=!0;try{e(t)}finally{this.lastPushTime=null,this.isUpdating=!1}}},redo:function(e){let t=null;if(this.redoItems.length>0){const e=this.redoItems.pop();this.undoItems.push(e),t=e}if(e&&"function"==typeof e){this.isUpdating=!0;try{e(t)}finally{this.lastPushTime=null,this.isUpdating=!1}}}},i.prototype={push:function(e=!0){const t={value:this.element.innerHTML,cursor:r(this.element)};this.undoStack.push(t,e)},peek:function(){let e=null;return this.undoStack.peek((t=>{e=t})),e},reset:function(){this.undoStack.peek((e=>{null!==e&&(this.element.innerHTML=e.value,o(this.element,e.cursor))}))},undo:function(){this.undoStack.undo((e=>{null!==e&&(this.element.innerHTML=e.value,o(this.element,e.cursor),s(this.element))}))},redo:function(){this.undoStack.redo((e=>{null!==e&&(this.element.innerHTML=e.value,o(this.element,e.cursor),s(this.element))}))}};const l={UndoStack:a,ElementUndoStack:i}},9659:(e,t,n)=>{"use strict";n.d(t,{A:()=>v});var a=n(561),i=n.n(a),r=n(4523),o=n(9339),s=n(426),l=n.n(s),d=n(2922),u=n.n(d)()("zero").enable(["link","emphasis","strikethrough","heading","list","table"]),c=u.renderer.rules.link_open||function(e,t,n,a,i){return i.renderToken(e,t,n)};u.renderer.rules.link_open=function(e,t,n,a,i){var r=e[t].attrIndex("target");return r<0?e[t].attrPush(["target","_blank"]):e[t].attrs[r][1]="_blank",c(e,t,n,a,i)};var p=n(4459),f=n(7229);n(6283),RegExp.escape=function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};var h={isMac:/Mac/.test(navigator.platform)},g=h.isMac,m={";":";","â‰ ":"=","â€“":"-","=":"=","-":"-",186:";",187:"=",189:"-"};h.getKeyChord=function(e){var t=g&&e.metaKey||!g&&e.ctrlKey,n=g&&e.ctrlKey||!g&&e.metaKey,a=String(e.key),i=e.which;return m.hasOwnProperty(i)?a=m[i]:m.hasOwnProperty(a)?a=m[a]:1!==a.length&&"Unidentified"!==a||(a=i>=48&&i<=57||i>=65&&i<=90?String.fromCharCode(i):i>=96&&a<=105?String.fromCharCode(i-48):i),(t?"Ctrl+":"")+(e.altKey?"Alt+":"")+(e.shiftKey?"Shift+":"")+(n?"Meta+":"")+a},h.extend=function(){var e=Array.prototype.slice.call(arguments);return i().extend.apply(null,[!0,{}].concat(e))},h.langCodeToName={},r.Ay.each(o,(function(e){var t=e.names[0];h.langCodeToName[e.three]=t,h.langCodeToName[e.two]=t})),h.formatExc=function(e){return e&&e.stack?e+"\n"+e.stack:String(e)},h.validAttributeRegex=/^[^<&'">]*$/,h.invalidAttributeRegex=/[<&'">]/,h.isValidAttributeValue=function(e){return h.validAttributeRegex.test(e)},h.eventuality=function(e){var t={},n={};return e.fire=function(e){var n,a,i,r,o="string"==typeof e?e:e.type;if(t.hasOwnProperty(o))for(n=t[o],r=0;r<n.length;r+=1)"string"==typeof(a=(i=n[r]).method)&&(a=this[a]),a.apply(this,i.parameters||[e]);return this},e.on=function(a,i,o,s,l){arguments.length<5&&(l=null);var d={method:i,parameters:o,context:l};return t.hasOwnProperty(a)?t[a].push(d):t[a]=[d],s&&(n[s]||(n[s]=[]),-1===n[s].indexOf(l)&&(n[s].push(l),e.on(s,(function(){e.unbind(l),n[s]=r.Ay.filter(n[s],(function(e){return e!==l}))}),null,null,l))),this},e.unbind=function(e,n){return r.Ay.isUndefined(n)?t=r.Ay.object(r.Ay.map(t,(function(t,n,a){return[n,t=r.Ay.filter(t,(function(t){return t.context!==e}))]}))):t.hasOwnProperty(n)&&(t[n]=r.Ay.filter(t[n],(function(t){return t.context!==e}))),this},e},h.escape=function(e){return i()("<div>").text(e).html()},h.get_guid=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()},h.generate_xmlns_uuid=function(){var e,t,n=[];for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",t=0;t<36;t++)n[t]||(e=Math.floor(16*Math.random()),n[t]="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"[19===t?3&e|8:15&e]);return n.toString().replace(/,/g,"")},h.isValidElementName=function(e){return/^(?!XML)[a-zA-Z][\w-]*$/.test(e)},h.createXPathBoolFromJS=function(e){return!0===e||"true"===e?"true()":!1===e||"false"===e?"false()":null},h.getOneOrFail=function(e,t){if(0===e.length)throw h.format(gettext("No match for {info} found!"),{info:t});if(e.length>1)throw h.format(gettext("Multiple matches for {info} found!"),{info:t});return e[0]},h.reduceToOne=function(e,t,n){return h.getOneOrFail((0,r.Ay)(e).filter(t),n)},h.getCaretPosition=function(e){var t=0;if(e.createTextRange){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else void 0!==e.selectionStart&&(t=e.selectionStart);return t},h.setCaretPosition=function(e,t,n){if(null==n&&(n=t),e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var a=e.createTextRange();a.collapse(!0),a.moveStart("character",t),a.moveEnd("character",n),a.select()}},h.insertTextAtCursor=function(e,t,n){var a=e[0],i=h.getCaretPosition(a),r=a.value.substring(0,i),o=a.value.substring(i,a.value.length),s=n?i:i+t.length;e.val(r+t+o).change(),i+=t.length,h.setCaretPosition(a,s,i)},h.parseXML=f.A.parseXML,h.htmlXMLDiff=function(e,t){function n(e){return(e=e.replace(/^\t+/gm,(function(e){return e.replace(/\t/g,"  ")}))).match(/\n$/)||(e+="\n"),e}e=n(e),t=n(t);const a=new(l()),i=a.diff_main(e,t);let r=a.diff_prettyHtml(i);return r=r.replaceAll("&para;<br>","<br>"),r},h.markdown=function(e){return r.Ay.isString(e)?(e=e.replace(/\\\\n/g,"\n"),u.render(e)):""},h.truncate=function(e,t){return t=t||25,e&&e.length>t?e.slice(0,t)+"&hellip;":e},h.writeHashtags=function(e,t,n,a){if(r.Ay.isString(n))if(""===n||a.options&&a.options.ignoreHashtags)e.writeAttributeString(t,n);else{var i,o,s=a.form,l=t.replace(":","__");try{var d=s.xpath.parse(n);i=d.toXPath(),o=d.toHashtag()}catch(e){s.richText?(o=n,i=p.A.unescapeXPath(n,s)):o=i=n}o!==i?(s.richText&&e.writeAttributeString("vellum:"+l,o),e.writeAttributeString(t,i)):e.writeAttributeString(t,n)}},h.isRightToLeftLanguage=function(e){return r.Ay.contains(["ara","arc","div","fas","heb","pus","snd","uig","urd","yid"],e)},h.getReferenceName=function(e){var t=/^#([^\/]+)\//.exec(e);return t?(t=t[1][0].toUpperCase()+t[1].substring(1).toLowerCase())+" Reference":"Form Reference"},h.format=function(e,t){return e.replace(/\{([a-z][\w_]*)\}/gi,(function(e,n){return t.hasOwnProperty(n)?t[n]:e}))},h.checkForFormSubmissions=r.Ay.throttle((function(e){e.warnWhenChanged||e.isCurrentlyCheckingForSubmissions||(e.isCurrentlyCheckingForSubmissions=!0,i().ajax({url:e.submissionUrl,type:"GET",dataType:"json",success:function(t){t.form_has_submissions&&(e.warnWhenChanged=!0,e.walkMugs((function(e){e.validate()})))},complete:function(){e.isCurrentlyCheckingForSubmissions=!1}}))}),1e4);const v=h},705:(e,t,n)=>{"use strict";n.d(t,{A:()=>S});var a=n(1409),i=n.n(a),r=n(237),o=n.n(r),s=n(918),l=n.n(s),d=n(4523),u=n(561),c=n.n(u),p=n(939),f=n(9659),h=n(4459),g=n(3578),m=n.n(g),v=function(e,t){var n={};return t.richText=!0,n.options=t,n.mug=e,n.id=t.id,f.A.eventuality(n),n.isDisabled=function(){return!!n.path&&(d.Ay.isFunction(e.spec[n.path].enabled)?!e.spec[n.path].enabled(e):e.form.vellum.isPropertyLocked(e.hashtagPath,n.path))},n.getDisplayName=function(){return this.definition.lstring?this.definition.lstring:this.path},n.getControl=function(){throw"must be overridden"},n.setValue=function(e){},n.getValue=function(){},n.getHelp=function(){return this.definition&&this.definition.help?{text:this.definition.help,url:this.definition.helpURL}:null},n.refreshMessages=function(){},n.postRender=function(){},n.handleChange=function(){n.updateValue(),e.showChangedMsg=!0,n.path&&e.validate(n.path),n.fire("change")},n.updateValue=function(){n.save()},n.save=function(){throw"Not Implemented"},n.getUIElement=function(){return k(n.getControl(),n.getDisplayName(),!!n.isDisabled(),n.getHelp())},n.addInstanceRef=function(t,a){if(!a&&!(a=n.path))throw new Error("widget has no path: "+n);return e.form.addInstanceIfNotExists(t,e,a)},n},y=function(e,t){var n=t.widgetValuePath||t.path,a=t.id||"property-"+n,i=t.disabled||!1,r=v(e,t);return r.mugValue=t.mugValue||function(e,t){if(1===arguments.length)return e.p[n];e.p[n]=t},r.path=n,r.definition=e.p.getDefinition(t.path),r.currentValue=r.mugValue(e),r.id=a,r.saving=!1,r.input=c()("<input />").attr("name",a).attr("id",a).prop("disabled",i),r.getControl=function(){return r.input},r.getMessagesContainer=function(){return r.getControl().closest(".widget").find(".messages:last")},r.getMessages=function(e,t){return P(e,t)},r.refreshMessages=function(){var t=r.getMessages(e,n),a=r.getMessagesContainer();a.empty(),t.length?(a.append(t),a.removeClass("hide")):a.addClass("hide")},e.on("messages-changed",(function(){r.refreshMessages()}),null,"teardown-mug-properties"),r.save=function(){r.saving=!0;try{r.mugValue(e,r.getValue())}finally{r.saving=!1}},r},x=function(e,t){var n=y(e,t),a=n.input;return a.attr("type","text").addClass("form-control"),t.placeholder&&a.attr("placeholder",t.placeholder),f.A.isRightToLeftLanguage(t.language)&&a.attr("dir","rtl"),n.setValue=function(t){t&&(t=t.replace(/\n/g,"&#10;"));var i=f.A.getCaretPosition(a[0]),r=a.val();t&&n.hasLogicReferences?a.val(e.form.normalizeXPath(t)):a.val(t),a.is(":focus")&&r.length===t.length&&f.A.setCaretPosition(a[0],i,i)},n.getValue=function(){var t=a.val().replace(/&#10;/g,"\n");return t&&n.hasLogicReferences?e.form.normalizeHashtag(t):t},a.on("change input",(function(){n.handleChange()})),n},b=function(e,t){var n=y(e,t);return n.input=c()("<textarea></textarea>").attr("name",n.id).attr("id",n.id).attr("rows","2").addClass("form-control").on("change input",(function(e){n.handleChange()})).keyup((function(e){9===e.which&&this.select()})),f.A.isRightToLeftLanguage(t.language)&&n.input.attr("dir","rtl"),n.getControl=function(){return n.input},n.setValue=function(e){n.input.val(e)},n.getValue=function(){return n.input.val()},n},A=function(e,t){var n=y(e,t);n.input=c()("<div />").attr("contenteditable",!0).attr("name",n.id).addClass("form-control jstree-drop").addClass(t.singleLine?"fd-input":"fd-textarea");var a={isExpression:t.widget===_||t.widget===M,disableNativeSpellChecker:t.disableNativeSpellChecker,rtl:f.A.isRightToLeftLanguage(t.language)},i=h.A.editor(n.input,e.form,a);return e.on("teardown-mug-properties",i.destroy,null,"teardown-mug-properties"),i.on("change",(function(){n.handleChange()})),n.input.on("inserted.atwho",(function(e,t,n){c()(this).find(".atwho-inserted").children().unwrap()})),n.getControl=function(){return n.input},n.setValue=i.setValue,n.getValue=i.getValue,n},w=function(e,t){return e.form.richText?(t.singleLine=!0,A(e,t)):x(e,t)},M=function(e,t){const n=t.placeholder?t.placeholder:gettext("Drag question here"),a=w(e,t);return a.input.addClass("jstree-drop").attr("placeholder",n).change((function(){a.handleChange()})),a.hasLogicReferences=!0,a};M.trackLogicReferences=!0;var _=function(e,t){t.disableNativeSpellChecker=!0;var n=w(e,t),a=n.getValue,i=n.setValue;return n.getValue=function(){return c().trim(a())},n.getUIElement=function(){var r,o=n.getControl(),s=k(o,n.getDisplayName(),!!n.isDisabled(),n.getHelp());return o.addClass("jstree-drop"),t.autocompleteChoices&&(r=function(){return t.autocompleteChoices(e)}),I(s,(function(){n.options.displayXPathEditor({leftPlaceholder:t.leftPlaceholder,rightPlaceholder:t.rightPlaceholder,leftAutocompleteChoices:r,value:a(),xpathType:n.definition.xpathType,onLoad:function(e){T(e,n),e.find(".property-name").text(t.lstring||"Expression")},done:function(e){!1!==e&&(i(e),n.handleChange())},mug:e}),m().fbUsage("Logic",t.lstring)}),!!n.isDisabled())},p.A.autocomplete(n.input,e,{property:t.path,useRichText:e.form.richText}),n.hasLogicReferences=!0,n};_.trackLogicReferences=!0;var C=function(e,t){var n=y(e,t);n.dropdown=n.input=c()("<select />").attr("name",n.id).addClass("form-control");var a=n.input;return n.setValue=function(e){var i=n.equivalentOption(e);i?a.val(i.value):t.noCustom?a.prop("selectedIndex",-1):(n.addCustomIfNeeded(e),a.val(e))},n.getValue=function(){return a.val()},n.updateValue=function(){n.save()},a.change((function(){n.handleChange()})),n.addOption=function(e,t){var n=c()("<option />").attr("value",e).text(t);this.dropdown.append(n)},n.addOptions=function(e){var t=this;d.Ay.forEach(e,(function(e){t.addOption(e.value,e.text)}))},n.clearOptions=function(){this.dropdown.empty()},n.getOptions=function(){return d.Ay.map(n.dropdown.find("option"),(function(e){return{value:e.value,text:e.text}}))},n.equivalentOption=function(e){function t(e){try{return JSON.parse(e)}catch(t){return e}}return e=t(e),d.Ay.find(n.getOptions(),(function(n){return d.Ay.isEqual(t(n.value),e)}))},n.addCustomIfNeeded=function(e){var a=n.dropdown.find("option").filter((function(){return c()(this).text()===gettext("Custom")}));t.useValueAsCustomName?n.addOption(e,e):0===a.length?n.addOption(e,gettext("Custom")):a.val(e)},t.defaultOptions&&n.addOptions(t.defaultOptions),n},I=function(e,t,n){var a=e.find("input");d.Ay.isUndefined(n)&&(n=!!a&&a.prop("disabled"));var i=c()("<button />").addClass("fd-edit-button").html("<i class='fa fa-edit'></i>").stopLink().addClass("btn btn-default btn-block").attr("type","button").prop("disabled",n).click(t),r=c()("<div />").addClass("col-sm-1").append(i);return e.css("position","relative"),e.find(".controls").removeClass("col-sm-9").addClass("col-sm-8").after(r),e},k=function(e,t,n,a){var r=c()(i()({labelText:t,help:a}));return e.find("*").addBack().prop("disabled",!!n),r.find(".controls").prepend(e),a&&!a.url&&r.find(".fd-help a").click((function(e){e.preventDefault()})),r};function P(e,t){var n=c()(),a={};return e.messages.each(t,(function(i){const r=e.messages.getMessageText(i.message);if(a.hasOwnProperty(r))return;a[r]=!0;let o="";i.message.hasOwnProperty("markdown")?o=f.A.markdown(i.message.markdown):/n/.test(i.message)&&(o=f.A.markdown(i.message));const s={msg:i,html:o},d=c()(l()(s));d.find("button.close").click((function(){e.dropMessage(t,i.key),"mug-nodeID-changed-warning"===i.key&&(e.showChangedMsg=!1)})),n=n.add(d)})),n}function T(e,t){return e.data("vellum_widget",t),e}const S={base:v,normal:y,text:x,multilineText:b,richTextarea:function(e,t){return e.form.richText?(t.singleLine=!1,A(e,t)):b(e,t)},identifier:function(e,t){var n=x(e,t),a=n.updateValue,i=n.handleChange;function r(){var t=e.form.vellum.nodeIDFromLabel(e);n.input.attr("placeholder",t)}return n.updateValue=function(){var e=n.getValue();-1!==e.indexOf(" ")&&n.setValue(e.replace(/\s/g,"_")),""===e&&r(),a()},n._setURLHash=d.Ay.debounce((function(e){e.form.vellum._setURLHash(e)}),500),n.handleChange=function(){i(),n._setURLHash(e),e.p.nodeID||e.dropMessage("nodeID","mug-nodeID-error")},e.on("property-changed",(function(t){"conflictedNodeId"!==t.property||n.saving||n.setValue(n.mugValue(e))}),null,"teardown-mug-properties"),e.form.on("question-label-text-change",(function(t){e.p.nodeID||r()}),null,null,n),e.on("teardown-mug-properties",(function(){e.form.unbind(n)}),null,"teardown-mug-properties"),n},droppableText:M,checkbox:function(e,t){var n=y(e,t),a=n.input;return a.attr("type","checkbox"),n.setValue=function(e){a.prop("checked",e)},n.getValue=function(){return a.prop("checked")},a.change((function(){n.handleChange()})),n},dropdown:C,dropdownWithInput:function(e,t){var n=C(e,t),a=n.handleChange;n.input=n.text=c()("<input />").addClass("form-control").attr({type:"text",name:n.id+"-text"});var i=c()('<div class="control-row row">').append(c()("<div class='col-sm-4'>").append(n.dropdown)).append(c()("<div class='col-sm-8'>").append(n.text));return n.setValue=function(e){var t=n.equivalentOption(e);n.addCustomIfNeeded(e),t?(n.dropdown.val(t.value),n.text.attr("readonly",!0),n.text.val(t.value)):(n.dropdown.val(e),n.text.attr("readonly",!1),n.text.val(e))},n.getValue=function(){return n.text.val()},n.getControl=function(){return i},n.dropdown.change((function(){var e=n.dropdown.find(":selected");n.text.attr("readonly",e.text()!==gettext("Custom")),n.text.val(e.val()),a()})),n.text.change((function(){var e=n.dropdown.find(":selected");n.text.attr("readonly",!1),e.val(n.text.val()),a()})),n},xPath:_,baseKeyValue:function(e,t){var n=v(e,t),a=t.widgetValuePath||t.path,i=t.id||"property-"+a;function r(){var e={};return d.Ay.each(n.kvInput.find(".fd-kv-pair"),(function(t){var n=c()(t),a=n.find(".fd-kv-key").val(),i=n.find(".fd-kv-val").val();e.hasOwnProperty(a)?d.Ay.isArray(e[a])?e[a].push(i):e[a]=[e[a],i]:e[a]=i})),e}return n.definition=e.p.getDefinition(t.path),t.richText=!1,n.mugValue=t.mugValue||function(e,t){if(1===arguments.length)return e.p[a];e.p[a]=t},n.currentValue=n.mugValue(e),n.kvInput=c()('<div class="control-row" />').attr("name",i),n.getControl=function(){return n.isDisabled(),n.kvInput},n.setValue=function(e){n.kvInput.html(o()({pairs:d.Ay.clone(e)})),n.kvInput.find("input").on("change keyup",(function(){n.handleChange()})),n.kvInput.find(".fd-kv-add-pair").click((function(e){n.refreshControl(),e.preventDefault()})),n.kvInput.find(".fd-kv-remove-pair").click((function(e){c()(this).parent().parent().remove(),n.refreshControl(),n.save(),e.preventDefault()}))},n.getValue=function(){return d.Ay.omit(r(),"")},n.updateValue=function(){r().hasOwnProperty("")||(n.kvInput.find(".btn").removeClass("hide"),n.kvInput.find(".fd-kv-remove-pair").removeClass("hide")),n.save()},n.refreshControl=function(){n.setValue(n.getValue())},n.save=function(){n.saving=!0;try{n.mugValue(e,n.getValue())}finally{n.saving=!1}},n},readOnlyControl:function(e,t){t.id="readonly-control";var n=v(e,t);return n.definition={},n.currentValue=c()("<div>").append(e.p.rawControlXML).clone().html(),n.getControl=function(){return c()("<p />").text(this.currentValue)},n},abstractMediaWidget:function(e,t){var n=y(e,t);return n.form="text",n.getValue=function(){return n.input.val()},n.setValue=function(e){return n.input.val(e)},n.getBaseMediaPath=function(){throw new Error("abstract method not implemented: widget.getBaseMediaPath()")},n.mug.form.vellum.initMediaUploaderWidget(n),n},util:{getWidget:function(e,t){for(var n,a=e;a&&a.length;){if((n=a.data("vellum_widget"))&&(!t||t===a.vellum("get")))return n;a=a.parent()}return null},setWidget:T,getMessages:P,getUIElementWithEditButton:I,getUIElement:k}}},8922:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var a=n(561),i=n.n(a);function r(e){e.on("DOMMouseScroll mousewheel",(function(e){var t=i()(this),n=this.scrollTop,a=this.scrollHeight,r=t.height(),o=e.originalEvent.wheelDelta,s=o>0,l=function(){return e.stopPropagation(),e.preventDefault(),e.returnValue=!1,!1};return!s&&-o>a-r-n?(t.scrollTop(a),l()):s&&o>n?(t.scrollTop(0),l()):void 0}))}function o(e,t,n){var a,r,o,s;e.hasClass("fd-content-vertical-divider")?(o=t.offset().left<e.offset().left,a="pageX",r="width",s="col-resize"):(o=t.offset().top<e.offset().top,a="pageY",r="height",s="row-resize");var l=o?1:-1;e.mousedown((function(e){var o=t.data("min-size")||0,s=t[r](),d=function(i){var d=i[a]-e[a];t[r](Math.max(s+d*l,o)),t.resize(),n()};i()(window).disableSelection().on("mousemove",d).one("mouseup",(function(){i()(this).enableSelection(),i()(this).off("mousemove",d)}))})).hover((function(e){e.target.style.cursor=s}))}n(2023),n(6283),i().vellum.plugin("windowManager",{minHeight:200,bottomOffset:0},{init:function(){var e=this,t=this.opts().windowManager,n=function(){e.adjustToWindow()};r(this.$f.find(".fd-scrollable")),o(this.$f.find(".fd-content-divider"),this.$f.find(".fd-content-left"),n),o(this.$f.find(".fd-content-left-divider"),this.$f.find(".fd-accessory-pane"),n),this.data.windowManager.offset={top:t.topOffset||this.$f.offset().top-1,bottom:t.bottomOffset||0,left:t.leftOffset||this.$f.offset().left},this.data.windowManager.fullscreen=t.fullscreen,this.data.windowManager.adjustToWindow=n,i()(window).resize(n),i()(document).scroll(n),i()(n),e.adjustToWindow()},adjustToWindow:function(){if(this.$f.is(":visible")){var e,t=i()(window).height()-this.getCurrentTopOffset(),n=0===this.getCurrentTopOffset()?"fixed":"static",a=this.$f.find(".fd-ui-container");this.data.windowManager.fullscreen?(a.parent().css({height:null,width:null}),a.css({height:null,width:null}),a.addClass("full-screen"),i()("body").addClass("vellum-full-screen"),a.parent().css({top:0,bottom:0,left:0,right:0,backgroundColor:"white"}),a.css("width",i()(window).width())):(a.removeClass("full-screen"),i()("body").removeClass("vellum-full-screen"),a.parent().css({top:"",bottom:"",left:"",right:"",backgroundColor:"white"}),a.css("width",a.parent().width())),a.parent().css("height",t+"px"),t-=this.getCurrentBottomOffset(),a.css("height",t+"px"),a.css("position",n).css("left",this.getCurrentLeftOffset()+"px"),e=a.width();var r=Math.max(t,this.opts().windowManager.minHeight),o=r,s=r-this.$f.find(".fd-head").outerHeight(!1),l=this.$f.find(".fd-accessory-pane");a.find(".fd-content").css("height",r+"px");var d=a.find(".fd-content-left .fd-tree");if(d.children(":not(.fd-scrollable)").each((function(e,t){o-=i()(t).outerHeight(!1)})),l.children().length){var u=l.outerHeight(!1),c=u-l.find(".fd-head").outerHeight(!0);o-=2+u+this.$f.find(".fd-content-left-divider").outerHeight(!0),l.find(".fd-scrollable").css("height",c+"px"),l.show(),this.$f.find(".fd-content-left-divider").show()}else l.hide(),this.$f.find(".fd-content-left-divider").hide();d.find(".fd-scrollable").css("height",o+"px"),d.find(".fd-scrollable-minimal").css("max-height",o+"px"),a.find(".fd-content-right").css("width",e-this.getLeftWidth()+"px").find(".fd-scrollable.full").css("height",s+"px"),a.find(".fd-props-scrollable").css("height",s-a.find(".fd-props-toolbar").outerHeight(!0)-a.find(".fd-form-actions").outerHeight(!1)+"px")}},getLeftWidth:function(){return 2+this.$f.find(".fd-content-left").outerWidth(!1)+this.$f.find(".fd-content-divider").outerWidth(!0)},getCurrentTopOffset:function(){if(this.data.windowManager.fullscreen)return 0;var e=i()(window).scrollTop(),t=this.data.windowManager.offset,n="function"==typeof t.top?t.top():t.top;return Math.min(Math.max(n-e,0),n)},getCurrentBottomOffset:function(){if(this.data.windowManager.fullscreen)return 0;var e=this.data.windowManager.offset;return"function"==typeof e.bottom?e.bottom():e.bottom},getCurrentLeftOffset:function(){if(this.data.windowManager.fullscreen)return 0;var e=i()(window).scrollLeft(),t=this.data.windowManager.offset,n="function"==typeof t.left?t.left():t.left;return Math.min(n-e,n)}});const s={preventDoubleScrolling:r}},7229:(e,t,n)=>{"use strict";n.d(t,{A:()=>d});var a=n(561),i=n.n(a),r=n(4523);function o(e,t=!1){var n=l(e||""),a=document.implementation.createHTMLDocument().createElement("div");return t?i()(a).append(n):i()(a).html(n)}function s(e,t){if(!e)return"";if(r.Ay.isString(e)){if(!/[<>&]/.test(e))return e;e=function(e){return e.replace(/<(([\w:.-]+)(?:\s[^<]*?|))\/>/g,"<$1></$2>")}(l(e)),e=t?i()(e):o(e,!0)}var n=new XMLSerializer,a=e[0];void 0===a&&(a=e);var s=n.serializeToString(a);return s.startsWith("<output")&&(s="<div>"+s+"</div>"),s.replace(/ xmlns="http:\/\/www.w3.org\/1999\/xhtml"/g,"").replace(/^<([\w:.-]+)(?:\s+[\w:.-]+=(["'])[^]*?\2)*\s*(?:\/>|>([^]*)<\/\1>)$/g,"$3").replace(/(<([\w:.-]+)(?:\s[^>]*|))><\/\2>/g,"$1 />").replace(/(<(output)(?:\s[^>]*|))>([\w\W]+)<\/output>/g,"$1 />$3").replace(/&nbsp;|\xa0/g," ").replace(/ xmlns:vellum="http:\/\/commcarehq.org\/xforms\/vellum"([ \/>])/g,"$1")}function l(e){return e.replace(/<(([\w:.-]+)(?:\s[^>]*|))\/>/g,"<$1></$2>")}const d={humanize:function(e,t){return e?r.Ay.isString(e)&&-1===e.indexOf("&")&&!/<([\w:.-]+)(?:\s[^>]*|)><\/\1>/.test(e)?e:s(e,t).replace(/(?:&lt;(=?\s)|(\s)&gt;|&amp;([^&;\s]+;|.|$))/g,(function(e,t,n,a){return t?"<"+t:n?n+">":";"===a.slice(a.length-1)?e:"&"+a})):""},normalize:s,parseXML:function(e){return e?(e=e.replace(/<(h:)?html\b/,"<h:xdoc").replace(/<\/(h:)?html\b>/,"</h:xdoc>"),i()(i().parseXML(e))):i()()},query:function(e){var t,n='<xml xmlns="http://www.w3.org/1999/xhtml" xmlns:vellum="http://commcarehq.org/xforms/vellum">'+(e=l(e))+"</xml>";try{t=i()(i().parseXML(n))}catch(n){t=i()("<xml></xml>").html(e)}return t.toString=function(){return(new XMLSerializer).serializeToString(t[0]).replace(/^<xml\b[^>]*>/,"").replace(/<\/xml>$/,"").replace(/(<([\w:.-]+)(?:\s[^>]*|))><\/\2>/g,"$1 />").replace(/(<(output)(?:\s[^>]*|))>([\w\W]+)<\/output>/g,"$1 />$3").replace(/"\/>/g,'" />').replace(/&nbsp;|\xa0/g," ")},t},xhtml:o}},7867:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var a=n(2776),i=n.n(a);const r={makeXPathModels:function(e,t){return t=t||function(e){return e},i().makeXPathModels(t({isValidNamespace:function(t){return e.hashtagNamespaces.hasOwnProperty(t)},hashtagToXPath:function(t){var n=e.hashtagMap[t];if(n)return n;var a=t.lastIndexOf("/");if(-1!==a){var i=t.substring(0,a+1),r=t.substring(a+1);if(e.hashtagTransformations.hasOwnProperty(i))return e.hashtagTransformations[i](r)}return t},toHashtag:function(t){var n=t.toXPath();return e.invertedHashtagMap.hasOwnProperty(n)?e.invertedHashtagMap[n]:null}}))},createParser:function(e){var t=new(i().Parser);return t.yy.xpathmodels=e,t.models=t.yy.xpathmodels,t},parser:function(e,t){var n=this.makeXPathModels(e,t);return this.createParser(n)}}},8819:e=>{"use strict";e.exports="data:image/gif;base64,R0lGODlhCwAHAIAAACgoKP///yH5BAEAAAEALAAAAAALAAcAAAINjI+AC7rWHIsPtmoxLAA7"},8612:e=>{"use strict";e.exports="data:image/gif;base64,R0lGODlhCwAHAIAAACgoKP///yH5BAEAAAEALAAAAAALAAcAAAIORI4JlrqN1oMSnmmZDQUAOw=="},4095:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAkCAMAAAB/qqA+AAAABlBMVEUAAAAAAAClZ7nPAAAAAnRSTlMNAMM9s3UAAAAXSURBVHjajcEBAQAAAIKg/H/aCQZ70AUBjAATb6YPDgAAAABJRU5ErkJggg=="},2466:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAACAQMAAABv1h6PAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjAAMHBgAAiABBI4gz9AAAAABJRU5ErkJggg=="},1037:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAACAQMAAAB49I5GAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjAAMOBgAAGAAJMwQHdQAAAABJRU5ErkJggg=="},7475:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAACAQMAAAAD0EyKAAAABlBMVEUAAAAdHRvEkCwcAAAAAXRSTlMAQObYZgAAAAxJREFUCNdjgIIGBgABCgCBvVLXcAAAAABJRU5ErkJggg=="},3010:e=>{"use strict";e.exports="data:image/svg+xml;utf8,<svg xmlns=%27http://www.w3.org/2000/svg%27><filter id=%27jstree-grayscale%27><feColorMatrix type=%27matrix%27 values=%270.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0%27/></filter></svg>#jstree-grayscale"},477:()=>{}}]);