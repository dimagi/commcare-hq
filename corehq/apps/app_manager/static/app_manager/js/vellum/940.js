"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[940],{1134:(t,e,n)=>{n.d(e,{A:()=>U});var o=n(8449),r=n(8324),a=n.n(r),l=n(6848),s=n.n(l),i=n(3794),u=n.n(i),d=n(4523),m=n(561),c=n.n(m),h=n(1437),p=n.n(h),g=n(3809),f=n.n(g),x=n(705),v=n.n(x),w=n(7229),A=n.n(w),j=(n(1460),n(8803),a().assert),q=["Form Builder clip","version 1"];function y(t,e,n){if((n=d.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var o=A().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+o+'"')}var r,a,l,i,u=(r=t,a=e,l=s().xml(r),i=s().xml(a),s().isEquivalent(l,i,{element_order:!0}));n.not&&(u=!u),u||b(t=X(t),e=X(e),"XML "+(n.not?"should not be equivalent":"mismatch"))}function b(t,e,n){if(t!==e){var o=u().createPatch("",t,e,"actual","expected");o=o.replace(/^Index:/,n||"Not equal:"),j(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(o))}}function X(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function M(t){return L("getCurrentMugInput",t)}function E(t){var e=c()("#vellum").vellum("get"),n=d.Ay.isString(t)?c()("[name="+t+"]"):t;return v().util.getWidget(n,e)}function L(){var t=Array.prototype.slice.call(arguments),e=c()("#vellum");return e.vellum.apply(e,t)}function F(){var t=[],e=d.Ay.map(arguments,(function(e){var n=d.Ay.isString(e)?_(e):e;if(!n||!n.ufid)throw new Error("mug not found: "+e);return t.push(n),n.ufid}));return L("jstree","deselect_all",!0),L("jstree","select_node",e),c()(".collapse-toggle.collapsed").click(),t}function _(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=L("getMugByPath",t);if(!e){var n=t.split("/"),o=L("getMugByPath",n.slice(0,-1).join("/"));if(o&&o.__className.indexOf("Select")>-1){var r=L("getData").core.form.getChildren(o),a=n[n.length-1];if(1===r.length&&"itemset"===a&&"itemset"===r[0].options.tagName)return r[0];for(var l=0;l<r.length;l++)if(r[l].p.nodeID===a)return r[l]}}return e}j.equal=j.strictEqual,j.notEqual=j.notStrictEqual;const U={options:o.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=c().extend(!0,{},o.A.options,t),n=c().fn.animate;c().fn.animate=function(t,e,o,r){n.apply(this,[t,0,o,r])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=d.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&d.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var r=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,r(t)};var a=c()("#vellum"),l=a.vellum("get");l&&(l.destroy(),c()("body > div.modal, body > div.modal-backdrop").remove()),a.empty().vellum(e)},call:L,loadXML:function(t,e,n,o){var r=[],a=L("getData");return o||window.history.replaceState(null,null," "),a.core.parseWarnings=[],L("loadXML",t,e||{}),n?d.Ay.isRegExp(n)&&(r=d.Ay.filter(a.core.parseWarnings,(function(t){return!n.test(t)}))):r=a.core.parseWarnings,j(!r.length,"unexpected parse warnings:\n- "+r.join("\n- ")),delete a.core.parseWarnings,a.core.form},saveAndReload:function(t){L("loadXFormOrError",L("createXML"),t)},getMug:_,getInput:M,getWidget:E,getMediaUploader:function(t){var e,n={},o=E(t);if(!o)throw new Error("media uploader widget not found");if(d.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(e=t.closest(n)).length})),!e)throw new Error("media uploader element not found");return n.upload=function(t){var n={ref:{path:o.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",n)},n},assertEqual:b,assertInputCount:function(t,e,n){d.Ay.isString(t)?(n=" for "+(n?n+" ":"")+t,t=M(t)):n=n?" for "+n:"",j.equal(t.length,e,"wrong number of inputs"+n)},assertXmlEqual:y,assertXmlNotEqual:function(t,e,n){(n=n||{}).not=!0,y(t,e,n)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";b(function t(e,n){var o,r,a,l=[];for("#"===e.id?n=-1:l.push(Array(2*n+1).join(" ")+e.text),o=0,r=e.children.length;o<r;o++)a=L("jstree","get_node",e.children[o]),l.push(t(a,n+1));return l.join("\n")}(L("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";b(function t(e,n){var o,r,a,l=[];for(e.isRootNode?n=-1:l.push(Array(2*n+1).join(" ")+e.value.p.nodeID),o=0,r=e.children.length;o<r;o++)a=e.children[o],l.push(t(a,n+1));return l.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,n){n=d.Ay.extend({},n),this.prevId&&F(this.prevId);var o=L("addQuestion",t);return e||o.p.nodeID||(e=L("nodeIDFromLabel",o)),e&&(j(d.Ay.isUndefined(n.nodeID),"unexpected attribute for "+t+"["+e+"]"),o.p.labelItext&&o.p.labelItext.set(o.getLabelValue()),o.p.nodeID=e,"Choice"!==t||n.hasOwnProperty("labelItext")||(n.labelItext=e)),d.Ay.each(n,(function(t,e){d.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?o.p[e].set(t):o.p[e]=t})),d.Ay.each(L("getSections",o),(function(t){L("collapseSection",t.slug,!1)})),o},paste:function(t,e,n){d.Ay.isString(t)||(t=f().tabDelimit([q].concat(t))),n&&window.console.log(t),j.deepEqual(p().paste(t),e||[])},clickQuestion:F,selectAll:function(){L("jstree","select_all")},deleteQuestion:function(){var t=d.Ay.map(arguments,(function(t){var e=_(t);return j(e,"mug not found: "+t),e}));L("getData").core.form.removeMugsFromForm(t),d.Ay.each(arguments,(function(t){j(!_(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=L("getData").core.saveButton;if(!d.Ay.isUndefined(t)){var n=t?"save":"saved";e.setStateWhenReady(n),j.equal(e.state,n,"sanity check failed")}return"save"===e.state},expandGroup:function(t){L("jstree","open_node",t.ufid),L("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){L("jstree","close_node",t.ufid),L("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],n=null;if(d.Ay.isString(t)){var o=t;t=_(o),j(t,"mug not found: "+o)}return t.messages.each((function(t,o){o!==n&&(e.push(o+":"),n=o),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,n){if(d.Ay.isString(e)){var o=e;e=function(t){return t.text===o}}return function n(o){var r,a,l;if(e(o))return o;for(r=0,a=o.children.length;r<a;r++)if(l=n(t.get_node(o.children[r])))return l;return null}(n||t.get_node("#"))},isTreeNodeValid:function(t){if(d.Ay.isString(t)){var e=t;t=_(e),j(t,"mug not found: "+e)}return 0===c()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return c()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:A().parseXML}},6940:(t,e,n)=>{var o=n(8324),r=n.n(o),a=n(561),l=n.n(a),s=n(1134);const i='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum" vellum:ignore="richText markdown">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/145B4E0A-2CE5-48A2-B0E0-8D1585CFCA47" uiVersion="1" version="1" name="Untitled Form" />\n\t\t\t</instance>\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default=""/>\n\t\t\t\t<translation lang="hin"/>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body />\n</h:html>\n',u='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/05E42EAF-BBD2-4BE1-9B58-45C09C1DA524" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<group jr:template="" />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default=""/>\n\t\t\t\t<translation lang="hin"/>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group>\n\t\t\t<repeat vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t</group>\n\t</h:body>\n</h:html>\n',d='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/145B4E0A-2CE5-48A2-B0E0-8D1585CFCA47" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<group jr:template="">\n\t\t\t\t\t\t<question2 />\n\t\t\t\t\t</group>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<bind vellum:nodeset="#form/group/question2" nodeset="/data/group/question2" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default=""/>\n\t\t\t\t<translation lang="hin"/>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group>\n\t\t\t<repeat vellum:nodeset="#form/group" nodeset="/data/group" jr:count="3" jr:noAddRemove="true()">\n\t\t\t\t<input vellum:ref="#form/group/question2" ref="/data/group/question2"/>\n\t\t\t</repeat>\n\t\t</group>\n\t</h:body>\n</h:html>\n';var m=n(6276),c=r().assert;describe("The XML writer",(function(){beforeEach((function(t){s.A.init({core:{onReady:function(){t()}}})})),it("should not set jr:noAddRemove on repeat group without count",(function(){s.A.addQuestion("Repeat","group"),s.A.assertXmlEqual(s.A.call("createXML"),u,{normalize_xmlns:!0})})),it("should not set jr:noAddRemove on repeat group without count even when jr:noAddRemove is true",(function(){s.A.addQuestion("Repeat","group").p.no_add_remove=!0,s.A.assertXmlEqual(s.A.call("createXML"),u,{normalize_xmlns:!0})})),it("should remove jr:noAddRemove attribute when its value was false()",(function(){s.A.call("loadXML",'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/05E42EAF-BBD2-4BE1-9B58-45C09C1DA524" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<group jr:template="" />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default=""/>\n\t\t\t\t<translation lang="hin"/>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group>\n\t\t\t<repeat vellum:nodeset="#form/group" nodeset="/data/group" jr:noAddRemove="false()" />\n\t\t</group>\n\t</h:body>\n</h:html>\n'),s.A.assertXmlEqual(s.A.call("createXML"),u,{normalize_xmlns:!0})})),it("should preserve jr:noAddRemove='true()' when jr:count has a value",(function(){s.A.call("loadXML",d),s.A.assertXmlEqual(s.A.call("createXML"),d,{normalize_xmlns:!0})})),it("should change jr:noAddRemove to 'true()' when jr:count has a value",(function(){s.A.call("loadXML",'<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/145B4E0A-2CE5-48A2-B0E0-8D1585CFCA47" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<group jr:template="">\n\t\t\t\t\t\t<question2 />\n\t\t\t\t\t</group>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<bind vellum:nodeset="#form/group/question2" nodeset="/data/group/question2" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default=""/>\n\t\t\t\t<translation lang="hin"/>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group>\n\t\t\t<repeat vellum:nodeset="#form/group" nodeset="/data/group" jr:count="3" jr:noAddRemove="false()">\n\t\t\t\t<input vellum:ref="#form/group/question2" ref="/data/group/question2"/>\n\t\t\t</repeat>\n\t\t</group>\n\t</h:body>\n</h:html>\n'),s.A.assertXmlEqual(s.A.call("createXML"),d,{normalize_xmlns:!0})})),it("should add hashtag reference to jr:count",(function(){s.A.loadXML(""),s.A.addQuestion("Int");var t=s.A.addQuestion("Repeat");s.A.addQuestion("Text"),t.p.repeat_count="#form/question1",s.A.assertXmlEqual(s.A.call("createXML"),m,{normalize_xmlns:!0})})),it("should be able to ignore both richText and markdown",(function(){var t=s.A.loadXML(i);c(!t.richText,"richText should be disabled"),c(t.noMarkdown,"markdown should be disabled"),s.A.assertXmlEqual(s.A.call("createXML"),i,{normalize_xmlns:!0})})),it("should still save more than once",(function(){s.A.call("loadXML",""),s.A.addQuestion("FieldList","fieldlist"),s.A.addQuestion("Text","text1"),s.A.addQuestion("Text","text2"),s.A.addQuestion("Text","text3"),s.A.addQuestion("Text","text4"),s.A.call("createXML"),s.A.deleteQuestion("/data/fieldlist/text1"),s.A.call("createXML")})),it("should not write empty itext ref",(function(){s.A.loadXML(""),s.A.addQuestion("Select","select");var t=s.A.addQuestion("Choice","blank",{labelItext:""});c.equal(t.p.labelItext.get(),"");var e=l()(s.A.call("createXML"));c.equal(e.find("text[id=select-blank-label]").length,0,"should not write select-blank-label itext item"),c.equal(e.find("label").attr("ref"),void 0,"item label ref should not be defined")}))}))},6276:t=>{t.exports='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/6830242E-8941-4752-BF6F-F40F4C964878" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<question1 />\n\t\t\t\t\t<question2 jr:template="">\n\t\t\t\t\t\t<question3 />\n\t\t\t\t\t</question2>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:int" />\n\t\t\t<bind vellum:nodeset="#form/question2" nodeset="/data/question2" />\n\t\t\t<bind vellum:nodeset="#form/question2/question3" nodeset="/data/question2/question3" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="" />\n\t\t\t\t<translation lang="hin" />\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/question1" ref="/data/question1"/>\n\t\t<group>\n\t\t\t<repeat vellum:jr__count="#form/question1" jr:count="/data/question1" jr:noAddRemove="true()" vellum:nodeset="#form/question2" nodeset="/data/question2">\n\t\t\t\t<input vellum:ref="#form/question2/question3" ref="/data/question2/question3"/>\n\t\t\t</repeat>\n\t\t</group>\n\t</h:body>\n</h:html>\n'}}]);