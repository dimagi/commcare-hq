"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[455],{5455:(t,e,n)=>{var r=n(4523),a=n(8324),o=n.n(a),i=n(8916),s=n.n(i),l=n(1134);const u='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/939C596B-AD0C-4BB8-8717-F00707F71909" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<text />\n\t\t\t\t\t<hidden />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/text" nodeset="/data/text" type="xsd:string" vellum:relevant="#invalid/xpath (`#form/hidden`" relevant="(/data/hidden" />\n\t\t\t<bind vellum:nodeset="#form/hidden" nodeset="/data/hidden" vellum:calculate="#form/text" calculate="/data/text" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default=""/>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/text" ref="/data/text"/>\n\t</h:body>\n</h:html>\n';var d=o().assert;describe("The escaped hashtag parser",(function(){function t(t){var e=t.split("/");return e[e.length-1]}var e={"#form/text1":"/data/text1","#form/text2":"/data/text2"},n={hashtagMap:e,invertedHashtagMap:r.Ay.invert(e),hashtagNamespaces:{form:!0,case:!0}};describe("#transform()",(function(){[["`#case/type/prop`","#case/type/prop","prop"],["`#case/type/prop`- 1","#case/type/prop - 1","prop - 1"],["(`#case/type/prop`)","(#case/type/prop)","(prop)"],["(`#case/type/prop`","(#case/type/prop","(prop"],["`#case/type/prop` = `#case/type/prop2`","#case/type/prop = #case/type/prop2","prop = prop2"],["``","`","`"],["ðŸŠyou glad I didn't use ðŸŒ`","ðŸŠyou glad I didn't use ðŸŒ`","ðŸŠyou glad I didn't use ðŸŒ`"],["`ðŸ ","`ðŸ ","`ðŸ "],["`#case/type/prop` = `","#case/type/prop = `","prop = `"],["`#case/type/prop` = ``","#case/type/prop = `","prop = `"],["`#case/prop1``#case/prop2` = ``","#case/prop1#case/prop2 = `","prop1prop2 = `"],["``#case/type/``prop` = ``","`#case/type/`prop = `","`#case/type/`prop = `"]].forEach((function(e){var n=e[0],r=e[1],a=e[2];it("default transform should parse "+n+" into "+r,(function(){d.strictEqual(s().transform(n),r)})),it("custom transform should parse "+n+" into "+a,(function(){d.strictEqual(s().transform(n,t),a)}))}))})),describe("#makeHashtagTransform() with #delimit()",(function(){var t=s().makeHashtagTransform(n),e=s().delimit;[["#form/text1","`#form/text1`"],["/data/text1","`#form/text1`"],["`#form/text1`","`#form/text1`"],["#form/text1 -1","`#form/text1` - 1"],["/data/text1 -1","`#form/text1` - 1"],["`#form/text1`-1","`#form/text1`-1"]].forEach((function(n){it("should parse "+n[0]+" into "+n[1],(function(){d.strictEqual(t(n[0],e),n[1])}))}))}))})),describe("The form's escaped hashtag parser with rich_text disabled",(function(){before((function(t){l.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t()}},features:{rich_text:!1}})})),it("reads invalid xpath with #invalid",(function(){l.A.loadXML(u);var t=l.A.getMug("text"),e=l.A.getMug("hidden");d.strictEqual(t.p.relevantAttr,"(/data/hidden"),d.strictEqual(e.p.calculateAttr,"#form/text")}))})),describe("The escaped hashtag",(function(){before((function(t){l.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t()}}})})),it("writes invalid xpath with #invalid",(function(){l.A.loadXML("");var t=l.A.addQuestion("Text","text"),e=l.A.addQuestion("DataBindOnly","hidden");t.p.relevantAttr="#invalid/xpath (`#form/hidden`",e.p.calculateAttr="#form/text",l.A.assertXmlEqual(l.A.call("createXML"),u,{normalize_xmlns:!0})}))}))},1134:(t,e,n)=>{n.d(e,{A:()=>X});var r=n(8449),a=n(8324),o=n.n(a),i=n(6848),s=n.n(i),l=n(3794),u=n.n(l),d=n(4523),c=n(561),p=n.n(c),f=n(1437),m=n.n(f),h=n(3809),g=n.n(h),v=n(705),x=n.n(v),y=n(7229),A=n.n(y),w=(n(1460),n(8803),o().assert),b=["Form Builder clip","version 1"];function j(t,e,n){if((n=d.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var r=A().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+r+'"')}var a,o,i,l,u=(a=t,o=e,i=s().xml(a),l=s().xml(o),s().isEquivalent(i,l,{element_order:!0}));n.not&&(u=!u),u||E(t=M(t),e=M(e),"XML "+(n.not?"should not be equivalent":"mismatch"))}function E(t,e,n){if(t!==e){var r=u().createPatch("",t,e,"actual","expected");r=r.replace(/^Index:/,n||"Not equal:"),w(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(r))}}function M(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function q(t){return I("getCurrentMugInput",t)}function _(t){var e=p()("#vellum").vellum("get"),n=d.Ay.isString(t)?p()("[name="+t+"]"):t;return x().util.getWidget(n,e)}function I(){var t=Array.prototype.slice.call(arguments),e=p()("#vellum");return e.vellum.apply(e,t)}function S(){var t=[],e=d.Ay.map(arguments,(function(e){var n=d.Ay.isString(e)?k(e):e;if(!n||!n.ufid)throw new Error("mug not found: "+e);return t.push(n),n.ufid}));return I("jstree","deselect_all",!0),I("jstree","select_node",e),p()(".collapse-toggle.collapsed").click(),t}function k(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=I("getMugByPath",t);if(!e){var n=t.split("/"),r=I("getMugByPath",n.slice(0,-1).join("/"));if(r&&r.__className.indexOf("Select")>-1){var a=I("getData").core.form.getChildren(r),o=n[n.length-1];if(1===a.length&&"itemset"===o&&"itemset"===a[0].options.tagName)return a[0];for(var i=0;i<a.length;i++)if(a[i].p.nodeID===o)return a[i]}}return e}w.equal=w.strictEqual,w.notEqual=w.notStrictEqual;const X={options:r.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=p().extend(!0,{},r.A.options,t),n=p().fn.animate;p().fn.animate=function(t,e,r,a){n.apply(this,[t,0,r,a])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=d.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&d.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var a=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,a(t)};var o=p()("#vellum"),i=o.vellum("get");i&&(i.destroy(),p()("body > div.modal, body > div.modal-backdrop").remove()),o.empty().vellum(e)},call:I,loadXML:function(t,e,n,r){var a=[],o=I("getData");return r||window.history.replaceState(null,null," "),o.core.parseWarnings=[],I("loadXML",t,e||{}),n?d.Ay.isRegExp(n)&&(a=d.Ay.filter(o.core.parseWarnings,(function(t){return!n.test(t)}))):a=o.core.parseWarnings,w(!a.length,"unexpected parse warnings:\n- "+a.join("\n- ")),delete o.core.parseWarnings,o.core.form},saveAndReload:function(t){I("loadXFormOrError",I("createXML"),t)},getMug:k,getInput:q,getWidget:_,getMediaUploader:function(t){var e,n={},r=_(t);if(!r)throw new Error("media uploader widget not found");if(d.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(e=t.closest(n)).length})),!e)throw new Error("media uploader element not found");return n.upload=function(t){var n={ref:{path:r.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",n)},n},assertEqual:E,assertInputCount:function(t,e,n){d.Ay.isString(t)?(n=" for "+(n?n+" ":"")+t,t=q(t)):n=n?" for "+n:"",w.equal(t.length,e,"wrong number of inputs"+n)},assertXmlEqual:j,assertXmlNotEqual:function(t,e,n){(n=n||{}).not=!0,j(t,e,n)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";E(function t(e,n){var r,a,o,i=[];for("#"===e.id?n=-1:i.push(Array(2*n+1).join(" ")+e.text),r=0,a=e.children.length;r<a;r++)o=I("jstree","get_node",e.children[r]),i.push(t(o,n+1));return i.join("\n")}(I("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";E(function t(e,n){var r,a,o,i=[];for(e.isRootNode?n=-1:i.push(Array(2*n+1).join(" ")+e.value.p.nodeID),r=0,a=e.children.length;r<a;r++)o=e.children[r],i.push(t(o,n+1));return i.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,n){n=d.Ay.extend({},n),this.prevId&&S(this.prevId);var r=I("addQuestion",t);return e||r.p.nodeID||(e=I("nodeIDFromLabel",r)),e&&(w(d.Ay.isUndefined(n.nodeID),"unexpected attribute for "+t+"["+e+"]"),r.p.labelItext&&r.p.labelItext.set(r.getLabelValue()),r.p.nodeID=e,"Choice"!==t||n.hasOwnProperty("labelItext")||(n.labelItext=e)),d.Ay.each(n,(function(t,e){d.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?r.p[e].set(t):r.p[e]=t})),d.Ay.each(I("getSections",r),(function(t){I("collapseSection",t.slug,!1)})),r},paste:function(t,e,n){d.Ay.isString(t)||(t=g().tabDelimit([b].concat(t))),n&&window.console.log(t),w.deepEqual(m().paste(t),e||[])},clickQuestion:S,selectAll:function(){I("jstree","select_all")},deleteQuestion:function(){var t=d.Ay.map(arguments,(function(t){var e=k(t);return w(e,"mug not found: "+t),e}));I("getData").core.form.removeMugsFromForm(t),d.Ay.each(arguments,(function(t){w(!k(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=I("getData").core.saveButton;if(!d.Ay.isUndefined(t)){var n=t?"save":"saved";e.setStateWhenReady(n),w.equal(e.state,n,"sanity check failed")}return"save"===e.state},expandGroup:function(t){I("jstree","open_node",t.ufid),I("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){I("jstree","close_node",t.ufid),I("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],n=null;if(d.Ay.isString(t)){var r=t;t=k(r),w(t,"mug not found: "+r)}return t.messages.each((function(t,r){r!==n&&(e.push(r+":"),n=r),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,n){if(d.Ay.isString(e)){var r=e;e=function(t){return t.text===r}}return function n(r){var a,o,i;if(e(r))return r;for(a=0,o=r.children.length;a<o;a++)if(i=n(t.get_node(r.children[a])))return i;return null}(n||t.get_node("#"))},isTreeNodeValid:function(t){if(d.Ay.isString(t)){var e=t;t=k(e),w(t,"mug not found: "+e)}return 0===p()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return p()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:A().parseXML}}}]);