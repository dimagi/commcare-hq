{"version":3,"file":"0.be2acfb94e0f833155a5.js","mappings":"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AC,MAAO,OAChBiG,OAAQH,EAAIO,WAAW,CACnBN,EACA,CACI,KACA,OACA,wBACA,yBACA,cACD,CACC,OACA,SACA,YACA,YACA,QACD,CACC,WACA,SACA,MACA,MACA,aACD,CACC,UACA,SACA,KACA,KACA,YACD,CACC,OACA,SACA,cACA,cACA,QACD,CACC,WACA,SACA,MACA,MACA,aACD,CACC,UACA,SACA,KACA,KACA,eAGT,CACCI,QAAS,mCACT9N,IAAKmN,EACLS,OAAQH,EAAIO,WAAW,CACnBN,EACA,CACI,KACA,OACA,wBACA,yBACA,sBACA,uBACA,uBACA,wBACA,sBACA,uBACA,qBACA,sBACA,sBACA,uBACA,sBACA,uBACA,aACA,gCACA,iCACA,uBACA,wBACA,qBACA,sBACA,qBACA,sBACA,qBACA,sBACA,YACA,uBACA,wBACA,YACA,iBACA,oBACA,aACD,CACC,QACA,OACA,UACA,UACA,yCACA,yCACA,SACA,SACA,yCACA,yCACA,OACA,OACA,QACA,QACA,yCACA,yCACA,gBACA,QACA,QACA,OACA,OACA,8CACA,8CACA,8CACA,8CACA,8CACA,8CACA,eACA,OACA,OACA,eACA,QACA,iCACA,mBAIb,SAAUgB,GACTrP,GAAG,eAAiBqP,EAAKZ,SAAS,WAC9BjQ,EAAKyB,QAAQoP,EAAK1O,KACd0O,EAAK/G,QACL9J,EAAKU,cAAciK,MAAM,KAAMkG,EAAK/G,QAExCgG,EAAGH,EAAImB,OAAQD,EAAKd,OACxB,IAEAvO,GAAG,gBAAkBqP,EAAKZ,SAAS,WAC/BjQ,EAAKyB,QAAQ,IACbjB,EAAOgG,UAAUmJ,EAAI1F,MAAM4G,EAAKd,QAAS,IACzC/P,EAAK4C,eAAenC,EAAK,aAAcoQ,EAAK1O,IAAK,CAACoL,iBAAiB,GACvE,GACJ,IAEA/L,GAAG,6CAA6C,WAC5CxB,EAAKyB,QAAQ4N,GACbrP,EAAKU,cAAc,aAAc,gBACjCoP,EAAGH,EAAImB,OAAQ,CACX,CACI,KACA,OACA,wBACA,yBACA,sBACA,uBACA,cACD,CACC,cACA,OACA,kBACA,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","sources":["webpack://vellum/./tests/advancedItemsets.js","webpack://vellum/./tests/atwho.js","webpack://vellum/./tests/base.js","webpack://vellum/./tests/bulkActions.js","webpack://vellum/./tests/commander.js","webpack://vellum/./tests/commcareConnect.js","webpack://vellum/./tests/commtrack.js","webpack://vellum/./tests/copy-paste.js","webpack://vellum/./tests/core.js","webpack://vellum/./tests/databrowser.js","webpack://vellum/./tests/datasources.js","webpack://vellum/./tests/diffDataParent.js","webpack://vellum/./tests/escapedHashtags.js","webpack://vellum/./tests/exporter.js","webpack://vellum/./tests/expressionEditor.js","webpack://vellum/./tests/form.js","webpack://vellum/./tests/formdesigner.ignoreButRetain.js","webpack://vellum/./tests/formdesigner.lock.js","webpack://vellum/./tests/intentManager.js","webpack://vellum/./tests/itemset.js","webpack://vellum/./tests/javaRosa.js","webpack://vellum/./tests/jquery-extensions.js","webpack://vellum/./tests/logic.js","webpack://vellum/./tests/markdown.js","webpack://vellum/./tests/modeliteration.js","webpack://vellum/./tests/mugs.js","webpack://vellum/./tests/options.js","webpack://vellum/./tests/parser.js","webpack://vellum/./tests/questionProperties.js","webpack://vellum/./tests/questionTypes.js","webpack://vellum/./tests/richText.js","webpack://vellum/./tests/saveToCase.js","webpack://vellum/./tests/setvalue.js","webpack://vellum/./tests/tsv.js","webpack://vellum/./tests/undomanager.js","webpack://vellum/./tests/urlHash.js","webpack://vellum/./tests/utils.js","webpack://vellum/./tests/widgets.js","webpack://vellum/./tests/writer.js","webpack://vellum/./tests/xml.js"],"sourcesContent":["define([\n    'tests/options',\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/itemset',\n    'vellum/form',\n    'static/itemset/test1.xml',\n    'static/itemset/inner-filters.xml'\n], function (\n    options,\n    util,\n    chai,\n    $,\n    _,\n    itemset,\n    form,\n    TEST_XML_1,\n    INNER_FILTERS_XML\n) {\n\n    var assert = chai.assert,\n        call = util.call,\n        clickQuestion = util.clickQuestion,\n        plugins = _.union(util.options.options.plugins || [], [\"itemset\"]);\n\n    describe(\"The Advanced Itemset plugin\", function () {\n        function beforeFn(done) {\n            util.init({\n                plugins: plugins,\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n                features: {\n                    advanced_itemsets: true,\n                }\n            });\n        }\n        before(beforeFn);\n\n        it(\"adds a new instance node to the form when necessary\", function () {\n            util.loadXML(TEST_XML_1);\n            var itemset = util.getMug(\"question1/itemset\");\n            itemset.p.itemsetData = {\n                instance: {id: \"somefixture\", src: \"jr://somefixture\"},\n                nodeset: \"instance('somefixture')/some/items\",\n                labelRef: \"label\",\n                valueRef: \"value\",\n            };\n\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml);\n            assert($xml.find(\"instance[id=somefixture]\").length,\n                   \"somefixture instance not found:\\n\" + xml);\n        });\n\n        it(\"renames instance on add itemset with matching instance\", function () {\n            util.loadXML(TEST_XML_1);\n            util.addQuestion(\"SelectDynamic\", \"select2\");\n            var itemset = util.getMug(\"select2/itemset\");\n            itemset.p.itemsetData = {\n                instance: {id: \"cases\", src: \"jr://instance/casedb\"},\n                nodeset: \"instance('cases')/cases/case[@case_id > 2]\",\n                labelRef: \"label\",\n                valueRef: \"value\",\n            };\n\n            var data = itemset.p.itemsetData;\n            assert.equal(data.instance.id, \"casedb\");\n            assert.equal(data.instance.src, \"jr://instance/casedb\");\n            assert.equal(data.nodeset, \"instance('casedb')/cases/case[@case_id > 2]\");\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml);\n            assert($xml.find(\"instance[id=casedb]\").length,\n                   \"casedb instance not found:\\n\" + xml);\n            assert($xml.find(\"instance[id=cases]\").length === 0,\n                   \"cases instance should have been renamed/merged:\\n\" + xml);\n        });\n\n        describe(\"parsing and serializing\", function () {\n            before(beforeFn);\n            it(\"preserves XML with itemsets in <select>s\", function () {\n                assert(TEST_XML_1.indexOf('select1') !== -1);\n                util.loadXML(TEST_XML_1);\n                util.assertXmlEqual(call('createXML'), TEST_XML_1);\n            });\n\n            it(\"preserves XML with itemsets in <select1>s\", function () {\n                var newXml = TEST_XML_1.replace(/select1/g, 'select');\n                util.loadXML(newXml);\n                util.assertXmlEqual(call('createXML'), newXml);\n            });\n        });\n\n        describe(\"UI\", function () {\n            before(beforeFn);\n            it(\"preserves inner filters if you never change the data source\", function () {\n                util.loadXML(INNER_FILTERS_XML);\n                clickQuestion(\"question2/itemset\");\n                $(\"[name=property-labelRef]\").val(\"dummy\").change();\n\n                util.assertXmlEqual(\n                    INNER_FILTERS_XML.replace('case_name', 'dummy'),\n                    call('createXML')\n                );\n            });\n\n            it(\"includes filter when in advanced mode\", function() {\n                util.loadXML(TEST_XML_1);\n                clickQuestion(\"question1/itemset\");\n                var mug = util.getMug(\"question1/itemset\");\n                mug.p.filter = \"'blah' = /data/question2\";\n                $(\"button:contains(...)\").click();\n                assert($('[name=query]').val().indexOf(mug.p.filter) > 1);\n            });\n\n            it(\"changes filter when in advanced mode\", function() {\n                util.loadXML(TEST_XML_1);\n                clickQuestion(\"question1/itemset\");\n\n                var mug = util.getMug(\"question1/itemset\");\n                mug.p.filter = \"'blah' = /data/question2\";\n                $(\"button:contains(...)\").click();\n\n                var query = $('[name=query]').val();\n                $('[name=query]').val(query.replace(/question2/, \"no_question\")).change();\n                $('.fd-data-source-save-button').click();\n\n                assert.strictEqual(mug.p.filter,\n                                   \"'blah' = /data/no_question\");\n            });\n        });\n    });\n});\n","define([\n    'tests/utils',\n    'vellum/util',\n    'chai',\n    'jquery',\n    'underscore',\n    'static/atwho/test1.xml',\n], function (\n    util,\n    vellumUtil,\n    chai,\n    $,\n    _,\n    TEST1_XML\n) {\n    var assert = chai.assert,\n        dataSources = [\n            {\n                id: \"commcaresession\",\n                uri: \"jr://instance/session\",\n                path: \"/session/data\",\n                name: 'Session',\n                structure: {\n                    \"case_id\": {\n                        reference: {\n                            hashtag: \"#case/child\",\n                            source: \"casedb\",\n                            subset: \"child\",\n                            subset_key: \"@case_type\",\n                            key: \"@case_id\",\n                        },\n                    },\n                },\n            }, {\n                id: \"casedb\",\n                uri: \"jr://instance/casedb\",\n                path: \"/cases/case\",\n                name: 'Cases',\n                structure: {\n                    name: {},\n                },\n                subsets: [{\n                    id: \"child\",\n                    key: \"@case_type\",\n                    structure: {\n                        dob: {},\n                    },\n                }]\n            },\n        ];\n\n    function getFuseData(string) {\n        var form = util.call('getData').core.form,\n            fuseRes = form.fuse.search(string);\n        return fuseRes.length ? fuseRes[0] : null;\n    }\n\n    function getDisplayedAtwhoViews() {\n        return $('.atwho-view').filter(function() {\n            return $(this).css('display') === 'block';\n        });\n    }\n\n    function assertNumAtwhoChoices(num) {\n        assert.strictEqual(getDisplayedAtwhoViews().find('li').length, num);\n    }\n\n    describe(\"atwho\", function() {\n        describe(\"without rich text\", function() {\n            before(function(done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: { form: TEST1_XML, onReady: function () { done(); } },\n                    features: {rich_text: false},\n                    plugins: ['atwho','modeliteration'],\n                });\n            });\n\n            function displayAtwho(callback) {\n                var mug = util.clickQuestion('one')[0];\n                // TODO: This shouldn't rely on relevantAttr\n                var input = $('[name=property-relevantAttr]');\n                input.focus();\n                input.val('/data/').keyup();\n                _.delay(function () {\n                    assert.strictEqual(getDisplayedAtwhoViews().length, 1);\n                    try {\n                        callback(mug);\n                    } catch (err) {\n                        throw err;\n                    } finally {\n                        mug.fire('teardown-mug-properties');\n                    }\n                    assert(!getDisplayedAtwhoViews().length);\n                });\n            }\n\n            it(\"should truncate the display label\", function() {\n                var mug = getFuseData('one');\n                assert.strictEqual(mug.displayLabel, \"One\");\n                mug = getFuseData('long');\n                assert.strictEqual(mug.displayLabel, \"This is going to be a rea&hellip;\");\n            });\n\n            it(\"should not show mugs without absolutePath\", function() {\n                displayAtwho(function(mug) {\n                    assert(!getDisplayedAtwhoViews().find('li:contains(\"choice1\")').length);\n                });\n            });\n\n            // only valid for small sets of questions\n            it(\"should have each mug\", function () {\n                displayAtwho(function(mug) {\n                    assertNumAtwhoChoices(3);\n                });\n            });\n\n            it(\"should destroy the atwho container on mug removal\", function() {\n                displayAtwho(function(mug) {\n                    mug.fire('teardown-mug-properties');\n                    assert(!getDisplayedAtwhoViews().length);\n                });\n            });\n\n            it(\"should not show itself in the results\", function () {\n                displayAtwho(function(mug) {\n                    assertNumAtwhoChoices(3);\n                });\n            });\n\n            it(\"should show questions with /data/\", function() {\n                displayAtwho(function(mug) {\n                    _.map(getDisplayedAtwhoViews().find('li'), function(li) {\n                        var text = $.trim($(li).text());\n                        assert(text.startsWith('/data/'));\n                    });\n                });\n            });\n        });\n\n        describe(\"with rich text\", function() {\n            // TODO: shouldn't rely on global widget\n            var widget;\n\n            beforeEach(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        form: \"\",\n                        dataSourcesEndpoint: function (callback) { callback(dataSources); },\n                        onReady: function() {\n                            util.addQuestion(\"Text\", 'dash-dash');\n                            util.addQuestion(\"Text\", 'text');\n                            util.addQuestion(\"Text\", 'text2');\n                            util.addQuestion(\"Text\", 'text3');\n                            // TODO: shouldn't rely on defaultValue\n                            widget = util.getWidget('property-defaultValue');\n                            widget.input.promise.then(function () { done(); });\n                        }\n                    },\n                    plugins: ['atwho','modeliteration', 'databrowser'],\n                });\n            });\n\n            function displayAtwho(query, callback) {\n                var mug = util.getMug('text3');\n                widget.setValue(query);\n                var editor = widget.input.editor;\n                editor.focus();\n                $('[name=property-defaultValue]').keyup();\n                assert.strictEqual(getDisplayedAtwhoViews().length, 1);\n                try {\n                    callback(mug);\n                } catch (err) {\n                    throw err;\n                } finally {\n                    mug.fire('teardown-mug-properties');\n                }\n                assert(!getDisplayedAtwhoViews().length);\n            }\n\n            it(\"should show questions with #form\", function() {\n                displayAtwho('#form', function(mug) {\n                    var atwhoEntries = getDisplayedAtwhoViews().find('li'),\n                        tags = _.map(atwhoEntries, function(li) {\n                            return $.trim($(li).text()).replace(/\\n[^]*$/, \"\");\n                        });\n                    assert.deepEqual(tags, [\n                        \"#form/dash-dash\",\n                        \"#form/text\",\n                        \"#form/text2\",\n                    ]);\n                });\n            });\n\n            it(\"should show questions after a dash\", function () {\n                displayAtwho('#dash-dash', function(mug) {\n                    var atwhoEntries = getDisplayedAtwhoViews().find('li'),\n                        tags = _.map(atwhoEntries, function(li) {\n                            return $.trim($(li).text()).replace(/\\n[^]*$/, \"\");\n                        });\n                    assert.deepEqual(tags, [\"#form/dash-dash\"]);\n                });\n            });\n\n            it(\"should show case properties with #case\", function() {\n                displayAtwho('#case', function(mug) {\n                    var atwhoEntries = getDisplayedAtwhoViews().find('li'),\n                        tags = _.map(atwhoEntries, function(li) {\n                            return $.trim($(li).text()).replace(/\\n[^]*$/, \"\");\n                        });\n                    assert.deepEqual(tags, [\"#case/child/dob\"]);\n                });\n            });\n\n            it(\"should show case properties and form questions with #\", function() {\n                displayAtwho('#', function(mug) {\n                    var atwhoEntries = getDisplayedAtwhoViews().find('li'),\n                        tags = _.map(atwhoEntries, function(li) {\n                            return $.trim($(li).text()).replace(/\\n[^]*$/, \"\");\n                        });\n                    assert.deepEqual(tags, [\n                        \"#case/child/dob\",\n                        \"#form/dash-dash\",\n                        \"#form/text\",\n                        \"#form/text2\",\n                    ]);\n                });\n            });\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils'\n], function (\n    chai,\n    $,\n    _,\n    util\n) {\n    var assert = chai.assert;\n\n    describe(\"The plugin manager\", function () {\n        it(\"should ignore unknown plugins\", function (done) {\n            util.init({\n                plugins: [\"plugin-will-not-be-found\"],\n                core: { onReady: function () {\n                    assert(!this.isPluginEnabled(\"plugin-will-not-be-found\"),\n                        \"loaded unknown plugin\");\n                    done();\n                }\n            }});\n        });\n    });\n});\n","define([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'vellum/richText',\n    'vellum/javaRosa/util',\n], function(\n    chai,\n    $,\n    _,\n    util\n) {\n    var assert = chai.assert,\n        CASE_DATA = [{\n            id: \"commcaresession\",\n            uri: \"jr://instance/session\",\n            path: \"/session\",\n            name: \"Session\",\n            structure: {\n                data: {\n                    merge: true,\n                    structure: {\n                        \"case_id\": {\n                            reference: {\n                                hashtag: \"#case\",\n                                source: \"casedb\",\n                                subset: \"case\",\n                                subset_key: \"@case_type\",\n                                key: \"@case_id\",\n                            },\n                        },\n                    },\n                },\n                context: {\n                    merge: true,\n                    structure: {\n                        \"userid\": {\n                            reference: {\n                                hashtag: \"#user\",\n                                source: \"casedb\",\n                                subset: \"commcare-user\",\n                                subset_key: \"@case_type\",\n                                subset_filter: true,\n                                key: \"hq_user_id\",\n                            },\n                        },\n                    },\n                },\n            },\n        }, {\n            id: \"casedb\",\n            uri: \"jr://instance/casedb\",\n            path: \"/casedb/case\",\n            name: \"Cases\",\n            structure: {\n                name: {},\n            },\n            subsets: [{\n                id: \"case\",\n                name: \"release\",\n                key: \"@case_type\",\n                structure: {\n                    release_date: {},\n                    release_length: {},\n                    contact_number: {},\n                    format: {},\n                    genres: {},\n                    case_name: {},\n                    quantity: {},\n                    footnote: {},\n                },\n            }, {\n                id: \"commcare-user\",\n                name: \"user\",\n                key: \"@case_type\",\n                structure: {\n                    role: {},\n                    footnote: {},\n                },\n            }],\n        }];\n\n\n    describe(\"Bulk form actions\", function() {\n\n        describe(\"should make all applicable questions required\", function () {\n            function test(qType, isRequired) {\n                var requiredStatus = isRequired ? \" is marked as required\" : \" is ignored\";\n                it(\"question \" + qType + requiredStatus, function () {\n                    var mug = map[qType];\n                    if (isRequired) {\n                        assert(mug.p.requiredAttr, \"required is false\");\n                    } else {\n                        assert(!mug.p.requiredAttr, \"required is true\");\n                    }\n                });\n            }\n            var form, map = {};\n            before(function () {\n                form = util.loadXML(\"\");\n                map.Text = util.addQuestion(\"Text\");\n                map.PhoneNumber = util.addQuestion(\"PhoneNumber\");\n                map.HiddenValue = util.addQuestion(\"DataBindOnly\");\n                map.Select = util.addQuestion(\"Select\");\n                map.Choice = util.addQuestion(\"Choice\");\n                map.Label = util.addQuestion(\"Trigger\");\n                map.Group = util.addQuestion(\"Group\", \"groupA\");\n                map.TextInGroup = util.addQuestion.bind({prevId: \"groupA\"})(\"Text\", 'text2');\n                map.DataBindOnlyInGroup = util.addQuestion.bind({prevId: \"groupA\"})(\"DataBindOnly\", 'hidden2');\n                form.vellum.makeAllQuestionsRequired();\n            });\n\n            test(\"Text\", true);\n            test(\"PhoneNumber\", true);\n            test(\"HiddenValue\", false);\n            test(\"Select\", true);\n            test(\"Choice\", false);\n            test(\"Label\", false);\n            test(\"Group\", false);\n            test(\"TextInGroup\", true);\n            test(\"DataBindOnlyInGroup\", false);\n        });\n\n        describe(\"should set matching case properties as default values on applicable question types\", function () {\n            var form, map = {};\n\n            function test(qType, isMatching, existingDefault) {\n                var defaultStatus = existingDefault ? \" matched the existing default value\" : \" was not applicable\",\n                    matchingStatus = isMatching ? \" matches the expected case property\" : defaultStatus;\n                it(\"the default value for \" + qType + matchingStatus, function () {\n                    var mug = map[qType];\n                    if (isMatching) {\n                        assert(mug.p.defaultValue === '#case/' + mug.p.nodeID, \"default value didn't match the case property\");\n                    } else if (existingDefault) {\n                        assert(mug.p.defaultValue === existingDefault, \"the default value changed\");\n                    } else {\n                        assert(!mug.p.defaultValue, \"the default value was set\");\n                    }\n                });\n            }\n\n            before(function (done) {\n                util.init({\n                    javaRosa: { langs: ['en'] },\n                    core: {\n                        dataSourcesEndpoint: function (callback) { callback(CASE_DATA); },\n                        onReady: function () {\n                            map.MatchingText = util.addQuestion(\"Text\", \"release_date\", {defaultValue: \"existing default\"});\n                            map.MatchingHiddenValue = util.addQuestion(\"DataBindOnly\", \"release_length\");\n                            map.MatchingPhoneNumber = util.addQuestion(\"PhoneNumber\", \"contact_number\");\n                            map.MatchingSelect = util.addQuestion(\"Select\", \"format\");\n                            map.ChoiceOfMatchingSelect = util.addQuestion(\"Choice\", \"vinyl\");\n                            map.Text = util.addQuestion(\"Text\", 'no_match_01', {defaultValue: \"already set\"});\n                            map.HiddenValue = util.addQuestion(\"DataBindOnly\", \"no_match_02\", {defaultValue: \"already set\"});\n                            map.Label = util.addQuestion(\"Trigger\", \"no_match_03\");\n                            map.Group = util.addQuestion(\"Group\", \"groupA\");\n                            map.MatchingTextInGroup = util.addQuestion.bind({prevId: \"groupA\"})(\"Text\", 'quantity', {defaultValue: \"existing default\"});\n                            map.MatchingHiddenValueInGroup = util.addQuestion.bind({prevId: \"groupA\"})(\"DataBindOnly\", 'genres');\n                            map.TextInGroup = util.addQuestion.bind({prevId: \"groupA\"})(\"Text\", 'no_match_04', {defaultValue: \"already set\"});\n                            map.HiddenValueInGroup = util.addQuestion.bind({prevId: \"groupA\"})(\"DataBindOnly\", 'no_match_05', {defaultValue: \"already set\"});\n                            map.userCaseProp = util.addQuestion(\"DataBindOnly\", \"role\");\n                            map.similarCaseProp = util.addQuestion(\"DataBindOnly\", \"footnote\");\n                            form = this.data.core.form;\n                            form.vellum.defaultMatchingQuestionsToCaseProperties();\n                            done();\n                        },\n                    },\n                });\n            });\n\n            test(\"MatchingText\", true);\n            test(\"MatchingHiddenValue\", true);\n            test(\"MatchingPhoneNumber\", true);\n            test(\"MatchingSelect\", true);\n            test(\"ChoiceOfMatchingSelect\", false);\n            test(\"Text\", false, \"already set\");\n            test(\"HiddenValue\", false, \"already set\");\n            test(\"Label\", false);\n            test(\"Group\", false);\n            test(\"MatchingTextInGroup\", true);\n            test(\"MatchingHiddenValueInGroup\", true);\n            test(\"TextInGroup\", false, \"already set\");\n            test(\"HiddenValueInGroup\", false, \"already set\");\n\n            it(\"user case properties are also matched with priority given to case properties\", function () {\n                assert(map.userCaseProp.p.defaultValue === '#user/' + map.userCaseProp.p.nodeID, \"user case property was not set as default\");\n                assert(map.similarCaseProp.p.defaultValue === '#case/' + map.similarCaseProp.p.nodeID, \"case property was not given priority over user case property\");\n            });\n\n        });\n\n    });\n});\n","define([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/commander',\n], function (\n    util,\n    chai,\n    $,\n    _,\n    commander\n) {\n    var assert = chai.assert;\n\n    describe(\"The commander plugin\", function() {\n        var vellum, mugTypes;\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                features: {rich_text: false},\n                core: {onReady: function() {\n                    vellum = this;\n                    mugTypes = commander.getQuestionMap(vellum);\n                    done();\n                }},\n            });\n        });\n\n        beforeEach(function () { util.loadXML(); });\n\n        _.each([\n            {cmd: \"text\", type: \"Text\"},\n            {cmd: \"text before\", type: \"Text\", index: 3},\n            {cmd: \"text after\", type: \"Text\", index: 3, select: \"group\"},\n            {cmd: \"text before #form/group\", type: \"Text\", index: 0},\n            {cmd: \"Text after #form/group\", type: \"Text\", index: 3},\n            {cmd: \"Text in #form/group\", type: \"Text\", index: 3, indent: \"  \"},\n            {cmd: \"Text before #form/group/select\", type: \"Text\", index: 1, indent: \"  \"},\n            {cmd: \"Text after #form/group/select\", type: \"Text\", index: 3, indent: \"  \"},\n            //{cmd: \"choice before #form/group/select/item\", type: \"Choice\", index: 2, indent: \"    \"},\n            //{cmd: \"Choice after #form/group/select/item\", type: \"Choice\", index: 3, indent: \"    \"},\n            {cmd: \"choice\", type: \"Choice\", index: 3, indent: \"    \", select: \"group/select\"},\n            {cmd: \"Choice in #form/group/select\", type: \"Choice\", index: 3, indent: \"    \"},\n            {cmd: \"Choice first in #form/group/select\", type: \"Choice\", index: 2, indent: \"    \"},\n        ], function (args) {\n            it(\"should add a \" + args.type + \" question with '\" + args.cmd + \"'\", function () {\n                util.paste([\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/group\", \"Group\", \"group\"],\n                    [\"/group/select\", \"Select\", \"select\"],\n                    [\"/group/select/item\", \"Choice\", \"item\"],\n                    [\"/text\", \"Text\", \"text\"],\n                ]);\n                if (args.select) {\n                    util.clickQuestion(args.select);\n                }\n                var result = commander.doCommand(args.cmd, vellum);\n                assert.isOk(result, \"question not added\");\n                $(\"[name=property-nodeID]\").val(\"new\").change();\n                vellum.ensureCurrentMugIsSaved();\n                var items = [\n                    \"group\",\n                    \"  select\",\n                    \"    item\",\n                    \"text\",\n                ];\n                if (args.hasOwnProperty(\"index\")) {\n                    items.splice(args.index, 0, (args.indent || \"\") + \"new\");\n                } else {\n                    items.push(\"new\");\n                }\n                util.assertJSTreeState.apply(null, items);\n                assert.equal(result.name, \"add question\");\n                assert.equal(result.value.__className, args.type);\n            });\n        });\n\n        _.each([\n            {cmd: \"text\", type: \"Text\"},\n            {cmd: \"text before\", type: \"Text\"},\n            {cmd: \"text after\", type: \"Text\"},\n            {cmd: \"text in\", type: \"Text\"},\n            {cmd: \"text first in\", type: \"Text\"},\n        ], function (args) {\n            it(\"should add a \" + args.type + \" question with '\" + args.cmd + \"' and empty tree\", function () {\n                var result = commander.doCommand(args.cmd, vellum);\n                assert.isOk(result, \"question not added\");\n                $(\"[name=property-nodeID]\").val(\"new\").change();\n                vellum.ensureCurrentMugIsSaved();\n                util.assertJSTreeState(\"new\");\n                assert.equal(result.name, \"add question\");\n                assert.equal(result.value.__className, args.type);\n            });\n        });\n\n        _.each([\n            \"#form/group\",\n            \"#form/group/select\",\n            \"#form/text\",\n        ], function (path) {\n            it(\"should select \" + path, function () {\n                util.paste([\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/group\", \"Group\", \"group\"],\n                    [\"/group/select\", \"Select\", \"select\"],\n                    [\"/group/select/item\", \"Choice\", \"item\"],\n                    [\"/text\", \"Text\", \"text\"],\n                ]);\n                var result = commander.doCommand(path, vellum);\n                assert.isOk(result, \"question not selected\");\n                assert.equal(result.name, \"select question\");\n                var mug = vellum.getCurrentlySelectedMug();\n                assert.equal(mug.hashtagPath, path);\n            });\n        });\n\n        // TODO decide if : is a good prefix for commands other than add or select\n        // TODO fix selection after delete\n        //  (two nodes selected in tree after delete non-adjacent to current)\n        // TODO delete multiple\n        //_.each([\n        //    \":delete\",\n        //    \":delete #form/group\",\n        //    \":Delete #form/group/select\",\n        //    \":delete #form/text\",\n        //], function (path) {\n        //    it(\"should delete \" + path, function () {\n        //        util.paste([\n        //            [\"id\", \"type\", \"labelItext:en-default\"],\n        //            [\"/group\", \"Group\", \"group\"],\n        //            [\"/group/select\", \"Select\", \"select\"],\n        //            [\"/group/select/item\", \"Choice\", \"item\"],\n        //            [\"/text\", \"Text\", \"text\"],\n        //        ]);\n        //        var result = commander.doCommand(path, vellum);\n        //        assert.isOk(result, \"question not deleted\");\n        //        assert.isNotOk(vellum.data.core.form.getMugByUFID(result.ufid),\n        //            \"mug not deleted\");\n        //    });\n        //});\n\n        _.each([\n            \"choice\",\n            \"choice in #form/group\",\n        ], function (cmd) {\n            it(\"should not execute bad command: \" + cmd, function () {\n                var result = commander.doCommand(cmd, vellum);\n                assert.isUndefined(result, \"unexpected result: \" + result);\n            });\n        });\n\n        _.each([\n            [\"txt\", []],\n            [\"cho\", [\"Choice\", \"Multiple Choice\", \"Multiple Choice Lookup Table\"]],\n            [\"choice \", [\"...after\", \"...before\", \"...first in\", \"...in\",\n                \"Multiple Choice Lookup Table\"]],\n            [\"choice i\", [\"...in\", \"...first in\"]],\n            [\"Date and Time \", [\"...after\", \"...before\", \"...first in\", \"...in\"]],\n        ], function (args) {\n            var cmd = args[0],\n                items = args[1];\n            it(\"should get completions for: \" + cmd, function () {\n                var expectedItems = _.map(items, function (name) {\n                        if (name.startsWith(\"...\")) {\n                            return {\n                                name: name.slice(3),\n                                icon: undefined,\n                                full: /^.+ /.exec(cmd)[0] + name.slice(3),\n                            };\n                        }\n                        return {\n                            name: name,\n                            icon: mugTypes[name.toLowerCase()].icon,\n                            full: name,\n                        };\n                    }),\n                    result = commander.getCompletions(cmd, vellum);\n                assert.deepEqual(result, expectedItems);\n            });\n        });\n\n        _.each([\n            [\"txt\", undefined],\n            [\"Choice \", [\"Choice\", undefined, undefined]],\n            [\"Choice in \", [\"Choice\", \"in\", undefined]],\n            [\"choice in /data/blue\", [\"choice\", \"in\", \"/data/blue\"]],\n            [\"text first in #form/group\", [\"text\", \"first in\", \"#form/group\"]],\n            [\"#form/blue\", [\"#form/blue\"]],\n        ], function (args) {\n            var cmd = args[0],\n                expected = args[1];\n            it(\"should tokenize: \" + cmd, function () {\n                var result = commander.tokenize(cmd, vellum);\n                assert.deepEqual(result && result.tokens, expected);\n            });\n        });\n\n        _.each([\"text\", \"choice\"], function (name) {\n            it(\"should have '\" + name + \"' in it's question map\", function () {\n                assert.hasAnyKeys(commander.getQuestionMap(vellum), [name]);\n            });\n        });\n\n        it(\"should not have 'itemset' in it's question map\", function () {\n            assert.doesNotHaveAnyKeys(commander.getQuestionMap(vellum), [\"itemset\"]);\n        });\n\n        it(\"select after add bug\", function () {\n            util.paste([\n                [\"id\", \"type\", \"labelItext:en-default\"],\n                [\"/text\", \"Text\", \"text\"],\n            ]);\n            // add question with commander\n            var result = commander.doCommand(\"Text after\", vellum),\n                mug = result && result.value;\n            assert.equal(result && result.name, \"add question\");\n            // set label\n            $(\"[name=itext-en-label]\").val(\"text2\").change();\n            assert.equal(mug.p.nodeID, undefined);\n            // select a different question with commander\n            result = commander.doCommand(\"#form/text\", vellum);\n            assert.equal(result && result.name, \"select question\");\n            // original question should have nodeID assigned and can be selected\n            assert.equal(mug.p.nodeID, \"text2\");\n            result = commander.doCommand(\"#form/text2\", vellum);\n            assert.equal(result && result.name, \"select question\");\n        });\n    });\n});\n","define([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/commcareConnect',\n    'static/commcareConnect/learn_module.xml',\n    'static/commcareConnect/assessment.xml',\n    'static/commcareConnect/deliver.xml',\n], function (\n    util,\n    chai,\n    $,\n    _,\n    commcareConnect,\n    LEARN_MODULE_XML,\n    ASSESSMENT_XML,\n    DELIVER_XML\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"The CommCareConnect\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n            });\n        });\n\n        describe(\"learn module\", function () {\n             it(\"should load and save\", function () {\n                util.loadXML(LEARN_MODULE_XML);\n                var module = util.getMug(\"module_1\");\n                assert.equal(module.__className, \"ConnectLearnModule\");\n                assert.equal(module.p.name, \"module 1\");\n                assert.equal(module.p.description, \"Module 1 is fun\\nLearning is fun\");\n                assert.equal(module.p.time_estimate, \"2\");\n                assert.equal(module.p.relevantAttr, \"x = 2\");\n                util.assertXmlEqual(call(\"createXML\"), LEARN_MODULE_XML);\n            });\n\n            it(\"requires time_estimate to be an integer\", function () {\n                var mug = util.addQuestion(\"ConnectLearnModule\", \"mug\");\n                mug.p.time_estimate = \"foo\";\n                assert.equal(mug.spec.time_estimate.validationFunc(mug), \"Must be an integer\");\n            });\n        });\n\n        describe(\"assessment module\", function () {\n            it(\"should load and save\", function () {\n                util.loadXML(ASSESSMENT_XML);\n                var module = util.getMug(\"test_assessment\");\n                assert.equal(module.__className, \"ConnectAssessment\");\n                assert.equal(module.p.user_score, \"/data/score\");\n                assert.equal(module.p.relevantAttr, \"x = 1\");\n                util.assertXmlEqual(call(\"createXML\"), ASSESSMENT_XML);\n            });\n        });\n\n        describe(\"deliver unit\", function () {\n            it(\"should load and save\", function () {\n                util.loadXML(DELIVER_XML);\n                var module = util.getMug(\"unit_one\");\n                assert.equal(module.__className, \"ConnectDeliverUnit\");\n                assert.equal(module.p.name, \"unit 1\");\n                assert.equal(module.p.entity_id, \"instance('commcaresession')/session/data/value\");\n                assert.equal(module.p.entity_name, \"/data/name\");\n                assert.equal(module.p.relevantAttr, \"x = 1\");\n                util.assertXmlEqual(call(\"createXML\"), DELIVER_XML);\n            });\n        });\n    });\n});\n","define([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/commtrack',\n    'static/commtrack/balance-block.xml',\n    'static/commtrack/balance-block-setvalues.xml',\n    'static/commtrack/invalid-transfer.xml',\n    'static/commtrack/transfer-block.xml',\n    'static/commtrack/transfer-block-setvalues.xml',\n], function (\n    util,\n    chai,\n    $,\n    _,\n    commtrack,\n    BALANCE_BLOCK_XML,\n    BALANCE_BLOCK_SETVALUES_XML,\n    INVALID_TRANSFER_XML,\n    TRANSFER_BLOCK_XML,\n    TRANSFER_BLOCK_SETVALUES_XML\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"The CommTrack module\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n            });\n        });\n\n        it(\"should load a transfer block\", function () {\n            util.loadXML(TRANSFER_BLOCK_XML);\n            var trans = util.getMug(\"transfer[@type='trans-1']\");\n            assert.equal(trans.p.sectionId, \"stock\");\n            assert.equal(trans.p.quantity, \"/data/amount_received\");\n            assert.equal(trans.p.entryId, \"instance('commcaresession')/session/data/product_id\");\n            assert.equal(trans.p.src, \"instance('commcaresession')/session/data/case_id\");\n            assert.equal(trans.p.dest, \"instance('casedb')/casedb/case[@case_id=instance('commcaresession')/session/data/case_id]/index/parent\");\n            assert.equal(trans.p.date, \"now()\");\n            assert.equal(trans.p.relevantAttr, \"true()\");\n        });\n\n        it(\"should create a transfer block\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Int\", \"amount_received\");\n            var trans = util.addQuestion(\"Transfer\", \"trans-1\");\n            trans.p.sectionId = \"stock\";\n            trans.p.quantity = \"/data/amount_received\";\n            trans.p.entryId = \"instance('commcaresession')/session/data/product_id\";\n            trans.p.src = \"instance('commcaresession')/session/data/case_id\";\n            trans.p.dest = \"instance('casedb')/casedb/case[@case_id=instance('commcaresession')/session/data/case_id]/index/parent\";\n            trans.p.relevantAttr = \"true()\";\n            trans.form.addInstanceIfNotExists({\n                id: \"products\",\n                src: \"jr://fixture/commtrack:products\"\n            });\n            trans.form.addInstanceIfNotExists({\n                id: \"ledger\",\n                src: \"jr://instance/ledgerdb\"\n            });\n            util.assertXmlEqual(call(\"createXML\"), TRANSFER_BLOCK_XML,\n                                {normalize_xmlns: true});\n        });\n\n        it(\"should load a balance block\", function () {\n            util.loadXML(BALANCE_BLOCK_XML);\n            var bal = util.getMug(\"balance[@type='bal-0']\");\n            assert.equal(bal.p.sectionId, \"stock\");\n            assert.equal(bal.p.quantity, \"/data/stock_amount\");\n            assert.equal(bal.p.entityId, \"instance('commcaresession')/session/data/case_id\");\n            assert.equal(bal.p.entryId, \"instance('commcaresession')/session/data/product_id\");\n            assert.equal(bal.p.relevantAttr, \"/data/stock_amount != 0\");\n        });\n\n        it(\"should create a balance block\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Int\", \"stock_amount\");\n            var bal = util.addQuestion(\"Balance\", \"bal-0\");\n            bal.p.sectionId = \"stock\";\n            bal.p.quantity = \"/data/stock_amount\";\n            bal.p.entityId = \"instance('commcaresession')/session/data/case_id\";\n            bal.p.entryId = \"instance('commcaresession')/session/data/product_id\";\n            bal.p.relevantAttr = \"/data/stock_amount != 0\";\n            bal.form.addInstanceIfNotExists({\n                id: \"products\",\n                src: \"jr://fixture/commtrack:products\"\n            });\n            bal.form.addInstanceIfNotExists({\n                id: \"ledger\",\n                src: \"jr://instance/ledgerdb\"\n            });\n            util.assertXmlEqual(call(\"createXML\"), BALANCE_BLOCK_XML,\n                                {normalize_xmlns: true});\n        });\n\n        it(\"transfer question should not be valid when src and dest are both empty\", function () {\n            util.loadXML();\n            var trans = util.addQuestion(\"Transfer\", \"t1\");\n            assert.strictEqual(trans.p.src, \"\");\n            assert.strictEqual(trans.p.dest, \"\");\n            trans.validate(); // normally called by widget.handleChange\n            assert(!util.isTreeNodeValid(trans),\n                \"Transfer question with empty src and dest should be invalid\");\n            assert(trans.messages.get(\"src\").length, \"src should have messages\");\n            assert(trans.messages.get(\"dest\").length, \"dest should have messages\");\n        });\n\n        it(\"new transfer question should not have validation errors\", function () {\n            util.loadXML();\n            var trans = util.addQuestion(\"Transfer\", \"t1\");\n            assert.strictEqual(trans.p.src, \"\");\n            assert.strictEqual(trans.p.dest, \"\");\n            assert.deepEqual(util.getMessages(trans), \"\");\n        });\n\n        it(\"should show error icon in tree on load invalid transfer question\", function () {\n            util.loadXML(INVALID_TRANSFER_XML);\n            var trans = util.getMug(\"transfer[@type='trans']\");\n            assert(!util.isTreeNodeValid(trans), \"tree node should not be valid\");\n        });\n\n        it(\"should create two transfer blocks with the same parent node\", function () {\n            util.loadXML();\n            util.addQuestion(\"Transfer\", \"t1\").p.src = \"value\";\n            util.addQuestion(\"Transfer\", \"t2\").p.src = \"value\";\n            var xml = util.call(\"createXML\"),\n                $xml = util.parseXML(xml);\n            assert.equal($xml.find(\"transfer\").length, 2, xml);\n            assert.equal($xml.find(\"bind[nodeset='/data/transfer[@type=\\\\'t1\\\\']/@src']\").length, 1, xml);\n            assert.equal($xml.find(\"bind[nodeset='/data/transfer[@type=\\\\'t2\\\\']/@src']\").length, 1, xml);\n        });\n\n        describe(\"transfer question\", function () {\n            var trans;\n            before(function () {\n                util.loadXML();\n                trans = util.addQuestion(\"Transfer\", \"t1\");\n            });\n\n            it(\"with missing src and dest should not be valid\", function () {\n                trans.p.src = \"\";\n                trans.p.dest = \"\";\n                trans.validate();\n                assert.notDeepEqual(trans.getErrors(), [],\n                    \"Transfer with missing src should not be valid\");\n            });\n\n            it(\"with missing src should not be valid\", function () {\n                trans.p.src = \"\";\n                trans.p.dest = \"something\";\n                trans.validate();\n                assert.notDeepEqual(trans.getErrors(), [],\n                    \"Transfer with missing src should not be valid\");\n            });\n\n            it(\"with missing dest should not be valid\", function () {\n                trans.p.src = \"something\";\n                trans.p.dest = \"\";\n                trans.validate();\n                assert.notDeepEqual(trans.getErrors(), [],\n                    \"Transfer with missing dest should not be valid\");\n            });\n\n            it(\"with both src and dest should be valid\", function () {\n                trans.p.src = \"something\";\n                trans.p.dest = \"something\";\n                trans.validate();\n                assert.deepEqual(trans.getErrors(), []);\n            });\n        });\n\n        it(\"dispense question should omit dest\", function () {\n            util.loadXML();\n            var mug = util.addQuestion(\"Dispense\", \"t1\");\n            mug.p.src = \"something\";\n            var xml = util.call(\"createXML\"),\n                $xml = util.parseXML(xml);\n            assert.strictEqual($xml.find(\"transfer[type='t1']\").attr(\"src\"), \"\",\n                \"unexpected transfer src attribute\\n\" + xml);\n            assert.isUndefined($xml.find(\"transfer[type='t1']\").attr(\"dest\"),\n                \"unexpected transfer dest attribute\\n\" + xml);\n            assert.equal($xml.find(\"bind[nodeset='/data/transfer[@type=\\\\'t1\\\\']/@src']\").length, 1,\n                \"unexpected @src bind:\\n\" + xml);\n            assert.equal($xml.find(\"bind[nodeset='/data/transfer[@type=\\\\'t1\\\\']/@dest']\").length, 0,\n                \"unexpected @dest bind:\\n\" + xml);\n        });\n\n        it(\"receive question should omit src\", function () {\n            util.loadXML();\n            var mug = util.addQuestion(\"Receive\", \"t1\");\n            mug.p.dest = \"something\";\n            var xml = util.call(\"createXML\"),\n                $xml = util.parseXML(xml);\n            assert.isUndefined($xml.find(\"transfer[type='t1']\").attr(\"src\"),\n                \"unexpected transfer src attribute\\n\" + xml);\n            assert.strictEqual($xml.find(\"transfer[type='t1']\").attr(\"dest\"), \"\",\n                \"unexpected transfer dest attribute\\n\" + xml);\n            assert.equal($xml.find(\"bind[nodeset='/data/transfer[@type=\\\\'t1\\\\']/@src']\").length, 0,\n                \"unexpected @src bind:\\n\" + xml);\n            assert.equal($xml.find(\"bind[nodeset='/data/transfer[@type=\\\\'t1\\\\']/@dest']\").length, 1,\n                \"unexpected @dest bind:\\n\" + xml);\n        });\n\n        it(\"transfer block with src and dest should load as Transfer question\", function () {\n            util.loadXML(TRANSFER_BLOCK_XML);\n            var mug = util.getMug(\"transfer[@type='trans-1']\");\n            assert.equal(mug.__className, \"Transfer\");\n        });\n\n        it(\"transfer block with dest only should load as Receive question\", function () {\n            util.loadXML(TRANSFER_BLOCK_XML\n                            .replace(' src=\"\"', '')\n                            .replace(/<bind [^>]*@src[^>]*\\/>/, ''));\n            var mug = util.getMug(\"transfer[@type='trans-1']\");\n            assert.equal(mug.__className, \"Receive\");\n        });\n\n        it(\"transfer block with src only should load as Dispense question\", function () {\n            util.loadXML(TRANSFER_BLOCK_XML\n                            .replace(' dest=\"\"', '')\n                            .replace(/<bind [^>]*@dest[^>]*\\/>/, ''));\n            var mug = util.getMug(\"transfer[@type='trans-1']\");\n            assert.equal(mug.__className, \"Dispense\");\n        });\n\n        it(\"should enable save button when a transfer's source or destination changes\", function (done) {\n            util.loadXML(TRANSFER_BLOCK_XML);\n            util.saveButtonEnabled(false);\n            util.clickQuestion(\"transfer[@type='trans-1']\");\n            var editor = $('[name=property-dest]').ckeditor().editor,\n                widget = util.getWidget('property-dest');\n            widget.input.promise.then(function () {\n                editor.on('change', function() {\n                    assert(util.saveButtonEnabled(), \"save button is disabled\");\n                    done();\n                });\n                editor.fire('change');\n            });\n        });\n\n        it(\"transfer quantity should update on reference rename\", function () {\n            util.loadXML(TRANSFER_BLOCK_XML);\n            var rec = util.getMug(\"amount_received\"),\n                trans = util.getMug(\"transfer[@type='trans-1']\");\n            rec.p.nodeID = \"amount_received_x\";\n            assert.equal(trans.p.quantity, rec.hashtagPath);\n        });\n\n        it(\"transfer quantity should update multiple refs on reference rename\", function () {\n            util.loadXML(TRANSFER_BLOCK_XML);\n            var rec = util.getMug(\"amount_received\"),\n                trans = util.getMug(\"transfer[@type='trans-1']\");\n            assert.equal(trans.p.quantity, rec.absolutePath);\n            trans.p.quantity = [rec.absolutePath, rec.absolutePath].join(\" + \");\n            rec.p.nodeID = \"amount_rx\";\n            assert.equal(trans.p.quantity, [rec.hashtagPath, rec.hashtagPath].join(\" + \"));\n        });\n\n        _.each([\"Balance\", \"Transfer\", \"Dispense\", \"Receive\"], function (type) {\n            it(\"should add ledger instance on add \" + type + \" question\", function () {\n                util.loadXML(\"\");\n                util.addQuestion(type, \"question\");\n                var xml = util.call(\"createXML\"),\n                    $xml = util.parseXML(xml);\n                assert.equal($xml.find(\"instance[src='jr://instance/ledgerdb']\").length, 1,\n                             \"wrong ledger instance count\\n\" + xml);\n            });\n\n            it(\"should remove ledger instance on delete \" + type + \" question\", function () {\n                util.loadXML(\"\");\n                var question = util.addQuestion(type, \"question\");\n                util.deleteQuestion(question.absolutePath);\n                var xml = util.call(\"createXML\"),\n                    $xml = util.parseXML(xml);\n                assert.equal($xml.find(\"instance[src='jr://instance/ledgerdb']\").length, 0,\n                             \"ledger instance should be removed\\n\" + xml);\n            });\n        });\n\n        _.each([\"Balance\", \"Transfer\"], function (type) {\n            it(\"should change \" + type + \" setvalues to binds on load+save\", function () {\n                var trans = type === \"Transfer\";\n                util.loadXML(trans ? TRANSFER_BLOCK_SETVALUES_XML : BALANCE_BLOCK_SETVALUES_XML);\n                util.assertXmlEqual(call(\"createXML\"),\n                    trans ? TRANSFER_BLOCK_XML : BALANCE_BLOCK_XML,\n                    {normalize_xmlns: true});\n            });\n\n            it(\"should remove ledger instance on delete \" + type + \" loaded from XML\", function () {\n                var trans = type === \"Transfer\";\n                util.loadXML(trans ? TRANSFER_BLOCK_XML : BALANCE_BLOCK_XML);\n                var question = util.getMug(trans ?\n                                            \"transfer[@type='trans-1']\" :\n                                            \"balance[@type='bal-0']\");\n                util.deleteQuestion(question.absolutePath);\n                var xml = util.call(\"createXML\"),\n                    $xml = util.parseXML(xml);\n                assert.equal($xml.find(\"instance[src='jr://instance/ledgerdb']\").length, 0,\n                             \"ledger instance should be removed\\n\" + xml);\n            });\n\n            it(\"should drop bind and setvalue nodes on delete \" + type + \" question\", function () {\n                var trans = type === \"Transfer\";\n                util.loadXML(trans ? TRANSFER_BLOCK_SETVALUES_XML : BALANCE_BLOCK_SETVALUES_XML);\n                var question = util.getMug(trans ?\n                                            \"transfer[@type='trans-1']\" :\n                                            \"balance[@type='bal-0']\");\n                util.deleteQuestion(question.absolutePath);\n                var xml = util.call(\"createXML\"),\n                    $xml = util.parseXML(xml);\n                assert.equal($xml.find(\"bind\").filter(function () {\n                    return /^\\/data\\/(balance|transfer)\\[/.test($(this).attr(\"nodeset\"));\n                }).length, 0, \"bind nodes should be removed\\n\" + xml);\n                assert.equal($xml.find(\"setvalue\").length, 0,\n                             \"setvalue nodes should be removed\\n\" + xml);\n            });\n        });\n\n        it(\"should not remove ledger instance on delete second Transfer question\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Transfer\", \"trans\");\n            var question = util.addQuestion(\"Transfer\", \"question\");\n            util.deleteQuestion(question.absolutePath);\n            var xml = util.call(\"createXML\"),\n                $xml = util.parseXML(xml);\n            assert.equal($xml.find(\"instance[src='jr://instance/ledgerdb']\").length, 1,\n                         \"ledger instance should be removed\\n\" + xml);\n        });\n\n        it(\"should show 'Case' property for Balance\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Balance\", \"bal\");\n            assert.equal($(\"[name=property-entityId]\").length, 1);\n        });\n\n        describe(\"should properly encode\", function () {\n            var map = {\n                    Transfer: TRANSFER_BLOCK_XML,\n                    Dispense: TRANSFER_BLOCK_XML\n                                .replace(' dest=\"\"', '')\n                                .replace(/<bind [^>]*@dest[^>]*\\/>/, ''),\n                    Receive: TRANSFER_BLOCK_XML\n                                .replace(' src=\"\"', '')\n                                .replace(/<bind [^>]*@src[^>]*\\/>/, ''),\n                };\n            _.each([\n                {from: \"Transfer\", to: \"Dispense\"},\n                {from: \"Transfer\", to: \"Receive\"},\n                {from: \"Dispense\", to: \"Transfer\"},\n                {from: \"Dispense\", to: \"Receive\"},\n                {from: \"Receive\", to: \"Transfer\"},\n                {from: \"Receive\", to: \"Dispense\"},\n            ], function (test) {\n                it(test.from + \" changed to \" + test.to, function () {\n                    var form = util.loadXML(map[test.from]),\n                        mug = util.getMug(\"transfer[@type='trans-1']\"),\n                        hasSrc = test.to === \"Transfer\" || test.to === \"Dispense\",\n                        hasDest = test.to === \"Transfer\" || test.to === \"Receive\";\n                    assert.equal(mug.__className, test.from);\n                    call(\"changeMugType\", mug, test.to);\n                    if (hasSrc) {\n                        mug.p.src = \"instance('commcaresession')/session/data/case_id\";\n                    }\n                    if (hasDest) {\n                        mug.p.dest = \"instance('casedb')/casedb/case[@case_id=\" +\n                            \"instance('commcaresession')/session/data/case_id]/index/parent\";\n                        var meta = form.instanceMetadata,\n                            i = meta.length - 1;\n                        if (meta[i].attributes.id === \"casedb\") {\n                            // swap last two instances to preserve order for XML comparison\n                            // https://stackoverflow.com/a/4011851/10840\n                            meta[i] = meta.splice(i - 1, 1, meta[i])[0];\n                        }\n                    }\n                    var xml = util.call(\"createXML\");\n                    util.assertXmlEqual(xml, map[test.to], {normalize_xmlns: true});\n                    util.loadXML(xml);\n                    mug = util.getMug(\"transfer[@type='trans-1']\");\n                    assert.equal(mug.__className, test.to);\n                });\n            });\n        });\n    });\n});\n","define([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'static/copy-paste/four-questions.xml',\n    'static/copy-paste/many-itext-forms.xml',\n    'static/copy-paste/text-question.xml',\n    'static/copy-paste/two-choices.xml',\n    'static/copy-paste/two-questions.xml',\n    'static/form/manual-instance-reference.xml',\n    'vellum/copy-paste',\n    'vellum/tsv'\n], function (\n    chai,\n    $,\n    _,\n    util,\n    FOUR_QUESTIONS_XML,\n    MANY_ITEXT_FORMS_XML,\n    TEXT_QUESTION_XML,\n    TWO_CHOICES_XML,\n    TWO_QUESTIONS_XML,\n    MANUAL_INSTANCE_REFERENCE_XML,\n    mod,\n    tsv\n) {\n    var assert = chai.assert,\n        call = util.call,\n        HEADER = [\"Form Builder clip\", \"version 1\"];\n\n    function eq(serial, rows, message) {\n        if (!_.isString(rows)) {\n            rows = tsv.tabDelimit([HEADER].concat(rows));\n        }\n        util.assertEqual(serial + \"\\n\", rows + \"\\n\",\n                         message || \"cut or copy mismatch\");\n    }\n\n    function paste(rows, errors, print) {\n        if (!_.isString(rows)) {\n            rows = tsv.tabDelimit([HEADER].concat(rows));\n        }\n        if (print) { window.console.log(rows); } // debugging helper\n        assert.deepEqual(mod.paste(rows), errors || []);\n    }\n\n    describe(\"The copy-paste plugin\", function () {\n        before(function (done) {\n            util.init({\n                features: {\n                    custom_intents: true,\n                    use_custom_repeat_button_text: true,\n                },\n                javaRosa: { langs: ['en', 'hin'] },\n                core: {\n                    onReady: function () {\n                        assert(this.isPluginEnabled(\"copyPaste\"),\n                               \"copyPaste plugin should be enabled\");\n                        done();\n                    }\n                }\n            });\n        });\n\n        _.each([\n            {\n                message: \"a text question\",\n                xml: TEXT_QUESTION_XML,\n                serial: tsv.tabDelimit([\n                    HEADER,\n                    [\n                        \"id\",\n                        \"type\",\n                        \"labelItext:en-default\",\n                        \"labelItext:hin-default\",\n                        \"constraintMsgItext:en-default\",\n                        \"constraintMsgItext:hin-default\",\n                        \"constraintAttr\",\n                        \"constraintMsgAttr\",\n                        \"relevantAttr\",\n                        \"requiredAttr\",\n                    ], [\n                        \"/txt\",\n                        \"Text\",\n                        \"English Text\",\n                        \"Hindi Text\",\n                        \"Nope\",\n                        \"Nope\",\n                        \"1 = 0\",\n                        \"jr:itext('txt-constraintMsg')\",\n                        \"x = y\",\n                        \"true\",\n                    ],\n                ]),\n            }, {\n                message: \"two text questions\",\n                xml: TWO_QUESTIONS_XML,\n                select: [\"text\", \"choice\"],\n                serial: tsv.tabDelimit([\n                    HEADER,\n                    [\n                        \"id\",\n                        \"type\",\n                        \"labelItext:en-default\",\n                        \"labelItext:hin-default\",\n                        \"labelItext\",\n                    ], [\n                        \"/text\",\n                        \"Text\",\n                        \"text with image\",\n                        \"text with image\",\n                        \"default-label\",\n                    ], [\n                        \"/choice\",\n                        \"Select\",\n                        \"Do you like it?\",\n                        \"Do you like it?\",\n                        \"null\",\n                    ], [\n                        \"/choice/true\",\n                        \"Choice\",\n                        \"Yes\",\n                        \"Yes\",\n                        \"null\",\n                    ], [\n                        \"/choice/false\",\n                        \"Choice\",\n                        \"No\",\n                        \"No\",\n                        \"null\",\n                    ],\n                ]),\n            }, {\n                message: \"two choices with shared itext\",\n                xml: TWO_CHOICES_XML,\n                select: [\"box\", \"fox\"],\n                serial: tsv.tabDelimit([\n                    HEADER,\n                    [\n                        \"id\",\n                        \"type\",\n                        \"labelItext:en-default\",\n                        \"labelItext:hin-default\",\n                        \"labelItext\",\n                    ], [\n                        \"/box\",\n                        \"Select\",\n                        \"In a box?\",\n                        \"In a box?\",\n                        \"null\",\n                    ], [\n                        \"/box/yes\",\n                        \"Choice\",\n                        \"Yes\",\n                        \"Yes\",\n                        \"yes-label\",\n                    ], [\n                        \"/box/no\",\n                        \"Choice\",\n                        \"No\",\n                        \"No\",\n                        \"no-label\",\n                    ], [\n                        \"/fox\",\n                        \"Select\",\n                        \"With a fox?\",\n                        \"With a fox?\",\n                        \"null\",\n                    ], [\n                        \"/fox/yes\",\n                        \"Choice\",\n                        \"Yes\",\n                        \"Yes\",\n                        \"yes-label\",\n                    ], [\n                        \"/fox/no\",\n                        \"Choice\",\n                        \"No\",\n                        \"No\",\n                        \"no-label\",\n                    ],\n                ]),\n            }, {\n                message: \"a question with many itext forms\",\n                xml: MANY_ITEXT_FORMS_XML,\n                serial: tsv.tabDelimit([\n                    HEADER,\n                    [\n                        \"id\",\n                        \"type\",\n                        \"labelItext:en-default\",\n                        \"labelItext:hin-default\",\n                        \"labelItext:en-audio\",\n                        \"labelItext:hin-audio\",\n                        \"labelItext:en-custom\",\n                        \"labelItext:hin-custom\",\n                        \"labelItext:en-image\",\n                        \"labelItext:hin-image\",\n                        \"labelItext:en-long\",\n                        \"labelItext:hin-long\",\n                        \"labelItext:en-short\",\n                        \"labelItext:hin-short\",\n                        \"labelItext:en-video\",\n                        \"labelItext:hin-video\",\n                        \"labelItext\",\n                        \"constraintMsgItext:en-default\",\n                        \"constraintMsgItext:hin-default\",\n                        \"helpItext:en-default\",\n                        \"helpItext:hin-default\",\n                        \"helpItext:en-audio\",\n                        \"helpItext:hin-audio\",\n                        \"helpItext:en-image\",\n                        \"helpItext:hin-image\",\n                        \"helpItext:en-video\",\n                        \"helpItext:hin-video\",\n                        \"helpItext\",\n                        \"hintItext:en-default\",\n                        \"hintItext:hin-default\",\n                        \"hintItext\",\n                        \"constraintAttr\",\n                        \"constraintMsgAttr\",\n                        \"hintLabel\",\n                    ], [\n                        \"/text\",\n                        \"Text\",\n                        \"default\",\n                        \"default\",\n                        \"jr://file/commcare/audio/data/text.mp3\",\n                        \"jr://file/commcare/audio/data/text.mp3\",\n                        \"custom\",\n                        \"custom\",\n                        \"jr://file/commcare/image/data/text.png\",\n                        \"jr://file/commcare/image/data/text.png\",\n                        \"long\",\n                        \"long\",\n                        \"short\",\n                        \"short\",\n                        \"jr://file/commcare/video/data/text.3gp\",\n                        \"jr://file/commcare/video/data/text.3gp\",\n                        \"default-label\",\n                        \"valid\",\n                        \"valid\",\n                        \"help\",\n                        \"help\",\n                        \"jr://file/commcare/audio/help/data/text.mp3\",\n                        \"jr://file/commcare/audio/help/data/text.mp3\",\n                        \"jr://file/commcare/image/help/data/text.png\",\n                        \"jr://file/commcare/image/help/data/text.png\",\n                        \"jr://file/commcare/video/help/data/text.3gp\",\n                        \"jr://file/commcare/video/help/data/text.3gp\",\n                        \"default-help\",\n                        \"hint\",\n                        \"hint\",\n                        \"default-hint\",\n                        \"1 = 0\",\n                        \"jr:itext('text-constraintMsg')\",\n                        \"hint label\",\n                    ],\n                ]),\n            }\n        ], function (item) {\n            it(\"should copy \" + item.message, function () {\n                util.loadXML(item.xml);\n                if (item.select) {\n                    util.clickQuestion.apply(null, item.select);\n                }\n                eq(mod.copy(), item.serial);\n            });\n\n            it(\"should paste \" + item.message, function () {\n                util.loadXML(\"\");\n                assert.deepEqual(mod.paste(item.serial), []);\n                util.assertXmlEqual(call(\"createXML\"), item.xml, {normalize_xmlns: true});\n            });\n        });\n\n        it(\"should copy two text questions in a group\", function () {\n            util.loadXML(FOUR_QUESTIONS_XML);\n            util.clickQuestion(\"group/text\", \"group/choice\");\n            eq(mod.copy(), [\n                [\n                    \"id\",\n                    \"type\",\n                    \"labelItext:en-default\",\n                    \"labelItext:hin-default\",\n                    \"labelItext:en-image\",\n                    \"labelItext:hin-image\",\n                    \"labelItext\",\n                ], [\n                    \"/group/text\",\n                    \"Text\",\n                    \"text with image\",\n                    \"ひらがな\",\n                    \"jr://file/commcare/image/data/en-text.png\",\n                    \"jr://file/commcare/image/data/hin-text.png\",\n                    \"text-label\",\n                ], [\n                    \"/group/choice\",\n                    \"Select\",\n                    \"Do you like it?\",\n                    \"Do you like it?\",\n                    \"null\",\n                    \"null\",\n                    \"null\",\n                ], [\n                    \"/group/choice/true\",\n                    \"Choice\",\n                    \"Yes\",\n                    \"Yes\",\n                    \"null\",\n                    \"null\",\n                    \"null\",\n                ], [\n                    \"/group/choice/false\",\n                    \"Choice\",\n                    \"No\",\n                    \"No\",\n                    \"null\",\n                    \"null\",\n                    \"null\",\n                ],\n            ]);\n        });\n\n        it(\"should paste two questions with the same id\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text1\", \"text1\"],\n                [\"/text\", \"Text\", \"text2\", \"text2\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text1\", \"text1\"],\n                [\"/copy-1-of-text\", \"Text\", \"text2\", \"text2\"],\n            ]);\n        });\n\n        it(\"should auto-rename pasted question with duplicate id\", function () {\n            util.loadXML(\"\");\n            // setup\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text1\", \"text1\"],\n            ]);\n            // paste duplicate\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text2\", \"text2\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text1\", \"text1\"],\n                [\"/copy-1-of-text\", \"Text\", \"text2\", \"text2\"],\n            ]);\n        });\n\n        it(\"should copy conflicted question id\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text1\", \"text1\"],\n                [\"/other\", \"Text\", \"text2\", \"text2\"],\n            ]);\n            var mug = util.getMug(\"other\");\n            mug.p.nodeID = \"text\";\n            assert(mug.messages.get(\"nodeID\", \"mug-conflictedNodeId-warning\"),\n                   \"expected confict warning\");\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"conflictedNodeId\"],\n                [\"/text\", \"Text\", \"text1\", \"text1\", \"null\"],\n                [\"/copy-1-of-text\", \"Text\", \"text2\", \"text2\", \"text\"],\n            ]);\n        });\n\n        it(\"should paste two questions with the same id (one in group)\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text\", \"text\"],\n                [\"/group\", \"Group\", \"group\", \"group\"],\n                [\"/group/text\", \"Text\", \"text\", \"text\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text\", \"text\"],\n                [\"/group\", \"Group\", \"group\", \"group\"],\n                [\"/group/text\", \"Text\", \"text\", \"text\"],\n            ]);\n        });\n\n        it(\"should paste three groups after text question\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text\", \"text\"],\n            ]);\n            util.clickQuestion(\"text\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/group1\", \"Group\", \"group\", \"group\"],\n                [\"/group2\", \"Group\", \"group\", \"group\"],\n                [\"/group3\", \"Group\", \"group\", \"group\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text\", \"text\"],\n                [\"/group1\", \"Group\", \"group\", \"group\"],\n                [\"/group2\", \"Group\", \"group\", \"group\"],\n                [\"/group3\", \"Group\", \"group\", \"group\"],\n            ]);\n        });\n\n        it(\"should paste three groups into group\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/group\", \"Group\", \"group\", \"group\"],\n            ]);\n            util.clickQuestion(\"group\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/group1\", \"Group\", \"group\", \"group\"],\n                [\"/group2\", \"Group\", \"group\", \"group\"],\n                [\"/group3\", \"Group\", \"group\", \"group\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/group\", \"Group\", \"group\", \"group\"],\n                [\"/group/group1\", \"Group\", \"group\", \"group\"],\n                [\"/group/group2\", \"Group\", \"group\", \"group\"],\n                [\"/group/group3\", \"Group\", \"group\", \"group\"],\n            ]);\n        });\n\n        it(\"should resolve pasted question with conflicting question ID\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"calculateAttr\", \"conflictedNodeId\"],\n                [\"/radius\", \"DataBindOnly\", '\"42\"', \"null\"],\n                [\"/copy-1-of-pi\", \"DataBindOnly\", '\"3.1415\"', \"pi\"],\n                [\"/circumference\", \"DataBindOnly\", \"2 * #form/copy-1-of-pi * #form/radius\", \"null\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/radius\", \"DataBindOnly\", '\"42\"'],\n                [\"/pi\", \"DataBindOnly\", '\"3.1415\"'],\n                [\"/circumference\", \"DataBindOnly\", \"2 * #form/pi * #form/radius\"],\n            ]);\n        });\n\n        it(\"should not paste item into tree root\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/select/item\", \"Choice\", \"item1\", \"item1\"],\n            ], [\"Cannot insert Choice into tree root\"]);\n            util.selectAll();\n            eq(mod.copy(), \"\");\n        });\n\n        it(\"should not paste text into select\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/select\", \"Select\", \"select\", \"select\"],\n                [\"/select/item1\", \"Choice\", \"item1\", \"item1\"],\n            ]);\n            util.clickQuestion(\"select/item1\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text\", \"text\"],\n            ], [\"Cannot insert Text into Multiple Choice\"]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/select\", \"Select\", \"select\", \"select\"],\n                [\"/select/item1\", \"Choice\", \"item1\", \"item1\"],\n            ]);\n        });\n\n        it(\"should paste question with empty id\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"\", \"Text\", \"text\", \"text\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/question1\", \"Text\", \"text\", \"text\"],\n            ]);\n        });\n\n        it(\"should paste question with / id\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/\", \"Text\", \"text\", \"text\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/question2\", \"Text\", \"text\", \"text\"],\n            ]);\n        });\n\n        it(\"should not paste item into or after text\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text\", \"text\"],\n            ]);\n            util.selectAll();\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/select/item\", \"Choice\", \"item1\", \"item1\"],\n            ], [\"Cannot insert Choice into or after Text\"]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"text\", \"text\"],\n            ]);\n        });\n\n        it(\"should not overwrite itext with auto-id\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"auto\", \"auto\"],\n            ]);\n            util.clickQuestion(\"text\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"labelItext\"],\n                [\"/text2\", \"Text\", \"non\", \"non\", \"text-label\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"labelItext\"],\n                [\"/text\", \"Text\", \"auto\", \"auto\", \"null\"],\n                [\"/text2\", \"Text\", \"non\", \"non\", \"text-label\"],\n            ]);\n            call(\"createXML\");\n            var text = util.getMug(\"text\"),\n                text2 = util.getMug(\"text2\");\n            // NOTE which one gets auto-renamed is somewhat arbitrary\n            assert.equal(text.p.labelItext.autoId, true);\n            assert.equal(text.p.labelItext.id, \"text-label\");\n            assert.equal(text.p.labelItext.get(), \"auto\");\n            assert.equal(text2.p.labelItext.autoId, false);\n            assert.equal(text2.p.labelItext.id, \"text-label2\");\n            assert.equal(text2.p.labelItext.get(), \"non\");\n        });\n\n        it(\"should not fill empty itext forms\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\"],\n                [\"/text1\", \"Text\", \"Label\"],\n                [\"/text2\", \"Text\", \"\"],\n                [\"/text3\", \"Text\", \"null\"],\n                [\"/text4\", \"Text\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text1\", \"Text\", \"Label\", \"Label\"],\n                [\"/text2\", \"Text\", \"null\", \"null\"],\n                [\"/text3\", \"Text\", \"null\", \"null\"],\n                [\"/text4\", \"Text\", \"null\", \"null\"],\n            ]);\n        });\n\n        it(\"should not fill empty default itext forms\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"\", \"Label\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"\", \"Label\"],\n            ]);\n        });\n\n        it(\"should not paste defaults into empty itext items\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\",\n                    \"constraintMsgItext:en-default\",\n                    \"constraintMsgItext:hin-default\",\n                    \"constraintAttr\"],\n                [\"/text1\", \"Text\", \"text1\", \"text1\", \"validate\", \"validate\", \"x = y\"],\n                [\"/text2\", \"Text\", \"text2\", \"text2\", \"null\", \"null\", \"null\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\",\n                    \"constraintMsgItext:en-default\",\n                    \"constraintMsgItext:hin-default\",\n                    \"constraintAttr\"],\n                [\"/text1\", \"Text\", \"text1\", \"text1\", \"validate\", \"validate\", \"x = y\"],\n                [\"/text2\", \"Text\", \"text2\", \"text2\", \"null\", \"null\", \"null\"],\n            ]);\n        });\n\n        it(\"should not paste empty itext media forms\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\",\n                    \"labelItext:en-image\", \"labelItext:hin-image\"],\n                [\"/text1\", \"Text\", \"text1\", \"text1\", \"jr://...\", \"jr://...\"],\n                [\"/text2\", \"Text\", \"text2\", \"text2\", \"null\", \"null\"],\n            ]);\n            util.clickQuestion(\"text1\");\n            var $uploader = $(\".fd-mm-upload-container:visible\");\n            assert($uploader.length, \"text1 media uploader should be visible\");\n            util.clickQuestion(\"text2\");\n            $uploader = $(\".fd-mm-upload-container:visible\");\n            assert.equal($uploader.length, 0, \"text2 media uploader should be hidden\");\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\",\n                    \"labelItext:en-image\", \"labelItext:hin-image\"],\n                [\"/text1\", \"Text\", \"text1\", \"text1\", \"jr://...\", \"jr://...\"],\n                [\"/text2\", \"Text\", \"text2\", \"text2\", \"null\", \"null\"],\n            ]);\n        });\n\n        it(\"should ignore extra cells in header row\", function () {\n            util.loadXML(\"\");\n            paste(tsv.tabDelimit([\n                HEADER.concat([\"\", \"\"]),\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext\"],\n                [\"/text1\", \"Text\", \"text\", \"text-id\"],\n            ]));\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"labelItext\"],\n                [\"/text1\", \"Text\", \"text\", \"text\", \"text-id\"],\n            ]);\n        });\n\n        it(\"should ignore empty itext ID\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext\"],\n                [\"/text1\", \"Text\", \"text\"],\n                [\"/text2\", \"Text\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text1\", \"Text\", \"text\", \"text\"],\n                [\"/text2\", \"Text\", \"null\", \"null\"],\n            ]);\n        });\n\n        it(\"should remove questions on cut\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext\"],\n                [\"/text1\", \"Text\", \"text\", \"text-id\"],\n            ]);\n            util.selectAll();\n            eq(mod.cut(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"labelItext\"],\n                [\"/text1\", \"Text\", \"text\", \"text\", \"text-id\"],\n            ]);\n            util.selectAll();\n            eq(mod.cut(), \"\");\n        });\n\n        it(\"should copy dynamic select with itemset data\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"itemsetData\"],\n                [\"/select\", \"SelectDynamic\", \"select\",\n                 '[{\"instance\":null,\"nodeset\":\"/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"itemsetData\"],\n                [\"/select\", \"SelectDynamic\", \"select\", \"select\",\n                 '[{\"instance\":null,\"nodeset\":\"/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n            ]);\n        });\n\n        it(\"should not cut itemset (External Data)\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"itemsetData\"],\n                [\"/select\", \"SelectDynamic\", \"select\",\n                 '[{\"instance\":null,\"nodeset\":\"/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n            ]);\n            util.clickQuestion(\"select/itemset\");\n            eq(mod.cut(), \"\");\n            assert(util.getMug(\"select/itemset\"), \"itemset should not be cut\");\n        });\n\n        it(\"should copy dynamic select with itemset data and instance\", function () {\n            var data = [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"instances\", \"itemsetData\"],\n                [\"/select\", \"SelectDynamic\", \"select\", \"select\", '{\"foo\":{\"src\":\"jr://foo\"}}',\n                 '[{\"instance\":{\"id\":\"foo\",\"src\":\"jr://foo\"},' +\n                   '\"nodeset\":\"instance(\\'foo\\')/foo/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n            ];\n            util.loadXML(\"\");\n            paste(data);\n            util.selectAll();\n            eq(mod.copy(), data);\n        });\n\n        it(\"should copy dynamic select with itemset data and filter\", function () {\n            var data = [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"filter\", \"instances\", \"itemsetData\"],\n                [\"/select\", \"SelectDynamic\", \"select\", \"select\",\n                 '[\"type = instance(\\'fum\\')/fum/@type\"]',\n                 '{\"foo\":{\"src\":\"jr://foo\"},\"fum\":{\"src\":\"jr://fum\"}}',\n                 '[{\"instance\":{\"id\":\"foo\",\"src\":\"jr://foo\"},' +\n                   '\"nodeset\":\"instance(\\'foo\\')/foo/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n            ];\n            util.loadXML(\"\");\n            paste(data);\n            util.selectAll();\n            eq(mod.copy(), data);\n        });\n\n        it(\"should show validation errors in tree after paste\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/two\", \"DataBindOnly\", \"2\"],\n                [\"/double_trouble\", \"DataBindOnly\", \"/data/two * /data/trouble\"],\n            ]);\n            assert(util.isTreeNodeValid(\"two\"), util.getMessages(\"two\"));\n            assert(!util.isTreeNodeValid(\"double_trouble\"),\n                   \"double_trouble should not be valid\");\n        });\n\n        it(\"should show warning on paste missing multimedia\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-audio\"],\n                [\"/text\", \"Text\", \"jr://file/commcare/audio/data/question1.mp3\"],\n            ]);\n            var mug = util.getMug(\"text\");\n            assert(mug.messages.get(\"labelItext\", \"missing-multimedia-warning\"),\n                   \"text should have missing-multimedia-warning\");\n        });\n\n        it(\"should copy questions in tree order\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\"],\n                [\"/text1\", \"Text\", \"text1\"],\n                [\"/text2\", \"Text\", \"text2\"],\n                [\"/text3\", \"Text\", \"text3\"],\n                [\"/group\", \"Group\", \"group\"],\n                [\"/group/text1\", \"Text\", \"text1\"],\n                [\"/group/text2\", \"Text\", \"text2\"],\n                [\"/group/text3\", \"Text\", \"text3\"],\n            ]);\n            util.clickQuestion(\n                \"text3\",\n                \"group/text2\",\n                \"group/text1\",\n                \"text1\"\n            );\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text1\", \"Text\", \"text1\", \"text1\"],\n                [\"/text3\", \"Text\", \"text3\", \"text3\"],\n                [\"/group/text1\", \"Text\", \"text1\", \"text1\"],\n                [\"/group/text2\", \"Text\", \"text2\", \"text2\"],\n            ]);\n        });\n\n        it(\"should paste questions in tree order\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/question1\", \"Text\", \"question1\", \"question1\"],\n                [\"/question2\", \"Select\", \"question2\", \"question2\"],\n                [\"/question2/item1\", \"Choice\", \"item1\", \"item1\"],\n                [\"/question2/item2\", \"Choice\", \"item2\", \"item2\"],\n                [\"/question3\", \"Int\", \"question3\", \"question3\"],\n                [\"/question4\", \"Date\", \"question4\", \"question4\"],\n                [\"/question5\", \"DataBindOnly\", \"null\", \"null\"],\n            ]);\n            util.clickQuestion(\n                \"question1\",\n                \"question2\",\n                \"question3\",\n                \"question4\",\n                \"question5\"\n            );\n            mod.paste(mod.copy());\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/question1\", \"Text\", \"question1\", \"question1\"],\n                [\"/question2\", \"Select\", \"question2\", \"question2\"],\n                [\"/question2/item1\", \"Choice\", \"item1\", \"item1\"],\n                [\"/question2/item2\", \"Choice\", \"item2\", \"item2\"],\n                [\"/question3\", \"Int\", \"question3\", \"question3\"],\n                [\"/question4\", \"Date\", \"question4\", \"question4\"],\n                [\"/question5\", \"DataBindOnly\", \"null\", \"null\"],\n                [\"/copy-1-of-question1\", \"Text\", \"question1\", \"question1\"],\n                [\"/copy-1-of-question2\", \"Select\", \"question2\", \"question2\"],\n                [\"/copy-1-of-question2/item1\", \"Choice\", \"item1\", \"item1\"],\n                [\"/copy-1-of-question2/item2\", \"Choice\", \"item2\", \"item2\"],\n                [\"/copy-1-of-question3\", \"Int\", \"question3\", \"question3\"],\n                [\"/copy-1-of-question4\", \"Date\", \"question4\", \"question4\"],\n                [\"/copy-1-of-question5\", \"DataBindOnly\", \"null\", \"null\"],\n            ]);\n        });\n\n        it(\"should warn about discarded languages\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:es-default\", \"labelItext:fr-default\"],\n                [\"/text\", \"Text\", \"english\", \"spanish\", \"french\"],\n            ], [\"Discarded languages: es, fr\"]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\"],\n                [\"/text\", \"Text\", \"english\", \"english\"],\n            ]);\n            assert(util.isTreeNodeValid(\"text\"), util.getMessages(\"text\"));\n        });\n\n        it(\"should paste and copy a model iteration repeat group\", function () {\n            var data = [\n                ['id', 'type', 'labelItext:en-default', 'labelItext:hin-default', 'addCaptionItext:en-default', 'addCaptionItext:hin-default',\n                    'addEmptyCaptionItext:en-default', 'addEmptyCaptionItext:hin-default', 'dataSource', 'instances'],\n                ['/repeat/item', 'Repeat', 'repeat', 'repeat', 'add another', 'add another', 'add new', 'add new',\n                    '{\"idsQuery\":\"instance(\\'products\\')/products/product/@id\"}',\n                    '{\"products\":{\"src\":\"jr://commtrack:products\"}}'],\n            ];\n            util.loadXML(\"\");\n            paste(data);\n            util.selectAll();\n            eq(mod.copy(), data);\n            assert(util.isTreeNodeValid(\"repeat/item\"), util.getMessages(\"repeat/item\"));\n        });\n\n        it(\"should paste (legacy format) and copy a model iteration repeat group\", function () {\n            util.loadXML(\"\");\n            paste([\n                ['id', 'type', 'labelItext:en-default', 'labelItext:hin-default', 'dataSource'],\n                ['/repeat/item', 'Repeat', 'repeat', 'repeat',\n                    '{\"instance\":' +\n                        '{\"id\":\"products\",\"src\":\"jr://commtrack:products\"},' +\n                        '\"idsQuery\":\"instance(\\'products\\')/products/product/@id\"}'],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                ['id', 'type', 'labelItext:en-default', 'labelItext:hin-default', 'dataSource', 'instances'],\n                ['/repeat/item', 'Repeat', 'repeat', 'repeat',\n                    '{\"idsQuery\":\"instance(\\'products\\')/products/product/@id\"}',\n                    '{\"products\":{\"src\":\"jr://commtrack:products\"}}'],\n            ]);\n            assert(util.isTreeNodeValid(\"repeat/item\"), util.getMessages(\"repeat/item\"));\n        });\n\n        it(\"should paste and copy an Android App Callout\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\",\n                    \"intentXmlns\", \"androidIntentAppId\",\n                    \"androidIntentExtra\",\n                    \"androidIntentResponse\",\n                    \"unknownAttributes\"],\n                [\"/app\", \"AndroidIntent\", \"app\", \"app\",\n                    \"commcare.org/xforms\", \"app-id\",\n                    JSON.stringify({key1:\"val1\", key2:\"val2\"}),\n                    JSON.stringify({key3: \"val3\"}),\n                    JSON.stringify({type: \"robin\"})]\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\",\n                    \"androidIntentAppId\",\n                    \"androidIntentExtra\",\n                    \"androidIntentResponse\",\n                    \"intentXmlns\", \"unknownAttributes\"],\n                [\"/app\", \"AndroidIntent\", \"app\", \"app\",\n                    \"app-id\",\n                    JSON.stringify({key1:\"val1\", key2:\"val2\"}),\n                    JSON.stringify({key3: \"val3\"}),\n                    \"commcare.org/xforms\", JSON.stringify({type: \"robin\"})]\n            ]);\n        });\n\n        it(\"should paste and copy an Android App Callout (old format)\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"intent\"],\n                [\"/app\", \"AndroidIntent\", \"app\", \"app\", JSON.stringify({\n                    path: \"app-id\",\n                    xmlns: \"commcare.org/xforms\",\n                    extra: {key1:\"val1\", key2:\"val2\"},\n                    response: {key3: \"val3\"},\n                    unknownAttributes: {type: \"robin\"}\n                })]\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\",\n                    \"androidIntentAppId\",\n                    \"androidIntentExtra\",\n                    \"androidIntentResponse\",\n                    \"intentXmlns\", \"unknownAttributes\"],\n                [\"/app\", \"AndroidIntent\", \"app\", \"app\",\n                    \"app-id\",\n                    JSON.stringify({key1:\"val1\", key2:\"val2\"}),\n                    JSON.stringify({key3: \"val3\"}),\n                    \"commcare.org/xforms\", JSON.stringify({type: \"robin\"})]\n            ]);\n        });\n\n        it(\"should paste and copy a Balance\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"date\", \"entityId\", \"entryId\", \"quantity\", \"sectionId\"],\n                [\"/bal\", \"Balance\", \"now()\", \"case\", \"product\", \"qty\", \"/balance-id\"],\n            ]);\n            util.loadXML(call(\"createXML\"));\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"date\", \"entityId\", \"entryId\", \"quantity\",\n                    \"rawDataAttributes\", \"sectionId\"],\n                [\"/bal\", \"Balance\", \"now()\", \"case\", \"product\", \"qty\",\n                    '{\"entity-id\":\"\",\"date\":\"\"}', \"/balance-id\"],\n            ]);\n            var id = \"balance[@type='bal']\";\n            assert(util.isTreeNodeValid(id), util.getMessages(id));\n        });\n\n        it(\"should paste and copy a Transfer\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"date\", \"dest\", \"entryId\", \"quantity\", \"sectionId\", \"src\"],\n                [\"/tx\", \"Transfer\", \"now()\", \"dst\", \"product\", \"qty\", \"/balance\", \"src\"],\n            ]);\n            util.loadXML(call(\"createXML\"));\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"date\", \"dest\", \"entryId\", \"quantity\",\n                    \"rawDataAttributes\", \"sectionId\", \"src\"],\n                [\"/tx\", \"Transfer\", \"now()\", \"dst\", \"product\", \"qty\",\n                    '{\"date\":\"\",\"src\":\"\",\"dest\":\"\"}', \"/balance\", \"src\"],\n            ]);\n            var id = \"transfer[@type='tx']\";\n            assert(util.isTreeNodeValid(id), util.getMessages(id));\n        });\n\n        it(\"should not overwrite manually typed question ID with copy-N-of-...\", function () {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\"],\n                [\"/text\", \"Text\", \"text\"],\n                [\"/text\", \"Text\", \"text\"],\n            ]);\n            var input = $(\"[name=property-nodeID]\");\n            input.val(\"other\").change();\n            assert.equal(input.val(), \"other\");\n        });\n\n        it(\"should paste markdown correctly\", function() {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hasMarkdown\"],\n                [\"/text\", \"Text\", \"*text*\", true],\n                [\"/text2\", \"Text\", \"text2\", false],\n            ]);\n            util.clickQuestion('text');\n            assert(util.markdownVisible());\n            util.clickQuestion('text2');\n            assert(!util.markdownVisible());\n        });\n\n        it(\"should paste invalid xpaths correctly\", function(done) {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/invalid\", \"DataBindOnly\", \"(42\"],\n                [\"/invalid2\", \"DataBindOnly\", \"#invalid/xpath (42\"],\n                [\"/invalid3\", \"DataBindOnly\", \"#invalid/xpath (#form/invalid\"],\n            ]);\n            util.clickQuestion('invalid');\n            util.clickQuestion('invalid2');\n            var invalid = util.getMug('invalid'),\n                invalid2 = util.getMug('invalid2'),\n                invalid3 = util.getMug('invalid3');\n            assert.strictEqual(invalid.p.calculateAttr, '#invalid/xpath (42');\n            assert.strictEqual(invalid2.p.calculateAttr, '#invalid/xpath (42');\n            assert.strictEqual(invalid3.p.calculateAttr, '#invalid/xpath (#form/invalid');\n            var widget = util.getWidget('property-calculateAttr');\n            widget.input.promise.then(function () {\n                assert.strictEqual(widget.getValue(), '(42');\n                util.selectAll();\n                eq(mod.copy(), [\n                    [\"id\", \"type\", \"calculateAttr\"],\n                    [\"/invalid\", \"DataBindOnly\", \"#invalid/xpath (42\"],\n                    [\"/invalid2\", \"DataBindOnly\", \"#invalid/xpath (42\"],\n                    [\"/invalid3\", \"DataBindOnly\", \"#invalid/xpath (#form/invalid\"],\n                ]);\n                done();\n            });\n        });\n\n        it(\"should paste valid xpaths correctly\", function(done) {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/invalid\", \"DataBindOnly\", \"(42\"],\n                [\"/valid\", \"DataBindOnly\", \"#form/invalid\"],\n            ]);\n            util.clickQuestion('valid');\n            var invalid = util.getMug('invalid'),\n                valid = util.getMug('valid');\n            assert.strictEqual(invalid.p.calculateAttr, '#invalid/xpath (42');\n            assert.strictEqual(valid.p.calculateAttr, '#form/invalid');\n            var widget = util.getWidget('property-calculateAttr');\n            widget.input.promise.then(function () {\n                assert.strictEqual(widget.getValue(), '#form/invalid');\n                assert.strictEqual(\n                    $('[name=property-calculateAttr]').find('span .label').data('value'),\n                    '#form/invalid'\n                );\n                util.selectAll();\n                eq(mod.copy(), [\n                    [\"id\", \"type\", \"calculateAttr\"],\n                    [\"/invalid\", \"DataBindOnly\", \"#invalid/xpath (42\"],\n                    [\"/valid\", \"DataBindOnly\", \"#form/invalid\"],\n                ]);\n                done();\n            });\n        });\n\n        it(\"should not add calculate condition to text node on paste\", function() {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/group\", \"Group\", \"null\"],\n                [\"/group/hidden\", \"DataBindOnly\", \"1\"],\n                [\"/group/text\", \"Text\", \"null\"],\n            ]);\n            var mug = util.getMug('group/text');\n            assert(!mug.isVisible(\"calculateAttr\"), \"calculateAttr should not be visible\");\n        });\n\n        it(\"should maintain reference to pasted question\", function() {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/group\", \"Group\", \"null\"],\n                [\"/group/number\", \"Int\", \"null\"],\n                [\"/group/hidden\", \"DataBindOnly\", \"#form/group/number + 1\"],\n                [\"/text\", \"Text\", \"null\"],\n            ]);\n            paste([\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/group\", \"Group\", \"null\"],\n                [\"/group/number\", \"Int\", \"null\"],\n                [\"/group/hidden\", \"DataBindOnly\", \"#form/group/number + 1\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/group\", \"Group\", \"null\"],\n                [\"/group/number\", \"Int\", \"null\"],\n                [\"/group/hidden\", \"DataBindOnly\", \"#form/group/number + 1\"],\n                [\"/text\", \"Text\", \"null\"],\n                [\"/copy-1-of-group\", \"Group\", \"null\"],\n                [\"/copy-1-of-group/number\", \"Int\", \"null\"],\n                [\"/copy-1-of-group/hidden\", \"DataBindOnly\", \"#form/copy-1-of-group/number + 1\"],\n            ]);\n        });\n\n        it(\"should maintain reference to question pasted in group\", function() {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/one\", \"Int\", \"null\"],\n                [\"/two\", \"Int\", \"null\"],\n                [\"/hidden\", \"DataBindOnly\", \"#form/one + #form/two + 1\"],\n                [\"/sub\", \"Group\", \"null\"],\n            ]);\n            paste([\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/two\", \"Int\", \"null\"],\n                [\"/hidden\", \"DataBindOnly\", \"#form/one + #form/two + 1\"],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"calculateAttr\"],\n                [\"/one\", \"Int\", \"null\"],\n                [\"/two\", \"Int\", \"null\"],\n                [\"/hidden\", \"DataBindOnly\", \"#form/one + #form/two + 1\"],\n                [\"/sub\", \"Group\", \"null\"],\n                [\"/sub/two\", \"Int\", \"null\"],\n                [\"/sub/hidden\", \"DataBindOnly\", \"#form/one + #form/sub/two + 1\"],\n            ]);\n        });\n\n        it(\"should maintain reference to question referenced by itemset\", function() {\n            util.loadXML(\"\");\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"itemsetData\"],\n                [\"/items\", \"DataBindOnly\", \"null\", \"null\"],\n                [\"/select\", \"SelectDynamic\", \"select\",\n                 '[{\"instance\":null,\"nodeset\":\"#form/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n                [\"/sub\", \"Group\", \"null\", \"null\"],\n            ]);\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"itemsetData\"],\n                [\"/items\", \"DataBindOnly\", \"null\", \"null\"],\n                [\"/select\", \"SelectDynamic\", \"select\",\n                 '[{\"instance\":null,\"nodeset\":\"#form/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"itemsetData\"],\n                [\"/items\", \"DataBindOnly\", \"null\", \"null\", \"null\"],\n                [\"/select\", \"SelectDynamic\", \"select\", \"select\",\n                 '[{\"instance\":null,\"nodeset\":\"#form/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n                [\"/sub\", \"Group\", \"null\", \"null\", \"null\"],\n                [\"/sub/items\", \"DataBindOnly\", \"null\", \"null\", \"null\"],\n                [\"/sub/select\", \"SelectDynamic\", \"select\", \"select\",\n                 '[{\"instance\":null,\"nodeset\":\"#form/sub/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n            ]);\n        });\n\n        it(\"should maintain reference to question referenced by model iteration\", function() {\n            util.loadXML(\"\");\n            paste([\n                ['id', 'type', 'labelItext:en-default', 'labelItext:hin-default', 'dataSource'],\n                ['/ids', 'DataBindOnly', 'null', 'null', 'null'],\n                ['/repeat/item', 'Repeat', 'repeat', 'repeat', '{\"idsQuery\":\"#form/ids\"}'],\n                ['/sub', 'Group', 'null', 'null', 'null'],\n            ]);\n            paste([\n                ['id', 'type', 'labelItext:en-default', 'labelItext:hin-default', 'dataSource'],\n                ['/ids', 'DataBindOnly', 'null', 'null', 'null'],\n                ['/repeat/item', 'Repeat', 'repeat', 'repeat', '{\"idsQuery\":\"#form/ids\"}'],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                ['id', 'type', 'labelItext:en-default', 'labelItext:hin-default', 'dataSource'],\n                ['/ids', 'DataBindOnly', 'null', 'null', 'null'],\n                ['/repeat/item', 'Repeat', 'repeat', 'repeat', '{\"idsQuery\":\"#form/ids\"}'],\n                ['/sub', 'Group', 'null', 'null', 'null'],\n                ['/sub/ids', 'DataBindOnly', 'null', 'null', 'null'],\n                ['/sub/repeat/item', 'Repeat', 'repeat', 'repeat', '{\"idsQuery\":\"#form/sub/ids\"}'],\n            ]);\n        });\n\n        it(\"should maintain reference in output value\", function() {\n            util.loadXML(\"\");\n            paste([\n                ['id', 'type', 'labelItext:en-default', 'appearance'],\n                [\"/name\", \"Text\", \"Name\", \"null\"],\n                ['/label', 'Trigger', '<output value=\"#form/name\" />', 'minimal'],\n                [\"/sub\", \"Group\", \"null\"],\n            ]);\n            paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"appearance\"],\n                [\"/name\", \"Text\", \"Name\", \"null\"],\n                ['/label', 'Trigger', '<output value=\"#form/name\" />', 'minimal'],\n            ]);\n            util.selectAll();\n            eq(mod.copy(), [\n                [\"id\", \"type\", \"labelItext:en-default\", \"labelItext:hin-default\", \"appearance\"],\n                [\"/name\", \"Text\", \"Name\", \"Name\", \"null\"],\n                ['/label', 'Trigger', '<output value=\"#form/name\" />', '<output value=\"#form/name\" />', 'minimal'],\n                [\"/sub\", \"Group\", \"null\", \"null\", \"null\"],\n                [\"/sub/name\", \"Text\", \"Name\", \"Name\", \"null\"],\n                ['/sub/label', 'Trigger', '<output value=\"#form/sub/name\" />', '<output value=\"#form/sub/name\" />', 'minimal'],\n            ]);\n        });\n\n        describe(\"with instances without src\", function() {\n            before(function (done) {\n                util.init({\n                    javaRosa: { langs: ['en'] },\n                    core: {\n                        onReady: function () {\n                            assert(this.isPluginEnabled(\"copyPaste\"),\n                                   \"copyPaste plugin should be enabled\");\n                            done();\n                        }\n                    }\n                });\n            });\n\n            var data = [\n                ['id', 'type', 'labelItext:en-default', 'appearance', 'calculateAttr', 'instances'],\n                ['/score', 'Int', 'What was your score', 'null', 'null', 'null'],\n                ['/output', 'DataBindOnly', 'null', 'null',\n                    \"instance('scores')/score[@high > #form/score][@low < #form/score]\",\n                    '{\"scores\":{\"children\":\"<score low=\\\\\"0.0\\\\\" high=\\\\\"500.0\\\\\">You\\'re really bad</score><score low=\\\\\"500.0\\\\\" high=\\\\\"99999999.0\\\\\">You\\'re really good</score>\"}}'],\n                ['/result', 'Trigger', '<output value=\"#form/output\" />', 'minimal', 'null', 'null'],\n            ];\n\n            it(\"should properly paste\", function() {\n                util.loadXML(\"\");\n                paste(data);\n                util.assertXmlEqual(call(\"createXML\"), MANUAL_INSTANCE_REFERENCE_XML, {normalize_xmlns: true});\n            });\n\n            it(\"should properly copy\", function() {\n                util.loadXML(MANUAL_INSTANCE_REFERENCE_XML);\n                util.selectAll();\n                eq(mod.copy(), data);\n            });\n        });\n\n        describe(\"with multimedia\", function () {\n            before(function (done) {\n                util.init({\n                    javaRosa: { langs: ['en', 'hin'] },\n                    uploader: { objectMap: {\n                        \"jr://file/commcare/audio/data/question1.mp3\": true\n                    }},\n                    core: {\n                        onReady: function () {\n                            assert(this.isPluginEnabled(\"copyPaste\"),\n                                   \"copyPaste plugin should be enabled\");\n                            done();\n                        }\n                    }\n                });\n            });\n\n            it(\"should not show warning on paste existing multimedia\", function () {\n                util.loadXML(\"\");\n                paste([\n                    [\"id\", \"type\", \"labelItext:en-audio\"],\n                    [\"/text\", \"Text\", \"jr://file/commcare/audio/data/question1.mp3\"],\n                ]);\n                var messages = util.getMessages(\"text\");\n                assert(!messages, messages);\n            });\n        });\n    });\n\n\n\n    describe(\"The copy-paste string conversions should\", function () {\n        function test(value, string) {\n            var json = JSON.stringify(value),\n                jstr = JSON.stringify(string);\n\n            it(\"stringify(\" + json + \") -> \" + jstr, function () {\n                assert.deepEqual(mod.stringify(value), string);\n            });\n\n            it(\" valuify(\" + jstr + \") -> \" + json, function () {\n                assert.deepEqual(mod.valuify(string), value);\n            });\n        }\n\n        // primitives\n        test(null, 'null');\n        test(true, 'true');\n        test(false, 'false');\n        test(\"null\", '\"null\"');\n        test(\"true\", '\"true\"');\n        test(\"false\", '\"false\"');\n\n        // JSON-like values\n        test([], '[]');\n        test({}, '{}');\n        test('', '');\n        test('x', 'x');\n        test('\"', '\"');\n        test('[\\n]', '\"[\\\\n]\"');\n        test(\"{\\n}\", '\"{\\\\n}\"');\n        test('\"\\n\"', '\"\\\\\"\\\\n\\\\\"\"');\n\n        // numbers\n        test(0, '0');\n        test(1, '1');\n        test(350, '350');\n        test(0.5, '0.5');\n        test(-1.2e-10, '-1.2e-10');\n        test(\"0\", '\"0\"');\n        test(\"1\", '\"1\"');\n        test(\"350\", '\"350\"');\n        test(\"0.5\", '\"0.5\"');\n        test(\"-1.2e-10\", '\"-1.2e-10\"');\n\n        // edge cases\n        (function (undefined) {\n            // is this what we want? does it matter?\n            test(undefined, undefined);\n        })();\n        test(\"{1} \", \"{1} \");\n        test(\"{1} {2}\", '\"{1} {2}\"');\n        test(\"[1] [2]\", '\"[1] [2]\"');\n        test(\"01\", '\"01\"');\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'static/core/test1.xml',\n    'static/core/group-rename.xml',\n    'static/core/invalid-questions.xml',\n    'static/core/increment-item.xml',\n    'static/core/hidden-value-in-repeat.xml',\n    'static/core/hidden-among-questions.xml',\n    'static/core/insert-questions.xml'\n], function (\n    chai,\n    $,\n    _,\n    util,\n    TEST_XML_1,\n    GROUP_RENAME_XML,\n    INVALID_QUESTIONS_XML,\n    INCREMENT_ITEM_XML,\n    HIDDEN_VALUE_IN_REPEAT_XML,\n    HIDDEN_AMONG_QUESTIONS_XML,\n    INSERT_QUESTIONS_XML\n) {\n    var assert = chai.assert,\n        call = util.call,\n        pluginsWithoutItemset = _(util.options.options.plugins || []).without(\"itemset\");\n\n    describe(\"Vellum core\", function () {\n        before(function (done) {\n            util.init({\n                core: {onReady: function () { done(); }},\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"should display non-widget message\", function () {\n            util.loadXML(\"\");\n            var text = util.addQuestion(\"Text\", \"text\"),\n                msg = \"Test non-widget message.\";\n            text.addMessage(null, {\n                key: \"testing-1-2-3\",\n                level: \"error\",\n                message: msg\n            });\n            var div = $(\".fd-content-right\").find(\".messages\");\n            chai.expect(util.getMessages(text)).to.include(msg);\n            chai.expect(div.text()).to.include(msg);\n        });\n\n        it(\"should load form with save button in 'saved' state\", function (done) {\n            util.init({\n                core: {\n                    form: TEST_XML_1,\n                    onReady: function () {\n                        assert.equal(this.data.core.saveButton.state, \"saved\");\n                        done();\n                    }\n                },\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"should allow mug rename with itemset in form when the itemset plugin is disabled\", function (done) {\n            util.init({\n                plugins: pluginsWithoutItemset,\n                features: {rich_text: false},\n                core: {\n                    form: TEST_XML_1,\n                    onReady: function () {\n                        var mug = call(\"getMugByPath\", \"/data/state\"),\n                            itemset = mug.form.getChildren(mug)[0];\n                        assert.equal(mug.form.getAbsolutePath(itemset, true), null);\n                        mug.p.nodeID = \"stat\"; // this change triggers the bug\n                        done();\n                    }\n                }\n            });\n        });\n\n        it(\"should update child references on group rename\", function () {\n            util.loadXML(GROUP_RENAME_XML);\n            var group = call(\"getMugByPath\", \"/data/group\"),\n                q1 = call(\"getMugByPath\", \"/data/group/question1\"),\n                q2 = call(\"getMugByPath\", \"/data/question2\");\n            group.p.nodeID = \"g8\";\n            assert.equal(q1.form.getAbsolutePath(q1), \"/data/g8/question1\");\n            assert.strictEqual(q2.p.relevantAttr,\n                \"#form/g8/question1 = 'valley girl' and #form/g8/question2 = 'dude'\");\n        });\n\n        it(\"should update question properties header on select mug with Question ID as display name\", function() {\n            util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\"],\n                [\"/q1\", \"Text\"],\n                [\"/q2\", \"Text\"],\n            ]);\n            $(\".fd-question-tree-display\").val('_ids').change();\n            var header = $(\".fd-question-properties .fd-head h2\");\n\n            util.clickQuestion(\"q1\");\n            assert.equal(header.text(), \"q1\");\n            util.clickQuestion(\"q2\");\n            assert.equal(header.text(), \"q2\");\n        });\n\n        it(\"should show warning icons on invalid questions\", function () {\n            util.loadXML(INVALID_QUESTIONS_XML);\n            var q0 = call(\"getMugByPath\", \"/data/q0\"),\n                q1 = call(\"getMugByPath\", \"/data/q1\"),\n                h1 = call(\"getMugByPath\", \"/data/h1\");\n            assert(util.isTreeNodeValid(q0), \"q0 is invalid: sanity check failed\");\n            assert(!util.isTreeNodeValid(q1), \"q1 should not be valid\");\n            assert(!util.isTreeNodeValid(h1), \"h1 should not be valid\");\n        });\n\n        it(\"should increment item value on insert new select item as child of select\", function () {\n            util.loadXML(INCREMENT_ITEM_XML);\n            util.clickQuestion(\"question1\");\n            var item = util.addQuestion(\"Choice\");\n            assert.equal(item.p.nodeID, \"choice3\");\n        });\n\n        it(\"should increment item value on insert new select item after sibling item\", function () {\n            util.loadXML(INCREMENT_ITEM_XML);\n            util.clickQuestion(\"question1/choice1\");\n            var item = util.addQuestion(\"Choice\");\n            assert.equal(item.p.nodeID, \"choice3\");\n        });\n\n        it(\"should add hidden value in repeat group\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Repeat\", \"repeat\");\n            util.addQuestion.bind({prevId: \"repeat\"})(\"Text\", \"text\");\n            util.addQuestion.bind({prevId: \"repeat\"})(\"DataBindOnly\", \"hidden\");\n            util.assertXmlEqual(\n                        call('createXML'),\n                        HIDDEN_VALUE_IN_REPEAT_XML,\n                        {normalize_xmlns: true});\n        });\n\n        it(\"should add question outside of collapsed group (ref group)\", function () {\n            util.loadXML(\"\");\n            var group = util.addQuestion(\"Group\", \"group\");\n            util.addQuestion(\"Text\", \"text1\");\n            util.collapseGroup(group);\n            util.addQuestion.bind({prevId: \"group\"})(\"Text\", \"text2\");\n            util.expandGroup(group);\n            util.assertJSTreeState(\n                \"group\",\n                \"  text1\",\n                \"text2\"\n            );\n        });\n\n        it(\"should add question outside of collapsed group (ref inner question)\", function () {\n            util.loadXML(\"\");\n            var group = util.addQuestion(\"Group\", \"group\"),\n                text1 = util.addQuestion(\"Text\", \"text1\"),\n                selected;\n            util.clickQuestion(\"group/text1\");\n            selected = call(\"getCurrentlySelectedMug\");\n            assert.equal(selected, text1,\n                \"wrong selected mug: \" + (selected && selected.p.nodeID));\n            util.collapseGroup(group);\n            util.addQuestion(\"Text\", \"text2\");\n            util.expandGroup(group);\n            util.assertJSTreeState(\n                \"group\",\n                \"  text1\",\n                \"text2\"\n            );\n        });\n\n        it(\"should not be able to add choice to collapsed select\", function () {\n            util.loadXML(\"\");\n            var group = util.addQuestion(\"Select\", \"select\");\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.collapseGroup(group);\n            chai.expect(function() {\n                util.addQuestion.bind({prevId: \"select\"})(\"Choice\", \"choice2\");\n            }).to.throw(Error);\n        });\n\n        it(\"should add text outside of collapsed select\", function () {\n            util.loadXML(\"\");\n            var group = util.addQuestion(\"Select\", \"select\");\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.addQuestion(\"Choice\", \"choice2\");\n            util.collapseGroup(group);\n            util.addQuestion.bind({prevId: \"select\"})(\"Text\", \"text1\");\n            util.expandGroup(group);\n            util.assertJSTreeState(\n                \"select\",\n                \"  choice1\",\n                \"  choice2\",\n                \"text1\"\n            );\n        });\n\n        it(\"should not change mugs on collapse\", function () {\n            util.loadXML(\"\");\n            var group1 = util.addQuestion(\"Group\", \"group\"),\n                text, selected;\n            util.addQuestion(\"Group\", \"group\");\n            text = util.addQuestion(\"Text\", \"text\");\n            util.clickQuestion(\"group/group/text\");\n            selected = call(\"getCurrentlySelectedMug\");\n            assert.equal(selected, text,\n                \"wrong selected mug: \" + (selected && selected.p.nodeID));\n\n            util.collapseGroup(group1);\n\n            selected = call(\"getCurrentlySelectedMug\");\n            assert.equal(selected, text,\n                \"wrong selected mug: \" + (selected && selected.p.nodeID));\n        });\n\n        it(\"should not select group if external question is selected on collapse group\", function () {\n            util.loadXML(\"\");\n            var text1 = util.addQuestion(\"Text\", \"text1\"),\n                group = util.addQuestion(\"Group\", \"group\"),\n                selected;\n            util.clickQuestion(\"text1\");\n            selected = call(\"getCurrentlySelectedMug\");\n            assert.equal(selected, text1,\n                \"wrong selected mug: \" + (selected && selected.p.nodeID));\n\n            util.collapseGroup(group);\n\n            selected = call(\"getCurrentlySelectedMug\");\n            assert.equal(selected, text1,\n                \"wrong selected mug: \" + (selected && selected.p.nodeID));\n        });\n\n        it(\"should load hidden value in repeat group\", function () {\n            util.loadXML(HIDDEN_VALUE_IN_REPEAT_XML);\n            util.assertJSTreeState(\n                \"repeat\",\n                \"  text\",\n                \"  hidden\"\n            );\n        });\n\n        it(\"should load hidden values interspersed with other questions\", function () {\n            util.loadXML(HIDDEN_AMONG_QUESTIONS_XML);\n            util.assertJSTreeState(\n                \"hidden1\",\n                \"select1\",\n                \"  item1\",\n                \"  item2\",\n                \"hidden2\",\n                \"select2\",\n                \"  item1\",\n                \"  item2\",\n                \"hidden3\",\n                \"group\",\n                \"  hidden4\",\n                \"  text3\",\n                \"  hidden5\",\n                \"  text4\",\n                \"  hidden6\",\n                \"hidden7\",\n                \"text5\",\n                \"hidden8\"\n            );\n        });\n\n        it(\"should add hidden value at end of group\", function () {\n            util.loadXML(INSERT_QUESTIONS_XML);\n            util.addQuestion.bind({prevId: \"hidden1\"})(\"DataBindOnly\", \"hiddenA\");\n            util.addQuestion.bind({prevId: \"group/hidden2\"})(\"DataBindOnly\", \"hiddenB\");\n            util.assertJSTreeState(\n                \"text1\",\n                \"text2\",\n                \"group\",\n                \"  text3\",\n                \"  text4\",\n                \"  hidden2\",\n                \"  hiddenB\",\n                \"text5\",\n                \"hidden1\",\n                \"hiddenA\"\n            );\n        });\n\n        it(\"should add hidden value among other questions\", function () {\n            util.loadXML(INSERT_QUESTIONS_XML);\n            util.addQuestion.bind({prevId: \"text1\"})(\"DataBindOnly\", \"hiddenA\");\n            util.addQuestion.bind({prevId: \"group/text3\"})(\"DataBindOnly\", \"hiddenB\");\n            util.assertJSTreeState(\n                \"text1\",\n                \"hiddenA\",\n                \"text2\",\n                \"group\",\n                \"  text3\",\n                \"  hiddenB\",\n                \"  text4\",\n                \"  hidden2\",\n                \"text5\",\n                \"hidden1\"\n            );\n        });\n\n        it(\"should add question after selected question\", function () {\n            util.loadXML(INSERT_QUESTIONS_XML);\n            util.addQuestion.bind({prevId: \"text1\"})(\"Text\", \"textA\");\n            util.addQuestion.bind({prevId: \"group/text3\"})(\"Text\", \"textB\");\n            util.assertJSTreeState(\n                \"text1\",\n                \"textA\",\n                \"text2\",\n                \"group\",\n                \"  text3\",\n                \"  textB\",\n                \"  text4\",\n                \"  hidden2\",\n                \"text5\",\n                \"hidden1\"\n            );\n        });\n\n        it(\"should add question after hidden value\", function () {\n            util.loadXML(INSERT_QUESTIONS_XML);\n            util.addQuestion.bind({prevId: \"hidden1\"})(\"Text\", \"textA\");\n            util.addQuestion.bind({prevId: \"group/hidden2\"})(\"Text\", \"textB\");\n            util.assertJSTreeState(\n                \"text1\",\n                \"text2\",\n                \"group\",\n                \"  text3\",\n                \"  text4\",\n                \"  hidden2\",\n                \"  textB\",\n                \"text5\",\n                \"hidden1\",\n                \"textA\"\n            );\n        });\n\n        it(\"should add question after sole hidden value\", function (done) {\n            util.init({\n                core: {\n                    onReady: function () {\n                        util.addQuestion(\"DataBindOnly\", \"hidden\");\n                        util.addQuestion.bind({prevId: \"hidden\"})(\"Text\", \"text\");\n                        util.assertJSTreeState(\n                            \"hidden\",\n                            \"text\"\n                        );\n                        done();\n                    }\n                },\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"should display welcome message whenever there are no questions\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text1\");\n            util.addQuestion(\"Text\", \"text2\");\n\n            util.deleteQuestion(\"/data/text1\");\n            assert(!$(\".fd-default-panel\").is(\":visible\"));\n            assert($(\".fd-question-changer\").is(\":visible\"));\n            util.deleteQuestion(\"/data/text2\");\n            assert($(\".fd-default-panel\").is(\":visible\"));\n        });\n\n        it(\"should use single quotes on drag/drop choice\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", \"select\");\n            util.addQuestion(\"Choice\", \"choice1\");\n            var mug = util.addQuestion(\"DataBindOnly\", \"mug\"),\n                calc = $(\"[name=property-calculateAttr]\"),\n                tree = $(\".fd-question-tree\").jstree(true);\n            assert.equal(calc.length, 1);\n            util.findNode(tree, \"choice1\").data.handleDrop(calc);\n            assert.equal(mug.p.calculateAttr, \"'choice1'\");\n        });\n\n        it(\"should drop /data/ reference when rich_text is false\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text\");\n            util.addQuestion(\"DataBindOnly\", \"mug\");\n            var calc = $(\"[name=property-calculateAttr]\"),\n                tree = $(\".fd-question-tree\").jstree(true);\n            assert.equal(calc.length, 1);\n            util.findNode(tree, \"text\").data.handleDrop(calc);\n            assert.equal(calc.val(), \"/data/text\");\n        });\n\n        it(\"should notify activity url on form change\", function(done) {\n            var vellum, activityUrlCalled = false;\n            // defaults: do not notify, 5 minute timeout\n            assert.equal(util.options.options.core.activityUrl, null);\n            assert.equal(util.options.options.core.activityTimeout, 5 * 60 * 1000);\n\n            util.init({\n                core: {\n                    activityTimeout: -1,  // immediate timeout\n                    activityUrl: function () {\n                        activityUrlCalled = true;\n                    },\n                    onReady: function () {\n                        // first change initializes timeout\n                        var start = Date.now(), later;\n                        vellum = this;\n                        vellum.onFormChange();\n                        assert.isAtLeast(this.data.core.activityTimestamp, start);\n\n                        // second change notifies on activity (if timed out)\n                        later = Date.now();\n                        vellum.onFormChange();\n                        assert(activityUrlCalled);\n                        assert.isAtLeast(vellum.data.core.activityTimestamp, later);\n\n                        assert.isNotNull(vellum.opts().core.activityUrl);\n                        // reset to prevent calls in other tests\n                        vellum.opts().core.activityUrl = null;\n\n                        done();\n                    }\n                }\n            });\n        });\n\n        describe(\"with rich text disabled\", function() {\n            var vellum;\n            before(function (done) {\n                util.init({\n                    core: {onReady: function () {\n                        vellum = this;\n                        done();\n                    }},\n                    features: {rich_text: false},\n                });\n            });\n\n            it(\"should display /data/ in the question tree\", function () {\n                util.addQuestion('Text', 'text1');\n                var mug = util.addQuestion('Text', 'text2');\n                assert.strictEqual(vellum.getMugDisplayName(mug), 'text2');\n                $('[name=itext-en-label]').val('text2 <output value=\"#form/text2\" />').change();\n                assert.strictEqual(vellum.getMugDisplayName(mug), 'text2 &lt;output value=\"/data/text2\" /&gt;');\n            });\n\n            it(\"should not double-escape > & < chars in the question tree\", function () {\n                util.paste([\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/html-label\", \"Text\", \"<h1>a > & < b</h1>\"],\n                ]);\n                var mug = util.getMug(\"html-label\");\n                assert.equal(vellum.getMugDisplayName(mug),\n                    '&lt;h1&gt;a &gt; &amp; &lt; b&lt;/h1&gt;');\n            });\n\n            it(\"should not escape & char in the question tree\", function () {\n                util.paste([\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/html-label-second\", \"Text\", \"a&b\"],\n                ]);\n                var mug = util.getMug(\"html-label-second\");\n                assert.equal(mug.p.labelItext.get(), \"a&b\");\n            });\n        });\n\n        describe(\"with rich text enabled\", function() {\n            var vellum;\n            before(function (done) {\n                util.init({\n                    core: {onReady: function () {\n                        vellum = this;\n                        done();\n                    }},\n                    features: {rich_text: true},\n                });\n            });\n\n            it(\"should not double-escape > & < chars in the question tree\", function () {\n                util.paste([\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/html-label\", \"Text\", \"<h1>a > & < b</h1>\"],\n                ]);\n                var mug = util.getMug(\"html-label\");\n                assert.equal(vellum.getMugDisplayName(mug),\n                    '&lt;h1&gt;a &gt; &amp; &lt; b&lt;/h1&gt;');\n            });\n\n            it(\"should not escape & char in the question tree\", function () {\n                util.paste([\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/html-label-other\", \"Text\", \"a&b > & < a\"],\n                ]);\n                var mug = util.getMug(\"html-label-other\");\n                assert.equal(mug.p.labelItext.get(), \"a&b > & < a\");\n            });\n        });\n\n        describe(\"save conflict resolution logic\", function() {\n            var SRV_FORM = \" line one\\n line two\\n line three\\n line four\\n line five\\n\",\n                NEW_FORM = SRV_FORM.replace(\"two\", \"2\"),\n                conflictResponse = {status: \"conflict\", xform: SRV_FORM},\n                savedAs = null,\n                vellum, originalShowOverwriteWarning, onOverwrite;\n            before(function (done) {\n                util.init({\n                    core: {\n                        onReady: function () {\n                            originalShowOverwriteWarning = this.showOverwriteWarning;\n                            this.showOverwriteWarning = function (send, newForm, oldForm) {\n                                onOverwrite(send, newForm, oldForm);\n                            };\n                            vellum = this;\n                            done();\n                        },\n                        patchUrl: function () {\n                            savedAs = \"patch\";\n                            return conflictResponse;\n                        },\n                        saveUrl: function (data) {\n                            savedAs = \"full\";\n                            if (data.sha1) {\n                                return conflictResponse;\n                            }\n                            return {xform: data.xform};\n                        },\n                    },\n                    features: {full_save_on_missing_conflict_xform: false},\n                });\n            });\n            after(function () {\n                vellum.showOverwriteWarning = originalShowOverwriteWarning;\n            });\n            beforeEach(function () {\n                onOverwrite = undefined;\n                vellum.data.core.saveButton.fire(\"change\");\n                vellum.data.core.lastSavedXForm = SRV_FORM;\n            });\n\n            it(\"should re-enable save button before overwrite warning\", function () {\n                onOverwrite = function (send, newForm, oldForm) {\n                    assert(util.saveButtonEnabled(), \"save button is disabled\");\n                    assert.equal(newForm, NEW_FORM);\n                    assert.equal(oldForm, SRV_FORM);\n                    didWarn = true;\n                };\n                var didWarn = false;\n                assert(util.saveButtonEnabled(), \"save button is disabled (sanity check)\");\n                vellum.send(NEW_FORM, \"patch\");\n                assert(didWarn, \"overwrite warning not triggered\");\n                assert.equal(savedAs, \"patch\");\n                assert.equal(vellum.data.core.lastSavedXForm, SRV_FORM);\n            });\n\n            it(\"should send sha1 checksum on patch switched to full form post\", function () {\n                onOverwrite = function (send, newForm, oldForm) {\n                    assert(util.saveButtonEnabled(), \"save button is disabled\");\n                    assert.equal(newForm, newFormSrc);\n                    assert.equal(oldForm, SRV_FORM);\n                    didWarn = true;\n                };\n                var didWarn = false,\n                    // diff too long -> will do full save instead of patch\n                    newFormSrc = \"abc\";\n                assert(util.saveButtonEnabled(), \"save button is disabled (sanity check)\");\n                vellum.send(newFormSrc, null);\n                assert(didWarn, \"overwrite warning not triggered\");\n                assert.equal(savedAs, \"full\");\n                assert.equal(vellum.data.core.lastSavedXForm, SRV_FORM);\n            });\n\n            it(\"should not send sha1 checksum with full form post\", function () {\n                onOverwrite = function (send, newForm, oldForm) {\n                    didWarn = true;\n                };\n                var didWarn = false;\n                assert(util.saveButtonEnabled(), \"save button is disabled (sanity check)\");\n                vellum.send(NEW_FORM, \"full\");\n                assert(!didWarn, \"should not prompt to overwrite on full save\");\n                assert(!util.saveButtonEnabled(), \"save button should be disabled\");\n                assert.equal(savedAs, \"full\");\n                assert.equal(vellum.data.core.lastSavedXForm, NEW_FORM);\n            });\n        });\n\n        describe(\"with duplicate ID should\", function () {\n            var form, dup;\n            before(function () {\n                form = util.loadXML(\"\");\n                util.addQuestion(\"Text\", \"same\");\n                dup = util.addQuestion(\"Text\", \"temp\");\n                dup.p.labelItext.set(\"same\");\n                util.clickQuestion(dup);\n            });\n\n            beforeEach(function () {\n                dup.p.nodeID = \"same\";\n                assert(form.vellum.ensureCurrentMugIsSaved(), \"mug is not saved\");\n            });\n\n            it(\"show validation error\", function () {\n                assert(!util.isTreeNodeValid(dup), \"mug should not be valid\");\n            });\n\n            it(\"show placeholder on delete question ID\", function () {\n                var input = $(\"[name=property-nodeID]\");\n\n                input.val(\"\").change();\n                assert.equal(dup.p.nodeID, \"\");\n                assert.equal(input.attr(\"placeholder\"), \"copy-1-of-same\");\n                assert(util.isTreeNodeValid(dup), util.getMessages(dup));\n\n                assert(form.vellum.ensureCurrentMugIsSaved(), \"mug is not saved\");\n                assert.equal(dup.p.nodeID, \"copy-1-of-same\");\n            });\n\n            it(\"reset question ID on dismiss duplicate path error\", function () {\n                var msg = dup.messages.get(\"nodeID\", \"mug-conflictedNodeId-warning\");\n                assert(msg, \"unexpected: validation error is missing\");\n                dup.dropMessage(\"nodeID\", \"mug-conflictedNodeId-warning\");\n                assert(util.isTreeNodeValid(dup), util.getMessages(dup));\n                assert.match(dup.p.nodeID, /^copy-\\d+-of-same$/);\n                assert(!dup.p.conflictedNodeId,\n                    \"conflictedNodeId should not be set; got \" + dup.p.conflictedNodeId);\n            });\n        });\n\n        describe(\"type changer\", function () {\n            function test(srcType, dstType, allowed) {\n                var show = allowed ? \"show \" : \"not show \";\n                it(\"should \" + show + dstType + \" in menu for \" + srcType, function () {\n                    // HACK this depends on UI HTML\n                    var mug = map[srcType],\n                        changer = form.vellum.getQuestionTypeChanger(mug),\n                        anchor = changer.find(\"[data-qtype=\" + dstType + \"]\");\n                    assert(anchor.length === (allowed ? 1 : 0),\n                           anchor.parent().html() ||\n                           (dstType + \" not found in menu\"));\n                });\n            }\n            var form, map = {};\n            before(function () {\n                form = util.loadXML(\"\");\n                map.Text = util.addQuestion(\"Text\");\n                map.Select = util.addQuestion(\"Select\");\n                util.addQuestion(\"Choice\");\n                map.SelectDynamic = util.addQuestion(\"SelectDynamic\");\n                map.Transfer = util.addQuestion(\"Transfer\");\n                map.Dispense = util.addQuestion(\"Dispense\");\n                map.Receive = util.addQuestion(\"Receive\");\n            });\n\n            test(\"Text\", \"Trigger\", true);\n            test(\"Text\", \"Choice\");\n            test(\"Text\", \"Group\");\n            test(\"Text\", \"DataBindOnly\");\n            test(\"Text\", \"Select\", true);\n            test(\"Text\", \"MSelect\", true);\n            test(\"Text\", \"SelectDynamic\");\n            test(\"Text\", \"MSelectDynamic\");\n            test(\"Text\", \"Transfer\");\n\n            test(\"Select\", \"MSelect\", true);\n            test(\"Select\", \"Text\");\n            test(\"Select\", \"SelectDynamic\");\n            test(\"Select\", \"MSelectDynamic\");\n\n            test(\"SelectDynamic\", \"MSelectDynamic\", true);\n            test(\"SelectDynamic\", \"Select\");\n            test(\"SelectDynamic\", \"MSelect\");\n\n            test(\"Transfer\", \"Text\");\n            test(\"Transfer\", \"Dispense\", true);\n            test(\"Transfer\", \"Receive\", true);\n            test(\"Dispense\", \"Transfer\", true);\n            test(\"Dispense\", \"Receive\", true);\n            test(\"Receive\", \"Transfer\", true);\n            test(\"Receive\", \"Dispense\", true);\n        });\n\n        describe(\"drag+drop should\", function () {\n            var mugs;\n            before(function () {\n                util.loadXML(INSERT_QUESTIONS_XML);\n                util.addQuestion.bind({prevId: \"text2\"})(\"Repeat\", \"repeat\");\n                mugs = {\n                    text1: call(\"getMugByPath\", \"/data/text1\"),\n                    text2: call(\"getMugByPath\", \"/data/text2\"),\n                    repeat: call(\"getMugByPath\", \"/data/repeat\"),\n                    group: call(\"getMugByPath\", \"/data/group\"),\n                    text3: call(\"getMugByPath\", \"/data/group/text3\"),\n                    text4: call(\"getMugByPath\", \"/data/group/text4\"),\n                    hidden2: call(\"getMugByPath\", \"/data/group/hidden2\"),\n                    text5: call(\"getMugByPath\", \"/data/text5\"),\n                    hidden1: call(\"getMugByPath\", \"/data/hidden1\")\n                };\n            });\n\n            var check_move_data = [\n                    [\"text1\", \"before\", \"text1\", true],\n                    [\"text1\", \"inside\", \"text1\", true],\n                    [\"text1\", \"after\", \"text1\", true],\n                    [\"text1\", \"into\", \"text1\", true], // should be same as 'inside'\n\n                    [\"text1\", \"before\", \"text2\", true],\n                    [\"text1\", \"inside\", \"text2\", true],\n                    [\"text1\", \"after\", \"text2\", true],\n\n                    [\"text1\", \"before\", \"repeat\", true],\n                    [\"text1\", \"inside\", \"repeat\", true],\n                    [\"text1\", \"after\", \"repeat\", true],\n\n                    [\"text1\", \"first\", \"group\", true],\n                    [\"text1\", \"before\", \"group\", true],\n                    [\"text1\", \"inside\", \"group\", true],\n                    [\"text1\", \"after\", \"group\", true],\n                    [\"text1\", \"last\", \"group\", true], // should be same as 'inside'\n                    [\"text1\", \"into\", \"group\", true], // should be same as 'inside'\n\n                    [\"text1\", \"before\", \"text3\", true],\n                    [\"text1\", \"inside\", \"text3\", true],\n                    [\"text1\", \"after\", \"text3\", true],\n\n                    [\"text1\", \"before\", \"text4\", true],\n                    [\"text1\", \"inside\", \"text4\", true],\n                    [\"text1\", \"after\", \"text4\", true],\n\n                    [\"text1\", \"before\", \"hidden2\", true],\n                    [\"text1\", \"inside\", \"hidden2\", true],\n                    [\"text1\", \"after\", \"hidden2\", true],\n                    [\"text1\", \"into\", \"hidden2\", true], // should be same as 'inside'\n\n                    [\"text1\", \"before\", \"text5\", true],\n                    [\"text1\", \"inside\", \"text5\", true],\n                    [\"text1\", \"after\", \"text5\", true],\n\n                    [\"text1\", \"before\", \"hidden1\", true],\n                    [\"text1\", \"inside\", \"hidden1\", true],\n                    [\"text1\", \"after\", \"hidden1\", true],\n\n\n                    [\"hidden1\", \"before\", \"text1\", true],\n                    [\"hidden1\", \"inside\", \"text1\", true],\n                    [\"hidden1\", \"after\", \"text1\", true],\n                    [\"hidden1\", \"into\", \"text1\", true], // should be same as 'inside'\n\n                    [\"hidden1\", \"before\", \"text2\", true],\n                    [\"hidden1\", \"inside\", \"text2\", true],\n                    [\"hidden1\", \"after\", \"text2\", true],\n\n                    [\"hidden1\", \"first\", \"repeat\", true],\n                    [\"hidden1\", \"before\", \"repeat\", true],\n                    [\"hidden1\", \"inside\", \"repeat\", true],\n                    [\"hidden1\", \"after\", \"repeat\", true],\n                    [\"hidden1\", \"into\", \"repeat\", true], // should be same as 'inside'\n                    [\"hidden1\", \"last\", \"repeat\", true], // should be same as 'inside'\n\n                    [\"hidden1\", \"first\", \"group\", true],\n                    [\"hidden1\", \"before\", \"group\", true],\n                    [\"hidden1\", \"inside\", \"group\", true],\n                    [\"hidden1\", \"after\", \"group\", true],\n                    [\"hidden1\", \"into\", \"group\", true], // should be same as 'inside'\n                    [\"hidden1\", \"last\", \"group\", true], // should be same as 'inside'\n\n                    [\"hidden1\", \"before\", \"text3\", true],\n                    [\"hidden1\", \"inside\", \"text3\", true],\n                    [\"hidden1\", \"after\", \"text3\", true],\n\n                    [\"hidden1\", \"before\", \"text4\", true],\n                    [\"hidden1\", \"inside\", \"text4\", true],\n                    [\"hidden1\", \"after\", \"text4\", true],\n\n                    [\"hidden1\", \"before\", \"hidden2\", true],\n                    [\"hidden1\", \"inside\", \"hidden2\", true],\n                    [\"hidden1\", \"after\", \"hidden2\", true],\n\n                    [\"hidden1\", \"before\", \"text5\", true],\n                    [\"hidden1\", \"inside\", \"text5\", true],\n                    [\"hidden1\", \"after\", \"text5\", true],\n\n                    [\"hidden1\", \"before\", \"hidden1\", true],\n                    [\"hidden1\", \"inside\", \"hidden1\", true],\n                    [\"hidden1\", \"after\", \"hidden1\", true],\n\n\n                    [\"hidden2\", \"before\", \"text1\", true],\n                    [\"hidden2\", \"inside\", \"text1\", true],\n                    [\"hidden2\", \"after\", \"text1\", true],\n\n                    [\"hidden2\", \"before\", \"text2\", true],\n                    [\"hidden2\", \"inside\", \"text2\", true],\n                    [\"hidden2\", \"after\", \"text2\", true],\n\n                    [\"hidden2\", \"before\", \"repeat\", true],\n                    [\"hidden2\", \"inside\", \"repeat\", true],\n                    [\"hidden2\", \"after\", \"repeat\", true],\n\n                    [\"hidden2\", \"before\", \"group\", true],\n                    [\"hidden2\", \"inside\", \"group\", true],\n                    [\"hidden2\", \"after\", \"group\", true],\n\n                    [\"hidden2\", \"before\", \"text3\", true],\n                    [\"hidden2\", \"inside\", \"text3\", true],\n                    [\"hidden2\", \"after\", \"text3\", true],\n\n                    [\"hidden2\", \"before\", \"text4\", true],\n                    [\"hidden2\", \"inside\", \"text4\", true],\n                    [\"hidden2\", \"after\", \"text4\", true],\n\n                    [\"hidden2\", \"before\", \"hidden2\", true],\n                    [\"hidden2\", \"inside\", \"hidden2\", true],\n                    [\"hidden2\", \"after\", \"hidden2\", true],\n\n                    [\"hidden2\", \"before\", \"text5\", true],\n                    [\"hidden2\", \"inside\", \"text5\", true],\n                    [\"hidden2\", \"after\", \"text5\", true],\n\n                    [\"hidden2\", \"before\", \"hidden1\", true],\n                    [\"hidden2\", \"inside\", \"hidden1\", true],\n                    [\"hidden2\", \"after\", \"hidden1\", true]\n                ];\n\n            _(check_move_data).each(function (test) {\n                var should = test[3],\n                    prefix = should ? \"allow move \" : \"prevent move \",\n                    qsrc = test[0],\n                    qdst = test[2],\n                    position = test[1];\n                it(prefix + qsrc + \" \" + position + \" \" + qdst, function () {\n                    var src = mugs[qsrc],\n                        dst = mugs[qdst],\n                        result = call(\"checkMove\",\n                                        src.ufid, src.__className,\n                                        dst.ufid, dst.__className,\n                                        position);\n                    assert((should ? result : !result),\n                           [\"move\", qsrc, position, qdst, \"->\", result].join(\" \"));\n                });\n            });\n\n\n            var relative_position_data = [\n                    [null, \"first\", null, \"first\"],\n                    [null, \"last\", null, \"last\"],\n\n                    [\"group\", \"first\", \"group\", \"first\"],\n                    [\"group\", \"last\", \"group\", \"last\"],\n                    [\"group\", \"before\", \"group\", \"before\"],\n                    [\"group\", \"after\", \"group\", \"after\"],\n\n                    [\"text1\", \"before\", \"text1\", \"before\"],\n                    [\"text1\", \"after\", \"text1\", \"after\"],\n\n                    [null, 0, null, \"first\"],\n                    [null, 1, \"text1\", \"after\"],\n                    [null, 2, \"text2\", \"after\"],\n                    [null, 3, \"repeat\", \"after\"],\n                    [null, 4, \"group\", \"after\"],\n                    [null, 5, \"text5\", \"after\"],\n                    [null, 6, \"hidden1\", \"after\"],\n                    [null, 7, null, \"last\"],\n                    [null, 8, null, \"last\"],\n\n                    [\"repeat\", 0, \"repeat\", \"first\"],\n                    [\"repeat\", 1, \"repeat\", \"last\"],\n                    [\"repeat\", 2, \"repeat\", \"last\"],\n\n                    [\"group\", 0, \"group\", \"first\"],\n                    [\"group\", 1, \"text3\", \"after\"],\n                    [\"group\", 2, \"text4\", \"after\"],\n                    [\"group\", 3, \"hidden2\", \"after\"],\n                    [\"group\", 4, \"group\", \"last\"],\n                    [\"group\", 5, \"group\", \"last\"]\n                ];\n\n            _(relative_position_data).each(function (test) {\n                var refMug = test[0],\n                    refPos = test[1],\n                    relMug = test[2],\n                    relPos = test[3],\n                    msg = \"produce relative position \" +\n                          refMug + \"[\" + refPos + \"] => \" +\n                          relPos + \" \" + relMug;\n                it(msg, function () {\n                    var src = refMug ? mugs[refMug] : null,\n                        dst = relMug ? mugs[relMug] : null,\n                        res = call(\"getRelativePosition\", src, refPos),\n                        posStr = String(res.position),\n                        mugStr = res.mug ? res.mug.p.nodeID : String(res.mug);\n                    assert(res.position === relPos && res.mug === dst,\n                           [refPos, refMug, \"->\", posStr, mugStr].join(\" \"));\n                });\n            });\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'tests/options',\n    'tests/utils',\n    'vellum/util',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/databrowser',\n    'static/databrowser/child-ref.xml',\n    'static/databrowser/child-ref-no-hashtag.xml',\n    'static/databrowser/mother-ref.xml',\n    'static/databrowser/child-ref-output-value.xml',\n    'static/databrowser/child-ref-output-value-other-lang.xml',\n    'static/databrowser/ignore-rich-text.xml',\n    'static/databrowser/preloaded-hashtags.xml',\n    'static/databrowser/unknown-property-preloaded-hashtags.xml',\n    'static/datasources/case-property.xml',\n], function (\n    options,\n    util,\n    vellumUtil,\n    chai,\n    $,\n    _,\n    databrowser,\n    CHILD_REF_XML,\n    CHILD_REF_NO_HASHTAG_XML,\n    MOTHER_REF_XML,\n    CHILD_REF_OUTPUT_VALUE_XML,\n    CHILD_REF_OUTPUT_VALUE_OTHER_LANG_XML,\n    IGNORE_RICH_TEXT,\n    PRELOADED_HASHTAGS_XML,\n    UNKNOWN_PROPERTY_PRELOADED_HASHTAGS_XML,\n    CASE_PROPERTY_XML\n) {\n    var assert = chai.assert,\n        call = util.call,\n        plugins = _.union(util.options.options.plugins || [], [\"databrowser\"]),\n        CASE_DATA = [{\n            id: \"commcaresession\",\n            uri: \"jr://instance/session\",\n            path: \"/session/data\",\n            name: 'Session',\n            structure: {\n                \"case_id\": {\n                    reference: {\n                        hashtag: \"#case\",\n                        source: \"casedb\",\n                        subset: \"case\",\n                        subset_key: \"@case_type\",\n                        key: \"@case_id\",\n                    },\n                },\n            },\n        }, {\n            id: \"casedb\",\n            uri: \"jr://instance/casedb\",\n            path: \"/cases/case\",\n            name: 'Cases',\n            structure: {\n                name: {},\n            },\n            subsets: [{\n                id: \"parent\",\n                name: \"parent (mother)\",\n                key: \"@case_type\",\n                structure: {\n                    edd: {},\n                }\n            }, {\n                id: \"case\",\n                name: \"child\",\n                key: \"@case_type\",\n                structure: {\n                    dob: {},\n                    invalid: {}\n                },\n                related: {\n                    parent: {\n                        hashtag: \"#case/parent\",\n                        subset: \"parent\",\n                        subset_key: \"@case_type\",\n                        key: \"@case_id\",\n                    },\n                },\n            }],\n        }];\n\n    describe(\"The data browser\", function () {\n        var dobProp = '#case/dob',\n            dataTree;\n\n        function getInstanceId(form, src) {\n            var meta = _.find(form.instanceMetadata, function (meta) {\n                return meta.attributes.src === src;\n            });\n            return meta ? meta.attributes.id : null;\n        }\n\n        describe(\"when loaded before the form\", function () {\n            before(function (done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (callback) { callback(CASE_DATA); },\n                        invalidCaseProperties: ['invalid'],\n                        onReady: function () {\n                            databrowser.initDataBrowser(this);\n                            dataTree = this.$f.find(\".fd-external-sources-tree\").jstree(true);\n                            done();\n                        }\n                    }\n                });\n            });\n\n            it(\"should add ref on drag/drop\", function(done) {\n                util.loadXML(\"\");\n                var mug = util.addQuestion(\"DataBindOnly\", \"mug\"),\n                    calc = $(\"[name=property-calculateAttr]\"),\n                    sessionUri = CASE_DATA[0].uri,\n                    casedbUri = CASE_DATA[1].uri,\n                    editor = calc.ckeditor().editor,\n                    widget = util.getWidget('property-calculateAttr');\n                widget.input.promise.then(function () { \n                    editor.on('change', function() {\n                        assert.equal(mug.p.calculateAttr, dobProp);\n                        assert.equal(getInstanceId(mug.form, sessionUri), \"commcaresession\");\n                        assert.equal(getInstanceId(mug.form, casedbUri), \"casedb\");\n                        util.assertXmlEqual(call(\"createXML\"), CHILD_REF_XML,\n                                            {normalize_xmlns: true});\n                        done();\n                    });\n                    assert.equal(getInstanceId(mug.form, sessionUri), null);\n                    assert.equal(getInstanceId(mug.form, casedbUri), null);\n                    assert.equal(calc.length, 1);\n                    util.findNode(dataTree, \"dob\").data.handleDrop(calc);\n                });\n            });\n\n            it(\"should add parent ref on drag/drop\", function(done) {\n                util.loadXML(\"\");\n                var mug = util.addQuestion(\"DataBindOnly\", \"mug\"),\n                    calc = $(\"[name=property-calculateAttr]\"),\n                    sessionUri = CASE_DATA[0].uri,\n                    casedbUri = CASE_DATA[1].uri,\n                    editor = calc.ckeditor().editor,\n                    widget = util.getWidget('property-calculateAttr');\n                widget.input.promise.then(function () { \n                    editor.on('change', function() {\n                        assert.equal(mug.p.calculateAttr, \"#case/parent/edd\");\n                        assert.equal(getInstanceId(mug.form, sessionUri), \"commcaresession\");\n                        assert.equal(getInstanceId(mug.form, casedbUri), \"casedb\");\n                        util.assertXmlEqual(call(\"createXML\"), MOTHER_REF_XML,\n                                            {normalize_xmlns: true});\n                        done();\n                    });\n                    assert.equal(getInstanceId(mug.form, sessionUri), null);\n                    assert.equal(getInstanceId(mug.form, casedbUri), null);\n                    assert.equal(calc.length, 1);\n                    util.findNode(dataTree, \"edd\").data.handleDrop(calc);\n                });\n            });\n\n            it(\"should hashtagify refs when written\", function() {\n                util.loadXML(CHILD_REF_NO_HASHTAG_XML);\n                util.assertXmlEqual(call(\"createXML\"), CHILD_REF_XML);\n            });\n\n            it(\"is not overwritten by the forms preloaded tags\", function() {\n                util.loadXML(PRELOADED_HASHTAGS_XML);\n                var form = call('getData').core.form;\n                assert(form.isValidHashtag(dobProp));\n                assert.notStrictEqual(form.hashtagMap[dobProp], null);\n            });\n\n            it(\"should write externally referenced hashtags to form\", function() {\n                util.loadXML(PRELOADED_HASHTAGS_XML);\n                util.assertXmlEqual(call(\"createXML\"), PRELOADED_HASHTAGS_XML, {normalize_xmlns: true});\n            });\n\n            it(\"should not write unknown referenced hashtags to form\", function() {\n                util.loadXML(UNKNOWN_PROPERTY_PRELOADED_HASHTAGS_XML);\n                var xml = $(call(\"createXML\")),\n                    hashtags = xml.find('h\\\\:head, head').children('vellum\\\\:hashtags, hashtags'),\n                    test = JSON.parse($.trim(hashtags.text()));\n                assert.deepEqual(test, {\"#case/dob\":null});\n            });\n\n            it(\"should add the casedb instance when referencing a case in a label\", function(done) {\n                util.loadXML(\"\");\n                var mug = util.addQuestion(\"Text\", \"mug\"),\n                    label = $(\"[name=itext-en-label]\"),\n                    sessionUri = CASE_DATA[0].uri,\n                    casedbUri = CASE_DATA[1].uri,\n                    editor = label.ckeditor().editor,\n                    widget = util.getWidget('itext-en-label');\n                widget.input.promise.then(function () { \n                    editor.on('change', _.debounce(function() {\n                        assert.equal(mug.p.labelItext.get(), '<output value=\"#case/dob\" /> ');\n                        assert.equal(getInstanceId(mug.form, sessionUri), \"commcaresession\");\n                        assert.equal(getInstanceId(mug.form, casedbUri), \"casedb\");\n                        util.assertXmlEqual(call(\"createXML\"), CHILD_REF_OUTPUT_VALUE_XML,\n                                            {normalize_xmlns: true});\n                        done();\n                    }, 20));\n                    assert.equal(getInstanceId(mug.form, sessionUri), null);\n                    assert.equal(getInstanceId(mug.form, casedbUri), null);\n                    assert.equal(label.length, 1);\n                    util.findNode(dataTree, \"dob\").data.handleDrop(label);\n                });\n            });\n\n            it(\"should drag/drop xpath (not hashtag) when rich text is off\", function () {\n                util.loadXML(IGNORE_RICH_TEXT);\n                var dob = util.getMug(\"dob\"),\n                    input = $(\"[name=property-calculateAttr]\");\n                assert.equal(dob.p.calculateAttr, \"\");\n                util.findNode(dataTree, \"dob\").data.handleDrop(input);\n                assert.equal(input.val(), \"instance('casedb')/cases/case[@case_id = \" +\n                        \"instance('commcaresession')/session/data/case_id]/dob\");\n                assert.equal(dob.p.calculateAttr, \"#case/dob\");\n            });\n\n            describe(\"with two languages\", function () {\n                beforeEach(function (done) {\n                    util.init({\n                        plugins: plugins,\n                        javaRosa: {langs: ['en', 'hin']},\n                        core: {\n                            dataSourcesEndpoint: function (callback) { callback(CASE_DATA); },\n                            onReady: function () {\n                                databrowser.initDataBrowser(this);\n                                dataTree = this.$f.find(\".fd-external-sources-tree\").jstree(true);\n                                done();\n                            }\n                        }\n                    });\n                });\n\n                it(\"should add the casedb instance when referencing a case in a label of non default language\", function(done) {\n                    util.loadXML(\"\");\n                    var mug = util.addQuestion(\"Text\", \"mug\");\n                    // util.addQuestion sets nodeId and labelItext in a way that doesn't affect UI\n                    util.clickQuestion('mug');\n                    var label = $(\"[name=itext-hin-label]\"),\n                        sessionUri = CASE_DATA[0].uri,\n                        casedbUri = CASE_DATA[1].uri,\n                        editor = label.ckeditor().editor,\n                        widget = util.getWidget('itext-hin-label');\n                    widget.input.promise.then(function () { \n                        editor.on('change', _.debounce(function() {\n                            assert.equal(mug.p.labelItext.get(), '');\n                            assert.equal(mug.p.labelItext.get(null, 'hin'), '<output value=\"#case/dob\" /> ');\n                            assert.equal(getInstanceId(mug.form, sessionUri), \"commcaresession\");\n                            assert.equal(getInstanceId(mug.form, casedbUri), \"casedb\");\n                            util.assertXmlEqual(call(\"createXML\"), CHILD_REF_OUTPUT_VALUE_OTHER_LANG_XML,\n                                                {normalize_xmlns: true});\n                            done();\n                        }, 20));\n                        assert.equal(getInstanceId(mug.form, sessionUri), null);\n                        assert.equal(getInstanceId(mug.form, casedbUri), null);\n                        assert.equal(label.length, 1);\n                        util.findNode(dataTree, \"dob\").data.handleDrop(label);\n                    });\n                });\n            });\n\n            describe(\"when rich_text is off\", function () {\n                before(function (done) {\n                    util.init({\n                        plugins: plugins,\n                        javaRosa: {langs: ['en']},\n                        core: {\n                            dataSourcesEndpoint: function (callback) { callback(CASE_DATA); },\n                            onReady: function () {\n                                databrowser.initDataBrowser(this);\n                                dataTree = this.$f.find(\".fd-external-sources-tree\").jstree(true);\n                                done();\n                            }\n                        },\n                        features: { rich_text: false },\n                    });\n                });\n\n                it(\"should add ref on drag/drop\", function() {\n                    util.loadXML(\"\");\n                    var mug = util.addQuestion(\"DataBindOnly\", \"mug\"),\n                        calc = $(\"[name=property-calculateAttr]\"),\n                        sessionUri = CASE_DATA[0].uri,\n                        casedbUri = CASE_DATA[1].uri,\n                        where = \"@case_id = instance('commcaresession')/session/data/case_id\";\n                    assert.equal(getInstanceId(mug.form, sessionUri), null);\n                    assert.equal(getInstanceId(mug.form, casedbUri), null);\n                    assert.equal(calc.length, 1);\n                    util.findNode(dataTree, \"dob\").data.handleDrop(calc);\n                    assert.equal(mug.p.calculateAttr,\n                                 \"instance('casedb')/cases/case[\" + where + \"]/dob\");\n                    assert.equal(getInstanceId(mug.form, sessionUri), \"commcaresession\");\n                    assert.equal(getInstanceId(mug.form, casedbUri), \"casedb\");\n                });\n\n                it(\"should add parent ref on drag/drop\", function() {\n                    util.loadXML(\"\");\n                    var mug = util.addQuestion(\"DataBindOnly\", \"mug\"),\n                        calc = $(\"[name=property-calculateAttr]\"),\n                        sessionUri = CASE_DATA[0].uri,\n                        casedbUri = CASE_DATA[1].uri,\n                        whereSession = \"@case_id = instance('commcaresession')/session/data/case_id\",\n                        whereParent = \"@case_id = instance('casedb')/cases/case[\" + whereSession + \"]/index/parent\";\n                    assert.equal(getInstanceId(mug.form, sessionUri), null);\n                    assert.equal(getInstanceId(mug.form, casedbUri), null);\n                    assert.equal(calc.length, 1);\n                    util.findNode(dataTree, \"edd\").data.handleDrop(calc);\n                    assert.equal(mug.p.calculateAttr, \"instance('casedb')/cases/case[\" + whereParent + \"]/edd\");\n                    assert.equal(getInstanceId(mug.form, sessionUri), \"commcaresession\");\n                    assert.equal(getInstanceId(mug.form, casedbUri), \"casedb\");\n                });\n            });\n\n            it(\"shouldn't show invalid properties\", function() {\n                assert.isNull(util.findNode(dataTree, \"invalid\"), \"invalid shouldn't be in case tree\");\n            });\n\n            // TODO should remove instances when expression ref is removed\n        });\n\n        describe(\"when loaded after the form\", function () {\n            var vellum, widget, blue, event = {};\n            vellumUtil.eventuality(event);\n            function loadDataTree(done) {\n                databrowser.initDataBrowser(vellum);\n                done();\n            }\n            before(function (done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (callback) {\n                            event.on(\"loadCaseData\", function() {\n                                callback(CASE_DATA);\n                            });\n                        },\n                        // need form with <hashtags> containing a case property\n                        // so the form knows about the #case namespace and shows\n                        // errors for unknown case properties\n                        form: MOTHER_REF_XML,\n                        onReady: function () {\n                            vellum = this;\n                            blue = util.addQuestion(\"DataBindOnly\", \"blue\");\n                            widget = util.getWidget('property-calculateAttr');\n                            widget.input.promise.then(done);\n                        }\n                    }\n                });\n            });\n\n            it(\"should error for unknown properties\", function(done) {\n                widget.setValue(dobProp);\n                widget.handleChange();\n                assert(!util.isTreeNodeValid(blue), \"expected validation error\");\n                assert.deepEqual(util.getMessages(blue),\n                    // TODO soften this message when data sources are not yet loaded\n                    'calculateAttr:\\n  - Unknown question: #case/dob');\n                event.fire(\"loadCaseData\");\n                loadDataTree(function() {\n                    assert(util.isTreeNodeValid(blue), blue.getErrors().join(\"\\n\"));\n                    done();\n                });\n            });\n        });\n\n        describe(\"when loaded after the form with loaded xml\", function () {\n            var vellum, widget, event = {};\n            vellumUtil.eventuality(event);\n            function loadDataTree(done) {\n                databrowser.initDataBrowser(vellum);\n                done();\n            }\n            beforeEach(function (done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (callback) {\n                            event.on(\"loadCaseData\", function() {\n                                callback(CASE_DATA);\n                            });\n                        },\n                        form: PRELOADED_HASHTAGS_XML,\n                        onReady: function () {\n                            vellum = this;\n                            widget = util.getWidget('property-calculateAttr');\n                            widget.input.promise.then(done);\n                        }\n                    }\n                });\n            });\n\n            it(\"should not error for known properties\", function() {\n                assert.strictEqual(widget.getValue(), dobProp);\n                assert.lengthOf(widget.getControl().find('.label-datanode-unknown'), 0);\n                event.fire(\"loadCaseData\");\n                assert.strictEqual(widget.getValue(), dobProp);\n                assert.lengthOf(widget.getControl().find('.label-datanode-unknown'), 0);\n            });\n\n            it(\"overwrites the forms preloaded tags\", function() {\n                var form = call('getData').core.form,\n                    path = \"instance('casedb')/cases/case[@case_id = \" +\n                           \"instance('commcaresession')/session/data/case_id]/dob\";\n                assert(form.isValidHashtag(dobProp), \"invalid before test\");\n                assert.equal(form.hashtagMap[dobProp], path);\n                form.hashtagMap[dobProp] = null;\n                event.fire(\"loadCaseData\");\n                assert(form.isValidHashtag(dobProp), \"not valid after loadCaseData\");\n                assert.equal(form.hashtagMap[dobProp], path);\n            });\n\n            it(\"should not write unknown referenced hashtags to form\", function() {\n                util.loadXML(UNKNOWN_PROPERTY_PRELOADED_HASHTAGS_XML);\n                event.fire(\"loadCaseData\");\n                var xml = $(call(\"createXML\")),\n                    hashtags = xml.find('h\\\\:head, head').children('vellum\\\\:hashtags, hashtags'),\n                    test = JSON.parse($.trim(hashtags.text()));\n                assert.deepEqual(test, {\"#case/dob\":null});\n            });\n\n            it(\"the parser and form should point to same hashtag dictionary\", function (done) {\n                // this test probably knows a little too much about the form's inner workings...\n                var form = call('getData').core.form,\n                    origFormDict = form.hashtagMap,\n                    parser = form.xpath;\n                event.fire('loadCaseData');\n                loadDataTree(function() {\n                    var newForm = call('getData').core.form,\n                        newFormDict = newForm.hashtagMap,\n                        newParser = newForm.xpath;\n\n                    // expect that the translation dictionary will change after loading case\n                    // properties, but the parser should not\n                    assert.notStrictEqual(newFormDict, origFormDict);\n                    assert.strictEqual(newParser, parser);\n\n                    util.addQuestion('Text', 'text');\n                    var parsedResult = parser.parse('#form/text').toXPath();\n                    assert.strictEqual(parsedResult, '/data/text');\n                    done();\n                });\n            });\n\n            it(\"should not cause null xpath\", function () {\n                util.loadXML(CASE_PROPERTY_XML);\n                event.fire(\"loadCaseData\");\n                util.loadXML(CASE_PROPERTY_XML);\n                util.assertXmlEqual(util.call(\"createXML\"), CASE_PROPERTY_XML);\n            });\n        });\n\n        describe(\"without rich text\", function () {\n            before(function (done) {\n                util.init({\n                    features: {rich_text: false},\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (callback) { callback(CASE_DATA); },\n                        invalidCaseProperties: ['invalid'],\n                        onReady: function () {\n                            databrowser.initDataBrowser(this);\n                            dataTree = this.$f.find(\".fd-external-sources-tree\").jstree(true);\n                            done();\n                        }\n                    }\n                });\n            });\n\n            it(\"should add ref on drag/drop\", function() {\n                util.loadXML(\"\");\n                var mug = util.addQuestion(\"Text\", \"mug\"),\n                    text = $(\"[name=itext-en-label]\"),\n                    sessionUri = CASE_DATA[0].uri,\n                    casedbUri = CASE_DATA[1].uri;\n                assert.equal(getInstanceId(mug.form, sessionUri), null);\n                assert.equal(getInstanceId(mug.form, casedbUri), null);\n                assert.equal(text.length, 1);\n                util.findNode(dataTree, \"dob\").data.handleDrop(text);\n                assert.equal(mug.p.labelItext.get(),\n                             \"<output value=\\\"instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]/dob\\\" />\");\n                assert.equal(getInstanceId(mug.form, sessionUri), \"commcaresession\");\n                assert.equal(getInstanceId(mug.form, casedbUri), \"casedb\");\n            });\n        });\n\n        describe(\"with user properties\", function () {\n            var CASE_AND_USER_DATA = [{\n                    id: \"commcaresession\",\n                    uri: \"jr://instance/session\",\n                    path: \"/session\",\n                    name: 'Session',\n                    structure: {\n                        data: {\n                            merge: true,\n                            structure: {\n                                case_id: {\n                                    reference: {\n                                        hashtag: \"#case\",\n                                        source: \"casedb\",\n                                        subset: \"case\",\n                                        subset_key: \"@case_type\",\n                                        key: \"@case_id\",\n                                    },\n                                },\n                            },\n                        },\n                        context: {\n                            merge: true,\n                            structure: {\n                                userid: {\n                                    reference: {\n                                        hashtag: \"#user\",\n                                        source: \"casedb\",\n                                        subset: \"commcare-user\",\n                                        subset_key: \"@case_type\",\n                                        subset_filter: true,\n                                        key: \"hq_user_id\",\n                                    },\n                                },\n                            },\n                        },\n                    },\n                }, {\n                    id: \"casedb\",\n                    uri: \"jr://instance/casedb\",\n                    path: \"/casedb/case\",\n                    name: 'Cases',\n                    structure: {\n                        name: {},\n                    },\n                    subsets: [{\n                        id: \"case\",\n                        name: \"child\",\n                        key: \"@case_type\",\n                        structure: {\n                            dob: {},\n                            invalid: {}\n                        },\n                    }, {\n                        id: \"commcare-user\",\n                        name: \"user\",\n                        key: \"@case_type\",\n                        structure: {\n                            code_name: {},\n                            user_role: {},\n                        }\n                    }],\n                }];\n\n            before(function (done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (callback) { callback(CASE_AND_USER_DATA); },\n                        invalidCaseProperties: ['invalid'],\n                        onReady: function () {\n                            databrowser.initDataBrowser(this);\n                            dataTree = this.$f.find(\".fd-external-sources-tree\").jstree(true);\n                            done();\n                        }\n                    }\n                });\n            });\n\n            it(\"should drag/drop case property\", function (done) {\n                util.loadXML(\"\");\n                var mug = util.addQuestion(\"DataBindOnly\", \"mug\"),\n                    input = $(\"[name=property-calculateAttr]\"),\n                    editor = input.ckeditor().editor,\n                    widget = util.getWidget('property-calculateAttr');\n                widget.input.promise.then(function () {\n                    editor.on('change', function() {\n                        assert.equal(mug.p.calculateAttr, \"#case/dob\");\n                        done();\n                    });\n                    assert(!mug.p.calculateAttr, \"unexpected: \" + mug.p.calculateAttr);\n                    util.findNode(dataTree, \"dob\").data.handleDrop(input);\n                });\n            });\n\n            it(\"should drag/drop case index\", function (done) {\n                util.loadXML(\"\");\n                var mug = util.addQuestion(\"DataBindOnly\", \"mug\"),\n                    input = $(\"[name=property-calculateAttr]\"),\n                    editor = input.ckeditor().editor,\n                    widget = util.getWidget('property-calculateAttr');\n                widget.input.promise.then(function () {\n                    editor.on('change', function() {\n                        assert.equal(mug.p.calculateAttr,\n                            \"instance('commcaresession')/session/data/case_id\");\n                        done();\n                    });\n                    assert(!mug.p.calculateAttr, \"unexpected: \" + mug.p.calculateAttr);\n                    util.findNode(dataTree, \"child\").data.handleDrop(input);\n                });\n            });\n\n            it(\"should drag/drop user property\", function (done) {\n                var form = util.loadXML(\"\"),\n                    mug = util.addQuestion(\"DataBindOnly\", \"mug\"),\n                    input = $(\"[name=property-calculateAttr]\"),\n                    editor = input.ckeditor().editor,\n                    widget = util.getWidget('property-calculateAttr');\n                widget.input.promise.then(function () {\n                    editor.on('change', function() {\n                        assert.equal(mug.p.calculateAttr, \"#user/code_name\");\n                        assert.equal(form.normalizeXPath(\"#user/code_name\"),\n                            \"instance('casedb')/casedb/case[@case_type = 'commcare-user']\" +\n                            \"[hq_user_id = instance('commcaresession')/session/context/userid]\" +\n                            \"/code_name\");\n                        done();\n                    });\n                    assert(!mug.p.calculateAttr, \"unexpected: \" + mug.p.calculateAttr);\n                    util.findNode(dataTree, \"code_name\").data.handleDrop(input);\n                });\n            });\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'tests/options',\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/itemset',\n    'static/datasources/case-property.xml',\n    'static/datasources/null-hashtags.xml',\n    'static/datasources/unknown-case-property.xml',\n], function (\n    options,\n    util,\n    chai,\n    $,\n    _,\n    itemset,\n    CASE_PROPERTY_XML,\n    NULL_HASHTAGS_XML,\n    UNKNOWN_CASE_PROPERTY_XML\n) {\n    var assert = chai.assert,\n        clickQuestion = util.clickQuestion,\n        plugins = _.union(util.options.options.plugins || [], [\"itemset\"]),\n        DATA_SOURCES = [{\n            id: \"some-fixture\",\n            uri: \"jr://fixture/item-list:some-fixture\",\n            path: \"/some-fixture_list/some-fixture\",\n            name: 'some-fixture-name',\n            structure: {\n                \"inner-attribute\": {\n                    structure: {\n                        \"extra-inner-attribute\": {\n                            structure: {\n                                \"@id\": {},\n                                name: {}\n                            }\n                        }\n                    }\n                },\n                \"@id\": {},\n                name: {}\n            }\n        }, {\n            id: \"commcaresession\",\n            uri: \"jr://instance/session\",\n            path: \"/session\",\n            name: 'Session',\n            structure: {\n                data: {\n                    merge: true,\n                    structure: {\n                        \"case_id\": {\n                            reference: {\n                                hashtag: \"#case\",\n                                source: \"casedb\",\n                                subset: \"case\",\n                                subset_key: \"@case_type\",\n                                key: \"@case_id\",\n                            },\n                        },\n                    },\n                },\n                context: {\n                    merge: true,\n                    structure: {\n                        \"userid\": {\n                            reference: {\n                                hashtag: \"#user\",\n                                source: \"casedb\",\n                                subset: \"commcare-user\",\n                                subset_key: \"@case_type\",\n                                subset_filter: true,\n                                key: \"hq_user_id\",\n                            },\n                        },\n                    },\n                },\n            },\n        }, {\n            id: \"casedb\",\n            uri: \"jr://instance/casedb\",\n            path: \"/cases/case\",\n            name: 'Cases',\n            subsets: [{\n                id: \"case\",\n                name: \"child\",\n                key: \"@case_type\",\n                structure: {\n                    dob: {},\n                    parent: {},\n                    realName: {name: \"anAlias\"}\n                },\n                related: {\n                    parent: {\n                        hashtag: \"#case/parent\",\n                        subset: \"parent\",\n                        subset_key: \"@case_type\",\n                        key: \"@case_id\",\n                    }\n                },\n            }, {\n                id: \"parent\",\n                name: \"mother\",\n                key: \"@case_type\",\n                structure: {\n                    edd: {},\n                },\n                related: {\n                    parent: {\n                        hashtag: \"#case/grandparent\",\n                        subset: \"grandparent\",\n                        subset_key: \"@case_type\",\n                        key: \"@case_id\",\n                    },\n                }\n            }, {\n                id: \"grandparent\",\n                name: \"household\",\n                key: \"@case_type\",\n                structure: {\n                    address: {},\n                }\n            }, {\n                id: \"commcare-user\",\n                name: \"user\",\n                key: \"@case_type\",\n                structure: {\n                    role: {},\n                }\n            }]\n        }];\n\n    describe(\"The data sources loader\", function () {\n        var vellum;\n        before(function (done) {\n            util.init({\n                plugins: plugins,\n                javaRosa: {langs: ['en']},\n                core: {\n                    dataSourcesEndpoint: function (callback) { callback(DATA_SOURCES); },\n                    onReady: function () {\n                        vellum = this;\n                        done();\n                    },\n                },\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"displays nested structures\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"SelectDynamic\", \"select1\");\n            clickQuestion('select1/itemset');\n            var opts = $('[name=property-itemsetData] option'),\n                text = function (opt) { return opt.text; };\n            assert.equal(_.map(opts, text).join(\"\\n\"), [\n                \"some-fixture-name\",\n                \"some-fixture-name - inner-attribute\",\n                \"some-fixture-name - inner-attribute - extra-inner-attribute\",\n            ].join(\"\\n\"));\n        });\n\n        describe(\"data nodes\", function () {\n            var nodes;\n            before(function () {\n                function transform(nodes) {\n                    return _.object(_.map(nodes, function (node) {\n                        if (!node.recursive) {\n                            node.nodes = transform(node.getNodes());\n                        }\n                        return [node.name, node];\n                    }));\n                }\n                nodes = transform(vellum.datasources.getDataNodes());\n            });\n\n            it(\"should merge structures when merge flag is set\", function() {\n                assert.deepEqual(_.keys(nodes), [\"child\", \"user\"]);\n                assert.equal(nodes.child.xpath,\n                    \"instance('commcaresession')/session/data/case_id\");\n                assert.equal(nodes.user.xpath,\n                    \"instance('commcaresession')/session/context/userid\");\n            });\n\n            it(\"should use reference.hashtag\", function() {\n                assert.equal(nodes.user.nodes.role.hashtag, \"#user/role\");\n            });\n\n            it(\"should construct #case hashtag with reference.subset\", function() {\n                assert.equal(nodes.child.nodes.dob.hashtag, \"#case/dob\");\n            });\n\n            it(\"should use aliases for hashtags\", function() {\n                assert.equal(nodes.child.nodes.anAlias.hashtag, \"#case/anAlias\");\n            });\n\n            it(\"should reference an aliased property by its original id in its xpath\", function() {\n                assert.match(nodes.child.nodes.anAlias.xpath, /\\/realName$/);\n            });\n\n            it(\"should construct #case/parent hashtag with related subset\", function() {\n                assert.equal(nodes.child.nodes.mother.nodes.edd.hashtag, \"#case/parent/edd\");\n            });\n\n            it(\"should construct #case/grandparent hashtag with related subset\", function() {\n                var house = nodes.child.nodes.mother.nodes.household.nodes;\n                assert.equal(house.address.hashtag, \"#case/grandparent/address\");\n            });\n\n            it(\"should use index path for related parent node\", function() {\n                assert.strictEqual(nodes.child.nodes.mother.hashtag, null);\n                assert.equal(nodes.child.nodes.mother.xpath,\n                    \"instance('casedb')/cases/case[@case_id = \" +\n                    \"instance('commcaresession')/session/data/case_id]/index/parent\");\n            });\n\n            it(\"should support property with same name as related index\", function() {\n                assert.equal(nodes.child.nodes.parent.hashtag, \"#case/parent\");\n                assert.equal(nodes.child.nodes.parent.xpath,\n                    \"instance('casedb')/cases/case[@case_id = \" +\n                    \"instance('commcaresession')/session/data/case_id]/parent\");\n            });\n        });\n\n        describe(\"\", function() {\n            before(function(done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (callback) { callback([]); },\n                        onReady: function () { done(); }\n                    },\n                    features: {rich_text: false},\n                });\n            });\n\n            it(\"should not crash when no fixtures are passed\", function () {\n                util.loadXML(\"\");\n                util.addQuestion(\"SelectDynamic\", \"select1\");\n                clickQuestion('select1/itemset');\n            });\n        });\n\n        describe(\"async options loader\", function() {\n            var vellum, callback;\n            before(function (done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (cb) { callback = cb; },\n                        onReady: function () {\n                            vellum = this;\n                            done();\n                        },\n                    },\n                    features: {rich_text: false},\n                });\n            });\n            beforeEach(function () {\n                vellum.datasources.reset();\n                callback = null;\n            });\n\n            it(\"should indicate loading status for empty itemset\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"SelectDynamic\", \"select\");\n                clickQuestion('select/itemset');\n                var options = $('[name=property-itemsetData] option');\n                assert.equal(options.first().text(), 'Loading...');\n                assert.equal(options.length, 1, $(\"<div />\").append(options).html());\n            });\n\n            it(\"should replace loading indicator with async loaded options\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"SelectDynamic\", \"select\");\n                clickQuestion('select/itemset');\n                callback([]);\n                var options = $('[name=property-itemsetData] option');\n                assert.equal(options.first().text(), \"Not Found\");\n                assert.equal(options.length, 1, $(\"<div />\").append(options).html());\n            });\n\n            it(\"should show custom option when loading itemset with value\", function() {\n                util.loadXML(\"\");\n                util.paste([\n                    [\"id\", \"type\", \"itemsetData\"],\n                    [\"select\", \"SelectDynamic\",\n                     '[{\"instance\":null,\"nodeset\":\"/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\"}]'],\n                ]);\n                clickQuestion('select/itemset');\n                var options = $('[name=property-itemsetData] option'),\n                    custom = $(options[1]);\n                assert.equal(options.first().text(), \"Loading...\");\n                assert.equal(custom.text(), \"Lookup table was not found in the project\");\n                assert.equal(custom.parent().val(), '{\"id\":\"\",\"src\":\"\",\"query\":\"/items\"}');\n                assert.equal(options.length, 2, $(\"<div />\").append(options).html());\n            });\n\n            it(\"should select first option when empty and finished loading\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"SelectDynamic\", \"select\");\n                callback([{\n                    id: \"bar\",\n                    uri: \"jr://fixture/foo\",\n                    path: \"/root\",\n                    name: \"outer\",\n                    structure: {\n                        \"@id\": {},\n                        \"name\": {},\n                        \"inner\": {\n                            structure: {\n                                \"@id\": {},\n                                \"name\": {},\n                            },\n                        },\n                    },\n                }]);\n                clickQuestion('select/itemset');\n                var data = $('[name=property-itemsetData]');\n                assert.equal(data.val(),\n                    '{\"id\":\"bar\",\"src\":\"jr://fixture/foo\",\"query\":\"instance(\\'bar\\')/root\"}');\n                assert.equal(data.find(\"option:selected\").text(), \"outer\");\n                assert.equal($('[name=property-valueRef]').val(), '@id');\n                assert.equal($('[name=property-labelRef]').val(), 'name');\n            });\n\n            it(\"should select correct option when not empty and finished loading\", function() {\n                util.loadXML(\"\");\n                util.paste([\n                    [\"id\", \"type\", \"itemsetData\"],\n                    [\"select\", \"SelectDynamic\",\n                     '[{\"instance\":{\"id\":\"bar\",' +\n                     '\"src\":\"jr://fixture/foo\",\"query\":\"instance(\\'bar\\')/root/inner\"},' +\n                     '\"nodeset\":\"instance(\\'bar\\')/root/inner\",\"labelRef\":\"name\",\"valueRef\":\"@id\"}]'],\n                ]);\n                clickQuestion('select/itemset');\n                callback([{\n                    id: \"bar\",\n                    uri: \"jr://fixture/foo\",\n                    path: \"/root\",\n                    name: \"outer\",\n                    structure: {\n                        \"@id\": {},\n                        \"name\": {},\n                        \"inner\": {\n                            structure: {\n                                \"@id\": {},\n                                \"name\": {},\n                            },\n                        },\n                    },\n                }]);\n                var data = $('[name=property-itemsetData]');\n                assert.equal(data.val(),\n                    '{\"id\":\"bar\",\"src\":\"jr://fixture/foo\",\"query\":\"instance(\\'bar\\')/root/inner\"}');\n                assert.equal(data.find(\"option:selected\").text(), \"outer - inner\");\n            });\n\n            it(\"should not cause null xpath\", function () {\n                // bug only appeared on load XML with vellum:attr=\"value\" attributes\n                util.loadXML(CASE_PROPERTY_XML);\n                callback(options.dataSources);\n                util.assertXmlEqual(util.call(\"createXML\"),\n                    CASE_PROPERTY_XML\n                        .replace(/ vellum:\\w+=\".*?\"/g, \"\")\n                        .replace(/<vellum:hashtag.*>/g, \"\"));\n            });\n        });\n\n        describe(\"when still loading\", function() {\n            var vellum, callback;\n            before(function (done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (cb) { callback = cb; },\n                        onReady: function () {\n                            vellum = this;\n                            done();\n                        },\n                    },\n                });\n            });\n            beforeEach(function () {\n                vellum.datasources.reset();\n                callback = null;\n            });\n\n            it(\"should not lose output value xpath on save\", function () {\n                var hashtrans = /<vellum:hashtagTransforms.*>/,\n                    form = util.loadXML(NULL_HASHTAGS_XML.replace(hashtrans, \"\"));\n                assert(!vellum.datasources.isReady(), 'data sources should not be ready');\n                util.assertXmlEqual(util.call(\"createXML\"), NULL_HASHTAGS_XML);\n                assert(form.shouldInferHashtags, \"form.shouldInferHashtags\");\n            });\n\n            it(\"should not infer hashtags when <vellum:hashtagTransforms> is present\", function () {\n                var form = util.loadXML(NULL_HASHTAGS_XML);\n                assert(!vellum.datasources.isReady(), 'data sources should not be ready');\n                util.assertXmlEqual(util.call(\"createXML\"), NULL_HASHTAGS_XML);\n                assert(!form.shouldInferHashtags, \"form.shouldInferHashtags should be false\");\n            });\n\n            it(\"should show error on load sources with previously-known case property\", function () {\n                var form = util.loadXML(UNKNOWN_CASE_PROPERTY_XML),\n                    hid = util.getMug('hid'),\n                    txt = util.getMug('text');\n                assert(!vellum.datasources.isReady(), 'data sources should not be ready');\n                assert(util.isTreeNodeValid(hid), util.getMessages(hid));\n                assert(util.isTreeNodeValid(txt), util.getMessages(txt));\n                assert(!form.shouldInferHashtags, \"form.shouldInferHashtags\");\n                callback(DATA_SOURCES);\n                assert(!util.isTreeNodeValid(hid), '/data/hid should not be valid');\n                assert(!util.isTreeNodeValid(txt), '/data/text should not be valid');\n            });\n        });\n    });\n});\n","define([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'static/diffDataParent/parse.xml',\n    'static/diffDataParent/sibling-as-child.xml',\n    'static/diffDataParent/data-parent-mug-after.xml',\n    'static/diffDataParent/data-parent-mug-before.xml',\n    'static/diffDataParent/data-parent-mug-in-between.xml'\n], function (\n    chai, $,\n    _,\n    util,\n    PARSE_XML,\n    SIBLING_AS_CHILD,\n    DATA_PARENT_MUG_AFTER,\n    DATA_PARENT_MUG_BEFORE,\n    DATA_PARENT_MUG_IN_BETWEEN\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"Control elements with different data parents\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }}\n            });\n        });\n\n        it(\"should not allow repeat group children to have data parent outside of the repeat\", function() {\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", 'repeat1'),\n                text1 = util.addQuestion.bind({prevId: repeat.p.nodeID})(\"Text\", 'text1'),\n                text2 = util.addQuestion.bind({prevId: repeat.p.nodeID})(\"Text\", 'text2');\n\n            text2.p.dataParent = '#form';\n            assert(util.isTreeNodeValid(text1), \"text1 should be valid\");\n            assert(!util.isTreeNodeValid(text2), \"text2 should not be valid\");\n        });\n\n        it(\"should allow repeat group children to have data parent (in) the same repeat\", function() {\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", 'repeat'),\n                group = util.addQuestion.bind({prevId: 'repeat'})(\"Group\", 'group'),\n                text = util.addQuestion.bind({prevId: 'repeat/group'})(\"Text\", 'text');\n\n            text.p.dataParent = repeat.hashtagPath;\n            assert.equal(group, text.parentMug, \"group should be control parent of text\");\n            assert(util.isTreeNodeValid(text), \"text should be valid\");\n        });\n\n        it(\"should not allow nested repeat group children to have data parent in an outer repeat\", function() {\n            util.loadXML(\"\");\n            var repeat1 = util.addQuestion(\"Repeat\", 'repeat1'),\n                repeat2 = util.addQuestion.bind({prevId: 'repeat1'})(\"Repeat\", 'repeat2'),\n                text = util.addQuestion.bind({prevId: 'repeat1/repeat2'})(\"Text\", 'text');\n\n            text.p.dataParent = repeat1.hashtagPath;\n            assert.equal(repeat2, text.parentMug, \"repeat2 should be control parent of text\");\n            assert.match(util.getMessages(text),\n                /Data parent of question in repeat group must be .... the same repeat group/);\n        });\n\n        it(\"should not allow a data parent to be an input\", function() {\n            util.loadXML(\"\");\n            var text1 = util.addQuestion(\"Text\", 'text1'),\n                text2 = util.addQuestion(\"Text\", 'text2');\n\n            text2.p.dataParent = '#form/text1';\n            assert(util.isTreeNodeValid(text1), \"text1 should be valid\");\n            assert(!util.isTreeNodeValid(text2), \"text2 should not be valid\");\n        });\n\n        it(\"should keep the same data parent after a move\", function() {\n            util.loadXML(\"\");\n            var text1 = util.addQuestion(\"Text\", 'text1'),\n                text2 = util.addQuestion(\"Text\", 'text2'),\n                form = call(\"getData\").core.form;\n\n            util.addQuestion(\"Group\", 'group1');\n            text2.p.dataParent = '#form/group1';\n\n            form.moveMug(text2, 'before', text1);\n\n            assert.equal(text2.p.dataParent, '#form/group1');\n        });\n\n        it(\"should update data tree after a change to data parent\", function() {\n            util.loadXML(\"\");\n            var text1 = util.addQuestion(\"Text\", 'text1'),\n                group1 = util.addQuestion(\"Group\", 'group1'),\n                group2 = util.addQuestion.bind({prevId: text1.p.nodeID})(\"Group\", 'group2'),\n                form = call(\"getData\").core.form;\n\n            text1.p.dataParent = '#form/group1';\n            assert.equal(text1.p.dataParent, \"#form/group1\");\n            form.moveMug(group1, 'into', group2);\n            assert.equal(text1.p.dataParent, \"#form/group2/group1\");\n        });\n\n        it(\"should clear the data parent when moving to a repeat group\", function() {\n            util.loadXML(\"\");\n            var text1 = util.addQuestion(\"Text\", 'text1');\n            util.addQuestion(\"Group\", 'group1');\n            var repeat1= util.addQuestion.bind({prevId: text1.p.nodeID})(\"Repeat\", 'repeat1'),\n                form = call(\"getData\").core.form;\n            text1.p.dataParent = '#form/group1';\n            form.moveMug(text1, 'into', repeat1);\n            assert(util.isTreeNodeValid(text1), text1.getErrors().join(\"\\n\"));\n            assert.isUndefined(text1.p.dataParent);\n        });\n\n        it(\"should not clear the data parent when moving within a repeat group\", function() {\n            var form = util.loadXML(\"\");\n            var repeat1 = util.addQuestion(\"Repeat\", 'repeat1'),\n                group = util.addQuestion.bind({prevId: 'repeat1'})(\"Group\", 'group1'),\n                text1 = util.addQuestion.bind({prevId: 'repeat1'})(\"Text\", 'text1');\n            text1.p.dataParent = '#form/repeat1';\n            assert.equal(text1.parentMug, repeat1, \"repeat1 should be control parent of text\");\n            form.moveMug(text1, 'into', group);\n            assert(util.isTreeNodeValid(text1), text1.getErrors().join(\"\\n\"));\n            assert.equal(text1.p.dataParent, repeat1.hashtagPath);\n            assert.equal(text1.parentMug, group, \"group should be control parent of text\");\n        });\n\n        it(\"should clear the data parent when moving into a nested repeat group\", function() {\n            var form = util.loadXML(\"\");\n            var repeat1 = util.addQuestion(\"Repeat\", 'repeat1');\n            util.addQuestion.bind({prevId: 'repeat1'})(\"Repeat\", 'repeat2');\n            var group = util.addQuestion.bind({prevId: 'repeat1/repeat2'})(\"Group\", 'group1'),\n                text1 = util.addQuestion.bind({prevId: 'repeat1'})(\"Text\", 'text1');\n            text1.p.dataParent = '#form/repeat1';\n            assert.equal(text1.parentMug, repeat1, \"repeat1 should be control parent of text\");\n            form.moveMug(text1, 'into', group);\n            assert(util.isTreeNodeValid(text1), text1.getErrors().join(\"\\n\"));\n            assert.isUndefined(text1.p.dataParent);\n            assert.equal(text1.parentMug, group, \"group should be control parent of text\");\n        });\n\n        it(\"should have proper data parent after reloading the form\", function() {\n            util.loadXML(\"\");\n            var text1 = util.addQuestion(\"Text\", 'text1'),\n                form = call(\"getData\").core.form;\n\n            util.addQuestion(\"Group\", 'group1');\n\n            text1.p.dataParent = '#form/group1';\n            util.loadXML(call(\"createXML\"));\n            assert.equal(text1.p.dataParent, '#form/group1');\n            util.assertTreeState(form.dataTree(),\n                \"group1\",\n                \"  text1\"\n            );\n        });\n\n        it(\"should update mug path mapping on set data parent\", function() {\n            var form = util.loadXML(\"\"),\n                text = util.addQuestion(\"Text\", 'text');\n            util.addQuestion(\"Group\", 'group');\n            text.p.dataParent = '#form/group';\n            var map = JSON.stringify(_.object(_.map(form.mugMap, function (mug, path) {\n                if (path.startsWith(\"/\")) {\n                    return [path, mug.__className];\n                }\n                return [\"\", undefined];\n            })));\n            assert(util.getMug('/data/group/text'),\n                   'cannot find \"#form/group/text\" in ' + map);\n        });\n\n        it(\"should parse and write XML to have the same order\", function() {\n            util.loadXML(PARSE_XML);\n            util.assertXmlEqual(call(\"createXML\"), PARSE_XML);\n        });\n\n        it(\"should have proper data parent after being loaded from xml\", function() {\n            util.loadXML(PARSE_XML);\n            var diffChild = util.getMug(\"/data/parent/different-child\");\n            assert.equal(diffChild.p.dataParent, \"#form/parent\");\n            util.assertJSTreeState(\n                \"different-child\",\n                \"parent\",\n                \"  normal-child\"\n            );\n        });\n\n        it(\"should use the control parent when inserting after a mug with different data parent\", function() {\n            util.loadXML(\"\");\n            var form = call(\"getData\").core.form,\n                text1 = util.addQuestion(\"Text\", 'text1');\n            util.addQuestion(\"Group\", 'group');\n            util.addQuestion(\"Text\", 'text2');\n\n            text1.p.dataParent = '#form/group';\n            util.addQuestion.bind({prevId: text1.absolutePath})(\"Text\", 'text3');\n            // questions with alternate dataParent always come last in the data tree\n            util.assertTreeState(form.dataTree(),\n                \"text3\",\n                \"group\",\n                \"  text2\",\n                \"  text1\"\n            );\n            util.assertJSTreeState(\n                \"text1\",\n                \"text3\",\n                \"group\",\n                \"  text2\"\n            );\n        });\n\n        it(\"should properly load group before sibling/child\", function() {\n            util.loadXML(SIBLING_AS_CHILD);\n            var text = util.getMug(\"/data/text\");\n            assert.equal(text.p.dataParent, \"#form\");\n            util.assertJSTreeState(\n                \"group\",\n                \"  text\"\n            );\n            util.assertXmlEqual(call(\"createXML\"), SIBLING_AS_CHILD);\n        });\n\n        it(\"should properly load mug after other mugs\", function() {\n            util.loadXML(DATA_PARENT_MUG_AFTER);\n            var child = util.getMug(\"/data/parent/child\");\n            assert.equal(child.p.dataParent, \"#form/parent\");\n            util.assertJSTreeState(\n                \"before-child\",\n                \"child\",\n                \"parent\"\n            );\n            util.assertXmlEqual(call(\"createXML\"), DATA_PARENT_MUG_AFTER);\n        });\n\n        it(\"should properly load mug before other mugs\", function() {\n            util.loadXML(DATA_PARENT_MUG_BEFORE);\n            var child = util.getMug(\"/data/parent/child\");\n            assert.equal(child.p.dataParent, \"#form/parent\");\n            util.assertJSTreeState(\n                \"child\",\n                \"after-child\",\n                \"parent\"\n            );\n            util.assertXmlEqual(call(\"createXML\"), DATA_PARENT_MUG_BEFORE);\n        });\n\n        it(\"should properly load mug in between other mugs\", function() {\n            util.loadXML(DATA_PARENT_MUG_IN_BETWEEN);\n            var child = util.getMug(\"/data/parent/child\");\n            assert.equal(child.p.dataParent, \"#form/parent\");\n            util.assertJSTreeState(\n                \"before-child\",\n                \"child\",\n                \"after-child\",\n                \"parent\"\n            );\n            util.assertXmlEqual(call(\"createXML\"), DATA_PARENT_MUG_IN_BETWEEN);\n        });\n\n        it(\"should error on recursive data parent\", function() {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", 'mug');\n            assert.equal(mug.absolutePath, \"/data/mug\");\n            mug.p.dataParent = '#form/mug';\n            assert.deepEqual(mug.getErrors(),\n                [gettext(\"{path} is not a valid data parent\")\n                    .replace(\"{path}\", \"#form/mug\")]);\n        });\n    });\n});\n","define([\n    'underscore',\n    'chai',\n    'vellum/escapedHashtags',\n    'tests/utils',\n    'static/escapedHashtags/invalid-xpath.xml',\n], function (\n    _,\n    chai,\n    escapedHashtags,\n    util,\n    INVALID_XPATH_XML\n) {\n    var assert = chai.assert;\n\n    describe(\"The escaped hashtag parser\", function () {\n        function transformToProperty(input) {\n            var ret = input.split('/');\n            return ret[ret.length-1];\n        }\n\n        var hashtagMap = {\n                \"#form/text1\": \"/data/text1\",\n                \"#form/text2\": \"/data/text2\",\n            },\n            hashtagInfo = {\n                hashtagMap: hashtagMap,\n                invertedHashtagMap: _.invert(hashtagMap),\n                hashtagNamespaces: {form: true, \"case\": true},\n            };\n\n        describe(\"#transform()\", function() {\n            var testCases = [\n                [\"`#case/type/prop`\", \"#case/type/prop\", \"prop\"],\n                [\"`#case/type/prop`- 1\", \"#case/type/prop - 1\", \"prop - 1\"],\n                [\"(`#case/type/prop`)\", \"(#case/type/prop)\", \"(prop)\"],\n                [\"(`#case/type/prop`\", \"(#case/type/prop\", \"(prop\"],\n                [\n                    \"`#case/type/prop` = `#case/type/prop2`\",\n                    \"#case/type/prop = #case/type/prop2\",\n                    \"prop = prop2\",\n                ],\n                [\"``\", \"`\", \"`\"],\n                [\"🍊you glad I didn't use 🍌`\", \"🍊you glad I didn't use 🍌`\", \"🍊you glad I didn't use 🍌`\"],\n                [\"`🍠\", \"`🍠\", \"`🍠\"], // u1f360 conflicts with ` (u0060)\n                [\"`#case/type/prop` = `\", \"#case/type/prop = `\",  \"prop = `\"],\n                [\"`#case/type/prop` = ``\", \"#case/type/prop = `\", \"prop = `\"],\n                [\"`#case/prop1``#case/prop2` = ``\", \"#case/prop1#case/prop2 = `\", \"prop1prop2 = `\"],\n                [\"``#case/type/``prop` = ``\", \"`#case/type/`prop = `\", \"`#case/type/`prop = `\"],\n            ];\n\n            testCases.forEach(function (testCase) {\n                var input = testCase[0],\n                    outputNoTransform = testCase[1],\n                    outputToProp = testCase[2];\n\n                it(\"default transform should parse \" + input + \" into \" + outputNoTransform, function() {\n                    assert.strictEqual(escapedHashtags.transform(input), outputNoTransform);\n                });\n\n                it(\"custom transform should parse \" + input + \" into \" + outputToProp, function() {\n                    assert.strictEqual(escapedHashtags.transform(input, transformToProperty), outputToProp);\n                });\n            });\n        });\n\n        describe(\"#makeHashtagTransform() with #delimit()\", function() {\n            // Note: this combination is not currently used in production, but\n            // it's a good test for makeHashtagTransform\n            var testCases = [\n                    [\"#form/text1\", \"`#form/text1`\"],\n                    [\"/data/text1\", \"`#form/text1`\"],\n                    [\"`#form/text1`\", \"`#form/text1`\"],  // invalid xpath\n\n                    [\"#form/text1 -1\", \"`#form/text1` - 1\"],\n                    [\"/data/text1 -1\", \"`#form/text1` - 1\"],\n                    // invalid xpath, parse error -> no change\n                    [\"`#form/text1`-1\", \"`#form/text1`-1\"],\n                ],\n                transform = escapedHashtags.makeHashtagTransform(hashtagInfo),\n                delimit = escapedHashtags.delimit;\n\n            testCases.forEach(function(testCase) {\n                it(\"should parse \" + testCase[0] + \" into \" + testCase[1], function() {\n                    assert.strictEqual(transform(testCase[0], delimit), testCase[1]);\n                });\n            });\n        });\n    });\n\n    describe(\"The form's escaped hashtag parser with rich_text disabled\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: { langs: ['en'] },\n                core: {\n                    onReady: function () {\n                        done();\n                    }\n                },\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"reads invalid xpath with #invalid\", function () {\n            util.loadXML(INVALID_XPATH_XML);\n            var text = util.getMug('text'),\n                hidden = util.getMug('hidden');\n            assert.strictEqual(text.p.relevantAttr, '(/data/hidden');\n            assert.strictEqual(hidden.p.calculateAttr, '#form/text');\n        });\n    });\n\n    describe(\"The escaped hashtag\", function () {\n        before(function (done) {\n            util.init({\n                javaRosa: { langs: ['en'] },\n                core: {\n                    onReady: function () {\n                        done();\n                    }\n                },\n            });\n        });\n\n        it(\"writes invalid xpath with #invalid\", function () {\n            util.loadXML(\"\");\n            var text = util.addQuestion('Text', 'text'),\n                hidden = util.addQuestion('DataBindOnly', 'hidden');\n            text.p.relevantAttr = '#invalid/xpath (`#form/hidden`';\n            hidden.p.calculateAttr = '#form/text';\n            util.assertXmlEqual(\n                util.call(\"createXML\"),\n                INVALID_XPATH_XML,\n                {normalize_xmlns: true}\n            );\n        });\n    });\n});\n","/*jshint multistr: true */\n/*\n Updating these tests can be hard due to whitespace differences.\n The following approach is recommended:\n * Edit the TSV files in VI with the following settings:\n    * :set list  # display invisible chars\n    * :set noeol  # don't add a trailing newline character when saving the file\n * If you're still having problems with the last line, maybe try another editor, like VSCode.\n */\ndefine([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'static/all_question_types.xml',\n    'static/all_question_types.tsv',\n    'static/exporter/item-id.xml',\n    'static/exporter/item-id.tsv',\n    'static/javaRosa/multi-lang-trans.xml',\n    'static/exporter/vid-ref.xml',\n    'static/exporter/vid-ref.tsv'\n], function (\n    chai,\n    $,\n    _,\n    util,\n    ALL_QUESTIONS_XML,\n    ALL_QUESTIONS_TSV,\n    ITEM_ID_XML,\n    ITEM_ID_TSV,\n    MULTI_LANG_TRANS_XML,\n    VID_REF_XML,\n    VID_REF_TSV\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"The exporter\", function () {\n        beforeEach(function (done) {\n            util.init({\n                core: {\n                    onReady: function () {\n                        done();\n                    }\n                },\n                features: {\n                    rich_text: false,\n                    case_micro_image: true,\n                    use_custom_repeat_button_text: true,\n                },\n            });\n        });\n\n        it(\"should include question type in TSV\", function () {\n            util.loadXML(ALL_QUESTIONS_XML);\n            assert.equal(call(\"getData\").core.form.getExportTSV(), ALL_QUESTIONS_TSV);\n        });\n\n        it(\"should include item values in TSV\", function () {\n            util.loadXML(ITEM_ID_XML);\n            assert.equal(call(\"getData\").core.form.getExportTSV(), ITEM_ID_TSV);\n        });\n\n        it(\"should include video references in TSV\", function () {\n            util.loadXML(VID_REF_XML);\n            assert.equal(call(\"getData\").core.form.getExportTSV(), VID_REF_TSV);\n        });\n\n        it(\"should properly escape special characters\", function () {\n            util.loadXML(MULTI_LANG_TRANS_XML);\n            assert.equal(call(\"getData\").core.form.getExportTSV(),\n                'Question\\tType\\tText (en)\\tText (hin)\\tAudio (en)\\t' +\n                'Audio (hin)\\tImage (en)\\tImage (hin)\\tVideo (en)\\t' +\n                'Video (hin)\\tVideo Inline (en)\\tVideo Inline (hin)\\t' +\n                'Display Condition\\tValidation Condition\\tValidation Message\\t' + \n                'Calculate Condition\\tRequired\\tHint Text\\tHelp Text\\tComment\\n' +\n                '/text\\tText\\t\"\"\"Text\"\\t\"\"\"Text\"\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tno\\t\\t\\t'\n            );\n        });\n    });\n});\n","define([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'vellum/expressionEditor',\n], function (\n    chai,\n    $,\n    _,\n    util,\n    expressionEditor\n) {\n    var assert = chai.assert;\n\n    describe(\"The expression editor\", function () {\n        var form;\n        before(function (done) {\n            util.init({\n                javaRosa: { langs: ['en'] },\n                core: { onReady: function () {\n                    form = this.data.core.form;\n                    done();\n                }},\n            });\n        });\n\n        it(\"should trigger change event on join type changed\", function () {\n            util.loadXML(\"\");\n            var div = $(\"<div>\"),\n                text = util.addQuestion(\"Text\", \"text\"),\n                opts = makeOptions(text, '#form/text = \"1\" and #form/text = \"yes\"');\n            expressionEditor.showXPathEditor(div, opts);\n            var join = div.find(\".top-level-join-select\");\n            join.val(\"or\").change();\n            assert.equal(opts.changed, true, \"expected changed flag to be set\");\n        });\n\n        describe(\"xpath validator\", function () {\n            it(\"should not validate '#invalid/xpath ' prefix\", function () {\n                var expr = \"#invalid/xpath if(`#form/text`\",\n                    result = expressionEditor.validateXPath(form, expr);\n                assert.isNotOk(result[0], JSON.stringify(result));\n                assert.include(result[1].message, \"if(#form/text\");\n                assert.notInclude(result[1].message, \"#invalid/xpath\");\n            });\n        });\n    });\n\n    function makeOptions(mug, value) {\n        var opts = {\n            mug: mug,\n            xpathType: \"bool\",\n            value: value,\n            changed: false,\n            change: function () { opts.changed = true; }\n        };\n        return opts;\n    }\n\n});\n","define([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/form',\n    'vellum/tree',\n    'static/form/alternate-root-node-name.xml',\n    'static/form/group-with-internal-refs.xml',\n    'static/form/hidden-value-in-group.xml',\n    'static/form/hidden-value-tree-order.xml',\n    'static/form/instance-reference.xml',\n    'static/form/manual-instance-reference.xml',\n    'static/form/mismatch-tree-order.xml',\n    'static/form/missing-value.xml',\n    'static/form/name-template.xml',\n    'static/form/nested-groups.xml',\n    'static/form/question-referencing-other.xml',\n    'static/form/select-questions.xml',\n], function (\n    util,\n    chai,\n    $,\n    _,\n    form_,\n    Tree,\n    ALTERNATE_ROOT_NODE_NAME_XML,\n    GROUP_WITH_INTERNAL_REFS_XML,\n    HIDDEN_VALUE_IN_GROUP_XML,\n    HIDDEN_VALUE_TREE_ORDER,\n    INSTANCE_REFERENCE_XML,\n    MANUAL_INSTANCE_REFERENCE_XML,\n    MISMATCH_TREE_ORDER_XML,\n    MISSING_VALUE,\n    NAME_TEMPLATE,\n    NESTED_GROUPS_XML,\n    QUESTION_REFERENCING_OTHER_XML,\n    SELECT_QUESTIONS\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"The form component\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {\n                    onReady: function () {\n                        done();\n                    },\n                },\n            });\n        });\n\n        it(\"should get and fix serialization errors for mugs with matching paths\", function () {\n            var form = util.loadXML(\"\"),\n                one = util.addQuestion(\"Text\", \"question\"),\n                two = util.addQuestion(\"Text\", \"question\");\n            assert.notEqual(one.absolutePath, two.absolutePath);\n            var errors = form.getSerializationWarnings();\n            assert.equal(errors.length, 1, \"missing serialization error message\");\n            assert.equal(errors[0].mug.ufid, two.ufid);\n\n            form.fixSerializationWarnings(errors);\n            assert.equal(one.p.nodeID, \"question\");\n            assert.notEqual(one.absolutePath, two.absolutePath);\n            errors = form.getSerializationWarnings();\n            assert.deepEqual(errors, [], JSON.stringify(errors));\n        });\n\n        it(\"should retain expression meaning on rename matching path\", function () {\n            var blue = util.addQuestion(\"Text\", \"blue\"),\n                green = util.addQuestion(\"Text\", \"green\"),\n                black = util.addQuestion(\"DataBindOnly\", \"black\");\n            black.p.calculateAttr = \"#form/blue + #form/green\";\n            green.p.nodeID = \"blue\";\n            assert.notEqual(green.p.nodeID, \"blue\");\n            assert(!util.isTreeNodeValid(green), \"expected validation error\");\n\n            blue.p.nodeID = \"orange\";\n            assert.equal(green.p.nodeID, \"blue\");\n            assert.equal(black.p.calculateAttr, \"#form/orange + #form/blue\");\n            assert(util.isTreeNodeValid(blue), blue.getErrors().join(\"\\n\"));\n            assert(util.isTreeNodeValid(green), green.getErrors().join(\"\\n\"));\n            assert(util.isTreeNodeValid(black), black.getErrors().join(\"\\n\"));\n        });\n\n        it(\"should retain conflicted mug ID on move\", function () {\n            var form = util.loadXML(\"\"),\n                hid = util.addQuestion(\"DataBindOnly\", \"hid\"),\n                text = util.addQuestion(\"Text\", \"text\"),\n                group = util.addQuestion(\"Group\", \"group\");\n            util.addQuestion(\"Text\", \"text\");\n            hid.p.calculateAttr = \"#form/text + #form/group/text\";\n            form.moveMug(text, \"into\", group);\n            assert.notEqual(hid.p.calculateAttr, \"#form/text + #form/group/text\");\n            assert.notEqual(text.p.nodeID, \"text\");\n            assert(!util.isTreeNodeValid(text), \"expected #form/text error\");\n\n            form.moveMug(text, \"into\", null);\n            assert.equal(text.p.nodeID, \"text\");\n            assert.equal(hid.p.calculateAttr, \"#form/text + #form/group/text\");\n            assert(util.isTreeNodeValid(text), text.getErrors().join(\"\\n\"));\n        });\n\n        describe(\"The form's ID generation\", function() {\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        onReady: function () {\n                            done();\n                        }\n                    },\n                    features: {rich_text: false},\n                });\n            });\n\n            it(\"should generate ID based on label\", function () {\n                util.loadXML(\"\");\n                var name = call('addQuestion', \"Text\");\n                $(\"[name='itext-en-label']\").val('What is your name?').change();\n                var question1 = call('addQuestion', \"Text\"),\n                    copy = call('addQuestion', \"Text\");\n                $(\"[name='itext-en-label']\").val('What is your name?').change();\n                var blank = call('addQuestion', \"Text\");\n                assert.equal(name.p.nodeID, 'what_is_your_name');\n                assert.equal(question1.p.nodeID, 'question1');\n                assert.equal(copy.p.nodeID, 'copy-1-of-what_is_your_name');\n                assert.equal(blank.p.nodeID, undefined);\n            });\n        });\n\n        it(\"should show warnings for broken references on delete mug\", function () {\n            util.loadXML(QUESTION_REFERENCING_OTHER_XML);\n            var blue = call(\"getMugByPath\", \"/data/blue\"),\n                green = call(\"getMugByPath\", \"/data/green\"),\n                black = call(\"getMugByPath\", \"/data/black\");\n            assert(util.isTreeNodeValid(green), \"sanity check failed: green is invalid\");\n            assert(util.isTreeNodeValid(black), \"sanity check failed: black is invalid\");\n            util.clickQuestion(\"blue\");\n            blue.form.removeMugsFromForm([blue]);\n            assert(util.isTreeNodeValid(green), \"green should be valid\");\n            assert(!util.isTreeNodeValid(black), \"black should not be valid\");\n        });\n\n        it(\"should remove warnings when broken reference is fixed\", function () {\n            util.loadXML(QUESTION_REFERENCING_OTHER_XML);\n            var blue = call(\"getMugByPath\", \"/data/blue\"),\n                black = call(\"getMugByPath\", \"/data/black\");\n            blue.form.removeMugsFromForm([blue]);\n            assert(!util.isTreeNodeValid(black), \"black should not be valid\");\n            blue = util.addQuestion(\"Text\", \"blue\");\n            assert(util.isTreeNodeValid(black), util.getMessages(black));\n        });\n\n        it(\"should remove warnings when broken mug is deleted\", function () {\n            var form = util.loadXML(QUESTION_REFERENCING_OTHER_XML),\n                blue = call(\"getMugByPath\", \"/data/blue\"),\n                black = call(\"getMugByPath\", \"/data/black\");\n            form.removeMugsFromForm([blue]);\n            assert(form.hasBrokenReferences(), \"form should have broken reference\");\n            form.removeMugsFromForm([black]);\n            assert(!form.hasBrokenReferences(), \"form should not have broken references\");\n        });\n\n        it(\"should show duplicate question ID warning inline\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text\");\n            var text = util.addQuestion(\"Text\", \"text\"),\n                messages = text.messages.get(\"nodeID\");\n            assert.equal(messages.length, 1, messages.join(\"\\n\"));\n            // UI dependent, possibly fragile\n            var div = $(\"[name=property-nodeID]\").closest(\".widget\"),\n                msg = div.find(\".messages\").children();\n            assert.equal(msg.length, messages.length, msg.text());\n            assert.equal(msg[0].text, messages[0].message);\n        });\n\n        it(\"should warn about top-level question named 'case'\", function () {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", \"case\");\n            assert(mug.messages.get(\"nodeID\", \"mug-nodeID-reserved-name-warning\"),\n                \"mug-nodeID-reserved-name-warning was expected but not present\");\n            mug.p.nodeID = \"the-case\";\n            assert.equal(util.getMessages(mug), \"\");\n        });\n\n        it(\"should warn about question named 'Case' in group\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Group\", \"group\");\n            var mug = util.addQuestion(\"Text\", \"Case\");\n            assert(mug.messages.get(\"nodeID\", \"mug-nodeID-reserved-name-warning\"),\n                \"mug-nodeID-reserved-name-warning was expected but not present\");\n            mug.p.nodeID = \"the-case\";\n            assert.equal(util.getMessages(mug), \"\");\n        });\n\n        it(\"should warn about question named 'registration'\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Group\", \"group\");\n            var mug = util.addQuestion(\"Text\", \"registration\");\n            assert(mug.messages.get(\"nodeID\", \"mug-nodeID-reserved-name-warning\"),\n                \"mug-nodeID-reserved-name-warning was expected but not present\");\n            mug.p.nodeID = \"the-case\";\n            assert.equal(util.getMessages(mug), \"\");\n        });\n\n        it(\"should preserve internal references in copied group\", function () {\n            util.loadXML(GROUP_WITH_INTERNAL_REFS_XML);\n            var form = call(\"getData\").core.form,\n                group = util.getMug(\"group\");\n            form.duplicateMug(group);\n            var green2 = util.getMug(\"copy-1-of-group/green\");\n            assert.equal(green2.p.relevantAttr,\n                \"#form/copy-1-of-group/blue = 'red' and #form/red = 'blue'\");\n        });\n\n        it(\"should set non-standard form root node\", function () {\n            util.loadXML(ALTERNATE_ROOT_NODE_NAME_XML);\n            var form = call(\"getData\").core.form,\n                blue = call(\"getMugByPath\", \"/other/blue\");\n            assert.equal(form.getBasePath(), \"/other/\");\n            assert(blue !== null, \"mug not found: /other/blue\");\n            assert.equal(form.hashtagMap['#form'], '/other');\n        });\n\n        it(\"should be able to move item from Select to MSelect\", function () {\n            util.loadXML(SELECT_QUESTIONS);\n            var form = call(\"getData\").core.form,\n                item1 = util.addQuestion('Choice', 'choice1'),\n                item2 = util.addQuestion('Choice', 'choice2');\n            // should not throw an error\n            form.moveMug(item1, 'before', item2);\n        });\n\n        it(\"should update reference to hidden value in group\", function () {\n            util.loadXML(HIDDEN_VALUE_IN_GROUP_XML);\n            var group = call(\"getMugByPath\", \"/data/group\"),\n                label = call(\"getMugByPath\", \"/data/group/label\"),\n                hidden = call(\"getMugByPath\", \"/data/group/hidden\");\n\n            chai.expect(label.p.relevantAttr).to.include(\"#form/group/hidden\");\n            group.p.nodeID = \"x\";\n            assert.equal(group.absolutePath, \"/data/x\");\n            assert.equal(label.absolutePath, \"/data/x/label\");\n            assert.equal(hidden.absolutePath, \"/data/x/hidden\");\n            chai.expect(label.p.relevantAttr).to.include(\"#form/x/hidden\");\n        });\n\n        it(\"should update reference to moved hidden value in output tag\", function () {\n            util.loadXML(HIDDEN_VALUE_IN_GROUP_XML);\n            var form = call(\"getData\").core.form,\n                label = call(\"getMugByPath\", \"/data/group/label\"),\n                hidden = call(\"getMugByPath\", \"/data/group/hidden\");\n\n            chai.expect(label.p.relevantAttr).to.include(\"#form/group/hidden\");\n            chai.expect(label.p.labelItext.defaultValue()).to.include(\"#form/group/hidden\");\n            form.moveMug(hidden, \"first\", null);\n            assert.equal(hidden.absolutePath, \"/data/hidden\");\n            chai.expect(label.p.relevantAttr).to.include(\"#form/hidden\");\n            chai.expect(label.p.labelItext.defaultValue()).to.include(\"#form/hidden\");\n        });\n\n        it(\"should update repeat group reference\", function () {\n            util.loadXML(\"\");\n            var text = util.addQuestion(\"Text\", 'text'),\n                repeat = util.addQuestion(\"Repeat\", 'repeat');\n            repeat.p.repeat_count = '#form/text';\n            assert.equal(repeat.p.repeat_count, '#form/text');\n            text.p.nodeID = 'text2';\n            assert.equal(repeat.p.repeat_count, '#form/text2');\n        });\n\n        it (\"should show warnings for duplicate choice value\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", 'select');\n            var item1 = util.addQuestion('Choice', 'choice1'),\n                item2 = util.addQuestion('Choice', 'choice2');\n            assert(util.isTreeNodeValid(item1), item1.getErrors().join(\"\\n\"));\n            assert(util.isTreeNodeValid(item2), item2.getErrors().join(\"\\n\"));\n            item2.p.nodeID = \"choice1\";\n            assert(util.isTreeNodeValid(item1), \"choice1 should be valid\");\n            assert(!util.isTreeNodeValid(item2), \"choice2 should be invalid\");\n        });\n\n        it(\"should preserve order of the control tree\", function() {\n            util.loadXML(MISMATCH_TREE_ORDER_XML);\n            util.assertJSTreeState(\n                \"question1\",\n                \"question4\",\n                \"question2\",\n                \"  question3\",\n                \"question5\",\n                \"question6\"\n            );\n        });\n\n        it(\"should merge data-only-nodes with control nodes\", function() {\n            util.loadXML(HIDDEN_VALUE_TREE_ORDER);\n            util.assertJSTreeState(\n                \"question1\",\n                \"question5\",\n                \"question2\",\n                \"  question3\",\n                \"question6\",\n                \"question4\"\n            );\n        });\n\n        it(\"should delete nested groups\", function() {\n            var form = util.loadXML(NESTED_GROUPS_XML),\n                mugs = util.clickQuestion(\"group1\", \"group1/group2\");\n            form.removeMugsFromForm(mugs);\n            util.assertJSTreeState(\"\");\n        });\n\n        it(\"should delete nested groups v2\", function() {\n            var form = util.loadXML(NESTED_GROUPS_XML),\n                mugs = util.clickQuestion(\"group1\", \"group1/group2/group3\");\n            form.removeMugsFromForm(mugs);\n            util.assertJSTreeState(\"\");\n        });\n\n        function assertInstanceSrc(id, form, expect, message) {\n            var xml = _.isString(form) ? form : form.createXML(),\n                $xml = util.parseXML(xml),\n                result = $xml.find(\"model > instance[id='\" + id + \"']\").attr(\"src\");\n            assert.equal(result, expect, message ? message + \"\\n\" + xml : \"\");\n        }\n\n        it(\"should not drop referenced instance on delete dynamic select\", function() {\n            var form = util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\", \"labelItext:en-default\", \"calculateAttr\", \"itemsetData\"],\n                [\"/hidden\", \"DataBindOnly\", \"null\",\n                 \"instance('some-fixture')/some-fixture_list/some-fixture/@id\", \"null\"],\n                [\"/select\", \"SelectDynamic\", \"select\", \"null\",\n                    '[{\"instance\":{\"id\":\"some-fixture\",' +\n                                  '\"src\":\"jr://fixture/item-list:some-fixture\"},' +\n                    '\"nodeset\":\"instance(\\'some-fixture\\')/some-fixture_list/some-fixture\",' +\n                    '\"labelRef\":\"name\",\"valueRef\":\"@id\"}]']\n            ]);\n            util.deleteQuestion(\"select\");\n            assertInstanceSrc(\"some-fixture\", form,\n                \"jr://fixture/item-list:some-fixture\",\n                \"some-fixture instance not found\");\n        });\n\n        it(\"should drop instance on delete last reference\", function() {\n            var form = util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\", \"calculateAttr\", \"instances\"],\n                [\"/hidden\", \"DataBindOnly\",\n                 \"instance('some-fixture')/some-fixture_list/some-fixture/@id\",\n                 '{\"some-fixture\":\"jr://fixture/item-list:some-fixture\"}'],\n            ]);\n            assertInstanceSrc(\"some-fixture\", form,\n                \"jr://fixture/item-list:some-fixture\");\n            util.deleteQuestion(\"hidden\");\n            assertInstanceSrc(\"some-fixture\", form, undefined,\n                \"some-fixture instance not found\");\n        });\n\n        it(\"should maintain instance on delete and re-add last reference\", function() {\n            var form = util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\", \"calculateAttr\", \"instances\"],\n                [\"/hidden\", \"DataBindOnly\",\n                 \"instance('some-fixture')/some-fixture_list/some-fixture/@id\",\n                 '{\"some-fixture\":\"jr://fixture/item-list:some-fixture\"}'],\n            ]);\n            util.deleteQuestion(\"hidden\");\n            assertInstanceSrc(\"some-fixture\", form, undefined);\n            var hid = util.addQuestion(\"DataBindOnly\", \"hid\");\n            hid.p.calculateAttr = \"instance('some-fixture')/some-fixture_list/some-fixture/@id\";\n            assertInstanceSrc(\"some-fixture\", form,\n                \"jr://fixture/item-list:some-fixture\",\n                \"some-fixture instance not found\");\n        });\n\n        it(\"should not delete instance from itemsets with nested filters\", function() {\n            var form = util.loadXML(INSTANCE_REFERENCE_XML);\n            assertInstanceSrc(\"groups\", form,\n                \"jr://fixture/user-groups\",\n                \"groups instance not found\");\n        });\n\n        it(\"should not delete manual instances when it's reference is updated\", function() {\n            util.loadXML(MANUAL_INSTANCE_REFERENCE_XML);\n            util.clickQuestion('output');\n            $('[name=property-calculateAttr]').change();\n            util.assertXmlEqual(call('createXML'), MANUAL_INSTANCE_REFERENCE_XML);\n        });\n\n        it (\"should warn on delete question\", function() {\n            util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\", \"labelItext:en-default\"],\n                [\"/q1\", \"Text\", '<output value=\"#form/q2\" /> <output value=\"#form/q3\" />'],\n                [\"/q2\", \"DataBindOnly\", \"null\"],\n                [\"/q3\", \"DataBindOnly\", \"null\"],\n            ]);\n            var q1 = util.getMug(\"q1\");\n            assert(util.isTreeNodeValid(q1), q1.getErrors().join(\"\\n\"));\n            util.deleteQuestion(\"q2\");\n            assert(!util.isTreeNodeValid(q1), \"q1 should not be valid\");\n        });\n\n        it(\"should warn about changing question ID\", function () {\n            var form = util.loadXML(SELECT_QUESTIONS);\n            form.warnWhenChanged = true;\n            var mug = util.getMug(\"question1\");\n            assert.equal(util.getMessages(mug), \"\");\n\n            mug.p.nodeID = \"new-question-id\";\n            assert(mug.messages.get(\"nodeID\", \"mug-nodeID-changed-warning\"),\n                \"mug-nodeID-changed-warning was expected\");\n\n            mug.p.nodeID = \"question1\";\n            assert.equal(util.getMessages(mug), \"\");\n        });\n\n        it(\"should not warn about changing question ID\", function () {\n            var form = util.loadXML(SELECT_QUESTIONS);\n            form.warnWhenChanged = false;\n            var mug = util.getMug(\"question1\");\n            assert.equal(util.getMessages(mug), \"\");\n\n            mug.p.nodeID = \"new-question-id\";\n            assert(mug.messages.get(\"nodeID\", \"\"),\n                \"mug-nodeID-changed-warning was not expected\");\n        });\n\n        it(\"should skip warning about changing question ID\", function () {\n            var form = util.loadXML(SELECT_QUESTIONS);\n            form.warnWhenChanged = true;\n            var mug = util.getMug(\"question1\");\n            assert.equal(util.getMessages(mug), \"\");\n\n            mug.p.nodeID = \"new-question-id\";\n            assert(mug.messages.get(\"nodeID\", \"mug-nodeID-changed-warning\"),\n                \"mug-nodeID-changed-warning was expected\");\n\n            mug.showChangedMsg = false;\n            assert(mug.messages.get(\"nodeID\", \"\"),\n                \"mug-nodeID-changed-warning was not expected\");\n        });\n\n        it(\"should load choice with missing value\", function () {\n            util.loadXML(MISSING_VALUE);\n            var mug = util.getMug(\"choice/\");\n            assert.equal(mug.p.nodeID, \"\");\n            assert(mug.messages.get(\"nodeID\", \"mug-nodeID-error\"),\n                'mug-nodeID-error was expected');\n        });\n\n        describe(\"with async data sources\", function() {\n            var vellum, callback;\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        dataSourcesEndpoint: function (cb) { callback = cb; },\n                        onReady: function () {\n                            vellum = this;\n                            done();\n                        },\n                    },\n                });\n            });\n            beforeEach(function () {\n                vellum.datasources.reset();\n                callback = null;\n            });\n\n            it(\"should not set case hashtags flag before data sources are loaded\", function () {\n                var form = util.loadXML(\"\");\n                assert.isNotOk(form.hasCaseHashtags);\n                callback(util.options.dataSources);\n                assert.isOk(form.hasCaseHashtags);\n            });\n\n            it(\"should update fuse when data sources are loaded\", function () {\n                var form = util.loadXML(\"\");\n                form.fire(\"form-load-finished\");\n                assert.deepEqual(form.fuse.list(), []);\n                callback(util.options.dataSources);\n                assert.notDeepEqual(form.fuse.list(), []);\n            });\n        });\n\n        describe(\"with rich text disabled\", function() {\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        onReady: function () {\n                            done();\n                        },\n                    },\n                    features: {rich_text: false},\n                });\n            });\n\n            it(\"should update case hashtags on enabling rich text\", function () {\n                var form = util.loadXML(\"\");\n                util.addQuestion(\"Text\", \"text\");\n                assert(form.isValidHashtag(\"#form/text\"), \"not valid: #form/text\");\n                form.setAttr(\"richText\", true);\n                assert(form.isValidHashtag(\"#case/dob\"), \"not valid: #case/dob\");\n                assert(form.isValidHashtag(\"#form/text\"), \"not valid: #form/text\");\n            });\n\n            it(\"should update fuse on enabling rich text\", function () {\n                var form = util.loadXML(\"\");\n                form.fire(\"form-load-finished\");\n                assert.deepEqual(form.fuse.list(), []);\n                form.setAttr(\"richText\", true);\n                assert.notDeepEqual(form.fuse.list(), []);\n            });\n        });\n\n        describe(\"naming logic\", function () {\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        formName: null,\n                        onReady: function () {\n                            done();\n                        },\n                    },\n                });\n            });\n\n            it('should use default name for empty form', function() {\n                var form = util.loadXML(\"\"),\n                    xml = util.parseXML(call('createXML'));\n                assert.equal(form.formName, \"New Form\");\n                assert.equal($(xml[0].getElementsByTagName('h:title')).text(), \"New Form\", \"title\");\n                assert.equal(xml.find(\"data\").attr(\"name\"), \"New Form\", \"data\");\n            });\n\n            it('should use default name when no other name is specified', function() {\n                var form = util.loadXML(\n                        _.template(NAME_TEMPLATE)({title: '', dataName: ''}),\n                        null,\n                        /^Form does not have a Name!/\n                    ),\n                    xml = util.parseXML(call('createXML'));\n                assert.equal(form.formName, \"New Form\");\n                assert.equal($(xml[0].getElementsByTagName('h:title')).text(), \"New Form\", \"title\");\n                assert.equal(xml.find(\"data\").attr(\"name\"), \"New Form\", \"data\");\n            });\n\n            it('should prefer <data name=\"...\"> over <title>', function() {\n                var form = util.loadXML(_.template(NAME_TEMPLATE)({\n                        title: '<h:title>Title</h:title>',\n                        dataName: 'name=\"Data Name\"',\n                    })),\n                    xml = util.parseXML(call('createXML'));\n                assert.equal(form.formName, \"Data Name\");\n                assert.equal($(xml[0].getElementsByTagName('h:title')).text(), \"Data Name\", \"title\");\n                assert.equal(xml.find(\"data\").attr(\"name\"), \"Data Name\", \"data\");\n            });\n\n            it('should use <title> if <data name=\"...\"> is absent', function() {\n                var form = util.loadXML(_.template(NAME_TEMPLATE)({\n                        title: '<h:title>Title</h:title>',\n                        dataName: '',\n                    })),\n                    xml = util.parseXML(call('createXML'));\n                assert.equal(form.formName, \"Title\");\n                assert.equal($(xml[0].getElementsByTagName('h:title')).text(), \"Title\", \"title\");\n                assert.equal(xml.find(\"data\").attr(\"name\"), \"Title\", \"data\");\n            });\n\n            describe(\"with core.formName option\", function () {\n                before(function (done) {\n                    util.init({\n                        javaRosa: {langs: ['en']},\n                        core: {\n                            formName: \"Optional Name\",\n                            onReady: function () {\n                                done();\n                            },\n                        },\n                    });\n                });\n\n                it('should override all other names', function() {\n                    var form = util.loadXML(_.template(NAME_TEMPLATE)({\n                            title: '<h:title>Title</h:title>',\n                            dataName: 'name=\"Data Name\"',\n                        })),\n                        xml = util.parseXML(call('createXML'));\n                    assert.equal(form.formName, \"Optional Name\");\n                    assert.equal($(xml[0].getElementsByTagName('h:title')).text(), \"Optional Name\", \"title\");\n                    assert.equal(xml.find(\"data\").attr(\"name\"), \"Optional Name\", \"data\");\n                });\n            });\n        });\n\n        describe(\"instance tracker\", function () {\n            var form, mug, prop = \"calculateAttr\";\n            before(function () {\n                form = util.loadXML(\"\");\n                mug = util.addQuestion(\"DataBindOnly\", \"hid\");\n                prop = \"calculateAttr\";\n                form.addInstanceIfNotExists(\n                        {id: \"old\", src: \"old://\"}, mug, \"relevantAttr\");\n                form.addInstanceIfNotExists({id: \"blank\"}, mug, \"relevantAttr\");\n                form.updateKnownInstances({\"known\": \"known://\"});\n            });\n\n            _.each([\n                // [attrs, expectId, expectSrc]\n                [{id: \"new0\", src: null}, \"new0\", undefined],\n                [{id: \"new1\", src: \"new://1\"}, \"new1\", \"src\"],\n                [{id: \"new2\", src: \"old://\"}, \"old\", \"src\"],\n                [{id: \"old\", src: null}, \"old\", \"old://\"],\n                [{id: \"old\", src: \"new://3\"}, \"old-1\", \"src\"],\n                [{id: \"old\", src: \"old://\"}, \"old\", \"src\"],\n                [{id: \"any\", src: \"old://\"}, \"old\", \"src\"],\n                [{id: \"known\", src: undefined}, \"known\", \"known://\"],\n                [{id: \"blank\", src: \"blank://\"}, \"blank\", \"src\"],\n                [{id: null, src: \"new://5\"}, \"data-1\", \"src\"],\n                //[{id: null, src: null}, \"data-1\", \"src\"],     Error!\n            ], function (item) {\n                var attrs = item[0],\n                    expectId = item[1],\n                    expectSrc = item[2] === \"src\" ? attrs.src : item[2];\n                it(\"should add instance \" + JSON.stringify(attrs) + \" -> \" +\n                        expectId + \": \" + expectSrc, function () {\n                    assertInstanceSrc(expectId, form,\n                        expectId === \"old\" ? expectSrc : undefined);\n                    var result = form.addInstanceIfNotExists(attrs, mug, prop);\n                    if (_.isRegExp(expectId)) {\n                        chai.expect(result).to.match(expectId);\n                    } else {\n                        assert.equal(result, expectId);\n                    }\n                    assertInstanceSrc(expectId, form, expectSrc,\n                        expectId + \" instance not found\");\n                    form.dropAllInstanceReferences(mug, prop);\n                    if (expectId === \"old\" || expectId === \"blank\") {\n                        assertInstanceSrc(expectId, form, expectSrc,\n                            expectId + \" instance should be removed\");\n                    } else {\n                        assertInstanceSrc(expectId, form, undefined,\n                            expectId + \" instance should be removed\");\n                    }\n                });\n            });\n        });\n\n        describe(\"hashtag logic\", function () {\n            var form, longPaths = {};\n            before(function () {\n                form = util.loadXML(\"\");\n            });\n\n            longPaths[\"instance('casedb')/cases/case[\" +\n                \"@case_id = instance('commcaresession')/session/data/case_id\" +\n                \"]/dob\"] = \"xpath\";\n\n            _.each(_.extend({\n                \"\": null,\n                \"#\": null,\n\n                \"#form\": null,\n                /* should these pass? (they don't)\n                \"#form/prop\": \"has xpath\",\n                */\n\n                \"/data\": null,\n                \"/data/\": null,\n                \"/data/prop\": \"xpath\",\n\n                \"#case\": null,\n                \"#case/prop\": \"has xpath\",\n\n                \"#case/parent\": \"has xpath\",\n                \"#case/parent/prop\": \"has xpath\",\n\n                \"#case/grandparent\": \"has xpath\",\n                \"#case/grandparent/prop\": \"has xpath\",\n\n                \"#case/nope/not\": null,\n\n                \"#user\": null,\n                \"#user/prop\": \"has xpath\",\n            }, longPaths), function (valid, path) {\n                function may(name) {\n                    return valid[name] ? \"\" : \"not \";\n                }\n                valid = _.object(_.map((valid || \"\").split(\" \"), function (key) {\n                    return [key, true];\n                }));\n\n                it(\"should \" + may(\"has\") + \"recognize \" + path + \" as having hashtag prefix\", function () {\n                    assert.equal(form.hasValidHashtagPrefix(path), !!valid.has);\n                });\n\n                it(\"should \" + may(\"xpath\") + \"parse \" + path + \" to valid xpath\", function () {\n                    try {\n                        form.xpath.parse(path).toXPath();\n                        assert(valid.xpath, \"valid?! \" + path);\n                    } catch (err) {\n                        assert(!valid.xpath, \"not valid: \" + path + \"\\nerror: \" + err);\n                    }\n                });\n            });\n        });\n\n        describe(\"updateInstanceQuery\", function () {\n\n\n            it('should not replace ids if name closes with a 2', function() {\n                // This is just to test the previous behavior does not happen anymore\n                const form = util.loadXML(\"\");\n                const query = \"instance('oldId\\2)/session/data/case_id\";\n                const instanceId = \"newId\";\n                const oldInstanceId = \"oldId\";\n                const updatedQuery = form.updateInstanceQuery(query, instanceId, oldInstanceId);\n                assert.equal(updatedQuery, query);\n            });\n\n            it('should replace ids if old instance Id is provided', function() {\n                const form = util.loadXML(\"\");\n                const query = \"instance('oldId')/session/data/case_id\";\n                const instanceId = \"newId\";\n                const oldInstanceId = \"oldId\";\n                const updatedQuery = form.updateInstanceQuery(query, instanceId, oldInstanceId);\n                assert.equal(updatedQuery, \"instance('newId')/session/data/case_id\");\n            });\n\n            it('should replace ids if there is leading white space', function() {\n                const form = util.loadXML(\"\");\n                const query = \"word instance('oldId')/session/data/case_id\";\n                const instanceId = \"newId\";\n                const oldInstanceId = \"oldId\";\n                const updatedQuery = form.updateInstanceQuery(query, instanceId, oldInstanceId);\n                assert.equal(updatedQuery, \"word instance('newId')/session/data/case_id\");\n            });\n\n            it('should replace ids if there is no old', function() {\n                const form = util.loadXML(\"\");\n                const query = \"instance('oldId')/session/data/case_id\";\n                const instanceId = \"newId\";\n                const updatedQuery = form.updateInstanceQuery(query, instanceId);\n                assert.equal(updatedQuery, \"instance('newId')/session/data/case_id\");\n            });\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'static/ignoreButRetain/case-with-update.xml',\n    'static/ignoreButRetain/common.xml',\n    'static/ignoreButRetain/common-ignored.xml',\n    'static/ignoreButRetain/delete-bug-after.xml',\n    'static/ignoreButRetain/delete-bug-before.xml',\n    'static/ignoreButRetain/empty-parent.xml',\n    'static/ignoreButRetain/ignore-in-head.xml',\n    'static/ignoreButRetain/ignored-binds-with-extra-path.xml',\n    'static/ignoreButRetain/ignored-control-node.xml',\n    'static/ignoreButRetain/ignored-data-node.xml',\n    'static/ignoreButRetain/ignored-tag-first.xml',\n    'static/ignoreButRetain/multiple-ignores.xml',\n    'static/ignoreButRetain/multi-match.xml',\n    'static/ignoreButRetain/nested-ignored-nodes.xml',\n    'static/ignoreButRetain/referenced-renamed.xml',\n    'static/ignoreButRetain/referenced-unrenamed.xml',\n    'static/ignoreButRetain/renamed.xml',\n    'static/ignoreButRetain/unknown-element.xml',\n    'static/ignoreButRetain/unrenamed.xml'\n], function (\n    util,\n    chai,\n    $,\n    CASE_WITH_UPDATE,\n    COMMON,\n    COMMON_IGNORED,\n    DELETE_BUG_AFTER,\n    DELETE_BUG_BEFORE,\n    EMPTY_PARENT,\n    IGNORE_IN_HEAD,\n    IGNORED_BINDS_WITH_EXTRA_PATH,\n    IGNORED_CONTROL_NODE,\n    IGNORED_DATA_NODE,\n    IGNORED_TAG_FIRST,\n    MULTIPLE_IGNORES,\n    MUTLI_MATCH,\n    NESTED_IGNORED_NODES,\n    REFERENCED_RENAMED,\n    REFERENCED_UNRENAMED,\n    RENAMED,\n    UNKNOWN_ELEMENT,\n    UNRENAMED\n) {\n    var assertXmlEqual = util.assertXmlEqual,\n        call = util.call;\n\n    describe(\"The Ignore-But-Retain plugin\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n            });\n        });\n\n        var testXmlPair = function (rawXml, processedXml) {\n            util.loadXML(rawXml);\n            assertXmlEqual(call('createXML'), rawXml);\n\n            call('getData').ignore.ignoredNodes = [];\n            assertXmlEqual(call('createXML'), processedXml);\n        };\n\n        it(\"ignores data, bind, body, and setvalue nodes with various edge cases (see XML)\", function () {\n            testXmlPair(COMMON, COMMON_IGNORED);\n        });\n\n        it(\"can insert ignored element into empty parent\", function () {\n            util.loadXML(EMPTY_PARENT);\n            assertXmlEqual(call('createXML'), EMPTY_PARENT);\n        });\n\n        it(\"does not insert multiple copies of ignored nodes\", function () {\n            util.loadXML(MUTLI_MATCH);\n            assertXmlEqual(call('createXML'), MUTLI_MATCH);\n        });\n\n        it(\"can ignore elements in <head>\", function () {\n            // fixes TypeError: 'undefined' is not an object (evaluating 'element.firstElementChild')\n            util.loadXML(IGNORE_IN_HEAD);\n            assertXmlEqual(call('createXML'), IGNORE_IN_HEAD);\n        });\n\n        it(\"preserves position when first tag in <HEAD> is ignored\", function () {\n            util.loadXML(IGNORED_TAG_FIRST);\n            assertXmlEqual(call('createXML'), IGNORED_TAG_FIRST);\n        });\n\n        it(\"handles multiple ignore nodes in a row\", function () {\n            testXmlPair(MULTIPLE_IGNORES, MULTIPLE_IGNORES);\n        });\n\n        it(\"handles an ignore node's reference node being renamed\", function () {\n            util.loadXML(UNRENAMED);\n            call('getMugByPath', '/data/question9').p.nodeID = 'question9a';\n            assertXmlEqual(call('createXML'), RENAMED);\n        });\n\n        it(\"handles a node being renamed that's referenced in an ignore node's XML\", function () {\n            util.loadXML(REFERENCED_UNRENAMED);\n            call('getMugByPath', '/data/question1').p.nodeID = 'foobar';\n            assertXmlEqual(call('createXML'), REFERENCED_RENAMED);\n        });\n\n        it(\"keeps relative position on delete sibling of ignored element\", function () {\n            util.loadXML(DELETE_BUG_BEFORE);\n            util.deleteQuestion(\"delete-me\");\n            assertXmlEqual(call('createXML'), DELETE_BUG_AFTER);\n        });\n\n        it(\"should not duplicate nested ignored nodes\", function () {\n            util.loadXML(NESTED_IGNORED_NODES);\n            assertXmlEqual(call('createXML'), NESTED_IGNORED_NODES);\n        });\n\n        it(\"should preserve data node children\", function () {\n            util.loadXML(CASE_WITH_UPDATE);\n            assertXmlEqual(call('createXML'), CASE_WITH_UPDATE);\n        });\n\n        it(\"should ignore binds and controls associated with ignored data node\", function () {\n            util.loadXML(IGNORED_DATA_NODE);\n            util.assertJSTreeState(\"question\");\n            assertXmlEqual(call('createXML'), IGNORED_DATA_NODE);\n        });\n\n        it(\"should ignore bind nodes with extra path elements\", function () {\n            util.loadXML(IGNORED_BINDS_WITH_EXTRA_PATH);\n            util.assertJSTreeState(\n                \"question\",\n                \"question2\"\n            );\n            assertXmlEqual(call('createXML'), IGNORED_BINDS_WITH_EXTRA_PATH);\n        });\n\n        it(\"should ignore control node\", function () {\n            util.loadXML(IGNORED_CONTROL_NODE);\n            util.assertJSTreeState(\n                \"question\",\n                \"ignored--1\"\n            );\n            assertXmlEqual(call('createXML'), IGNORED_CONTROL_NODE);\n        });\n\n        it(\"should load form with unknown/un-ignored element\", function () {\n            util.loadXML(UNKNOWN_ELEMENT);\n            assertXmlEqual(call('createXML'), UNKNOWN_ELEMENT);\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'chai',\n    'tests/utils',\n    'jquery',\n    'tests/static/lock/test.xml',\n], function (\n    chai,\n    util,\n    $,\n    TEST_XML\n) {\n    // NOTE: timer mocking here doesn't actually work, it only handles timeouts,\n    // doesn't actually implement sleep-like functionality.\n    // Need to change things under test to be async if you need to ensure they've\n    // finished before testing something (or make things under test not use\n    // setTimeout/Interval.  Use callbacks or https://github.com/cujojs/when.\n\n    var assert = chai.assert,\n        clickQuestion = util.clickQuestion,\n        call = util.call,\n        getInput = util.getInput;\n    \n    function beforeFn(done) {\n        util.init({\n            javaRosa: {langs: ['en']},\n            core: {\n                onReady: function () {\n                    call('loadXFormOrError', TEST_XML, done);\n                }\n            }\n        });\n    }\n\n    describe(\"The Lock plugin\", function() {\n        before(beforeFn);\n\n        function locked(mugPath, property) {\n            return call('isPropertyLocked', mugPath, property);\n        }\n        function moveable(mugPath) {\n            return call('isMugPathMoveable', mugPath);\n        }\n        function deleteable(mugPath) {\n            return call('isMugRemoveable', call('getMugByPath', mugPath), mugPath);\n        }\n        function changeable(mugPath) {\n            return call('isMugTypeChangeable', call('getMugByPath', mugPath), mugPath);\n        }\n\n        it(\"preserves XML with vellum:lock attributes\", function () {\n            util.assertXmlEqual(TEST_XML, call('createXML'));\n        });\n\n        it(\"disallows renaming a locked node\", function () {\n            assert(locked('#form/node_locked', 'nodeID'));\n            assert(locked('#form/value_locked', 'nodeID'));\n            assert.isFalse(locked('#form/none_locked', 'nodeID'));\n            assert.isFalse(locked('#form/normal', 'nodeID'));\n        });\n\n        it(\"disallows moving a locked node to a different parent\", function () {\n            assert.isFalse(moveable('#form/node_locked'));\n            assert.isFalse(moveable('#form/value_locked'));\n            assert(moveable('#form/none_locked'));\n            assert(moveable('#form/normal'));\n        });\n\n        it(\"disallows deleting a locked node\", function () {\n            assert.isFalse(deleteable('#form/node_locked'));\n            assert.isFalse(deleteable('#form/value_locked'));\n            assert(deleteable('#form/none_locked'));\n            assert(deleteable('#form/normal'));\n        });\n\n        it(\"disallows changing the type only of a 'value' locked node\", function () {\n            assert.isFalse(changeable('#form/value_locked'));\n            assert(changeable('#form/node_locked'));\n            assert(changeable('#form/none_locked'));\n            assert(changeable('#form/normal'));\n        });\n\n        it(\"allows changing only the Itext IDs of a 'value' locked node\", function () {\n            assert.isFalse(locked('#form/value_locked', 'constraintMsgItext'));\n            assert(locked('#form/value_locked', 'constraintAttr'));\n        });\n\n        it(\"allows changing any property of a non-locked node\", function () {\n            assert.isFalse(locked('#form/node_locked'));\n            assert.isFalse(locked('#form/none_locked'));\n            assert.isFalse(locked('#form/normal'));\n        });\n    });\n\n\n    describe(\"The question locking functionality in the core and UI\", function () {\n        before(beforeFn);\n\n        describe(\"The edit locking\", function () {\n            it(\"shows the delete button for deleteable questions\", function () {\n                clickQuestion('normal');\n                assert($(\"button:contains(Delete)\").length === 1);\n            });\n            \n            it(\"hides the delete button for non-deletable questions\", function () {\n                clickQuestion('node_locked');\n                assert($(\"button:contains(Delete)\").length === 0);\n            });\n\n            function testTypeChangeable(bool) {\n                clickQuestion(bool ? \"normal\" : \"value_locked\");\n                var btn = $(\".btn.current-question\");\n                assert(btn.length === 1);\n                btn.click();\n                var menu = btn.closest('.question-type-changer');\n                assert.equal(!!menu.find('li:not(.dropdown-header)').length, bool);\n            }\n            it(\"shows the type changer for type-changeable questions\", function () {\n                testTypeChangeable(true);\n            });\n            it(\"hides the type changer for non-type-changeable questions\", function () {\n                testTypeChangeable(false);\n            });\n\n            it(\"disables the checkbox (only) for a locked boolean property\", function () {\n                clickQuestion(\"value_locked\");\n                assert(getInput('requiredAttr').prop('disabled'));\n\n                clickQuestion(\"normal\");\n                var $r = getInput('requiredAttr');\n                assert.isFalse($r.prop('disabled'));\n            });\n\n            it(\"disables the text input (only) for a locked text property\", function () {\n                clickQuestion(\"normal\");\n                assert.isFalse(getInput('nodeID').prop('disabled'));\n\n                clickQuestion(\"value_locked\");\n                assert(getInput(\"nodeID\").prop('disabled'));\n            });\n\n            function testEditButton(bool) {\n                clickQuestion(bool ? \"value_locked\" : \"normal\");\n                var $but = getInput('relevantAttr').parents('.form-group').find('button.fd-edit-button');\n                assert.equal(1, $but.length);\n                assert.equal(bool, $but.prop('disabled'));\n            }\n            it(\"enables the edit button for non-locked logic properties\", function () {\n                testEditButton(false);\n            });\n           \n            it(\"disables the edit button for locked logic properties\", function () {\n                testEditButton(true);\n            });\n        });\n    });\n});\n","define([\n    'tests/utils',\n    'chai',\n    'underscore',\n    'jquery',\n    'vellum/intentManager',\n    'vellum/widgets',\n    'static/intentManager/intent-with-unknown-attrs.xml',\n    'static/intentManager/intent-with-no-mug.xml',\n    'static/intentManager/printing-intent.xml',\n    'static/intentManager/custom-intent.xml'\n], function (\n    util,\n    chai,\n    _,\n    $,\n    intentManager,\n    widgets,\n    INTENT_WITH_UNKNOWN_ATTRS_XML,\n    INTENT_WITH_NO_MUG_XML,\n    PRINTING_INTENT_XML,\n    CUSTOM_INTENT_XML\n) {\n    var assert = chai.assert,\n        call = util.call,\n        templates =  [\n            {\n                icon: \"fa-solid fa-location-dot\",\n                name: \"Area Mapper\",\n                id: \"com.richard.lu.areamapper\",\n                extra: {ext: \"value\"},\n                response: {\n                    r1: \"x\",\n                    r2: \"y\",\n                    r3: \"z\",\n                    r4: \"\",\n                },\n            },\n            {\n                icon: \"fa fa-barcode\",\n                name: \"Barcode Scanner\",\n                id: \"com.google.zxing.client.android.SCAN\",\n                extra: {},\n                response: {},\n            },\n            {\n                icon: \"icon-vellum-android-intent\",\n                name: \"Breath Counter\",\n                id: \"org.commcare.respiratory.BREATHCOUNT\",\n            },\n            {\n                icon: \"icon-vellum-android-intent\",\n                name: \"Fingerprint Scanner\",\n                id: \"com.simprints.id.REGISTER\",\n                mime: \"text/plain\",\n            },\n        ];\n\n    describe(\"The intent manager plugin\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n                features: {\n                    custom_intents: true,\n                    templated_intents: true,\n                },\n            });\n        });\n\n        it(\"should preserve unknown attributes of intent tag\", function () {\n            util.loadXML(INTENT_WITH_UNKNOWN_ATTRS_XML);\n            util.assertXmlEqual(util.call(\"createXML\"), INTENT_WITH_UNKNOWN_ATTRS_XML);\n        });\n\n        it(\"should preserve intent tags with no mug\", function () {\n            util.loadXML(INTENT_WITH_NO_MUG_XML);\n            util.assertXmlEqual(util.call(\"createXML\"), INTENT_WITH_NO_MUG_XML);\n        });\n\n        it(\"should assign new document template path on upload\", function () {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"PrintIntent\", \"print\"),\n                media = util.getMediaUploader($(\".fd-mm-upload-trigger\")),\n                pathPattern = /jr:\\/\\/file\\/commcare\\/text\\/print-\\w+\\.html/;\n            media.upload(\"temp.html\");\n            var temp = mug.p.docTemplate;\n            assert.match(temp, pathPattern);\n            media.upload(\"file.html\");\n            assert.match(mug.p.docTemplate, pathPattern);\n            assert.notEqual(mug.p.docTemplate, temp, \"new upload should create a new path\");\n        });\n\n        it(\"should error when question ids are not unique across intents that share a template\", function () {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"AndroidIntent\", \"intent\");\n            util.addQuestion(\"Group\", \"group\");\n            var sameMug = util.addQuestion(\"AndroidIntent\", \"intent\");\n            util.addQuestion(\"Group\", \"group\");\n            var differentMug = util.addQuestion(\"AndroidIntent\", \"otherIntent\");\n\n            assert.equal(mug.messages.get(\"nodeID\").length, 1, \"Original intent should error\");\n            assert.equal(sameMug.messages.get(\"nodeID\").length, 1, \"Same template, same ID should error\");\n            assert.equal(differentMug.messages.get(\"nodeID\").length, 0, \"Different ID should be fine\");\n        });\n\n        describe(\"with multiple response pairs with matching keys\", function () {\n            var mug, xml, $xml;\n            before(function () {\n                util.loadXML(\"\");\n                mug = util.addQuestion(\"AndroidIntent\", \"intent\");\n                mug.p.androidIntentResponse = {name: [\"/data/node1\", \"/data/node2\"]};\n                xml = util.call(\"createXML\");\n                $xml = util.parseXML(xml);\n            });\n\n            it(\"should show all pairs in UI\", function () {\n                util.clickQuestion(\"intent\");\n                assert.equal($(\".fd-kv-key[value=name]\").length, 2);\n                assert.deepEqual(\n                    $(\".fd-kv-key[value=name]\").map(function (i, el) {\n                        return $(el).parent().parent().find(\".fd-kv-val\").val();\n                    }).toArray(),\n                    [\"/data/node1\", \"/data/node2\"]\n                );\n            });\n\n            it(\"should write multiple response nodes in XML\", function () {\n                var responses = $xml.find(\"response[key=name]\");\n                assert.equal(responses.length, 2, xml);\n                assert.deepEqual(\n                    responses.map(function (i, node) {\n                        return $(node).attr(\"ref\");\n                    }).toArray(),\n                    [\"/data/node1\", \"/data/node2\"], xml\n                );\n            });\n\n            it(\"should load generated XML\", function () {\n                util.loadXML(xml);\n                assert.deepEqual(\n                    util.getMug(\"intent\").p.androidIntentResponse,\n                    {name: [\"/data/node1\", \"/data/node2\"]}\n                );\n            });\n        });\n\n        describe(\"printing mug\", function() {\n            before(function() {\n                util.loadXML(PRINTING_INTENT_XML);\n            });\n\n            it(\"should parse as a printing question\", function() {\n                assert.strictEqual(util.getMug('/data/print_data').__className, 'PrintIntent');\n            });\n\n            it(\"should write the same as parse\", function() {\n                util.assertXmlEqual(call('createXML'), PRINTING_INTENT_XML);\n            });\n\n            it(\"should correctly parse filename\", function() {\n                assert.strictEqual(util.getMug('/data/print_data').p.docTemplate,\n                                   'jr://file/commcare/doc/data/print_data.doc');\n            });\n        });\n\n        describe(\"template selector\", function() {\n            var vellum, mug;\n            before(function(done) {\n                util.init({\n                    intents: {templates: templates},\n                    features: {\n                        custom_intents: false,\n                    },\n                    core: {onReady: function () {\n                        vellum = this;\n                        mug = util.addQuestion(\"AndroidIntent\", \"intent\");\n                        util.clickQuestion(\"intent\");\n                        done();\n                    }}\n                });\n            });\n\n            it(\"should select the first template by default\", function () {\n                assert.equal($(\"[name=property-androidIntentAppId]\").val(), \"com.richard.lu.areamapper\");\n            });\n\n            it(\"should not show validation error on question add\", function() {\n                assert.strictEqual(mug.spec.androidIntentAppId.validationFunc(mug), 'pass');\n            });\n\n            it(\"should write the mime/type if supplied\", function() {\n                $(\"[name=property-androidIntentAppId]\").val(\"com.simprints.id.REGISTER\").change();\n                var xml = util.call(\"createXML\"),\n                    $xml = util.parseXML(xml),\n                    type = $xml.find('h\\\\:head, head').children(\"odkx\\\\:intent, intent\").attr('type');\n                assert.strictEqual(type, 'text/plain');\n            });\n\n            _.each(templates, function (temp) {\n                it(\"should have \" + temp.name + \" template\", function () {\n                    $(\"[name=property-androidIntentAppId]\").val(temp.id).change();\n                    assert.strictEqual(mug.p.androidIntentAppId, temp.id);\n                });\n            });\n        });\n\n        describe(\"custom intents\", function() {\n            var vellum, mug, customIndex;\n            before(function(done) {\n                util.init({\n                    intents: {templates: templates},\n                    features: {\n                        templated_intents: true,\n                        custom_intents: true,\n                    },\n                    core: {\n                        onReady: function () {\n                        vellum = this;\n                        mug = util.addQuestion(\"AndroidIntent\", \"intent\");\n                        util.clickQuestion(\"intent\");\n                        customIndex = templates.length;\n                        done();\n                    }}\n                });\n            });\n\n            it(\"should always have one custom option\", function() {\n                var customOption = $('[name=property-androidIntentAppId] option:contains(\"Custom\")');\n                assert.lengthOf(customOption, 1, \"incorrect number of custom options\");\n            });\n\n            it(\"should change text to not readonly when custom is selected\", function() {\n                $('[name=property-androidIntentAppId]').prop('selectedIndex', 0).change();\n                assert($(\"[name=property-androidIntentAppId-text]\").attr('readonly'));\n                $('[name=property-androidIntentAppId]').prop('selectedIndex', customIndex).change();\n                assert(!$(\"[name=property-androidIntentAppId-text]\").attr('readonly'));\n            });\n\n            it(\"should change text to readonly when custom is not selected\", function() {\n                $('[name=property-androidIntentAppId]').prop('selectedIndex', customIndex).change();\n                assert(!$(\"[name=property-androidIntentAppId-text]\").attr('readonly'));\n                $('[name=property-androidIntentAppId]').prop('selectedIndex', 0).change();\n                assert($(\"[name=property-androidIntentAppId-text]\").attr('readonly'));\n            });\n\n            it(\"should update the custom option when text is changed\", function() {\n                $('[name=property-androidIntentAppId]').prop('selectedIndex', customIndex).change();\n                $('[name=property-androidIntentAppId-text]').val(\"fake.intent\").change();\n                var customOption = $('[name=property-androidIntentAppId]')\n                    .find('option')\n                    .filter(function () { return $(this).text() === \"Custom\"; }).val();\n                assert.strictEqual(\"fake.intent\", customOption);\n            });\n\n            _.each(templates, function (temp) {\n                it(\"should change text box for \" + temp.name + \" template\", function () {\n                    $(\"[name=property-androidIntentAppId]\").val(temp.id).change();\n                    assert.strictEqual(mug.p.androidIntentAppId, temp.id);\n                    assert.strictEqual($(\"[name=property-androidIntentAppId-text]\").val(),\n                                       temp.id);\n                    assert($(\"[name=property-androidIntentAppId-text]\").attr('readonly'));\n                });\n            });\n\n            describe(\"on load\", function() {\n                before(function() {\n                    util.loadXML(CUSTOM_INTENT_XML);\n                });\n\n                it(\"should display the correct intent\", function() {\n                    util.clickQuestion(\"not_breath_count\");\n                    assert.strictEqual($('[name=property-androidIntentAppId-text]').val(),\n                                       \"android.intent.action.VIEW\");\n                });\n            });\n        });\n\n        describe(\"no intents\", function() {\n            before(function(done) {\n                util.init({\n                    intents: {templates: templates},\n                    features: {\n                        custom_intents: false,\n                        templated_intents: false,\n                    },\n                    core: { onReady: function () { done(); } }\n                });\n            });\n\n            it(\"shows error on form load\", function() {\n                util.loadXML(CUSTOM_INTENT_XML);\n                var mug = util.getMug('not_breath_count');\n                assert.notStrictEqual(mug.spec.androidIntentAppId.validationFunc(mug), 'pass');\n            });\n        });\n    });\n});\n","define([\n    'tests/options',\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/datasources',\n    'vellum/itemset',\n    'vellum/form',\n    'static/itemset/test1.xml',\n    'static/itemset/test1-with-constraint.xml',\n    'static/itemset/test1-with-appearance.xml',\n    'static/itemset/inner-filters.xml',\n    'static/itemset/itemset-sort.xml',\n    'static/itemset/dropdown-fixture.xml',\n    'static/itemset/data-itemset.xml',\n    'static/itemset/filter-with-case-property.xml',\n    'static/itemset/itemset-with-question-ref.xml',\n], function (\n    options,\n    util,\n    chai,\n    $,\n    _,\n    datasources,\n    itemset,\n    form,\n    TEST_XML_1,\n    TEST_XML_1_WITH_CONSTRAINT,\n    TEST_XML_1_WITH_APPEARANCE,\n    INNER_FILTERS_XML,\n    ITEMSET_SORT_XML,\n    DROPDOWN_FIXTURE_XML,\n    DATA_ITEMSET_XML,\n    FILTER_WITH_CASE_PROPERTY,\n    ITEMSET_WITH_QUESTION_REF_XML\n) {\n    var assert = chai.assert,\n        call = util.call,\n        clickQuestion = util.clickQuestion,\n        plugins = _.union(util.options.options.plugins || [], [\"itemset\"]);\n\n    describe(\"The Dynamic Itemset plugin\", function () {\n        function beforeFn(done) {\n            util.init({\n                plugins: plugins,\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () {\n                    vellum = this;\n                    done();\n                }},\n                features: {\n                    lookup_tables: true,\n                    advanced_itemsets: false,\n                },\n            });\n        }\n        var vellum;\n        before(beforeFn);\n        beforeEach(function () { vellum.datasources.reset(); });\n\n        it(\"adds a new instance to the form\", function () {\n            util.loadXML(TEST_XML_1);\n            var itemset = util.getMug(\"question1/itemset\");\n            itemset.p.itemsetData = {\n                instance: {id: \"somefixture\", src: \"jr://somefixture\"},\n                nodeset: \"instance('somefixture')/some/items\",\n                labelRef: \"label\",\n                valueRef: \"value\",\n            };\n\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml);\n            assert($xml.find(\"instance[id=somefixture]\").length,\n                   \"somefixture instance not found:\\n\" + xml);\n        });\n\n        it(\"changes instance when nodeset changes\", function () {\n            var form = util.loadXML(TEST_XML_1),\n                itemset = util.getMug(\"question1/itemset\");\n            form.updateKnownInstances({\"foo\": \"jr://foo\"});\n            itemset.p.itemsetData = {\n                nodeset: \"instance('foo')/some/items\",\n                labelRef: \"label\",\n                valueRef: \"value\",\n            };\n\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml);\n            assert($xml.find(\"instance[id=foo]\").length,\n                   \"foo instance not found:\\n\" + xml);\n            assert.equal($xml.find(\"instance[id=casedb]\").length, 0,\n                   \"somefixture instance not found:\\n\" + xml);\n        });\n\n        it(\"renames instance on add itemset with matching instance\", function () {\n            util.loadXML(TEST_XML_1);\n            util.addQuestion(\"SelectDynamic\", \"select2\");\n            var itemset = util.getMug(\"select2/itemset\");\n            itemset.p.itemsetData = {\n                instance: {id: \"cases\", src: \"jr://instance/casedb\"},\n                nodeset: \"instance('cases')/cases/case[@case_id > 2]\",\n                labelRef: \"label\",\n                valueRef: \"value\",\n            };\n\n            var data = itemset.p.itemsetData;\n            assert.equal(data.instance.id, \"casedb\");\n            assert.equal(data.instance.src, \"jr://instance/casedb\");\n            assert.equal(data.nodeset, \"instance('casedb')/cases/case[@case_id > 2]\");\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml);\n            assert($xml.find(\"instance[id=casedb]\").length,\n                   \"casedb instance not found:\\n\" + xml);\n            assert($xml.find(\"instance[id=cases]\").length === 0,\n                   \"cases instance should have been renamed/merged:\\n\" + xml);\n        });\n\n        it(\"should select first lookup table for new itemset\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"SelectDynamic\", \"select\");\n            // HACK must click on the itemset node to start async load, which\n            // eventually sets the default value if everything goes well.\n            util.clickQuestion(\"select/itemset\");\n            var mug = util.getMug('select/itemset');\n            mug.validate();\n            assert.equal(util.getMessages(mug), \"\");\n        });\n\n        it(\"should populate itemset nodeset and refs on add single select\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"SelectDynamic\", \"select\");\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml),\n                itemset = $xml.find(\"itemset\");\n            assert.equal(itemset.attr(\"nodeset\"),\n                \"instance('some-fixture')/some-fixture_list/some-fixture\");\n            assert(itemset.find(\"label\").attr(\"ref\"), \"name\");\n            assert(itemset.find(\"value\").attr(\"ref\"), \"@id\");\n        });\n\n        it(\"should add sort element when sort field has a value\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"SelectDynamic\", \"select\");\n            clickQuestion(\"select/itemset\");\n            var mug = util.getMug(\"select/itemset\");\n            $(\"[name=property-sortRef]\").val(\"@id\").change();\n            assert.equal(mug.p.sortRef, \"@id\");\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml),\n                itemset = $xml.find(\"itemset\");\n            assert.equal(itemset.find(\"sort\").attr(\"ref\"), \"@id\");\n        });\n\n        it(\"should load dynamic select with sort element\", function () {\n            util.loadXML(ITEMSET_SORT_XML);\n            var mug = util.getMug(\"select/itemset\");\n            assert.equal(mug.p.sortRef, \"inner-attribute\");\n            clickQuestion(\"select/itemset\");\n            assert.equal($(\"[name=property-sortRef]\").val(), \"inner-attribute\");\n            util.assertXmlEqual(call('createXML'), ITEMSET_SORT_XML, {normalize_xmlns: true});\n        });\n\n        it(\"should load dynamic select without errors\", function () {\n            util.loadXML(TEST_XML_1);\n            var mug = util.getMug('question1/itemset');\n            mug.validate();\n            assert.equal(util.getMessages(mug), \"\");\n        });\n\n        it(\"should not trigger change on click itemset\", function () {\n            util.loadXML(TEST_XML_1);\n            util.saveButtonEnabled(false);\n            clickQuestion('question1/itemset');\n            assert(!util.saveButtonEnabled(), \"save button should not be enabled\");\n        });\n\n        it(\"should save the hashtag format correctly\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", 'state');\n            util.addQuestion(\"SelectDynamic\", 'district');\n            util.clickQuestion('district/itemset');\n            var itemset = util.getMug(\"district/itemset\");\n            itemset.p.itemsetData = {\n                instance: itemset.p.itemsetData.instance,\n                nodeset:  itemset.p.itemsetData.nodeset + '[name = /data/state]',\n                labelRef: \"name\",\n                valueRef: \"@id\",\n            };\n\n            util.assertXmlEqual(call('createXML'), ITEMSET_WITH_QUESTION_REF_XML, {normalize_xmlns: true});\n        });\n\n        it(\"should include filter usage in logic manager\", function () {\n            var form = util.loadXML(ITEMSET_WITH_QUESTION_REF_XML);\n            assert.deepEqual(form.findUsages(),\n                {\n                    \"#form/state\": {\n                        \"#form/district\": \"Filter\"\n                    }\n                }\n            );\n        });\n\n        it(\"should update sortRef on paste dynamic select with sorted itemset\", function () {\n            var data = [\n                [\"id\", \"type\", \"labelItext:en-default\", \"instances\", \"itemsetData\"],\n                [\"/select\", \"SelectDynamic\", \"select\",\n                 '{\"foo\":{\"src\":\"jr://foo\"}}',\n                 '[{\"instance\":{\"id\":\"foo\",\"src\":\"jr://foo\"},' +\n                   '\"nodeset\":\"instance(\\'foo\\')/foo/items\",\"labelRef\":\"@name\",\"valueRef\":\"@id\",\"sortRef\":\"name\"}]'],\n            ];\n            util.loadXML(\"\");\n            util.paste(data);\n            assert.equal(util.getMug(\"select/itemset\").p.sortRef, \"name\");\n        });\n\n        describe(\"without access to lookup tables\", function() {\n            before(function (done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {onReady: function () { done(); }},\n                    features: {\n                        lookup_tables: false,\n                        advanced_itemsets: false,\n                        rich_text: false\n                    },\n                });\n            });\n\n            it(\"should display an error on an itemset\", function() {\n                util.loadXML(TEST_XML_1);\n                var mug = util.getMug('question1/itemset');\n                assert.notStrictEqual(mug.spec.itemsetData.validationFunc(mug), 'pass');\n            });\n        });\n\n        describe(\"parsing and serializing\", function () {\n            before(beforeFn);\n            it(\"preserves XML with itemsets in <select>s\", function () {\n                assert(TEST_XML_1.indexOf('select1') !== -1);\n                util.loadXML(TEST_XML_1);\n                util.assertXmlEqual(call('createXML'), TEST_XML_1);\n            });\n\n            it(\"preserves XML with itemsets in <select1>s\", function () {\n                var newXml = TEST_XML_1.replace(/select1/g, 'select');\n                util.loadXML(newXml);\n                util.assertXmlEqual(call('createXML'), newXml);\n            });\n\n            it(\"preserves XML with a constraint\", function() {\n                util.loadXML(TEST_XML_1_WITH_CONSTRAINT);\n                util.assertXmlEqual(call('createXML'), TEST_XML_1_WITH_CONSTRAINT);\n            });\n\n            it(\"preserves XML with an appearance\", function() {\n                util.loadXML(TEST_XML_1_WITH_APPEARANCE);\n                util.assertXmlEqual(call('createXML'), TEST_XML_1_WITH_APPEARANCE);\n            });\n        });\n\n        describe(\"UI\", function () {\n            it(\"preserves inner filters if you never change the data source\", function () {\n                util.loadXML(INNER_FILTERS_XML);\n                clickQuestion(\"question2/itemset\");\n                $(\"[name=property-labelRef]\").val(\"dummy\").change();\n\n                util.assertXmlEqual(\n                    INNER_FILTERS_XML.replace('case_name', 'dummy'),\n                    call('createXML')\n                );\n            });\n\n            it(\"correctly parses filter with reference to case property\", function () {\n                util.loadXML(FILTER_WITH_CASE_PROPERTY);\n                var mug = util.getMug(\"lookup/itemset\");\n                assert.equal(mug.p.filter, \"name = #case/dob\");\n            });\n\n            it(\"uses a dropdown when the nodeset is known\", function() {\n                util.loadXML(DROPDOWN_FIXTURE_XML);\n                clickQuestion(\"question2/itemset\");\n\n                assert($('[name=property-itemsetData]').is('select'));\n            });\n\n            describe(\"with a /data/ fixture\", function() {\n                it(\"doesn't warn on no src\", function() {\n                    util.loadXML(DATA_ITEMSET_XML);\n                    var mug = util.getMug('/data/itemset/itemset');\n                    assert.strictEqual(mug.spec.itemsetData.validationFunc(mug), 'pass');\n                });\n            });\n\n            describe(\"with a custom fixture\", function() {\n                it(\"should not warn on unrecognized values and labels\", function() {\n                    util.loadXML(DROPDOWN_FIXTURE_XML);\n                    var mug = util.getMug('/data/question2/itemset');\n                    assert.strictEqual(mug.spec.itemsetData.validationFunc(mug), 'pass');\n                    mug.p.itemsetData.instance.src = \"blah\";\n                    assert.strictEqual(mug.spec.itemsetData.validationFunc(mug), 'pass');\n                });\n            });\n\n            describe(\"with recognized fixture\", function() {\n                it(\"should warn on unrecognized values and labels\", function() {\n                    util.loadXML(DROPDOWN_FIXTURE_XML);\n                    var mug = util.getMug('/data/question2/itemset');\n                    assert.strictEqual(mug.spec.itemsetData.validationFunc(mug), 'pass');\n                    clickQuestion(\"question2/itemset\");\n                    $('[name=property-valueRef]').val('blah').change();\n                    assert.notStrictEqual(mug.spec.valueRef.validationFunc(mug), 'pass');\n                });\n\n                it(\"should not warn on values with a filter attached\", function() {\n                    util.loadXML(DROPDOWN_FIXTURE_XML);\n                    var mug = util.getMug('/data/question2/itemset');\n                    assert.strictEqual(mug.spec.itemsetData.validationFunc(mug), 'pass');\n                    clickQuestion(\"question2/itemset\");\n                    var value = $('[name=property-valueRef]');\n                    value.val(value.val() + \"[filter]\").change();\n                    assert.strictEqual(mug.spec.valueRef.validationFunc(mug), 'pass');\n                });\n\n                it(\"should not warn on labels with a filter attached\", function() {\n                    util.loadXML(DROPDOWN_FIXTURE_XML);\n                    var mug = util.getMug('/data/question2/itemset');\n                    assert.strictEqual(mug.spec.itemsetData.validationFunc(mug), 'pass');\n                    clickQuestion(\"question2/itemset\");\n                    var label = $('[name=property-labelRef]');\n                    label.val(label.val() + \"[filter]\").change();\n                    assert.strictEqual(mug.spec.labelRef.validationFunc(mug), 'pass');\n                });\n\n                it(\"should not warn on inner filters\", function() {\n                    util.loadXML(DROPDOWN_FIXTURE_XML);\n                    var mug = util.getMug('/data/question2/itemset');\n                    assert.strictEqual(mug.spec.itemsetData.validationFunc(mug), 'pass');\n                    clickQuestion(\"question2/itemset\");\n                    $('[name=property-labelRef]').val(\"inner-attribute[filter1]/extra-inner-attribute[filter2]\").change();\n                    assert.strictEqual(mug.spec.labelRef.validationFunc(mug), 'pass');\n                });\n            });\n        });\n    });\n\n    describe(\"The Dynamic Itemset plugin with no fixtures\", function () {\n        var DATA_SOURCES = [{id: \"ignored\", uri: \"jr://not-a-fixture\"}],\n            vellum;\n        before(function (done) {\n            util.init({\n                plugins: plugins,\n                javaRosa: {langs: ['en']},\n                core: {\n                    dataSourcesEndpoint: function (callback) { callback(DATA_SOURCES); },\n                    onReady: function () {\n                        vellum = this;\n                        done();\n                    },\n                },\n                features: {lookup_tables: true},\n            });\n        });\n        beforeEach(function () { vellum.datasources.reset(); });\n\n        it(\"should be able to configure Lookup Table Data\", function() {\n            util.addQuestion(\"SelectDynamic\", \"select\");\n            util.clickQuestion(\"select/itemset\");  // should not throw exception\n            assert.equal($(\"[name=property-itemsetData]\").length, 1);\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'vellum/javaRosa/itext',\n    'vellum/javaRosa/util',\n    'vellum/util',\n    'static/javaRosa/bare-output.xml',\n    'static/javaRosa/outputref-group-rename.xml',\n    'static/javaRosa/text-question.xml',\n    'static/javaRosa/multi-lang-trans.xml',\n    'static/javaRosa/multi-line-trans.xml',\n    'static/javaRosa/output-refs.xml',\n    'static/javaRosa/outputref-with-inequality.xml',\n    'static/javaRosa/group-with-constraint.xml',\n    'static/javaRosa/text-with-constraint.xml',\n    'static/javaRosa/itext-item-rename.xml',\n    'static/javaRosa/itext-item-rename-group-move.xml',\n    'static/javaRosa/itext-item-non-auto-id.xml',\n    'static/javaRosa/select1-help.xml',\n    'static/javaRosa/single-lang-select.xml',\n    'static/javaRosa/single-lang-second-select-with-help.xml',\n    'static/javaRosa/no-label-text-one-lang.xml',\n    'static/javaRosa/test-xml-1.xml',\n    'static/javaRosa/test-xml-2.xml',\n    'static/javaRosa/test-xml-2-with-bind-constraint.xml',\n    'static/javaRosa/test-xml-2-with-only-bind-constraint.xml',\n    'static/javaRosa/test-xml-3.xml',\n    'static/javaRosa/test-xml-4.xml',\n    'static/javaRosa/non-default-lang-first.xml',\n    'static/javaRosa/invalid-output-ref.xml'\n], function (\n    chai,\n    $,\n    _,\n    util,\n    jrItext,\n    jr,\n    vellumUtil,\n    BARE_OUTPUT,\n    OUTPUTREF_GROUP_RENAME_XML,\n    TEXT_QUESTION_XML,\n    MULTI_LANG_TRANS_XML,\n    MULTI_LINE_TRANS_XML,\n    OUTPUT_REFS_XML,\n    OUTPUTREF_WITH_INEQUALITY_XML,\n    GROUP_WITH_CONSTRAINT_XML,\n    TEXT_WITH_CONSTRAINT_XML,\n    ITEXT_ITEM_RENAME_XML,\n    ITEXT_ITEM_RENAME_GROUP_MOVE_XML,\n    ITEXT_ITEM_NON_AUTO_ID_XML,\n    SELECT1_HELP_XML,\n    SINGLE_LANG_SELECT_XML,\n    SINGLE_LANG_SECOND_SELECT_WITH_HELP_XML,\n    NO_LABEL_TEXT_ONE_LANG_XML,\n    TEST_XML_1,\n    TEST_XML_2,\n    TEST_XML_2_WITH_BIND_CONSTRAINT,\n    TEST_XML_2_WITH_ONLY_BIND_CONSTRAINT,\n    TEST_XML_3,\n    TEST_XML_4,\n    NON_DEFAULT_LANG_FIRST_XML,\n    INVALID_OUTPUT_REF_XML\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"The javaRosa plugin with multiple languages\", function () {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en', 'hin']},\n                core: {onReady: function () { done(); }},\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"should assign new media path on media upload\", function () {\n            util.loadXML(\"\");\n            var itext = util.addQuestion(\"Text\", \"text\").p.labelItext,\n                pattern = /jr:\\/\\/file\\/commcare\\/image\\/data\\/text-\\w+\\.gif/;\n            $(\".itext-block-label-add-form-image\").click();\n            var media = util.getMediaUploader($(\".fd-mm-upload-trigger:first\"));\n            media.upload(\"old.gif\");\n            var old = itext.get(\"image\");\n            assert.match(old, pattern);\n            media.upload(\"new.gif\");\n            assert.match(itext.get(\"image\"), pattern);\n            assert.notEqual(itext.get(\"image\"), old, \"new upload should create a new path\");\n        });\n\n        it(\"should remove MM widget on click delete\", function () {\n            // this test is overly dependent on UI elements\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text\");\n            $(\".itext-block-label-add-form-image\").click();\n            var widget = $(\"div.widget[data-hqmediapath]:visible\"),\n                deleteButton = $(\".delete-itext-block-label-group-image\");\n            assert.equal(widget.length, 2, \"widget not found\");\n            assert(deleteButton.length, \"delete button not found\");\n            deleteButton.click();\n            assert.equal($(\"div.widget[data-hqmediapath]\").length, 0,\n                \"widget not deleted\");\n        });\n\n        it(\"should not error on choice on add new language\", function () {\n            util.loadXML(SINGLE_LANG_SELECT_XML);\n            var mug = util.getMug(\"select/choice\");\n            assert.equal(util.getMessages(mug), \"\");\n        });\n\n        describe(\"and non default language is first in options\", function () {\n            before(function (done) {\n                util.init({\n                    features: {rich_text: false},\n                    javaRosa: {langs: ['hin', 'en']},\n                    core: {onReady: function () { done(); }}\n                });\n            });\n\n            it(\"should change default to first language on save\", function() {\n                util.loadXML(NON_DEFAULT_LANG_FIRST_XML);\n                var xml = util.parseXML(call('createXML'));\n                assert(xml.find(\"translation[lang=en]\").attr(\"default\") === undefined,\n                    \"English should not be the default language\");\n                assert(xml.find(\"translation[lang=hin]\").attr(\"default\") === \"\",\n                    \"Hindi should be the default language\");\n            });\n        });\n\n        describe(\"with rich text enabled\", function () {\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en', 'hin']},\n                    core: {onReady: function () { done(); }},\n                });\n            });\n\n            it(\"should update output refs when question ids change\", function (done) {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", \"question1\");\n                util.addQuestion(\"Text\", \"question2\");\n                var widget = util.getWidget('itext-en-label');\n                widget.input.promise.then(function () {\n                    var itext = '<output value=\"/data/question1\" /> a ' +\n                    '<output value=\"/data/question1\"/> b ' +\n                    '<output value=\"/data/question1\"></output> c ' +\n                    '<output value=\"/data/question1\" ></output> d ' +\n                    '<output value=\"if(/data/question1 = \\'\\', \\'\\', format-date(date(/data/question1), \\'%a%b%c\\'))\" />';\n                    widget.setItextValue(itext);\n                    widget.setValue(itext);\n                    var widget2 = util.getWidget('itext-hin-label');\n                    widget2.input.promise.then(function () {\n                        widget2.setValue('<output value=\"/data/question1\"></output>');\n                        util.clickQuestion(\"question1\");\n                        $(\"[name=property-nodeID]\").val('first_question').change();\n                        util.assertXmlEqual(\n                            call('createXML'),\n                            TEST_XML_4,\n                            {normalize_xmlns: true}\n                        );\n                        done();\n                    });\n                });\n            });\n\n            it(\"should escape HTML before setting Itext value\", function () {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", \"question1\");\n                var widget = util.getWidget('itext-en-label');\n                var itext = '<img src=\"x\" onerror=\"alert(\\'XSSinbrokenimg\\')\"/>';\n                widget.setItextValue(itext);\n                var itextItem = widget.getItextItem();\n                var defaultLang = util.call(\"getData\").javaRosa.Itext.defaultLanguage;\n                var expected = '&lt;img src=\"x\" onerror=\"alert(\\'XSSinbrokenimg\\')\"&gt;';\n                assert.strictEqual(itextItem.getForm(widget.form).getValue(defaultLang), expected);\n            });\n\n            describe(\"should preserve output tags when setting Itext value\", function () {\n                var items = [\n                    ['<output />', '<output value=\"#form/question1\" />',\n                    '<output value=\"#form/question1\" />'],\n                    ['<output></output>', '<output value=\"#form/question1\" ></output>',\n                    '<output value=\"#form/question1\" />'],\n                    ['<output /><img /><output></output>',\n                    '<output value=\"#form/question1\" /><img src=\"x\" onerror=\"alert(\\'XSSinbrokenimg\\')\"/>' +\n                    '<output value=\"#form/question1\" ></output>',\n                    '<output value=\"#form/question1\" />&lt;img src=\"x\" onerror=\"alert(\\'XSSinbrokenimg\\')\"&gt;' +\n                    '<output value=\"#form/question1\" />']\n                ];\n\n                _.each(items, function (item) {\n                    it(\"for: \" + item[0], function () {\n                        util.loadXML(\"\");\n                        util.addQuestion(\"Text\", \"question1\");\n                        var widget = util.getWidget('itext-en-label');\n                        var itext = item[1];\n                        widget.setItextValue(itext);\n                        var itextItem = widget.getItextItem();\n                        var defaultLang = util.call(\"getData\").javaRosa.Itext.defaultLanguage;\n                        assert.strictEqual(itextItem.getForm(widget.form).getValue(defaultLang), item[2]);\n                    });\n                });\n            });\n\n            it(\"should only update exact output ref matches when question ids change\", function (done) {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", \"question1\");\n                util.addQuestion(\"Text\", \"question2\");\n                var widget = util.getWidget('itext-en-label');\n                widget.input.promise.then(function () {\n                    var itext = '<output value=\"/data/question1\" /> ' +\n                        '<output value=\"/data/question11\" /> ' +\n                        '<output value=\"/data/question1/b\" /> ' +\n                        '<output value=\"/data/question1b\" /> ';\n                    widget.setItextValue(itext);\n                    widget.setValue(itext);\n                    var widget2 = util.getWidget('itext-hin-label');\n                    widget2.input.promise.then(function () {\n                        widget2.setValue('question2');\n                        util.clickQuestion(\"question1\");\n                        $(\"[name=property-nodeID]\").val('first_question').change();\n                        util.assertXmlEqual(\n                            call('createXML'),\n                            OUTPUT_REFS_XML,\n                            {normalize_xmlns: true}\n                        );\n                        done();\n                    });\n                });\n            });\n\n            it(\"should rename itext item ID after move\", function () {\n                util.loadXML(\"\");\n                util.addQuestion(\"Select\", \"ns\");\n                util.addQuestion(\"Choice\", \"choice1\");\n                util.addQuestion(\"Choice\", \"choice2\");\n                util.addQuestion(\"Select\", \"ew\");\n                util.addQuestion(\"Choice\", \"choice1\");\n                util.addQuestion(\"Choice\", \"choice2\");\n                var north = util.getMug(\"ns/choice1\"),\n                    south = util.getMug(\"ew/choice1\");\n                north.p.nodeID = \"north\";\n                south.p.nodeID = \"south\";\n                north.form.moveMug(south, \"after\", north);\n                util.assertXmlEqual(util.call(\"createXML\"), ITEXT_ITEM_RENAME_XML,\n                                    {normalize_xmlns: true});\n            });\n\n            it(\"should rename group's child itext item IDs after move group\", function () {\n                util.loadXML(\"\");\n                var green = util.addQuestion(\"Group\", \"green\"),\n                    blue = util.addQuestion(\"Group\", \"blue\");\n                util.addQuestion(\"Text\", \"text\");\n                blue.form.moveMug(blue, \"before\", green);\n                util.assertXmlEqual(util.call(\"createXML\"),\n                                    ITEXT_ITEM_RENAME_GROUP_MOVE_XML,\n                                    {normalize_xmlns: true});\n            });\n\n            it(\"should not erase invalid outputs\", function (done) {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", \"question1\");\n                var widget = util.getWidget('itext-en-label');\n                widget.input.promise.then(function () {\n                    var itext = '<output value=\"concat(1, 2\" />';\n                    widget.setItextValue(itext);\n                    widget.setValue(itext);\n                    util.clickQuestion('question1');\n                    widget = util.getWidget('itext-en-label');\n                    widget.input.promise.then(function () {\n                        assert.strictEqual(widget.getValue(), itext);\n                        util.assertXmlEqual(call('createXML'),\n                                            INVALID_OUTPUT_REF_XML,\n                                            {normalize_xmlns: true});\n                        done();\n                    });\n                });\n            });\n\n            it(\"should not error on save question with markdown and missing language\", function () {\n                util.loadXML(SINGLE_LANG_SECOND_SELECT_WITH_HELP_XML);\n                var xml = util.parseXML(call('createXML')),\n                    value = xml.find(\"translation[lang=hin]>text#select-help>value[form=markdown]\");\n                assert.equal(value.html(), \"**help**\");\n            });\n        });\n\n        describe(\"and one has is right to left\", function () {\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en', 'heb']},\n                    core: {\n                        onReady: function () {\n                            util.addQuestion(\"Text\");\n                            done();\n                        }},\n                    features: {rich_text: false},\n                });\n            });\n\n            it(\"should have rtl attribute\", function () {\n                assert.isUndefined($('[name=itext-en-label]').attr('dir'));\n                assert.strictEqual($('[name=itext-heb-label]').attr('dir'), 'rtl');\n            });\n\n            it(\"should have rtl attribute on markdown preview\", function () {\n                var $enInput = $('[name=itext-en-label]'),\n                    $hebInput = $('[name=itext-heb-label]'), \n                    $enMarkdown = $enInput.closest('.form-group').parent().find('.markdown-output'),\n                    $hebMarkdown = $hebInput.closest('.form-group').parent().find('.markdown-output');\n                $enInput.val('* markdown');\n                assert.isUndefined($enMarkdown.attr('dir'));\n                assert.strictEqual($hebMarkdown.attr('dir'), 'rtl');\n            });\n        });\n\n        it(\"should not show itext errors when there is text in any language\", function (done) {\n            util.loadXML(TEST_XML_1);\n            $(\"textarea[name=itext-en-constraintMsg]\").val(\"\").change();\n            util.saveAndReload(function () {\n                // there should be no errors on load\n                // todo: this should inspect the model, not UI\n                var errors = $(\".alert-block\");\n                assert.equal(errors.length, 0, errors.text());\n                done();\n            });\n        });\n\n        it(\"should show warning on load for with unknown language\", function () {\n            util.loadXML(TEST_XML_3, null, /You have languages in your form/);\n            // todo: this should inspect the model, not UI\n            var errors = $(\".alert-block\"),\n                text = errors.text();\n            assert.equal(errors.length, 1, text);\n            assert(text.indexOf(\"You have languages in your form that are not specified\") > -1, text);\n            assert(text.indexOf(\"page: es\") > -1, text);\n        });\n\n        it(\"should preserve itext values on load + save\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"question1\");\n            _.each(['image', 'audio', 'video', 'video-inline'], function (i) {\n                $(\".btn.itext-block-label-add-form-\" + i).click();\n                $(\".btn.itext-block-constraintMsg-add-form-\" + i).click();\n                $(\".btn.itext-block-help-add-form-\" + i).click();\n            });\n            $(\".btn:contains(long)\").click();\n            $(\".btn:contains(short)\").click();\n            $(\".btn:contains(custom)\").click();\n            $(\".fd-modal-generic-container\").find(\"input\").val(\"custom\");\n            $(\".fd-modal-generic-container\").find(\".btn:contains(Add)\").click();\n            $(\"[name='itext-en-label']\").val('question1 en label').change();\n            $(\"[name='itext-hin-label']\").val('question1 hin label').change();\n            $(\"[name='itext-en-constraintMsg']\").val('question1 en validation').change();\n            $(\"[name='itext-hin-constraintMsg']\").val('question1 hin validation').change();\n            $(\"[name='itext-en-hint']\").val('question1 en hint').change();\n            $(\"[name='itext-hin-hint']\").val('question1 hin hint').change();\n            $(\"[name='itext-en-help']\").val('question1 en help').change();\n            $(\"[name='itext-hin-help']\").val('question1 hin help').change();\n            $(\"[name='itext-en-label-long']\").val(\"question1 en long\").change();\n            $(\"[name='itext-hin-label-long']\").val(\"question1 hin long\").change();\n            $(\"[name='itext-en-label-short']\").val(\"question1 en short\").change();\n            $(\"[name='itext-hin-label-short']\").val(\"question1 hin short\").change();\n            $(\"[name='itext-en-label-custom']\").val(\"question1 en custom\").change();\n            $(\"[name='itext-hin-label-custom']\").val(\"question1 hin custom\").change();\n\n            util.assertXmlEqual(\n                call('createXML'),\n                TEST_XML_2,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should prefer alert over constraintMsg\", function() {\n            util.loadXML(TEST_XML_2_WITH_BIND_CONSTRAINT);\n            util.assertXmlEqual(\n                call('createXML'),\n                TEST_XML_2,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should convert constraintMsg to alert\", function() {\n            util.loadXML(TEST_XML_2_WITH_ONLY_BIND_CONSTRAINT);\n            util.assertXmlEqual(\n                call('createXML'),\n                TEST_XML_2,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should correctly set alert's auto id\", function() {\n            util.loadXML(TEST_XML_2_WITH_BIND_CONSTRAINT);\n            var mug = util.getMug('question1');\n            assert(mug.p.constraintMsgItext.autoId);\n        });\n\n        it(\"itext widget should change as default language value changes when equal\", function () {\n            util.loadXML(TEST_XML_1);\n            util.addQuestion(\"Text\", \"temp\");\n            util.clickQuestion(\"question1\");\n            var enLabel = $(\"[name='itext-en-label']\"),\n                hinLabel = $(\"[name='itext-hin-label']\");\n            enLabel.val(\"English\").change();\n            assert.equal(enLabel.val(), \"English\");\n            assert.equal(hinLabel.val(), \"English\");\n\n            util.clickQuestion(\"temp\");\n            util.clickQuestion(\"question1\");\n            enLabel = $(\"[name='itext-en-label']\");\n            hinLabel = $(\"[name='itext-hin-label']\");\n            assert.equal(enLabel.val(), \"English\");\n            assert.equal(hinLabel.val(), \"English\");\n        });\n\n        it(\"itext widget should be blank when empty\", function () {\n            util.loadXML(TEST_XML_1);\n            util.addQuestion(\"Text\", \"temp\");\n            util.clickQuestion(\"question1\");\n            var enLabel = $(\"[name='itext-en-label']\"),\n                hinLabel = $(\"[name='itext-hin-label']\");\n            enLabel.val(\"\").change();\n            assert.equal(enLabel.val(), \"\");\n            assert.equal(hinLabel.val(), \"\");\n\n            util.clickQuestion(\"temp\");\n            util.clickQuestion(\"question1\");\n            enLabel = $(\"[name='itext-en-label']\");\n            hinLabel = $(\"[name='itext-hin-label']\");\n            assert.equal(enLabel.val(), \"\");\n            assert.equal(hinLabel.val(), \"\");\n        });\n\n        it(\"non-labelItext widget should allow non default language to be blank\", function () {\n            util.loadXML(TEXT_WITH_CONSTRAINT_XML);\n            util.clickQuestion(\"text\");\n            var enItext = $(\"[name='itext-en-constraintMsg']\"),\n                hinItext = $(\"[name='itext-hin-constraintMsg']\");\n            hinItext.val(\"\").change();\n            assert.equal(enItext.val(), \"English\");\n            assert.equal(hinItext.val(), \"\");\n\n            enItext.val(\"\").change();\n            assert.equal(enItext.val(), \"\");\n            assert.equal(hinItext.val(), \"\");\n        });\n\n        it(\"should display correct language for question that was collapsed when language changed\", function () {\n            util.loadXML(\"\");\n            var group = util.addQuestion(\"Group\", \"group\");\n            util.addQuestion(\"Text\", \"question2\");\n            util.clickQuestion(\"group/question2\");\n            $(\"[name='itext-en-label']\").val('english').change();\n            $(\"[name='itext-hin-label']\").val('hindi').change();\n            util.collapseGroup(group);\n            assert.equal($(\".fd-question-tree .jstree-anchor\").length, 1);\n            $(\".fd-question-tree-display\").val('hin').change();\n            util.expandGroup(group);\n            assert.equal($(\".fd-question-tree .jstree-anchor:last\").text(), \"hindi\");\n        });\n\n        it(\"itext widget should not overwrite label with question id\", function () {\n            util.loadXML(\"\");\n            var q1 = util.addQuestion(\"Text\");\n            util.addQuestion(\"Text\");\n            util.clickQuestion(\"question1\");\n            $(\"[name='itext-en-label']\").val(\"English\").change();\n            q1.p.nodeID = \"newid\";\n\n            util.clickQuestion(\"question2\");\n            util.clickQuestion(\"newid\");\n\n            var enLabel = $(\"[name='itext-en-label']\"),\n                hinLabel = $(\"[name='itext-hin-label']\");\n            assert.equal(enLabel.val(), \"English\");\n            assert.equal(hinLabel.val(), \"English\");\n        });\n\n        it(\"tree should note when default language is being displayed instead of selected language\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"question1\");\n            util.clickQuestion(\"question1\");\n            $(\"[name='itext-en-label']\").val('english').change();\n            var treeSelector = \".fd-question-tree .jstree-anchor\";\n\n            assert.equal($(treeSelector).text(), \"english\");\n            $(\".fd-question-tree-display\").val('hin').change();\n            assert.equal($(treeSelector).text(), \"english [en]\");\n            $(\"[name='itext-hin-label']\").val('hindi').change();\n            assert.equal($(treeSelector).text(), \"hindi\");\n        });\n\n        it(\"should not fire lost of events for every mug on change label\", function () {\n            var form = util.loadXML(\"\"),\n                names = {q1: 0, q2: 0};\n            form.on(\"question-label-text-change\", function (event) {\n                names[event.mug.p.nodeID]++;\n            });\n            util.paste([\n                [\"id\", \"type\"],\n                [\"/q1\", \"Text\"],\n                [\"/q2\", \"Text\"],\n            ]);\n            util.clickQuestion(\"q2\");\n            $(\"[name='itext-en-label']\").val('english').change();\n            assert.deepEqual(names, {q1: 0, q2: 1});\n        });\n\n        it(\"non-labelItext widget should contain value on load\", function () {\n            util.loadXML(TEXT_WITH_CONSTRAINT_XML);\n            util.clickQuestion(\"text\");\n            assert.equal($(\"[name='itext-en-constraintMsg']\").val(), \"English\");\n            assert.equal($(\"[name='itext-hin-constraintMsg']\").val(), \"Hindi\");\n        });\n\n        it(\"should enable save button on itext label change\", function () {\n            util.loadXML(TEXT_QUESTION_XML);\n            util.saveButtonEnabled(false);\n            util.clickQuestion(\"question1\");\n            assert(!util.saveButtonEnabled(), \"click should not cause change\");\n            $(\"[name='itext-en-label']\").val(\"new\").change();\n            assert(util.saveButtonEnabled(), \"save button is disabled\");\n        });\n\n        it(\"should enable save button on itext constraintMsg change\", function () {\n            util.loadXML(TEXT_QUESTION_XML);\n            util.saveButtonEnabled(false);\n            util.clickQuestion(\"question1\");\n            assert(!util.saveButtonEnabled(), \"click should not cause change\");\n            $(\"[name='itext-hin-constraintMsg']\").val(\"new\").change();\n            assert(util.saveButtonEnabled(), \"save button is disabled\");\n        });\n\n        it(\"should escape inequality operators in output ref\", function () {\n            util.loadXML(OUTPUTREF_WITH_INEQUALITY_XML);\n            var mug = util.getMug(\"product\");\n            assert.equal(mug.p.labelItext.get(),\n                '<output value=\"if(1 < 2 or 2 > 3 or 3 <= 3 or 4 >= 5, \\'product\\', \\'other\\')\" />');\n            util.assertXmlEqual(\n                call('createXML'),\n                OUTPUTREF_WITH_INEQUALITY_XML,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should only update exact output ref matches when question ids change (word boundary)\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"load-one\");\n            var label = util.addQuestion(\"Trigger\", \"label\"),\n                text2 = util.addQuestion(\"Text\", \"text2\");\n            label.p.labelItext.set('<output value=\"/data/load-one\" />');\n            label.validate(\"labelItext\");\n            text2.p.nodeID = \"load\";\n            text2.p.nodeID = \"load-two\";\n            assert.equal(label.p.labelItext.get(), '<output value=\"/data/load-one\" />');\n        });\n\n        it(\"itext changes do not bleed back after copy\", function (done) {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", \"question\"),\n                dup = mug.form.duplicateMug(mug);\n            dup.p.labelItext.set(\"q2\");\n\n            util.saveAndReload(function () {\n                var mug = call(\"getMugByPath\", \"/data/question\");\n                assert.equal(mug.p.labelItext.defaultValue(), \"\");\n                done();\n            });\n        });\n\n        it(\"itext changes do not bleed back from copy of copy\", function (done) {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", \"question\"),\n                dup = mug.form.duplicateMug(mug),\n                cpy = mug.form.duplicateMug(dup);\n            cpy.p.labelItext.set(\"copy\");\n\n            util.saveAndReload(function () {\n                var mug = call(\"getMugByPath\", \"/data/question\"),\n                    dup = call(\"getMugByPath\", \"/data/copy-1-of-question\"),\n                    cpy = call(\"getMugByPath\", \"/data/copy-2-of-question\");\n                assert.equal(mug.p.labelItext.defaultValue(), \"\");\n                assert.equal(dup.p.labelItext.defaultValue(), \"\");\n                assert.equal(cpy.p.labelItext.defaultValue(), \"copy\");\n                done();\n            });\n        });\n\n        it(\"drag question into label makes output ref in correct position\", function () {\n            util.loadXML(\"\");\n            var mug1 = util.addQuestion(\"Text\", \"question1\"),\n                mug2 = util.addQuestion(\"Text\", \"question2\");\n\n            var target = $(\"[name='itext-en-label']\");\n            target.val(\"test string\").change();\n            vellumUtil.setCaretPosition(target[0], 4);\n            call(\"handleDropFinish\", target, mug1.absolutePath, mug1);\n            var val = mug2.p.labelItext.get('default', 'en');\n            assert.equal(val, 'test<output value=\"#form/question1\" /> string');\n            assert.equal(target.val(), 'test<output value=\"/data/question1\" /> string');\n        });\n\n        it(\"output ref deleted with single backspace\", function () {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", \"question1\");\n\n            var target = $(\"[name='itext-en-label']\");\n            target.val('question1 <output value=\"/data/question2\" /> end').change();\n            vellumUtil.setCaretPosition(target[0], 44);\n\n            target.trigger({\n                type: \"keydown\",\n                which: 8,\n                ctrlKey: false\n            });\n            target.change();\n            var val = mug.p.labelItext.get('default', 'en');\n            assert.equal(val, 'question1  end');\n        });\n\n        it(\"output ref deleted with single delete keypress\", function () {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", \"question1\");\n\n            var target = $(\"[name='itext-en-label']\");\n            target.val('question1 <output value=\"/data/question2\" /> end').change();\n            vellumUtil.setCaretPosition(target[0], 10);\n\n            target.trigger({\n                type: \"keydown\",\n                which: 46,\n                ctrlKey: false\n            });\n            target.change();\n            var val = mug.p.labelItext.get('default', 'en');\n            assert.equal(val, 'question1  end');\n        });\n\n        it(\"should update output ref on group rename\", function () {\n            util.loadXML(OUTPUTREF_GROUP_RENAME_XML);\n            var group = util.call(\"getMugByPath\", \"/data/question2\"),\n                q1 = util.call(\"getMugByPath\", \"/data/question1\"),\n                itext = q1.p.labelItext;\n\n            assert(itext.get().indexOf('\"#form/question2/question3\"') > 0,\n                '\"#form/question2/question3\" not in ' + itext.get());\n            group.p.nodeID = \"group\";\n            assert(itext.get('default', 'en').indexOf('\"#form/group/question3\"') > 0,\n                '\"#form/group/question3\" not in ' + itext.get('default', 'en'));\n            assert(itext.get('default', 'hin').indexOf('\"#form/group/question3\"') > 0,\n                '\"#form/group/question3\" not in ' + itext.get('default', 'hin'));\n        });\n\n        it(\"should add warning on add Audio output ref to itext\", function () {\n            util.loadXML(\"\");\n            var audio = util.addQuestion(\"Audio\", \"audio\"),\n                text = util.addQuestion(\"Text\", \"text\"),\n                target = $(\"[name='itext-en-label']\");\n            call(\"handleDropFinish\", target, audio.absolutePath, audio);\n            chai.expect(util.getMessages(text))\n                .to.include(\"Audio Capture nodes cannot be used in an output value\");\n        });\n\n        it(\"should bulk update multi-line translation\", function () {\n            var form = util.loadXML(TEXT_QUESTION_XML),\n                Itext = util.call(\"getData\").javaRosa.Itext,\n                trans = ('label\\tdefault-en\\tdefault-hin\\n' +\n                         'question1-label\\t\"First \"\"line\\n' +\n                         'Second\"\" line\\nThird line\"\\tHindu trans\\n');\n            jr.parseXLSItext(form, trans, Itext);\n            var q1 = util.getMug(\"question1\");\n            assert.equal(q1.p.labelItext.get(\"default\", \"en\"),\n                         'First \"line\\nSecond\" line\\nThird line');\n            assert.equal(q1.p.labelItext.get(\"default\", \"hin\"), 'Hindu trans');\n        });\n\n        it(\"should not get stuck on bulk update non-existent questions\", function () {\n            var form = util.loadXML(\"\"),\n                Itext = util.call(\"getData\").javaRosa.Itext,\n                trans = ('label\\tdefault-en\\tdefault-hin\\n' +\n                         'question1-label\\tlabel\\tHindu trans\\n');\n            jr.parseXLSItext(form, trans, Itext);\n            assert(!util.getMug(\"question1\"), \"question1 should not exist\");\n        });\n\n        it(\"should generate bulk multi-line translation with user-friendly newlines\", function () {\n            var form = util.loadXML(MULTI_LINE_TRANS_XML),\n                Itext = util.call(\"getData\").javaRosa.Itext;\n            assert.equal(jr.generateItextXLS(form, Itext),\n                         'label\\tdefault_en\\tdefault_hin\\t' +\n                         'audio_en\\taudio_hin\\timage_en\\timage_hin\\t' +\n                         'video_en\\tvideo_hin\\tvideo-inline_en\\tvideo-inline_hin\\n' +\n                         'question1-label\\t\"First \"\"line\\nSecond\"\" line\\nThird line\"\\t' +\n                         'Hindu trans\\t\\t\\t\\t\\t\\t\\t\\t');\n        });\n\n        it(\"should escape all languages when generating bulk translations\", function () {\n            var form = util.loadXML(MULTI_LANG_TRANS_XML),\n                Itext = util.call(\"getData\").javaRosa.Itext;\n            assert.equal(jr.generateItextXLS(form, Itext),\n                         'label\\tdefault_en\\tdefault_hin\\taudio_en\\taudio_hin\\t' +\n                         'image_en\\timage_hin\\tvideo_en\\tvideo_hin\\tvideo-inline_en\\tvideo-inline_hin\\n' +\n                         'text-label\\t\"\"\"Text\"\\t\"\"\"Text\"\\t\\t\\t\\t\\t\\t\\t\\t');\n        });\n\n        it(\"bulk translation tool should not create empty itext forms\", function () {\n            var form = util.loadXML(TEXT_QUESTION_XML),\n                Itext = util.call(\"getData\").javaRosa.Itext,\n                trans = ('label\\tdefault-en\\tdefault-hin\\taudio-en\\taudio-hin\\n' +\n                         'question1-label\\t\"First \"\"line\\n' +\n                         'Second\"\" line\\nThird line\"\\t\\t\\t\\n');\n            jr.parseXLSItext(form, trans, Itext);\n            var q1 = util.getMug(\"question1\");\n            assert.equal(q1.p.labelItext.get(\"default\", \"en\"),\n                         'First \"line\\nSecond\" line\\nThird line');\n            // existing translation should be cleared\n            assert.equal(q1.p.labelItext.get(\"default\", \"hin\"), '');\n            // non-existent form should not be added\n            assert(!q1.p.labelItext.hasForm(\"audio\"), \"unexpected form: audio\");\n        });\n\n        it(\"bulk translation tool should enable the save button on update\", function () {\n            var form = util.loadXML(TEXT_QUESTION_XML);\n            util.saveButtonEnabled(false);\n            var Itext = util.call(\"getData\").javaRosa.Itext,\n                trans = ('label\\tdefault-en\\tdefault-hin\\taudio-en\\taudio-hin\\n' +\n                         'question1-label\\t\"First \"\"line\\n' +\n                         'Second\"\" line\\nThird line\"\\t\\t\\t\\n');\n            jr.parseXLSItext(form, trans, Itext);\n            assert(util.saveButtonEnabled(), \"save button not enabled\");\n        });\n\n        it(\"should highlight label after tab\", function () {\n            util.loadXML(TEST_XML_3, null, /You have languages in your form/);\n            util.clickQuestion(\"question1\");\n            var enLabel = $(\"[name='itext-en-label']\"),\n                hinLabel = $(\"[name='itext-hin-label']\"),\n                tabKeyupEvent = $.Event('keyup');\n            tabKeyupEvent.which = 9;\n            enLabel.val(\"test string\").change();\n            enLabel.trigger(tabKeyupEvent);\n            hinLabel.val(\"hin test string\").change();\n            hinLabel.trigger(tabKeyupEvent);\n            assert.equal(enLabel[0].selectionStart, 0);\n            assert.equal(enLabel[0].selectionEnd, 11);\n            assert.equal(hinLabel[0].selectionStart, 0);\n            assert.equal(hinLabel[0].selectionEnd, 15);\n        });\n\n        it(\"should not highlight label on focus\", function () {\n            util.loadXML(TEST_XML_3, null, /You have languages in your form/);\n            util.clickQuestion(\"question1\");\n            var enLabel = $(\"[name='itext-en-label']\"),\n                hinLabel = $(\"[name='itext-hin-label']\");\n            enLabel.val(\"test string\").change();\n            enLabel.focus();\n            hinLabel.val(\"hin test string\").change();\n            hinLabel.focus();\n            // if selectionStart and selectionEnd are the same, then no highlight is present\n            assert.equal(enLabel[0].selectionStart, enLabel[0].selectionEnd);\n            assert.equal(hinLabel[0].selectionStart, hinLabel[0].selectionEnd);\n        });\n\n        it(\"should not create duplicate <help> node on select\", function () {\n            util.loadXML(SELECT1_HELP_XML);\n            var xml = call(\"createXML\"),\n                $xml = util.parseXML(xml);\n            assert.strictEqual($xml.find(\"help\").length, 1, \"wrong <help> node count\\n\" + xml);\n        });\n\n        it(\"should not auto-update itext ID when multiple questions point to auto-ish-id\", function () {\n            util.loadXML(ITEXT_ITEM_NON_AUTO_ID_XML);\n            var north = util.getMug(\"north\");\n            north.p.nodeID = \"west\";\n            var xml = call(\"createXML\"),\n                $xml = util.parseXML(xml);\n            assert.strictEqual($xml.find(\"text#north-label\").length, 2,\n                               \"wrong <text> node count\\n\" + xml);\n        });\n\n        it(\"should unlink auto itext id from other questions with shared itext\", function () {\n            util.loadXML(ITEXT_ITEM_NON_AUTO_ID_XML);\n            assert.equal($(ITEXT_ITEM_NON_AUTO_ID_XML).find(\"text#south-label\").length, 0,\n                         \"wrong <text#south> node count\\n\" + ITEXT_ITEM_NON_AUTO_ID_XML);\n            util.clickQuestion(\"south\");\n            var controls = $(\"[name='property-labelItext']\").closest(\".form-group\"),\n                autobox = controls.find(\"input[type=checkbox]\");\n            autobox.prop(\"checked\", true).change();\n            $(\"[name='itext-en-label']\").val(\"south\").change();\n            assert.equal(util.getMug(\"north\").p.labelItext.get(), \"north\");\n            assert.equal(util.getMug(\"south\").p.labelItext.get(), \"south\");\n            var xml = call(\"createXML\"),\n                $xml = util.parseXML(xml);\n            assert.equal($xml.find(\"text#north-label\").length, 2,\n                         \"wrong <text#north> node count\\n\" + xml);\n            assert.equal($xml.find(\"text#south-label\").length, 2,\n                         \"wrong <text#south> node count\\n\" + xml);\n        });\n\n        _.each([\"hint\", \"help\", \"constraintMsg\"], function (tag) {\n            it(\"should not serialize empty \" + tag + \" itext item with non-empty id and autoId = true\", function() {\n                util.loadXML(\"\");\n                var mug = util.addQuestion(\"Text\"),\n                    itext = mug.p[tag + \"Itext\"];\n                itext.id = tag;\n                itext.autoId = true;\n                var xml = call(\"createXML\"),\n                    $xml = util.parseXML(xml);\n                if (tag === \"constraintMsg\") {\n                    assert.strictEqual($xml.find(\"[jr\\\\:\" + tag + \"]\").length, 0,\n                                       \"wrong \" + tag + \" count\\n\" + xml);\n                } else {\n                    assert.strictEqual($xml.find(tag).length, 0,\n                                       \"wrong <\" + tag + \"> node count\\n\" + xml);\n                }\n            });\n        });\n\n        it(\"should not allow apostrophes in item labels\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", \"select\");\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.clickQuestion('select/choice1');\n            $(\"[name='property-nodeID']\").val(\"blah ' blah\").change();\n            assert.strictEqual($(\"[name='property-labelItext']\").val(), 'select-blah___blah-label');\n        });\n\n        it(\"should not allow > in item labels\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", \"select\");\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.clickQuestion('select/choice1');\n            $(\"[name='property-nodeID']\").val(\"blah > blah\").change();\n            assert.strictEqual($(\"[name='property-labelItext']\").val(), 'select-blah___blah-label');\n        });\n\n        it(\"should not change with node id when blank\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text\");\n            util.clickQuestion(\"text\");\n            $('[name=itext-en-label]').val('').change();\n            $('[name=itext-hin-label]').val('').change();\n            $('[name=property-nodeID]').val('nodeid').change();\n            assert.strictEqual($('[name=itext-en-label]').val(), '');\n            assert.strictEqual($('[name=itext-hin-label]').val(), '');\n        });\n    });\n\n    describe(\"The javaRosaplugin with one language\", function() {\n        before(function(done) {\n            util.init({\n                javaRosa: { langs: ['en'] },\n                core: {\n                    onReady: function () {\n                        done();\n                    }\n                }\n            });\n        });\n\n        it(\"should allow a value to be blank\", function(){\n            util.loadXML(\"\");\n            util.addQuestion('Trigger', 'label');\n            util.clickQuestion('label');\n            $('[name=itext-en-label]').val('blah').change();\n            $('.itext-block-label-add-form-image').click();\n            $('[name=itext-en-label]').val('').change();\n            util.assertXmlEqual(call(\"createXML\"), \n                                NO_LABEL_TEXT_ONE_LANG_XML,\n                                {normalize_xmlns: true});\n        });\n\n        it (\"should not error on form with output without value\", function() {\n            util.loadXML(BARE_OUTPUT);\n            var mug = util.getMug(\"output\");\n            assert.equal(mug.p.labelItext.get(), \"x <output /> x\");\n            util.assertXmlEqual(call('createXML'), BARE_OUTPUT);\n        });\n    });\n\n    describe(\"The javaRosa plugin itext widgets\", function() {\n        before(function(done) {\n            util.init({\n                features: {rich_text: false, use_custom_repeat_button_text: true},\n                javaRosa: { langs: ['en'] },\n                core: {\n                    onReady: function () {\n                        var form = util.loadXML(\"\"),\n                            Itext = form.vellum.data.javaRosa.Itext;\n                        mug = util.addQuestion(\"Text\");\n                        repeatMug = util.addQuestion(\"Repeat\");\n                        // trigger itext id population\n                        jr.parseXLSItext(form, \"\", Itext);\n                        done();\n                    }\n                }\n            });\n        });\n        var mug, repeatMug, itext, spec;\n\n        it (\"should detect whether or not readable itext labels are present\", function() {\n            var model = new jrItext.model(),\n                item = new jrItext.item({\n                    itextModel: model,\n                });\n            assert(!item.hasHumanReadableItext(), \"No recognized forms\");\n            item.addForm('short');\n            assert(item.hasHumanReadableItext(), \"Recognized form\");\n            model.addLanguage('en');\n            assert(!item.hasHumanReadableItext(), \"No English text\");\n            item.getForm('short').setValue('en', 'thing');\n            assert(item.hasHumanReadableItext(), \"Has English text\");\n            model.addLanguage('hin');\n            assert(!item.hasHumanReadableItext(), \"No Hindi text\");\n        });\n\n        function testItextIdValidation(property) {\n\n            describe(\"itext id validation\", function () {\n                before(function () {\n                    itextValidationMug = ['addCaptionItext', 'addEmptyCaptionItext'].indexOf(property) > -1 ? repeatMug : mug;\n                    itext = itextValidationMug.p[property];\n                    spec = itextValidationMug.spec[property];\n                });\n                var itextValidationMug;\n\n                it(\"should not display \" + property + \" validation error for autoId itext\", function () {\n                    var before = itext.id;\n                    itext.autoId = true;\n\n                    assert(itext.id, property + \".id should have a value\");\n                    assert.equal(spec.validationFunc(itextValidationMug), \"pass\");\n\n                    itext.id = \"\";\n                    try {\n                        assert.equal(spec.validationFunc(itextValidationMug), \"pass\");\n                    } finally {\n                        itext.id = before;\n                    }\n                });\n\n                it(\"should display \" + property + \" validation error for non-autoId non-empty itext with blank ID\", function () {\n                    var before = [itext.id, itext.get()];\n                    itext.autoId = false;\n                    itext.id = \"\";\n                    itext.set(\"not empty\");\n                    try {\n                        assert.notEqual(spec.validationFunc(itextValidationMug), \"pass\", property);\n                    } finally {\n                        itext.id = before[0];\n                        itext.set(before[1]);\n                    }\n                });\n\n                it(\"should not display \" + property + \" validation error for non-autoId empty itext with blank ID\", function () {\n                    var before = [itext.id, itext.get()];\n                    itext.autoId = false;\n                    itext.id = \"\";\n                    itext.set(\"\");\n                    try {\n                        assert.equal(spec.validationFunc(itextValidationMug), \"pass\");\n                    } finally {\n                        itext.id = before[0];\n                        itext.set(before[1]);\n                    }\n                });\n\n                it(\"should not display \" + property + \" validation error for non-autoId valid itext id\", function () {\n                    var before = [itext.id, itext.get(), itextValidationMug.p.constraintAttr];\n                    if (property === \"constraintMsgItext\") {\n                        itextValidationMug.p.constraintAttr = \"x = y\";\n                    }\n                    itext.autoId = false;\n                    itext.id = \"node-id-label-itext\";\n                    itext.set(\"node-id-label-itext\");\n                    try {\n                        assert.equal(spec.validationFunc(itextValidationMug), \"pass\");\n                    } finally {\n                        itext.id = before[0];\n                        itext.set(before[1]);\n                        itextValidationMug.p.constraintAttr = before[2];\n                    }\n                });\n\n                it(\"should display \" + property + \" validation error for non-autoId invalid itext id\", function () {\n                    var before = [itext.id, itext.get(), itextValidationMug.p.constraintAttr];\n                    if (property === \"constraintMsgItext\") {\n                        itextValidationMug.p.constraintAttr = \"x = y\";\n                    }\n                    itext.autoId = false;\n                    itext.id = \"node-id-label-itext'&\";\n                    itext.set(\"node-id-label-itext'&\");\n                    try {\n                        assert.notEqual(spec.validationFunc(itextValidationMug), \"pass\", property);\n                    } finally {\n                        itext.id = before[0];\n                        itext.set(before[1]);\n                        itextValidationMug.p.constraintAttr = before[2];\n                    }\n                });\n\n                it(\"should not have \" + property + \"ID validator (it will not be invoked)\", function () {\n                    assert(!itextValidationMug.spec[property + \"ID\"].validationFunc,\n                        property + \"ID virtual property validator will not be invoked\");\n                });\n            });\n        }\n\n        testItextIdValidation(\"labelItext\");\n        testItextIdValidation(\"hintItext\");\n        testItextIdValidation(\"helpItext\");\n        testItextIdValidation(\"constraintMsgItext\");\n        testItextIdValidation(\"addEmptyCaptionItext\");\n        testItextIdValidation(\"addCaptionItext\");\n\n        it(\"should display constraintMsgItext validation error for non-autoId itext without validation condition\", function() {\n            var itext = mug.p.constraintMsgItext,\n                spec = mug.spec.constraintMsgItext,\n                before = mug.p.constraintAttr;\n            itext.autoId = false;\n            mug.p.constraintAttr = \"\";\n            try {\n                assert(itext.id, \"constraintMsgItext.id should have a value\");\n                assert.equal(spec.validationFunc(mug),\n                    \"Can't have a Validation Message Itext ID without a Validation Condition\");\n            } finally {\n                mug.p.constraintAttr = before;\n            }\n        });\n\n        it(\"should not display constraintMsgItext validation error for autoId itext with validation condition\", function() {\n            var itext = mug.p.constraintMsgItext,\n                spec = mug.spec.constraintMsgItext,\n                before = mug.p.constraintAttr;\n            itext.autoId = true;\n            mug.p.constraintAttr = \"x = y\";\n            try {\n                assert.equal(spec.validationFunc(mug), \"pass\");\n            } finally {\n                mug.p.constraintAttr = before;\n            }\n        });\n\n        it(\"should not display constraintMsgItext validation error after removing validation message and condition\", function() {\n            util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\", \"constraintMsgItext:en-default\", \"constraintAttr\", \"constraintMsgAttr\"],\n                [\"/text\", \"Text\", \"message!\", \". = 'a'\", \"jr:itext('question1-constraintMsg')\"],\n            ]);\n            $(\"[name='itext-en-constraintMsg']\").val('').change();\n            $(\"[name='property-constraintAttr']\").val('').change();\n            var message = $(\"[name='property-constraintAttr']\").siblings(\".messages\").text();\n            assert(!message, \"unexpected message: \" + message);\n        });\n\n        it(\"should show and hide the validation message as appropriate\", function() {\n            util.loadXML(GROUP_WITH_CONSTRAINT_XML);\n            $(\"[name='property-constraintAttr']\").val('true()').change();\n            $(\"[name='itext-en-constraintMsg']\").val('This is not possible').change();\n            assert($(\"[name='itext-en-constraintMsg']\").is(\":visible\"));\n            $(\"[name='itext-en-constraintMsg']\").val('').change();\n            $(\"[name='property-constraintAttr']\").val('').change();\n            assert(!$(\"[name='itext-en-constraintMsg']\").is(\":visible\"));\n        });\n\n        it(\"should show a validation error when dropping a self reference\", function() {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", \"question1\"),\n                property = 'itext-en-label';\n            util.clickQuestion(\"question1\");\n\n            assert.deepEqual(mug.messages.get(property), []);\n            mug.form.vellum.handleDropFinish($('[name='+property+']'), '.', mug);\n            assert.equal(mug.messages.get(property).length, 1,\n                         util.getMessages(mug));\n\n                mug.dropMessage(property, \"core-circular-reference-warning\");\n                assert.deepEqual(mug.messages.get(property), []);\n        });\n\n        it(\"should show a validation error for choices without labels\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", \"question1\");\n            var item = util.addQuestion(\"Choice\", \"choice1\");\n            util.clickQuestion(\"question1/choice1\");\n\n            var messages = item.messages.get('labelItext');\n            assert.equal(messages.length, 0);\n\n            $(\"[name='itext-en-label']\").val('').change();\n\n            messages = item.messages.get('labelItext');\n            assert.equal(messages.length, 1);\n            assert(messages[0].match(/required/i));\n        });\n\n        it(\"should not show a validation error for manually added choices\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", \"question1\");\n            var item = util.addQuestion(\"Choice\", \"choice1\");\n\n            util.clickQuestion(\"question1/choice1\");\n\n            var messages = item.messages.get('labelItext');\n            assert.equal(messages.length, 0);\n\n            util.clickQuestion(\"question1\");\n            util.addQuestion(\"Choice\", \"choice3\");\n            messages = item.messages.get('labelItext');\n            assert.equal(messages.length, 0);\n        });\n\n        it('should replace output values with $ on mug rename', function () {\n            util.loadXML(\"\");\n            util.addQuestion('Text', 'text');\n            util.addQuestion('Text', 'text2');\n            util.clickQuestion('text');\n            $('[name=itext-en-label]').val('<output value=\"regex(/data/text2, \\'$[0-9]+\\.[0-9]$\\')\" />').change();\n            util.clickQuestion('text2');\n            $('[name=property-nodeID]').val('text3').change();\n            util.clickQuestion('text');\n            assert.strictEqual($('[name=itext-en-label]').val(), '<output value=\"regex(/data/text3, \\'$[0-9]+\\.[0-9]$\\')\" />');\n        });\n    });\n\n    describe(\"The javaRosa markdown detector\", function() {\n        _.each([\n            \"**Word!**\",\n            \"**a bold phrase**\",\n        ], function (text) {\n            it(\"should recognize \" + JSON.stringify(text), function() {\n                assert(jr.looksLikeMarkdown(text, false), \"fail\");\n            });\n        });\n        var markdownTable = \"| col1    | col2    | col3 |\\n|:----:|:----:|:----:|\\n| r1c1 | r1c2 | r1c3 |\";\n        it(\"should detect a markdown table\" + JSON.stringify(markdownTable), function(){\n            assert(jr.looksLikeMarkdown(markdownTable, true), \"fail\");\n        });\n        it(\"should not detect a markdown table since supportMarkdown is false\" + JSON.stringify(markdownTable), function(){\n            assert(!jr.looksLikeMarkdown(markdownTable, false), \"fail\");\n        });\n        _.each([\n            \"**not\\nbold**\",\n        ], function (text) {\n            it(\"should NOT recognize \" + JSON.stringify(text), function() {\n                assert(!jr.looksLikeMarkdown(text, false), \"fail\");\n            });\n        });\n    });\n\n    describe(\"The javaRosa plugin language selector\", function() {\n        before(function(done) {\n            util.init({\n                features: {rich_text: false},\n                javaRosa: { langs: ['en'] },\n                core: {onReady: function () { done (); }},\n            });\n        });\n\n        it(\"should have option to display IDs\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"question1\");\n            util.clickQuestion(\"question1\");\n            var $display = $(\".fd-question-tree-display\");\n            var treeSelector = \".fd-question-tree .jstree-anchor\";\n\n            $(\"[name='itext-en-label']\").val('x').change();\n            assert.equal($(treeSelector).text(), \"x\");\n            $(\"[name='itext-en-label']\").val('').change();\n            assert.equal($(treeSelector).text(), \"question1\");\n\n            $display.val('en').change();\n            $(\"[name='itext-en-label']\").val('english').change();\n            assert.equal($(treeSelector).text(), \"english\");\n            $display.val('_ids').change();\n            assert.equal($(treeSelector).text(), \"question1\");\n        });\n\n        it(\"should only display once after multiple load xml\", function() {\n            assert.strictEqual($('.fd-questions-menu li:contains(\"Display\")').length, 1);\n            util.loadXML(\"\");\n            assert.strictEqual($('.fd-questions-menu li:contains(\"Display\")').length, 1);\n            util.loadXML(\"\");\n            assert.strictEqual($('.fd-questions-menu li:contains(\"Display\")').length, 1);\n        });\n    });\n\n    describe(\"show only current language for translations\", function () {\n        before(function (done) {\n            util.init({\n                features: {rich_text: false},\n                javaRosa: {langs: ['en', 'hin', 'tel'],\n                           showOnlyCurrentLang: true,\n                           displayLanguage: 'en'\n                           },\n                core: {onReady: function () { done(); }}\n            });\n        });\n\n        it(\"should change the property on javaRosa\", function() {\n            assert.equal(util.call(\"getData\").javaRosa.showOnlyCurrentLang, true);\n        });\n\n        describe(\"when current language same as default language\", function() {\n            it(\"should just show translation for the current display language\", function() {\n                assert.equal(util.call(\"getData\").core.currentItextDisplayLanguage, \"en\");\n                assert.equal(util.call(\"getData\").javaRosa.Itext.defaultLanguage, \"en\");\n                util.loadXML(TEST_XML_1);\n                util.clickQuestion(\"question1\");\n                assert.equal($(\"[name='itext-en-label']\").length, 1);\n                assert.equal($(\"[name='itext-hin-label']\").length, 0);\n            });\n        });\n\n        describe(\"when current display language not same as default language\", function() {\n            describe(\"when current display language is one of the app langs\", function() {\n                before(function (done) {\n                    util.init({\n                        features: {rich_text: false},\n                        javaRosa: {langs: ['en', 'hin', 'tel'], showOnlyCurrentLang: true, displayLanguage: 'tel'},\n                        core: {onReady: function () { done(); }}\n                    });\n                });\n\n                it(\"should show translation for both current and default language\", function() {\n                    assert.equal(util.call(\"getData\").core.currentItextDisplayLanguage, \"tel\");\n                    assert.equal(util.call(\"getData\").javaRosa.Itext.defaultLanguage, \"en\");\n                    util.loadXML(TEST_XML_1);\n                    util.clickQuestion(\"question1\");\n                    assert.equal($(\"[name='itext-en-label']\").length, 1);\n                    assert.equal($(\"[name='itext-hin-label']\").length, 0);\n                    assert.equal($(\"[name='itext-tel-label']\").length, 1);\n                });\n            });\n\n            describe(\"when current display language is not one of the app langs\", function() {\n                before(function (done) {\n                    util.init({\n                        features: {rich_text: false},\n                        javaRosa: {langs: ['en', 'hin', 'tel'], showOnlyCurrentLang: true, displayLanguage: '_ids'},\n                        core: {onReady: function () { done(); }}\n                    });\n                });\n\n                it(\"should just show translation for the default language\", function() {\n                    assert.equal(util.call(\"getData\").core.currentItextDisplayLanguage, \"_ids\");\n                    assert.equal(util.call(\"getData\").javaRosa.Itext.defaultLanguage, \"en\");\n                    util.loadXML(TEST_XML_1);\n                    util.clickQuestion(\"question1\");\n                    assert.equal($(\"[name='itext-en-label']\").length, 1);\n                    assert.equal($(\"[name='itext-hin-label']\").length, 0);\n                    assert.equal($(\"[name='itext-tel-label']\").length, 0);\n                });\n            });\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'vellum/jquery-extensions',\n    'static/parser/required.xml',\n], function (\n    chai,\n    $,\n    _,\n    util,\n    ext,\n    REQUIRED_XML\n) {\n    var assert = chai.assert,\n        xml;\n\n    describe(\"jQuery extensions\", function () {\n        beforeEach(function () {\n            xml = $(REQUIRED_XML);\n        });\n\n        describe(\"xmlAttr() gets\", function () {\n            it(\"undefined when nothing is selected\", function () {\n                var node = xml.find(\"not[found]\");\n                assert.equal(node.xmlAttr(\"required\"), undefined);\n            });\n\n            it(\"undefined value for missing attribute\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                assert.equal(node.xmlAttr(\"not-found\"), undefined);\n            });\n\n            it(\"'required' attribute value\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                assert.equal(node.xmlAttr(\"required\"), \"true()\");\n            });\n\n            it(\"'vellum:required' attribute value\", function () {\n                var node = xml.find(\"bind[nodeset$='question2']\");\n                assert.equal(node.xmlAttr(\"vellum:required\"), \"#form/question1 = 'hi'\");\n            });\n        });\n\n        describe(\"xmlAttr() sets\", function () {\n            it(\"does nothing when nothing is selected\", function () {\n                var node = xml.find(\"not[found]\");\n                node = node.xmlAttr(\"required\", \"ignored\");\n                assert.equal(node.xmlAttr(\"required\"), undefined);\n            });\n\n            it(\"value of missing attribute\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node = node.xmlAttr(\"required\", \"ignored\");\n                assert.equal(node.xmlAttr(\"required\"), \"ignored\");\n            });\n\n            it(\"undefined and returns node\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node = node.xmlAttr(\"required\", undefined);\n                assert.equal(node.xmlAttr(\"required\"), \"true()\");\n            });\n\n            it(\"null and returns node with attribute removed\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node = node.xmlAttr(\"required\", null);\n                assert.equal(node.xmlAttr(\"required\"), undefined);\n            });\n\n            it(\"undefined 'vellum:required' and returns node\", function () {\n                var node = xml.find(\"bind[nodeset$='question2']\");\n                node = node.xmlAttr(\"vellum:required\", undefined);\n                assert.equal(node.xmlAttr(\"vellum:required\"), \"#form/question1 = 'hi'\");\n            });\n\n            it(\"null 'vellum:required' and returns node with attribute removed\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node = node.xmlAttr(\"vellum:required\", null);\n                assert.equal(node.xmlAttr(\"vellum:required\"), undefined);\n            });\n\n            it(\"value of existing 'required' attribute\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node = node.xmlAttr(\"required\", \"new-value\");\n                assert.equal(node.xmlAttr(\"required\"), \"new-value\");\n            });\n\n            it(\"value of existing 'vellum:required' attribute\", function () {\n                var node = xml.find(\"bind[nodeset$='question2']\");\n                node = node.xmlAttr(\"vellum:required\", \"new-value\");\n                assert.equal(node.xmlAttr(\"vellum:required\"), \"new-value\");\n            });\n\n            it(\"value and returns node\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node.xmlAttr(\"required\", \"new-value\")\n                    .xmlAttr(\"readonly\", \"books\");\n                assert.equal(node.xmlAttr(\"required\"), \"new-value\");\n                assert.equal(node.xmlAttr(\"readonly\"), \"books\");\n            });\n        });\n\n        describe(\"xmlAttr() set multiple\", function () {\n            it(\"does nothing when nothing is selected\", function () {\n                var node = xml.find(\"not[found]\");\n                node = node.xmlAttr({\"required\": \"maybe\", \"readonly\": \"nope\"});\n                assert.equal(node.xmlAttr(\"required\"), undefined);\n                assert.equal(node.xmlAttr(\"readonly\"), undefined);\n            });\n\n            it(\"values of missing attributes\", function () {\n                var node = xml.find(\"bind[nodeset$='question2']\");\n                node = node.xmlAttr({\"not-set\": \"maybe\", \"readonly\": \"nope\"});\n                assert.equal(node.xmlAttr(\"not-set\"), \"maybe\");\n                assert.equal(node.xmlAttr(\"readonly\"), \"nope\");\n            });\n\n            it(\"undefined and returns node\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node = node.xmlAttr({\"required\": undefined});\n                assert.equal(node.xmlAttr(\"required\"), \"true()\");\n            });\n\n            it(\"null and returns node with attribute removed\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node = node.xmlAttr({\"required\": null});\n                assert.equal(node.xmlAttr(\"required\"), undefined);\n            });\n\n            it(\"values of existing attributes\", function () {\n                var node = xml.find(\"bind[nodeset$='question2']\");\n                node = node.xmlAttr({\"required\": \"maybe\", \"vellum:required\": \"nope\"});\n                assert.equal(node.xmlAttr(\"required\"), \"maybe\");\n                assert.equal(node.xmlAttr(\"vellum:required\"), \"nope\");\n            });\n\n            it(\"values and returns node\", function () {\n                var node = xml.find(\"bind[nodeset$='question1']\");\n                node.xmlAttr({\"required\": \"maybe\", \"vellum:required\": \"nope\"})\n                    .xmlAttr(\"readonly\", \"books\");\n                assert.equal(node.xmlAttr(\"required\"), \"maybe\");\n                assert.equal(node.xmlAttr(\"vellum:required\"), \"nope\");\n                assert.equal(node.xmlAttr(\"readonly\"), \"books\");\n            });\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'vellum/logic',\n    'vellum/xpath',\n    'tests/static/logic/test-xml-1.xml',\n    'tests/static/databrowser/mother-ref.xml',\n    'tests/static/logic/hashtag-filter.xml',\n], function (\n    chai,\n    $,\n    _,\n    util,\n    logic,\n    xpath,\n    TEST_XML_1,\n    MOTHER_REF_XML,\n    HASHTAG_FILTER\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    function getPath(expr) {\n        return expr.toXPath();\n    }\n\n    describe(\"The logic manager\", function () {\n        before(function (done) {\n            util.init({\n                core: {onReady: function () { done(); }},\n                features: {rich_text: true},\n            });\n        });\n\n        it(\"should update expressions when a question ID changes\", function () {\n            util.loadXML(TEST_XML_1);\n            util.getMug(\"question1\").p.nodeID = 'question';\n            var mug = util.getMug(\"/data/question2\");\n            assert.equal(mug.p.relevantAttr, \"#form/question = #case/dob\");\n        });\n\n        it(\"should display error for invalid xpath expression\", function () {\n            util.loadXML(MOTHER_REF_XML);\n            var mug = util.getMug(\"/data/mug\");\n            mug.p.calculateAttr = \"#invalid/xpath dob`#case/dob`\";\n            assert(!util.isTreeNodeValid(mug), \"mug should not be valid\");\n        });\n\n        it(\"should not display invalid xpath error for hashtag filter expression\", function () {\n            util.loadXML(HASHTAG_FILTER);\n            var calc = util.getMug(\"/data/calc\");\n            assert(util.isTreeNodeValid(calc), \"calc xpath should be valid\");\n        });\n\n        it(\"should not update expressions for model iteration\", function () {\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", \"product\");\n            repeat.p.dataSource = {\n                instance: {id: \"products\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('products')/products/product/@id\"\n            };\n            call(\"createXML\");\n            assert(util.isTreeNodeValid(repeat), \"repeat should be valid\");\n        });\n\n        describe(\"without rich text\", function () {\n            before(function (done) {\n                util.init({\n                    core: {onReady: function () { done(); }},\n                    features: {rich_text: false},\n                });\n            });\n\n            it(\"should remove references for labels after removal\", function () {\n                var form = util.loadXML(\"\"),\n                    logicManager = form._logicManager,\n                    text;\n                util.addQuestion('Text', 'mug');\n                text = util.addQuestion('Text', 'text');\n                $('[name=itext-en-label]').val('<output value=\"/data/mug\" />').change();\n                assert.equal(logicManager.forward[text.ufid].labelItext.length, 1);\n                util.deleteQuestion('/data/text');\n                assert.deepEqual(logicManager.forward[text.ufid], {});\n            });\n        });\n\n        describe(\"should add validation error for\", function () {\n            var properties = [\n                    \"relevantAttr\",\n                    \"calculateAttr\",\n                    \"constraintAttr\",\n                    \"dataParent\",\n                    \"repeat_count\",\n                    \"filter\",\n                    \"defaultValue\",\n                    \"requiredCondition\"\n                ],\n                canSelfRef = [\"constraintAttr\"],\n                noSelfProps = _.difference(properties, canSelfRef),\n                mugMap = {\n                    repeat_count: \"repeat\",\n                    filter: \"select/itemset\",\n                };\n\n            before(function () {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", \"text\");\n                util.addQuestion(\"SelectDynamic\", \"select\");\n                util.addQuestion(\"Repeat\", \"repeat\");\n            });\n\n            function testReference(attr, value, bad) {\n                var mug = util.getMug(mugMap[attr] || \"text\");\n                assert(util.isTreeNodeValid(mug),\n                    \"precondition failed:\\n\" + util.getMessages(mug));\n                assert.deepEqual(mug.messages.get(attr), [],\n                    \"pre-check: mug has messages\");\n\n                mug.p[attr] = value;\n                try {\n                    if (bad) {\n                        assert(!util.isTreeNodeValid(mug), \"mug should not be valid\");\n                        assert(mug.messages.get(attr).length,\n                               attr + \" should have messages\");\n                    } else {\n                        assert(util.isTreeNodeValid(mug), \"mug should be valid\");\n                        assert(mug.messages.get(attr).length === 0,\n                               attr + \" should not have messages\");\n                    }\n                } finally {\n                    mug.p[attr] = \"\";\n                }\n\n                assert(util.isTreeNodeValid(mug),\n                    \"postcondition failed:\\n\" + util.getMessages(mug));\n                assert.deepEqual(mug.messages.get(attr), [],\n                    \"post-check: mug has messages\");\n            }\n\n            _.each(properties, function (attr) {\n                it(\"invalid path in \" + attr, function () {\n                    testReference(attr, '/data/unknown', true);\n                });\n            });\n\n            _.each(noSelfProps, function(attr) {\n                it(\"self referencing path in \" + attr, function () {\n                    testReference(attr, '.', true);\n                });\n            });\n\n            _.each(canSelfRef, function(attr) {\n                it(\"self referencing path in \" + attr, function () {\n                    testReference(attr, '.', false);\n                });\n            });\n        });\n\n        describe(\"should not add validation error for\", function() {\n            var allowedReferences = [\n                \"meta/deviceID\",\n                \"meta/instanceID\",\n                \"meta/username\",\n                \"meta/userID\",\n                \"meta/timeStart\",\n                \"meta/timeEnd\",\n                \"meta/location\",\n            ];\n\n            _.each(allowedReferences, function(ref) {\n                it(ref, function () {\n                    util.loadXML(\"\");\n                    var mug = util.addQuestion(\"Text\", \"text\");\n                    mug.p.calculateAttr = \"/data/\" + ref;\n                    assert(util.isTreeNodeValid(mug), util.getMessages(mug));\n                });\n            });\n        });\n\n        describe(\"sends case references to HQ\", function () {\n            before(function (done) {\n                util.init({core: {onReady: function () { done(); }}});\n            });\n\n            it(\"should be the correct format\", function() {\n                var form = util.loadXML(MOTHER_REF_XML),\n                    manager = form._logicManager;\n                assert.deepEqual(manager.caseReferences(),\n                    {load: {\"/data/mug\": [\"#case/parent/edd\"]}, save: {}});\n            });\n\n            it(\"should not send deleted references\", function () {\n                var form = util.loadXML(MOTHER_REF_XML),\n                    manager = form._logicManager;\n                util.deleteQuestion('/data/mug');\n                assert.deepEqual(manager.caseReferences(), {load: {}, save: {}});\n            });\n\n            it(\"should not write unknown case properties to xml\", function () {\n                var form = util.loadXML(\"\"),\n                    manager = form._logicManager,\n                    mug = util.addQuestion('Text', 'text');\n                mug.p.defaultValue = '#case/not-here';\n                assert.deepEqual(manager.knownExternalReferences(), { });\n            });\n\n            it(\"should send parent path for choice\", function () {\n                var form = util.loadXML(\"\"),\n                    manager = form._logicManager;\n                util.paste([\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/select\", \"Select\", \"select\"],\n                    [\"/select/choice\", \"Choice\", '<output value=\"#case/dob\" />'],\n                ]);\n                assert.deepEqual(manager.caseReferences(),\n                                 {load: {\"/data/select\": [\"#case/dob\"]}, save: {}});\n            });\n\n            it(\"should send all properties referenced by a question\", function () {\n                var form = util.loadXML(\"\"),\n                    manager = form._logicManager;\n                util.paste([\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/select\", \"Select\", '<output value=\"#case/name\" />'],\n                    [\"/select/choice\", \"Choice\", '<output value=\"#case/dob\" />'],\n                    [\"/select/other\", \"Choice\", '<output value=\"#user/role\" />'],\n                ]);\n                assert.deepEqual(manager.caseReferences(),\n                                 {load: {\"/data/select\": [\n                                    \"#case/name\",\n                                    \"#case/dob\",\n                                    \"#user/role\",\n                                 ]}, save: {}});\n            });\n        });\n\n        describe(\"findUsages\", function () {\n            var form,\n                expectedUsages = {\n                    \"#form/question1\": {\n                        \"#form/question2\": \"Display Condition\",\n                        \"#form/question3\": \"Display Condition\",\n                    },\n                    \"#form/question2\": {\"#form/question3\": \"Display Condition\"}\n                };\n            before(function (done) {\n                form = util.loadXML(TEST_XML_1);\n                done();\n            });\n\n            it(\"should return dictionary of usages\", function () {\n                assert.deepEqual(form.findUsages(), expectedUsages);\n            });\n\n            it(\"should return dictionary of usages when filtered by path\", function () {\n                var q1 = \"#form/question1\",\n                    q2 = \"#form/question2\";\n                assert.deepEqual(form.findUsages(q1),\n                    {\"#form/question1\": expectedUsages[q1]}\n                );\n                assert.deepEqual(form.findUsages(q2),\n                    {\"#form/question2\": expectedUsages[q2]}\n                );\n            });\n\n            it(\"should return empty dictionary when question not referenced\", function () {\n                assert.deepEqual(form.findUsages(\"#form/question3\"), {});\n            });\n\n            it(\"should not error after deleting reference\", function () {\n                var mug = util.addQuestion(\"Text\", \"mug\"),\n                    q3 = util.getMug(\"question3\");\n                q3.p.relevantAttr = \"#form/mug\";\n                form.removeMugsFromForm([mug]);\n                q3.p.relevantAttr = \"\";\n                assert.deepEqual(form.findUsages(\"#form/question3\"), {});\n            });\n        });\n\n        describe(\"hasBrokenReferences\", function () {\n            var form;\n            beforeEach(function () {\n                form = util.loadXML();\n            });\n\n            it(\"should return false for empty form\", function () {\n                assert.isNotOk(form.hasBrokenReferences());\n            });\n\n            it(\"should return true for form with broken reference\", function () {\n                util.addQuestion(\"Text\", \"text\", {relevantAttr: \"/data/unknown\"});\n                assert.isOk(form.hasBrokenReferences());\n            });\n\n            it(\"should return false after broken reference is fixed\", function () {\n                util.addQuestion(\"Text\", \"text\", {relevantAttr: \"/data/other\"});\n                assert.isOk(form.hasBrokenReferences(), \"should have broken\");\n                util.addQuestion(\"Text\", \"other\", {relevantAttr: \"/data/other\"});\n                assert.isNotOk(form.hasBrokenReferences());\n            });\n        });\n    });\n\n    describe(\"Logic expression\", function() {\n        var expressions = [\n            [\n                \"instance('casedb')/cases/case/property\",\n                [\"instance('casedb')/cases/case/property\"],\n                [\"instance('casedb')/cases/case/property\"],\n            ],\n            [\n                \"instance('casedb')/cases/case/property[@case_id = /data/caseid]\",\n                [\"instance('casedb')/cases/case/property[@case_id = /data/caseid]\", \"@case_id\", \"/data/caseid\"],\n                [\"instance('casedb')/cases/case/property[@case_id = /data/caseid]\"],\n            ],\n            [\n                \"instance('casedb')/cases/case/property[@case_id = /data/caseid] = /data/other_caseid\",\n                [\"instance('casedb')/cases/case/property[@case_id = /data/caseid]\", \"@case_id\", \"/data/caseid\", \"/data/other_caseid\"],\n                [\"instance('casedb')/cases/case/property[@case_id = /data/caseid]\", \"/data/other_caseid\"],\n            ],\n            [\n                \"instance('casedb')/cases/case[@case_id = instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]/index/parent]/edd = /data/other_caseid\",\n                [\n                    \"instance('casedb')/cases/case[@case_id = instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]/index/parent]/edd\",\n                    \"@case_id\",\n                    \"instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]/index/parent\",\n                    \"instance('commcaresession')/session/data/case_id\",\n                    \"/data/other_caseid\"\n                ],\n                [\"instance('casedb')/cases/case[@case_id = instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]/index/parent]/edd\", \"/data/other_caseid\"],\n            ],\n            [\n                \"selected(instance('casedb')/cases/case/property[@case_id = /data/caseid])\",\n                [\"instance('casedb')/cases/case/property[@case_id = /data/caseid]\", \"@case_id\", \"/data/caseid\"],\n                [\"instance('casedb')/cases/case/property[@case_id = /data/caseid]\"],\n            ],\n            [\n                \"(instance('casedb')/cases/case/property[@case_id = /data/caseid] = /data/other_caseid) and (/other/thing = /this/thing)\",\n                [\"instance('casedb')/cases/case/property[@case_id = /data/caseid]\", \"@case_id\", \"/data/caseid\", \"/data/other_caseid\", \"/other/thing\", \"/this/thing\"],\n                [\"instance('casedb')/cases/case/property[@case_id = /data/caseid]\", \"/data/other_caseid\", \"/other/thing\", \"/this/thing\"],\n            ],\n            [\n                \"/data/text1 = /data/text2\",\n                [\"/data/text1\", \"/data/text2\"],\n                [\"/data/text1\", \"/data/text2\"],\n            ],\n        ];\n\n        _.each(expressions, function(expr) {\n            var logicExpr = new logic.LogicExpression(expr[0], xpath.createParser(xpath.makeXPathModels()));\n\n            it(\"should return all paths: \" + expr[0], function() {\n                var paths = _.map(logicExpr.getPaths(), getPath);\n                assert.deepEqual(_.difference(paths, expr[1]), []);\n                assert.deepEqual(_.difference(expr[1], paths), []);\n            });\n\n            it(\"should return top level paths: \" + expr[0], function() {\n                var paths = _.map(logicExpr.getTopLevelPaths(), getPath);\n                assert.deepEqual(_.difference(paths, expr[2]), []);\n                assert.deepEqual(_.difference(expr[2], paths), []);\n            });\n        });\n\n        describe(\"hashtags\", function() {\n            function getHashtags(expr) {\n                return expr.toHashtag();\n            }\n\n            var hashtags = [\n                {\n                    path: \"#form/text1 = #form/text2\",\n                    hashtags: [\"#form/text1\", \"#form/text2\"],\n                    xpath: \"/data/text1 = /data/text2\",\n                },\n                {\n                    path: \"/data/not/in/form[#form/text1] = #form/text2\",\n                    hashtags: [\"#form/text1\", \"#form/text2\"],\n                    xpath: \"/data/not/in/form[/data/text1] = /data/text2\",\n                },\n                {\n                    path: \"/data/not/in/form[#form/text1 = /data/also/not/in/form[#form/text2]] = #form/text2\",\n                    hashtags: [\"#form/text1\", \"#form/text2\"],\n                    xpath: \"/data/not/in/form[/data/text1 = /data/also/not/in/form[/data/text2]] = /data/text2\",\n                },\n            ],\n            incorrectHashtags = [\n                {\n                    path: \"#wtf/mate\",\n                    hashtags: [],\n                },\n                {\n                    path: \"#wtf/mate[filter=filter]\",\n                    hashtags: [],\n                },\n            ],\n            hashtagMap = {\n                \"#form/text1\": \"/data/text1\",\n                \"#form/text2\": \"/data/text2\",\n            },\n            hashtagInfo = {\n                hashtagMap: hashtagMap,\n                invertedHashtagMap: _.invert(hashtagMap),\n                hashtagNamespaces: {form: true},\n            },\n            xpathParser = xpath.createParser(xpath.makeXPathModels(hashtagInfo));\n\n            function compareHashtags(expr, expected) {\n                var tags = _.map(expr.getHashtags(), getHashtags);\n                assert.includeMembers(tags, expected.hashtags);\n            }\n\n            _.each(hashtags, function(hashtag) {\n                var logicExpr = new logic.LogicExpression(hashtag.path, xpathParser);\n\n                it(\"should return all hashtags: \" + hashtag.path, function() {\n                    compareHashtags(logicExpr, hashtag);\n                });\n\n                it(\"should translate \" + hashtag.path + \" to \" + hashtag.xpath, function() {\n                    assert.strictEqual(logicExpr.parsed.toXPath(), hashtag.xpath);\n                });\n            });\n\n            _.each(incorrectHashtags, function (hashtag) {\n                var logicExpr = new logic.LogicExpression(hashtag.path, xpathParser);\n\n                it(\"should return all hashtags: \" + hashtag.path, function() {\n                    compareHashtags(logicExpr, hashtag);\n                });\n\n                it(\"should not be able to translate \" + hashtag.path, function() {\n                    // filtered hashtags will add an error and not parse\n                    if (!logicExpr.error) {\n                        assert.throws(logicExpr.parsed.toXPath, /translate the hashtag/);\n                    }\n                });\n            });\n        });\n    });\n});\n","define([\n    'tests/options',\n    'tests/utils',\n    'vellum/util',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/form',\n    'static/markdown/markdown-test.xml',\n    'static/markdown/simple-markdown.xml',\n    'static/markdown/simple-markdown-no-chars.xml',\n    'static/markdown/no-markdown.xml',\n    'static/markdown/no-markdown-stars.xml',\n    'static/markdown/explicit-no-markdown.xml',\n    'static/markdown/markdown-output-value.xml'\n], function (\n    options,\n    util,\n    vellumUtil,\n    chai,\n    $,\n    _,\n    form,\n    MARKDOWN_TEST_XML,\n    SIMPLE_MARKDOWN_XML,\n    SIMPLE_MARKDOWN_NO_CHARS_XML,\n    NO_MARKDOWN_XML,\n    NO_MARKDOWN_STARS_XML,\n    EXPLICIT_NO_MARKDOWN_XML,\n    MARKDOWN_OUTPUT_VALUE_XML\n) {\n    var assert = chai.assert,\n        call = util.call,\n        markdownVisible = util.markdownVisible;\n\n    function toggleMarkdown() {\n        $('.markdown-trigger').first().click();\n    }\n\n    describe(\"The markdown widget\", function () {\n        function beforeFn(done) {\n            util.init({\n                javaRosa: {langs: ['en', 'hin']},\n                core: {onReady: function () { done(); }},\n                features: {rich_text: false},\n            });\n        }\n        before(beforeFn);\n\n        it(\"should parse form that has markdown\", function() {\n            util.loadXML(MARKDOWN_TEST_XML);\n            var mug = util.getMug('/data/markdown_question');\n            assert(mug.p.labelItext.hasMarkdown);\n        });\n\n        it(\"should use the markdown form when there are conflicting strings\", function() {\n            util.loadXML(MARKDOWN_TEST_XML);\n            var mug = util.getMug('/data/markdown_question');\n            assert.strictEqual(mug.p.labelItext.get(), \"**some markdown**\");\n        });\n\n        describe(\"when a user has not defined markdown usage\", function() {\n            it(\"should not show markdown with nothing in the text\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                assert(!markdownVisible());\n            });\n\n            it(\"should allow turning off markdown if markdown characters are input\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                $('[name=itext-en-label]').val(\"**markdown**\").change();\n                assert(markdownVisible());\n                $('.markdown-trigger').first().click();\n                assert(!markdownVisible());\n            });\n\n            it(\"should not show markdown if non markdown characters are not input\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                assert(!markdownVisible());\n                $('[name=itext-en-label]').val(\"no markdown here\").change();\n                assert(!markdownVisible());\n            });\n\n            it(\"should write any markdown if markdown characters are input\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                $('[name=itext-en-label]').val(\"**some markdown**\").change();\n                util.assertXmlEqual(call('createXML'), SIMPLE_MARKDOWN_XML, {normalize_xmlns: true});\n            });\n\n            it(\"should not write any markdown if markdown characters are not input\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                $('[name=itext-en-label]').val(\"no markdown\").change();\n                util.assertXmlEqual(call('createXML'), NO_MARKDOWN_XML, {normalize_xmlns: true});\n            });\n\n            it(\"should support ordered list with parens\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                $('[name=itext-en-label]').val(\"1) first\\n 2) second\").change();\n                assert(markdownVisible());\n            });\n\n            it(\"should write /data/ to output value\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                $('[name=itext-en-label]').val(\"**some markdown**\").change();\n                util.addQuestion(\"Text\", 'question1');\n                $('[name=itext-en-label]').val(\"* \").change();\n                var label = $(\"[name=itext-en-label]\"),\n                    tree = $(\".fd-question-tree\").jstree(true);\n                vellumUtil.setCaretPosition(label[0], 2);\n                util.findNode(tree, \"**some markdown**\").data.handleDrop(label);\n                util.assertXmlEqual(call('createXML'), MARKDOWN_OUTPUT_VALUE_XML, {normalize_xmlns: true});\n            });\n        });\n\n        describe(\"when a user explicitly wants no markdown\", function() {\n            beforeEach(function (done) {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                $('[name=itext-en-label]').val(\"**no markdown**\").change();\n                toggleMarkdown();\n                done();\n            });\n\n            it(\"should not show markdown when there are markdown characters\", function() {\n                assert(!markdownVisible());\n                $('[name=itext-en-label]').val(\"~~more markdown~~\").change();\n                assert(!markdownVisible());\n            });\n\n            it(\"should allow re-enabling markdown\", function() {\n                toggleMarkdown();\n                assert(markdownVisible());\n            });\n\n            it(\"should not write any markdown\", function() {\n                util.assertXmlEqual(call('createXML'), NO_MARKDOWN_STARS_XML, {normalize_xmlns: true});\n            });\n\n            it(\"should activate the save button\", function() {\n                assert(util.saveButtonEnabled(), \"save button is disabled\");\n            });\n        });\n\n        describe(\"when a user explicitly wants markdown\", function() {\n            function beforeFn(done) {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'markdown_question');\n                $('[name=itext-en-label]').val(\"**some markdown**\").change();\n                toggleMarkdown();\n                toggleMarkdown();\n                done();\n            }\n            beforeEach(beforeFn);\n\n            it(\"should show markdown when there are no markdown characters\", function () {\n                $('[name=itext-en-label]').val(\"some markdown\").change();\n                assert(markdownVisible());\n            });\n\n            it(\"should allow turning off markdown\", function() {\n                assert(markdownVisible());\n                toggleMarkdown();\n                assert(!markdownVisible());\n            });\n\n            it(\"should write markdown even if there are no markdown characters\", function() {\n                $('[name=itext-en-label]').val(\"some markdown\").change();\n                util.assertXmlEqual(call('createXML'), SIMPLE_MARKDOWN_NO_CHARS_XML, {normalize_xmlns: true});\n            });\n\n            it(\"should activate the save button\", function() {\n                assert(util.saveButtonEnabled(), \"save button is disabled\");\n            });\n        });\n\n        it(\"should not include markdown with vellum:ignore='markdown'\", function() {\n            util.loadXML(EXPLICIT_NO_MARKDOWN_XML);\n            util.assertXmlEqual(call('createXML'), EXPLICIT_NO_MARKDOWN_XML);\n        });\n\n        it(\"should remove markdown when no markdown is specified\", function() {\n            var form = util.loadXML(SIMPLE_MARKDOWN_XML);\n            form.noMarkdown = true;\n            util.assertXmlEqual(call('createXML'), EXPLICIT_NO_MARKDOWN_XML);\n        });\n    });\n});\n","define([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'static/modeliteration/case-list-iteration.xml',\n    'static/modeliteration/case-list-iteration-with-questions.xml',\n    'static/modeliteration/case-list-iteration-with-questions-and-hidden-value.xml',\n    'static/modeliteration/fixture-iteration.xml',\n    'static/modeliteration/regular-repeat.xml',\n    'tests/modeliteration'\n], function (\n    chai,\n    $,\n    _,\n    util,\n    CASE_LIST_REPEAT_XML,\n    CASE_LIST_REPEAT_WITH_QUESTIONS_XML,\n    CASE_LIST_REPEAT_WITH_QUESTIONS_AND_HIDDEN_XML,\n    FIXTURE_REPEAT_XML,\n    REGULAR_REPEAT_XML\n) {\n    var assert = chai.assert,\n        call = util.call,\n        plugins = util.options.options.plugins || [],\n        pluginsWithModelIteration = _.union(plugins, [\"modeliteration\"]);\n\n    describe(\"The model iteration plugin\", function () {\n        before(function (done) {\n            util.init({\n                plugins: pluginsWithModelIteration,\n                javaRosa: { langs: ['en'] },\n                core: {\n                    onReady: function () {\n                        assert(this.isPluginEnabled(\"modeliteration\"),\n                               \"modeliteration plugin should be enabled\");\n                        done();\n                    }\n                }\n            });\n        });\n\n        it(\"should load a case list repeat\", function () {\n            util.loadXML(CASE_LIST_REPEAT_XML);\n            var repeat = util.getMug(\"child/item\");\n            assert.deepEqual(repeat.p.dataSource, {\n                instance: {id: \"casedb\", src: \"jr://instance/casedb\"},\n                idsQuery: \"instance('casedb')/mother/child/@case_id\"\n            });\n            util.assertXmlEqual(call(\"createXML\"), CASE_LIST_REPEAT_XML);\n        });\n\n        it(\"should load a case list repeat with questions\", function () {\n            util.loadXML(CASE_LIST_REPEAT_WITH_QUESTIONS_XML);\n            util.assertJSTreeState(\n                \"group\",\n                \"  phone\",\n                \"  hidden\"\n            );\n            var repeat = util.getMug(\"group/item\"),\n                phone = util.getMug(\"group/item/phone\"),\n                hidden = util.getMug(\"group/item/hidden\");\n            assert.deepEqual(repeat.p.dataSource, {\n                instance: {id: \"casedb\", src: \"jr://instance/casedb\"},\n                idsQuery: \"instance('casedb')/mother/child/@case_id\"\n            });\n            assert.equal(phone.__className, \"PhoneNumber\");\n            assert.equal(hidden.p.calculateAttr, \"#form/group/item/phone = '12345'\");\n            util.assertXmlEqual(call(\"createXML\"), CASE_LIST_REPEAT_WITH_QUESTIONS_XML);\n        });\n\n\n        it(\"should write setvalues in order of question tree\", function () {\n            util.loadXML(CASE_LIST_REPEAT_WITH_QUESTIONS_AND_HIDDEN_XML);\n            util.assertJSTreeState(\n                \"hidden\",\n                \"group\",\n                \"  phone\",\n                \"  hidden\"\n            );\n            util.assertXmlEqual(call(\"createXML\"), CASE_LIST_REPEAT_WITH_QUESTIONS_AND_HIDDEN_XML);\n        });\n\n        it(\"should create a case list repeat\", function () {\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", \"child\");\n            repeat.p.dataSource = {\n                instance: {id: \"casedb\", src: \"jr://instance/casedb\"},\n                idsQuery: \"instance('casedb')/mother/child/@case_id\"\n            };\n            util.assertXmlEqual(call(\"createXML\"), CASE_LIST_REPEAT_XML,\n                                {normalize_xmlns: true});\n        });\n\n        it(\"should create a case list repeat with questions\", function () {\n            util.loadXML(\"\");\n            var group = util.addQuestion(\"Repeat\", \"group\");\n            group.p.dataSource = {\n                instance: {id: \"casedb\", src: \"jr://instance/casedb\"},\n                idsQuery: \"instance('casedb')/mother/child/@case_id\"\n            };\n            util.addQuestion(\"PhoneNumber\", \"phone\");\n            var hidden = util.addQuestion(\"DataBindOnly\", \"hidden\");\n            hidden.p.calculateAttr = \"/data/group/item/phone = '12345'\";\n            util.assertXmlEqual(call(\"createXML\"), CASE_LIST_REPEAT_WITH_QUESTIONS_XML,\n                                {normalize_xmlns: true});\n        });\n\n        it(\"should load a fixture repeat\", function () {\n            util.loadXML(FIXTURE_REPEAT_XML);\n            var repeat = util.getMug(\"product/item\");\n            assert.deepEqual(repeat.p.dataSource, {\n                instance: {id: \"products\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('products')/products/product/@id\"\n            });\n            util.assertXmlEqual(call(\"createXML\"), FIXTURE_REPEAT_XML);\n        });\n\n        it(\"should create a fixture repeat\", function () {\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", \"product\");\n            repeat.p.dataSource = {\n                instance: {id: \"products\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('products')/products/product/@id\"\n            };\n            util.assertXmlEqual(call(\"createXML\"), FIXTURE_REPEAT_XML,\n                                {normalize_xmlns: true});\n        });\n\n        it(\"should convert fixture repeat to regular repeat when data source is removed\", function () {\n            util.loadXML(FIXTURE_REPEAT_XML);\n            var repeat = util.getMug(\"product/item\");\n            repeat.p.dataSource = {};\n            repeat.p.repeat_count = \"\";\n            util.assertXmlEqual(call(\"createXML\"), REGULAR_REPEAT_XML);\n        });\n\n        it(\"should create a fixture repeat containing a text input\", function () {\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", \"product\");\n            repeat.p.dataSource = {\n                instance: {id: \"products\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('products')/products/product/@id\"\n            };\n            util.addQuestion(\"Text\", \"text\");\n            util.assertJSTreeState(\n                \"product\",\n                \"  text\"\n            );\n        });\n\n        it(\"should change a fixture repeat to a case list repeat\", function () {\n            util.loadXML(FIXTURE_REPEAT_XML);\n            var repeat = util.getMug(\"product/item\");\n            repeat.p.dataSource = {\n                instance: {id: \"casedb\", src: \"jr://instance/casedb\"},\n                idsQuery: \"instance('casedb')/mother/child/@case_id\"\n            };\n            util.assertXmlEqual(call(\"createXML\").replace(/product/g, \"child\"),\n                                CASE_LIST_REPEAT_XML);\n        });\n\n        it(\"should not remove instance when ignore/retain is active\", function () {\n            var normal = '<bind vellum:nodeset=\"#form/product/item\" nodeset=\"/data/product/item\" />',\n                ignore = '<bind vellum:nodeset=\"#form/product/item\" nodeset=\"/data/product/item\" wierd=\"true()\" vellum:ignore=\"retain\" />',\n                xml = FIXTURE_REPEAT_XML.replace(normal, normal + ignore);\n            assert(xml.indexOf(ignore) > 0, ignore + \" not found in XML:\\n\\n\" + xml);\n            util.loadXML(xml);\n            var repeat = util.getMug(\"product/item\");\n            repeat.p.dataSource = {};\n            repeat.p.repeat_count = \"\";\n            xml = call(\"createXML\");\n            assert(util.parseXML(xml).find(\"instance[id=products]\").length === 1,\n                   \"products instance not found in XML\\n\\n\" + xml);\n        });\n\n        it(\"should not write duplicate <setvalue> nodes after rename\", function () {\n            // add question, save, rename, save, should not have two sets of <setvalue>s\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", \"product\");\n            repeat.p.dataSource = {\n                instance: {id: \"casedb\", src: \"jr://instance/casedb\"},\n                idsQuery: \"instance('casedb')/mother/child/@case_id\"\n            };\n            var xml = call(\"createXML\"),\n                firstCount = util.parseXML(xml).find(\"setvalue\").length;\n            repeat.p.nodeID = \"group\";\n            xml = call(\"createXML\");\n            assert.equal(util.parseXML(xml).find(\"setvalue\").length, firstCount,\n                         \"wrong number of <setvalue> nodes\\n\\n\" + xml);\n        });\n\n        it(\"should drop setvalue nodes on delete model repeat\", function () {\n            // add question, save, rename, save, should not have two sets of <setvalue>s\n            util.loadXML(FIXTURE_REPEAT_XML);\n            util.deleteQuestion(\"product/item\");\n            var xml = call(\"createXML\");\n            assert.equal(util.parseXML(xml).find(\"setvalue\").length, 0,\n                         \"wrong number of <setvalue> nodes\\n\\n\" + xml);\n        });\n\n        it(\"should update expressions on set data source\", function () {\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", \"product\"),\n                blue = util.addQuestion(\"Text\", \"blue\"),\n                text = util.addQuestion(\"Text\", \"text\"),\n                getPath = blue.form.getAbsolutePath.bind(blue.form);\n            assert.equal(blue.hashtagPath, \"#form/product/blue\");\n            assert.equal(text.hashtagPath, \"#form/product/text\");\n            text.p.calculateAttr = blue.hashtagPath;\n            blue.p.labelItext.set('<output value=\"' + text.hashtagPath + '\"/>');\n            blue.validate(\"labelItext\");\n            repeat.p.dataSource = {\n                instance: {id: \"casedb\", src: \"jr://instance/casedb\"},\n                idsQuery: \"instance('casedb')/mother/child/@case_id\"\n            };\n            var xml = util.parseXML(call(\"createXML\"));\n            assert.equal(blue.hashtagPath, \"#form/product/item/blue\");\n            assert.equal(text.hashtagPath, \"#form/product/item/text\");\n            var textBind = xml.find(\"bind[nodeset='\" + getPath(text) + \"']\");\n            assert.equal(\n                textBind.attr(\"calculate\"),\n                \"/data/product/item/blue\",\n                textBind.attr(\"nodeset\") + \" calculate expression mismatch\");\n            assert.equal(xml.find(\"output:first\").attr(\"value\"),\n                         \"/data/product/item/text\",\n                         \"output value mismatch\");\n            var errors = _.flatten(_.map([blue, text], function (mug) {\n                    return mug.getErrors();\n                }));\n            assert(!errors.length, errors.join(\"\\n\"));\n        });\n\n        it(\"should update expressions on clear data source\", function () {\n            util.loadXML(\"\");\n            var repeat = util.addQuestion(\"Repeat\", \"product\");\n            repeat.p.dataSource = {\n                instance: {id: \"casedb\", src: \"jr://instance/casedb\"},\n                idsQuery: \"instance('casedb')/mother/child/@case_id\"\n            };\n            var blue = util.addQuestion(\"Text\", \"blue\"),\n                text = util.addQuestion(\"Text\", \"text\");\n            text.p.calculateAttr = blue.hashtagPath;\n            blue.p.labelItext.set('<output value=\"' + text.hashtagPath + '\"/>');\n            blue.validate(\"labelItext\");\n            assert.equal(blue.hashtagPath, \"#form/product/item/blue\");\n            assert.equal(text.hashtagPath, \"#form/product/item/text\");\n\n            repeat.p.dataSource = {};\n            assert.equal(blue.hashtagPath, \"#form/product/blue\");\n            assert.equal(text.hashtagPath, \"#form/product/text\");\n            var xml = util.parseXML(call(\"createXML\")),\n                textBind = xml.find(\"bind[nodeset='\" + text.absolutePath + \"']\");\n            assert.equal(\n                textBind.attr(\"calculate\"),\n                \"/data/product/blue\",\n                textBind.attr(\"nodeset\") + \" calculate expression mismatch\");\n            assert.equal(xml.find(\"output:first\").attr(\"value\"),\n                         \"/data/product/text\",\n                         \"output value mismatch\");\n            var errors = _.flatten(_.map([blue, text], function (mug) {\n                    return mug.getErrors();\n                }));\n            assert(!errors.length, errors.join(\"\\n\"));\n        });\n\n        it(\"should show repeat count for regular repeat\", function () {\n            util.loadXML(REGULAR_REPEAT_XML);\n            util.clickQuestion(\"product\");\n            // not ideal: references UI\n            assert.equal($(\"[name=property-repeat_count]\").length, 1,\n                         \"repeat count should be visible for regular repeat\");\n        });\n\n        it(\"should hide repeat count for model repeat\", function () {\n            util.loadXML(FIXTURE_REPEAT_XML);\n            util.clickQuestion(\"product/item\");\n            // not ideal: references UI\n            assert.equal($(\"[name=property-repeat_count]\").length, 0,\n                         \"repeat count should not be visible for model repeat\");\n        });\n\n        it(\"should change instance name when editing its sole reference\", function () {\n            util.loadXML(FIXTURE_REPEAT_XML);\n            var repeat = util.getMug(\"product/item\");\n            assert.equal(repeat.p.dataSource.instance.id, \"products\");\n            repeat.p.dataSource = {\n                instance: {id: \"new-name\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('new-name')/products/product/@id\"\n            };\n            // name should be updated to match existing instance\n            assert.deepEqual(repeat.p.dataSource, {\n                instance: {id: \"new-name\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('new-name')/products/product/@id\"\n            });\n        });\n\n        it(\"should change instance when idsQuery changes\", function () {\n            var form = util.loadXML(FIXTURE_REPEAT_XML),\n                repeat = util.getMug(\"product/item\");\n            form.updateKnownInstances({\"foo\": \"jr://foo\"});\n            repeat.p.dataSource = {\n                idsQuery: \"instance('foo')/products/product/@id\"\n            };\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml);\n            assert($xml.find(\"instance[id=foo]\").length,\n                   \"foo instance not found:\\n\" + xml);\n            assert.equal($xml.find(\"instance[id=products]\").length, 0,\n                   \"somefixture instance not found:\\n\" + xml);\n        });\n\n        it(\"should sync instance name with existing instance\", function () {\n            util.loadXML(FIXTURE_REPEAT_XML);\n            var repeat = util.getMug(\"product/item\"),\n                repeat2 = util.addQuestion(\"Repeat\", \"product2\");\n            repeat2.p.dataSource = {\n                instance: {id: \"products\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('products')/products/product/@id\"\n            };\n            assert.equal(repeat.p.dataSource.instance.id, \"products\");\n            assert.equal(repeat2.p.dataSource.instance.id, \"products\");\n            repeat.p.dataSource = {\n                instance: {id: \"new-name\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('new-name')/products/product/@id\"\n            };\n            // name should be reverted to match existing instance\n            // TODO Maybe all references to the instance should be updated\n            // when it is renamed for any question? (more user-friendly, but\n            // hard to implement). Currently it is very hard to rename an\n            // instance (without editing XML directly) if there are multiple\n            // questions in the form referencing the instance.\n            assert.deepEqual(repeat.p.dataSource, {\n                instance: {id: \"products\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('products')/products/product/@id\"\n            });\n        });\n\n        it(\"should use jr-insert event for nested model iteration setvalues\", function () {\n            util.loadXML(FIXTURE_REPEAT_XML);\n            var nested = util.addQuestion.bind({prevId: \"product/item\"})(\"Repeat\", \"nested\");\n            nested.p.dataSource = {\n                instance: {id: \"products\", src: \"jr://fixture/commtrack:products\"},\n                idsQuery: \"instance('products')/products/product/@id\"\n            };\n            var xml = call('createXML'),\n                $xml = util.parseXML(xml),\n                ref = \"setvalue[ref='/data/product/\";\n            assert.equal($xml.find(ref + \"@ids']\").attr(\"event\"), \"xforms-ready\",\n                   \"wrong setvalue event for outer repeat: \" + xml);\n            assert.equal($xml.find(ref + \"item/nested/@ids']\").attr(\"event\"), \"jr-insert\",\n                   \"wrong setvalue event for nested repeat: \" + xml);\n        });\n    });\n});\n","define([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'static/mugs/blank-choice.xml',\n], function (\n    util,\n    chai,\n    $,\n    _,\n    BLANK_CHOICE_XML\n) {\n    var assert = chai.assert;\n\n    describe(\"Mugs\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"should coalesce change events inside _withMessages\", function() {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\"),\n                id = 1,\n                changes = 0,\n                changed;\n            mug.on(\"messages-changed\", function () {\n                changes += 1;\n            });\n            function msg() {\n                mug.addMessage(null, {\n                    key: \"test-message\",\n                    level: mug.ERROR,\n                    message: \"testing \" + id++,\n                });\n            }\n\n            assert.equal(changes, 0);\n            changed = mug._withMessages(function () {\n                msg();\n                msg();\n                assert.equal(changes, 0);\n            });\n            assert(changed, \"not changed!\");\n            assert.equal(changes, 1);\n\n            msg();\n            msg();\n            assert.equal(changes, 3);\n        });\n\n        it(\"at the top level should not be named meta\", function() {\n            var data = [\n                    [\"id\", \"type\"],\n                    [\"meta\", \"Group\"],\n                    [\"meta/meta\", \"Text\"],\n                    [\"group\", \"Group\"],\n                    [\"group/meta\", \"Group\"],\n                ];\n            util.loadXML(\"\");\n            util.paste(data);\n            _.each(data.slice(1), function (row) {\n                var mug = util.getMug(row[0]),\n                    messages = mug.messages.get(\"nodeID\");\n                if (/\\bmeta$/.test(mug.p.nodeID)) {\n                    assert.deepEqual(messages, [\"'meta' is not a valid Question ID.\"]);\n                } else {\n                    assert.deepEqual(messages, []);\n                }\n            });\n        });\n\n        it(\"should have a function to tell if referenced by other mugs\", function () {\n            var data = [\n                    [\"id\", \"type\", \"relevantAttr\"],\n                    [\"red\", \"Text\", \"\"],\n                    [\"blue\", \"Text\", \"#form/red = '1'\"],\n                ];\n            util.loadXML(\"\");\n            util.paste(data);\n            var red = util.getMug(\"red\"),\n                blue = util.getMug(\"blue\");\n            assert.isNotOk(blue.isReferencedByOtherMugs(), \"blue should not be referenced\");\n            assert.isOk(red.isReferencedByOtherMugs(), \"red should be referenced\");\n            assert.isNotOk(red.isReferencedByOtherMugs([blue]),\n                \"red with except=[blue] should not be referenced\");\n        });\n\n        it(\"should not default choice label to node ID\", function () {\n            util.loadXML(BLANK_CHOICE_XML);\n            var blank = util.getMug(\"select/blank\");\n            assert.equal(blank.p.labelItext.get(), \"\", \"blank label itext\");\n        });\n    });\n});\n","define([\"underscore\"], function (_) {\n    var dataSources = [\n        {\n            id: \"commcaresession\",\n            uri: \"jr://instance/session\",\n            path: \"/session\",\n            name: 'Session',\n            structure: {\n                data: {\n                    merge: true,\n                    structure: {\n                        \"case_id\": {\n                            reference: {\n                                hashtag: \"#case\",\n                                source: \"casedb\",\n                                subset: \"case\",\n                                subset_key: \"@case_type\",\n                                key: \"@case_id\",\n                            },\n                        },\n                    },\n                },\n                context: {\n                    merge: true,\n                    structure: {\n                        \"userid\": {\n                            reference: {\n                                hashtag: \"#user\",\n                                source: \"casedb\",\n                                subset: \"commcare-user\",\n                                subset_key: \"@case_type\",\n                                subset_filter: true,\n                                key: \"hq_user_id\",\n                            },\n                        },\n                    },\n                },\n            },\n        }, {\n            id: \"casedb\",\n            uri: \"jr://instance/casedb\",\n            path: \"/cases/case\",\n            name: 'Cases',\n            structure: {\n                name: {},\n            },\n            subsets: [{\n                id: \"grandparent\",\n                name: \"grandparent (household)\",\n                key: \"@case_type\",\n                structure: {\n                    address: {},\n                }\n            }, {\n                id: \"parent\",\n                name: \"parent (mother)\",\n                key: \"@case_type\",\n                structure: {\n                    edd: {},\n                },\n                related: {\n                    parent: {\n                        hashtag: \"#case/grandparent\",\n                        subset: \"grandparent\",\n                        subset_key: \"@case_type\",\n                        key: \"@case_id\",\n                    }\n                }\n            }, {\n                id: \"commcare-user\",\n                name: \"user\",\n                key: \"@case_type\",\n                structure: {\n                    role: {},\n                    username: {},\n                }\n            }, {\n                id: \"case\",\n                name: \"case (child)\",\n                key: \"@case_type\",\n                structure: {\n                    dob: {description: \"Date of Birth\"},\n                    long: {description: \"Property with a_very_long_word_in_the_description_that_exceeds_43_chars\"},\n                    f_0762: {},\n                    f_1065: {},\n                    f_1089: {},\n                    f_2685: {},\n                    f_2841: {},\n                    f_3017: {},\n                    f_3280: {},\n                    f_3291: {},\n                    f_3605: {},\n                    f_4021: {},\n                    f_4793: {},\n                    f_5683: {},\n                    f_6103: {},\n                    f_6542: {},\n                    f_6819: {},\n                    f_6912: {},\n                    f_7346: {},\n                    f_7541: {},\n                    f_8612: {},\n                    f_8967: {},\n                    f_8970: {},\n                    f_9147: {},\n                    f_9814: {},\n                },\n                related: {\n                    parent: {\n                        hashtag: \"#case/parent\",\n                        subset: \"parent\",\n                        subset_key: \"@case_type\",\n                        key: \"@case_id\",\n                    }\n                },\n            }]\n        }, {\n            id: \"some-fixture\",\n            uri: \"jr://fixture/item-list:some-fixture\",\n            path: \"/some-fixture_list/some-fixture\",\n            name: 'some-fixture-name',\n            structure: {\n                \"inner-attribute\": {\n                    structure: {\n                        \"extra-inner-attribute\": {}\n                    }\n                },\n                \"@id\": {\n                    no_option: true\n                },\n                name: {\n                    no_option: true\n                }\n            }\n        }, {\n            id: \"some-other-fixture\",\n            uri: \"jr://fixture/item-list:some-other-fixture\",\n            path: \"/some-other-fixture_list/some-other-fixture\",\n            name: 'some-other-fixture-name',\n            structure: {\n                \"other-inner-attribute\": {\n                    no_option: true\n                },\n                \"@id-other\": {\n                    no_option: true\n                },\n                \"name-other\": {\n                    no_option: true\n                }\n            }\n        },\n    ];\n\n    var OPTIONS = {\n        core: {\n            loadDelay: 0,\n            formName: \"Untitled Form\",\n            allowedDataNodeReferences: [\n                \"meta/deviceID\",\n                \"meta/instanceID\",\n                \"meta/username\",\n                \"meta/userID\",\n                \"meta/timeStart\",\n                \"meta/timeEnd\",\n                \"meta/location\",\n            ],\n            dataSourcesEndpoint: function (callback) { callback(dataSources); },\n            invalidCaseProperties: ['name'],\n            saveType: \"patch\",\n            saveUrl: function (data) {},\n            activityUrl: null,               // may be function or URL string\n            activityTimeout: 5 * 60 * 1000,  // 5 minutes in milliseconds\n            externalLinks: {\n                changeSubscription: \"#\",\n            },\n        },\n        javaRosa: {\n            langs: ['en', 'hin'],\n            displayLanguage: 'en'\n        },\n        intents: {\n            templates: [\n                {\n                    icon: \"fa-solid fa-location-dot\",\n                    name: \"Area Mapper\",\n                    id: \"com.richard.lu.areamapper\",\n                    extra: {ext: \"value\"},\n                    response: {\n                        r1: \"x\",\n                        r2: \"y\",\n                        r3: \"z\",\n                        r4: \"\",\n                    },\n                },\n                {\n                    icon: \"fa fa-barcode\",\n                    name: \"Barcode Scanner\",\n                    id: \"com.google.zxing.client.android.SCAN\",\n                    extra: {},\n                    response: {},\n                },\n                {\n                    icon: \"icon-vellum-android-intent\",\n                    name: \"Breath Counter\",\n                    id: \"org.commcare.respiratory.BREATHCOUNT\",\n                },\n                {\n                    icon: \"icon-vellum-android-intent\",\n                    name: \"Fingerprint Scanner\",\n                    id: \"com.simprints.id.REGISTER\",\n                    mime: \"text/plain\",\n                },\n            ],\n        },\n        itemset: {\n            dataSourcesFilter: function (sources) {\n                return _.filter(sources, function (source) {\n                    return !source.uri || /^jr:\\/\\/fixture\\//.test(source.uri);\n                });\n            }\n        },\n        uploader: {\n            uploadUrls: {\n                image: 'foo',\n                audio: 'foo',\n                video: 'foo'\n            },\n            objectMap: {}\n        },\n        plugins: [\n            'databrowser',\n            'itemset',\n            'modeliteration',\n            'commtrack',\n            'saveToCase',\n            'commcareConnect',\n            'atwho',\n        ],\n        features: {\n            // 'remove_popvers': false, // disabled for most tests\n            'full_save_on_missing_conflict_xform': true,\n            'lookup_tables': true,\n            'group_in_field_list': true,\n            'rich_text': true,\n            'advanced_itemsets': true,\n            'sorted_itemsets': true,\n            'printing': true,\n            'templated_intents': true,\n            'custom_intents': true,\n            'image_resize': true,\n            'markdown_in_groups': true,\n            'allow_data_reference_in_setvalue': true,\n            'allow_bulk_form_actions': true,\n        }\n    };\n\n    return {\n        options: OPTIONS,\n        dataSources: dataSources,\n    };\n});\n","/*jshint multistr: true */\ndefine([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'vellum/parser',\n    'vellum/xml',\n    'static/parser/accent-char-in-path.xml',\n    'static/parser/body-group.xml',\n    'static/parser/other_item.xml',\n    'static/parser/label-without-itext.xml',\n    'static/parser/missing-bind.xml',\n    'static/parser/test-xml-1.xml',\n    'static/parser/test-xml-2.xml',\n    'static/parser/override.xml',\n    'static/parser/overridden.xml',\n    'static/parser/first-time-hashtag.xml',\n    'static/parser/repeat-with-count-as-question-only-form.xml',\n    'static/writer/repeat-with-count-as-question.xml',\n    'static/parser/required.xml',\n], function (\n    chai,\n    $,\n    _,\n    util,\n    parser,\n    xml,\n    ACCENT_CHAR_IN_PATH_XML,\n    BODY_GROUP,\n    OTHER_ITEM_XML,\n    LABEL_WITHOUT_ITEXT_XML,\n    MISSING_BIND_XML,\n    TEST_XML_1,\n    TEST_XML_2,\n    OVERRIDE_XML,\n    OVERRIDDEN_XML,\n    FIRST_TIME_HASHTAG_XML,\n    REPEAT_WITH_COUNT_AS_QUESTION_ONLY_FORM_XML,\n    REPEAT_WITH_COUNT_AS_QUESTION_XML,\n    REQUIRED_XML\n) {\n    var assert = chai.assert,\n        call = util.call,\n        plugins = util.options.options.plugins || [],\n        pluginsWithItemset = _.union(plugins, [\"itemset\"]),\n        pluginsWithoutItemset = _(plugins).without(\"itemset\");\n\n    describe(\"The parser\", function () {\n        it(\"can detect when the itemset plugin is enabled\", function (done) {\n            util.init({\n                plugins: pluginsWithItemset,\n                core: {\n                    onReady: function () {\n                        assert(this.isPluginEnabled(\"itemset\"),\n                               \"itemset plugin should be enabled\");\n                        done();\n                    }\n                },\n            });\n        });\n\n        it(\"can detect when the itemset plugin is disabled\", function (done) {\n            util.init({\n                plugins: pluginsWithoutItemset,\n                core: {\n                    onReady: function () {\n                        assert(!this.isPluginEnabled(\"itemset\"),\n                               \"itemset plugin should be disabled\");\n                        done();\n                    }\n                },\n            });\n        });\n\n        it(\"should gracefully handle itemset when the itemset plugin is disabled\", function (done) {\n            util.init({\n                plugins: pluginsWithoutItemset,\n                core: {\n                    form: TEST_XML_1,\n                    onReady: function () {\n                        var mug = call(\"getMugByPath\", \"/data/state\");\n                        assert.equal(mug.__className, \"Select\");\n                        var xml = call(\"createXML\"),\n                            doc = util.parseXML(xml);\n                        assert.equal(doc.find(\"instance[id=states]\").length, 1, xml);\n                        assert.equal(doc.find('itemset').attr('nodeset'),\n                                     \"instance('states')/state_list/state\");\n                        done();\n                    }\n                },\n            });\n        });\n\n        it(\"should not drop newlines in calculate conditions\", function () {\n            util.loadXML(TEST_XML_2);\n            var mug = call(\"getMugByPath\", \"/data/question1\");\n            assert.equal(mug.p.calculateAttr, 'concat(\"Line 1\", \"\\nLine 2\")');\n        });\n\n        var ignoreWarnings = /Form (JRM namespace|does not have a (Name|(UI)?Version))/;\n\n        it(\"should load select item without itext\", function () {\n            util.loadXML(OTHER_ITEM_XML, null, ignoreWarnings);\n            var mug = call(\"getMugByPath\", \"/ClassroomObservationV3/Q0003\"),\n                // HACK how to reference items in select?\n                item = mug._node_control.children[1].value;\n            assert.equal(item.p.nodeID, 'other');\n        });\n\n        it(\"should un-escape HTML entities in select item\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", \"select\");\n            var choice = util.addQuestion(\"Choice\", \"choice\");\n            choice.p.nodeID = 'a&b<c';\n            var xml = util.call(\"createXML\");\n            assert.include(util.call(\"createXML\"), 'a&amp;b&lt;c');\n            util.loadXML(xml);\n            var select = util.getMug(\"select\");\n            choice = select.form.getChildren(select)[0];\n            assert.equal(choice.p.nodeID, \"a&b<c\");\n        });\n\n        it(\"should load mugs with relative paths and label without itext\", function () {\n            util.loadXML(LABEL_WITHOUT_ITEXT_XML, null, ignoreWarnings);\n            var grp = call(\"getMugByPath\", \"/data/group\"),\n                mug = call(\"getMugByPath\", \"/data/group/a\"),\n                txt = call(\"getMugByPath\", \"/data/text\");\n            assert.equal(grp.p.labelItext.defaultValue(), 'The group');\n            assert.equal(mug.p.labelItext.defaultValue(), 'The label');\n            assert.equal(txt.p.labelItext.defaultValue(), 'The text');\n\n            // should not raise an error\n            util.assertXmlNotEqual(call(\"createXML\"), LABEL_WITHOUT_ITEXT_XML);\n        });\n\n        it(\"should load question without bind element\", function () {\n            util.loadXML(MISSING_BIND_XML);\n        });\n\n        it(\"should load question with accent char in path\", function () {\n            util.loadXML(ACCENT_CHAR_IN_PATH_XML);\n            var mug = call(\"getMugByPath\", \"#form/tèxt\");\n            assert.match(util.getMessages(mug), /tèxt is not a valid Question ID/);\n        });\n\n        it(\"should set undefined for data value\", function () {\n            util.loadXML(MISSING_BIND_XML);\n            util.clickQuestion(\"text\");\n            assert(!$('[name=property-dataValue]').length);\n        });\n\n        it(\"should set required correctly\", function() {\n            util.loadXML(REQUIRED_XML);\n            var q1 = util.getMug(\"question1\");\n            assert(q1.p.requiredAttr, \"required is false\");\n            assert.equal(q1.p.requiredCondition, undefined);\n            assert.equal(q1.messages.get(\"requiredAttr\").length, 0, \"requiredAttr messages\");\n            assert.equal(q1.messages.get(\"requiredCondition\").length, 0, \"requiredCondition messages\");\n\n            var q2 = util.getMug(\"question2\");\n            assert(q2.p.requiredAttr, \"required is false\");\n            assert.equal(q2.p.requiredCondition, \"#form/question1 = 'hi'\");\n            assert.equal(q2.messages.get(\"requiredAttr\").length, 0, \"requiredAttr messages\");\n            assert.equal(q2.messages.get(\"requiredCondition\").length, 0, \"requiredCondition messages\");\n\n            var q3 = util.getMug(\"question3\");\n            assert(!q3.p.requiredAttr, \"requiredAttr is true\");\n            assert.equal(q3.p.requiredCondition, \"#form/question2 = 'hello'\");\n            assert.equal(q3.messages.get(\"requiredAttr\").length, 1, \"requiredAttr messages\");\n            assert.equal(q3.messages.get(\"requiredCondition\").length, 1, \"requiredCondition messages\");\n        });\n\n        it(\"should not create read-only mug for child of group named 'body'\", function () {\n            util.loadXML(BODY_GROUP);\n            util.assertJSTreeState(\n                \"body\",\n                \"  text\"\n            );\n        });\n\n        describe(\"override\", function() {\n            before(function(done) {\n                util.init({\n                    plugins: plugins,\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        onReady: function () { done(); }\n                    }\n                });\n            });\n\n            var properties = {\n                'relevantAttr': 'question2',\n                'constraintAttr': 'question2',\n                'calculateAttr': 'question3',\n            };\n\n            _.each(properties, function(question, prop) {\n                it(\"should override \" + prop + \" in question \" + question, function() {\n                    util.loadXML(OVERRIDE_XML);\n                    var mug = util.getMug(question);\n                    assert.strictEqual(mug.p[prop], \"#form/question1\");\n                });\n            });\n\n            it(\"should override correctly\", function() {\n                util.loadXML(OVERRIDE_XML);\n                util.assertXmlEqual(util.call('createXML'), OVERRIDDEN_XML);\n            });\n\n            it(\"should generate hashtags correctly on first load\", function() {\n                util.loadXML(FIRST_TIME_HASHTAG_XML);\n                util.assertXmlEqual(util.call('createXML'), OVERRIDDEN_XML);\n            });\n\n            describe(\"with two languages\", function () {\n                before(function(done) {\n                    util.init({\n                        plugins: plugins,\n                        javaRosa: {langs: ['en', 'hin']},\n                        core: {\n                            onReady: function () { done(); }\n                        }\n                    });\n                });\n                it(\"should load jr__count as jr:count\", function() {\n                    util.loadXML(REPEAT_WITH_COUNT_AS_QUESTION_ONLY_FORM_XML);\n                    util.assertXmlEqual(util.call('createXML'), REPEAT_WITH_COUNT_AS_QUESTION_XML);\n                });\n            });\n        });\n    });\n});\n","define([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/form',\n    'static/questionProperties/comment-test.xml'\n], function (\n    util,\n    chai,\n    $,\n    _,\n    form,\n    COMMENT_TEST_XML\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"Question Comments\", function() {\n        before(function(done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n            });\n        });\n\n        it(\"should parse the comment\", function() {\n            util.loadXML(COMMENT_TEST_XML);\n            var mug = util.getMug(\"/data/mug\");\n            assert.strictEqual(mug.p.comment, \"This is a comment\");\n        });\n\n        it(\"should display the comment\", function() {\n            util.loadXML(COMMENT_TEST_XML);\n            assert($('.fd-props-toolbar > .alert-info'));\n        });\n\n        it('should update comment without reloading', function () {\n            util.loadXML(COMMENT_TEST_XML);\n            assert.strictEqual($('.fd-question-comment').text(), 'This is a comment');\n            $('#property-comment').val('still a comment').change();\n            assert.strictEqual($('.fd-question-comment').text(), 'still a comment');\n        });\n\n        it(\"should write the comment\", function() {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", \"mug\");\n            mug.p.comment = \"This is a comment\";\n            util.assertXmlEqual(COMMENT_TEST_XML, call(\"createXML\"), {normalize_xmlns: true});\n        });\n\n        it(\"should not show comment the comment if there isn't one\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"mug\");\n            assert(!$('.fd-props-toolbar > .alert-info').is(':visible'));\n        });\n\n        it(\"should display a comment once it is specified\", function() {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\", \"mug\");\n            mug.p.comment = 'this is a comment';\n            assert($('.fd-props-toolbar > .alert-info').is(':visible'));\n        });\n    });\n\n    describe(\"Section Toggler\", function() {\n        before(function(done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n            });\n        });\n\n        it(\"should show and hide sections\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\");\n\n            var slug = 'logic',\n                $section = $(\".fd-question-fieldset[data-slug='\" + slug + \"']\"),\n                visible = $section.is(\":visible\"),\n                $command = $(\".fd-section-changer a[data-slug='\" + slug + \"']\");\n\n            assert.strictEqual($command.hasClass(\"selected\"), visible);\n\n            $command.click();\n            assert.strictEqual($section.is(\":visible\"), !visible);\n            assert.strictEqual($command.hasClass(\"selected\"), !visible);\n\n            $command.click();\n            assert.strictEqual($section.is(\":visible\"), visible);\n            assert.strictEqual($command.hasClass(\"selected\"), visible);\n        });\n    });\n\n    describe(\"Required Condition\", function() {\n        before(function(done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n            });\n        });\n\n        it(\"should mark mug invalid if it has a required condition without being required\", function () {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Text\");\n\n            assert(util.isTreeNodeValid(mug),\n                    \"precondition failed:\\n\" + util.getMessages(mug));\n            try {\n                mug.p.requiredCondition = \"True()\";\n                assert(mug.messages.get(\"requiredCondition\").length === 1, \"requiredCondition doesn't have error\");\n                assert(mug.messages.get(\"requiredAttr\").length === 1, \"requiredAttr doesn't have error\");\n\n                mug.p.requiredAttr = \"True()\";\n                assert(mug.messages.get(\"requiredCondition\").length === 0, \"requiredCondition has error\");\n                assert(mug.messages.get(\"requiredAttr\").length === 0, \"requiredAttr has error\");\n            } finally {\n                mug.p.requiredCondition = \"\";\n                mug.p.requiredAttr = \"\";\n            }\n        });\n\n    });\n});\n","define([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'static/all_question_types.xml',\n    'static/questionTypes/image-capture.xml',\n    'static/javaRosa/select1-help.xml',\n    'static/questionTypes/select1-help-with-type.xml',\n], function (\n    chai,\n    $,\n    _,\n    util,\n    TEST_XML,\n    IMAGE_CAPTURE_XML,\n    SELECT1_HELP_XML,\n    SELECT1_HELP_WITH_TYPE_XML\n) {\n    var call = util.call,\n        clickQuestion = util.clickQuestion,\n        addQuestion = util.addQuestion,\n        assert = chai.assert,\n        questionTypes = [\n            //{\n            //    clickBeforeAdd: \"questionX\", // optional click this node before adding question\n            //    path: parent path (must end with /)\n            //    type: \"QuestionType\", // required\n            //    nodeId: \"questionN\", // required\n            //    attrs: { // optional\n            //        // Any key here implies the same key inputs with a value of 1\n            //        \"attrName\": value\n            //    },\n            //    inputs { // optional: add tests to check input counts\n            //        \"inputName\": inputCount\n            //    }\n            //}\n            {\n                type: 'Text',\n                nodeId: 'question1',\n                attrs: {\n                    dataValue: 'default data value',\n                    constraintAttr: '/data/question20 = 2',\n                    relevantAttr: '/data/question20',\n                    requiredAttr: true,\n                },\n                inputs: {\n                    calculateAttr: 0\n                }\n            }, {\n                type: 'Trigger',\n                nodeId: 'question2',\n                inputs: {\n                    calculateAttr: 0,\n                    constraintAttr: 1,\n                    requiredAttr: 0,\n                    relevantAttr: 1\n                }\n            }, {\n                type: 'Trigger',\n                nodeId: 'question30',\n                attrs: {\n                    appearance: ''\n                },\n            }, {\n                type: 'Select',\n                nodeId: 'question3',\n                inputs: {\n                    calculateAttr: 0,\n                    constraintAttr: 1,\n                    requiredAttr: 1,\n                    relevantAttr: 1\n                }\n            }, {\n                type: 'MSelect',\n                nodeId: 'question6'\n            }, {\n                type: 'Int',\n                nodeId: 'question13'\n            }, {\n                type: 'PhoneNumber',\n                nodeId: 'question14'\n            }, {\n                type: 'Double',\n                nodeId: 'question15'\n            }, {\n                type: 'Long',\n                nodeId: 'question16'\n            }, {\n                type: 'Date',\n                nodeId: 'question17'\n            }, {\n                type: 'Time',\n                nodeId: 'question18'\n            }, {\n                type: 'DateTime',\n                nodeId: 'question19'\n            }, {\n                type: 'DataBindOnly',\n                nodeId: 'question20',\n                inputs: {\n                    calculateAttr: 1,\n                    constraintAttr: 0,\n                    requiredAttr: 0,\n                }\n            }, {\n                type: 'DataBindOnly',\n                nodeId: 'question32',\n                attrs: {\n                    calculateAttr: '1 + 2'\n                },\n                inputs: {\n                    calculateAttr: 1,\n                    constraintAttr: 0,\n                    requiredAttr: 0,\n                    relevantAttr: 1\n                }\n            }, {\n                clickBeforeAdd: \"question19\", // insert after question20\n                type: 'Repeat',\n                nodeId: 'question22'\n            }, {\n                type: 'FieldList',\n                path: 'question22/',\n                nodeId: 'question23'\n            }, {\n                type: 'Group',\n                path: 'question22/question23/',\n                nodeId: 'question40'\n            }, {\n                clickBeforeAdd: \"question22/question23\",\n                type: 'Repeat',\n                path: 'question22/question23/',\n                nodeId: 'question41'\n            },{\n                clickBeforeAdd: \"question22/question23\",\n                type: 'Image',\n                path: 'question22/question23/',\n                nodeId: 'question24'\n            }, {\n                type: 'Audio',\n                path: 'question22/question23/',\n                nodeId: 'question25'\n            }, {\n                type: 'Video',\n                path: 'question22/question23/',\n                nodeId: 'question26'\n            }, {\n                type: 'Geopoint',\n                path: 'question22/question23/',\n                nodeId: 'question27'\n            }, {\n                type: 'Secret',\n                path: 'question22/question23/',\n                nodeId: 'question28'\n            }, {\n                type: 'Signature',\n                path: 'question22/question23/',\n                nodeId: 'question29'\n            }, {\n                type: 'Document',\n                path: 'question22/question23/',\n                nodeId: 'question33'\n            }, {\n                type: 'AndroidIntent',\n                path: 'question22/question23/',\n                nodeId: 'question7'\n            }, {\n                type: 'MicroImage',\n                path: 'question22/question23/',\n                nodeId: 'question35',\n            }, {\n                clickBeforeAdd: \"question19\", // insert before question22\n                type: 'Group',\n                nodeId: 'question21'\n            }, {\n                type: 'Repeat',\n                path: 'question21/',\n                nodeId: 'question31',\n                attrs: {\n                    repeat_count: 2\n                }\n            }\n        ];\n\n    describe(\"Vellum\", function () {\n        describe(\"on load XML\", function () {\n            before(function (done) {\n                util.init({\n                    core: {\n                        form: TEST_XML,\n                        onReady: function () {\n                            done();\n                        }\n                    },\n                    features: { case_micro_image: true,\n                                use_custom_repeat_button_text: true,\n                     }\n                });\n            });\n\n            it(\"preserves all question types and attributes\", function () {\n                util.assertXmlEqual(util.call('createXML'), TEST_XML);\n            });\n\n\n            _.each(questionTypes, function(q, index) {\n                var nodeId = q.nodeId;\n                describe(\"with \" + q.type + \"[\" + nodeId + \"]\", function () {\n                    before(function (done) {\n                        if (index > 0) {\n                            clickQuestion((q.path || \"\") + nodeId);\n                        }\n                        done();\n                    });\n\n                    it(\"should be selected when clicked\", function() {\n                        assert.equal(call(\"getCurrentlySelectedMug\").p.nodeID, nodeId);\n                    });\n\n                    _.each(q.attrs || {}, function (val, name) {\n                        it(\"should show 1 input for \" + name, function() {\n                            util.assertInputCount(name, 1, nodeId);\n                        });\n                    });\n\n                    _.each(q.inputs || {}, function (num, name) {\n                        if (q.attrs && q.attrs.hasOwnProperty(name)) {\n                            assert.equal(num, 1,\n                                \"test configuration conflict for \" + name);\n                        } else {\n                            it(\"should show \" + num + \" inputs for \" + name, function() {\n                                util.assertInputCount(name, num, nodeId);\n                            });\n                        }\n                    });\n                });\n            });\n        });\n\n        it(\"adds all question types and attributes\", function (done) {\n            // This test takes way too long and needs to be broken up into\n            // smaller subtests. LONG timeout is to prevent timeout on travis.\n            this.timeout(10000);\n            // this also tests\n            // - that clicking add question buttons when other questions are\n            //   selected adds questions correctly\n            // - that a data node is added at the end, and adding a question\n            //   when a data node is selected adds to the end of the non-data\n            //   nodes\n            // - adding standard and other itext\n            // - changing itext label and updating question tree\n            // - adding itext for multiple languages\n            // - automatically creating Itext IDs for constraint and hint\n            //   messages\n            // - automatic adding of choices when you add a select\n            // - automatic generation of media paths for regular questions and choices\n            util.init({\n                features: {\n                    templated_intents: true,\n                    custom_intents: true,\n                    use_custom_repeat_button_text: true,\n                },\n                core: {\n                    form: null,\n                    onReady: function () {\n                        this.data.core.form.richText = false;\n                        _.each(questionTypes, function (q, i) {\n                            var prev = (i > 0 ? questionTypes[i - 1] : {}),\n                                prevId = q.clickBeforeAdd ||\n                                    (prev.nodeId ? (prev.path || \"\") + prev.nodeId : null);\n                            addQuestion.call({prevId: prevId}, q.type, q.nodeId, q.attrs);\n                        });\n\n                        function addAllForms() {\n                            _.each(['image', 'audio', 'video', 'video-inline'], function (i) {\n                                $(\".btn.itext-block-label-add-form-\" + i).click();\n                                $(\".btn.itext-block-constraintMsg-add-form-\" + i).click();\n                                $(\".btn.itext-block-help-add-form-\" + i).click();\n                            });\n                            $(\".btn:contains(long)\").click();\n                            $(\".btn:contains(short)\").click();\n                            $(\".btn:contains(custom)\").click();\n                            $(\".fd-modal-generic-container\").find(\"input\")\n                                .val(\"custom\");\n                            $(\".fd-modal-generic-container\").find(\".btn:contains(Add)\").click();\n                        }\n\n                        clickQuestion(\"question1\");\n                        addAllForms();\n                        $(\"[name='itext-en-label']\")\n                            .val('question1 en label').change();\n                        $(\"[name='itext-hin-label']\")\n                            .val('question1 hin label').change();\n                        $(\"[name='itext-en-constraintMsg']\")\n                            .val('question1 en validation').change();\n                        $(\"[name='itext-hin-constraintMsg']\")\n                            .val('question1 hin validation').change();\n                        $(\"[name='itext-en-hint']\")\n                            .val('question1 en hint').change();\n                        $(\"[name='itext-hin-hint']\")\n                            .val('question1 hin hint').change();\n                        $(\"[name='itext-en-help']\")\n                            .val('question1 en help').change();\n                        $(\"[name='itext-hin-help']\")\n                            .val('question1 hin help').change();\n                        $(\"[name='itext-en-label-long']\")\n                            .val(\"question1 en long\").change();\n                        $(\"[name='itext-hin-label-long']\")\n                            .val(\"question1 hin long\").change();\n                        $(\"[name='itext-en-label-short']\")\n                            .val(\"question1 en short\").change();\n                        $(\"[name='itext-hin-label-short']\")\n                            .val(\"question1 hin short\").change();\n                        $(\"[name='itext-en-label-custom']\")\n                            .val(\"question1 en custom\").change();\n                        $(\"[name='itext-hin-label-custom']\")\n                            .val(\"question1 hin custom\").change();\n                        $(\"[name='property-comment']\")\n                            .val(\"question 1 comment\\n* with __markdown__\").change();\n\n                        clickQuestion(\"question2\");\n                        $(\"[name='property-comment']\")\n                            .val(\"question 2 comment\").change();\n\n                        clickQuestion(\"question3\");\n                        addQuestion(\"Choice\", \"choice1\");\n                        addQuestion(\"Choice\", \"choice2\");\n                        clickQuestion(\"question3/choice1\");\n                        addAllForms();\n                        $(\"[name='itext-en-label-long']\")\n                            .val(\"choice1 long en\").change();\n                        $(\"[name='itext-hin-label-long']\")\n                            .val(\"choice1 long hin\").change();\n                        $(\"[name='itext-en-label-short']\")\n                            .val(\"choice1 short en\").change();\n                        $(\"[name='itext-hin-label-short']\")\n                            .val(\"choice1 short hin\").change();\n                        $(\"[name='itext-en-label-custom']\")\n                            .val(\"choice1 custom en\").change();\n                        $(\"[name='itext-hin-label-custom']\")\n                            .val(\"choice1 custom hin\").change();\n\n                        clickQuestion(\"question22\");\n                        $(\"[name='itext-en-addEmptyCaption']\")\n                            .val(\"add new\").change();\n                        $(\"[name='itext-en-addCaption']\")\n                            .val(\"add another\").change();\n\n                        clickQuestion(\"question22/question23/question7\");\n                        $(\"[name='property-androidIntentAppId']\").val(\"\").change();\n                        $(\"[name='property-androidIntentAppId-text']\").val(\"app_id\").change();\n                        $(\"[name='property-androidIntentExtra'] .fd-kv-key\").val('key1').change();\n                        $(\"[name='property-androidIntentExtra'] .fd-kv-val\").val('value1').change();\n                        $(\"[name='property-androidIntentResponse'] .fd-kv-key\").val('key2').change();\n                        $(\"[name='property-androidIntentResponse'] .fd-kv-val\").val('value2').change();\n                        util.assertXmlEqual(\n                            call('createXML'),\n                            TEST_XML\n                                .replace(' foo=\"bar\"', '')\n                                .replace(' spam=\"eggs\"', '')\n                                .replace(' foo=\"baz\"', '')\n                                .replace(/<unrecognized>[\\s\\S]+<\\/unrecognized>/, '')\n                                .replace('non-itext label', '')\n                                .replace('non-itext hint', '')\n                                .replace(/<instance[^>]+?casedb[^>]+?><\\/instance>/, '')\n                                .replace(/<setvalue[^>]+?>/, ''),\n                            {normalize_xmlns: true}\n                        );\n                        \n                        // should have updated question tree\n                        clickQuestion(\"question1\");\n\n                        done();\n                    }\n                }\n            });\n        });\n\n        describe(\"can\", function() {\n            var changes = [\n                    /*[\"Text\", \"Trigger\"],\n                    [\"Trigger\", \"Select\"],\n                    [\"Image\", \"Select\"],\n                    [\"Audio\", \"Select\"],\n                    [\"Video\", \"Select\"],\n                    [\"Image\", \"Audio\"],\n                    [\"PhoneNumber\", \"Text\"],*/\n                    [\"Select\", \"Text\"],\n                    [\"MSelect\", \"Text\"],\n                    [\"Select\", \"SelectDynamic\"],\n                    [\"Select\", \"MSelectDynamic\"],\n                    [\"MSelect\", \"SelectDynamic\"],\n                    [\"MSelect\", \"MSelectDynamic\"],\n                    [\"SelectDynamic\", \"MSelectDynamic\"],\n                    [\"MSelectDynamic\", \"SelectDynamic\"],\n                    [\"Select\", \"MSelect\"],\n                    [\"MSelect\", \"Select\"],\n                    [\"Select + Choices\", \"MSelect\"],\n                    [\"MSelect + Choices\", \"Select\"]\n                ],\n                no_change = [\n                    //[\"Text\", \"Group\"],\n                    //[\"Text\", \"Repeat\"],\n                    //[\"Text\", \"FieldList\"],\n                    [\"MSelect + Choices\", \"Text\"],\n                    [\"Select + Choices\", \"Text\"],\n                    [\"Select + Choices\", \"SelectDynamic\"],\n                    [\"Select + Choices\", \"MSelectDynamic\"],\n                    [\"MSelect + Choices\", \"SelectDynamic\"],\n                    [\"MSelect + Choices\", \"MSelectDynamic\"],\n                    //[\"Group\", \"Text\"],\n                    //[\"Repeat\", \"Text\"],\n                    //[\"FieldList\", \"Text\"]\n                ],\n                questionWithoutDefaultAppearance = [\n                    \"Text\", \"Select\", \"MSelect\", \"Audio\", \"Video\", \"Image\", \"Document\",\n                ],\n                questionWithDefaultAppearance = {\n                    Trigger: \"minimal\",\n                    PhoneNumber: \"numeric\",\n                    Signature: \"signature\",\n                },\n                remove_appearance = [\n                    [\"Trigger\", questionWithoutDefaultAppearance],\n                    [\"PhoneNumber\", questionWithoutDefaultAppearance],\n                    [\"Signature\", questionWithoutDefaultAppearance],\n                ],\n                change_appearance = [\n                    [\"Trigger\", _.omit(questionWithDefaultAppearance, \"Trigger\")],\n                    [\"PhoneNumber\", _.omit(questionWithDefaultAppearance, \"PhoneNumber\")],\n                    [\"Signature\", _.omit(questionWithDefaultAppearance, \"Signature\")],\n                ];\n\n            before(function (done) {\n                util.init({\n                    features: {rich_text: false },\n                    core: {\n                        onReady: function () {\n                            done();\n                        }\n                    }\n                });\n            });\n\n            function setup(from, to) {\n                var choices = from.indexOf(\" + Choices\") > -1;\n                from = (choices ? from.replace(\" + Choices\", \"\") : from);\n                var nodeId = (from + (choices ? \"_Choices\" : \"\") + \"_to_\" + to),\n                    mug = addQuestion(from, nodeId);\n                if (from.indexOf(\"Select\") > -1 && from.indexOf(\"Dynamic\") === -1) {\n                    if (choices) {\n                        util.addQuestion(\"Choice\", \"choice1\");\n                        util.addQuestion(\"Choice\", \"choice2\");\n                        util.clickQuestion(nodeId);\n                    }\n                }\n                assert.equal(mug.p.nodeID, nodeId, \"got wrong mug before changing type\");\n                assert.equal(mug.__className, from, \"wrong mug type\");\n                return mug;\n            }\n\n            function tearDown(from, to) {\n                var choices = from.indexOf(\" + Choices\") > -1;\n                from = (choices ? from.replace(\" + Choices\", \"\") : from);\n                var nodeId = (from + (choices ? \"_Choices\" : \"\") + \"_to_\" + to);\n                util.deleteQuestion(nodeId);\n            }\n\n            _.each(changes, function (change) {\n                var from = change[0],\n                    to = change[1];\n                it(\"change \" + from + \" to \" + to, function () {\n                    var mug = setup(from, to);\n                    call(\"changeMugType\", mug, to);\n                    mug = util.getMug(mug.p.nodeID);\n                    assert.equal(mug.__className, to);\n\n                    util.loadXML(call(\"createXML\"));\n                    mug = util.getMug(mug.p.nodeID);\n                    assert.equal(mug.__className, to);\n                    tearDown(from, to);\n                });\n            });\n\n            _.each(no_change, function (change) {\n                var from = change[0],\n                    to = change[1];\n                it(\"not change \" + from + \" to \" + to, function () {\n                    var mug = setup(from, to),\n                        ok = true;\n                    try {\n                        call(\"changeMugType\", mug, to);\n                        ok = false;\n                    } catch (error) {\n                        assert(String(error).indexOf(\"Cannot change\") > 0, String(error));\n                    }\n                    assert(ok, \"Error not raised when changing \" + from + \" to \" + to);\n                    mug = util.getMug(mug.p.nodeID);\n                    assert.equal(mug.__className, from.replace(\" + Choices\", \"\"));\n                    tearDown(from, to);\n                });\n            });\n\n            _.each(remove_appearance, function (change) {\n                var from = change[0];\n                _.each(change[1], function(to) {\n                    it(\"should remove appearance attribute when changing \" + from + \" to \" + to, function () {\n                        var mug = setup(from, to);\n                        call(\"changeMugType\", mug, to);\n                        mug = util.getMug(mug.p.nodeID);\n                        assert.equal(mug.__className, to);\n                        assert.equal(mug.p.appearance, undefined);\n\n                        call(\"loadXML\", call(\"createXML\"));\n                        mug = util.getMug(mug.p.nodeID);\n                        assert.equal(mug.__className, to);\n                        tearDown(from, to);\n                    });\n                });\n            });\n\n            _.each(change_appearance, function (change) {\n                var from = change[0];\n                _.each(change[1], function(newAppearance, to) {\n                    it(\"should change appearance attribute when changing \" + from + \" to \" + to, function () {\n                        var mug = setup(from, to);\n                        call(\"changeMugType\", mug, to);\n                        mug = util.getMug(mug.p.nodeID);\n                        assert.equal(mug.__className, to);\n                        assert.equal(mug.p.appearance, newAppearance);\n\n                        call(\"loadXML\", call(\"createXML\"));\n                        mug = util.getMug(mug.p.nodeID);\n                        assert.equal(mug.__className, to);\n                        tearDown(from, to);\n                    });\n                });\n            });\n\n            it(\"should change back and forth between dynamic types without side effects\", function () {\n                var from = 'MSelectDynamic',\n                    to = 'SelectDynamic',\n                    mug = setup(from, to);\n                var original = call('createXML');\n                call(\"changeMugType\", mug, to);\n                var afterChange = call('createXML');\n                call(\"changeMugType\", mug, from);\n                util.assertXmlEqual(call('createXML'), original, { normalize_xmlns: true });\n                call(\"changeMugType\", mug, to);\n                util.assertXmlEqual(call('createXML'), afterChange, { normalize_xmlns: true });\n                tearDown(from, to);\n            });\n        });\n\n        it(\"question type change survives save + load\", function () {\n            util.loadXML(\"\");\n            addQuestion(\"Text\", \"question\");\n            var mug = call(\"getMugByPath\", \"/data/question\");\n\n            call(\"changeMugType\", mug, \"Trigger\");\n\n            util.saveAndReload(function () {\n                // verify type change\n                mug = call(\"getMugByPath\", \"/data/question\");\n                assert.equal(mug.__className, \"Trigger\");\n            });\n        });\n\n        it(\"changing type from required Text to Label removes required attribute\", function () {\n            util.loadXML(\"\");\n            addQuestion(\"Text\", \"question\", {requiredAttr: \"true()\"});\n            var mug = util.getMug(\"question\");\n\n            call(\"changeMugType\", mug, \"Trigger\");\n\n            assert.equal(mug.p.requiredAttr, undefined);\n        });\n\n        it(\"should allow user to view longs but not add them\", function() {\n            util.loadXML(\"\");\n\n            // able to programatically add long\n            util.addQuestion(\"Long\", \"long\");\n            util.addQuestion(\"Int\", \"int\");\n            util.assertJSTreeState(\n                \"long\",\n                \"int\"\n            );\n\n            // can't change another question to a long\n            var $changer = $(\".fd-question-changer\");\n            $changer.children(\"a\").click();\n            assert.equal($changer.find(\"[data-qtype='Text']\").length, 1);\n            assert.equal($changer.find(\"[data-qtype='Long']\").length, 0);\n\n            // can't add new long via UI\n            var $dropdown = $(\".fd-add-question-dropdown\");\n            assert.equal($dropdown.find(\"[data-qtype='Text']\").length, 1);\n            assert.equal($dropdown.find(\"[data-qtype='Long']\").length, 0);\n        });\n\n        it(\"prevents changing selects with children to non-selects\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", \"question1\");\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.addQuestion(\"Choice\", \"choice2\");\n            util.clickQuestion(\"question1\");\n            var changerSelector = \".fd-question-changer\";\n\n            $(changerSelector + \" > a\").click();\n            var $options = $(changerSelector + \" .change-question\");\n            assert.equal($options.length, 1);\n            assert.equal($options.length, $options.filter(\"[data-qtype*='Select']\").length);\n\n            util.deleteQuestion(\"question1/choice1\");\n            util.deleteQuestion(\"question1/choice2\");\n            util.clickQuestion(\"question1\");\n            assert.ok($(changerSelector + \" .change-question:not([data-qtype*='Select'])\").length > 0);\n        });\n\n        it(\"adds and removes the add choice action when type changes\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"question1\");\n            var changerSelector = \".fd-question-changer\";\n\n            $(changerSelector + \" > a\").click();\n            var $options = $(changerSelector + \" .change-question\");\n            $options.filter(\"[data-qtype='Select']\").click();\n\n            assert.strictEqual($(\".add_choice\").length, 1);\n\n            util.addQuestion(\"Text\", \"question2\");\n            $(\".add_choice\").click();\n            $(\".add_choice\").click();\n\n            var choice = call(\"getCurrentlySelectedMug\");\n            assert(!choice.messages.get().length, \"New mug should have no errors\");\n            assert(!choice.p.nodeID, \"New mug shouldn't have an id\");\n            assert(!choice.p.labelItext.get(), \"New mug shouldn't have a label\");\n\n            util.assertJSTreeState(\n                \"question1\",\n                \"  choice1\",\n                \"  \",\n                \"question2\"\n            );\n\n            choice.form.vellum.ensureCurrentMugIsSaved();  // force choice2 id to generate\n            util.deleteQuestion(\"question1/choice1\");\n            util.deleteQuestion(\"question1/choice2\");\n\n            clickQuestion(\"question1\");\n            $(changerSelector + \" > a\").click();\n            $options = $(changerSelector + \" .change-question\");\n            $options.filter(\"[data-qtype='Text']\").click();\n            assert.strictEqual($(\".add_choice\").length, 0);\n        });\n\n        it(\"gives select questions an add choice action\", function() {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"Select\", \"question1\");\n\n            assert.strictEqual($(\".add_choice\").length, 1);\n            $(\".add_choice\").click();\n            mug.form.vellum.ensureCurrentMugIsSaved();  // force id to generate\n            clickQuestion(\"question1/choice1\");\n\n            util.assertJSTreeState(\n                \"question1\",\n                \"  choice1\"\n            );\n        });\n\n        it(\"gives select questions in loaded XML an add choice action\", function () {\n            util.loadXML(SELECT1_HELP_WITH_TYPE_XML);\n            assert.strictEqual($(\".add_choice\").length, 1);\n        });\n\n        it(\"should show error on delete validation condition but not message\", function() {\n            util.loadXML(\"\");\n            var text = util.addQuestion(\"Text\", \"text\");\n            text.p.constraintAttr = \"a = b\";\n            text.p.constraintMsgItext.set(\"A != B\");\n            text.p.constraintAttr = \"\";\n            assert(!util.isTreeNodeValid(text), \"question should not be valid\");\n        });\n\n        it(\"should require a repeat_count when inside of a question list\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"FieldList\", \"fieldlist\");\n            var repeat = util.addQuestion(\"Repeat\", \"repeat\");\n            assert.notStrictEqual(repeat.spec.repeat_count.validationFunc(repeat), \"pass\",\n                                  \"question should not be valid\");\n        });\n\n        it(\"should require a repeat_count when inside of a group in a question list\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"FieldList\", \"fieldlist\");\n            util.addQuestion(\"Group\", \"group\");\n            var repeat = util.addQuestion(\"Repeat\", \"repeat\");\n            assert.notStrictEqual(repeat.spec.repeat_count.validationFunc(repeat), \"pass\",\n                                  \"question should not be valid\");\n        });\n\n        it(\"should not require a repeat_count when inside of a group\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Group\", \"group\");\n            var repeat = util.addQuestion(\"Repeat\", \"repeat\");\n            assert.strictEqual(repeat.spec.repeat_count.validationFunc(repeat), \"pass\",\n                                  \"question should be valid\");\n        });\n    });\n\n    describe(\"Image Questions\", function() {\n        it(\"should default to small image size\", function() {\n            util.loadXML(\"\");\n            var image = util.addQuestion(\"Image\", 'image');\n            assert.strictEqual(image.p.imageSize, 250);\n        });\n\n        it(\"should select original size if there is no option\", function() {\n            util.loadXML(IMAGE_CAPTURE_XML);\n            var image = call(\"getMugByPath\", \"/data/image\");\n            assert.strictEqual(image.p.imageSize, '');\n        });\n    });\n\n    describe(\"Select questions\", function () {\n        before(function (done) {\n            util.init({\n                core: {\n                    onReady: function () { done(); },\n                },\n            });\n        });\n\n        it(\"should not write the type\", function () {\n            util.loadXML(SELECT1_HELP_WITH_TYPE_XML);\n            util.assertXmlEqual(util.call('createXML'), SELECT1_HELP_XML);\n        });\n    });\n\n    describe(\"Micro-Image question\", function () {\n        it(\"should have correct options set\", function () {\n            util.loadXML(\"\");\n            var microImage = util.addQuestion(\"MicroImage\", \"microimage\");\n            assert.strictEqual(microImage.options.mediaType, 'image/*');\n            assert.strictEqual(microImage.options.tagName, 'input');\n            assert.strictEqual(microImage.p.appearance, 'micro-image');\n        });\n    });\n});\n","/*\n * expected structure of a richText widget:\n *\n * <div contenteditable=\"true\" ... ckeditor stuff...>\n *   <p>\n *      User input text\n *   </p>\n * </div>\n *\n * Possible values for user's input text:\n *\n * text\n *\n * newline: <br />\n *\n * rich text \"bubble\":\n *   <span data-value=\"xpath\" data-output-value=boolean>\n *     <i class=\"icon\">&nbsp;</i>\n *     text to display inside bubble\n *     <i class=\"close\">&times;</i>\n *   </span>\n *\n * Any other HTML has undefined behavior\n */\ndefine([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'vellum/richText',\n    'vellum/javaRosa/util',\n    'vellum/escapedHashtags',\n    'ckeditor',\n    'static/richText/burpee.xml',\n    'static/richText/output-ref.xml',\n    'static/richText/output-value.xml',\n], function(\n    chai,\n    $,\n    _,\n    util,\n    richText,\n    javaRosa,\n    escapedHashtags,\n    CKEDITOR,\n    BURPEE_XML,\n    OUTPUT_REF_XML,\n    OUTPUT_VALUE_XML\n) {\n    var assert = chai.assert,\n        call = util.call,\n        form,\n        CASE_DATA = [{\n            id: \"commcaresession\",\n            uri: \"jr://instance/session\",\n            path: \"/session/data\",\n            name: 'Session',\n            structure: {\n                \"case_id\": {\n                    reference: {\n                        hashtag: \"#case\",\n                        source: \"casedb\",\n                        subset: \"case\",\n                        subset_key: \"@case_type\",\n                        key: \"@case_id\",\n                    },\n                },\n            },\n        }, {\n            id: \"casedb\",\n            uri: \"jr://instance/casedb\",\n            path: \"/cases/case\",\n            name: 'Cases',\n            structure: {\n                name: {},\n            },\n            subsets: [{\n                id: \"parent\",\n                name: \"parent\",\n                key: \"@case_type\",\n                structure: {\n                    edd: {},\n                },\n            }, {\n                id: \"case\",\n                name: \"child\",\n                key: \"@case_type\",\n                structure: {\n                    \"case\": {},\n                    dob: {},\n                    f_1065: {},\n                },\n                related: {\n                    parent: {\n                        hashtag: \"#case/parent\",\n                        subset: \"parent\",\n                        subset_key: \"@case_type\",\n                        key: \"@case_id\",\n                    },\n                },\n            }],\n        }];\n\n    function icon(iconClass) { \n        if (iconClass.startsWith(\"fa-\")) {\n            return $('<i>').addClass(iconClass).html('&nbsp;');\n        }\n        return $('<i>').addClass('fcc ' + iconClass).html('&nbsp;');\n    }\n\n    function externalIcon () { return icon('fcc-fd-case-property'); }\n    function externalUnknownIcon () { return icon('fa-solid fa-triangle-exclamation'); }\n\n    function makeBubble(xpath, dispValue, icon, internal) {\n        var span = $('<span>').addClass('label label-datanode').attr({\n            'data-value': xpath,\n        });\n        if (internal && !_.isString(internal)) {\n            span.addClass('label-datanode-internal');\n        } else if (internal === \"case\" || form.isValidHashtag(xpath)) {\n            span.addClass('label-datanode-external');\n        } else if (form.hasValidHashtagPrefix(xpath)) {\n            span.addClass('label-datanode-external-unknown');\n        } else {\n            span.addClass('label-datanode-unknown');\n        }\n        return span.append(icon).append(dispValue);\n    }\n    function outputValueTemplateFn(path) {\n        return '<output value=\"' + path + '\"></output>';\n    }\n\n    function wrapWithDiv(el) { return $('<div>').append(el); }\n    function wrapWithDivP(el) { return wrapWithDiv($('<p>').append(el)); }\n    function html(value) { return wrapWithDiv(value).html(); }\n\n    function setupGlobalForm(done) {\n        util.init({\n            javaRosa: {langs: ['en']},\n            core: {\n                dataSourcesEndpoint: function (callback) { callback(CASE_DATA); },\n                onReady: function () {\n                    util.addQuestion(\"Text\", \"text\");\n                    util.addQuestion(\"Text\", \"othertext\");\n                    util.addQuestion(\"Date\", \"date\");\n                    util.addQuestion(\"Group\", \"group\");\n                    form = this.data.core.form;\n                    done();\n                },\n            },\n        });\n    }\n\n    describe(\"Rich text utilities\", function() {\n        before(setupGlobalForm);\n\n        describe(\"simple conversions\", function() {\n            // path, display value, icon\n            var simpleConversions = [\n                    ['#form/text', 'text', icon('fcc-fd-text'), true],\n                    [\"#case/case\", 'case', externalIcon(), false],\n                    [\"#case/parent/edd\", 'edd', externalIcon(), false],\n                    [\"#case/parent/unknown\", 'unknown', externalUnknownIcon(), false],\n                ],\n                opts = {isExpression: true};\n\n            _.each(simpleConversions, function(val) {\n                it(\"from text to html: \" + val[0], function() {\n                    assert.strictEqual(\n                        richText.toRichText(val[0], form, opts),\n                        wrapWithDivP(makeBubble(val[0], val[1], val[2], val[3])).html()\n                    );\n                });\n\n                it(\"from text to html with output value: \" + val[0], function() {\n                    assert.strictEqual(\n                        richText.toRichText(outputValueTemplateFn(val[0]), form),\n                        wrapWithDivP(makeBubble(val[0], val[1], val[2], val[3])).html()\n                    );\n                });\n            });\n        });\n\n        describe(\"date conversions\", function() {\n            var dates = [\n                    {\n                        xmlValue: \"format-date(date(#form/date), '%d/%n/%y')\",\n                        valueInBubble: '#form/date',\n                        bubbleDispValue: 'date',\n                        icon: icon('fa-solid fa-calendar-days'),\n                        internalRef: true,\n                        extraAttrs: {\n                            'data-date-format': '%d/%n/%y',\n                        }\n                    },\n                ];\n\n            _.each(dates, function(val) {\n                it(\"from text to html with output value: \" + val.xmlValue, function() {\n                    assert.equal(\n                        richText.toRichText(outputValueTemplateFn(val.xmlValue), form),\n                        wrapWithDivP(makeBubble(\n                            val.valueInBubble,\n                            val.bubbleDispValue,\n                            val.icon,\n                            val.internalRef\n                        ).attr(val.extraAttrs)).html()\n                    );\n                });\n            });\n\n            it(\"bubble a drag+drop reference\", function() {\n                var fmt = \"%d/%n/%y\",\n                    tag = javaRosa.getOutputRef(\"#form/text\", fmt),\n                    bubble = richText.toRichText(tag, form);\n                assert.strictEqual($(bubble).find('span').data('date-format'), fmt);\n            });\n        });\n\n        describe(\"equation conversions\", function() {\n            var f_1065 = \"#case/f_1065\",\n                ico = icon('fcc-fd-text'),\n                opts = {isExpression: true},\n                equations = [\n                    [\n                        \"#form/text = #form/othertext\",\n                        html(makeBubble('#form/text', 'text', ico, true)) + \" = \" +\n                        html(makeBubble('#form/othertext', 'othertext', ico, true))\n                    ],\n                    [\n                        \"#form/text <= #form/othertext\",\n                        html(makeBubble('#form/text', 'text', ico, true)) + \" <= \" +\n                        html(makeBubble('#form/othertext', 'othertext', ico, true))\n                    ],\n                    [\n                        f_1065 + \" = \" + f_1065,\n                        html(makeBubble(f_1065, 'f_1065', icon('fcc-fd-case-property'), \"case\")) + \" = \" +\n                        html(makeBubble(f_1065, 'f_1065', icon('fcc-fd-case-property'), \"case\"))\n                    ],\n                ];\n\n            _.each(equations, function(val) {\n                it(\"from text to html: \" + val[0], function() {\n                    assert.strictEqual(\n                        richText.toRichText(val[0], form, opts),\n                        \"<p>\" + val[1] + \"</p>\"\n                    );\n                });\n            });\n        });\n\n        describe(\"text conversions\", function() {\n            var prefix_html_1 = '<span data-cke-copybin-start=\"1\">​</span><p>',\n                prefix_html_2 = '<span id=\"cke_bm_909S\" style=\"display: none;\">&nbsp;</span>',\n                prefix_html = prefix_html_1 + prefix_html_2,\n                widget_html = '<span tabindex=\"-1\" contenteditable=\"false\" data-cke-widget-wrapper=\"1\" data-cke-filter=\"off\" ' +\n                    'class=\"cke_widget_wrapper cke_widget_inline cke_widget_bubbles cke_widget_wrapper_label-datanode-external ' +\n                    'cke_widget_wrapper_label-datanode cke_widget_wrapper_label cke_widget_selected\" data-cke-display-name=\"span\" ' +\n                    'data-cke-widget-id=\"0\" role=\"region\" aria-label=\"span widget\"><span class=\"label label-datanode label-datanode-external ' +\n                    'cke_widget_element\" data-value=\"#case/dob\" data-cke-widget-data=\"%7B%22classes%22%3A%7B%22label-datanode-external' +\n                    '%22%3A1%2C%22label-datanode%22%3A1%2C%22label%22%3A1%7D%7D\" data-cke-widget-upcasted=\"1\" data-cke-widget-keep-attr=\"0\" ' +\n                    'data-widget=\"bubbles\"><i class=\"fcc fcc-fd-case-property\">&nbsp;</i>dob</span><span class=\"cke_reset ' +\n                    'cke_widget_drag_handler_container\" style=\"background: url(&quot;http://localhost:8088/src/../lib/ckeditor/plugins/' +\n                    'widget/images/handle.png&quot;) rgba(220, 220, 220, 0.5); width: 43px; height: 16px; left: 2px; top: -14px;\">' +\n                    '<img class=\"cke_reset cke_widget_drag_handler\" data-cke-widget-drag-handler=\"1\" src=\"data:image/gif;base64,R0lGODlhAQABAPABAP' +\n                    '///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" width=\"15\" title=\"Click and drag to move\" height=\"15\" role=\"presentation\" ' +\n                    'draggable=\"true\"></span></span>',\n                suffix_html = '</p><span data-cke-copybin-end=\"1\">​</span>';\n\n            var text = [\n                [\"blah\\nblah\", \"<p>blah</p><p>blah</p>\"],\n                [\"blah\\nblah\\n\", \"<p>blah</p><p>blah</p><p>&nbsp;</p>\"],\n                [\n                    \"blah\\n\\nblah\\n\\n\",\n                    \"<p>blah</p><p>&nbsp;</p><p>blah</p><p>&nbsp;</p><p>&nbsp;</p>\"\n                ],\n                [\n                    \"list\\n* item\\n* item\",\n                    \"<p>list</p><p>* item</p><p>* item</p>\"\n                ],\n                [\n                    \"list\\n\\n* item\\n* item\",\n                    \"<p>list</p><p></p><p>* item</p><p>* item</p>\"\n                ],\n                [\n                    \"list\\n\\n\\n* item\\n* item\",\n                    \"<p>list</p><p></p><p></p><p>* item</p><p>* item</p>\"\n                ],\n                [\" \", \" \"],\n                [\"   \", \" \\xa0 \"],\n                [\"   \", \" &nbsp; \"],\n                [\"' ,\", \"'\\u200B,\"],\n                ['This dob: <output value=\"#case/dob\" /> is of child', prefix_html + 'This dob:&nbsp;' + widget_html + ' is of child' + suffix_html],\n                ['This dob: <output value=\"#case/dob\" />', prefix_html + 'This dob:&nbsp;' + widget_html +  suffix_html],\n                ['<output value=\"#case/dob\" /> is of child', prefix_html + widget_html + ' is of child' + suffix_html],\n                ['<output value=\"#case/dob\" />', prefix_html_1 + widget_html + suffix_html],\n                ['This dob: <output value=\"#case/dob\" /> is of child', 'This dob: &lt;output value=\"#case/dob\" /&gt; is of child'],\n            ];\n\n            _.each(text, function(val){\n                it(\"from html to text: \" + JSON.stringify(val[1]), function() {\n                    assert.strictEqual(richText.fromRichText(val[1]), val[0]);\n                });\n            });\n\n            _.each(text, function(val){\n                it(\"(text -> html -> text): \" + JSON.stringify(val[0]), function() {\n                    assert.strictEqual(\n                        richText.fromRichText(richText.toRichText(val[0], form)),\n                        val[0]\n                    );\n                });\n            });\n        });\n\n        describe(\"doesn't convert\", function() {\n            var nonConversions = [\n                    \"instance('casedb')/cases/case[\" +\n                        \"@case_id = instance('casedb')/cases/case[\" +\n                            \"@case_id = instance('commcaresession')/session/data/case_id\" +\n                        \"]/index/parent]/edd[@other = 'blah']\",\n                    \"/data/group[@prop = 'something']\",\n                    \"instance('casedb')/cases/case[@case_id = /data/blah]\",\n                ],\n                opts = {isExpression: true};\n\n            _.each(nonConversions, function(val) {\n                it(\"from text to html: \" + val, function() {\n                    assert.strictEqual(\n                        richText.toRichText(val, form, opts),\n                        \"<p>\" + val + \"</p>\"\n                    );\n                });\n            });\n        });\n\n        describe(\"convert value with output and escaped HTML\", function () {\n            var items = [\n                    ['<h1><output value=\"#form/text\" /></h1>',\n                     '&lt;h1&gt;{text}&lt;/h1&gt;'],\n                    ['<output value=\"#form/text\" /> <tag /> <output value=\"#form/othertext\" />',\n                     '{text} &lt;tag /&gt; {othertext}'],\n                    [\"{blah}\", \"{blah}\"],\n                    ['<output value=\"unknown(#form/text)\" />', '&lt;output value=\"unknown(#form/text)\" /&gt;'],\n                    ['<output value=\"#form/text + now()\" />', '&lt;output value=\"#form/text + now()\" /&gt;'],\n                    ['<output value=\"concat(1, 2\" />', '&lt;output value=\"concat(1, 2\" /&gt;'],\n                    ['<output value=\"#form/question,\\'-label\\')\" />',\n                     '&lt;output value=\"#form/question,\\'-label\\')\" /&gt;'],\n                    ['<output />', '&lt;output /&gt;'],\n                ],\n                ico = icon('fcc-fd-text');\n\n            _.each(items, function (item) {\n                it(\"to text: \" + item[0], function () {\n                    var result = richText.bubbleOutputs(item[0], form, true),\n                        expect = item[1].replace(/{(.*?)}/g, function (m, name) {\n                            if (form.getIconByPath(\"#form/\" + name)) {\n                                var output = makeBubble(\"#form/\" + name, name, ico, true);\n                                return output[0].outerHTML;\n                            }\n                            return m;\n                        });\n                    assert.equal(result, expect);\n                });\n            });\n        });\n\n        describe(\"serialize formats correctly\", function () {\n            it(\"should handle output refs\", function() {\n                assert.equal(richText.applyFormats({\n                    value: \"#case/f_2685\",\n                }), '&lt;output value=\"#case/f_2685\" /&gt;');\n            });\n\n            it(\"should handle dates\", function() {\n                assert.equal(richText.applyFormats({\n                    dateFormat: \"%d/%n/%y\",\n                    value: \"#form/question1\",\n                }), '&lt;output value=\"format-date(date(#form/question1), \\'%d/%n/%y\\')\" /&gt;');\n            });\n        });\n\n        describe(\"invalid xpath unescaper\", function () {\n            it(\"should pass through xpath not marked as invalid\", function() {\n                assert.equal(richText.unescapeXPath(\"/data/valid\", form), \"/data/valid\");\n            });\n\n            _.each({\n                \"#invalid/xpath `#form/text` xpath\": \"/data/text xpath\",\n                \"#invalid/xpath `#form/text`xpath\": \"/data/text xpath\",\n            }, function (expect, expr) {\n                it(\"should unescape invalid xpath: \" + expr + \" -> \" + expect, function() {\n                    assert.equal(richText.unescapeXPath(expr, form), expect);\n                });\n            });\n        });\n    });\n\n    describe(\"The rich text editor\", function () {\n        before(setupGlobalForm);\n\n        describe(\"\", function() {\n            var el = $(\n                    \"<div id='cktestparent'>\" +\n                        \"<div contenteditable></div>\" +\n                        \"<div contenteditable></div>\" +\n                    \"</div>\"),\n                options = {isExpression: false},\n                input, editor, exprInput, exprEditor;\n            before(function (done) {\n                $(\"body\").append(el);\n                input = el.children().first();\n                editor = richText.editor(input, form, options);\n                exprInput = $(el.children()[1]);\n                exprEditor = richText.editor(exprInput, form, {isExpression: true});\n                // wait for editor to be ready; necessary to change selection\n                input.promise.then(function () {\n                    exprInput.promise.then(function () { done(); });\n                });\n            });\n            beforeEach(function (done) {\n                editor.setValue(\"\", function () {\n                    exprEditor.setValue(\"\", function () { done(); });\n                });\n            });\n            after(function () {\n                editor.destroy();\n                exprEditor.destroy();\n                assert.equal($(\"#cktestparent\").length, 1);\n                el.remove();\n                assert.equal($(\"#cktestparent\").length, 0);\n            });\n\n            it(\"should be accessible via various jquery paths\", function (done) {\n                var v0 = editor,\n                    v1 = richText.editor(input);\n                assert.equal(v0, v1);\n                v0.setValue(\"test\", function () {\n                    assert.equal(v1.getValue(), \"test\");\n                    var div = $(\"#cktestparent\").children().first();\n                    assert.equal(richText.editor(div), v0);\n                    done();\n                });\n            });\n\n            it(\"should return just-set value on get value\", function () {\n                var text = '<output value=\"#form/text\" />';\n                assert.notEqual(editor.getValue(), text);\n                editor.setValue(text);\n                assert.equal(editor.getValue(), text);\n            });\n\n            it(\"should create output on insert expression into label editor\", function (done) {\n                var output = '<output value=\"#form/text\" />';\n                editor.setValue('one two', function () {\n                    assert.equal(editor.getValue(), 'one two');\n                    editor.select(3);\n                    editor.insertExpression(\"#form/text\");\n                    assert.equal(editor.getValue(), \"one\" + output + \"  two\");\n                    done();\n                });\n            });\n\n            it(\"should insert output into label editor\", function (done) {\n                var output = '<output value=\"#form/text\" />';\n                editor.setValue('one two', function () {\n                    assert.equal(editor.getValue(), 'one two');\n                    editor.select(3);\n                    editor.insertOutput(output);\n                    assert.equal(editor.getValue(), \"one\" + output + \"  two\");\n                    done();\n                });\n            });\n\n            it(\"should not copy output value from label to expression editor\", function (done) {\n                var output = '<output value=\"#form/text\" />';\n                editor.setValue(output, function () {\n                    assert.equal(editor.getValue(), output);\n                    var copyVal = input.ckeditor().editor.getData();\n                    assert(/^<p><span .*<.span><.p>$/.test(copyVal), copyVal);\n                    exprInput.ckeditor().editor.setData(copyVal, function () {\n                        assert.equal(exprEditor.getValue(), \"#form/text\");\n                        done();\n                    });\n                });\n            });\n\n            it(\"should copy output value from expression editor to label\", function (done) {\n                exprEditor.setValue(\"#form/text\", function () {\n                    assert.equal(exprEditor.getValue(), \"#form/text\");\n                    var copyVal = exprInput.ckeditor().editor.getData();\n                    assert(/^<p><span .*<.span><.p>$/.test(copyVal), copyVal);\n                    input.ckeditor().editor.setData(copyVal, function () {\n                        assert.equal(editor.getValue(), '<output value=\"#form/text\" />');\n                        done();\n                    });\n                });\n            });\n\n            it(\"should not paste style content into editor\", function () {\n                var html = '<style type=\"text/css\"><!--td--></style><span>A</span>';\n                input.ckeditor().editor.execCommand('paste', html);\n                assert.equal(editor.getValue(), 'A');\n            });\n\n            function assertCKCopy($editor, value, callback) {\n                // WARNING this is heavily dependent on CKEditor internals\n                var domObject = new CKEDITOR.dom.domObject($editor[0]),\n                    realDataTransfer = CKEDITOR.plugins.clipboard.dataTransfer,\n                    data;\n                function testDataTransfer(nativeDataTransfer, editor) {\n                    realDataTransfer.call(this, nativeDataTransfer, editor);\n                    data = this._.data;\n                }\n                testDataTransfer.prototype = realDataTransfer.prototype;\n                CKEDITOR.plugins.clipboard.dataTransfer = testDataTransfer;\n                try {\n                    domObject.fire(\"copy\", new CKEDITOR.dom.event({}));\n                } finally {\n                    CKEDITOR.plugins.clipboard.dataTransfer = realDataTransfer;\n                }\n                assert.equal(data.Text, value, 'text/plain');\n                assert.strictEqual(data[\"text/html\"], undefined, 'text/html');\n                // Wait for CK Editor Async handler (copybin) to complete\n                setTimeout(callback, 100);\n            }\n\n            function ckPaste($editor, data, callback) {\n                // WARNING this is heavily dependent on CKEditor internals\n                function mockDataTransfer() {\n                    // borrowed from CKEditor tests\n                    return {\n                        types: [],\n                        files: CKEDITOR.env.ie && CKEDITOR.env.version < 10 ? undefined : [],\n                        _data: {},\n                        // Emulate browsers native behavior for getDeta/setData.\n                        setData: function( type, data ) {\n                            if ( CKEDITOR.env.ie && type !== 'Text' && type !== 'URL' )\n                                throw 'Unexpected call to method or property access.';\n\n                            if ( CKEDITOR.env.ie && CKEDITOR.env.version > 9 && type === 'URL' )\n                                return;\n\n                            if ( type === 'text/plain' || type === 'Text' ) {\n                                this._data[ 'text/plain' ] = data;\n                                this._data.Text = data;\n                            } else {\n                                this._data[ type ] = data;\n                            }\n\n                            this.types.push( type );\n                        },\n                        getData: function( type ) {\n                            if ( CKEDITOR.env.ie && type !== 'Text' && type !== 'URL' )\n                                throw 'Invalid argument.';\n\n                            if ( typeof this._data[ type ] === 'undefined' || this._data[ type ] === null )\n                                return '';\n\n                            return this._data[ type ];\n                        }\n                    };\n                }\n                function mockPasteEvent(_target, dataTransfer) {\n                    // borrowed from CKEditor tests\n                    var target = new CKEDITOR.dom.node(_target);\n                    return {\n                        $: {\n                            ctrlKey: true,\n                            clipboardData: CKEDITOR.env.ie ? undefined : dataTransfer\n                        },\n                        preventDefault: function() {\n                            // noop\n                        },\n                        getTarget: function() {\n                            return target;\n                        },\n                        setTarget: function( t ) {\n                            target = t;\n                        }\n                    };\n                }\n                var editor = $editor.ckeditor().editor,\n                    editable = editor.editable(),\n                    dataTransfer = mockDataTransfer(),\n                    evt = mockPasteEvent($editor[0], dataTransfer),\n                    types = {\n                        html: \"text/html\",\n                        text: \"Text\",\n                    };\n                if (_.isEmpty(data)) {\n                    throw new Error(\"bad paste: no data\");\n                }\n                _.each(data, function (value, type) {\n                    if (!types.hasOwnProperty(type)) {\n                        throw new Error(\"bad paste type: \" + type);\n                    }\n                    dataTransfer.setData(types[type], value);\n                });\n                editor.once(\"afterPaste\", function () {\n                    callback(editor.getData());\n                }, null, null, 100);\n                editable.fire(\"paste\", evt);\n            }\n\n            function escapeHTML(html) {\n                var reps = {'<': '&lt;', '>': '&gt;', '\"': '&quot;', '\\n': '<br />'};\n                return html.replace(/[<>\"&\\n]/g, function (match) {\n                    return reps[match];\n                });\n            }\n\n            var TEST_LABEL = 'Weight: <output value=\"#form/text\" /> grams',\n                TEST_XPATH = \"if(today() + (#case/dob - 3), #form/text, 0)\";\n\n            it(\"should copy output tag from rich text editor\", function (done) {\n                editor.setValue(TEST_LABEL, function () {\n                    editor.select(6, 3);\n                    assertCKCopy(input, ': <output value=\"#form/text\" />', function () {\n                        done();\n                    });\n                });\n            });\n\n            it(\"should copy expression with hashtags from expression editor\", function (done) {\n                exprEditor.setValue(TEST_XPATH, function () {\n                    exprEditor.select(11, 4);\n                    assertCKCopy(exprInput, \"+ (#case/dob\", function () {\n                        done();\n                    });\n                });\n            });\n\n            var /*OUTPUT = '<output value=\"#form/text\" />',\n                START_LABEL = TEST_LABEL.replace(OUTPUT, 'XXXX'),*/\n                START_PATH = TEST_XPATH.replace('#case/dob', 'XXXX');\n            _.each([\n                /* No idea why these fail intermittently\n                [0, START_LABEL, 8, 4, {text: OUTPUT}],\n                [0, START_LABEL, 8, 4, {text: OUTPUT + \" > 3\"}],\n                [0, START_LABEL, 8, 4, {text: \"4 pounds\\n\\nLines...\"}],\n                */\n                [1, START_PATH, 14, 4, {text: \"#case/dob\"}],\n                [1, START_PATH, 11, 7, {text: \"+ (#case/dob\"}],\n                [1, START_PATH, 11, 7, {text: \"< (#case/dob\"}],\n                [1, START_PATH, 11, 7, {html: \"<span>+ (#case/dob</span>\"}],\n                [1, START_PATH, 11, 7, {html: \"<meta charset='utf-8'>+ (#case/dob\"}],\n            ], function (args) {\n                var inputFlag = args[0],\n                    initialExpr = args[1],\n                    selStart = args[2],\n                    selLength = args[3],\n                    pasteValue = args[4],\n                    pasteText = pasteValue.text ||\n                                pasteValue.html.replace(/<.*?>/g, ''),\n                    pasteRepr = JSON.stringify(pasteValue),\n                    type = inputFlag ? \"expression\" : \"text\",\n                    opts = {isExpression: true};\n                it(\"should paste \" + type + \": \" + pasteRepr, function (done) {\n                    var input_ = inputFlag ? exprInput : input,\n                        editor = richText.editor(input_),\n                        find = initialExpr.substring(selStart, selStart + selLength);\n                    editor.setValue(initialExpr, function () {\n                        editor.select(selStart, selLength);\n                        ckPaste(input_, pasteValue, function (text) {\n                            assert.equal(text, richText\n                                .toRichText(initialExpr, form, opts)\n                                .replace(find, escapeHTML(pasteText)));\n                            assert.equal(editor.getValue(),\n                                initialExpr.substring(0, selStart) + pasteText +\n                                initialExpr.substring(selStart + selLength));\n                            done();\n                        });\n                    });\n                });\n            });\n\n            function applyArgs(func) {\n                return function (args) {\n                    return func.apply(this, args);\n                };\n            }\n            var argsets = [\n                [\"= two\", 0, \"#form/text = two\"],\n                [\"one two\", 3, \"#invalid/xpath one`#form/text`  two\"],\n                [\"one two\", 4, \"#invalid/xpath one `#form/text` two\"],\n                [\"one\\n\\ntwo\", 3, \"#invalid/xpath one`#form/text` \\n\\ntwo\"],\n                [\"one\\n\\ntwo\", 4, \"#invalid/xpath one\\n`#form/text` \\ntwo\"],\n                [\"one``two\", 4, \"#invalid/xpath one```#form/text` ``two\"],\n                [\"`one  two\", 5, \"#invalid/xpath ``one `#form/text`  two\"],\n                // end padding added to work around bug in exprEditor.select(i)\n                [\"one =  \", 6, \"one = #form/text  \"],\n                // TODO I think exprEditor.select(i) is breaking this one\n                //[\"one\\n\\ntwo\", 5, \"#invalid/xpath one\\n\\n`#form/text` two\"],\n            ];\n\n            _.each(argsets, applyArgs(function (expr, i, result) {\n                var repr = JSON.stringify(result);\n                it(\"should insert expression into expression at \" + i + \": \" + repr, function (done) {\n                    exprEditor.setValue(expr, function () {\n                        assert.equal(exprEditor.getValue(), expr);\n                        exprEditor.select(i);\n                        exprEditor.insertExpression('#form/text');\n                        assert.equal(exprEditor.getValue(), result);\n                        done();\n                    });\n                });\n            }));\n\n            _.each(argsets, applyArgs(function (expr, i, result) {\n                var repr = JSON.stringify(result);\n                it(\"should make bubbles on converting to rich text: \" + repr, function () {\n                    var text = richText.toRichText(result, form, {isExpression: true}),\n                        bubble = makeBubble('#form/text', 'text', icon('fcc-fd-text'), true),\n                        expected = (expr.slice(0, i) + html(bubble) + \" \" + expr.slice(i))\n                            .replace(/  $/, \"\")  // HACK for \"one =  \"\n                            .replace(/  /g, \" &nbsp;\")\n                            .replace(/\\n/g, \"</p><p>\");\n                    assert.equal(text, \"<p>\" + expected + \"</p>\");\n                });\n            }));\n        });\n\n        describe(\"in vellum\", function() {\n            var widget;\n\n            describe(\"\", function () {\n                beforeEach(function (done) {\n                    util.init({\n                        javaRosa: {langs: ['en']},\n                        form: \"\",\n                        core: {\n                            onReady: function() {\n                                util.addQuestion(\"Text\", 'text');\n                                widget = util.getWidget('itext-en-label');\n                                widget.input.promise.then(function () { done(); });\n                            }\n                        },\n                        features: {rich_text: true},\n                    });\n                });\n\n                it(\"should show the markdown preview\", function(done) {\n                    var super_handleChange = widget.handleChange;\n                    function handleChange() {\n                        super_handleChange();\n                        assert($('.has-markdown').length);\n                        done();\n                    }\n                    widget.setValue('# blah', handleChange);\n                });\n\n                it(\"should allow editing of validation message\", function () {\n                    var mug = util.getMug('text'),\n                        msg = $('[name=itext-en-constraintMsg]');\n                    mug.p.constraintAttr = '.';\n                    msg.focus();\n                    assert(msg[0].isContentEditable);\n                });\n\n                it(\"should not write empty attributes\", function () {\n                    util.loadXML(BURPEE_XML);\n                    var mug = util.getMug('total_num_burpees');\n                    mug.p.relevantAttr = '';\n                    util.assertXmlEqual(call('createXML'), BURPEE_XML);\n                });\n\n                it(\"cursor should be at end of input on focus\", function () {\n                    var editor = widget.input.editor,\n                        value = 'testing cursor';\n                    widget.setValue(value);\n                    // Make sure focus is elsewhere, then focus on the rich text input\n                    editor.on('instanceReady', function() {\n                        $('[name=property-nodeID]').focus();\n                        editor.focus();\n                        var selection = editor.getSelection(true);\n                        assert.strictEqual(selection.getNative().focusOffset, value.length);\n                    });\n                });\n\n                it(\"should change output ref to output value\", function () {\n                    util.loadXML(OUTPUT_REF_XML);\n                    util.assertXmlEqual(call('createXML'), OUTPUT_VALUE_XML);\n                });\n\n                it(\"should bubble various case properties\", function () {\n                    util.loadXML(\"\");\n                    var widget = util.getWidget('itext-en-label'),\n                        $widget = $(\".fd-textarea[name='itext-en-label']\");\n                    widget.input.promise.then(function () {\n                        widget.setValue('<output value=\"#case/not_a_child\" />' +\n                            '<output value=\"#case/not_a_thing\" />' +\n                            '<output value=\"#case/dob\" />'\n                        );\n                        assert.strictEqual($widget.find(\".label-datanode-external-unknown\").length, 1);\n                        assert.strictEqual($widget.find(\".label-datanode-external\").length, 1);\n                        assert.strictEqual($widget.find(\".label-datanode-unknown\").length, 1);\n                    });\n                });\n\n                it(\"should have native spellchecking on labels\", function () {\n                    assert.strictEqual($('[name=itext-en-label]').attr('spellcheck'), 'true');\n                });\n\n                it(\"should not have native spellchecking on xpaths\", function () {\n                    assert.strictEqual($('[name=property-relevantAttr]').attr('spellcheck'), 'false');\n                });\n            });\n\n            describe(\"popovers\", function () {\n                before(function (done) {\n                    util.init({\n                        javaRosa: {langs: ['en']},\n                        form: \"\",\n                        core: { onReady: function () { done(); } },\n                        features: {\n                            rich_text: true,\n                            disable_popovers: false,\n                        },\n                    });\n                });\n\n                it(\"should not change saved state\", function (done) {\n                    util.loadXML(BURPEE_XML);\n                    assert(!util.saveButtonEnabled(), \"Save button should not be enabled\");\n                    util.clickQuestion(\"total_num_burpees\");\n                    var widget = util.getWidget('property-calculateAttr');\n                    widget.input.promise.then(function () {\n                        assert(!util.saveButtonEnabled(), \"Save button should not be enabled\");\n                        done();\n                    });\n                });\n\n                it(\"should show xpath and tree reference link on popover\", function (done) {\n                    util.loadXML(BURPEE_XML);\n                    util.clickQuestion(\"total_num_burpees\");\n                    var widget = util.getWidget('property-calculateAttr');\n                    widget.input.promise.then(function () {\n                        var bubble = $('.cke_widget_drag_handler_container').children('img').first();\n                        assert(bubble.length, \"No bubbles detected\");\n                        $(document).one('shown.bs.popover', function() {\n                            try {\n                                var $popover = $('.popover-content').last();\n                                assert.strictEqual($popover.find('p').first().text(),\n                                                   \"How many burpees did you do on #form/new_burpee_data/burpee_date ?\");\n                                var $link = $popover.find(\"a\");\n                                assert($link.length);\n                                $link.click();\n                                assert.strictEqual($(\".jstree-hovered\").length, 1);\n                                done();\n                            } finally {\n                                $(\".popover\").remove();\n                            }\n                        });\n                        bubble.mouseenter();\n                    });\n                });\n\n                it(\"should expand tree on click show in question list\", function (done) {\n                    util.paste([\n                        [\"id\", \"type\", \"relevantAttr\"],\n                        [\"/group\", \"Group\", \"null\"],\n                        [\"/group/text\", \"Text\", \"null\"],\n                        [\"/text\", \"Text\", '#form/group/text'],\n                    ]);\n                    var group = util.getMug(\"group\");\n                    util.collapseGroup(group);\n                    util.clickQuestion(\"text\");\n                    var widget = util.getWidget('property-relevantAttr');\n                    widget.input.promise.then(function () {\n                        var bubble = $('.cke_widget_drag_handler_container').children('img').first();\n                        assert(bubble.length, \"No bubbles detected\");\n                        $(document).one('shown.bs.popover', function() {\n                            try {\n                                var $popover = $('.popover-content:last');\n                                var $link = $popover.find(\"a\");\n                                assert.strictEqual($(\".jstree-hovered\").length, 0);\n                                assert($link.length);\n                                $link.click();\n                                assert.strictEqual($(\".jstree-hovered\").length, 1);\n                                done();\n                            } finally {\n                                $(\".popover\").remove();\n                            }\n                        });\n                        bubble.mouseenter();\n                    });\n                });\n\n                it(\"should show case property description on popover\", function (done) {\n                    util.loadXML();\n                    var mug = util.addQuestion(\"Text\", \"text\");\n                    mug.p.calculateAttr = \"#case/dob\";\n                    util.clickQuestion(\"text\");\n                    var widget = util.getWidget('property-calculateAttr');\n                    widget.input.promise.then(function () {\n                        var bubble = $('.cke_widget_drag_handler_container').children('img').first();\n                        assert(bubble.length, \"No bubbles detected\");\n                        $(document).one('shown.bs.popover', function() {\n                            try {\n                                var $popover = $('.popover-content:last');\n                                assert.equal($popover.find('p:first').text(), \"Date of Birth\");\n                                done();\n                            } finally {\n                                $(\".popover\").remove();\n                            }\n                        });\n                        bubble.mouseenter();\n                    });\n                });\n\n                it(\"should split long text in case property descriptions\", function (done) {\n                    util.loadXML();\n                    var mug = util.addQuestion(\"Text\", \"text\");\n                    mug.p.calculateAttr = \"#case/long\";\n                    let expected = \"Property with a_very_long_word_in_the_description_that_ex\\n\\nceeds_43_chars\";\n                    util.clickQuestion(\"text\");\n                    var widget = util.getWidget('property-calculateAttr');\n                    widget.input.promise.then(function () {\n                        var bubble = $('.cke_widget_drag_handler_container').children('img').first();\n                        assert(bubble.length, \"No bubbles detected\");\n                        $(document).one('shown.bs.popover', function() {\n                            try {\n                                var $popover = $('.popover-content:last');\n                                assert.equal($popover.find('p:first').text(), expected);\n                                done();\n                            } finally {\n                                $(\".popover\").remove();\n                            }\n                        });\n                        bubble.mouseenter();\n                    });\n                });\n\n                it(\"should destroy popover on destroy widget\", function (done) {\n                    util.loadXML(BURPEE_XML);\n                    util.clickQuestion(\"total_num_burpees\");\n                    var widget = util.getWidget('property-calculateAttr');\n                    widget.input.promise.then(function () {\n                        var bubble = $('.cke_widget_drag_handler_container').children('img').first();\n                        assert(bubble.length, \"No bubbles detected\");\n                        $(document).one('shown.bs.popover', function() {\n                            try {\n                                var $popover = $('.popover-content:last p:first');\n                                assert.strictEqual($popover.text(),\n                                    \"How many burpees did you do on #form/new_burpee_data/burpee_date ?\");\n\n                                widget.input.ckeditor().editor.widgets.destroyAll();\n                                // popover destroy just fades the popover\n                                assert.strictEqual($('.popover:not(.fade)').length, 0);\n                                done();\n                            } finally {\n                                $(\".popover\").remove();\n                            }\n                        });\n                        bubble.mouseenter();\n                    });\n                });\n\n                it(\"should not error on unknown question ref\", function (done) {\n                    util.loadXML(\"\");\n                    util.addQuestion(\"Text\", \"text\");\n                    var widget = util.getWidget('property-relevantAttr'),\n                        editor = richText.editor(widget.input);\n                    editor.on(\"instanceReady\", function () {\n                        editor.setValue(\"#form/unknown\");\n                        done();\n                    });\n                });\n\n                describe(\"for date references\", function () {\n                    var widget;\n                    before(function (done) {\n                        util.loadXML(\"\");\n                        util.paste([\n                            [\"id\", \"type\", \"labelItext:en-default\"],\n                            [\"/date\", \"Date\", \"dob\"],\n                            [\"/text\", \"Text\", \"\"],\n                        ]);\n                        util.clickQuestion(\"text\");\n                        widget = util.getWidget('itext-en-label');\n                        widget.input.promise.then(done);\n                    });\n\n                    _.each({\n                        \"#form/date\": \"#form/date (no formatting)\",\n\n                        \"format-date(date(#form/date), '%e/%n/%y')\":\n                            \"#form/date (d/m/yy)\",\n\n                        \"format-date(date(#form/date), '%a, %b %e, %Y')\":\n                            \"#form/date (ddd, mmm d, yyyy)\",\n\n                    }, function (desc, xpath) {\n                        it(\"should show \" + desc + \" on popover\", function (done) {\n                            var editor = richText.editor(widget.input),\n                                output = '<output value=\"' + xpath + '\" />';\n                            editor.setValue(output, function () {\n                                var bubble = widget.input\n                                        .find('.cke_widget_drag_handler_container')\n                                        .children('img').first(),\n                                    $desc;\n                                assert(bubble.length, \"No bubbles detected\");\n\n                                $(document).one('shown.bs.popover', function() {\n                                    $desc = $('.popover-title .text-muted');\n                                    try {\n                                        assert.equal($desc.text(), desc);\n\n                                        // check for format selector link\n                                        assert.equal($desc.find('a').text(), /\\((.*)\\)/.exec(desc)[1]);\n                                        done();\n                                    } finally {\n                                        $(\".popover\").remove();\n                                    }\n                                });\n\n                                bubble.mouseenter();\n                            });\n                        });\n                    });\n                });\n            });\n        });\n    });\n});\n","define([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'underscore',\n    'vellum/saveToCase',\n    'static/saveToCase/create_property.xml',\n    'static/saveToCase/close_property.xml',\n    'static/saveToCase/update_property.xml',\n    'static/saveToCase/index_property.xml',\n    'static/saveToCase/attachment_property.xml',\n    'static/saveToCase/case_type_property.xml',\n    'static/saveToCase/create_2_property.xml',\n    'static/saveToCase/logic_test.xml',\n    'static/saveToCase/two-same-name.xml',\n], function (\n    util,\n    chai,\n    $,\n    _,\n    saveToCase,\n    CREATE_PROPERTY_XML,\n    CLOSE_PROPERTY_XML,\n    UPDATE_PROPERTY_XML,\n    INDEX_PROPERTY_XML,\n    ATTACHMENT_PROPERTY_XML,\n    CASE_TYPE_PROPERTY_XML,\n    CREATE_2_PROPERTY_XML,\n    LOGIC_TEST_XML,\n    TWO_SAME_NAME_XML\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"The SaveToCase module\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n            });\n        });\n\n        it(\"should load and save a create property\", function () {\n            util.loadXML(CREATE_PROPERTY_XML);\n            var create = util.getMug(\"save_to_case\"),\n                props = create.p.createProperty;\n            assert.equal(props.case_type.calculate, \"caseType\");\n            assert.equal(props.case_name.calculate, \"/data/name\");\n            assert.equal(create.p.useCreate, true);\n            assert.equal(props.owner_id.calculate, '/data/meta/userID');\n            assert.equal(create.p.date_modified, '/data/meta/timeEnd');\n            assert.equal(create.p.user_id, \"/data/meta/userID\");\n            util.assertXmlEqual(call(\"createXML\"), CREATE_PROPERTY_XML);\n        });\n\n        it(\"should load and save a close property\", function () {\n            util.loadXML(CLOSE_PROPERTY_XML);\n            var close = util.getMug(\"save_to_case\");\n            assert.equal(close.p.useClose, true);\n            assert.equal(close.p.closeCondition, \"1=1\");\n            assert.equal(close.p.date_modified, '/data/meta/timeEnd');\n            assert.equal(close.p.user_id, \"/data/meta/userID\");\n            assert.equal(close.p.case_id, \"/data/meta/caseID\");\n            util.assertXmlEqual(call(\"createXML\"), CLOSE_PROPERTY_XML);\n        });\n\n        it(\"should load and save a update property\", function () {\n            util.loadXML(UPDATE_PROPERTY_XML);\n            var update = util.getMug(\"save_to_case\");\n            assert.equal(update.p.useUpdate, true);\n            assert(_.isEqual(update.p.updateProperty, {\n                name: {\n                    relevant: \"/data/name != ''\",\n                    calculate: \"/data/name\"\n                },\n                \"dash-dash\": {\n                    calculate: \"'-'\",\n                },\n            }));\n            assert.equal(update.p.date_modified, '/data/meta/timeEnd');\n            assert.equal(update.p.user_id, \"/data/meta/userID\");\n            assert.equal(update.p.case_id, \"/data/meta/caseID\");\n            util.assertXmlEqual(call(\"createXML\"), UPDATE_PROPERTY_XML);\n        });\n\n        it(\"should load and save a index property\", function () {\n            util.loadXML(INDEX_PROPERTY_XML);\n            var index = util.getMug(\"save_to_case\");\n            assert.equal(index.p.useIndex, true);\n            assert(_.isEqual(index.p.indexProperty, {\n                extension: {\n                    calculate: \"/data/meta/caseID\",\n                    case_type: \"extension_case\",\n                    relationship: \"extension\",\n                }\n            }));\n            util.clickQuestion('save_to_case');\n            assert.strictEqual(index.spec.indexProperty.validationFunc(index), \"pass\");\n            assert.equal(index.p.date_modified, '/data/meta/timeEnd');\n            assert.equal(index.p.user_id, \"/data/meta/userID\");\n            assert.equal(index.p.case_id, \"/data/meta/caseID\");\n            util.assertXmlEqual(call(\"createXML\"), INDEX_PROPERTY_XML);\n        });\n\n        it(\"should load and save a attachment property\", function () {\n            util.loadXML(ATTACHMENT_PROPERTY_XML);\n            var attach = util.getMug(\"save_to_case\");\n            assert.equal(attach.p.useAttachment, true);\n            assert(_.isEqual(attach.p.attachmentProperty, {\n                attach: {\n                    calculate: \"/data/question1\",\n                    from: \"local\",\n                    name: \"name\",\n                }\n            }));\n            assert.equal(attach.p.date_modified, '/data/meta/timeEnd');\n            assert.equal(attach.p.user_id, \"/data/meta/userID\");\n            assert.equal(attach.p.case_id, \"/data/meta/caseID\");\n            util.assertXmlEqual(call(\"createXML\"), ATTACHMENT_PROPERTY_XML);\n        });\n\n        it(\"should load and save the case type property\", function () {\n            util.loadXML(CASE_TYPE_PROPERTY_XML);\n            var create = util.getMug(\"save_to_case\");\n            assert.isOk(create, \"save_to_case mug should exist\");\n            util.assertXmlEqual(call(\"createXML\"), CASE_TYPE_PROPERTY_XML);\n        });\n\n        it(\"should support two questions with same name\", function () {\n            util.loadXML(TWO_SAME_NAME_XML);\n            var one = util.getMug(\"one/save\"),\n                two = util.getMug(\"two/save\");\n            assert.equal(one.p.case_id, 'uuid()', 'one');\n            assert.equal(two.p.case_id, 'uuid()', 'two');\n        });\n\n        describe(\"should not allow\", function () {\n            var mug, spec;\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        onReady: function() {\n                            mug = util.addQuestion(\"SaveToCase\", \"mug\");\n                            spec = mug.spec.attachmentProperty;\n                            done();\n                        }\n                    },\n                });\n            });\n\n            _.each({\n                \"inline attachments with no name\": {\n                    inline_prop: {\n                        calculate: \"/data/question1\",\n                        from: \"inline\",\n                    }\n                },\n                \"invalid from strings\": {\n                    from_strings: {\n                        calculate: \"/data/question1\",\n                        from: \"blah\"\n                    }\n                },\n            }, function(v, k) {\n                it(\"should validate \" + k, function() {\n                    mug.p.useAttachment = true;\n                    mug.p.attachmentProperty = v;\n                    assert.notEqual(spec.validationFunc(mug), \"pass\");\n                });\n            });\n        });\n\n        describe(\"should allow\", function() {\n            var mug, spec;\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {\n                        onReady: function() {\n                            mug = util.addQuestion(\"SaveToCase\", \"mug\");\n                            spec = mug.spec.attachmentProperty;\n                            done();\n                        }\n                    },\n                });\n            });\n\n            _.each({\n                \"inline attachments\": {\n                    inline_prop: {\n                        calculate: \"/data/question1\",\n                        from: \"inline\",\n                        name: \"test\",\n                    }\n                },\n                \"from strings\": {\n                    from_strings: {\n                        calculate: \"/data/question1\",\n                        from: \"local\"\n                    }\n                },\n                \"hyphenated properties\": {\n                    \"hyphen-props\": {\n                        calculate: \"/data/question1\",\n                        from: \"local\"\n                    }\n                }\n            }, function(v, k) {\n                it(\"should validate \" + k, function() {\n                    mug.p.useAttachment = true;\n                    mug.p.attachmentProperty = v;\n                    assert.equal(spec.validationFunc(mug), \"pass\");\n                });\n            });\n        });\n\n        it(\"should load 2 create setvalues\", function () {\n            util.loadXML(CREATE_2_PROPERTY_XML);\n            var create1 = util.getMug(\"create1\"),\n                create2 = util.getMug(\"create2\");\n            assert.equal(create1.p.case_id, \"1\");\n            assert.equal(create2.p.case_id, \"1\");\n            util.assertXmlEqual(call(\"createXML\"), CREATE_2_PROPERTY_XML);\n        });\n\n        it(\"should load and save a index property\", function () {\n            util.loadXML(INDEX_PROPERTY_XML);\n            util.clickQuestion(\"save_to_case\");\n            $('#fd-question-edit-update').find('.fd-add-property').click();\n            util.assertXmlEqual(call(\"createXML\"), INDEX_PROPERTY_XML);\n        });\n\n        it(\"should have @case_id in bind for create when in repeat\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Repeat\", 'repeat');\n            var mug = util.addQuestion(\"SaveToCase\", 'case', {\n                case_id: 'uuid()',\n                user_id: 'uuid()',\n                useCreate: true,\n                createProperty: {\n                    'case_type': 'type',\n                    'case_name': 'name'\n                }\n            });\n            assert.deepInclude(mug.options.getBindList(mug), {\n                nodeset: mug.absolutePath + \"/case/@case_id\",\n                calculate: 'uuid()'\n            });\n        });\n\n        it(\"should remove case_id setvalue when removing create property\", function () {\n            util.loadXML(CREATE_PROPERTY_XML);\n            util.deleteQuestion('/data/save_to_case');\n            var deletedXML = call(\"createXML\");\n            assert.equal($(deletedXML).find('setvalue').length, 0);\n        });\n\n        it(\"should remove case_id setvalue when removing newly created mug\", function () {\n            util.loadXML(\"\");\n            assert.equal($(call(\"createXML\")).find('setvalue').length, 0);\n            var mug = util.addQuestion(\"SaveToCase\", 'case', {\n                case_id: 'uuid()',\n                user_id: 'uuid()',\n                useCreate: true,\n            });\n            mug.p.createProperty = {\n                'case_type': {\n                    'calculate': 'type'\n                },\n                'case_name': {\n                    'calculate': 'name',\n                },\n            };\n            assert.equal($(call(\"createXML\")).find('setvalue').length, 1);\n            util.deleteQuestion('/data/case');\n            assert.equal($(call(\"createXML\")).find('setvalue').length, 0);\n        });\n\n        it(\"should only allow extension and child as relationship\", function () {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"SaveToCase\", \"mug\");\n            mug.p.useIndex = true;\n            mug.p.indexProperty = {\n                \"casename\": {\n                    calculate: \"/data/question1\",\n                    case_type: \"type\",\n                    relationship: \"notchildorextension\",\n                }\n            };\n            assert.strictEqual(mug.spec.indexProperty.validationFunc(mug), \"Relationship must be child or extension\");\n        });\n\n        it(\"should only not error on empty extension ref\", function () {\n            util.loadXML(\"\");\n            var mug = util.addQuestion(\"SaveToCase\", \"mug\");\n            mug.p.useIndex = true;\n            mug.p.indexProperty = {\n                \"casename\": {\n                    calculate: \"/data/question1\",\n                    case_type: \"type\",\n                    relationship: \"child\",\n                },\n                \"\": {\n                    calculate: \"\",\n                    case_type: \"\",\n                    relationship: \"\",\n                },\n\n            };\n            assert.strictEqual(mug.spec.indexProperty.validationFunc(mug), \"pass\");\n        });\n\n        it(\"should provide case references to the logic manager\", function () {\n            var form = util.loadXML(LOGIC_TEST_XML),\n                manager = form._logicManager;\n            assert.deepEqual(manager.caseReferences(), {\n                load: {},\n                save: {\n                    \"/data/group/save_to_case_in_group\": {\n                        \"case_type\": \"child\",\n                        \"close\": false,\n                        \"create\": false,\n                        \"properties\": [\n                            \"p1\",\n                            \"p3\"\n                        ]\n                    },\n                    \"/data/save_to_case_create\": {\n                        \"case_type\": \"mother\",\n                        \"close\": false,\n                        \"create\": true,\n                        \"properties\": [\n                            \"case_name\",\n                            \"case_type\",\n                            \"p1\",\n                            \"p2\"\n                        ]\n                    },\n                    \"/data/save_to_case_close\": {\n                        \"case_type\": \"close_case\",\n                        \"close\": true,\n                        \"create\": false,\n                        \"properties\": []\n                    }\n                }\n            });\n        });\n    });\n});\n","define([\n    'tests/utils',\n    'chai',\n    'jquery',\n    'vellum/xml',\n    'static/setvalue/set-value.xml',\n    'static/setvalue/set-value-special.xml'\n], function (\n    util,\n    chai,\n    $,\n    xml,\n    SET_VALUE_XML,\n    SET_VALUE_SPECIAL_XML\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"setvalues\", function() {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"should be associated with the correct mug on form load\", function() {\n            util.loadXML(SET_VALUE_XML);\n            var text = util.getMug('text');\n            assert.strictEqual(text.p.defaultValue, 'blah');\n        });\n\n        it(\"should have event jr-insert when added into repeat\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Repeat\", 'repeat');\n            var text = util.addQuestion(\"Text\", 'text'),\n                form, setvalue;\n\n            text.p.defaultValue = 'blah';\n\n            form = call(\"createXML\");\n            setvalue = xml.parseXML(form).find('setvalue');\n\n            assert.strictEqual(setvalue.attr('event'), 'jr-insert');\n            assert.strictEqual(setvalue.attr('ref'), '/data/repeat/text');\n            assert.strictEqual(setvalue.attr('value'), 'blah');\n        });\n\n        it(\"should have event xforms-ready when added outside of repeat\", function() {\n            util.loadXML(\"\");\n            var text = util.addQuestion(\"Text\", 'text'),\n                form, setvalue;\n\n            text.p.defaultValue = 'blah';\n\n            form = call(\"createXML\");\n            setvalue = xml.parseXML(form).find('setvalue');\n\n            assert.strictEqual(setvalue.attr('event'), 'xforms-ready');\n            assert.strictEqual(setvalue.attr('ref'), '/data/text');\n            assert.strictEqual(setvalue.attr('value'), 'blah');\n        });\n\n        it(\"should not be associated with a question if event is not xforms-ready or jr-insert\", function() {\n            util.loadXML(SET_VALUE_SPECIAL_XML);\n            var form = call(\"createXML\"),\n                setvalue = xml.parseXML(form).find('setvalue');\n            assert.strictEqual(setvalue.attr('event'), 'special-snowflake');\n            assert.strictEqual(setvalue.attr('ref'), '/data/text');\n            assert.strictEqual(setvalue.attr('value'), 'blah');\n        });\n\n        describe(\"with allow data reference enabled\", function () {\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {onReady: function () { done(); }},\n                    features: {\n                        rich_text: false,\n                        allow_data_reference_in_setvalue: true,\n                    },\n                });\n            });\n            it(\"should not warn when referencing another node\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'text1');\n                var text2 = util.addQuestion(\"Text\", 'text2');\n                text2.p.defaultValue = '#form/text1';\n                assert.strictEqual(text2.spec.defaultValue.validationFunc(text2), 'pass');\n            });\n\n            it(\"should not warn when referencing a case\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'text1');\n                var text2 = util.addQuestion(\"Text\", 'text2');\n                text2.p.defaultValue = \"#case/case/attribute\";\n                assert.strictEqual(text2.spec.defaultValue.validationFunc(text2), 'pass');\n            });\n\n            it(\"should not warn when referencing a case with filter\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'text1');\n                var text2 = util.addQuestion(\"Text\", 'text2');\n                text2.p.defaultValue = \"instance('casedb')/casedb/case[@case_id=instance('commcaresession')/session/data/case_id]/facility_type\";\n                assert.strictEqual(text2.spec.defaultValue.validationFunc(text2), 'pass');\n            });\n        });\n\n        describe(\"without allow data reference enabled\", function () {\n            before(function (done) {\n                util.init({\n                    javaRosa: {langs: ['en']},\n                    core: {onReady: function () { done(); }},\n                    features: {\n                        rich_text: false,\n                        allow_data_reference_in_setvalue: false,\n                    },\n                });\n            });\n            it(\"should warn when referencing another node\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'text1');\n                var text2 = util.addQuestion(\"Text\", 'text2');\n                text2.p.defaultValue = '#form/text1';\n                assert.notStrictEqual(text2.spec.defaultValue.validationFunc(text2), 'pass');\n            });\n\n            it(\"should not warn when referencing a case\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'text1');\n                var text2 = util.addQuestion(\"Text\", 'text2');\n                text2.p.defaultValue = \"#case/case/attribute\";\n                assert.strictEqual(text2.spec.defaultValue.validationFunc(text2), 'pass');\n            });\n\n            it(\"should not warn when referencing a case with filter\", function() {\n                util.loadXML(\"\");\n                util.addQuestion(\"Text\", 'text1');\n                var text2 = util.addQuestion(\"Text\", 'text2');\n                text2.p.defaultValue = \"instance('casedb')/casedb/case[@case_id=instance('commcaresession')/session/data/case_id]/facility_type\";\n                assert.strictEqual(text2.spec.defaultValue.validationFunc(text2), 'pass');\n            });\n        });\n    });\n});\n","/*jshint multistr: true */\ndefine([\n    'chai',\n    'vellum/tsv'\n], function (\n    chai,\n    tsv\n) {\n    var assert = chai.assert;\n\n    function parseRows(value, limit) {\n        var rows = [],\n            next = tsv.makeRowParser(value),\n            row = next();\n        while (row) {\n            rows.push(row);\n            if (limit && rows.length >= limit) { break; }\n            row = next();\n        }\n        return rows;\n    }\n\n    function eq(value, parsed, roundTrip) {\n        var repr = value\n                    .replace(/\\r/g, \"\\\\r\")\n                    .replace(/\\n/g, \"\\\\n\")\n                    .replace(/\\t/g, \"\\\\t\");\n        assert.deepEqual(parseRows(value, parsed.length + 5), parsed,\n                         \"parsed '\" + repr + \"'\");\n        if (roundTrip) {\n            assert.strictEqual(tsv.tabDelimit(parsed), value);\n        }\n    }\n\n    describe(\"The TSV parser\", function () {\n\n        it(\"should parse empty string\", function () {\n            eq(\"\", [], true);\n        });\n\n        it(\"should parse simple TSV\", function () {\n            eq('a\\tb', [['a', 'b']], true);\n            eq('a\\tb\\r', [['a', 'b']]);\n            eq('a\\tb\\n', [['a', 'b']]);\n            eq('a\\tb\\u2028', [['a', 'b']]);\n            eq('a\\tb\\u2029', [['a', 'b']]);\n            eq('a\\tb\\r\\n', [['a', 'b']]);\n            eq('a\\tb\\n\\r', [['a', 'b'], ['']]);\n        });\n\n        it(\"should parse simple mutli-line TSV\", function () {\n            eq('a\\tb\\nc', [['a', 'b'], ['c']], true);\n            eq('a\\tb\\rc\\r', [['a', 'b'], ['c']]);\n            eq('a\\tb\\nc\\n', [['a', 'b'], ['c']]);\n            eq('a\\tb\\u2028c\\u2028', [['a', 'b'], ['c']]);\n            eq('a\\tb\\u2029c\\u2029', [['a', 'b'], ['c']]);\n            eq('a\\tb\\r\\nc\\r\\n', [['a', 'b'], ['c']]);\n            eq('a\\tb\\n\\rc\\n', [['a', 'b'], [''], ['c']]);\n        });\n\n        it(\"should parse quoted field\", function () {\n            eq('a\\t\"b\\tc\"', [['a', 'b\\tc']], true);\n            eq('\"a\"\\t\"b\\tc\"\\r', [['a', 'b\\tc']]);\n            eq('\"a\"\\t\"b\\tc\"\\n', [['a', 'b\\tc']]);\n            eq('\"a\"\\t\"b\\tc\"\\u2028', [['a', 'b\\tc']]);\n            eq('\"a\"\\t\"b\\tc\"\\u2029', [['a', 'b\\tc']]);\n            eq('\"a\"\\t\"b\\tc\"\\r\\n', [['a', 'b\\tc']]);\n            eq('\"a\"\\t\"b\\tc\"\\n\\r', [['a', 'b\\tc'], ['']]);\n\n            eq('\"a\"\\t\"b\\tc\"\\n\"a\"\\t\"b\\tc\"\\n', [['a', 'b\\tc'], ['a', 'b\\tc']]);\n        });\n\n        it(\"should parse empty quoted field\", function () {\n            eq('\"\"\\t\"\"\\n', [['', '']]);\n        });\n\n        it(\"should parse quoted field with escaped quotes\", function () {\n            eq('\"a\"\"x\"\\t\"b\"\"\\t\"\"c\"', [['a\"x', 'b\"\\t\"c']], true);\n            eq('\"a\"\"x\"\\t\"b\"\"\"\"\"\"c\"', [['a\"x', 'b\"\"\"c']], true);\n\n            eq('\"a\"\"x\"\\t\"b\"\"\\t\"\"c\"\\n\"a\"\"x\"\\t\"b\"\"\\t\"\"c\"',\n                [['a\"x', 'b\"\\t\"c'], ['a\"x', 'b\"\\t\"c']], true);\n        });\n\n        it(\"should parse quoted multi-line field\", function () {\n            eq('\"a\"\"x\"\\t\"b\\nc\\rd\\r\\ne\"', [['a\"x', 'b\\nc\\rd\\r\\ne']], true);\n            eq('\"a\"\"x\"\\t\"b\\u2028c\\u2029d\"', [['a\"x', 'b\\u2028c\\u2029d']], true);\n\n            eq('\"a\"\"x\"\\t\"b\\nc\\rd\\r\\ne\"\\n\"a\"\"x\"\\t\"b\\nc\\rd\\r\\ne\"',\n                [['a\"x', 'b\\nc\\rd\\r\\ne'], ['a\"x', 'b\\nc\\rd\\r\\ne']], true);\n        });\n\n        it(\"should parse malformed quoted field\", function () {\n            eq('abc\\t\"def\"ghi\\t\"jkl', [['abc', '\"def\"ghi', '\"jkl']]);\n            eq('abc\\t\"def\"ghi\"\\t\"jkl', [['abc', '\"def\"ghi\"', '\"jkl']]);\n            eq('abc\\t\"def\\t\"ghi\\t\"jkl', [['abc', '\"def', '\"ghi', '\"jkl']]);\n\n            // Excel produces this, we do not\n            //eq('abc\\t\"def\"ghi\"\"\\t\"jkl', [['abc', '\"def\"ghi\"\"\\t\"jkl']]);\n        });\n\n    });\n\n    describe(\"The TSV writer\", function () {\n\n        it(\"should convert null to empty string\", function () {\n            assert.strictEqual(tsv.escape(null), \"\");\n        });\n\n        it(\"should convert undefined to empty string\", function () {\n            (function (undefined) {\n                assert.strictEqual(tsv.escape(undefined), \"\");\n            })();\n        });\n\n        it(\"should not convert zero to empty string\", function () {\n            assert.strictEqual(tsv.escape(0), \"0\");\n        });\n\n        it(\"should escape special characters\", function () {\n            var rows = [\n                    ['\"\"', '\\t\\t\\t', '\\n\\n\\n', '\\r\\r\\r', ''],\n                    ['  '] // space is not a special character\n                ],\n                encoded = '\"\"\"\"\"\"\\t\"\\t\\t\\t\"\\t\"\\n\\n\\n\"\\t\"\\r\\r\\r\"\\t\\n  ';\n            assert.strictEqual(tsv.tabDelimit(rows), encoded);\n\n            // test round-trip for good measure\n            eq(encoded, rows, true);\n        });\n    });\n});\n","define([\n    'chai',\n    'tests/utils',\n    'jquery',\n], function (\n    chai,\n    util,\n    $\n) {\n    var assert = chai.assert;\n\n    describe(\"The undo manager\", function () {\n        before(function(done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: { onReady: function () { done(); } },\n                features: {rich_text: false},\n            });\n        });\n\n        beforeEach(function() {\n            util.loadXML(\"\");\n        });\n\n        it(\"should show an alert when deleting questions\", function () {\n            util.addQuestion('Text', 'text');\n            $('.fd-button-remove').click();\n            assert($('.fd-undo-delete').length);\n        });\n\n        it(\"should undelete one question properly\", function () {\n            util.addQuestion('Text', 'text');\n            $('.fd-button-remove').click();\n            try {\n                util.clickQuestion('text');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            util.clickQuestion('text');\n            assert(true, \"Woo! text restored\");\n        });\n\n        it(\"should undelete two questions properly\", function () {\n            util.addQuestion('Text', 'text');\n            util.addQuestion('Text', 'text2');\n            util.clickQuestion('text', 'text2');\n            util.assertJSTreeState(\"text\", \"text2\");\n            $('.fd-button-remove').click();\n            try {\n                util.clickQuestion('text');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            util.clickQuestion('text');\n            util.assertJSTreeState(\"text\", \"text2\");\n        });\n\n        it(\"should undelete a nested question properly\", function () {\n            util.addQuestion('Group', 'group');\n            util.addQuestion('Text', 'text2');\n            util.assertJSTreeState(\"group\", \"  text2\");\n            util.clickQuestion('group/text2');\n            $('.fd-button-remove').click();\n            try {\n                util.clickQuestion('text2');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            util.clickQuestion('group/text2');\n            util.assertJSTreeState(\"group\", \"  text2\");\n        });\n\n        it(\"should undelete a group properly\", function () {\n            util.addQuestion('Group', 'group');\n            util.addQuestion('Text', 'text2');\n            util.assertJSTreeState(\"group\", \"  text2\");\n            util.clickQuestion('group');\n            $('.fd-button-remove').click();\n            util.assertJSTreeState();\n            try {\n                util.clickQuestion('text2');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            util.clickQuestion('group/text2');\n            util.assertJSTreeState(\"group\", \"  text2\");\n        });\n\n        it(\"should undelete a nested group properly\", function () {\n            util.addQuestion('Group', 'group');\n            util.addQuestion('Group', 'group2');\n            util.addQuestion('Text', 'text2');\n            util.assertJSTreeState(\"group\", \"  group2\", \"    text2\");\n            util.clickQuestion('group/group2');\n            $('.fd-button-remove').click();\n            util.assertJSTreeState(\"group\");\n            try {\n                util.clickQuestion('group2');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            util.clickQuestion('group/group2/text2');\n            util.assertJSTreeState(\"group\", \"  group2\", \"    text2\");\n        });\n\n        it(\"should undelete a question with question after it\", function () {\n            util.addQuestion('Text', 'text');\n            util.addQuestion('Text', 'text2');\n            util.clickQuestion('text');\n            util.assertJSTreeState(\"text\", \"text2\");\n            $('.fd-button-remove').click();\n            try {\n                util.clickQuestion('text');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            util.clickQuestion('text');\n            util.assertJSTreeState(\"text\", \"text2\");\n        });\n\n        it(\"should undelete the first question\", function () {\n            util.addQuestion('Text', 'text');\n            util.clickQuestion('text');\n            util.assertJSTreeState(\"text\");\n            $('.fd-button-remove').click();\n            try {\n                util.clickQuestion('text');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            assert(!$('.fd-default-panel').is(':visible'), \"New Form dialog showing\");\n            util.assertJSTreeState(\"text\");\n        });\n\n        it(\"should undelete a multiple choice question with correct number of children\", function () {\n            util.addQuestion('Select', 'select');\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.addQuestion(\"Choice\", \"choice2\");\n            util.clickQuestion('select');\n            util.assertJSTreeState(\"select\", \"  choice1\", \"  choice2\");\n            $('.fd-button-remove').click();\n            try {\n                util.clickQuestion('select');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            util.clickQuestion('select');\n            util.assertJSTreeState(\"select\", \"  choice1\", \"  choice2\");\n        });\n\n        it(\"should undelete multiple questions when selected out of order\", function () {\n            util.addQuestion('Text', 'text');\n            util.addQuestion('Text', 'text2');\n            util.addQuestion('Text', 'text3');\n            util.clickQuestion('text3', 'text2');\n            util.assertJSTreeState(\"text\", \"text2\", \"text3\");\n            $('.fd-button-remove').click();\n            util.assertJSTreeState(\"text\");\n            $('.fd-undo').click();\n            util.assertJSTreeState(\"text\", \"text2\", \"text3\");\n        });\n\n        it(\"should reset the undo manager after a delete\", function () {\n            util.addQuestion('Text', 'text');\n            util.addQuestion('Select', 'select');\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.addQuestion(\"Choice\", \"choice2\");\n            util.assertJSTreeState('text', 'select', '  choice1', '  choice2');\n            util.clickQuestion('text');\n            $('.fd-button-remove').click();\n            util.assertJSTreeState('select', '  choice1', '  choice2');\n            util.clickQuestion('select');\n            $('.fd-button-remove').click();\n            util.assertJSTreeState();\n            $('.fd-undo').click();\n            util.assertJSTreeState('select', '  choice1', '  choice2');\n        });\n\n        it(\"should reset the undo manager after adding a question\", function () {\n            util.addQuestion('Text', 'text');\n            util.addQuestion('Select', 'select');\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.addQuestion(\"Choice\", \"choice2\");\n            util.assertJSTreeState('text', 'select', '  choice1', '  choice2');\n            util.clickQuestion('text');\n            $('.fd-button-remove').click();\n            util.assertJSTreeState('select', '  choice1', '  choice2');\n            util.addQuestion('Text', 'text');\n            assert.strictEqual($('.fd-undo-delete').length, 0);\n        });\n\n        it(\"should undelete a multiple choice question when selected with others\", function() {\n            util.addQuestion('Text', 'text');\n            util.addQuestion('Select', 'select');\n            util.addQuestion(\"Choice\", \"choice1\");\n            util.addQuestion(\"Choice\", \"choice2\");\n            util.clickQuestion('text', 'select');\n            util.assertJSTreeState('text', \"select\", \"  choice1\", \"  choice2\");\n            $('.fd-button-remove').click();\n            try {\n                util.clickQuestion('select');\n                assert(false, \"this better not work\");\n            } catch (err) {\n                assert(true, \"text doesn't exist\");\n            }\n            $('.fd-undo').click();\n            util.clickQuestion('select');\n            util.assertJSTreeState('text', \"select\", \"  choice1\", \"  choice2\");\n        });\n\n        it(\"should adjust the tree's height to accommodate the undo alert message\", function () {\n            var getHeight = function() { return $(\".fd-tree .fd-scrollable\").outerHeight(); };\n            util.addQuestion('Text', 'text');\n            util.addQuestion('Select', 'select');\n            util.clickQuestion('text');\n\n            var heightWithoutAlert = getHeight();\n            $('.fd-button-remove').click();\n            var heightWithAlert = getHeight();\n\n            assert(heightWithAlert !== heightWithoutAlert, \"Height changed with addition of alert.\");\n            $(\".fd-undo\").click();\n            assert(getHeight() === heightWithoutAlert, \"Height restored after undoing deletion.\");\n            $('.fd-button-remove').click();\n            assert(getHeight() === heightWithAlert, \"Height changed with addition of alert.\");\n            $(\".fd-undo-delete .close\").click();\n            assert(getHeight() === heightWithoutAlert, \"Height restored after closing alert.\");\n        });\n\n        it(\"should fix broken references on undelete referenced question\", function () {\n            util.addQuestion(\"Text\", \"red\");\n            var blue = util.addQuestion(\"Text\", \"blue\", {relevantAttr: \"#form/red = '1'\"});\n            util.deleteQuestion(\"red\");\n            assert(!util.isTreeNodeValid(blue), \"blue should have reference error\");\n            blue.form.undo();\n            assert(util.isTreeNodeValid(blue), \"blue should be valid\");\n        });\n    });\n});\n","require([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'static/core/group-rename.xml'\n], function (\n    chai,\n    $,\n    _,\n    util,\n    GROUP_RENAME_XML\n) {\n    var assert = chai.assert,\n        call = util.call;\n\n    describe(\"URL Hash\", function() {\n        it(\"should select a mug that is in the form\", function() {\n            window.location.hash = '#form/group/question2';\n            util.loadXML(GROUP_RENAME_XML, null, null, true);\n            var mug = call(\"getCurrentlySelectedMug\");\n            assert.equal(mug.absolutePath, \"/data/group/question2\");\n        });\n\n        it(\"should select first mug if hash isn't in form\", function() {\n            window.location.hash = '#form/group/not_in_form';\n            util.loadXML(GROUP_RENAME_XML, null, null, true);\n            var mug = call(\"getCurrentlySelectedMug\");\n            assert.equal(mug.absolutePath, \"/data/group\");\n        });\n\n        it(\"should change the hash when you add a question\", function() {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"initial\");\n            util.clickQuestion(\"initial\");\n            assert.equal(window.location.hash, \"#form/initial\");\n        });\n\n        it(\"should change the hash when you delete a question\", function() {\n            util.loadXML(\"\");\n\n            util.addQuestion(\"Text\", \"first\");\n            util.clickQuestion(\"first\");\n\n            util.addQuestion(\"Text\", \"second\");\n            util.clickQuestion(\"second\");\n\n            assert.equal(window.location.hash, \"#form/second\");\n\n            util.deleteQuestion(\"/data/second\");\n\n            assert.equal(window.location.hash, \"#form/first\");\n        });\n\n        it(\"should call setURLHash only once when multiple questions are loaded\", function(done) {\n\n            var fnCallCount = 0;\n            util.loadXML(\"\");\n\n            var q1 = util.addQuestion(\"Text\", \"first\");\n            util.clickQuestion(\"first\");\n\n            util.addQuestion(\"Text\", \"second\");\n            util.clickQuestion(\"second\");\n\n            // Patching _setURLHash with a custom function\n            // which will tell how many times it was called\n            var originalFn = q1.form.vellum._setURLHash;\n            q1.form.vellum._setURLHash = function() {\n                fnCallCount++;\n            };\n            util.saveAndReload(function() {\n                q1.form.vellum._setURLHash = originalFn;\n                assert.equal(fnCallCount, 1);\n                done();\n            });\n        });\n    });\n});\n","define([\n    './options',\n    'chai',\n    'equivalent-xml-js/src/equivalent-xml',\n    'jsdiff/diff',\n    'underscore',\n    'jquery',\n    'vellum/copy-paste',\n    'vellum/tsv',\n    'vellum/widgets',\n    'vellum/xml',\n    'jstree',\n    'jquery.vellum'\n], function (\n    options,\n    chai,\n    EquivalentXml,\n    jsdiff,\n    _,\n    $,\n    copypaste,\n    tsv,\n    widgets,\n    xml\n) {\n    var assert = chai.assert,\n        savedForm = null,\n        saveCount = 0,\n        PASTE_HEADER = [\"Form Builder clip\", \"version 1\"];\n\n    // monkey-patch chai to use ===/!== instead of ==/!= in assert.equal\n    assert.equal = assert.strictEqual;\n    assert.notEqual = assert.notStrictEqual;\n\n    function xmlEqual(str1, str2) {\n        var xml1 = EquivalentXml.xml(str1),\n            xml2 = EquivalentXml.xml(str2);\n        return EquivalentXml.isEquivalent(xml1, xml2, {element_order: true});\n    }\n\n    function assertXmlEqual(actual, expected, opts) {\n        opts = _.defaults(opts || {}, {\n            normalize_xmlns: false,\n            not: false,\n        });\n        if (opts.normalize_xmlns) {\n            var xmlns = xml.parseXML(expected).find('data').attr('xmlns');\n            actual = actual.replace(/(data[^>]+xmlns=\")(.+?)\"/,\n                                    '$1' + xmlns + '\"');\n        }\n        var result = xmlEqual(actual, expected);\n        if (opts.not) {\n            result = !result;\n        }\n        if (!result) {\n            actual = cleanForDiff(actual);\n            expected = cleanForDiff(expected);\n            assertEqual(actual, expected,\n                \"XML \" + (opts.not ? \"should not be equivalent\" : \"mismatch\"));\n        }\n    }\n\n    function assertXmlNotEqual(actual, expected, opts) {\n        opts = opts || {};\n        opts.not = true;\n        assertXmlEqual(actual, expected, opts);\n    }\n\n    function assertJSTreeState() {\n        function repr(node, level) {\n            var i, len, child, items = [];\n            if (node.id === \"#\") {\n                level = -1;\n            } else {\n                items.push(Array(level * 2 + 1).join(\" \") + node.text);\n            }\n            for (i = 0, len = node.children.length; i < len; i++) {\n                child = call(\"jstree\", \"get_node\", node.children[i]);\n                items.push(repr(child, level + 1));\n            }\n            return items.join(\"\\n\");\n        }\n        var expected = Array.prototype.slice.call(arguments).join(\"\\n\") + \"\\n\",\n            actual = repr(call(\"jstree\", \"get_node\", \"#\")) + \"\\n\";\n        assertEqual(actual, expected, \"Unexpected jstree state\");\n    }\n\n    function assertTreeState(tree) {\n        function repr(node, level) {\n            var i, len, child, items = [];\n            if (node.isRootNode) {\n                level = -1;\n            } else {\n                items.push(Array(level * 2 + 1).join(\" \") + node.value.p.nodeID);\n            }\n            for (i = 0, len = node.children.length; i < len; i++) {\n                child = node.children[i];\n                items.push(repr(child, level + 1));\n            }\n            return items.join(\"\\n\");\n        }\n        var expected = Array.prototype.slice.call(arguments, 1).join(\"\\n\") + \"\\n\",\n            actual = repr(tree.rootNode, 0) + \"\\n\";\n        assertEqual(actual, expected, \"Unexpected tree state\");\n    }\n\n    /**\n     * Assert equality, diff actual/expected if unequal\n     */\n    function assertEqual(actual, expected, message) {\n        if (actual !== expected) {\n            var patch = jsdiff.createPatch(\"\", actual, expected, \"actual\", \"expected\");\n            patch = patch.replace(/^Index:/, message || \"Not equal:\");\n            assert(false, colorDiff(patch));\n        }\n    }\n\n    function cleanForDiff(value) {\n        // convert leading tabs to spaces\n        value = value.replace(/^\\t+/mg, function (match) {\n            return match.replace(/\\t/g, \"  \");\n        });\n        // add newline at end of file if missing\n        if (!value.match(/\\n$/)) {\n            value = value + \"\\n\";\n        }\n        return value;\n    }\n\n    function colorDiff(patch) {\n        var colors = {\n                \"-\": 31, // red\n                \"+\": 32  // green\n            };\n        function color(str) {\n            var code = colors[str[0]] || 0;\n            return '\\u001b[' + code + 'm' + str + '\\u001b[0m';\n        }\n        return patch.replace(/^.+?$/gm, color);\n    }\n\n    function getInput(property) {\n        return call(\"getCurrentMugInput\", property);\n    }\n\n    function getWidget(name) {\n        var vellum = $(\"#vellum\").vellum(\"get\"),\n            target = _.isString(name) ? $(\"[name=\" + name + \"]\") : name;\n        return widgets.util.getWidget(target, vellum);\n    }\n\n    function getMediaUploader($el) {\n        var media = {},\n            widget = getWidget($el),\n            $uiElem;\n        if (!widget) {\n            throw new Error(\"media uploader widget not found\");\n        }\n        _.find([\n            \".widget[data-hqmediapath]\",\n            \".itext-block-container\",\n        ], function (sel) {\n            $uiElem = $el.closest(sel);\n            return $uiElem.length;\n        });\n        if (!$uiElem) {\n            throw new Error(\"media uploader element not found\");\n        }\n\n        /**\n         * Simulate media upload\n         *\n         * The filename passed in here is used to set the extension on\n         * the media path. The new randomized media path obtained here\n         * by calling `widget.getRandomizedMediaPath(filename)` is\n         * constructed in two steps in the real media uploader:\n         *\n         * - uploader.js overrides the upload controller's `startUpload`\n         *   method to call `widget.getRandomizedMediaPath(path)` and\n         *   assign a new media path to the upload controller's\n         *   `uploadParams` object. This new media path has the same\n         *   file type extension (e.g., .jpg) as the old media path.\n         * - `BaseHQMediaUploadController.startUpload()` replaces the\n         *   old file extension with the one from the uploaded file and\n         *   then POSTs it to the upload URL. A `ref` object containing\n         *   the new media path is received in the upload response and\n         *   broadcasted in the \"mediaUploadComplete\" event data.\n         */\n        media.upload = function (filename) {\n            var path = widget.getRandomizedMediaPath(filename),\n                data = {ref: {path: path}, errors: []};\n            $uiElem.trigger(\"mediaUploadComplete\", data);\n        };\n\n        return media;\n    }\n\n    function assertInputCount(nameOrInputs, num, name) {\n        if (_.isString(nameOrInputs)) {\n            name = \" for \" + (name ? name + \" \" : \"\") + nameOrInputs;\n            nameOrInputs = getInput(nameOrInputs);\n        } else {\n            name = name ? \" for \" + name : \"\";\n        }\n        assert.equal(nameOrInputs.length, num, \"wrong number of inputs\" + name);\n    }\n\n    // initialize/reset active vellum instance\n    function init(opts) {\n        opts = opts || {};\n        var vellum_options = $.extend(true, {}, options.options, opts);\n\n        // Turn off animations for testing\n        var oldAnimate = $.fn.animate;\n        $.fn.animate = function(prop, speed, easing, callback) {\n            oldAnimate.apply(this, [prop, 0, easing, callback]);\n        };\n\n        // $.extend merges arrays :(\n        if (opts.javaRosa && opts.javaRosa.langs) {\n            vellum_options.javaRosa.langs = opts.javaRosa.langs;\n        }\n        vellum_options.plugins = _.without(vellum_options.plugins, \"atwho\");\n        if (opts.plugins) {\n            vellum_options.plugins = opts.plugins;\n        }\n        if (vellum_options && vellum_options.features &&\n            _.isUndefined(vellum_options.features.disable_popovers)) {\n            vellum_options.features.disable_popovers = true;\n        }\n        vellum_options.core = vellum_options.core || {};\n        var originalSaveUrl = vellum_options.core.saveUrl || function () {};\n        vellum_options.core.saveUrl = function (data) {\n            savedForm = data.xform;\n            saveCount++;\n            return originalSaveUrl(data);\n        };\n        var vellum = $(\"#vellum\"),\n            old = vellum.vellum(\"get\");\n        if (old) {\n            old.destroy();\n\n            $('body > div.modal, ' +\n              'body > div.modal-backdrop').remove();\n        }\n        vellum.empty().vellum(vellum_options);\n    }\n        \n    // call a method on the active instance\n    function call () {\n        var args = Array.prototype.slice.call(arguments),\n            $vellum = $(\"#vellum\");\n        return $vellum.vellum.apply($vellum, args);\n    }\n\n    // load XML syncronously\n    function loadXML(value, options, ignoreParseWarnings, maintainUrlHash) {\n        var warnings = [], data = call(\"getData\");\n        if (!maintainUrlHash){\n            window.history.replaceState(null, null, \" \");\n        }\n        data.core.parseWarnings = [];\n        call(\"loadXML\", value, options || {});\n        if (!ignoreParseWarnings) {\n            warnings = data.core.parseWarnings;\n        } else if (_.isRegExp(ignoreParseWarnings)) {\n            warnings = _.filter(data.core.parseWarnings, function (warning) {\n                return !ignoreParseWarnings.test(warning);\n            });\n        }\n        assert(!warnings.length, \"unexpected parse warnings:\\n- \" + warnings.join(\"\\n- \"));\n        delete data.core.parseWarnings;\n        return data.core.form; // return the Form object\n    }\n\n    function paste(rows, errors, print) {\n        if (!_.isString(rows)) {\n            rows = tsv.tabDelimit([PASTE_HEADER].concat(rows));\n        }\n        if (print) { window.console.log(rows); } // debugging helper\n        assert.deepEqual(copypaste.paste(rows), errors || []);\n    }\n\n    function clickQuestion() {\n        var mugs = [],\n            ufids = _.map(arguments, function (path) {\n                var mug = _.isString(path) ? getMug(path) : path;\n                if (!(mug && mug.ufid)) {\n                    throw new Error(\"mug not found: \" + path);\n                }\n                mugs.push(mug);\n                return mug.ufid;\n            });\n        call(\"jstree\", \"deselect_all\", true);\n        call(\"jstree\", \"select_node\", ufids);\n\n        // Make all question properties visible\n        $(\".collapse-toggle.collapsed\").click();\n\n        return mugs;\n    }\n\n    function selectAll() {\n        call(\"jstree\", \"select_all\");\n    }\n\n    /**\n     * Get a mug by path (even items!) from the active form\n     *\n     * @param path - The path of the item. If this is not an absolute path then\n     *               '/data/' will be prepended.\n     * @returns null if a mug with the given path is not found.\n     */\n    function getMug(path) {\n        if (path.indexOf(\"/\") !== 0) {\n            path = \"/data/\" + path;\n        }\n        var mug = call(\"getMugByPath\", path);\n        if (!mug) {\n            // look for item if the parent mug is a select\n            // not sure why getMugByPath doesn't do this... should it?\n            var elements = path.split(\"/\"),\n                parentPath = elements.slice(0, -1).join(\"/\"),\n                parent = call(\"getMugByPath\", parentPath);\n            if (parent && parent.__className.indexOf(\"Select\") > -1) {\n                var children = call(\"getData\").core.form.getChildren(parent),\n                    nodeID = elements[elements.length - 1];\n                if (children.length === 1 && nodeID === \"itemset\" &&\n                        children[0].options.tagName === \"itemset\") {\n                    return children[0];\n                }\n                for (var i = 0; i < children.length; i++) {\n                    if (children[i].p.nodeID === nodeID) {\n                        return children[i];\n                    }\n                }\n            }\n        }\n        return mug;\n    }\n\n    function deleteQuestion () {\n        var mugs = _.map(arguments, function (path) {\n                var mug = getMug(path);\n                assert(mug, \"mug not found: \" + path);\n                return mug;\n            });\n        call(\"getData\").core.form.removeMugsFromForm(mugs);\n        _.each(arguments, function (path) {\n            assert(!getMug(path), \"mug not removed: \" + path);\n        });\n    }\n\n    /**\n     * Query or set save button enabled state\n     *\n     * @param value - (opitonal) set enabled/disabled (true/false).\n     * @returns - true if the save button is enabled, otherwise false.\n     */\n    function saveButtonEnabled(value) {\n        var button = call(\"getData\").core.saveButton;\n        if (!_.isUndefined(value)) {\n            var state = value ? \"save\" : \"saved\";\n            button.setStateWhenReady(state);\n            assert.equal(button.state, state, \"sanity check failed\");\n        }\n        return button.state === \"save\";\n    }\n\n    function expandGroup(mug) {\n        call(\"jstree\", \"open_node\", mug.ufid);\n        call(\"jstree\", \"redraw_node\", mug.ufid, true, false, false);\n    }\n\n    function collapseGroup(mug) {\n        call(\"jstree\", \"close_node\", mug.ufid);\n        call(\"jstree\", \"redraw_node\", mug.ufid, true, false, false);\n    }\n\n    function getMessages(mug) {\n        var messages = [],\n            last = null;\n        if (_.isString(mug)) {\n            var path = mug;\n            mug = getMug(path);\n            assert(mug, \"mug not found: \" + path);\n        }\n        mug.messages.each(function (msg, attr) {\n            if (attr !== last) {\n                messages.push(attr + \":\");\n                last = attr;\n            }\n            messages.push(\"  - \" + msg.message); // + \" [\" + msg.key + \"]\");\n        });\n        return messages.join(\"\\n\");\n    }\n\n    function findNode(tree, predicate, node) {\n        if (_.isString(predicate)) {\n            var text = predicate;\n            predicate = function (node) {\n                return node.text === text;\n            };\n        }\n        function find(node) {\n            var i, len, result;\n            if (predicate(node)) {\n                return node;\n            }\n            for (i = 0, len = node.children.length; i < len; i++) {\n                result = find(tree.get_node(node.children[i]));\n                if (result) {\n                    return result;\n                }\n            }\n            return null;\n        }\n        return find(node || tree.get_node(\"#\"));\n    }\n\n    /**\n     * Report full stack trace on async callback error\n     *\n     * Wrap async callback functions with this function to report the\n     * full stack trace if they fail. It is recommended to only use this\n     * temporarily while debugging a test that is throwing a hard-to-\n     * trace error. It destroys pretty assertion diff output. Also,\n     * assertion errors thrown from within an async callback do include\n     * full stack trace information.\n     *\n     * Fixes the problem described in\n     * https://github.com/mochajs/mocha/issues/815\n     *\n     * Usage:\n     *\n     *  it(\"will always fail\", function (done) {\n     *      someAsyncFunction(asyncatch(function (arg) {\n     *          doSomethingThatThrowsAnError();\n     *          done();\n     *      }));\n     *  });\n     */\n    function asyncatch(fn) {\n        return function () {\n            try {\n                var args = Array.prototype.slice.call(arguments);\n                return fn.apply(this, args);\n            } catch (err) {\n                throw err && err.stack ? new Error(err.stack) : err;\n            }\n        };\n    }\n\n    function markdownVisible() {\n        return $('.itext-block-label-group-default')\n            .find('.markdown-output')\n            .is(':visible');\n    }\n\n    return {\n        options: options,\n        asyncatch: asyncatch,\n        init: init,\n        call: call,\n        loadXML: loadXML,\n        saveAndReload: function(callback) {\n            call(\"loadXFormOrError\", call(\"createXML\"), callback);\n        },\n        getMug: getMug,\n        getInput: getInput,\n        getWidget: getWidget,\n        getMediaUploader: getMediaUploader,\n        assertEqual: assertEqual,\n        assertInputCount: assertInputCount,\n        assertXmlEqual: assertXmlEqual,\n        assertXmlNotEqual: assertXmlNotEqual,\n        assertJSTreeState: assertJSTreeState,\n        assertTreeState: assertTreeState,\n        addQuestion: function (qType, nodeId, attrs) {\n            attrs = _.extend({}, attrs);\n            if (this.prevId) {\n                clickQuestion(this.prevId);\n            }\n            var mug = call('addQuestion', qType);\n            if (!nodeId && !mug.p.nodeID) {\n                nodeId = call('nodeIDFromLabel', mug);\n            }\n            if (nodeId) {\n                assert(_.isUndefined(attrs.nodeID),\n                       \"unexpected attribute for \" + qType + \"[\" + nodeId + \"]\");\n                if (mug.p.labelItext) {\n                    mug.p.labelItext.set(mug.getLabelValue());\n                }\n                // HACK set nodeID after label itext so tree node gets renamed\n                mug.p.nodeID = nodeId;\n                if (qType === \"Choice\" && !attrs.hasOwnProperty(\"labelItext\")) {\n                    attrs.labelItext = nodeId;\n                }\n            }\n            _.each(attrs, function (val, name) {\n                if (!_.isBoolean(val)) {\n                    val = String(val);\n                }\n                if (/.+Itext/.test(name)) {\n                    mug.p[name].set(val);\n                } else {\n                    mug.p[name] = val;\n                }\n            });\n\n            // Open all sections\n            _.each(call('getSections', mug), function(section) {\n                call('collapseSection', section.slug, false);\n            });\n\n            return mug;\n        },\n        paste: paste,\n        clickQuestion: clickQuestion,\n        selectAll: selectAll,\n        deleteQuestion: deleteQuestion,\n        saveButtonEnabled: saveButtonEnabled,\n        expandGroup: expandGroup,\n        collapseGroup: collapseGroup,\n        getMessages: getMessages,\n        findNode: findNode,\n        isTreeNodeValid: function (mug) {\n            if (_.isString(mug)) {\n                var path = mug;\n                mug = getMug(path);\n                assert(mug, \"mug not found: \" + path);\n            }\n            var $node = $(\"#vellum\").find('#' + mug.ufid + ' > a');\n            return $node.children(\".fd-valid-alert-icon\").length === 0;\n        },\n        markdownVisible: markdownVisible,\n        parseXML: xml.parseXML,\n    };\n});\n","define([\n    'chai',\n    'jquery',\n    'underscore',\n    'tests/utils',\n    'vellum/expressionEditor',\n    'vellum/mugs',\n    'vellum/richText',\n    'vellum/util'\n], function (\n    chai,\n    $,\n    _,\n    util,\n    expressionEditor,\n    mugs,\n    richText,\n    vellumUtil\n) {\n    var assert = chai.assert,\n        real_showXPathEditor = expressionEditor.showXPathEditor,\n        events = {};\n\n    vellumUtil.eventuality(events);\n\n    // setup event so we can hook into xpath editor show\n    expressionEditor.showXPathEditor = function () {\n        real_showXPathEditor.apply(null, arguments);\n        events.fire(\"showXPathEditor\");\n    };\n\n    describe(\"The widgets module with rich text disabled\", function () {\n        before(function (done) {\n            util.init({\n                javaRosa: { langs: ['en'] },\n                core: {\n                    onReady: function () {\n                        assert(this.isPluginEnabled(\"modeliteration\"),\n                               \"modeliteration plugin should be enabled\");\n                        done();\n                    }\n                },\n                features: {rich_text: false},\n            });\n        });\n\n        it(\"xPath widget should allow drag/drop\", function () {\n            var spec = mugs.baseSpecs.databind;\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text\");\n            util.clickQuestion(\"text\");\n            assert.equal(spec.defaultValue.xpathType, \"generic\");\n            assert($(\"[name=property-defaultValue]\").hasClass(\"jstree-drop\"),\n                \"defaultValue does not have jstree-drop class\");\n            assert.equal(spec.relevantAttr.xpathType, \"bool\");\n            assert($(\"[name=property-relevantAttr]\").hasClass(\"jstree-drop\"),\n                \"relevantAttr does not have jstree-drop class\");\n        });\n\n        it(\"xPath widget should show newlines in advanced mode\", function (done) {\n            // HACK this ugly test references a lot of implementation details\n            util.loadXML(\"\");\n            var value = '\"line 1 \\n line 2\"',\n                escaped = '\"line 1 &#10; line 2\"';\n            util.addQuestion(\"DataBindOnly\", \"hidden\", {\n                calculateAttr: value\n            });\n            util.clickQuestion(\"/data/hidden\");\n            var input = $(\"[name=property-calculateAttr]\");\n            assert.equal(input.val(), escaped);\n\n            // click Edit button\n            input.closest(\".form-group\").find(\".fd-edit-button\").click();\n\n            events.on(\"showXPathEditor\", function () {\n                var text = $(\".xpath-advanced\").find(\"textarea\").val();\n                $(\".fd-xpath-cancel-button\").click();\n                assert.equal(text, value, \"textarea content should have newline\");\n                done();\n            }, null, \"showXPathEditor\");\n        });\n\n        it(\"xPath widget should escape newlines on save advanced mode\", function (done) {\n            // HACK this ugly test references a lot of implementation details\n            util.loadXML(\"\");\n            var value = '\"line 1 \\n line 2\"',\n                escaped = '\"line 1 &#10; line 2\"',\n                hidden = util.addQuestion(\"DataBindOnly\", \"hidden\", {\n                    calculateAttr: \"\"\n                });\n            util.clickQuestion(\"/data/hidden\");\n\n            // click Edit button\n            var input = $(\"[name=property-calculateAttr]\");\n            input.closest(\".form-group\").find(\".fd-edit-button\").click();\n\n            events.on(\"showXPathEditor\", function () {\n                var textarea = $(\".xpath-advanced\").find(\"textarea\");\n                textarea.val(value).change();\n                $(\".fd-xpath-save-button\").click();\n\n                var input = $(\"[name=property-calculateAttr]\");\n                assert.equal(input.val(), escaped, \"input value not escaped\");\n                assert.equal(hidden.p.calculateAttr, value, \"wrong mug value\");\n                done();\n            }, null, \"showXPathEditor\");\n        });\n\n        it(\"xPath widget should show /data/ when in advanced editor without rich_text\", function (done) {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text\");\n            var value = '/data/text',\n                escaped = '#form/text',\n                hidden = util.addQuestion(\"DataBindOnly\", \"hidden\", {\n                    calculateAttr: escaped\n                });\n            assert.equal(hidden.p.calculateAttr, escaped);\n            util.clickQuestion(\"/data/hidden\");\n\n            // click Edit button\n            var input = $(\"[name=property-calculateAttr]\");\n            input.closest(\".form-group\").find(\".fd-edit-button\").click();\n\n            events.on(\"showXPathEditor\", function () {\n                var textarea = $(\".xpath-advanced\").find(\"textarea\");\n                assert.equal(textarea.val(), value, \"input value showing #form\");\n                assert.equal(hidden.p.calculateAttr, escaped, \"value not in vellum internal form\");\n                done();\n            }, null, \"showXPathEditor\");\n        });\n\n        it(\"xPath widget should genuinely hide editor whenever it's exited\", function (done) {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text1\");\n            util.addQuestion(\"Text\", \"text2\");\n\n            var $right = $(\".fd-content-right\"),\n                $props = $right.find(\".fd-question-properties\"),\n                $editor = $right.find(\".fd-xpath-editor\");\n            $props.find(\".fd-edit-button:first\").click();\n\n            events.on(\"showXPathEditor\", function () {\n                assert($editor.is(\":visible\"), \"Editor shown when clicked\");\n                assert(!$props.is(\":visible\"), \"Properties hidden when entering editor\");\n\n                util.clickQuestion(\"/data/text1\");\n                assert($props.is(\":visible\"), \"Properties shown as requested\");\n                assert(!$editor.is(\":visible\"), \"Editor hidden when properties shown\");\n                done();\n            }, null, \"showXPathEditor\");\n        });\n\n        it(\"xPath widget should change save button when dropdown is changed\", function (done) {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text\");\n            util.clickQuestion(\"text\");\n\n            var $right = $(\".fd-content-right\"),\n                $props = $right.find(\".fd-question-properties\");\n            $props.find(\".fd-edit-button:first\").click();\n\n            events.on(\"showXPathEditor\", function () {\n                assert(!$('.fd-xpath-save-button').hasClass('btn-success'));\n                $('.op-select').change();\n                assert($('.fd-xpath-save-button').hasClass('btn-success'));\n                done();\n            }, null, \"showXPathEditor\");\n        });\n    });\n\n    describe(\"The rich text widget\", function () {\n        before(function (done) {\n            util.init({\n                javaRosa: {langs: ['en']},\n                core: {onReady: function () { done(); }},\n                features: {rich_text: true},\n            });\n        });\n\n        describe(\"should preserve\", function() {\n            var data = [\n                    [\"id\", \"type\", \"labelItext:en-default\"],\n                    [\"/newlines\", \"Text\", \"list\\n\\n* item\\n* item\\n\"],\n                    [\"/spaces\", \"Text\", \"a  b   c    d\"],\n                ];\n            before(function () {\n                util.loadXML(\"\");\n                util.paste(data);\n            });\n\n            _.each(data.slice(1), function (row) {\n                var name = row[0].slice(1);\n                it(name, function (done) {\n                    util.clickQuestion(name);\n                    var widget = util.getWidget('itext-en-label');\n                    widget.getValue(function (val) {\n                        // async assert because ckEditor setData is async\n                        util.assertEqual(val, row[2]);\n                        done();\n                    });\n                });\n            });\n        });\n\n        it(\"should return just-set value on get value\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Text\", \"text\");\n            util.clickQuestion('text');\n            var widget = util.getWidget('itext-en-label'),\n                text = '<output value=\"/data/text\" />';\n            widget.setValue(text);\n            assert.equal(widget.getValue(), text);\n        });\n\n        it(\"should create reference to hidden value in display condition\", function (done) {\n            util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\", \"labelItext:en-default\"],\n                [\"/hidden\", \"DataBindOnly\", \"null\"],\n                [\"/text\", \"Text\", \"test\"],\n            ]);\n            util.clickQuestion('text');\n            var text = util.getMug(\"text\"),\n                disp = util.getWidget(\"property-relevantAttr\"),\n                tree = $(\".fd-question-tree\").jstree(true);\n            assert.equal(disp.input.length, 1);\n            disp.input.promise.then(function () { // wait for editor to be ready\n                util.findNode(tree, \"hidden\").data.handleDrop(disp.input);\n                disp.handleChange();\n                assert.equal(text.p.relevantAttr, '#form/hidden');\n                done();\n            });\n        });\n\n        it(\"should change save button on drag/drop into advanced xpath editor\", function (done) {\n            util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\", \"labelItext:en-default\"],\n                [\"/hidden\", \"DataBindOnly\", \"null\"],\n                [\"/text\", \"Text\", \"test\"],\n            ]);\n            util.clickQuestion(\"text\");\n\n            $(\".fd-content-right .fd-question-properties [name=property-defaultValue]\")\n                .closest(\".form-group\")\n                .find(\".fd-edit-button\").click();\n\n            events.on(\"showXPathEditor\", function () {\n                var input = $('.fd-xpath-editor-text'),\n                    editor = richText.editor(input),\n                    tree = $(\".fd-question-tree\").jstree(true),\n                    saveButton = $('.fd-xpath-save-button');\n                editor.on(\"instanceReady\", function () {\n                    assert(!saveButton.hasClass('btn-success'), \"save button should not be green\");\n                    editor.on(\"change\", function () {\n                        assert(saveButton.hasClass('btn-success'), \"save button not green\");\n                        done();\n                    });\n                    util.findNode(tree, \"hidden\").data.handleDrop(input);\n                });\n            }, null, \"showXPathEditor\");\n        });\n\n        it(\"simple xpath editor should change save button on remove expression\", function (done) {\n            util.loadXML(\"\");\n            util.paste([\n                [\"id\", \"type\", \"labelItext:en-default\"],\n                [\"/hidden\", \"DataBindOnly\", \"null\"],\n            ]);\n\n            $(\".fd-content-right .fd-question-properties [name=property-relevantAttr]\")\n                .closest(\".form-group\")\n                .find(\".fd-edit-button\").click();\n\n            events.on(\"showXPathEditor\", function () {\n                var saveButton = $('.fd-xpath-save-button');\n                assert.equal(saveButton.length, 1, 'save button');\n                assert(!saveButton.hasClass(\"btn-success\"),\n                    \"save button should not be active\");\n\n                var addButton = $('.fd-add-exp');\n                assert.equal(addButton.length, 1, 'add button');\n                assert.equal($('.xpath-expression-group').length, 1, 'before add');\n                addButton.click();\n                assert.equal($('.xpath-expression-group').length, 2, 'after add row');\n                assert(!saveButton.hasClass(\"btn-success\"),\n                    \"should not activate save button on add expression\");\n\n                var removeButton = $('.xpath-delete-expression').last();\n                assert.equal(removeButton.length, 1, 'remove button');\n                removeButton.click();\n                assert.equal($('.xpath-expression-group').length, 1, 'after remove row');\n                assert(saveButton.hasClass(\"btn-success\"),\n                    \"did not activate save button after remove expression\");\n                done();\n            }, null, \"showXPathEditor\");\n        });\n    });\n});\n","define([\n    'chai',\n    'jquery',\n    'tests/utils',\n    'static/writer/ignore-richtext-and-markdown.xml',\n    'static/writer/repeat-without-count.xml',\n    'static/writer/repeat-noAddRemove-false.xml',\n    'static/writer/repeat-with-count.xml',\n    'static/writer/repeat-with-count-noAddRemove-false.xml',\n    'static/writer/repeat-with-count-as-question.xml',\n], function (\n    chai,\n    $,\n    util,\n    INGORE_RICHTEXT_AND_MARKDWON,\n    REPEAT_WITHOUT_COUNT_XML,\n    REPEAT_NO_ADD_REMOVE_FALSE_XML,\n    REPEAT_WITH_COUNT_XML,\n    REPEAT_WITH_COUNT_NO_ADD_REMOVE_FALSE_XML,\n    REPEAT_WITH_COUNT_AS_QUESTION_XML\n) {\n    var assert = chai.assert;\n\n    describe(\"The XML writer\", function () {\n        beforeEach(function (done) {\n            util.init({\n                core: {\n                    onReady: function () {\n                        done();\n                    }\n                },\n            });\n        });\n\n        it(\"should not set jr:noAddRemove on repeat group without count\", function () {\n            util.addQuestion(\"Repeat\", \"group\");\n            util.assertXmlEqual(\n                util.call(\"createXML\"),\n                REPEAT_WITHOUT_COUNT_XML,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should not set jr:noAddRemove on repeat group without count even when jr:noAddRemove is true\", function () {\n            var group = util.addQuestion(\"Repeat\", \"group\");\n            group.p.no_add_remove = true;\n            util.assertXmlEqual(\n                util.call(\"createXML\"),\n                REPEAT_WITHOUT_COUNT_XML,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should remove jr:noAddRemove attribute when its value was false()\", function () {\n            util.call(\"loadXML\", REPEAT_NO_ADD_REMOVE_FALSE_XML);\n            util.assertXmlEqual(\n                util.call(\"createXML\"),\n                REPEAT_WITHOUT_COUNT_XML,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should preserve jr:noAddRemove='true()' when jr:count has a value\", function () {\n            util.call(\"loadXML\", REPEAT_WITH_COUNT_XML);\n            util.assertXmlEqual(\n                util.call(\"createXML\"),\n                REPEAT_WITH_COUNT_XML,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should change jr:noAddRemove to 'true()' when jr:count has a value\", function () {\n            util.call(\"loadXML\", REPEAT_WITH_COUNT_NO_ADD_REMOVE_FALSE_XML);\n            util.assertXmlEqual(\n                util.call(\"createXML\"),\n                REPEAT_WITH_COUNT_XML,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should add hashtag reference to jr:count\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Int\");\n            var mug = util.addQuestion(\"Repeat\");\n            util.addQuestion(\"Text\");\n            mug.p.repeat_count = \"#form/question1\";\n            util.assertXmlEqual(\n                util.call(\"createXML\"),\n                REPEAT_WITH_COUNT_AS_QUESTION_XML,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should be able to ignore both richText and markdown\", function () {\n            var form = util.loadXML(INGORE_RICHTEXT_AND_MARKDWON);\n            assert(!form.richText, \"richText should be disabled\");\n            assert(form.noMarkdown, \"markdown should be disabled\");\n            util.assertXmlEqual(\n                util.call(\"createXML\"),\n                INGORE_RICHTEXT_AND_MARKDWON,\n                {normalize_xmlns: true}\n            );\n        });\n\n        it(\"should still save more than once\", function () {\n            util.call(\"loadXML\", \"\");\n            util.addQuestion(\"FieldList\", 'fieldlist');\n            util.addQuestion(\"Text\", 'text1');\n            util.addQuestion(\"Text\", 'text2');\n            util.addQuestion(\"Text\", 'text3');\n            util.addQuestion(\"Text\", 'text4');\n            util.call(\"createXML\");\n            util.deleteQuestion(\"/data/fieldlist/text1\");\n            util.call(\"createXML\");\n        });\n\n        it(\"should not write empty itext ref\", function () {\n            util.loadXML(\"\");\n            util.addQuestion(\"Select\", \"select\");\n            var choice = util.addQuestion(\"Choice\", \"blank\", {labelItext: \"\"});\n            assert.equal(choice.p.labelItext.get(), \"\");\n            var xml = $(util.call('createXML'));\n            assert.equal(xml.find(\"text[id=select-blank-label]\").length, 0,\n                \"should not write select-blank-label itext item\");\n            assert.equal(xml.find(\"label\").attr(\"ref\"), undefined,\n                \"item label ref should not be defined\");\n        });\n    });\n\n});\n","define([\n    'jquery',\n    'underscore',\n    'chai',\n    'vellum/xml',\n    'static/xml/regexp-crashing-debug-itext.xml',\n    'static/xml/regexp-crashing-debug-itext-parsed.xml',\n    'static/xml/slow-regexp-itext.xml',\n], function (\n    $,\n    _,\n    chai,\n    xml,\n    REGEXP_CRASHING_DEBUG_ITEXT,\n    REGEXP_CRASHING_DEBUG_ITEXT_PARSED,\n    SLOW_REGEXP_ITEXT\n) {\n    var assert = chai.assert;\n\n    describe(\"The XML normalizer\", function () {\n        function eq(value, escaped, humanize) {\n            var normal = xml.normalize(value);\n            assert.strictEqual(normal, escaped);\n            if (_.isUndefined(humanize) || humanize) {\n                assert.strictEqual(xml.humanize(normal), value);\n            }\n        }\n\n        it(\"should preserve empty string\", function () {\n            eq('', '');\n        });\n\n        it(\"should preserve space\", function () {\n            eq(' ', ' ');\n        });\n\n        it(\"should preserve newline\", function () {\n            eq(' ', ' ');\n        });\n\n        it(\"should preserve empty XML node\", function () {\n            eq('<output />', '<output />');\n        });\n\n        it(\"should escape & character\", function () {\n            eq('Mother & Child Reunion', 'Mother &amp; Child Reunion');\n        });\n\n        it(\"should escape attribute value with < character\", function () {\n            eq('<output value=\"2 < 3\" />', '<output value=\"2 &lt; 3\" />');\n        });\n\n        it(\"should escape attribute value with > character\", function () {\n            eq('<output value=\"2 > 3\" />', '<output value=\"2 &gt; 3\" />');\n        });\n\n        it(\"should escape attribute value with <= character\", function () {\n            eq('<output value=\"2 <= 3\" />', '<output value=\"2 &lt;= 3\" />');\n        });\n\n        it(\"should escape attribute value with >= character\", function () {\n            eq('<output value=\"2 >= 3\" />', '<output value=\"2 &gt;= 3\" />');\n        });\n\n        it(\"should escape attribute value with < tight\", function () {\n            eq('<output value=\"2<3\" />', '<output value=\"2&lt;3\" />', false);\n        });\n\n        it(\"should escape attribute value with > tight\", function () {\n            eq('<output value=\"2>3\" />', '<output value=\"2&gt;3\" />', false);\n        });\n\n        it(\"should escape < character\", function () {\n            eq('your visit count must be < 5', 'your visit count must be &lt; 5');\n        });\n\n        it(\"should escape > character\", function () {\n            eq('your visit count must be > 5', 'your visit count must be &gt; 5');\n        });\n\n        it(\"should escape attribute value with > and trailing text (v1)\", function () {\n            eq('<output value=\"2 > 3\" /> text',\n               '<output value=\"2 &gt; 3\" /> text');\n        });\n\n        it(\"should escape attribute value with > and trailing text (v2)\", function () {\n            eq(\"<output value='2 > 3' /> text\",\n               '<output value=\"2 &gt; 3\" /> text', false);\n        });\n\n        it(\"should escape attribute value with > and trailing text (v3)\", function () {\n            eq('<output value=\"2 > 3\"/>text',\n               '<output value=\"2 &gt; 3\" />text', false);\n        });\n\n        it(\"should escape attribute value with > and trailing text (v4)\", function () {\n            eq('<output value=\"2 > 3\"></output> text',\n               '<output value=\"2 &gt; 3\" /> text', false);\n        });\n\n        it(\"should escape attribute value with > and trailing text (v5)\", function () {\n            eq('<out:p_3-6. h:v-1._=\"2 > 3\" />text',\n               '<out:p_3-6. h:v-1._=\"2 &gt; 3\" />text');\n        });\n\n        it(\"should escape attribute value with < and trailing text\", function () {\n            eq('<output value=\"2 < 3\" /> text',\n               '<output value=\"2 &lt; 3\" /> text');\n        });\n\n        it(\"should escape < character before tag\", function () {\n            // immortalizing https://github.com/dimagi/Vellum/pull/212\n            eq('your visit count must be < <output value=\"/path\" />',\n               'your visit count must be &lt; <output value=\"/path\" />');\n        });\n\n        it(\"should escape > character before tag\", function () {\n            eq('your visit count must be > <output value=\"/path\" />',\n               'your visit count must be &gt; <output value=\"/path\" />');\n        });\n\n        it(\"should preserve attribute value with path\", function () {\n            eq('<output value=\"/path\" />', '<output value=\"/path\" />');\n        });\n\n        it(\"should preserve output node with text before\", function () {\n            eq('text <output value=\"/path\" />', 'text <output value=\"/path\" />');\n        });\n\n        it(\"should preserve output node with text after\", function () {\n            eq('<output value=\"/path\" /> text', '<output value=\"/path\" /> text');\n        });\n\n        it(\"should preserve attribute without value\", function () {\n            eq('<output attr />', '<output attr=\"\" />', false);\n        });\n\n        it(\"should preserve attribute value with path, unterminated tag\", function () {\n            eq('<output value=\"/path\">', '<output value=\"/path\" />', false);\n        });\n\n        it(\"should preserve newline\", function () {\n            eq('line 1\\nline2', 'line 1\\nline2');\n        });\n\n        // Commenting out for now, tabled to fix later\n        // it(\"should preserve newline in attribute value\", function () {\n        //     eq('<output value=\"selected(/path,\\n2)\" />',\n        //        '<output value=\"selected(/path,\\n2)\" />');\n        // });\n\n        it(\"should preserve attribute with unquoted value\", function () {\n            eq('<output attr=value />', '<output attr=\"value\" />', false);\n        });\n\n        it(\"should escape unquoted attribute value with <\", function () {\n            eq('<output value=2<3 />', '<output value=\"2&lt;3\" />', false);\n        });\n\n        it(\"should fail on escape attribute value with />\", function () {\n            // known failure; mangled output:\n            //   <output value=\"..&gt;&lt;/output&gt;..\" />\n            chai.expect(function () {\n                eq('<output value=\"../>..\" />', '<output value=\"..&gt;..\" />', false);\n            }).to.throw(Error);\n        });\n\n        it(\"should accept jquery node\", function () {\n            eq($('<value><output /></value>'), '<output />', false);\n        });\n\n        /* -- The following are lossy -- */\n\n        it(\"should handle malformed tag\", function () {\n            // big loss here\n            eq('<output value=\"/path\"', '', false);\n        });\n\n        it(\"should replace &nbsp; with space\", function () {\n            eq('a &nbsp; b', 'a   b', false);\n        });\n\n        it(\"should not cause regexp engine to hang on many output values in jquery object\", function () {\n            // This is a pretty arcane test. The XML in this test caused\n            // an exponential performance degredation (more tags made\n            // normalization slower) in Chrome and Firefox.\n            var parsedXml = xml.parseXML(REGEXP_CRASHING_DEBUG_ITEXT),\n                value = parsedXml.find(\"value\");\n            eq(value, REGEXP_CRASHING_DEBUG_ITEXT_PARSED, false);\n        });\n\n        it(\"should not cause regexp engine to hang on many output values in string\", function () {\n            // similar to above test, but also tests fixGTBug, which uses a similar regexp\n            // NOTE this test fails on Firefox because attribute order is changed\n            var parsedXml = xml.parseXML(REGEXP_CRASHING_DEBUG_ITEXT),\n                serializer = new XMLSerializer(),\n                wrapper = /^<([\\w:.-]+)(?:\\s+[\\w:.-]+=([\"'])[^]*?\\2)*\\s*(?:\\/>|>([^]*)<\\/\\1>)$/g,\n                value = serializer.serializeToString(parsedXml.find(\"value\")[0])\n                    .replace(/(value=\"[^\"]+)\"/g, '$1 > 2\"')\n                    .replace(wrapper, \"$3\"),\n                parsed = REGEXP_CRASHING_DEBUG_ITEXT_PARSED\n                    .replace(/(value=\"[^\"]+)\"/g, '$1 &gt; 2\"')\n                    .replace(/\"\\/>/g, '\" />');\n            eq(value, parsed, false);\n        });\n\n        it(\"should not cause regexp engine to hang on many output values in string #2\", function () {\n            eq(SLOW_REGEXP_ITEXT, SLOW_REGEXP_ITEXT.replace(/><\\/output>/g, \" \\/>\"), false);\n        });\n    });\n\n    describe(\"The XML humanizer\", function () {\n        function eq(value, humanized, normalize) {\n            var human = xml.humanize(value);\n            assert.strictEqual(human, humanized);\n            if (normalize) {\n                assert.strictEqual(xml.normalize(human), value);\n            }\n        }\n\n        it(\"should convert free < character\", function () {\n            eq('2 &lt; 3', '2 < 3', true);\n        });\n\n        it(\"should convert free > character\", function () {\n            eq('2 &gt; 3', '2 > 3', true);\n        });\n\n        it(\"should convert free & character\", function () {\n            eq('2 &amp; 3', '2 & 3', true);\n        });\n\n        it(\"should not convert escaped tag\", function () {\n            eq(' &lt;div&gt; ', ' &lt;div&gt; ', true);\n        });\n\n        it(\"should convert output tag\", function () {\n            eq('<output value=\"1 &amp; 2 &lt; 3\" />',\n               '<output value=\"1 & 2 < 3\" />', true);\n        });\n\n        it(\"should not unescape '&amp;' when part of a double escaped character\", function () {\n            eq('&amp;amp;', '&amp;amp;', true);\n        });\n\n        it(\"should not convert escaped tag with attribute\", function () {\n            eq('&lt;div class=\"injection\"&gt;', '&lt;div class=\"injection\"&gt;', true);\n        });\n\n        it(\"should convert empty tag\", function () {\n            eq('<tag attr=\"value\"></tag>', '<tag attr=\"value\" />');\n        });\n\n        it(\"should convert child nodes\", function () {\n            var value = \"<value>1 &amp; 2 &lt; 3 <output value='/path' /></value>\";\n            eq($(value), '1 & 2 < 3 <output value=\"/path\" />');\n        });\n\n        it(\"should convert child output node\", function () {\n            var value = \"<value><output value='1 &amp; 2 &lt; 3' /></value>\";\n            eq($(value), '<output value=\"1 & 2 < 3\" />');\n        });\n\n        it(\"should convert empty child nodes\", function () {\n            eq($(\"<value />\"), \"\");\n        });\n\n        it(\"should space child node\", function () {\n            eq($(\"<value> </value>\"), \" \");\n        });\n\n        it(\"should newline child node\", function () {\n            eq($(\"<value>\\n</value>\"), \"\\n\");\n        });\n\n        it(\"should not cause regexp engine to hang on many output values\", function () {\n            var parsedXml = xml.parseXML(REGEXP_CRASHING_DEBUG_ITEXT),\n                value = parsedXml.find(\"value\");\n            eq(value, REGEXP_CRASHING_DEBUG_ITEXT_PARSED, false);\n        });\n\n        it(\"should not wrap trailing text in output refs\", function () {\n            var value = \"<value>&amp; <output value='/path' /> \" +\n                \"text-after *should* remain. ~&amp; not #disrupt the\\nflow\" +\n                \"</value>\";\n            eq($(value), \"& <output value=\\\"/path\\\" /> text-after \" +\n                \"*should* remain. ~& not #disrupt the\\nflow\");\n        });\n    });\n\n    describe(\"The XML query\", function () {\n        var eq = assert.strictEqual;\n\n        it(\"should round-trip XML\", function () {\n            eq(xml.query(\"<value>\\n</value>\").toString(), \"<value>\\n</value>\");\n        });\n\n        it(\"should round-trip XML fragment with leading text\", function () {\n            eq(xml.query(\"def <value>abc</value>\").toString(), \"def <value>abc</value>\");\n        });\n\n        it(\"should round-trip XML fragment with trailing text\", function () {\n            eq(xml.query(\"<value>abc</value> def\").toString(), \"<value>abc</value> def\");\n        });\n\n        it(\"should escape invalid XML\", function () {\n            eq(xml.query(\"<h1>a > & < b</h1>\").toString(), \"<h1>a &gt; &amp; &lt; b</h1>\");\n        });\n\n        it(\"should round-trip empty string\", function () {\n            eq(xml.query(\"\").toString(), \"\");\n        });\n\n        it(\"should round-trip newline\", function () {\n            eq(xml.query(\"\\n\").toString(), \"\\n\");\n        });\n\n        it(\"should not insert text inside output refs\", function () {\n            // this test is verifying a quirk of jQuery 3.5.0 that results in\n            // invalid XML transformations. It is not necessary to preserve\n            // the behavior if/when jQuery no longer mangles XML this way.\n            eq(xml.query(\n                \"& <output value=\\\"/data/question1\\\" \" +\n                \"vellum:value=\\\"#form/question1\\\"> \" +\n                \"text-after *should* remain. ~& not #disrupt the\\nflow</output>\"\n            ).toString(),\n                \"&amp; <output value=\\\"/data/question1\\\" \" +\n                \"vellum:value=\\\"#form/question1\\\" /> \" +\n                \"text-after *should* remain. ~&amp; not #disrupt the\\nflow\"\n            );\n        });\n    });\n});\n"],"names":["options","util","chai","$","_","itemset","form","TEST_XML_1","INNER_FILTERS_XML","assert","call","clickQuestion","plugins","union","describe","beforeFn","done","init","javaRosa","langs","core","onReady","features","advanced_itemsets","before","it","loadXML","getMug","p","itemsetData","instance","id","src","nodeset","labelRef","valueRef","xml","$xml","parseXML","find","length","addQuestion","data","equal","indexOf","assertXmlEqual","newXml","replace","val","change","mug","filter","click","query","strictEqual","vellumUtil","TEST1_XML","dataSources","uri","path","name","structure","reference","hashtag","source","subset","subset_key","key","subsets","dob","getFuseData","string","fuseRes","fuse","search","getDisplayedAtwhoViews","this","css","assertNumAtwhoChoices","num","displayAtwho","callback","input","focus","keyup","delay","err","fire","rich_text","displayLabel","map","li","text","trim","startsWith","widget","setValue","editor","beforeEach","dataSourcesEndpoint","getWidget","promise","then","atwhoEntries","tags","deepEqual","isPluginEnabled","CASE_DATA","merge","context","subset_filter","release_date","release_length","contact_number","format","genres","case_name","quantity","footnote","role","test","qType","isRequired","requiredAttr","Text","PhoneNumber","HiddenValue","Select","Choice","Label","Group","TextInGroup","bind","prevId","DataBindOnlyInGroup","vellum","makeAllQuestionsRequired","isMatching","existingDefault","defaultValue","nodeID","MatchingText","MatchingHiddenValue","MatchingPhoneNumber","MatchingSelect","ChoiceOfMatchingSelect","MatchingTextInGroup","MatchingHiddenValueInGroup","HiddenValueInGroup","userCaseProp","similarCaseProp","defaultMatchingQuestionsToCaseProperties","commander","mugTypes","getQuestionMap","each","cmd","type","index","select","indent","args","paste","result","doCommand","isOk","ensureCurrentMugIsSaved","items","hasOwnProperty","splice","push","assertJSTreeState","apply","value","__className","getCurrentlySelectedMug","hashtagPath","isUndefined","expectedItems","slice","icon","undefined","full","exec","toLowerCase","getCompletions","expected","tokenize","tokens","hasAnyKeys","doesNotHaveAnyKeys","commcareConnect","LEARN_MODULE_XML","ASSESSMENT_XML","DELIVER_XML","module","description","time_estimate","relevantAttr","spec","validationFunc","user_score","entity_id","entity_name","commtrack","BALANCE_BLOCK_XML","BALANCE_BLOCK_SETVALUES_XML","INVALID_TRANSFER_XML","TRANSFER_BLOCK_XML","TRANSFER_BLOCK_SETVALUES_XML","trans","sectionId","entryId","dest","date","addInstanceIfNotExists","normalize_xmlns","bal","entityId","validate","isTreeNodeValid","messages","get","getMessages","notDeepEqual","getErrors","attr","saveButtonEnabled","ckeditor","on","rec","absolutePath","join","question","deleteQuestion","Transfer","Dispense","Receive","from","to","hasSrc","hasDest","meta","instanceMetadata","i","attributes","FOUR_QUESTIONS_XML","MANY_ITEXT_FORMS_XML","TEXT_QUESTION_XML","TWO_CHOICES_XML","TWO_QUESTIONS_XML","MANUAL_INSTANCE_REFERENCE_XML","mod","tsv","HEADER","eq","serial","rows","message","isString","tabDelimit","concat","assertEqual","errors","print","window","console","log","custom_intents","use_custom_repeat_button_text","item","copy","selectAll","text2","labelItext","autoId","$uploader","cut","JSON","stringify","key1","key2","key3","xmlns","extra","response","unknownAttributes","markdownVisible","invalid","invalid2","invalid3","calculateAttr","getValue","valid","isVisible","uploader","objectMap","json","jstr","valuify","GROUP_RENAME_XML","INVALID_QUESTIONS_XML","INCREMENT_ITEM_XML","HIDDEN_VALUE_IN_REPEAT_XML","HIDDEN_AMONG_QUESTIONS_XML","INSERT_QUESTIONS_XML","pluginsWithoutItemset","without","msg","addMessage","level","div","expect","include","saveButton","state","getChildren","getAbsolutePath","group","q1","q2","header","q0","h1","collapseGroup","expandGroup","selected","text1","throw","Error","group1","is","calc","tree","jstree","findNode","handleDrop","activityUrlCalled","activityUrl","activityTimeout","later","start","Date","now","onFormChange","isAtLeast","activityTimestamp","isNotNull","opts","getMugDisplayName","originalShowOverwriteWarning","onOverwrite","SRV_FORM","NEW_FORM","conflictResponse","status","xform","savedAs","showOverwriteWarning","send","newForm","oldForm","patchUrl","saveUrl","sha1","full_save_on_missing_conflict_xform","after","lastSavedXForm","didWarn","newFormSrc","dup","set","dropMessage","match","conflictedNodeId","srcType","dstType","allowed","anchor","getQuestionTypeChanger","parent","html","SelectDynamic","mugs","repeat","text3","text4","hidden2","text5","hidden1","should","prefix","qsrc","qdst","position","dst","ufid","refMug","refPos","relMug","relPos","res","posStr","String","mugStr","databrowser","CHILD_REF_XML","CHILD_REF_NO_HASHTAG_XML","MOTHER_REF_XML","CHILD_REF_OUTPUT_VALUE_XML","CHILD_REF_OUTPUT_VALUE_OTHER_LANG_XML","IGNORE_RICH_TEXT","PRELOADED_HASHTAGS_XML","UNKNOWN_PROPERTY_PRELOADED_HASHTAGS_XML","CASE_PROPERTY_XML","edd","related","dataTree","dobProp","getInstanceId","invalidCaseProperties","initDataBrowser","$f","sessionUri","casedbUri","isValidHashtag","notStrictEqual","hashtagMap","hashtags","children","parse","label","debounce","isNull","blue","event","eventuality","handleChange","loadDataTree","lengthOf","getControl","origFormDict","parser","xpath","newFormDict","newParser","parsedResult","toXPath","CASE_AND_USER_DATA","case_id","userid","code_name","user_role","normalizeXPath","NULL_HASHTAGS_XML","UNKNOWN_CASE_PROPERTY_XML","DATA_SOURCES","realName","address","opt","nodes","transform","object","node","recursive","getNodes","datasources","getDataNodes","keys","child","user","anAlias","mother","house","household","cb","reset","first","append","custom","isReady","shouldInferHashtags","hid","txt","PARSE_XML","SIBLING_AS_CHILD","DATA_PARENT_MUG_AFTER","DATA_PARENT_MUG_BEFORE","DATA_PARENT_MUG_IN_BETWEEN","dataParent","parentMug","repeat1","repeat2","moveMug","group2","assertTreeState","mugMap","diffChild","gettext","escapedHashtags","INVALID_XPATH_XML","transformToProperty","ret","split","hashtagInfo","invertedHashtagMap","invert","hashtagNamespaces","forEach","testCase","outputNoTransform","outputToProp","makeHashtagTransform","delimit","hidden","ALL_QUESTIONS_XML","ALL_QUESTIONS_TSV","ITEM_ID_XML","ITEM_ID_TSV","MULTI_LANG_TRANS_XML","VID_REF_XML","VID_REF_TSV","case_micro_image","getExportTSV","expressionEditor","xpathType","changed","makeOptions","showXPathEditor","validateXPath","isNotOk","notInclude","form_","Tree","ALTERNATE_ROOT_NODE_NAME_XML","GROUP_WITH_INTERNAL_REFS_XML","HIDDEN_VALUE_IN_GROUP_XML","HIDDEN_VALUE_TREE_ORDER","INSTANCE_REFERENCE_XML","MISMATCH_TREE_ORDER_XML","MISSING_VALUE","NAME_TEMPLATE","NESTED_GROUPS_XML","QUESTION_REFERENCING_OTHER_XML","SELECT_QUESTIONS","assertInstanceSrc","createXML","one","two","notEqual","getSerializationWarnings","fixSerializationWarnings","green","black","question1","blank","removeMugsFromForm","hasBrokenReferences","closest","duplicateMug","green2","getBasePath","item1","item2","repeat_count","warnWhenChanged","showChangedMsg","hasCaseHashtags","list","setAttr","formName","getElementsByTagName","template","title","dataName","prop","updateKnownInstances","attrs","expectId","expectSrc","isRegExp","dropAllInstanceReferences","longPaths","extend","may","hasValidHashtagPrefix","has","updatedQuery","updateInstanceQuery","CASE_WITH_UPDATE","COMMON","COMMON_IGNORED","DELETE_BUG_AFTER","DELETE_BUG_BEFORE","EMPTY_PARENT","IGNORE_IN_HEAD","IGNORED_BINDS_WITH_EXTRA_PATH","IGNORED_CONTROL_NODE","IGNORED_DATA_NODE","IGNORED_TAG_FIRST","MULTIPLE_IGNORES","MUTLI_MATCH","NESTED_IGNORED_NODES","REFERENCED_RENAMED","REFERENCED_UNRENAMED","RENAMED","UNKNOWN_ELEMENT","UNRENAMED","testXmlPair","rawXml","processedXml","ignore","ignoredNodes","TEST_XML","getInput","locked","mugPath","property","moveable","deleteable","changeable","isFalse","testTypeChangeable","bool","btn","menu","testEditButton","$but","parents","$r","intentManager","widgets","INTENT_WITH_UNKNOWN_ATTRS_XML","INTENT_WITH_NO_MUG_XML","PRINTING_INTENT_XML","CUSTOM_INTENT_XML","templates","ext","r1","r2","r3","r4","mime","templated_intents","media","getMediaUploader","pathPattern","upload","temp","docTemplate","sameMug","differentMug","androidIntentResponse","el","toArray","responses","intents","androidIntentAppId","customIndex","customOption","TEST_XML_1_WITH_CONSTRAINT","TEST_XML_1_WITH_APPEARANCE","ITEMSET_SORT_XML","DROPDOWN_FIXTURE_XML","DATA_ITEMSET_XML","FILTER_WITH_CASE_PROPERTY","ITEMSET_WITH_QUESTION_REF_XML","lookup_tables","sortRef","findUsages","jrItext","jr","BARE_OUTPUT","OUTPUTREF_GROUP_RENAME_XML","MULTI_LINE_TRANS_XML","OUTPUT_REFS_XML","OUTPUTREF_WITH_INEQUALITY_XML","GROUP_WITH_CONSTRAINT_XML","TEXT_WITH_CONSTRAINT_XML","ITEXT_ITEM_RENAME_XML","ITEXT_ITEM_RENAME_GROUP_MOVE_XML","ITEXT_ITEM_NON_AUTO_ID_XML","SELECT1_HELP_XML","SINGLE_LANG_SELECT_XML","SINGLE_LANG_SECOND_SELECT_WITH_HELP_XML","NO_LABEL_TEXT_ONE_LANG_XML","TEST_XML_2","TEST_XML_2_WITH_BIND_CONSTRAINT","TEST_XML_2_WITH_ONLY_BIND_CONSTRAINT","TEST_XML_3","TEST_XML_4","NON_DEFAULT_LANG_FIRST_XML","INVALID_OUTPUT_REF_XML","itext","pattern","old","deleteButton","setItextValue","widget2","itextItem","getItextItem","defaultLang","Itext","defaultLanguage","getForm","north","south","$enInput","$hebInput","$enMarkdown","$hebMarkdown","saveAndReload","constraintMsgItext","enLabel","hinLabel","enItext","hinItext","treeSelector","names","cpy","mug1","mug2","target","setCaretPosition","trigger","which","ctrlKey","audio","parseXLSItext","generateItextXLS","hasForm","tabKeyupEvent","Event","selectionStart","selectionEnd","tag","repeatMug","testItextIdValidation","itextValidationMug","constraintAttr","model","itextModel","hasHumanReadableItext","addForm","addLanguage","siblings","handleDropFinish","looksLikeMarkdown","markdownTable","$display","showOnlyCurrentLang","displayLanguage","currentItextDisplayLanguage","REQUIRED_XML","xmlAttr","logic","HASHTAG_FILTER","getPath","expr","dataSource","idsQuery","logicManager","_logicManager","forward","properties","canSelfRef","noSelfProps","difference","testReference","bad","ref","manager","caseReferences","load","save","knownExternalReferences","expectedUsages","q3","logicExpr","LogicExpression","createParser","makeXPathModels","paths","getPaths","getTopLevelPaths","getHashtags","toHashtag","xpathParser","compareHashtags","includeMembers","parsed","error","throws","MARKDOWN_TEST_XML","SIMPLE_MARKDOWN_XML","SIMPLE_MARKDOWN_NO_CHARS_XML","NO_MARKDOWN_XML","NO_MARKDOWN_STARS_XML","EXPLICIT_NO_MARKDOWN_XML","MARKDOWN_OUTPUT_VALUE_XML","toggleMarkdown","hasMarkdown","noMarkdown","CASE_LIST_REPEAT_XML","CASE_LIST_REPEAT_WITH_QUESTIONS_XML","CASE_LIST_REPEAT_WITH_QUESTIONS_AND_HIDDEN_XML","FIXTURE_REPEAT_XML","REGULAR_REPEAT_XML","pluginsWithModelIteration","phone","normal","firstCount","textBind","flatten","BLANK_CHOICE_XML","changes","ERROR","_withMessages","row","red","isReferencedByOtherMugs","username","long","f_0762","f_1065","f_1089","f_2685","f_2841","f_3017","f_3280","f_3291","f_3605","f_4021","f_4793","f_5683","f_6103","f_6542","f_6819","f_6912","f_7346","f_7541","f_8612","f_8967","f_8970","f_9147","f_9814","no_option","loadDelay","allowedDataNodeReferences","saveType","externalLinks","changeSubscription","dataSourcesFilter","sources","uploadUrls","image","video","ACCENT_CHAR_IN_PATH_XML","BODY_GROUP","OTHER_ITEM_XML","LABEL_WITHOUT_ITEXT_XML","MISSING_BIND_XML","OVERRIDE_XML","OVERRIDDEN_XML","FIRST_TIME_HASHTAG_XML","REPEAT_WITH_COUNT_AS_QUESTION_ONLY_FORM_XML","REPEAT_WITH_COUNT_AS_QUESTION_XML","pluginsWithItemset","doc","ignoreWarnings","_node_control","choice","grp","assertXmlNotEqual","requiredCondition","COMMENT_TEST_XML","comment","$section","visible","$command","hasClass","IMAGE_CAPTURE_XML","SELECT1_HELP_WITH_TYPE_XML","questionTypes","nodeId","dataValue","inputs","appearance","clickBeforeAdd","q","assertInputCount","timeout","addAllForms","richText","prev","questionWithoutDefaultAppearance","questionWithDefaultAppearance","Trigger","Signature","remove_appearance","change_appearance","omit","setup","choices","tearDown","ok","newAppearance","original","afterChange","$changer","$dropdown","changerSelector","$options","imageSize","microImage","mediaType","tagName","CKEDITOR","BURPEE_XML","OUTPUT_REF_XML","OUTPUT_VALUE_XML","iconClass","addClass","externalIcon","makeBubble","dispValue","internal","span","outputValueTemplateFn","wrapWithDiv","wrapWithDivP","setupGlobalForm","simpleConversions","isExpression","toRichText","dates","xmlValue","valueInBubble","bubbleDispValue","internalRef","extraAttrs","fmt","getOutputRef","bubble","ico","equations","prefix_html_1","prefix_html","widget_html","suffix_html","fromRichText","bubbleOutputs","m","getIconByPath","outerHTML","applyFormats","dateFormat","unescapeXPath","exprInput","exprEditor","assertCKCopy","$editor","domObject","dom","realDataTransfer","clipboard","dataTransfer","testDataTransfer","nativeDataTransfer","prototype","setTimeout","destroy","remove","v0","v1","insertExpression","output","insertOutput","copyVal","getData","setData","execCommand","TEST_XPATH","START_PATH","applyArgs","func","inputFlag","initialExpr","selStart","selLength","pasteValue","pasteText","pasteRepr","input_","substring","editable","types","files","env","ie","version","_data","evt","_target","clipboardData","preventDefault","getTarget","setTarget","t","mockPasteEvent","isEmpty","once","ckPaste","reps","escapeHTML","argsets","repr","super_handleChange","isContentEditable","selection","getSelection","getNative","focusOffset","$widget","disable_popovers","document","$popover","last","$link","mouseenter","destroyAll","desc","$desc","saveToCase","CREATE_PROPERTY_XML","CLOSE_PROPERTY_XML","UPDATE_PROPERTY_XML","INDEX_PROPERTY_XML","ATTACHMENT_PROPERTY_XML","CASE_TYPE_PROPERTY_XML","CREATE_2_PROPERTY_XML","LOGIC_TEST_XML","TWO_SAME_NAME_XML","create","props","createProperty","case_type","calculate","useCreate","owner_id","date_modified","user_id","close","useClose","closeCondition","update","useUpdate","isEqual","updateProperty","relevant","useIndex","indexProperty","extension","relationship","attach","useAttachment","attachmentProperty","inline_prop","from_strings","v","k","create1","create2","deepInclude","getBindList","deletedXML","SET_VALUE_XML","SET_VALUE_SPECIAL_XML","setvalue","allow_data_reference_in_setvalue","roundTrip","limit","next","makeRowParser","parseRows","escape","encoded","getHeight","outerHeight","heightWithoutAlert","heightWithAlert","undo","location","hash","fnCallCount","originalFn","_setURLHash","EquivalentXml","jsdiff","copypaste","PASTE_HEADER","actual","defaults","not","str1","str2","xml1","xml2","isEquivalent","element_order","cleanForDiff","patch","createPatch","colors","str","colorDiff","Array","arguments","$vellum","ufids","elements","asyncatch","fn","stack","vellum_options","oldAnimate","animate","speed","easing","originalSaveUrl","empty","ignoreParseWarnings","maintainUrlHash","warnings","history","replaceState","parseWarnings","warning","$el","$uiElem","sel","filename","getRandomizedMediaPath","nameOrInputs","len","isRootNode","rootNode","getLabelValue","isBoolean","section","slug","button","setStateWhenReady","predicate","get_node","real_showXPathEditor","events","baseSpecs","databind","escaped","textarea","$right","$props","disp","addButton","removeButton","INGORE_RICHTEXT_AND_MARKDWON","REPEAT_WITHOUT_COUNT_XML","REPEAT_NO_ADD_REMOVE_FALSE_XML","REPEAT_WITH_COUNT_XML","REPEAT_WITH_COUNT_NO_ADD_REMOVE_FALSE_XML","no_add_remove","REGEXP_CRASHING_DEBUG_ITEXT","REGEXP_CRASHING_DEBUG_ITEXT_PARSED","SLOW_REGEXP_ITEXT","humanize","normalize","parsedXml","XMLSerializer","serializeToString","humanized","human","toString"],"sourceRoot":""}