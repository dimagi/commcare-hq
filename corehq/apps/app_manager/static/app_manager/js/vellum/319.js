(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[319],{5641:(t,e,n)=>{"use strict";n.d(e,{A:()=>l});var a=n(1601),o=n.n(a),i=n(6314),s=n.n(i)()(o());s.push([t.id,'.clearfix {\n  *zoom: 1;\n}\n.clearfix:before,\n.clearfix:after {\n  display: table;\n  content: "";\n  line-height: 0;\n}\n.clearfix:after {\n  clear: both;\n}\n.hide-text {\n  font: 0/0 a;\n  color: transparent;\n  text-shadow: none;\n  background-color: transparent;\n  border: 0;\n}\n.input-block-level {\n  display: block;\n  width: 100%;\n  min-height: 30px;\n  -webkit-box-sizing: border-box;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n}\n.fd-xpath-editor .fd-xpath-editor-content {\n  padding: 20px;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset {\n  position: relative;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend {\n  *zoom: 1;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend:before,\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend:after {\n  display: table;\n  content: "";\n  line-height: 0;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend:after {\n  clear: both;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset legend button {\n  margin-bottom: 5px;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset .fd-xpath-editor-expressions .xpath-expression-group:last-child {\n  margin-bottom: 0;\n}\n.fd-xpath-editor .fd-xpath-editor-content fieldset .fd-xpath-editor-expressions .xpath-expression-group .validation-results {\n  display: inline-block;\n  padding: 5px 25px;\n  margin-bottom: 0;\n}\n',""]);const l=s},5319:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>D});var a=n(561),o=n.n(a),i=n(4523),s=n(2183),l=n(939),d=n(4459),r=n(3578),c=n.n(r),p=n(5881),f=n.n(p),h=n(8598),u=n.n(h),x=n(5261),g=n.n(x),m=n(5072),v=n.n(m),b=n(7825),y=n.n(b),A=n(7659),C=n.n(A),E=n(5056),T=n.n(E),P=n(540),w=n.n(P),k=n(1113),L=n.n(k),q=n(5641),X={};function S(t,e){if(e){d.A.isInvalid(e)&&(e=d.A.unescapeXPath(e,t));try{return[!0,t.xpath.parse(e)]}catch(t){return[!1,t]}}return[!0,null]}X.styleTagTransform=L(),X.setAttributes=T(),X.insert=C().bind(null,"head"),X.domAPI=y(),X.insertStyleElement=w(),v()(q.A,X),q.A&&q.A.locals&&q.A.locals;const D={showXPathEditor:function(t,e){var n,a=t,r={isExpression:!0},p=e.mug.form,h=i.Ay.partial(S,p);e=i.Ay.defaults(e,{leftPlaceholder:gettext("Drag question here"),rightPlaceholder:gettext("Drag question here")});var x=function(){n.removeClass("btn-default disabled").addClass("btn-success"),e.change()},m={},v=[],b=p.xpath.models.XPathExpressionTypeEnum,y={toString:function(t,e,n){return"("+e+") "+p.xpath.models.expressionTypeEnumToXPathLiteral(t)+" ("+n+")"},typeLeftRight:function(t){return t}};function A(t,e,n){e=p.xpath.models.expressionTypeEnumToXPathLiteral(e),m[e]=t,v.push([n,e])}A(y,b.EQ,gettext("is equal to")),A(y,b.NEQ,gettext("is not equal to")),A(y,b.LT,gettext("is less than")),A(y,b.LTE,gettext("is less than or equal to")),A(y,b.GT,gettext("is greater than")),A(y,b.GTE,gettext("is greater than or equal to")),A({toString:function(t,e,n){return t+"("+e+", "+n+")"},typeLeftRight:function(t){return 2===t.args.length&&{type:t.id,left:t.args[0],right:t.args[1]}}},"selected",gettext("has selected value"));var C=function(){return t.find(".fd-xpath-editor-text")},E=function(t,n){e.mug.form.richText?d.A.editor(t,p,r).setValue(n):t.val(n)},T=function(t){return e.mug.form.richText?d.A.editor(t,p,r).getValue():t.val()},P=function(){return t.find(".fd-xpath-validation-summary")},w=function(){return t.find(".fd-xpath-editor-expressions")},k=function(){return o()(a.find(".top-level-join-select")[0])},L=function(t,n){n?(i.Ay.isFunction(n)&&(n=n()),l.A.autocomplete(t,e.mug,{choices:n})):l.A.autocomplete(t,e.mug,{property:e.path,useRichText:e.mug.form.richText})},q=function(){var t=w(),e=[],n=k().val();t.children().each((function(){var t=T(o()(this).find(".left-question")),n=T(o()(this).find(".right-question"));if(""!==t||""!==n){var a=o()(o()(this).find(".op-select")[0]).val(),i=m[a].toString(a,t,n);e.push(i)}}));var a=e.join(" "+n+" "),i=h(a);return i[0]&&i[1]?i[1].toXPath():a},X=function(t,n){t&&e.DEBUG_MODE&&s.A.log("trying to add",t.toString());var a,i,l,c,f=function(t){var n="input",a="";e.mug.form.richText&&(n="div",a='contenteditable="true"');var i=o()(u()({operationOpts:v,leftPlaceholder:e.leftPlaceholder,rightPlaceholder:e.rightPlaceholder,tag:n,tagArgs:a}));e.mug.form.richText&&i.find(".fd-input").each((function(){d.A.editor(o()(this),p,r)}));var l=function(){return o()(i.find(".left-question")[0])},c=function(){return o()(i.find(".right-question")[0])},f=function(t){x();var e=T(l()),n=T(c());i.find(".validation-results").addClass("hide"),e&&h(e)[0]&&n&&h(n)[0]?i.find(".validation-results.alert-success").removeClass("hide"):i.find(".validation-results.alert-danger").removeClass("hide")},g=function(t,e,n){E(t,e.toXPath())};if(e.mug.form.richText?i.find(".xpath-edit-node").each((function(){d.A.editor(o()(this),p,r).on("change",f)})):i.find(".xpath-edit-node").on("keyup change",f),i.find(".op-select").on("change",f),i.find(".xpath-delete-expression").click((function(){i.remove(),x()})),t){if(e.DEBUG_MODE&&s.A.log("populating",t.toString()),m.hasOwnProperty(t.id)&&!(t=m[t.id].typeLeftRight(t)))return!1;g(l(),t.left),i.find(".op-select").val(p.xpath.models.expressionTypeEnumToXPathLiteral(t.type)),g(c(),t.right,t.left)}return L(l(),e.leftAutocompleteChoices),L(c(),e.rightAutocompleteChoices),i},g=function(){return w().empty(),e.DEBUG_MODE&&s.A.log("fail",t),!1},b=w();return t?(c=t)instanceof p.xpath.models.XPathCmpExpr||c instanceof p.xpath.models.XPathEqExpr||m.hasOwnProperty(c.id)?(a=f(t))?a.appendTo(b):g():function(t){return t instanceof p.xpath.models.XPathBoolExpr}(t)?n&&t.type!==n?g():(i=X(t.left,t.type),l=X(t.right,t.type),i&&l?(i.appendTo(b),l.appendTo(b),k().val(t.type),l):g()):g():(a=f()).appendTo(b)},D=function(e,n){E(C(),e),L(C()),w().empty(),t.find(".xpath-advanced").removeClass("hide"),t.find(".xpath-simple").addClass("hide"),t.find(".fd-xpath-actions").removeClass("form-actions-condensed"),n?(t.find(".xpath-advanced-notice").removeClass("hide"),t.find(".fd-xpath-show-simple-button").addClass("hide")):(t.find(".xpath-advanced-notice").addClass("hide"),t.find(".fd-xpath-show-simple-button").removeClass("hide"))},O=function(n){t.find(".xpath-simple").removeClass("hide"),t.find(".fd-xpath-actions").addClass("form-actions-condensed"),t.find(".xpath-advanced").addClass("hide"),w().empty(),n&&function(t){e.DEBUG_MODE&&s.A.log("setting ui for",t);var n=h(t);if(n[0]){var a=n[1];X(a)||D(a.toXPath(),!0)}else D(t,!0)}(n)},M=function(){var i="textarea",s='rows="5"';e.mug.form.richText&&(i="div",s='contenteditable="true"');var l=o()(g()({topLevelJoinOpts:[[gettext("True when ALL of the expressions are true."),b.AND],[gettext("True when ANY of the expressions are true."),b.OR]],tag:i,tagArgs:s}));a.html(l),n=l.find(".fd-xpath-save-button"),l.find(".fd-xpath-show-advanced-button").click((function(){c().fbUsage("Edit Expression","Show Advanced Mode"),D(q())})),l.find(".fd-xpath-show-simple-button").click((function(){O(T(C()))})),l.find(".fd-add-exp").click((function(){X()}));var u=l.find(".fd-xpath-editor-text");e.mug.form.richText?d.A.editor(u,p,r).on("change",x):u.on("change keyup",x),k().change(x);var m=function(t){e.done(t),a.empty()};return n.addClass("disabled").click((function(){var e=t.find(".xpath-simple").hasClass("hide")?T(C()):q();E(C(),e);var n=h(e);n[0]?m(e):P().html(o()(f()({errors:n[1].message}))).removeClass("hide")})),l.find(".fd-xpath-cancel-button").click((function(){m(!1)})),l}();!function(t){P().text("").addClass("hide"),w().empty(),"bool"===t.xpathType?(O(t.value),t.value||X()):t.mug.form.richText?D(t.value):D(p.normalizeXPath(t.value))}(e),e.onLoad&&e.onLoad(M)},validateXPath:S}},5261:(t,e,n)=>{const a=n(3946);t.exports=a.template('<div class="fd-xpath-editor-container form form-horizontal">\n\n    <fieldset class="xpath-advanced hide">\n        <legend> \n            <i class="fa fa-cog"></i> <%=gettext("Edit <span class=\'property-name\'>Expression</span> (Advanced)")%>\n            <button type="button" class="btn btn-default fd-xpath-show-simple-button pull-right xpath-mode-toggle">\n                <%-gettext("Show Simple Mode")%>\n            </button>\n        </legend>\n        <div class="alert alert-info xpath-advanced-notice hide">\n            <i class="fa fa-info-circle"></i>\n            <%-gettext("You are currently in Advanced Mode because your logic is too complicated for Simple Mode.")%>\n        </div>\n        <div class="form-group">\n            <label class="control-label col-sm-2">\n                <%-gettext("XPath Expression")%>\n            </label>\n            <div class="col-sm-10">\n                <<%= tag %> <%= tagArgs %>\n                          class="fd-textarea form-control fd-xpath-editor-text jstree-drop"></<%= tag %>>\n                <p class="help-block"><%-gettext("You can drag a question into the box.")%></p>\n                <p class="help-block">\n                    <a target="_blank"\n                       href="https://help.commcarehq.org/display/commcarepublic/Common+Logic+and+Calculations">\n                        <i class="fa fa-info-circle"></i> <%-gettext("Guide to Common Logic and Calculations")%>\n                    </a>\n                </p>\n            </div>\n        </div>\n    </fieldset>\n\n    <fieldset class="xpath-simple hide fieldset-condensed">\n        <legend>\n            <%=gettext("Edit <span class=\'property-name\'>Expression</span>")%>\n            <button type="button" class="btn btn-default pull-right xpath-mode-toggle fd-xpath-show-advanced-button">\n                <i class="fa fa-cog"></i> <%-gettext("Show Advanced Mode")%>\n            </button>\n        </legend>\n        <div class="form-group">\n            <label class="control-label col-sm-2"><%-gettext("Result is")%></label>\n            <div class="col-sm-10">\n                <select class="form-control top-level-join-select">\n                    <% _.each(topLevelJoinOpts, function (opt) { %>\n                    <option value="<%=opt[1]%>"><%=opt[0]%></option>\n                    <% }); %>\n                </select>\n            </div>\n        </div>\n        <div class="form-group">\n            <label class="control-label col-sm-2"><%-gettext("Expression")%></label>\n            <div class="col-sm-10">\n                <div class="fd-xpath-editor-expressions well"></div>\n                <p class="help-block pull-right">\n                    <a target="_blank"\n                       href="https://help.commcarehq.org/display/commcarepublic/Common+Logic+and+Calculations">\n                        <i class="fa fa-info-circle"></i> <%-gettext("Guide to Common Logic and Calculations")%>\n                    </a>\n                </p>\n                <p>\n                    <button type="button" class="btn btn-default fd-add-exp">\n                        <i class="fa fa-plus"></i> <%-gettext("Add Expression")%>\n                    </button>\n                </p>\n            </div>\n        </div>\n    </fieldset>\n\n    <div class="fd-xpath-validation-summary hide"></div>\n\n    <div class="form-actions form-actions-condensed fd-xpath-actions">\n        <div class="col-sm-2"></div>\n        <div class="col-sm-10">\n            <button type="button" class="btn btn-default fd-xpath-save-button"><%-gettext("Save")%></button>\n            <button type="button" class="btn btn-default fd-xpath-cancel-button"><%-gettext("Cancel")%></button>\n        </div>\n    </div>\n</div>\n')},8598:(t,e,n)=>{const a=n(3946);t.exports=a.template('<div class="form-group xpath-expression-group">\n    <div class="xpath-expression-row">\n        <div class="col-sm-3">\n            <<%=tag%> <%=tagArgs%> class="fd-input form-control left-question xpath-edit-node jstree-drop"\n                   type="text" placeholder="<%= leftPlaceholder %>" ></<%=tag%>>\n        </div>\n        <div class="col-sm-3">\n            <select class="form-control op-select">\n                <% _.each(operationOpts, function (opt) { %>\n                <option value="<%=opt[1]%>"><%=opt[0]%></option>\n                <% }); %>\n            </select>\n        </div>\n        <div class="col-sm-3">\n            <<%=tag%> <%=tagArgs%> class="fd-input form-control right-question xpath-edit-node jstree-drop"\n                   type="text" placeholder="<%= rightPlaceholder %>" ></<%=tag%>>\n        </div>\n        <div class="col-sm-3">\n            <button type="button" class="btn btn-danger xpath-delete-expression pull-right">\n                <i class="fa fa-remove"></i>\n            </button>\n            <div class="validation-result-container">\n                <p class="validation-results alert alert-success hide">\n                    <i class="fa fa-check"></i>\n                </p>\n                <p class="validation-results alert alert-danger hide">\n                    <i class="fa fa-warning"></i>\n                </p>\n            </div>\n        </div>\n    </div>\n</div>\n')},5881:(t,e,n)=>{const a=n(3946);t.exports=a.template('<div class="alert alert-danger">\n    <h4><i class="fa fa-warning"></i> <%-gettext("Validation Failed")%></h4>\n    <p><%-gettext("Please fix the error before leaving this page:")%></p>\n    <pre>\n      <%=errors%>\n    </pre>\n</div>\n')}}]);