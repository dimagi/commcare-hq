"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[498],{5498:(t,e,n)=>{var o=n(1134),a=n(8324),r=n.n(a),l=n(561),i=n.n(l),s=n(4523);const u='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/F1210EA5-49BA-4B44-A572-7C625D480C88" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<group>\n\t\t\t\t\t\t<label />\n\t\t\t\t\t\t<hidden />\n\t\t\t\t\t</group>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<bind vellum:nodeset="#form/group/label" nodeset="/data/group/label" vellum:relevant="#form/group/hidden = \'abc\'" relevant="/data/group/hidden = \'abc\'" />\n\t\t\t<bind vellum:nodeset="#form/group/hidden" nodeset="/data/group/hidden" calculate="1" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="group-label">\n\t\t\t\t\t\t<value>group</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/label-label">\n\t\t\t\t\t\t<value>label <output vellum:value="#form/group/hidden" value="/data/group/hidden"></output></value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group vellum:ref="#form/group" ref="/data/group">\n\t\t\t<label ref="jr:itext(\'group-label\')" />\n\t\t\t<trigger vellum:ref="#form/group/label" ref="/data/group/label" appearance="minimal">\n\t\t\t\t<label ref="jr:itext(\'group/label-label\')" />\n\t\t\t</trigger>\n\t\t</group>\n\t</h:body>\n</h:html>\n';var d=n(9675);const m='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<%=title%>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E5EA8911-36D1-418B-99DE-9DA98BB0F333" uiVersion="1" version="1" <%=dataName%> />\n\t\t\t</instance>\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="" />\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body />\n</h:html>',c='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/2F1F2BF5-6244-4C20-9B6F-2EF2A7BD2F34" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<group1>\n\t\t\t\t\t\t<group2>\n\t\t\t\t\t\t\t<group3 />\n\t\t\t\t\t\t</group2>\n\t\t\t\t\t</group1>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/group1" nodeset="/data/group1" />\n\t\t\t<bind vellum:nodeset="#form/group1/group2" nodeset="/data/group1/group2" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="group1-label">\n\t\t\t\t\t\t<value>group1</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group1/group2-label">\n\t\t\t\t\t\t<value>group2</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group1/group2/group3-label">\n\t\t\t\t\t\t<value>group3</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<group vellum:ref="#form/group1" ref="/data/group1">\n\t\t\t<label ref="jr:itext(\'group1-label\')" />\n\t\t\t<group vellum:ref="#form/group1/group2" ref="/data/group1/group2">\n\t\t\t\t<label ref="jr:itext(\'group1/group2-label\')" />\n\t\t\t\t<group vellum:ref="#form/group1/group2/group3" ref="/data/group1/group2/group3">\n\t\t\t\t\t<label ref="jr:itext(\'group1/group2/group3-label\')" />\n\t\t\t\t</group>\n\t\t\t</group>\n\t\t</group>\n\t</h:body>\n</h:html>\n',h='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/B0006B1B-5417-453A-9997-4F7D7B54B3B8" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<blue />\n\t\t\t\t\t<green />\n\t\t\t\t\t<black />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/blue" nodeset="/data/blue" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/green" nodeset="/data/green" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/black" nodeset="/data/black" type="xsd:string" vellum:relevant="#form/blue = \'abc\'" relevant="/data/blue = \'abc\'" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="blue-label">\n\t\t\t\t\t\t<value>blue</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="green-label">\n\t\t\t\t\t\t<value>green</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="black-label">\n\t\t\t\t\t\t<value>black</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/blue" ref="/data/blue">\n\t\t\t<label ref="jr:itext(\'blue-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/green" ref="/data/green">\n\t\t\t<label ref="jr:itext(\'green-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/black" ref="/data/black">\n\t\t\t<label ref="jr:itext(\'black-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',g='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n    <h:head>\n        <h:title>Untitled Form</h:title>\n        <model>\n            <instance>\n                <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/D1202637-1EFD-4A9C-A0CE-958FD137F9AF" uiVersion="1" version="1" name="Untitled Form">\n                    <question1 />\n                    <question2 />\n                </data>\n            </instance>\n            <bind vellum:nodeset="#form/question1" nodeset="/data/question1" />\n            <bind vellum:nodeset="#form/question2" nodeset="/data/question2" />\n            <itext>\n                <translation lang="en" default="">\n                    <text id="question1-label">\n                        <value>question1</value>\n                    </text>\n                    <text id="question1-item1-label">\n                        <value>item1</value>\n                    </text>\n                    <text id="question2-item1-label">\n                        <value>item1</value>\n                    </text>\n                    <text id="question1-item2-label">\n                        <value>item2</value>\n                    </text>\n                    <text id="question2-label">\n                        <value>question2</value>\n                    </text>\n                    <text id="question2-item2-label">\n                        <value>item2</value>\n                    </text>\n                </translation>\n            </itext>\n        </model>\n    </h:head>\n    <h:body>\n        <select1 vellum:ref="#form/question1" ref="/data/question1">\n            <label ref="jr:itext(\'question1-label\')" />\n            <item>\n                <label ref="jr:itext(\'question1-item1-label\')" />\n                <value>item1</value>\n            </item>\n            <item>\n                <label ref="jr:itext(\'question2-item1-label\')" />\n                <value>item1</value>\n            </item>\n            <item>\n                <label ref="jr:itext(\'question1-item2-label\')" />\n                <value>item2</value>\n            </item>\n        </select1>\n        <select vellum:ref="#form/question2" ref="/data/question2">\n            <label ref="jr:itext(\'question2-label\')" />\n            <item>\n                <label ref="jr:itext(\'question2-item2-label\')" />\n                <value>item2</value>\n            </item>\n        </select>\n    </h:body>\n</h:html>\n';var f=r().assert,p=o.A.call;describe("The form component",(function(){function t(t,e,n,a){var r=s.Ay.isString(e)?e:e.createXML(),l=o.A.parseXML(r).find("model > instance[id='"+t+"']").attr("src");f.equal(l,n,a?a+"\n"+r:"")}before((function(t){o.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t()}}})})),it("should get and fix serialization errors for mugs with matching paths",(function(){var t=o.A.loadXML(""),e=o.A.addQuestion("Text","question"),n=o.A.addQuestion("Text","question");f.notEqual(e.absolutePath,n.absolutePath);var a=t.getSerializationWarnings();f.equal(a.length,1,"missing serialization error message"),f.equal(a[0].mug.ufid,n.ufid),t.fixSerializationWarnings(a),f.equal(e.p.nodeID,"question"),f.notEqual(e.absolutePath,n.absolutePath),a=t.getSerializationWarnings(),f.deepEqual(a,[],JSON.stringify(a))})),it("should retain expression meaning on rename matching path",(function(){var t=o.A.addQuestion("Text","blue"),e=o.A.addQuestion("Text","green"),n=o.A.addQuestion("DataBindOnly","black");n.p.calculateAttr="#form/blue + #form/green",e.p.nodeID="blue",f.notEqual(e.p.nodeID,"blue"),f(!o.A.isTreeNodeValid(e),"expected validation error"),t.p.nodeID="orange",f.equal(e.p.nodeID,"blue"),f.equal(n.p.calculateAttr,"#form/orange + #form/blue"),f(o.A.isTreeNodeValid(t),t.getErrors().join("\n")),f(o.A.isTreeNodeValid(e),e.getErrors().join("\n")),f(o.A.isTreeNodeValid(n),n.getErrors().join("\n"))})),it("should retain conflicted mug ID on move",(function(){var t=o.A.loadXML(""),e=o.A.addQuestion("DataBindOnly","hid"),n=o.A.addQuestion("Text","text"),a=o.A.addQuestion("Group","group");o.A.addQuestion("Text","text"),e.p.calculateAttr="#form/text + #form/group/text",t.moveMug(n,"into",a),f.notEqual(e.p.calculateAttr,"#form/text + #form/group/text"),f.notEqual(n.p.nodeID,"text"),f(!o.A.isTreeNodeValid(n),"expected #form/text error"),t.moveMug(n,"into",null),f.equal(n.p.nodeID,"text"),f.equal(e.p.calculateAttr,"#form/text + #form/group/text"),f(o.A.isTreeNodeValid(n),n.getErrors().join("\n"))})),describe("The form's ID generation",(function(){before((function(t){o.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t()}},features:{rich_text:!1}})})),it("should generate ID based on label",(function(){o.A.loadXML("");var t=p("addQuestion","Text");i()("[name='itext-en-label']").val("What is your name?").change();var e=p("addQuestion","Text"),n=p("addQuestion","Text");i()("[name='itext-en-label']").val("What is your name?").change();var a=p("addQuestion","Text");f.equal(t.p.nodeID,"what_is_your_name"),f.equal(e.p.nodeID,"question1"),f.equal(n.p.nodeID,"copy-1-of-what_is_your_name"),f.equal(a.p.nodeID,void 0)}))})),it("should show warnings for broken references on delete mug",(function(){o.A.loadXML(h);var t=p("getMugByPath","/data/blue"),e=p("getMugByPath","/data/green"),n=p("getMugByPath","/data/black");f(o.A.isTreeNodeValid(e),"sanity check failed: green is invalid"),f(o.A.isTreeNodeValid(n),"sanity check failed: black is invalid"),o.A.clickQuestion("blue"),t.form.removeMugsFromForm([t]),f(o.A.isTreeNodeValid(e),"green should be valid"),f(!o.A.isTreeNodeValid(n),"black should not be valid")})),it("should remove warnings when broken reference is fixed",(function(){o.A.loadXML(h);var t=p("getMugByPath","/data/blue"),e=p("getMugByPath","/data/black");t.form.removeMugsFromForm([t]),f(!o.A.isTreeNodeValid(e),"black should not be valid"),t=o.A.addQuestion("Text","blue"),f(o.A.isTreeNodeValid(e),o.A.getMessages(e))})),it("should remove warnings when broken mug is deleted",(function(){var t=o.A.loadXML(h),e=p("getMugByPath","/data/blue"),n=p("getMugByPath","/data/black");t.removeMugsFromForm([e]),f(t.hasBrokenReferences(),"form should have broken reference"),t.removeMugsFromForm([n]),f(!t.hasBrokenReferences(),"form should not have broken references")})),it("should show duplicate question ID warning inline",(function(){o.A.loadXML(""),o.A.addQuestion("Text","text");var t=o.A.addQuestion("Text","text").messages.get("nodeID");f.equal(t.length,1,t.join("\n"));var e=i()("[name=property-nodeID]").closest(".widget").find(".messages").children();f.equal(e.length,t.length,e.text()),f.equal(e[0].text,t[0].message)})),it("should warn about top-level question named 'case'",(function(){o.A.loadXML("");var t=o.A.addQuestion("Text","case");f(t.messages.get("nodeID","mug-nodeID-reserved-name-warning"),"mug-nodeID-reserved-name-warning was expected but not present"),t.p.nodeID="the-case",f.equal(o.A.getMessages(t),"")})),it("should warn about question named 'Case' in group",(function(){o.A.loadXML(""),o.A.addQuestion("Group","group");var t=o.A.addQuestion("Text","Case");f(t.messages.get("nodeID","mug-nodeID-reserved-name-warning"),"mug-nodeID-reserved-name-warning was expected but not present"),t.p.nodeID="the-case",f.equal(o.A.getMessages(t),"")})),it("should warn about question named 'registration'",(function(){o.A.loadXML(""),o.A.addQuestion("Group","group");var t=o.A.addQuestion("Text","registration");f(t.messages.get("nodeID","mug-nodeID-reserved-name-warning"),"mug-nodeID-reserved-name-warning was expected but not present"),t.p.nodeID="the-case",f.equal(o.A.getMessages(t),"")})),it("should preserve internal references in copied group",(function(){o.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/D84CF253-0C19-40B4-B6A0-62D4D3E9492C" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<red />\n\t\t\t\t\t<group>\n\t\t\t\t\t\t<blue />\n\t\t\t\t\t\t<green />\n\t\t\t\t\t</group>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/red" nodeset="/data/red" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<bind vellum:nodeset="#form/group/blue" nodeset="/data/group/blue" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/group/green" nodeset="/data/group/green" type="xsd:string" vellum:relevant="#form/group/blue = \'red\' and #form/red = \'blue\'" relevant="/data/group/blue = \'red\' and /data/red = \'blue\'" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="red-label">\n\t\t\t\t\t\t<value>red</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group-label">\n\t\t\t\t\t\t<value>group</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/blue-label">\n\t\t\t\t\t\t<value>blue</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="group/green-label">\n\t\t\t\t\t\t<value>green</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/red" ref="/data/red">\n\t\t\t<label ref="jr:itext(\'red-label\')" />\n\t\t</input>\n\t\t<group vellum:ref="#form/group" ref="/data/group">\n\t\t\t<label ref="jr:itext(\'group-label\')" />\n\t\t\t<input vellum:ref="#form/group/blue" ref="/data/group/blue">\n\t\t\t\t<label ref="jr:itext(\'group/blue-label\')" />\n\t\t\t</input>\n\t\t\t<input vellum:ref="#form/group/green" ref="/data/group/green">\n\t\t\t\t<label ref="jr:itext(\'group/green-label\')" />\n\t\t\t</input>\n\t\t</group>\n\t</h:body>\n</h:html>\n');var t=p("getData").core.form,e=o.A.getMug("group");t.duplicateMug(e);var n=o.A.getMug("copy-1-of-group/green");f.equal(n.p.relevantAttr,"#form/copy-1-of-group/blue = 'red' and #form/red = 'blue'")})),it("should set non-standard form root node",(function(){o.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<other xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/B0006B1B-5417-453A-9997-4F7D7B54B3B8" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<blue />\n\t\t\t\t</other>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/blue" nodeset="/other/blue" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="blue-label">\n\t\t\t\t\t\t<value>blue</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input ref="blue">\n\t\t\t<label ref="jr:itext(\'blue-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n');var t=p("getData").core.form,e=p("getMugByPath","/other/blue");f.equal(t.getBasePath(),"/other/"),f(null!==e,"mug not found: /other/blue"),f.equal(t.hashtagMap["#form"],"/other")})),it("should be able to move item from Select to MSelect",(function(){o.A.loadXML(g);var t=p("getData").core.form,e=o.A.addQuestion("Choice","choice1"),n=o.A.addQuestion("Choice","choice2");t.moveMug(e,"before",n)})),it("should update reference to hidden value in group",(function(){o.A.loadXML(u);var t=p("getMugByPath","/data/group"),e=p("getMugByPath","/data/group/label"),n=p("getMugByPath","/data/group/hidden");r().expect(e.p.relevantAttr).to.include("#form/group/hidden"),t.p.nodeID="x",f.equal(t.absolutePath,"/data/x"),f.equal(e.absolutePath,"/data/x/label"),f.equal(n.absolutePath,"/data/x/hidden"),r().expect(e.p.relevantAttr).to.include("#form/x/hidden")})),it("should update reference to moved hidden value in output tag",(function(){o.A.loadXML(u);var t=p("getData").core.form,e=p("getMugByPath","/data/group/label"),n=p("getMugByPath","/data/group/hidden");r().expect(e.p.relevantAttr).to.include("#form/group/hidden"),r().expect(e.p.labelItext.defaultValue()).to.include("#form/group/hidden"),t.moveMug(n,"first",null),f.equal(n.absolutePath,"/data/hidden"),r().expect(e.p.relevantAttr).to.include("#form/hidden"),r().expect(e.p.labelItext.defaultValue()).to.include("#form/hidden")})),it("should update repeat group reference",(function(){o.A.loadXML("");var t=o.A.addQuestion("Text","text"),e=o.A.addQuestion("Repeat","repeat");e.p.repeat_count="#form/text",f.equal(e.p.repeat_count,"#form/text"),t.p.nodeID="text2",f.equal(e.p.repeat_count,"#form/text2")})),it("should show warnings for duplicate choice value",(function(){o.A.loadXML(""),o.A.addQuestion("Select","select");var t=o.A.addQuestion("Choice","choice1"),e=o.A.addQuestion("Choice","choice2");f(o.A.isTreeNodeValid(t),t.getErrors().join("\n")),f(o.A.isTreeNodeValid(e),e.getErrors().join("\n")),e.p.nodeID="choice1",f(o.A.isTreeNodeValid(t),"choice1 should be valid"),f(!o.A.isTreeNodeValid(e),"choice2 should be invalid")})),it("should preserve order of the control tree",(function(){o.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n    <h:head>\n        <h:title>Untitled Form</h:title>\n        <model>\n            <instance>\n                <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/606D428D-4D37-43A5-81E2-EB793CE4E441" uiVersion="1" version="1" name="Untitled Form">\n                    <question1 />\n                    <question5 />\n                    <question2>\n                        <question3 />\n                    </question2>\n                    <question6 />\n                    <question4 />\n                </data>\n            </instance>\n            <bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:string" />\n            <bind vellum:nodeset="#form/question5" nodeset="/data/question5" />\n            <bind vellum:nodeset="#form/question2" nodeset="/data/question2" />\n            <bind vellum:nodeset="#form/question2/question3" nodeset="/data/question2/question3" type="xsd:string" />\n            <bind vellum:nodeset="#form/question6" nodeset="/data/question6" />\n            <bind vellum:nodeset="#form/question4" nodeset="/data/question4" type="xsd:string" />\n            <itext>\n                <translation lang="en" default="">\n                    <text id="question1-label">\n                        <value>question1</value>\n                    </text>\n                    <text id="question2-label">\n                        <value>question2</value>\n                    </text>\n                    <text id="question2/question3-label">\n                        <value>question3</value>\n                    </text>\n                    <text id="question2/question4-label">\n                        <value>question4</value>\n                    </text>\n                </translation>\n            </itext>\n        </model>\n    </h:head>\n    <h:body>\n        <input vellum:ref="#form/question1" ref="/data/question1">\n            <label ref="jr:itext(\'question1-label\')" />\n        </input>\n        <input vellum:ref="#form/question4" ref="/data/question4">\n            <label ref="jr:itext(\'question2/question4-label\')" />\n        </input>\n        <group vellum:ref="#form/question2" ref="/data/question2">\n            <label ref="jr:itext(\'question2-label\')" />\n            <input vellum:ref="#form/question2/question3" ref="/data/question2/question3">\n                <label ref="jr:itext(\'question2/question3-label\')" />\n            </input>\n        </group>\n    </h:body>\n</h:html>\n'),o.A.assertJSTreeState("question1","question4","question2","  question3","question5","question6")})),it("should merge data-only-nodes with control nodes",(function(){o.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n    <h:head>\n        <h:title>Untitled Form</h:title>\n        <model>\n            <instance>\n                <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/606D428D-4D37-43A5-81E2-EB793CE4E441" uiVersion="1" version="1" name="Untitled Form">\n                    <question1 />\n                    <question5 />\n                    <question2>\n                        <question3 />\n                    </question2>\n                    <question6 />\n                    <question4 />\n                </data>\n            </instance>\n            <bind vellum:nodeset="#form/question1" nodeset="/data/question1" type="xsd:string" />\n            <bind vellum:nodeset="#form/question5" nodeset="/data/question5" />\n            <bind vellum:nodeset="#form/question2" nodeset="/data/question2" />\n            <bind vellum:nodeset="#form/question2/question3" nodeset="/data/question2/question3" type="xsd:string" />\n            <bind vellum:nodeset="#form/question6" nodeset="/data/question6" />\n            <bind vellum:nodeset="#form/question4" nodeset="/data/question4" type="xsd:string" />\n            <itext>\n                <translation lang="en" default="">\n                    <text id="question1-label">\n                        <value>question1</value>\n                    </text>\n                    <text id="question2-label">\n                        <value>question2</value>\n                    </text>\n                    <text id="question2/question3-label">\n                        <value>question3</value>\n                    </text>\n                    <text id="question4-label">\n                        <value>question4</value>\n                    </text>\n                </translation>\n            </itext>\n        </model>\n    </h:head>\n    <h:body>\n        <input vellum:ref="#form/question1" ref="/data/question1">\n            <label ref="jr:itext(\'question1-label\')" />\n        </input>\n        <group vellum:ref="#form/question2" ref="/data/question2">\n            <label ref="jr:itext(\'question2-label\')" />\n            <input vellum:ref="#form/question2/question3" ref="/data/question2/question3">\n                <label ref="jr:itext(\'question2/question3-label\')" />\n            </input>\n        </group>\n        <input vellum:ref="#form/question4" ref="/data/question4">\n            <label ref="jr:itext(\'question4-label\')" />\n        </input>\n    </h:body>\n</h:html>\n'),o.A.assertJSTreeState("question1","question5","question2","  question3","question6","question4")})),it("should delete nested groups",(function(){var t=o.A.loadXML(c),e=o.A.clickQuestion("group1","group1/group2");t.removeMugsFromForm(e),o.A.assertJSTreeState("")})),it("should delete nested groups v2",(function(){var t=o.A.loadXML(c),e=o.A.clickQuestion("group1","group1/group2/group3");t.removeMugsFromForm(e),o.A.assertJSTreeState("")})),it("should not drop referenced instance on delete dynamic select",(function(){var e=o.A.loadXML("");o.A.paste([["id","type","labelItext:en-default","calculateAttr","itemsetData"],["/hidden","DataBindOnly","null","instance('some-fixture')/some-fixture_list/some-fixture/@id","null"],["/select","SelectDynamic","select","null",'[{"instance":{"id":"some-fixture","src":"jr://fixture/item-list:some-fixture"},"nodeset":"instance(\'some-fixture\')/some-fixture_list/some-fixture","labelRef":"name","valueRef":"@id"}]']]),o.A.deleteQuestion("select"),t("some-fixture",e,"jr://fixture/item-list:some-fixture","some-fixture instance not found")})),it("should drop instance on delete last reference",(function(){var e=o.A.loadXML("");o.A.paste([["id","type","calculateAttr","instances"],["/hidden","DataBindOnly","instance('some-fixture')/some-fixture_list/some-fixture/@id",'{"some-fixture":"jr://fixture/item-list:some-fixture"}']]),t("some-fixture",e,"jr://fixture/item-list:some-fixture"),o.A.deleteQuestion("hidden"),t("some-fixture",e,void 0,"some-fixture instance not found")})),it("should maintain instance on delete and re-add last reference",(function(){var e=o.A.loadXML("");o.A.paste([["id","type","calculateAttr","instances"],["/hidden","DataBindOnly","instance('some-fixture')/some-fixture_list/some-fixture/@id",'{"some-fixture":"jr://fixture/item-list:some-fixture"}']]),o.A.deleteQuestion("hidden"),t("some-fixture",e,void 0),o.A.addQuestion("DataBindOnly","hid").p.calculateAttr="instance('some-fixture')/some-fixture_list/some-fixture/@id",t("some-fixture",e,"jr://fixture/item-list:some-fixture","some-fixture instance not found")})),it("should not delete instance from itemsets with nested filters",(function(){t("groups",o.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/38975ec8a2d227893fa2ef64793d2afb4cb94dc7" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<contact_chiefdom />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance id="groups" src="jr://fixture/user-groups"/>\n\t\t\t<bind vellum:nodeset="#form/contact_chiefdom" nodeset="/data/contact_chiefdom" required="true()" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="question7-label">\n\t\t\t\t\t\t<value>Contact\'s Chiefdom</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/contact_chiefdom" ref="/data/contact_chiefdom">\n\t\t\t<label ref="jr:itext(\'question7-label\')" />\n\t\t\t<itemset nodeset="instance(\'groups\')/groups/group[count(group_data/data[@key = \'group_type\'][. = \'chiefdom\']) &gt; 0]">\n\t\t\t\t<label ref="name" />\n\t\t\t\t<value ref="@id" />\n\t\t\t</itemset>\n\t\t</select1>\n\t</h:body>\n</h:html>\n'),"jr://fixture/user-groups","groups instance not found")})),it("should not delete manual instances when it's reference is updated",(function(){o.A.loadXML(d),o.A.clickQuestion("output"),i()("[name=property-calculateAttr]").change(),o.A.assertXmlEqual(p("createXML"),d)})),it("should warn on delete question",(function(){o.A.loadXML(""),o.A.paste([["id","type","labelItext:en-default"],["/q1","Text",'<output value="#form/q2" /> <output value="#form/q3" />'],["/q2","DataBindOnly","null"],["/q3","DataBindOnly","null"]]);var t=o.A.getMug("q1");f(o.A.isTreeNodeValid(t),t.getErrors().join("\n")),o.A.deleteQuestion("q2"),f(!o.A.isTreeNodeValid(t),"q1 should not be valid")})),it("should warn about changing question ID",(function(){o.A.loadXML(g).warnWhenChanged=!0;var t=o.A.getMug("question1");f.equal(o.A.getMessages(t),""),t.p.nodeID="new-question-id",f(t.messages.get("nodeID","mug-nodeID-changed-warning"),"mug-nodeID-changed-warning was expected"),t.p.nodeID="question1",f.equal(o.A.getMessages(t),"")})),it("should not warn about changing question ID",(function(){o.A.loadXML(g).warnWhenChanged=!1;var t=o.A.getMug("question1");f.equal(o.A.getMessages(t),""),t.p.nodeID="new-question-id",f(t.messages.get("nodeID",""),"mug-nodeID-changed-warning was not expected")})),it("should skip warning about changing question ID",(function(){o.A.loadXML(g).warnWhenChanged=!0;var t=o.A.getMug("question1");f.equal(o.A.getMessages(t),""),t.p.nodeID="new-question-id",f(t.messages.get("nodeID","mug-nodeID-changed-warning"),"mug-nodeID-changed-warning was expected"),t.showChangedMsg=!1,f(t.messages.get("nodeID",""),"mug-nodeID-changed-warning was not expected")})),it("should load choice with missing value",(function(){o.A.loadXML('<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/510328F4-59B2-4168-ABF7-F96FA40BB790" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<choice />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/choice" nodeset="/data/choice" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="choice-label">\n\t\t\t\t\t\t<value>choice</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="choice-empty-label">\n\t\t\t\t\t\t<value>empty</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<select1 vellum:ref="#form/choice" ref="/data/choice">\n\t\t\t<label ref="jr:itext(\'choice-label\')" />\n\t\t\t<item>\n\t\t\t\t<label ref="jr:itext(\'choice-empty-label\')" />\n\t\t\t</item>\n\t\t</select1>\n\t</h:body>\n</h:html>\n');var t=o.A.getMug("choice/");f.equal(t.p.nodeID,""),f(t.messages.get("nodeID","mug-nodeID-error"),"mug-nodeID-error was expected")})),describe("with async data sources",(function(){var t,e;before((function(n){o.A.init({javaRosa:{langs:["en"]},core:{dataSourcesEndpoint:function(t){e=t},onReady:function(){t=this,n()}}})})),beforeEach((function(){t.datasources.reset(),e=null})),it("should not set case hashtags flag before data sources are loaded",(function(){var t=o.A.loadXML("");f.isNotOk(t.hasCaseHashtags),e(o.A.options.dataSources),f.isOk(t.hasCaseHashtags)})),it("should update fuse when data sources are loaded",(function(){var t=o.A.loadXML("");t.fire("form-load-finished"),f.deepEqual(t.fuse.list(),[]),e(o.A.options.dataSources),f.notDeepEqual(t.fuse.list(),[])}))})),describe("with rich text disabled",(function(){before((function(t){o.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t()}},features:{rich_text:!1}})})),it("should update case hashtags on enabling rich text",(function(){var t=o.A.loadXML("");o.A.addQuestion("Text","text"),f(t.isValidHashtag("#form/text"),"not valid: #form/text"),t.setAttr("richText",!0),f(t.isValidHashtag("#case/dob"),"not valid: #case/dob"),f(t.isValidHashtag("#form/text"),"not valid: #form/text")})),it("should update fuse on enabling rich text",(function(){var t=o.A.loadXML("");t.fire("form-load-finished"),f.deepEqual(t.fuse.list(),[]),t.setAttr("richText",!0),f.notDeepEqual(t.fuse.list(),[])}))})),describe("naming logic",(function(){before((function(t){o.A.init({javaRosa:{langs:["en"]},core:{formName:null,onReady:function(){t()}}})})),it("should use default name for empty form",(function(){var t=o.A.loadXML(""),e=o.A.parseXML(p("createXML"));f.equal(t.formName,"New Form"),f.equal(i()(e[0].getElementsByTagName("h:title")).text(),"New Form","title"),f.equal(e.find("data").attr("name"),"New Form","data")})),it("should use default name when no other name is specified",(function(){var t=o.A.loadXML(s.Ay.template(m)({title:"",dataName:""}),null,/^Form does not have a Name!/),e=o.A.parseXML(p("createXML"));f.equal(t.formName,"New Form"),f.equal(i()(e[0].getElementsByTagName("h:title")).text(),"New Form","title"),f.equal(e.find("data").attr("name"),"New Form","data")})),it('should prefer <data name="..."> over <title>',(function(){var t=o.A.loadXML(s.Ay.template(m)({title:"<h:title>Title</h:title>",dataName:'name="Data Name"'})),e=o.A.parseXML(p("createXML"));f.equal(t.formName,"Data Name"),f.equal(i()(e[0].getElementsByTagName("h:title")).text(),"Data Name","title"),f.equal(e.find("data").attr("name"),"Data Name","data")})),it('should use <title> if <data name="..."> is absent',(function(){var t=o.A.loadXML(s.Ay.template(m)({title:"<h:title>Title</h:title>",dataName:""})),e=o.A.parseXML(p("createXML"));f.equal(t.formName,"Title"),f.equal(i()(e[0].getElementsByTagName("h:title")).text(),"Title","title"),f.equal(e.find("data").attr("name"),"Title","data")})),describe("with core.formName option",(function(){before((function(t){o.A.init({javaRosa:{langs:["en"]},core:{formName:"Optional Name",onReady:function(){t()}}})})),it("should override all other names",(function(){var t=o.A.loadXML(s.Ay.template(m)({title:"<h:title>Title</h:title>",dataName:'name="Data Name"'})),e=o.A.parseXML(p("createXML"));f.equal(t.formName,"Optional Name"),f.equal(i()(e[0].getElementsByTagName("h:title")).text(),"Optional Name","title"),f.equal(e.find("data").attr("name"),"Optional Name","data")}))}))})),describe("instance tracker",(function(){var e,n,a="calculateAttr";before((function(){e=o.A.loadXML(""),n=o.A.addQuestion("DataBindOnly","hid"),a="calculateAttr",e.addInstanceIfNotExists({id:"old",src:"old://"},n,"relevantAttr"),e.addInstanceIfNotExists({id:"blank"},n,"relevantAttr"),e.updateKnownInstances({known:"known://"})})),s.Ay.each([[{id:"new0",src:null},"new0",void 0],[{id:"new1",src:"new://1"},"new1","src"],[{id:"new2",src:"old://"},"old","src"],[{id:"old",src:null},"old","old://"],[{id:"old",src:"new://3"},"old-1","src"],[{id:"old",src:"old://"},"old","src"],[{id:"any",src:"old://"},"old","src"],[{id:"known",src:void 0},"known","known://"],[{id:"blank",src:"blank://"},"blank","src"],[{id:null,src:"new://5"},"data-1","src"]],(function(o){var l=o[0],i=o[1],u="src"===o[2]?l.src:o[2];it("should add instance "+JSON.stringify(l)+" -> "+i+": "+u,(function(){t(i,e,"old"===i?u:void 0);var o=e.addInstanceIfNotExists(l,n,a);s.Ay.isRegExp(i)?r().expect(o).to.match(i):f.equal(o,i),t(i,e,u,i+" instance not found"),e.dropAllInstanceReferences(n,a),t(i,e,"old"===i||"blank"===i?u:void 0,i+" instance should be removed")}))}))})),describe("hashtag logic",(function(){var t,e={};before((function(){t=o.A.loadXML("")})),e["instance('casedb')/cases/case[@case_id = instance('commcaresession')/session/data/case_id]/dob"]="xpath",s.Ay.each(s.Ay.extend({"":null,"#":null,"#form":null,"/data":null,"/data/":null,"/data/prop":"xpath","#case":null,"#case/prop":"has xpath","#case/parent":"has xpath","#case/parent/prop":"has xpath","#case/grandparent":"has xpath","#case/grandparent/prop":"has xpath","#case/nope/not":null,"#user":null,"#user/prop":"has xpath"},e),(function(e,n){function o(t){return e[t]?"":"not "}e=s.Ay.object(s.Ay.map((e||"").split(" "),(function(t){return[t,!0]}))),it("should "+o("has")+"recognize "+n+" as having hashtag prefix",(function(){f.equal(t.hasValidHashtagPrefix(n),!!e.has)})),it("should "+o("xpath")+"parse "+n+" to valid xpath",(function(){try{t.xpath.parse(n).toXPath(),f(e.xpath,"valid?! "+n)}catch(t){f(!e.xpath,"not valid: "+n+"\nerror: "+t)}}))}))})),describe("updateInstanceQuery",(function(){it("should replace ids if old instance Id is provided",(function(){const t=o.A.loadXML("").updateInstanceQuery("instance('oldId')/session/data/case_id","newId","oldId");f.equal(t,"instance('newId')/session/data/case_id")})),it("should replace ids if there is leading white space",(function(){const t=o.A.loadXML("").updateInstanceQuery("word instance('oldId')/session/data/case_id","newId","oldId");f.equal(t,"word instance('newId')/session/data/case_id")})),it("should replace ids if there is no old",(function(){const t=o.A.loadXML("").updateInstanceQuery("instance('oldId')/session/data/case_id","newId");f.equal(t,"instance('newId')/session/data/case_id")}))}))}))},1134:(t,e,n)=>{n.d(e,{A:()=>F});var o=n(8449),a=n(8324),r=n.n(a),l=n(6848),i=n.n(l),s=n(3794),u=n(4523),d=n(561),m=n.n(d),c=n(1437),h=n.n(c),g=n(3809),f=n.n(g),p=n(705),x=n.n(p),v=n(7229),b=n.n(v),w=(n(1460),n(8803),r().assert),q=["Form Builder clip","version 1"];function A(t,e,n){if((n=u.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var o=b().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+o+'"')}var a,r,l,s,d=(a=t,r=e,l=i().xml(a),s=i().xml(r),i().isEquivalent(l,s,{element_order:!0}));n.not&&(d=!d),d||y(t=j(t),e=j(e),"XML "+(n.not?"should not be equivalent":"mismatch"))}function y(t,e,n){if(t!==e){var o=(0,s.createPatch)("",t,e,"actual","expected");o=o.replace(/^Index:/,n||"Not equal:"),w(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(o))}}function j(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function M(t){return I("getCurrentMugInput",t)}function D(t){var e=m()("#vellum").vellum("get"),n=u.Ay.isString(t)?m()("[name="+t+"]"):t;return x().util.getWidget(n,e)}function I(){var t=Array.prototype.slice.call(arguments),e=m()("#vellum");return e.vellum.apply(e,t)}function X(){var t=[],e=u.Ay.map(arguments,(function(e){var n=u.Ay.isString(e)?L(e):e;if(!n||!n.ufid)throw new Error("mug not found: "+e);return t.push(n),n.ufid}));return I("jstree","deselect_all",!0),I("jstree","select_node",e),m()(".collapse-toggle.collapsed").click(),t}function L(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=I("getMugByPath",t);if(!e){var n=t.split("/"),o=I("getMugByPath",n.slice(0,-1).join("/"));if(o&&o.__className.indexOf("Select")>-1){var a=I("getData").core.form.getChildren(o),r=n[n.length-1];if(1===a.length&&"itemset"===r&&"itemset"===a[0].options.tagName)return a[0];for(var l=0;l<a.length;l++)if(a[l].p.nodeID===r)return a[l]}}return e}w.equal=w.strictEqual,w.notEqual=w.notStrictEqual;const F={options:o.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=m().extend(!0,{},o.A.options,t),n=m().fn.animate;m().fn.animate=function(t,e,o,a){n.apply(this,[t,0,o,a])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=u.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&u.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var a=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,a(t)};var r=m()("#vellum"),l=r.vellum("get");l&&(l.destroy(),m()("body > div.modal, body > div.modal-backdrop").remove()),r.empty().vellum(e)},call:I,loadXML:function(t,e,n,o,a=!0){var r=[],l=I("getData");return o||window.history.replaceState(null,null," "),l.core.parseWarnings=[],I("loadXML",t,e||{},{reset:a}),n?u.Ay.isRegExp(n)&&(r=u.Ay.filter(l.core.parseWarnings,(function(t){return!n.test(t)}))):r=l.core.parseWarnings,w(!r.length,"unexpected parse warnings:\n- "+r.join("\n- ")),delete l.core.parseWarnings,l.core.form},saveAndReload:function(t){I("loadXFormOrError",I("createXML"),t)},getMug:L,getInput:M,getWidget:D,getMediaUploader:function(t){var e,n={},o=D(t);if(!o)throw new Error("media uploader widget not found");if(u.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(e=t.closest(n)).length})),!e)throw new Error("media uploader element not found");return n.upload=function(t){var n={ref:{path:o.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",n)},n},assertEqual:y,assertInputCount:function(t,e,n){u.Ay.isString(t)?(n=" for "+(n?n+" ":"")+t,t=M(t)):n=n?" for "+n:"",w.equal(t.length,e,"wrong number of inputs"+n)},assertXmlEqual:A,assertXmlNotEqual:function(t,e,n){(n=n||{}).not=!0,A(t,e,n)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";y(function t(e,n){var o,a,r,l=[];for("#"===e.id?n=-1:l.push(Array(2*n+1).join(" ")+e.text),o=0,a=e.children.length;o<a;o++)r=I("jstree","get_node",e.children[o]),l.push(t(r,n+1));return l.join("\n")}(I("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";y(function t(e,n){var o,a,r,l=[];for(e.isRootNode?n=-1:l.push(Array(2*n+1).join(" ")+e.value.p.nodeID),o=0,a=e.children.length;o<a;o++)r=e.children[o],l.push(t(r,n+1));return l.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,n){n=u.Ay.extend({},n),this.prevId&&X(this.prevId);var o=I("addQuestion",t);return e||o.p.nodeID||(e=I("nodeIDFromLabel",o)),e&&(w(u.Ay.isUndefined(n.nodeID),"unexpected attribute for "+t+"["+e+"]"),o.p.labelItext&&o.p.labelItext.set(o.getLabelValue()),o.p.nodeID=e,"Choice"!==t||n.hasOwnProperty("labelItext")||(n.labelItext=e)),u.Ay.each(n,(function(t,e){u.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?o.p[e].set(t):o.p[e]=t})),u.Ay.each(I("getSections",o),(function(t){I("collapseSection",t.slug,!1)})),o},paste:function(t,e,n){u.Ay.isString(t)||(t=f().tabDelimit([q].concat(t))),n&&window.console.log(t),w.deepEqual(h().paste(t),e||[])},clickQuestion:X,selectAll:function(){I("jstree","select_all")},deleteQuestion:function(){var t=u.Ay.map(arguments,(function(t){var e=L(t);return w(e,"mug not found: "+t),e}));I("getData").core.form.removeMugsFromForm(t),u.Ay.each(arguments,(function(t){w(!L(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=I("getData").core.saveButton;if(!u.Ay.isUndefined(t)){var n=t?"save":"saved";e.setStateWhenReady(n),w.equal(e.state,n,"sanity check failed")}return"save"===e.state},expandGroup:function(t){I("jstree","open_node",t.ufid),I("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){I("jstree","close_node",t.ufid),I("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],n=null;if(u.Ay.isString(t)){var o=t;t=L(o),w(t,"mug not found: "+o)}return t.messages.each((function(t,o){o!==n&&(e.push(o+":"),n=o),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,n){if(u.Ay.isString(e)){var o=e;e=function(t){return t.text===o}}return function n(o){var a,r,l;if(e(o))return o;for(a=0,r=o.children.length;a<r;a++)if(l=n(t.get_node(o.children[a])))return l;return null}(n||t.get_node("#"))},isTreeNodeValid:function(t){if(u.Ay.isString(t)){var e=t;t=L(e),w(t,"mug not found: "+e)}return 0===m()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return m()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:b().parseXML}},9675:t=>{t.exports='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/C1D14B65-7FA3-4A88-B5C6-217B6DBB3BB2" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<score />\n\t\t\t\t\t<output />\n\t\t\t\t\t<result />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance id="scores">\n\t\t\t\t<score low="0.0" high="500.0">You\'re really bad</score>\n\t\t\t\t<score low="500.0" high="99999999.0">You\'re really good</score>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/score" nodeset="/data/score" type="xsd:int" />\n\t\t\t<bind vellum:nodeset="#form/output" nodeset="/data/output" vellum:calculate="instance(\'scores\')/score[@high &gt; #form/score][@low &lt; #form/score]" calculate="instance(\'scores\')/score[@high &gt; /data/score][@low &lt; /data/score]" />\n\t\t\t<bind vellum:nodeset="#form/result" nodeset="/data/result" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="score-label">\n\t\t\t\t\t\t<value>What was your score</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="result-label">\n\t\t\t\t\t\t<value><output vellum:value="#form/output" value="/data/output" /></value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/score" ref="/data/score">\n\t\t\t<label ref="jr:itext(\'score-label\')" />\n\t\t</input>\n\t\t<trigger vellum:ref="#form/result" ref="/data/result" appearance="minimal">\n\t\t\t<label ref="jr:itext(\'result-label\')" />\n\t\t</trigger>\n\t</h:body>\n</h:html>\n'}}]);