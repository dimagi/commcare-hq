"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[985],{7512:(t,n,e)=>{function s(){this.undoItems=[],this.redoItems=[],this.isUpdating=!1,this.lastPushTime=null}function u(t){this.element=t,this.undoStack=new s}function o(t){const n=window.getSelection();if(0===n.rangeCount)return null;const e=n.getRangeAt(0),s=e.startContainer,u=e.startOffset;if(!t.contains(s))return null;const o=[];let i=s;for(;i!==t;){const t=i.parentNode;if(!t)break;const n=Array.from(t.childNodes).indexOf(i);o.unshift(n),i=t}return{nodePath:o,startOffset:u}}function i(t,n){if(!n)return;let e=t;n.nodePath.forEach((n=>{e=e.childNodes[n]?e.childNodes[n]:t}));const s=document.createRange();try{s.setStart(e,n.startOffset),s.setEnd(e,n.startOffset);const t=window.getSelection();t.removeAllRanges(),t.addRange(s)}catch(t){}}function l(t){const n=new Event("input",{bubbles:!0,cancelable:!0});t.dispatchEvent(n)}e.d(n,{A:()=>h}),s.prototype={push:function(t,n=!0){return!this.isUpdating&&(n&&this.undoItems.length>0&&null!==this.lastPushTime&&Date.now()-this.lastPushTime<500?this.undoItems[this.undoItems.length-1]=t:this.undoItems.push(t),this.lastPushTime=n?Date.now():null,this.redoItems=[],!0)},peek:function(t){let n=null;if(this.undoItems.length>0&&(n=this.undoItems[this.undoItems.length-1]),t&&"function"==typeof t){this.isUpdating=!0;try{t(n)}finally{this.lastPushTime=null,this.isUpdating=!1}}},undo:function(t){let n=null;if(this.undoItems.length>1&&(this.redoItems.push(this.undoItems.pop()),n=this.undoItems[this.undoItems.length-1]),t&&"function"==typeof t){this.isUpdating=!0;try{t(n)}finally{this.lastPushTime=null,this.isUpdating=!1}}},redo:function(t){let n=null;if(this.redoItems.length>0){const t=this.redoItems.pop();this.undoItems.push(t),n=t}if(t&&"function"==typeof t){this.isUpdating=!0;try{t(n)}finally{this.lastPushTime=null,this.isUpdating=!1}}}},u.prototype={push:function(t=!0){const n={value:this.element.innerHTML,cursor:o(this.element)};this.undoStack.push(n,t)},peek:function(){let t=null;return this.undoStack.peek((n=>{t=n})),t},reset:function(){this.undoStack.peek((t=>{null!==t&&(this.element.innerHTML=t.value,i(this.element,t.cursor))}))},undo:function(){this.undoStack.undo((t=>{null!==t&&(this.element.innerHTML=t.value,i(this.element,t.cursor),l(this.element))}))},redo:function(){this.undoStack.redo((t=>{null!==t&&(this.element.innerHTML=t.value,i(this.element,t.cursor),l(this.element))}))}};const h={UndoStack:s,ElementUndoStack:u}},8985:(t,n,e)=>{e.r(n);var s=e(8324),u=e.n(s),o=e(7512);const i=u().assert;describe("The UndoStack",(function(){it("undo should return null if nothing is on the undo stack",(function(){(new o.A.UndoStack).undo((t=>{i.isNull(t)}))})),it("undo should return null if only one item is on the undo stack",(function(){const t=new o.A.UndoStack;t.push("test",!1),t.undo((t=>{i.isNull(t)}))})),it("Trying to undo the first item should not take it off the stack",(function(){const t=new o.A.UndoStack;t.push("test",!1),t.undo((t=>{i.isNull(t)})),t.push("test2",!1),t.undo((t=>{i.equal(t,"test")}))})),it("undo should return the previous item if at least two items are on the undo stack",(function(){const t=new o.A.UndoStack;t.push("test1",!1),t.push("test2",!1),t.undo((t=>{i.equal(t,"test1")}))})),it("redo should return null if nothing has been pushed",(function(){(new o.A.UndoStack).redo((t=>{i.isNull(t)}))})),it("redo should return null if nothing has been undone",(function(){const t=new o.A.UndoStack;t.push("test1",!1),t.push("test2",!1),t.redo((t=>{i.isNull(t)}))})),it("redo after undo should return the last pushed item",(function(){const t=new o.A.UndoStack;t.push("test1",!1),t.push("test2",!1),t.undo((t=>{i.equal(t,"test1")})),t.redo((t=>{i.equal(t,"test2")}))})),it("undo after redo should return same item as first undo",(function(){const t=new o.A.UndoStack;t.push("test1",!1),t.push("test2",!1),t.undo((t=>{i.equal(t,"test1")})),t.redo((t=>{i.equal(t,"test2")})),t.undo((t=>{i.equal(t,"test1")}))})),it("push after undo empties redo stack",(function(){const t=new o.A.UndoStack;t.push("test1",!1),t.push("test2",!1),t.undo((t=>{i.equal(t,"test1")})),t.push("test1",!1),t.redo((t=>{i.isNull(t)}))})),it("cannot push during undo",(function(){const t=new o.A.UndoStack;t.push("test1",!1),t.push("test2",!1),t.undo((n=>{i.equal(n,"test1"),i.isFalse(t.push("test3"))})),t.undo((t=>{i.isNull(t)}))})),it("pushing twice in fast succession only keeps the last one",(function(){const t=new o.A.UndoStack;t.push("test1a",!0),t.push("test1b",!0),t.push("test2",!1),t.undo((t=>{i.equal(t,"test1b")})),t.undo((t=>{i.isNull(t)}))})),it("pushing twice with pause keeps both items",(function(){const t=new o.A.UndoStack;t.push("test1a",!0),setTimeout((()=>{t.push("test1b",!0),t.push("test2",!1),t.undo((t=>{i.equal(t,"test1b")})),t.undo((t=>{i.equal(t,"test1a")}))}),550)}))}))}}]);