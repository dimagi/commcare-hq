"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[150],{150:(e,t,n)=>{var o=n(8324),r=n.n(o),l=n(1134),a=n(561),i=n.n(a);const u='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml"\n\txmlns:orx="http://openrosa.org/jr/xforms"\n\txmlns="http://www.w3.org/2002/xforms"\n\txmlns:xsd="http://www.w3.org/2001/XMLSchema"\n\txmlns:jr="http://openrosa.org/javarosa"\n\txmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" \n\t\t\t\t\txmlns="http://openrosa.org/formdesigner/4BE1309B-ABCF-4184-8175-9E381F3E0DD7"\n\t\t\t\t\tuiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<node_locked />\n\t\t\t\t\t<value_locked />\n\t\t\t\t\t<none_locked />\n\t\t\t\t\t<normal />\n\t\t\t\t\t<group />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/node_locked" nodeset="/data/node_locked" type="xsd:string" vellum:lock="node" />\n\t\t\t<bind vellum:nodeset="#form/value_locked" nodeset="/data/value_locked" type="xsd:string" vellum:lock="value"/>\n\t\t\t<bind vellum:nodeset="#form/none_locked" nodeset="/data/none_locked" type="xsd:string" vellum:lock="none" />\n\t\t\t<bind vellum:nodeset="#form/normal" nodeset="/data/normal" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/group" nodeset="/data/group" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="node_locked-label">\n\t\t\t\t\t\t<value>node_locked</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="value_locked-label">\n\t\t\t\t\t\t<value>value_locked</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="none_locked-label">\n\t\t\t\t\t\t<value>none_locked</value>\n\t\t\t\t\t</text>\n\t\t\t\t\t<text id="normal-label">\n\t\t\t\t\t\t<value>normal</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/node_locked" ref="/data/node_locked">\n\t\t\t<label ref="jr:itext(\'node_locked-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/value_locked" ref="/data/value_locked">\n\t\t\t<label ref="jr:itext(\'value_locked-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/none_locked" ref="/data/none_locked">\n\t\t\t<label ref="jr:itext(\'none_locked-label\')" />\n\t\t</input>\n\t\t<input vellum:ref="#form/normal" ref="/data/normal">\n\t\t\t<label ref="jr:itext(\'normal-label\')" />\n\t\t</input>\n\t\t<group vellum:ref="#form/group" ref="/data/group"></group>\n\t</h:body>\n</h:html>\n';var s=r().assert,d=l.A.clickQuestion,c=l.A.call,f=l.A.getInput;function m(e){l.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){c("loadXFormOrError",u,e)}}})}describe("The Lock plugin",(function(){function e(e,t){return c("isPropertyLocked",e,t)}function t(e){return c("isMugPathMoveable",e)}function n(e){return c("isMugRemoveable",c("getMugByPath",e),e)}function o(e){return c("isMugTypeChangeable",c("getMugByPath",e),e)}before(m),it("preserves XML with vellum:lock attributes",(function(){l.A.assertXmlEqual(u,c("createXML"))})),it("disallows renaming a locked node",(function(){s(e("#form/node_locked","nodeID")),s(e("#form/value_locked","nodeID")),s.isFalse(e("#form/none_locked","nodeID")),s.isFalse(e("#form/normal","nodeID"))})),it("disallows moving a locked node to a different parent",(function(){s.isFalse(t("#form/node_locked")),s.isFalse(t("#form/value_locked")),s(t("#form/none_locked")),s(t("#form/normal"))})),it("disallows deleting a locked node",(function(){s.isFalse(n("#form/node_locked")),s.isFalse(n("#form/value_locked")),s(n("#form/none_locked")),s(n("#form/normal"))})),it("disallows changing the type only of a 'value' locked node",(function(){s.isFalse(o("#form/value_locked")),s(o("#form/node_locked")),s(o("#form/none_locked")),s(o("#form/normal"))})),it("allows changing only the Itext IDs of a 'value' locked node",(function(){s.isFalse(e("#form/value_locked","constraintMsgItext")),s(e("#form/value_locked","constraintAttr"))})),it("allows changing any property of a non-locked node",(function(){s.isFalse(e("#form/node_locked")),s.isFalse(e("#form/none_locked")),s.isFalse(e("#form/normal"))}))})),describe("The question locking functionality in the core and UI",(function(){before(m),describe("The edit locking",(function(){function e(e){d(e?"normal":"value_locked");var t=i()(".btn.current-question");s(1===t.length),t.click();var n=t.closest(".question-type-changer");s.equal(!!n.find("li:not(.dropdown-header)").length,e)}function t(e){d(e?"value_locked":"normal");var t=f("relevantAttr").parents(".form-group").find("button.fd-edit-button");s.equal(1,t.length),s.equal(e,t.prop("disabled"))}it("shows the delete button for deleteable questions",(function(){d("normal"),s(1===i()("button:contains(Delete)").length)})),it("hides the delete button for non-deletable questions",(function(){d("node_locked"),s(0===i()("button:contains(Delete)").length)})),it("shows the type changer for type-changeable questions",(function(){e(!0)})),it("hides the type changer for non-type-changeable questions",(function(){e(!1)})),it("disables the checkbox (only) for a locked boolean property",(function(){d("value_locked"),s(f("requiredAttr").prop("disabled")),d("normal");var e=f("requiredAttr");s.isFalse(e.prop("disabled"))})),it("disables the text input (only) for a locked text property",(function(){d("normal"),s.isFalse(f("nodeID").prop("disabled")),d("value_locked"),s(f("nodeID").prop("disabled"))})),it("enables the edit button for non-locked logic properties",(function(){t(!1)})),it("disables the edit button for locked logic properties",(function(){t(!0)}))}))}))},1134:(e,t,n)=>{n.d(t,{A:()=>E});var o=n(8449),r=n(8324),l=n.n(r),a=n(6848),i=n.n(a),u=n(3794),s=n.n(u),d=n(4523),c=n(561),f=n.n(c),m=n(1437),p=n.n(m),g=n(3809),v=n.n(g),h=n(705),k=n.n(h),b=n(7229),y=n.n(b),x=(n(1460),n(8803),l().assert),_=["Form Builder clip","version 1"];function w(e,t,n){if((n=d.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var o=y().parseXML(t).find("data").attr("xmlns");e=e.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+o+'"')}var r,l,a,u,s=(r=e,l=t,a=i().xml(r),u=i().xml(l),i().isEquivalent(a,u,{element_order:!0}));n.not&&(s=!s),s||A(e=j(e),t=j(t),"XML "+(n.not?"should not be equivalent":"mismatch"))}function A(e,t,n){if(e!==t){var o=s().createPatch("",e,t,"actual","expected");o=o.replace(/^Index:/,n||"Not equal:"),x(!1,function(e){var t={"-":31,"+":32};return e.replace(/^.+?$/gm,(function(e){return"["+(t[e[0]]||0)+"m"+e+"[0m"}))}(o))}}function j(e){return(e=e.replace(/^\t+/gm,(function(e){return e.replace(/\t/g,"  ")}))).match(/\n$/)||(e+="\n"),e}function q(e){return M("getCurrentMugInput",e)}function I(e){var t=f()("#vellum").vellum("get"),n=d.Ay.isString(e)?f()("[name="+e+"]"):e;return k().util.getWidget(n,t)}function M(){var e=Array.prototype.slice.call(arguments),t=f()("#vellum");return t.vellum.apply(t,e)}function F(){var e=[],t=d.Ay.map(arguments,(function(t){var n=d.Ay.isString(t)?D(t):t;if(!n||!n.ufid)throw new Error("mug not found: "+t);return e.push(n),n.ufid}));return M("jstree","deselect_all",!0),M("jstree","select_node",t),f()(".collapse-toggle.collapsed").click(),e}function D(e){0!==e.indexOf("/")&&(e="/data/"+e);var t=M("getMugByPath",e);if(!t){var n=e.split("/"),o=M("getMugByPath",n.slice(0,-1).join("/"));if(o&&o.__className.indexOf("Select")>-1){var r=M("getData").core.form.getChildren(o),l=n[n.length-1];if(1===r.length&&"itemset"===l&&"itemset"===r[0].options.tagName)return r[0];for(var a=0;a<r.length;a++)if(r[a].p.nodeID===l)return r[a]}}return t}x.equal=x.strictEqual,x.notEqual=x.notStrictEqual;const E={options:o.A,asyncatch:function(e){return function(){try{var t=Array.prototype.slice.call(arguments);return e.apply(this,t)}catch(e){throw e&&e.stack?new Error(e.stack):e}}},init:function(e){e=e||{};var t=f().extend(!0,{},o.A.options,e),n=f().fn.animate;f().fn.animate=function(e,t,o,r){n.apply(this,[e,0,o,r])},e.javaRosa&&e.javaRosa.langs&&(t.javaRosa.langs=e.javaRosa.langs),t.plugins=d.Ay.without(t.plugins,"atwho"),e.plugins&&(t.plugins=e.plugins),t&&t.features&&d.Ay.isUndefined(t.features.disable_popovers)&&(t.features.disable_popovers=!0),t.core=t.core||{};var r=t.core.saveUrl||function(){};t.core.saveUrl=function(e){return e.xform,r(e)};var l=f()("#vellum"),a=l.vellum("get");a&&(a.destroy(),f()("body > div.modal, body > div.modal-backdrop").remove()),l.empty().vellum(t)},call:M,loadXML:function(e,t,n,o){var r=[],l=M("getData");return o||window.history.replaceState(null,null," "),l.core.parseWarnings=[],M("loadXML",e,t||{}),n?d.Ay.isRegExp(n)&&(r=d.Ay.filter(l.core.parseWarnings,(function(e){return!n.test(e)}))):r=l.core.parseWarnings,x(!r.length,"unexpected parse warnings:\n- "+r.join("\n- ")),delete l.core.parseWarnings,l.core.form},saveAndReload:function(e){M("loadXFormOrError",M("createXML"),e)},getMug:D,getInput:q,getWidget:I,getMediaUploader:function(e){var t,n={},o=I(e);if(!o)throw new Error("media uploader widget not found");if(d.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(t=e.closest(n)).length})),!t)throw new Error("media uploader element not found");return n.upload=function(e){var n={ref:{path:o.getRandomizedMediaPath(e)},errors:[]};t.trigger("mediaUploadComplete",n)},n},assertEqual:A,assertInputCount:function(e,t,n){d.Ay.isString(e)?(n=" for "+(n?n+" ":"")+e,e=q(e)):n=n?" for "+n:"",x.equal(e.length,t,"wrong number of inputs"+n)},assertXmlEqual:w,assertXmlNotEqual:function(e,t,n){(n=n||{}).not=!0,w(e,t,n)},assertJSTreeState:function(){var e=Array.prototype.slice.call(arguments).join("\n")+"\n";A(function e(t,n){var o,r,l,a=[];for("#"===t.id?n=-1:a.push(Array(2*n+1).join(" ")+t.text),o=0,r=t.children.length;o<r;o++)l=M("jstree","get_node",t.children[o]),a.push(e(l,n+1));return a.join("\n")}(M("jstree","get_node","#"))+"\n",e,"Unexpected jstree state")},assertTreeState:function(e){var t=Array.prototype.slice.call(arguments,1).join("\n")+"\n";A(function e(t,n){var o,r,l,a=[];for(t.isRootNode?n=-1:a.push(Array(2*n+1).join(" ")+t.value.p.nodeID),o=0,r=t.children.length;o<r;o++)l=t.children[o],a.push(e(l,n+1));return a.join("\n")}(e.rootNode,0)+"\n",t,"Unexpected tree state")},addQuestion:function(e,t,n){n=d.Ay.extend({},n),this.prevId&&F(this.prevId);var o=M("addQuestion",e);return t||o.p.nodeID||(t=M("nodeIDFromLabel",o)),t&&(x(d.Ay.isUndefined(n.nodeID),"unexpected attribute for "+e+"["+t+"]"),o.p.labelItext&&o.p.labelItext.set(o.getLabelValue()),o.p.nodeID=t,"Choice"!==e||n.hasOwnProperty("labelItext")||(n.labelItext=t)),d.Ay.each(n,(function(e,t){d.Ay.isBoolean(e)||(e=String(e)),/.+Itext/.test(t)?o.p[t].set(e):o.p[t]=e})),d.Ay.each(M("getSections",o),(function(e){M("collapseSection",e.slug,!1)})),o},paste:function(e,t,n){d.Ay.isString(e)||(e=v().tabDelimit([_].concat(e))),n&&window.console.log(e),x.deepEqual(p().paste(e),t||[])},clickQuestion:F,selectAll:function(){M("jstree","select_all")},deleteQuestion:function(){var e=d.Ay.map(arguments,(function(e){var t=D(e);return x(t,"mug not found: "+e),t}));M("getData").core.form.removeMugsFromForm(e),d.Ay.each(arguments,(function(e){x(!D(e),"mug not removed: "+e)}))},saveButtonEnabled:function(e){var t=M("getData").core.saveButton;if(!d.Ay.isUndefined(e)){var n=e?"save":"saved";t.setStateWhenReady(n),x.equal(t.state,n,"sanity check failed")}return"save"===t.state},expandGroup:function(e){M("jstree","open_node",e.ufid),M("jstree","redraw_node",e.ufid,!0,!1,!1)},collapseGroup:function(e){M("jstree","close_node",e.ufid),M("jstree","redraw_node",e.ufid,!0,!1,!1)},getMessages:function(e){var t=[],n=null;if(d.Ay.isString(e)){var o=e;e=D(o),x(e,"mug not found: "+o)}return e.messages.each((function(e,o){o!==n&&(t.push(o+":"),n=o),t.push("  - "+e.message)})),t.join("\n")},findNode:function(e,t,n){if(d.Ay.isString(t)){var o=t;t=function(e){return e.text===o}}return function n(o){var r,l,a;if(t(o))return o;for(r=0,l=o.children.length;r<l;r++)if(a=n(e.get_node(o.children[r])))return a;return null}(n||e.get_node("#"))},isTreeNodeValid:function(e){if(d.Ay.isString(e)){var t=e;e=D(t),x(e,"mug not found: "+t)}return 0===f()("#vellum").find("#"+e.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return f()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:y().parseXML}}}]);