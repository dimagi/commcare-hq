"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[636],{2255:(e,t,n)=>{var r=n(1134),o=n(8324),i=n.n(o),a=n(561),s=n.n(a);const l='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/939C596B-AD0C-4BB8-8717-F00707F71909" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<mug vellum:comment="This is a comment" />\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/mug" nodeset="/data/mug" type="xsd:string" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default=""/>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/mug" ref="/data/mug"/>\n\t</h:body>\n</h:html>\n';var u=i().assert,d=r.A.call;describe("Question Comments",(function(){before((function(e){r.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){e()}}})})),it("should parse the comment",(function(){r.A.loadXML(l);var e=r.A.getMug("/data/mug");u.strictEqual(e.p.comment,"This is a comment")})),it("should display the comment",(function(){r.A.loadXML(l),u(s()(".fd-props-toolbar > .alert-info"))})),it("should update comment without reloading",(function(){r.A.loadXML(l),u.strictEqual(s()(".fd-question-comment").text(),"This is a comment"),s()("#property-comment").val("still a comment").change(),u.strictEqual(s()(".fd-question-comment").text(),"still a comment")})),it("should write the comment",(function(){r.A.loadXML(""),r.A.addQuestion("Text","mug").p.comment="This is a comment",r.A.assertXmlEqual(l,d("createXML"),{normalize_xmlns:!0})})),it("should not show comment the comment if there isn't one",(function(){r.A.loadXML(""),r.A.addQuestion("Text","mug"),u(!s()(".fd-props-toolbar > .alert-info").is(":visible"))})),it("should display a comment once it is specified",(function(){r.A.loadXML(""),r.A.addQuestion("Text","mug").p.comment="this is a comment",u(s()(".fd-props-toolbar > .alert-info").is(":visible"))}))})),describe("Section Toggler",(function(){before((function(e){r.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){e()}}})})),it("should show and hide sections",(function(){r.A.loadXML(""),r.A.addQuestion("Text");var e=s()(".fd-question-fieldset[data-slug='logic']"),t=e.is(":visible"),n=s()(".fd-section-changer a[data-slug='logic']");u.strictEqual(n.hasClass("selected"),t),n.click(),u.strictEqual(e.is(":visible"),!t),u.strictEqual(n.hasClass("selected"),!t),n.click(),u.strictEqual(e.is(":visible"),t),u.strictEqual(n.hasClass("selected"),t)}))})),describe("Required Condition",(function(){before((function(e){r.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){e()}}})})),it("should mark mug invalid if it has a required condition without being required",(function(){r.A.loadXML("");var e=r.A.addQuestion("Text");u(r.A.isTreeNodeValid(e),"precondition failed:\n"+r.A.getMessages(e));try{e.p.requiredCondition="True()",u(1===e.messages.get("requiredCondition").length,"requiredCondition doesn't have error"),u(1===e.messages.get("requiredAttr").length,"requiredAttr doesn't have error"),e.p.requiredAttr="True()",u(0===e.messages.get("requiredCondition").length,"requiredCondition has error"),u(0===e.messages.get("requiredAttr").length,"requiredAttr has error")}finally{e.p.requiredCondition="",e.p.requiredAttr=""}}))}))},1134:(e,t,n)=>{n.d(t,{A:()=>S});var r=n(8449),o=n(8324),i=n.n(o),a=n(6848),s=n.n(a),l=n(3794),u=n(4523),d=n(561),c=n.n(d),m=n(1437),f=n.n(m),g=n(3809),p=n.n(g),h=n(705),v=n.n(h),A=n(7229),y=n.n(A),x=(n(1460),n(8803),i().assert),q=["Form Builder clip","version 1"];function w(e,t,n){if((n=u.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var r=y().parseXML(t).find("data").attr("xmlns");e=e.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+r+'"')}var o,i,a,l,d=(o=e,i=t,a=s().xml(o),l=s().xml(i),s().isEquivalent(a,l,{element_order:!0}));n.not&&(d=!d),d||b(e=j(e),t=j(t),"XML "+(n.not?"should not be equivalent":"mismatch"))}function b(e,t,n){if(e!==t){var r=(0,l.createPatch)("",e,t,"actual","expected");r=r.replace(/^Index:/,n||"Not equal:"),x(!1,function(e){var t={"-":31,"+":32};return e.replace(/^.+?$/gm,(function(e){return"["+(t[e[0]]||0)+"m"+e+"[0m"}))}(r))}}function j(e){return(e=e.replace(/^\t+/gm,(function(e){return e.replace(/\t/g,"  ")}))).match(/\n$/)||(e+="\n"),e}function M(e){return X("getCurrentMugInput",e)}function E(e){var t=c()("#vellum").vellum("get"),n=u.Ay.isString(e)?c()("[name="+e+"]"):e;return v().util.getWidget(n,t)}function X(){var e=Array.prototype.slice.call(arguments),t=c()("#vellum");return t.vellum.apply(t,e)}function C(){var e=[],t=u.Ay.map(arguments,(function(t){var n=u.Ay.isString(t)?L(t):t;if(!n||!n.ufid)throw new Error("mug not found: "+t);return e.push(n),n.ufid}));return X("jstree","deselect_all",!0),X("jstree","select_node",t),c()(".collapse-toggle.collapsed").click(),e}function L(e){0!==e.indexOf("/")&&(e="/data/"+e);var t=X("getMugByPath",e);if(!t){var n=e.split("/"),r=X("getMugByPath",n.slice(0,-1).join("/"));if(r&&r.__className.indexOf("Select")>-1){var o=X("getData").core.form.getChildren(r),i=n[n.length-1];if(1===o.length&&"itemset"===i&&"itemset"===o[0].options.tagName)return o[0];for(var a=0;a<o.length;a++)if(o[a].p.nodeID===i)return o[a]}}return t}x.equal=x.strictEqual,x.notEqual=x.notStrictEqual;const S={options:r.A,asyncatch:function(e){return function(){try{var t=Array.prototype.slice.call(arguments);return e.apply(this,t)}catch(e){throw e&&e.stack?new Error(e.stack):e}}},init:function(e){e=e||{};var t=c().extend(!0,{},r.A.options,e),n=c().fn.animate;c().fn.animate=function(e,t,r,o){n.apply(this,[e,0,r,o])},e.javaRosa&&e.javaRosa.langs&&(t.javaRosa.langs=e.javaRosa.langs),t.plugins=u.Ay.without(t.plugins,"atwho"),e.plugins&&(t.plugins=e.plugins),t&&t.features&&u.Ay.isUndefined(t.features.disable_popovers)&&(t.features.disable_popovers=!0),t.core=t.core||{};var o=t.core.saveUrl||function(){};t.core.saveUrl=function(e){return e.xform,o(e)};var i=c()("#vellum"),a=i.vellum("get");a&&(a.destroy(),c()("body > div.modal, body > div.modal-backdrop").remove()),i.empty().vellum(t)},call:X,loadXML:function(e,t,n,r,o=!0){var i=[],a=X("getData");return r||window.history.replaceState(null,null," "),a.core.parseWarnings=[],X("loadXML",e,t||{},{reset:o}),n?u.Ay.isRegExp(n)&&(i=u.Ay.filter(a.core.parseWarnings,(function(e){return!n.test(e)}))):i=a.core.parseWarnings,x(!i.length,"unexpected parse warnings:\n- "+i.join("\n- ")),delete a.core.parseWarnings,a.core.form},saveAndReload:function(e){X("loadXFormOrError",X("createXML"),e)},getMug:L,getInput:M,getWidget:E,getMediaUploader:function(e){var t,n={},r=E(e);if(!r)throw new Error("media uploader widget not found");if(u.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(t=e.closest(n)).length})),!t)throw new Error("media uploader element not found");return n.upload=function(e){var n={ref:{path:r.getRandomizedMediaPath(e)},errors:[]};t.trigger("mediaUploadComplete",n)},n},assertEqual:b,assertInputCount:function(e,t,n){u.Ay.isString(e)?(n=" for "+(n?n+" ":"")+e,e=M(e)):n=n?" for "+n:"",x.equal(e.length,t,"wrong number of inputs"+n)},assertXmlEqual:w,assertXmlNotEqual:function(e,t,n){(n=n||{}).not=!0,w(e,t,n)},assertJSTreeState:function(){var e=Array.prototype.slice.call(arguments).join("\n")+"\n";b(function e(t,n){var r,o,i,a=[];for("#"===t.id?n=-1:a.push(Array(2*n+1).join(" ")+t.text),r=0,o=t.children.length;r<o;r++)i=X("jstree","get_node",t.children[r]),a.push(e(i,n+1));return a.join("\n")}(X("jstree","get_node","#"))+"\n",e,"Unexpected jstree state")},assertTreeState:function(e){var t=Array.prototype.slice.call(arguments,1).join("\n")+"\n";b(function e(t,n){var r,o,i,a=[];for(t.isRootNode?n=-1:a.push(Array(2*n+1).join(" ")+t.value.p.nodeID),r=0,o=t.children.length;r<o;r++)i=t.children[r],a.push(e(i,n+1));return a.join("\n")}(e.rootNode,0)+"\n",t,"Unexpected tree state")},addQuestion:function(e,t,n){n=u.Ay.extend({},n),this.prevId&&C(this.prevId);var r=X("addQuestion",e);return t||r.p.nodeID||(t=X("nodeIDFromLabel",r)),t&&(x(u.Ay.isUndefined(n.nodeID),"unexpected attribute for "+e+"["+t+"]"),r.p.labelItext&&r.p.labelItext.set(r.getLabelValue()),r.p.nodeID=t,"Choice"!==e||n.hasOwnProperty("labelItext")||(n.labelItext=t)),u.Ay.each(n,(function(e,t){u.Ay.isBoolean(e)||(e=String(e)),/.+Itext/.test(t)?r.p[t].set(e):r.p[t]=e})),u.Ay.each(X("getSections",r),(function(e){X("collapseSection",e.slug,!1)})),r},paste:function(e,t,n){u.Ay.isString(e)||(e=p().tabDelimit([q].concat(e))),n&&window.console.log(e),x.deepEqual(f().paste(e),t||[])},clickQuestion:C,selectAll:function(){X("jstree","select_all")},deleteQuestion:function(){var e=u.Ay.map(arguments,(function(e){var t=L(e);return x(t,"mug not found: "+e),t}));X("getData").core.form.removeMugsFromForm(e),u.Ay.each(arguments,(function(e){x(!L(e),"mug not removed: "+e)}))},saveButtonEnabled:function(e){var t=X("getData").core.saveButton;if(!u.Ay.isUndefined(e)){var n=e?"save":"saved";t.setStateWhenReady(n),x.equal(t.state,n,"sanity check failed")}return"save"===t.state},expandGroup:function(e){X("jstree","open_node",e.ufid),X("jstree","redraw_node",e.ufid,!0,!1,!1)},collapseGroup:function(e){X("jstree","close_node",e.ufid),X("jstree","redraw_node",e.ufid,!0,!1,!1)},getMessages:function(e){var t=[],n=null;if(u.Ay.isString(e)){var r=e;e=L(r),x(e,"mug not found: "+r)}return e.messages.each((function(e,r){r!==n&&(t.push(r+":"),n=r),t.push("  - "+e.message)})),t.join("\n")},findNode:function(e,t,n){if(u.Ay.isString(t)){var r=t;t=function(e){return e.text===r}}return function n(r){var o,i,a;if(t(r))return r;for(o=0,i=r.children.length;o<i;o++)if(a=n(e.get_node(r.children[o])))return a;return null}(n||e.get_node("#"))},isTreeNodeValid:function(e){if(u.Ay.isString(e)){var t=e;e=L(t),x(e,"mug not found: "+t)}return 0===c()("#vellum").find("#"+e.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return c()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:y().parseXML}}}]);