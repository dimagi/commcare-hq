"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[459],{8459:(t,e,n)=>{var a=n(1134),r=n(8324);const o='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<name />\n\t\t\t\t\t<module_1 vellum:role="ConnectLearnModule">\n\t\t\t\t\t\t<module xmlns="http://commcareconnect.com/data/v1/learn" id="module_1">\n\t\t\t\t\t\t\t<name>module 1</name>\n\t\t\t\t\t\t\t<description>Module 1 is fun&#10;Learning is fun</description>\n\t\t\t\t\t\t\t<time_estimate>2</time_estimate>\n\t\t\t\t\t\t</module>\n\t\t\t\t\t</module_1>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<bind vellum:nodeset="#form/name" nodeset="/data/name" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/module_1" nodeset="/data/module_1" relevant="x = 2" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="name-label">\n\t\t\t\t\t\t<value>name</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/name" ref="/data/name">\n\t\t\t<label ref="jr:itext(\'name-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n',s='<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n  <h:head>\n    <h:title>Untitled Form</h:title>\n    <model>\n      <instance>\n        <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n          <score />\n          <test_assessment vellum:role="ConnectAssessment">\n            <assessment xmlns="http://commcareconnect.com/data/v1/learn" id="test_assessment">\n              <user_score />\n            </assessment>\n          </test_assessment>\n        </data>\n      </instance>\n      <bind vellum:nodeset="#form/score" nodeset="/data/score" type="xsd:int" required="true()" />\n      <bind vellum:nodeset="#form/test_assessment" nodeset="/data/test_assessment" relevant="x = 1" />\n      <bind nodeset="/data/test_assessment/assessment/user_score" vellum:calculate="#form/score"  calculate="/data/score" />\n      <itext>\n        <translation lang="en" default="">\n          <text id="score-label">\n            <value>score</value>\n          </text>\n        </translation>\n      </itext>\n    </model>\n  </h:head>\n  <h:body>\n    <input vellum:ref="#form/score" ref="/data/score">\n      <label ref="jr:itext(\'score-label\')" />\n    </input>\n  </h:body>\n</h:html>\n',l='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n\t<h:head>\n\t\t<h:title>Untitled Form</h:title>\n\t\t<model>\n\t\t\t<instance>\n\t\t\t\t<data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/E1B03643-109D-4DC6-9737-815E4401DE79" uiVersion="1" version="1" name="Untitled Form">\n\t\t\t\t\t<name />\n\t\t\t\t\t<unit_one vellum:role="ConnectDeliverUnit">\n\t\t\t\t\t\t<deliver xmlns="http://commcareconnect.com/data/v1/learn" id="unit_one">\n                            <name>unit 1</name>\n                            <entity_id/>\n                            <entity_name/>\n\t\t\t\t\t\t</deliver>\n\t\t\t\t\t</unit_one>\n\t\t\t\t</data>\n\t\t\t</instance>\n\t\t\t<instance src="jr://instance/session" id="commcaresession" />\n\t\t\t<bind vellum:nodeset="#form/name" nodeset="/data/name" type="xsd:string" />\n\t\t\t<bind vellum:nodeset="#form/unit_one" nodeset="/data/unit_one" relevant="x = 1" />\n\t\t\t<bind nodeset="/data/unit_one/deliver/entity_id" calculate="instance(\'commcaresession\')/session/data/value" />\n\t\t\t<bind nodeset="/data/unit_one/deliver/entity_name" vellum:calculate="#form/name" calculate="/data/name" />\n\t\t\t<itext>\n\t\t\t\t<translation lang="en" default="">\n\t\t\t\t\t<text id="name-label">\n\t\t\t\t\t\t<value>name</value>\n\t\t\t\t\t</text>\n\t\t\t\t</translation>\n\t\t\t</itext>\n\t\t</model>\n\t</h:head>\n\t<h:body>\n\t\t<input vellum:ref="#form/name" ref="/data/name">\n\t\t\t<label ref="jr:itext(\'name-label\')" />\n\t\t</input>\n\t</h:body>\n</h:html>\n';var i=n.n(r)().assert,u=a.A.call;describe("The CommCareConnect",(function(){before((function(t){a.A.init({javaRosa:{langs:["en"]},core:{onReady:function(){t()}}})})),describe("learn module",(function(){it("should load and save",(function(){a.A.loadXML(o);var t=a.A.getMug("module_1");i.equal(t.__className,"ConnectLearnModule"),i.equal(t.p.name,"module 1"),i.equal(t.p.description,"Module 1 is fun\nLearning is fun"),i.equal(t.p.time_estimate,"2"),i.equal(t.p.relevantAttr,"x = 2"),a.A.assertXmlEqual(u("createXML"),o)})),it("requires time_estimate to be an integer",(function(){var t=a.A.addQuestion("ConnectLearnModule","mug");t.p.time_estimate="foo",i.equal(t.spec.time_estimate.validationFunc(t),"Must be an integer")}))})),describe("assessment module",(function(){it("should load and save",(function(){a.A.loadXML(s);var t=a.A.getMug("test_assessment");i.equal(t.__className,"ConnectAssessment"),i.equal(t.p.user_score,"/data/score"),i.equal(t.p.relevantAttr,"x = 1"),a.A.assertXmlEqual(u("createXML"),s)}))})),describe("deliver unit",(function(){it("should load and save",(function(){a.A.loadXML(l);var t=a.A.getMug("unit_one");i.equal(t.__className,"ConnectDeliverUnit"),i.equal(t.p.name,"unit 1"),i.equal(t.p.entity_id,"instance('commcaresession')/session/data/value"),i.equal(t.p.entity_name,"/data/name"),i.equal(t.p.relevantAttr,"x = 1"),a.A.assertXmlEqual(u("createXML"),l)}))}))}))},1134:(t,e,n)=>{n.d(e,{A:()=>X});var a=n(8449),r=n(8324),o=n.n(r),s=n(6848),l=n.n(s),i=n(3794),u=n(4523),d=n(561),m=n.n(d),c=n(1437),f=n.n(c),p=n(3809),h=n.n(p),v=n(705),g=n.n(v),x=n(7229),y=n.n(x),w=(n(1460),n(8803),o().assert),_=["Form Builder clip","version 1"];function b(t,e,n){if((n=u.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var a=y().parseXML(e).find("data").attr("xmlns");t=t.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+a+'"')}var r,o,s,i,d=(r=t,o=e,s=l().xml(r),i=l().xml(o),l().isEquivalent(s,i,{element_order:!0}));n.not&&(d=!d),d||A(t=j(t),e=j(e),"XML "+(n.not?"should not be equivalent":"mismatch"))}function A(t,e,n){if(t!==e){var a=(0,i.createPatch)("",t,e,"actual","expected");a=a.replace(/^Index:/,n||"Not equal:"),w(!1,function(t){var e={"-":31,"+":32};return t.replace(/^.+?$/gm,(function(t){return"["+(e[t[0]]||0)+"m"+t+"[0m"}))}(a))}}function j(t){return(t=t.replace(/^\t+/gm,(function(t){return t.replace(/\t/g,"  ")}))).match(/\n$/)||(t+="\n"),t}function q(t){return E("getCurrentMugInput",t)}function M(t){var e=m()("#vellum").vellum("get"),n=u.Ay.isString(t)?m()("[name="+t+"]"):t;return g().util.getWidget(n,e)}function E(){var t=Array.prototype.slice.call(arguments),e=m()("#vellum");return e.vellum.apply(e,t)}function L(){var t=[],e=u.Ay.map(arguments,(function(e){var n=u.Ay.isString(e)?D(e):e;if(!n||!n.ufid)throw new Error("mug not found: "+e);return t.push(n),n.ufid}));return E("jstree","deselect_all",!0),E("jstree","select_node",e),m()(".collapse-toggle.collapsed").click(),t}function D(t){0!==t.indexOf("/")&&(t="/data/"+t);var e=E("getMugByPath",t);if(!e){var n=t.split("/"),a=E("getMugByPath",n.slice(0,-1).join("/"));if(a&&a.__className.indexOf("Select")>-1){var r=E("getData").core.form.getChildren(a),o=n[n.length-1];if(1===r.length&&"itemset"===o&&"itemset"===r[0].options.tagName)return r[0];for(var s=0;s<r.length;s++)if(r[s].p.nodeID===o)return r[s]}}return e}w.equal=w.strictEqual,w.notEqual=w.notStrictEqual;const X={options:a.A,asyncatch:function(t){return function(){try{var e=Array.prototype.slice.call(arguments);return t.apply(this,e)}catch(t){throw t&&t.stack?new Error(t.stack):t}}},init:function(t){t=t||{};var e=m().extend(!0,{},a.A.options,t),n=m().fn.animate;m().fn.animate=function(t,e,a,r){n.apply(this,[t,0,a,r])},t.javaRosa&&t.javaRosa.langs&&(e.javaRosa.langs=t.javaRosa.langs),e.plugins=u.Ay.without(e.plugins,"atwho"),t.plugins&&(e.plugins=t.plugins),e&&e.features&&u.Ay.isUndefined(e.features.disable_popovers)&&(e.features.disable_popovers=!0),e.core=e.core||{};var r=e.core.saveUrl||function(){};e.core.saveUrl=function(t){return t.xform,r(t)};var o=m()("#vellum"),s=o.vellum("get");s&&(s.destroy(),m()("body > div.modal, body > div.modal-backdrop").remove()),o.empty().vellum(e)},call:E,loadXML:function(t,e,n,a,r=!0){var o=[],s=E("getData");return a||window.history.replaceState(null,null," "),s.core.parseWarnings=[],E("loadXML",t,e||{},{reset:r}),n?u.Ay.isRegExp(n)&&(o=u.Ay.filter(s.core.parseWarnings,(function(t){return!n.test(t)}))):o=s.core.parseWarnings,w(!o.length,"unexpected parse warnings:\n- "+o.join("\n- ")),delete s.core.parseWarnings,s.core.form},saveAndReload:function(t){E("loadXFormOrError",E("createXML"),t)},getMug:D,getInput:q,getWidget:M,getMediaUploader:function(t){var e,n={},a=M(t);if(!a)throw new Error("media uploader widget not found");if(u.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(e=t.closest(n)).length})),!e)throw new Error("media uploader element not found");return n.upload=function(t){var n={ref:{path:a.getRandomizedMediaPath(t)},errors:[]};e.trigger("mediaUploadComplete",n)},n},assertEqual:A,assertInputCount:function(t,e,n){u.Ay.isString(t)?(n=" for "+(n?n+" ":"")+t,t=q(t)):n=n?" for "+n:"",w.equal(t.length,e,"wrong number of inputs"+n)},assertXmlEqual:b,assertXmlNotEqual:function(t,e,n){(n=n||{}).not=!0,b(t,e,n)},assertJSTreeState:function(){var t=Array.prototype.slice.call(arguments).join("\n")+"\n";A(function t(e,n){var a,r,o,s=[];for("#"===e.id?n=-1:s.push(Array(2*n+1).join(" ")+e.text),a=0,r=e.children.length;a<r;a++)o=E("jstree","get_node",e.children[a]),s.push(t(o,n+1));return s.join("\n")}(E("jstree","get_node","#"))+"\n",t,"Unexpected jstree state")},assertTreeState:function(t){var e=Array.prototype.slice.call(arguments,1).join("\n")+"\n";A(function t(e,n){var a,r,o,s=[];for(e.isRootNode?n=-1:s.push(Array(2*n+1).join(" ")+e.value.p.nodeID),a=0,r=e.children.length;a<r;a++)o=e.children[a],s.push(t(o,n+1));return s.join("\n")}(t.rootNode,0)+"\n",e,"Unexpected tree state")},addQuestion:function(t,e,n){n=u.Ay.extend({},n),this.prevId&&L(this.prevId);var a=E("addQuestion",t);return e||a.p.nodeID||(e=E("nodeIDFromLabel",a)),e&&(w(u.Ay.isUndefined(n.nodeID),"unexpected attribute for "+t+"["+e+"]"),a.p.labelItext&&a.p.labelItext.set(a.getLabelValue()),a.p.nodeID=e,"Choice"!==t||n.hasOwnProperty("labelItext")||(n.labelItext=e)),u.Ay.each(n,(function(t,e){u.Ay.isBoolean(t)||(t=String(t)),/.+Itext/.test(e)?a.p[e].set(t):a.p[e]=t})),u.Ay.each(E("getSections",a),(function(t){E("collapseSection",t.slug,!1)})),a},paste:function(t,e,n){u.Ay.isString(t)||(t=h().tabDelimit([_].concat(t))),n&&window.console.log(t),w.deepEqual(f().paste(t),e||[])},clickQuestion:L,selectAll:function(){E("jstree","select_all")},deleteQuestion:function(){var t=u.Ay.map(arguments,(function(t){var e=D(t);return w(e,"mug not found: "+t),e}));E("getData").core.form.removeMugsFromForm(t),u.Ay.each(arguments,(function(t){w(!D(t),"mug not removed: "+t)}))},saveButtonEnabled:function(t){var e=E("getData").core.saveButton;if(!u.Ay.isUndefined(t)){var n=t?"save":"saved";e.setStateWhenReady(n),w.equal(e.state,n,"sanity check failed")}return"save"===e.state},expandGroup:function(t){E("jstree","open_node",t.ufid),E("jstree","redraw_node",t.ufid,!0,!1,!1)},collapseGroup:function(t){E("jstree","close_node",t.ufid),E("jstree","redraw_node",t.ufid,!0,!1,!1)},getMessages:function(t){var e=[],n=null;if(u.Ay.isString(t)){var a=t;t=D(a),w(t,"mug not found: "+a)}return t.messages.each((function(t,a){a!==n&&(e.push(a+":"),n=a),e.push("  - "+t.message)})),e.join("\n")},findNode:function(t,e,n){if(u.Ay.isString(e)){var a=e;e=function(t){return t.text===a}}return function n(a){var r,o,s;if(e(a))return a;for(r=0,o=a.children.length;r<o;r++)if(s=n(t.get_node(a.children[r])))return s;return null}(n||t.get_node("#"))},isTreeNodeValid:function(t){if(u.Ay.isString(t)){var e=t;t=D(e),w(t,"mug not found: "+e)}return 0===m()("#vellum").find("#"+t.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return m()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:y().parseXML}}}]);