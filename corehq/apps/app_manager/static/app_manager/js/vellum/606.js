"use strict";(self.webpackChunkvellum=self.webpackChunkvellum||[]).push([[606],{3606:(e,t,n)=>{n.r(t);var o=n(8324),r=n.n(o),a=n(1134),i=n(6468),l=r().assert,u=a.A.call;describe("URL Hash",(function(){it("should select a mug that is in the form",(function(){window.location.hash="#form/group/question2",a.A.loadXML(i,null,null,!0);var e=u("getCurrentlySelectedMug");l.equal(e.absolutePath,"/data/group/question2")})),it("should select first mug if hash isn't in form",(function(){window.location.hash="#form/group/not_in_form",a.A.loadXML(i,null,null,!0);var e=u("getCurrentlySelectedMug");l.equal(e.absolutePath,"/data/group")})),it("should change the hash when you add a question",(function(){a.A.loadXML(""),a.A.addQuestion("Text","initial"),a.A.clickQuestion("initial"),l.equal(window.location.hash,"#form/initial")})),it("should change the hash when you delete a question",(function(){a.A.loadXML(""),a.A.addQuestion("Text","first"),a.A.clickQuestion("first"),a.A.addQuestion("Text","second"),a.A.clickQuestion("second"),l.equal(window.location.hash,"#form/second"),a.A.deleteQuestion("/data/second"),l.equal(window.location.hash,"#form/first")})),it("should call setURLHash only once when multiple questions are loaded",(function(e){var t=0;a.A.loadXML("");var n=a.A.addQuestion("Text","first");a.A.clickQuestion("first"),a.A.addQuestion("Text","second"),a.A.clickQuestion("second");var o=n.form.vellum._setURLHash;n.form.vellum._setURLHash=function(){t++},a.A.saveAndReload((function(){n.form.vellum._setURLHash=o,l.equal(t,1),e()}))}))}))},1134:(e,t,n)=>{n.d(t,{A:()=>U});var o=n(8449),r=n(8324),a=n.n(r),i=n(6848),l=n.n(i),u=n(3794),s=n.n(u),d=n(4523),c=n(561),f=n.n(c),p=n(1437),g=n.n(p),m=n(3809),h=n.n(m),v=n(705),x=n.n(v),y=n(7229),q=n.n(y),A=(n(1460),n(8803),a().assert),w=["Form Builder clip","version 1"];function b(e,t,n){if((n=d.Ay.defaults(n||{},{normalize_xmlns:!1,not:!1})).normalize_xmlns){var o=q().parseXML(t).find("data").attr("xmlns");e=e.replace(/(data[^>]+xmlns=")(.+?)"/,"$1"+o+'"')}var r,a,i,u,s=(r=e,a=t,i=l().xml(r),u=l().xml(a),l().isEquivalent(i,u,{element_order:!0}));n.not&&(s=!s),s||j(e=M(e),t=M(t),"XML "+(n.not?"should not be equivalent":"mismatch"))}function j(e,t,n){if(e!==t){var o=s().createPatch("",e,t,"actual","expected");o=o.replace(/^Index:/,n||"Not equal:"),A(!1,function(e){var t={"-":31,"+":32};return e.replace(/^.+?$/gm,(function(e){return"["+(t[e[0]]||0)+"m"+e+"[0m"}))}(o))}}function M(e){return(e=e.replace(/^\t+/gm,(function(e){return e.replace(/\t/g,"  ")}))).match(/\n$/)||(e+="\n"),e}function _(e){return S("getCurrentMugInput",e)}function L(e){var t=f()("#vellum").vellum("get"),n=d.Ay.isString(e)?f()("[name="+e+"]"):e;return x().util.getWidget(n,t)}function S(){var e=Array.prototype.slice.call(arguments),t=f()("#vellum");return t.vellum.apply(t,e)}function k(){var e=[],t=d.Ay.map(arguments,(function(t){var n=d.Ay.isString(t)?I(t):t;if(!n||!n.ufid)throw new Error("mug not found: "+t);return e.push(n),n.ufid}));return S("jstree","deselect_all",!0),S("jstree","select_node",t),f()(".collapse-toggle.collapsed").click(),e}function I(e){0!==e.indexOf("/")&&(e="/data/"+e);var t=S("getMugByPath",e);if(!t){var n=e.split("/"),o=S("getMugByPath",n.slice(0,-1).join("/"));if(o&&o.__className.indexOf("Select")>-1){var r=S("getData").core.form.getChildren(o),a=n[n.length-1];if(1===r.length&&"itemset"===a&&"itemset"===r[0].options.tagName)return r[0];for(var i=0;i<r.length;i++)if(r[i].p.nodeID===a)return r[i]}}return t}A.equal=A.strictEqual,A.notEqual=A.notStrictEqual;const U={options:o.A,asyncatch:function(e){return function(){try{var t=Array.prototype.slice.call(arguments);return e.apply(this,t)}catch(e){throw e&&e.stack?new Error(e.stack):e}}},init:function(e){e=e||{};var t=f().extend(!0,{},o.A.options,e),n=f().fn.animate;f().fn.animate=function(e,t,o,r){n.apply(this,[e,0,o,r])},e.javaRosa&&e.javaRosa.langs&&(t.javaRosa.langs=e.javaRosa.langs),t.plugins=d.Ay.without(t.plugins,"atwho"),e.plugins&&(t.plugins=e.plugins),t&&t.features&&d.Ay.isUndefined(t.features.disable_popovers)&&(t.features.disable_popovers=!0),t.core=t.core||{};var r=t.core.saveUrl||function(){};t.core.saveUrl=function(e){return e.xform,r(e)};var a=f()("#vellum"),i=a.vellum("get");i&&(i.destroy(),f()("body > div.modal, body > div.modal-backdrop").remove()),a.empty().vellum(t)},call:S,loadXML:function(e,t,n,o,r=!0){var a=[],i=S("getData");return o||window.history.replaceState(null,null," "),i.core.parseWarnings=[],S("loadXML",e,t||{},{reset:r}),n?d.Ay.isRegExp(n)&&(a=d.Ay.filter(i.core.parseWarnings,(function(e){return!n.test(e)}))):a=i.core.parseWarnings,A(!a.length,"unexpected parse warnings:\n- "+a.join("\n- ")),delete i.core.parseWarnings,i.core.form},saveAndReload:function(e){S("loadXFormOrError",S("createXML"),e)},getMug:I,getInput:_,getWidget:L,getMediaUploader:function(e){var t,n={},o=L(e);if(!o)throw new Error("media uploader widget not found");if(d.Ay.find([".widget[data-hqmediapath]",".itext-block-container"],(function(n){return(t=e.closest(n)).length})),!t)throw new Error("media uploader element not found");return n.upload=function(e){var n={ref:{path:o.getRandomizedMediaPath(e)},errors:[]};t.trigger("mediaUploadComplete",n)},n},assertEqual:j,assertInputCount:function(e,t,n){d.Ay.isString(e)?(n=" for "+(n?n+" ":"")+e,e=_(e)):n=n?" for "+n:"",A.equal(e.length,t,"wrong number of inputs"+n)},assertXmlEqual:b,assertXmlNotEqual:function(e,t,n){(n=n||{}).not=!0,b(e,t,n)},assertJSTreeState:function(){var e=Array.prototype.slice.call(arguments).join("\n")+"\n";j(function e(t,n){var o,r,a,i=[];for("#"===t.id?n=-1:i.push(Array(2*n+1).join(" ")+t.text),o=0,r=t.children.length;o<r;o++)a=S("jstree","get_node",t.children[o]),i.push(e(a,n+1));return i.join("\n")}(S("jstree","get_node","#"))+"\n",e,"Unexpected jstree state")},assertTreeState:function(e){var t=Array.prototype.slice.call(arguments,1).join("\n")+"\n";j(function e(t,n){var o,r,a,i=[];for(t.isRootNode?n=-1:i.push(Array(2*n+1).join(" ")+t.value.p.nodeID),o=0,r=t.children.length;o<r;o++)a=t.children[o],i.push(e(a,n+1));return i.join("\n")}(e.rootNode,0)+"\n",t,"Unexpected tree state")},addQuestion:function(e,t,n){n=d.Ay.extend({},n),this.prevId&&k(this.prevId);var o=S("addQuestion",e);return t||o.p.nodeID||(t=S("nodeIDFromLabel",o)),t&&(A(d.Ay.isUndefined(n.nodeID),"unexpected attribute for "+e+"["+t+"]"),o.p.labelItext&&o.p.labelItext.set(o.getLabelValue()),o.p.nodeID=t,"Choice"!==e||n.hasOwnProperty("labelItext")||(n.labelItext=t)),d.Ay.each(n,(function(e,t){d.Ay.isBoolean(e)||(e=String(e)),/.+Itext/.test(t)?o.p[t].set(e):o.p[t]=e})),d.Ay.each(S("getSections",o),(function(e){S("collapseSection",e.slug,!1)})),o},paste:function(e,t,n){d.Ay.isString(e)||(e=h().tabDelimit([w].concat(e))),n&&window.console.log(e),A.deepEqual(g().paste(e),t||[])},clickQuestion:k,selectAll:function(){S("jstree","select_all")},deleteQuestion:function(){var e=d.Ay.map(arguments,(function(e){var t=I(e);return A(t,"mug not found: "+e),t}));S("getData").core.form.removeMugsFromForm(e),d.Ay.each(arguments,(function(e){A(!I(e),"mug not removed: "+e)}))},saveButtonEnabled:function(e){var t=S("getData").core.saveButton;if(!d.Ay.isUndefined(e)){var n=e?"save":"saved";t.setStateWhenReady(n),A.equal(t.state,n,"sanity check failed")}return"save"===t.state},expandGroup:function(e){S("jstree","open_node",e.ufid),S("jstree","redraw_node",e.ufid,!0,!1,!1)},collapseGroup:function(e){S("jstree","close_node",e.ufid),S("jstree","redraw_node",e.ufid,!0,!1,!1)},getMessages:function(e){var t=[],n=null;if(d.Ay.isString(e)){var o=e;e=I(o),A(e,"mug not found: "+o)}return e.messages.each((function(e,o){o!==n&&(t.push(o+":"),n=o),t.push("  - "+e.message)})),t.join("\n")},findNode:function(e,t,n){if(d.Ay.isString(t)){var o=t;t=function(e){return e.text===o}}return function n(o){var r,a,i;if(t(o))return o;for(r=0,a=o.children.length;r<a;r++)if(i=n(e.get_node(o.children[r])))return i;return null}(n||e.get_node("#"))},isTreeNodeValid:function(e){if(d.Ay.isString(e)){var t=e;e=I(t),A(e,"mug not found: "+t)}return 0===f()("#vellum").find("#"+e.ufid+" > a").children(".fd-valid-alert-icon").length},markdownVisible:function(){return f()(".itext-block-label-group-default").find(".markdown-output").is(":visible")},parseXML:q().parseXML}},6468:e=>{e.exports='<?xml version="1.0" encoding="UTF-8" ?>\n<h:html xmlns:h="http://www.w3.org/1999/xhtml" xmlns:orx="http://openrosa.org/jr/xforms" xmlns="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:jr="http://openrosa.org/javarosa" xmlns:vellum="http://commcarehq.org/xforms/vellum">\n    <h:head>\n        <h:title>Untitled Form</h:title>\n        <model>\n            <instance>\n                <data xmlns:jrm="http://dev.commcarehq.org/jr/xforms" xmlns="http://openrosa.org/formdesigner/35276137-89A8-4DB1-8605-17E5B92D058C" uiVersion="1" version="1" name="Untitled Form">\n                    <group>\n                        <question1 />\n                        <question2 />\n                    </group>\n                    <question2 />\n                </data>\n            </instance>\n            <bind vellum:nodeset="#form/group" nodeset="/data/group" />\n            <bind vellum:nodeset="#form/group/question1" nodeset="/data/group/question1" type="xsd:string" />\n            <bind vellum:nodeset="#form/group/question2" nodeset="/data/group/question2" type="xsd:string" />\n            <bind vellum:nodeset="#form/question2" nodeset="/data/question2" type="xsd:string" vellum:relevant="#form/group/question1 = \'valley girl\' and #form/group/question2 = \'dude\'" relevant="/data/group/question1 = \'valley girl\' and /data/group/question2 = \'dude\'" />\n            <itext>\n                <translation lang="en" default="">\n                    <text id="group-label">\n                        <value>group</value>\n                    </text>\n                    <text id="group/question1-label">\n                        <value>question1</value>\n                    </text>\n                    <text id="group/question2-label">\n                        <value>question2</value>\n                    </text>\n                    <text id="question2-label">\n                        <value>question2</value>\n                    </text>\n                </translation>\n            </itext>\n        </model>\n    </h:head>\n    <h:body>\n        <group vellum:ref="#form/group" ref="/data/group">\n            <label ref="jr:itext(\'group-label\')" />\n            <input vellum:ref="#form/group/question1" ref="/data/group/question1">\n                <label ref="jr:itext(\'group/question1-label\')" />\n            </input>\n            <input vellum:ref="#form/group/question2" ref="/data/group/question2">\n                <label ref="jr:itext(\'group/question2-label\')" />\n            </input>\n        </group>\n        <input vellum:ref="#form/question2" ref="/data/question2">\n            <label ref="jr:itext(\'question2-label\')" />\n        </input>\n    </h:body>\n</h:html>\n'}}]);