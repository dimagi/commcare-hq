{% extends "hqwebapp/two_column.html" %}
{% load hq_shared_tags %}
{% block js %} {{ block.super }}
    <script type="text/javascript" src="{% static 'hqwebapp/js-custom/hq.legacy.js' %}"></script>
{% endblock %}
{% block js-inline %} {{ block.super }}
    <script type="text/javascript">
        $(function () {
            var path = '{{ request.path }}';
            COMMCAREHQ.initBlock($('.hq-content'));
            $('#users-main-nav li a').each(function(e) {
                if ($(this).attr('href') == path) {
                    $(this).parent().addClass('active');
                }
            });
            var activeTabCookie = 'active_tab',
                last_active_tab = $.cookie(activeTabCookie);
            if(last_active_tab) {
                $(last_active_tab).addClass('active');
                $('#project-settings-tabs a[href="'+last_active_tab+'"]').parent().addClass('active');
            } else {
                var first_tab = $('#project-settings-tabs a[data-toggle="tab"]').first();
                first_tab.parent().addClass('active');
                $(first_tab.attr('href')).addClass('active');
            }
            $('#project-settings-tabs a[data-toggle="tab"]').on('shown', function (e) {
                $.cookie(activeTabCookie, $(this).attr('href'),
                        {path: '{{ request.path }}',
                        expires: 1});
            });
        });
    </script>
{% endblock %}

{% block page-title %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url users_default domain %}"><strong>Settings &amp; Users</strong></a> <span class="divider">&gt;</span>
        </li>
        {% block subsection-title %}
        {% endblock %}
    </ul>
{% endblock %}

{% block sidebar %}
<nav>
    <ul class="nav nav-list" id="users-main-nav">
    {% if request.couch_user.can_edit_commcare_users %}
            <li class="nav-header">Mobile Users</li>
            <li><a href="{% url commcare_users domain %}">{% commcare_user %}s</a>
                {% block commcare_users_indicator %}{% endblock %}
            </li>
            <li><a href="{% url all_groups domain %}">Groups</a>
                {% block groups_indicator %}{% endblock %}
            </li>
    {% endif %}
    {% if request.couch_user.can_edit_web_users %}
        <li class="nav-header">CommCare HQ Users</li>
        <li><a href="{% url web_users domain %}">{% hq_web_user %}s</a>
            {% block web_users_indicator %}{% endblock %}
        </li>
    {% endif %}

        <li class="nav-header">My Account</li>
        <li><a href="{% url user_account domain request.couch_user.user_id %}">My Account Settings</a>
            {% block account_indicator %}{% endblock %}
        </li>
        <li><a href="{% url change_my_password domain %}">Change My Password</a></li>

    {% if request.couch_user.is_domain_admin %}
        <li class="nav-header">CloudCare Settings</li>
        <li><a href="{% url cloudcare_app_settings domain %}">App Access</a></li>
    {% endif %}

    {% if request.couch_user.can_edit_web_users  %}
        <li class="nav-header">Project Administration</li>
        {% if request.couch_user.is_domain_admin %}
        <li><a href="{% url domain_project_settings domain %}">Project Settings</a></li>
        <li><a href="{% url domain_snapshot_settings domain %}">CommCare Exchange</a></li>
        <li><a href="{% url domain_manage_multimedia domain %}">Multimedia Sharing</a></li>
        {% endif %}
        <li><a href="{% url domain_forwarding domain %}">Data Forwarding</a>
            {% block forwarding_indicator %}{% endblock %}
        </li>
    {% endif %}

    {% if commtrack_enabled %}
        {% if request.couch_user.is_domain_admin %} <!-- TODO refine user roles? -->
        <li class="nav-header">CommTrack</li>
        <li><a href="{% url domain_commtrack_settings domain %}">Project Settings (todo)</a></li>
        <li><a href="{% url commtrack_product_list domain %}">Manage Products</a></li>
        <li><a href="{% url manage_locations domain %}">Manage Locations</a></li>
        {% endif %}
    {% endif %}

    </ul>
</nav>
{% endblock %}

{% block main_column %}
    {% block user-view %}
        <p class="message">Click on the menu to the left to edit your settings.</p>
    {% endblock %}
    {% if error %}
        <div id="error_msg">
            {{ error }}
        </div>
    {% endif %}
{% endblock %}
