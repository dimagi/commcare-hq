{% extends "two_factor/_base_focus.html" %}
{% load i18n two_factor %}

{% block focus-content %}
    <div class="row">
        <div class="span8">
            <div class="page-header">
                <h1>{% trans "Welcome back to " %}{% if hr_name %}{{ hr_name }}{% elif domain %}{{ domain }}{% else %}{{ SITE_NAME }}{% endif %}!<br />
                    <small>
                    {% if next %}
                        {% trans "Looks like your CommCare session has expired. Please log-in again to continue working." %}
                    {% else %}
                        {% trans "Please sign in below to continue." %}
                    {% endif %}
                    </small>
                </h1>

                {% if next %}
                <p>
                    {% trans "You will be transferred to your original destination after you sign in." %}
                </p>
                {% endif %}
            </div>

            {% if wizard.steps.current == 'token' %}
            {% if device.method == 'call' %}
            <p>{% blocktrans %}We are calling your phone right now, please enter the
            digits you hear.{% endblocktrans %}</p>
            {% elif device.method == 'sms' %}
            <p>{% blocktrans %}We sent you a text message, please enter the tokens we
            sent.{% endblocktrans %}</p>
            {% else %}
            <p>{% blocktrans %}Please enter the tokens generated by your token
            generator.{% endblocktrans %}</p>
            {% endif %}
            {% elif wizard.steps.current == 'backup' %}
            <p>{% blocktrans %}
            Please enter the token given to you by your domain administrator.
            {% endblocktrans %}</p>
            {% endif %}

            {% for global_error in form.non_field_errors %}
            <div class="alert alert-error">
                {{ global_error }}
            </div>
            {% endfor %}

            <form action="" method="post" class="form-horizontal">{% csrf_token %}
                {% include "two_factor/_wizard_forms.html" %}

                {# hidden submit button to enable [enter] key #}
                <div style="display: none"><input type="submit" value=""/></div>

                {% if other_devices %}
                <p>{% trans "Or, alternatively, use one of your backup phones:" %}</p>
                {% for other in other_devices %}
                <div class="row-fluid">
                    <div class="offset3 span6">
                        <button name="challenge_device" value="{{ other.persistent_id }}"
                                                        class="btn btn-default" type="submit">
                            {{ other|device_action }}
                        </button>
                    </div>
                </div>
                <br />
                {% endfor %}</p>
                {% endif %}
                {% if backup_tokens %}
                <p>{% trans "Please contact your domain adminstrator if you need a backup token" %}</p>
                <div class="row-fluid">
                    <div class="offset3 span6">
                        <button name="wizard_goto_step" type="submit" value="backup"
                                                                      class="btn btn-default">{% trans "Use Backup Token" %}</button>
                    </div>
                </div>
                <br />
                {% endif %}

                <div class="form-actions">
                {% include "two_factor/_wizard_actions.html" %}
                </div>
            </form>
        </div>
        <div class="span4">
            <aside class="well clearfix">
                <h2>{% blocktrans %}Are you new to {{ SITE_NAME }}?{% endblocktrans %}<br /><small>{% trans "Sign up today, it's free!" %}</small></h2>
                {% if not allow_domain_requests %}
                  <p>
                    <a href="{{ PUBLIC_SITE }}/home">{% trans "Learn more" %}</a>
                    {% blocktrans %}about how {{ SITE_NAME }} can be your {{ CAN_BE_YOUR }}.{% endblocktrans %}
                  </p>
                {% endif %}
                  <p>{% blocktrans %}Don't have a {{ SITE_NAME }} account? Sign up for free and get started today!{% endblocktrans %}</p>
                  <a class="btn btn-success btn-large pull-right"
                     {% if allow_domain_requests %}
                       href="{% url "domain_request" domain %}"
                     {% else %}
                       href="{% url "register_user" %}"
                     {% endif %}
                  >
                    {% if allow_domain_requests %}
                      {% blocktrans %}Request Access to {{ hr_name }}{% endblocktrans %}
                    {% else %}
                      {% trans "Sign Up" %}
                    {% endif %}
                  </a>
            </aside>
        </div>
    </div>
{% endblock %}
