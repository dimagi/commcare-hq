{% load i18n two_factor %}

{% block focus-content %}
    <div class="help-block">
        <p>
            {% if next %}
                {% trans "Looks like your CommCare session has expired. Please log in again to continue working." %}
            {% else %}
                {% trans "Please sign in below to continue." %}
            {% endif %}
        </p>

        {% if next %}
        <p>
            {% trans "You will be transferred to your original destination after you sign in." %}
        </p>
        {% endif %}
    </div>

    {% if wizard.steps.current == 'token' %}
    {% if device.method == 'call' %}
    <p>{% blocktrans %}We are calling your phone right now, please enter the
    digits you hear.{% endblocktrans %}</p>
    {% elif device.method == 'sms' %}
    <p>{% blocktrans %}We sent you a text message, please enter the tokens we
    sent.{% endblocktrans %}</p>
    {% else %}
    <p>{% blocktrans %}Please enter the tokens generated by your token
    generator.{% endblocktrans %}</p>
    {% endif %}
    {% elif wizard.steps.current == 'backup' %}
    <p>{% blocktrans %}
    Please enter the token given to you by your domain administrator.
    {% endblocktrans %}</p>
    {% endif %}

    {% for global_error in form.non_field_errors %}
    <div class="alert alert-danger">
        {{ global_error }}
    </div>
    {% endfor %}

    <form action="" method="post" class="form-horizontal">{% csrf_token %}
        {% include "two_factor/_wizard_forms.html" %}

        {# hidden submit button to enable [enter] key #}
        <div style="display: none"><input type="submit" value=""/></div>

        {% if other_devices %}
        <p>{% trans "Or, alternatively, use one of your backup phones:" %}</p>
        {% for other in other_devices %}
        <div class="row-fluid">
            <div class="col-sm-6 col-sm-offset-3">
                <button name="challenge_device" value="{{ other.persistent_id }}"
                                                class="btn btn-default" type="submit">
                    {{ other|device_action }}
                </button>
            </div>
        </div>
        <br />
        {% endfor %}</p>
        {% endif %}
        {% if backup_tokens %}
        <p>{% trans "Please contact your domain administrator if you need a backup token" %}</p>
        <div class="row-fluid">
            <div class="col-sm-offset-3 col-sm-6">
                <button name="wizard_goto_step" type="submit" value="backup"
                                                              class="btn btn-default">{% trans "Use Backup Token" %}</button>
            </div>
        </div>
        <br />
        {% endif %}

        <div class="form-actions">
            <div class="col-sm-offset-4 col-sm-8">
                {% include "two_factor/_wizard_actions.html" %}
            </div>
        </div>
    </form>
{% endblock %}
