{% load i18n two_factor %}

{% block focus-content %}
  <h2 class="text-center">
    {{ current_page.page_name }}
  </h2>

  {% if wizard.steps.current == 'token' %}
    {% if device.method == 'call' %}
      <p class="alert alert-info text-center">
        {% blocktrans %}
          We are calling your phone right now, please enter the
          digits you hear.
        {% endblocktrans %}
      </p>
    {% elif device.method == 'sms' %}
      <p class="alert alert-info text-center">
        {% blocktrans %}
          We sent you a text message, please enter the tokens we
          sent.
        {% endblocktrans %}
      </p>
    {% else %}
      <p class="alert alert-info text-center">
        {% blocktrans %}
          Please enter the tokens generated by your token
          generator.
        {% endblocktrans %}
      </p>
    {% endif %}
  {% elif wizard.steps.current == 'backup' %}
    <p class="alert alert-info text-center">
      {% blocktrans %}
        Please enter the token given to you by your domain administrator.
      {% endblocktrans %}
    </p>
  {% else %}
    <p class="text-center">
      {% if next %}
        {% trans "Looks like your CommCare session has expired." %}<br />
        {% trans "Please log in again to continue working." %}
      {% else %}
        {% trans "Please sign in below to continue." %}
      {% endif %}
    </p>

    {% if next %}
      <p class="alert alert-info text-center">
        {% trans "You will be transferred to your original destination after you sign in." %}
      </p>
    {% endif %}
  {% endif %}

  {% for global_error in form.non_field_errors %}
    <div class="alert alert-danger">
      {{ global_error }}
    </div>
  {% endfor %}

  <form action="" method="post">{% csrf_token %}
    {% include "two_factor/_wizard_forms.html" %}

    {# hidden submit button to enable [enter] key #}
    <div style="display: none"><input type="submit" value=""/></div>

    {% if other_devices %}
      <p>{% trans "Or, alternatively, use one of your backup phones:" %}</p>
      {% for other in other_devices %}
        <p>
          <button name="challenge_device"
                  value="{{ other.persistent_id }}"
                  class="btn btn-default" type="submit">
            {{ other|device_action }}
          </button>
        </p>
      {% endfor %}
    {% endif %}
    {% if backup_tokens %}
      <p>{% trans "Please contact your domain administrator if you need a backup token." %}</p>
      <p>
        <button name="wizard_goto_step"
                type="submit" value="backup"
                class="btn btn-default">
          {% trans "Use Backup Token" %}
        </button>
      </p>

    {% endif %}

    <div class="form-bubble-actions">
      {% include "two_factor/_wizard_actions.html" %}
    </div>
  </form>
{% endblock %}
