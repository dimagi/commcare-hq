{% extends "style/base_mobile.html" %}
{% load hq_shared_tags %}
{% load i18n %}
{% load two_factor %}
{% block title %}{% trans "Log into CommCare HQ" %}{% endblock %}
{% block header %}
    <div class="page-header container-fluid">
        <h1>{% trans "Welcome back to " %}{% if hr_name %}{{ hr_name }}{% elif domain %}{{ domain }}{% else %}CommCare HQ{% endif %}!</h1>
        <p class="lead">
            {% if next %}
                {% trans "Looks like your CommCare session has expired. Please log in again to continue working." %}
            {% else %}
                {% trans "Please sign in below to continue." %}
            {% endif %}
        </p>

        {% if next %}
        <p>
            {% trans "You will be transferred to your original destination after you sign in." %}
        </p>
        {% endif %}
    </div>
{% endblock %}
{% block content %}
    {% load i18n %}

    {% if wizard.steps.current == 'token' %}
    {% if device.method == 'call' %}
    <p>{% blocktrans %}We are calling your phone right now, please enter the
    digits you hear.{% endblocktrans %}</p>
    {% elif device.method == 'sms' %}
    <p>{% blocktrans %}We sent you a text message, please enter the tokens we
    sent.{% endblocktrans %}</p>
    {% else %}
    <p>{% blocktrans %}Please enter the tokens generated by your token
    generator.{% endblocktrans %}</p>
    {% endif %}
    {% elif wizard.steps.current == 'backup' %}
    <p>{% blocktrans %}
    Please enter the token given to you by your domain administrator.
    {% endblocktrans %}</p>
    {% endif %}

    <form class="form-horizontal form-login" name="form" method="post" >
        {% csrf_token %}
        {% for global_error in form.non_field_errors %}
        <div class="alert alert-danger">
            {{ global_error }}
        </div>
        {% endfor %}
        {% if next %}
            <input name="next" type="hidden" value="{{next}}" />
        {% endif %}
        {% if domain %}
            <input name="domain" type="hidden" value="{{ domain }}"/>
        {% endif %}

        {{ wizard.management_form }}

        <fieldset>
        {% for field in form.visible_fields %}
            <div class="form-group{% if field.errors %} error{% endif %}">
                <label class="control-label col-xs-3" for="{{ field.id }}">{{ field.label }}</label>
                <div class="col-xs-9">
                    {{ field }}
                    {% for error in field.errors %}
                        <span class="help-inline">{{ error }}</span>
                    {% endfor %}
                    {% if field.name == "password" %}
                        <p class="help-block">
                            <a href="{% url "password_reset_email" %}">
                                {% trans "Forgot your password?" %}
                            </a>
                        </p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
        </fieldset>

        {% if other_devices %}
        <p>{% trans "Or, alternatively, use one of your backup phones:" %}</p>
        {% for other in other_devices %}
        <div class="row-fluid">
            <div class="offset3 span6">
                <button name="challenge_device" value="{{ other.persistent_id }}"
                                                class="btn btn-default" type="submit">
                    {{ other|device_action }}
                </button>
            </div>
        </div>
        <br />
        {% endfor %}</p>
        {% endif %}
        {% if backup_tokens %}
        <p>{% trans "Please contact your domain adminstrator if you need a backup token" %}</p>
        <div class="row-fluid">
            <div class="offset3 span6">
                <button name="wizard_goto_step" type="submit" value="backup"
                                                              class="btn btn-default">{% trans "Use Backup Token" %}</button>
            </div>
        </div>
        <br />
        {% endif %}

        <div class="form-actions">
            <div class="col-xs-offset-3">
                <button tabindex="3" type="submit" class="btn btn-primary">{% trans "Sign In" %}</button>
            </div>
        </div>
    </form>
    <script>
        $(function () {
            $('#id_username').attr('tabindex', '1').focus();
            $('#id_password').attr('tabindex', '2');
            $('input[type="text"]').addClass('form-control');
            $('input[type="password"]').addClass('form-control');
        });
    </script>
{% endblock %}
{% block mobile-logout %}{% endblock %}
