# Generated by Django 4.2.20 on 2025-07-07 15:41

from django.db import migrations
from django.core.management import call_command

from corehq.util.django_migrations import skip_on_fresh_install
from corehq.privileges import BULK_DATA_EDITING


def noop(*args, **kwargs):
    pass


@skip_on_fresh_install
def _revoke_accidental_free_privilege(apps, schema_editor):
    # The previous management command accidentally granted "Bulk Data Cleaning" privilege
    # to the Free edition, which should not have it. This migration revokes that privilege
    # from all "free" plans.
    call_command(
        'cchq_prbac_revoke_privs',  # important: this is the REVOKE command, not grandfather
        BULK_DATA_EDITING,
        skip_edition='Advanced,Enterprise',
        noinput=True,
    )


class Migration(migrations.Migration):

    dependencies = [
        ('accounting', '0103_bulk_data_cleaning_priv'),
    ]

    operations = [
        migrations.RunPython(
            _revoke_accidental_free_privilege,
            reverse_code=noop,
        ),
    ]
