{% extends "hqwebapp/bootstrap5/base_section.html" %}
{% load hq_shared_tags %}
{% load compress %}
{% load i18n %}

{% block stylesheets %}{{ block.super }}
{% compress css %}
    <link type="text/css"
          rel="stylesheet"
          media="all"
          href="{% static 'nvd3-1.8.6/build/nv.d3.css' %}" />
  {% endcompress %}
{% endblock %}

{% requirejs_main_b5 'app_execution/js/workflow_logs' %}

{% block page_content %}
  {% initial_page_data 'total_items' total %}
  {% registerurl "app_execution:logs_json" request.domain workflow.id %}

  <h2>Logs for workflow "<a href="{% url "app_execution:edit_workflow" request.domain workflow.id %}">{{ workflow.name }}</a>"</h2>
  <div class="row">
    <div id="timing_linechart" class="col">
      <h4 class="text-center">{% trans "Average Timings" %}</h4>
      <svg height="300px"></svg>
    </div>
    <div id="status_barchart" class="col">
      <h4 class="text-center">{% trans "Log Status" %}</h4>
      <svg height="300px"></svg>
    </div>
  </div>
  <div id="workflow-logs">
    <table class="table table-striped table-hover">
    <thead>
    <tr>
      <th>Status</th>
      <th>Started</th>
      <th>Duration</th>
      <th></th>
    </tr>
    </thead>
    <tbody data-bind="foreach: items">
    <tr>
      <td><span class="badge"
                data-bind="
                  text: success ? 'success' : 'error',
                  css: {'text-bg-success': success, 'text-bg-danger': !success}
                ">
      </span></td>
      <td data-bind="text: started"></td>
      <td data-bind="text: duration"></td>
      <td><a class="btn btn-primary" data-bind="attr: {href: url}">Details</a></td>
    </tr>
    </tbody>
    </table>
    <pagination data-apply-bindings="false"
                params="goToPage: goToPage, totalItems: totalItems, perPage: perPage, onLoad: onLoad"></pagination>
</div>
{{ timing_chart_data|json_script:"timing_chart_data" }}
{{ status_chart_data|json_script:"status_chart_data" }}
<script id="timingSeries" type="application/json">
  [{"label": "- Avg Timings", "key": "avg_duration"}, {"label": "- Max Timings", "key": "max_duration"}]
</script>
{% endblock %}
