{% load hq_shared_tags %}
{% load i18n %}
<!-- Template for a Table (i.e. sheet) in the Export page -->
<script type="text/html" id="ko-table-configuration-template">
    <div>
        <legend data-bind="visible: table.isVisible()">
            <span>
                <input type="checkbox" data-bind="checked: table.selected" />
            </span>
            <span>
                <span data-bind="text: table.label()" />
            </span>
            <span>
                <span class="label label-warning" data-bind="visible: table.is_deleted">deleted</span>
            </span>
        </legend>
        <div class="col-sm-12" data-bind="visibleFade: table.selected">
            <div class="form-group pull-right">
                <button type="button" class="btn btn-default" data-bind="
                    click: table.toggleShowAdvanced,
                    css: {active: table.showAdvanced}">
                    <span data-bind="visible: !table.showAdvanced()">
                    {% if export_instance.type == 'form' %}
                        {% trans "Show Deleted Questions and Advanced Properties" %}
                    {% else %}
                        {% trans "Show Deleted Properties and Advanced Properties" %}
                    {% endif %}
                    </span>
                    <span data-bind="visible: table.showAdvanced">
                    {% if export_instance.type == 'form' %}
                        {% trans "Hide Deleted Questions and Advanced Properties" %}
                    {% else %}
                        {% trans "Hide Deleted Properties and Advanced Properties" %}
                    {% endif %}
                    </span>
                </button>
            </div>
            <div class="form-group">
                <label class="col-sm-4 col-md-3 col-lg-2 control-label">{% trans "Sheet Name" %}</label>
                <div class="col-sm-4 col-md-3 col-lg-2">
                    <input type="text" class="form-control" data-bind="value: table.label" />
                </div>
            </div>
            <div class="form-group">
                <label class="col-md-3 col-lg-2 control-label">
                    <strong>{% trans "Choose the fields you want to export." %}</strong><br />
                    <span style="font-weight: normal">
                    {% trans "You can drag and drop fields to reorder them.  You can also rename fields, which will update the headers in the export file." %}
                    </span>
                </label>
                <div class="col-md-9 col-lg-10">
                    <table class="table table-bordered table-striped table-condensed" id="field-select">
                        <thead>
                        <tr class="nodrag nodrop">
                            <th></th>
                            <th>{% trans "Include this Field?" %}<br />
                                <a class="btn btn-xs btn-primary" data-bind="click: table.selectAll">{% trans "Select All" %}</a>
                                <a class="btn btn-xs btn-default" data-bind="click: table.selectNone">{% trans "Select None" %}</a>
                            </th>
                            <th>
                            {% if export_instance.type == 'form' %}
                                {% trans "Question" %}
                            {% else %}
                                {% trans "Property" %}
                            {% endif %}
                            </th>
                            <th>
                                {% trans "Display" %}<br />
                                {% if export_instance.type == 'form' %}
                                <a
                                    class="btn btn-xs btn-primary"
                                    data-bind="click: table.useLabels">
                                    {% trans "Use question labels" %}
                                </a>
                                <a
                                    class="btn btn-xs btn-default"
                                    data-bind="click: table.useIds">
                                    {% trans "Use question ids" %}
                                </a>
                                {% endif %}
                            </th>
                            {% if export_instance.type == 'case' and request|feature_preview_enabled:"SPLIT_MULTISELECT_CASE_EXPORT"%}
                            <th>{% trans "Type" %}</th>
                            {% endif %}
                            {% if allow_deid %}
                            <th class="deid-column" data-bind="visible: $root.isDeidColumnVisible()">{% trans "Sensitivity" %}</th>
                            {% endif %}
                        </tr>
                        </thead>
                        <tbody data-bind="
                            sortable: {
                                data: table.columns,
                                as: 'column',
                                name: 'ko-export-column-template'
                            }
                        ">
                            <tr class="sortable-handle" data-bind="
                                visible: column.isVisible($parent),
                                attr: {'data-order': _sortableOrder}
                                ">
                                <td class="sortable-handle text-center">
                                    <i class="fa fa-arrows-v"></i>
                                </td>
                                <td>
                                    <!--ko if: ($root.is_deidentified() && column.item.isCaseName()) -->
                                    <input type="checkbox"
                                           class="field-include"
                                           disabled="disabled" />
                                    <!--/ko-->
                                    <!--ko ifnot: ($root.is_deidentified() && column.item.isCaseName()) -->
                                    <input type="checkbox"
                                           class="field-include"
                                           data-bind="checked: column.selected" />
                                    <!--/ko-->
                                </td>
                                <td>
                                    <span data-bind="foreach: { data: column.tags, as: 'tag' }">
                                        <span data-bind="
                                            text: tag,
                                            attr: { class: Exports.Utils.getTagCSSClass(tag) }"></span>
                                    </span>
                                    <code data-toggle="tooltip" data-placement="top" 
                                        data-bind="
                                            text: column.formatProperty(),
                                            attr: {
                                                'data-original-title': column.help_text,
                                                'data-toggle': column.help_text ? 'tooltip' : null
                                            },
                                            css: {
                                                'export-tooltip': column.translatedHelp()
                                            }
                                        "></code>
                                </td>
                                <td><input class="form-control" type="text" data-bind="value: column.label" /></td>
                                {% if export_instance.type == 'case' and request|feature_preview_enabled:"SPLIT_MULTISELECT_CASE_EXPORT"%}
                                <td class="input">
                                    <div data-bind="if: !allOptions()">
                                        <select disabled>
                                            <option>{% trans "plain" %}</option>
                                        </select>
                                    </div>
                                    <div data-bind="if: allOptions">
                                        <select data-bind="
                                            value: doc_type,
                                            foreach: $root.column_type_options
                                        "/>
                                            <option data-bind="value: value, text: label"></option>
                                        </select>
                                        <span data-bind="makeHqHelp: {name: '{% trans "Split multi-select data" %}', placement: 'left'}"></span>
                                        <div data-bind="if: doc_type() === 'SplitColumn'">
                                            <a href="#" data-bind="visible: !showOptions(), click: function() {showOptions(true);}">{% trans "Show Options" %}</a>
                                            <div data-bind="visible: showOptions">
                                                <select class="select2" data-bind="options: allOptions, selectedOptions: options" multiple="true">
                                                </select>
                                                <br/>
                                                <input class="input input-small" type="text" data-bind="value: newOption"/>
                                                <button class="btn" data-bind="click: addOption">{% trans "Add" %}</button>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                {% endif %}
                                {% if allow_deid %}
                                <td class="deid-column" data-bind="visible: $root.isDeidColumnVisible()">
                                    <select class="form-control" data-bind="
                                        value: deid_transform,
                                        options: getDeidOptions(),
                                        optionsText: getDeidOptionText
                                    ">
                                    </select>
                                </td>
                                {% endif %}
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</script>
