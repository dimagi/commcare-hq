{% extends "hqwebapp/two_column.html" %}
{% load hq_shared_tags %}
{% load i18n %}
{% block js %}{{ block.super }}
    {% include "imports/datatables.html" %}
    <script src="{% static 'reports/javascripts/config.dataTables.bootstrap.js' %}"></script>
    <script src="{% static 'hqwebapp/js/lib/knockout.mapping.js' %}"></script>
    <script src="{% static 'hqwebapp/js/knockout-bindings.js' %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
    <script type="text/javascript">
        var base_url = "{{ url }}";
        function get_report_url() {
            return base_url;
        }

         // raw datatables version
{#        $(document).ready(function() {#}
{#            $('#report_table_{{ report.slug }}').dataTable({#}
{#                "bProcessing": true,#}
{#                "bServerSide": true,#}
{#                "sAjaxSource": "{{ url }}",#}
{#                "sAjaxDataProp": "aaData",#}
{#                "bPaginate": true,#}
{#                "aoColumns": {{ headers.render_aoColumns|JSON }}#}
{#            });#}
{#        });#}

    $(function(){
        var reportTables = new HQReportDataTables({
            dataTableElem: '#report_table_{{ report.slug }}',
            defaultRows: {{ report_table.default_rows|default:10 }},
            startAtRowNum: {{ report_table.start_at_row|default:0 }},
            showAllRowsOption: {{ report_table.show_all_rows|JSON }},

            {% if headers.render_aoColumns %}aoColumns: {{ headers.render_aoColumns|JSON }},{% endif %}
            autoWidth: {{ headers.auto_width|JSON }},
            {% if headers.custom_sort %}customSort: {{ headers.custom_sort|JSON }},{% endif %}

            ajaxSource: '{{ url }}',
            {# ajaxParams: function() { #}
                {# return [ #}
                    {# {"name": "startdate", "value": "2014-01-01"}, #}
                    {# {"name": "enddate", "value": "2014-04-01"} #}
                {# ]; #}
            {# }, #}
            ajaxParams: function() {
                pass
            },

            {% if report_table.left_col.is_fixed %}
                fixColumns: true,
                fixColsNumLeft: {{ report_table.left_col.fixed.num }},
                fixColsWidth: {{ report_table.left_col.fixed.width }},
            {% endif %}
        });
        reportTables.render();

        // on submit of forms call this
{#        reportTables.refresh();#}

    });
    </script>
{% endblock %}

{% block head %}
    {{ block.super }}
{% endblock %}

{% block title %}{{ report.title|default:"Project Reports"|safe }}{% endblock %}

{% block page-title %}
<div class="breadcrumb">
    <div id="report-title">{{ report.title }}</div>
</div>
{% endblock %}

{% block main_column %}
<div class="form-horizontal">
    <fieldset>
        <legend><span>{% trans "Report Filters" %}</span></legend>
        {% for slug, filter in report.filters %}
            {% include filter.template with filter=filter context=filter_context|dict_lookup:filter.css_id %}
        {% endfor %}
    </fieldset>
</div>

{% block reporttable %}
<table id="report_table_{{ report.slug }}" class="table table-striped datatable">
    <thead>
    {{ headers.render_html|safe }}
    </thead>
    <tbody>
    </tbody>
</table>
{% endblock reporttable %}
{% endblock %}
