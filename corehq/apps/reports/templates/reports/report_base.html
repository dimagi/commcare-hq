{% extends "hqwebapp/two_column.html" %}
{% load hq_shared_tags %}

{% block js %}{{ block.super }}
{% include "imports/datatables.bootstrap.html" %}
<script type="text/javascript" src="{% static 'reports/javascripts/config.dataTables.bootstrap.js' %}"></script>
{% include "imports/flot.html" %}
<script type="text/javascript" src="{% static 'hqwebapp/javascripts/jquery-ui-datepicker/jquery-ui-1.8.17.custom.datepicker.min.js' %}"></script>
<script type="text/javascript" src="{% static 'reports/javascripts/datepicker.js' %}"></script>
<script type="text/javascript" src="{% static 'hqwebapp/js-custom/hq.new-notify.js' %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
{% if not report_hide_filters %}
    <script type="text/javascript">
        $(function() {
            var reportFilterCookieName = '{{ slug }}reportFiltersHidden',
                    savedPath = '/a/{{ domain }}/reports/';
            $("#reportFilters").addClass($.cookie(reportFilterCookieName));
            $("#reportFilters").on('hidden', function () {
                $.cookie(reportFilterCookieName, '', {path: savedPath, expires: 1});
            });
            $("#reportFilters").on('shown', function () {
                $.cookie(reportFilterCookieName, 'in', {path: savedPath, expires: 1});
            });

            $('#paramSelectorForm button[type="submit"]').addClass('disabled');
            $('#paramSelectorForm').change(enableFilterSubmit);
            $('#paramSelectorForm fieldset button').click(enableFilterSubmit);
            function enableFilterSubmit () {
                $('#paramSelectorForm button[type="submit"]').removeClass('disabled').addClass('btn-primary');
            }
        });
    </script>
{% endif %}
{% endblock %}

{% block head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'hqwebapp/javascripts/jquery-ui-datepicker/datepicker-theme/jquery-ui-1.8.17.custom.css' %}" />
    <script type="text/javascript" src="{% static 'hqwebapp/javascripts/knockout-2.0.0.js' %}"></script>
{% endblock %}

{% block page-title %}
    <ul class="breadcrumb">
        <li>
            <a href="{% url default_report domain %}"><strong>Reports</strong></a> <span class="divider">&gt;</span>
        </li>
        {% if not report_breadcrumbs %}
        <li class="active">
            <div id="report-title"><a href="">{{ report.name|default:"Unknown Report"|safe }}</a></div>
        </li>
        {% else %}
        {{ report_breadcrumbs|safe }}
        {% endif %}
    </ul>
{% endblock %}

{% block sidebar %}{% include "reports/partials/report_list.html" %}{% endblock %}
{% block main_column %}
    <div class="hq-accordion-control" id="reportFiltersAccordion">
        <div class="accordion-heading">
            {% if not report_hide_filters %}<a href="#reportFilters" data-toggle="collapse">Advanced Filters</a>{% else %}
                <div class="no-filters">&nbsp;</div>
            {% endif %}
            <div id="extra-filter-info" class="accordion-extra"></div>
        </div>
        {% if not report_hide_filters %}
        <div id="reportFilters" class="accordion-body collapse">
            <div class="accordion-inner">
                <form method="get" id="paramSelectorForm" class="form-horizontal">
                    {% if custom_fields %}
                        <fieldset>
                            <legend>Report Filters</legend>
                            {% for field in custom_fields %}
                                <div id="{{ field.slug }}" class="control-group">
                                    {{ field.field|safe }}
                                </div>
                            {% endfor %}
                        </fieldset>
                    {% endif %}
                    {% if show_dates or custom_fields or show_user_filter %}
                        <div class="form-actions">
                            <button type="submit" class="btn btn-large">Update Filters</button>
                            <a href="#reportFilters" data-toggle="collapse" class="btn btn-large">Close</a>
                        </div>
                    {% endif %}
                </form>
            </div>
        </div>
        {% endif %}
    </div>
    {% if show_time_notice %}{% include "hqwebapp/partials/time-notice.html"%}{% endif %}
    <div id="report-content">
        {% block reportcontent %}
        {% if request.couch_user.can_view_reports or request.couch_user.get_viewable_reports %}
            <h6 style="text-align: center; margin-top: 200px;">Select a Report to View</h6>
        {% else %}
            <h6 style="text-align: center; margin-top: 100px;">
                <i class="icon-info-sign" id="no-viewable-reports"></i>
                You are not registered to see reports
            </h6>
            <script>
                $(function () {
                    $('.sidebar').hide();
                    $('.hq-double-col').css({background: 'white'});
                    $('.hq-content').removeClass('span10').addClass('span12').css({margin: 0});
                    $('#no-viewable-reports').popover({
                        placement: 'top',
                        title: "We're serious about security",
                        content: "Your project may contain sensitive personal and medical information, " +
                                "so we don't show this data to " +
                                "just anyone. If you think you should have access to your project's reports " +
                                "please contact your project lead."
                    });
                });
            </script>
        {% endif %}
            <script>
                $(function () {
                    $('#reportFiltersAccordion').hide();
                });
            </script>
        {% endblock %}
    </div>
{% endblock %}

