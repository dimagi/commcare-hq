{% extends 'hqwebapp/bootstrap3/base_section.html' %}
{% load compress %}
{% load hq_shared_tags %}
{% load i18n %}
{% js_entry_b3 "campaign/js/dashboard" %}

{% block title %}
  {% trans "Campaign Dashboard" %}
{% endblock %}

{% block page_content %}
  {% initial_page_data 'mapbox_access_token' mapbox_access_token %}
  {% registerurl 'api_cases_with_gps' request.domain %}
  {% initial_page_data 'map_report_widgets' map_report_widgets %}
  {% include "campaign/partials/add_widget_button.html" %}

  <div class="clearfix margin-bottom-10">
    <h1 class="pull-left">{% trans "Campaign Dashboard" %}</h1>
    <button id="print-to-pdf" class="btn btn-info pull-right">
      <i class="fa fa-file-pdf-o margin-right-5"></i>
      {% trans "Export to PDF" %}
    </button>
  </div>
  <div id="pdf-export-error" class="alert alert-danger hide">
    {% blocktrans %}
      There was an error while exporting to PDF! Please try again, and contact
      support if the issue persists.
    {% endblocktrans %}
  </div>

  <ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active">
      <a
        href="#cases-tab-content"
        role="tab"
        data-toggle="tab"
      >
        {% trans "Cases" %}
      </a>
    </li>
    <li>
      <a
        href="#mobile-workers-tab-content"
        role="tab"
        data-toggle="tab"
      >
        {% trans "Mobile Workers" %}
      </a>
    </li>
  </ul>
  <div class="spacer"></div>
  <div class="tab-content">
    <div class="tab-pane active" id="cases-tab-content" role="tabpanel">
      <!-- Cases tab content -->
      <!-- Gauges Section -->
      <div class="row">
        <h2>{% trans "Gauges" %}</h2>
      </div>
      <div class="spacer"></div>
      <!-- Report and Map Section -->
      <div class="row">
        <h2>{% trans "Reports" %}</h2>
        <div id="map-reports-container-cases">
          {% for widget in map_report_widgets.cases %}
            {% if widget.widget_type == 'DashboardMap' %}
              {% include 'campaign/partials/dashboard_map.html' %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="tab-pane" id="mobile-workers-tab-content">
      <!-- Users tab content -->
      <!-- Gauges Section -->
      <div class="row">
        <h2>{% trans "Gauges" %}</h2>
      </div>
      <div class="spacer"></div>
      <!-- Report and Map Section -->
      <div class="row">
        <h2>{% trans "Reports" %}</h2>
        <div id="map-reports-container-mobile-workers">
          {% for widget in map_report_widgets.mobile_workers %}
            {% if widget.widget_type == 'DashboardMap' %}
              {% include 'campaign/partials/dashboard_map.html' %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  {% include "campaign/partials/widget_modal.html" %}
{% endblock page_content %}

{% block modals %}
  {% include "hqwebapp/htmx/error_modal.html" %}
  {{ block.super }}
{% endblock modals %}
