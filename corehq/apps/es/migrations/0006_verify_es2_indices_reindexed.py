# Generated by Django 3.2.23 on 2024-01-05 12:54

from django.db import migrations
from django.core.management import call_command
from corehq.util.django_migrations import skip_on_fresh_install


@skip_on_fresh_install
def _verify_reindex_status(apps, schema_editor):
    changelog_url = 'https://commcare-cloud.readthedocs.io/en/latest/changelog/0075-reindex-all-indexes-for-es-upgrade.html'
    current_es_version = 2

    call_command(
        'ensure_indices_reindexed', current_es_version, changelog_url
    )


class Migration(migrations.Migration):

    dependencies = [
        ('es', '0005_add_epoch_as_valid_date_to_forms'),
    ]

    operations = [
        migrations.RunPython(_verify_reindex_status, reverse_code=migrations.RunPython.noop)
    ]
