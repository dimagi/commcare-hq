{% load i18n %}
{% load crispy_forms_tags %}

<div
  id="{{ container_id }}"
  hx-swap="outerHTML"
  hq-hx-refresh-swap="{{ table_selector }}"
>
  <div class="mb-3">
    <h5>
      {% trans "Visible Columns" %}
    </h5>
    <form
      hx-post="{{ request.path_info }}"
      hx-target="#{{ container_id }}"
      hx-trigger="end"
      hq-hx-loading="{{ table_loading_id }}"
    >
      <ul class="list-group sortable">
        {% for column in columns %}
          <li class="list-group-item d-flex">
            <a class="link p-1 flex-grow-1">
              <i class="fa-solid fa-up-down"></i>
              <input type="hidden" name="columns" value="{{ column.slug }}" />
              <span class="ps-2">{{ column.config.header }}</span>
            </a>
            <button
              class="btn btn-outline-danger btn-sm" aria-label="{% trans "Close" %}"
              hx-delete="{{ request.path_info }}?column={{ column.slug }}"
              hx-target="#{{ container_id }}"
              hx-disabled-elt="this"
              hq-hx-loading="{{ table_loading_id }}"
            >
              <i class="fa-solid fa-close"></i>
            </button>
          </li>
        {% endfor %}
      </ul>
    </form>
  </div>
  {% if new_column_choices %}
    <div class="card mb-3">
      <div class="card-body">
        <form
          hx-put="{{ request.path_info }}"
          hx-target="#{{ container_id }}"
          hx-disabled-elt="find button"
          hq-hx-loading="{{ table_loading_id }}"
        >
          <div class="mb-3">
            <label class="form-label" for="property">
              {% trans "Select property to add" %}:
            </label>
            <select
              class="form-select"
              name="add_column"
            >
              {% for choice in new_column_choices %}
                <option value="{{ choice.0 }}">
                  {{ choice.1 }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <button class="btn btn-outline-primary htmx-loading" type="submit">
              <i class="fa-solid fa-plus"></i> {% trans "Add Column" %}
            </button>
          </div>
        </form>
      </div>
    </div>
  {% endif %}
</div>
