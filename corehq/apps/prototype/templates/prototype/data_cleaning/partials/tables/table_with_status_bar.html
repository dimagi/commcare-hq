{% extends "hqwebapp/tables/bootstrap5_htmx.html" %}
{% load i18n %}
{% load django_tables2 %}
{% load hq_shared_tags %}

{% block table-container-attrs %}
  hx-get="{{ request.path_info }}{% querystring %}"
  hx-trigger="refreshTable"
  x-data="{
    numRecordsSelected: {{ table.num_selected_records }},
    totalRecords: {{ table.page.paginator.count }},
    pageTotalRecords: {{ table.paginator.per_page }},
    pageNumRecordsSelected: 0,
  }"
  x-init="$dispatch('numRecordsSelectedChanged', numRecordsSelected);
          $watch('numRecordsSelected', value => $dispatch('numRecordsSelectedChanged', value))"
{% endblock %}

{% block before_table %}
  <div class="d-flex align-items-center mb-2">
    <div class="my-1">
      <i class="fa-solid fa-circle-check"></i>
      {% blocktrans %}
        <span x-text="numRecordsSelected"></span> Records Selected
      {% endblocktrans %}
    </div>
    <div class="ps-2"
         x-show="numRecordsSelected > 0">
      <button class="btn btn-outline-danger btn-sm"
              type="button"
              hx-action="select_all"
              hx-post="{{ request.path_info }}{% querystring %}"
              hx-vals='{"selectAll": false}'
              hx-target="{% if table.css_id %}#{{ table.css_id }}{% else %}div.table-container{% endif %}"
              hx-swap="outerHTML"
              hq-hx-loading="{{ table.loading_indicator_id  }}">
        {% blocktrans %}
          Cancel Selection
        {% endblocktrans %}
      </button>
    </div>
    <div class="ps-2"
         x-show="numRecordsSelected > 0 && numRecordsSelected < totalRecords">
      <button class="btn btn-outline-primary btn-sm"
              type="button"
              hx-action="select_all"
              hx-post="{{ request.path_info }}{% querystring %}"
              hx-vals='{"selectAll": true}'
              hx-target="{% if table.css_id %}#{{ table.css_id }}{% else %}div.table-container{% endif %}"
              hx-swap="outerHTML"
              hq-hx-loading="{{ table.loading_indicator_id  }}">
        {% blocktrans with table.page.paginator.count as num_records %}
          Select All {{ num_records }} Records
        {% endblocktrans %}
      </button>
    </div>

    {%  if table.has_filters %}
      <div class="ps-2 ms-2">
        <i class="fa-solid fa-filter"></i>
        {% blocktrans with table.page.paginator.count as num_records %}
          Filter Applied: {{ num_records }} Matching Records
        {% endblocktrans %}
        <button class="btn btn-outline-danger btn-sm ms-2"
                type="button"
                hx-swap="none"
                hx-action="clear_filters"
                hx-post="{{ request.path_info }}{% querystring %}"
                hq-hx-loading="{{ table.loading_indicator_id  }}"
                hx-on::after-request="htmx.trigger('#{{ table.filter_form_id }}', 'refreshFilters');">
          <i class="fa-solid fa-close"></i> {% trans "Clear Filters" %}
        </button>
      </div>
    {% endif %}

    <div class="ps-2 ms-2 edit-button"
         x-data="{ hasEdits: {{ table.has_edits|BOOL }} }"
         x-show="hasEdits && numRecordsSelected > 0"
         @update-apply-edits-button.camel.window="hasEdits = $event.detail">
      <i class="fa-solid fa-pencil"></i>
      {% trans "Edits" %}:
      <button class="btn btn-success btn-sm ms-2"
              type="button"
              hx-post="{{ request.path_info }}{% querystring %}"
              hx-action="apply_edits"
              hx-target="{% if table.css_id %}#{{ table.css_id }}{% else %}div.table-container{% endif %}"
              hx-swap="outerHTML"
              hq-hx-loading="{{ table.loading_indicator_id  }}">
        <i class="fa-solid fa-check"></i> {% trans "Apply Edits to Selected Rows" %}
      </button>
    </div>

  </div>
{% endblock %}
