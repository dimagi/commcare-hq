{% extends "users/base_template.html" %}
{% load i18n %}

{% block js-inline %}{{ block.super }}
<script>
    $(function () {
        $('.reporting-group-icon').popover({
            placement: 'right',
            trigger: 'hover',
            title: 'This is a Reporting Group',
            content: "Reporting groups are used in reports to filter and view data. You can remove this group from " +
                    "reports by editing this group's settings."
        });
        $('.case-sharing-group-icon').popover({
            placement: 'right',
            trigger: 'hover',
            title: 'This is a Case Sharing Group',
            content: "Case sharing groups allow their members to share a case list in a case-sharing app. You can change this " +
                    "by editing this group's settings."
        });

        var $createGroupForm = $("#create_group_form");
        $("button:submit", $createGroupForm).click(function(){
            ga_track_event("Groups", "Create Group", {
               'hitCallback': function () {
                   $createGroupForm.submit();
               }
            });
            return false;
        });
    });


</script>
{% endblock %}

{% block main_column %}
{% if needs_to_downgrade_locations %}
    <div>
        <p>
            {% trans "This project no longer has access to the Organization feature." %}
            <a href="{% url "downgrade_locations" domain %}">
                {% trans "Click here to fix this." %}
            </a>
        </p>
    </div>
{% else %}
    {% block group-info %}
        {% if all_groups %}
            <h2>{% trans "Select a group:" %}</h2>
        {% else %}
            <h2>{% trans "Create your first group:" %}</h2>
        {% endif %}
    {% endblock %}

    <div class="tabbable tabs-left row-fluid">
        <ul class="nav nav-tabs span2">
            {% with group as this_group %}
                {% for group in all_groups %}
                    <li {% if this_group.get_id == group.get_id %}class="active"{% endif %}>
                        <a href="{% url "group_members" domain group.get_id %}">{{ group.display_name }}
                            {% if group.reporting %}
                                <i class="icon-list-alt reporting-group-icon"></i>
                            {% else %}
                               <i class="icon-white"></i>
                            {% endif %}
                            {% if group.case_sharing %}<i class="icon-star case-sharing-group-icon"></i>{% endif %}
                        </a>
                    </li>
                {% endfor %}
            {% endwith %}
        </ul>
        {% if not group.is_deleted %}
        <div class="tab-content span9">
            {% block group-view %}
            {% endblock %}
        </div>
        {% endif %}
    </div>
    <form class="well form-inline" method="post" action="{% url "add_group" domain %}" id="create_group_form">
        {% csrf_token %}
        <input type="text" placeholder="{% trans "Group Name" %}" id="id_group_name" name="group_name" />
        <button class="btn btn-success" type="submit">{% trans "Create Group" %}</button>
    </form>
{% endif %}
{% endblock %}

