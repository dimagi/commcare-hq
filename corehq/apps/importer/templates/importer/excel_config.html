{% extends "hqwebapp/two_column.html" %}
{% load report_tags %}
{% load i18n %}

{% block head %}
    {{ block.super }}
{% endblock %}

{% block js-inline %}{{ block.super }}
    <script type="text/javascript">
        $(function() {
            $('#key_value_columns').change(function() {
                if ($(this).val().toLowerCase() == "yes") {
                    $('#key_column').removeAttr('disabled');
                    $('#value_column').removeAttr('disabled');
                } else {
                    $('#key_column').attr('disabled', 'disabled');
                    $('#value_column').attr('disabled', 'disabled');
                }
            });

            $('#key_value_columns').change();

            $('#back_button').click(function() {
                history.back();
                return false;
            });
        });
    </script>
{% endblock %}

{% block main_column %}
    <form class="form-horizontal form-report"
          action="{% url corehq.apps.importer.views.excel_fields domain %}"
          method="post">
    <input type="hidden" name="named_columns" value="{{named_columns}}" />

    <fieldset>
        <legend>{% trans "Which cases do you want to update?" %}</legend>
        <div class="control-group">
            <div class="controls">
                <label for="case_type">{% trans "Case type" %}</label>
                <select name="case_type" id="case_type">
                    {% for case_type in case_types %}
                    <option value="{{case_type|escape}}">{{case_type|escape}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>{% trans "Which column should be used to identify cases?" %}</legend>
        <div class="control-group">
            <div class="controls">
                <label for="search_column">{% trans "Excel column" %}</label>
                <select name="search_column" id="search_column">
                    {% for column in columns %}
                    <option value="{{column|escape}}">{{column|escape}}</option>
                    {% endfor %}
                </select>

                <label for="search_field">{% trans "Corresponding case field" %}</label>
                <select name="search_field" id="search_field">
                    <option value="case_id">{% trans "case_id" %}</option>
                    <option value="external_id">{% trans "external_id" %}</option>
                </select>
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>{% trans "Do you want to create new cases if there isn't a match found to update?" %}</legend>
        <div class="control-group">
            <div class="controls">
                <select class="input-small" name="create_new_cases" id="create_new_cases">
                    <option selected>No</option>
                    <option>Yes</option>
                </select>
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>{% trans "Are there columns in the file that contain key/value fields?" %}</legend>
        <div class="control-group">
            <div class="controls">
                <select class="input-small" name="key_value_columns" id="key_value_columns">
                    <option selected>No</option>
                    <option>Yes</option>
                </select>
            </div>
        </div>
    </fieldset>

    <fieldset>
        <legend>{% trans "Which Excel columns correspond to the key/value fields?" %}</legend>
        <div class="control-group">
            <div class="controls">
                <label for="key_column">{% trans "Key column" %}</label>
                <select name="key_column" id="key_column">
                    {% for column in columns %}
                    <option value="{{column|escape}}">{{column|escape}}</option>
                    {% endfor %}
                </select>

                <label for="value_column">{% trans "Value column" %}</label>
                <select name="value_column" id="value_column">
                    {% for column in columns %}
                    <option value="{{column|escape}}">{{column|escape}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </fieldset>

    <div class="form-actions">
        <button type="button" class="btn btn-primary btn-large" id="back_button">
            <i class="icon-backward icon-white"></i> {% trans "Back" %}
        </button>
        <button type="submit" class="btn btn-primary btn-large">
            <i class="icon-forward icon-white"></i> {% trans "Next Step" %}
        </button>
    </div>
    </form>
{% endblock %}
