# Generated by Django 3.2.20 on 2023-10-05 18:52

from django.db import migrations, models

INDEX_NAME = 'form_processor_co_be9b2037_idx'
TABLE_NAME = 'form_processor_commcarecasesql'
COLUMN = 'deleted_on'

CREATE_INDEX_SQL = "CREATE INDEX CONCURRENTLY IF NOT EXISTS {} ON {} ({}) WHERE {} IS NOT NULL".format(
    INDEX_NAME, TABLE_NAME, COLUMN, COLUMN)
DROP_INDEX_SQL = "DROP INDEX CONCURRENTLY IF EXISTS {}".format(INDEX_NAME)


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ('form_processor', '0095_remove_xforminstance_deleted_state'),
    ]

    operations = [
        migrations.RunSQL(
            sql=CREATE_INDEX_SQL,
            reverse_sql=DROP_INDEX_SQL,
            state_operations=[
                migrations.AddIndex(
                    model_name='commcarecase',
                    index=models.Index(condition=models.Q(('deleted_on__isnull', False)), fields=['deleted_on'],
                                       name=INDEX_NAME),
                ),
            ]
        )
    ]
