from pillowtop.es_utils import SMS_HQ_INDEX_NAME, ElasticsearchIndexInfo

from corehq.apps.es.client import Tombstone
from corehq.apps.es.sms import sms_adapter
from corehq.pillows.core import DATE_FORMATS_ARR, DATE_FORMATS_STRING
from corehq.util.elastic import prefix_for_tests

SMS_INDEX = sms_adapter.index_name
SMS_TYPE = sms_adapter.type
SMS_ES_ALIAS = prefix_for_tests("smslogs")

SMS_MAPPING = {
    "_all": {
        "enabled": False
    },
    "_meta": {
        "comment": "Autogenerated [corehq.apps.sms.models.SMSLog] mapping from ptop_generate_mapping 09/23/2013",
        "created": None
    },
    "date_detection": False,
    "date_formats": DATE_FORMATS_ARR,
    "dynamic": False,
    "properties": {
        "backend_api": {
            "type": "string"
        },
        "backend_id": {
            "type": "string"
        },
        "base_doc": {
            "type": "string"
        },
        "billed": {
            "type": "boolean"
        },
        "couch_recipient": {
            "index": "not_analyzed",
            "type": "string"
        },
        "couch_recipient_doc_type": {
            "type": "string"
        },
        "date": {
            "format": DATE_FORMATS_STRING,
            "type": "date"
        },
        "direction": {
            "type": "string"
        },
        "doc_type": {
            "index": "not_analyzed",
            "type": "string"
        },
        "domain": {
            "fields": {
                "domain": {
                    "index": "analyzed",
                    "type": "string"
                },
                "exact": {
                    "index": "not_analyzed",
                    "type": "string"
                }
            },
            "type": "multi_field"
        },
        "phone_number": {
            "type": "string"
        },
        "processed": {
            "type": "boolean"
        },
        "reminder_id": {
            "type": "string"
        },
        "text": {
            "type": "string"
        },
        "workflow": {
            "type": "string"
        },
        "xforms_session_couch_id": {
            "type": "string"
        },
        Tombstone.PROPERTY_NAME: {
            "type": "boolean"
        }
    }
}

SMS_INDEX_INFO = ElasticsearchIndexInfo(
    index=SMS_INDEX,
    alias=SMS_ES_ALIAS,
    type=SMS_TYPE,
    mapping=SMS_MAPPING,
    hq_index_name=SMS_HQ_INDEX_NAME
)
