{% extends "reports/base_template.html" %}
{% load hq_shared_tags %}
{% load compress %}
{% load i18n %}
{% load crispy_forms_tags %}

{% block js %}{{ block.super }}
    {% compress js %}
        <script src="{% static 'ace-builds/src-min-noconflict/ace.js' %}"></script>
        <script src="{% static 'ace-builds/src-min-noconflict/mode-json.js' %}"></script>
        <script src="{% static 'ace-builds/src-min-noconflict/mode-xml.js' %}"></script>
        <script src="{% static 'ace-builds/src-min-noconflict/ext-searchbox.js' %}"></script>
        <script src="{% static 'repeaters/js/repeat_record_report.js' %}"></script>
        <script src="{% static 'repeaters/js/repeat_record_report_selects.js' %}"></script>
    {% endcompress %}
{% endblock js %}

{% block filter_panel %} {{ block.super }}
  <div>
      {% if total > 0 %}
        <div id="form_options" class="well form-inline">
          <div>
            <button id="resend-all-button"
                    class="btn btn-default"
                    data-target="#are-you-sure"
                    title="{% trans 'Resend selected records' %}">
              <i class="fa fa-play"></i>
              {% trans 'Resend' %}
            </button>
            <button id="cancel-all-button"
                    class="btn btn-default"
                    data-target="#are-you-sure"
                    title="{% trans 'Cancel selected records' %}">
              <i class="fa fa-times"></i>
              {% trans 'Cancel' %}
            </button>
            <button id="requeue-all-button"
                    class="btn btn-default"
                    data-target="#are-you-sure"
                    title="{% trans 'Requeue selected records' %}">
              <i class="fa fa-recycle"></i>
              {% trans 'Requeue' %}
            </button>
            <label class="checkbox" >
              <input type="checkbox" id="select-all" data-id="{{ form_query_string|urlencode }}">
                {% blocktrans %}Select all {{ total }} payloads{% endblocktrans %}
            </label>
            <label class="checkbox" >
              <input type="checkbox" id="cancel-all" data-id="{{ form_query_string_pending|urlencode }}">
                {% blocktrans %}Select {{ total_pending }} pending payloads{% endblocktrans %}
            </label>
            <label class="checkbox" >
              <input type="checkbox" id="requeue-all" data-id="{{ form_query_string_cancelled|urlencode }}">
                {% blocktrans %}Select {{ total_cancelled }} cancelled payloads{% endblocktrans %}
            </label>
          </div>
        </div>
      {% endif %}
  </div>
  <div id="warning" class="alert alert-warning hide">
    {% blocktrans %}Please select at least one payload{% endblocktrans %}
  </div>
  <div id="not-allowed" class="alert alert-warning hide">
    {% blocktrans %}This action is not allowed for some of the selected payloads{% endblocktrans %}
  </div>
  <div class="modal fade" id="are-you-sure">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span>
            <span class="sr-only">{% blocktrans %}Close{% endblocktrans %}</span></button>
          <h4 class="modal-title">{% blocktrans %}Confirmation{% endblocktrans %}</h4>
        </div>
        <div class="modal-body">
          {% blocktrans %}Are you sure?{% endblocktrans %}
        </div>
        <div class="modal-footer">
          <button type="button" data-dismiss="modal" class="btn btn-default">
            {% blocktrans %}No{% endblocktrans %}
          </button>
          <button type="button" id="confirm-button" data-action="" data-flag="" class="btn btn-primary">
            {% blocktrans %}Yes{% endblocktrans %}
          </button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block additional_initial_page_data %} {{ block.super }}
    {% registerurl 'repeat_record' domain %}
    {% registerurl 'cancel_repeat_record' domain %}
    {% registerurl 'requeue_repeat_record' domain %}
{% endblock %}

{% block modals %}{{ block.super }}
    <!-- "View Payload" Modal -->
    <div class="modal fade full-screen-modal" id="view-record-payload-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">{% trans "Payload" %}</h4>
                </div>
                <div class="modal-body">
                    <div class="payload"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                    {% trans "Close" %}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for "Resend Payload" errors -->
    <div class="modal fade" id="payload-error-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">{% trans "Payload Error" %}</h4>
                </div>
                <div class="modal-body">
                    <div class="error-message"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">
                    {% trans "Close" %}
                    </button>
                </div>
            </div>
        </div>
    </div>
{% endblock modals %}
