{% extends 'hqwebapp/two_column.html' %}
{% load hq_shared_tags %}
{% load crispy_forms_tags %}
{% load i18n %}
{% load compress %}

{% block title %}Edit Config : DHIS2 Tracked Entities :: {% endblock %}

{% block js %}{{ block.super }}
  {% compress js %}
    <script src="{% static 'ace-builds/src-min-noconflict/ace.js' %}"></script>
    <script src="{% static 'ace-builds/src-min-noconflict/mode-json.js' %}"></script>
    <script src="{% static 'ace-builds/src-min-noconflict/mode-xml.js' %}"></script>
    <script src="{% static 'ace-builds/src-min-noconflict/ext-searchbox.js' %}"></script>
    <script src="{% static 'hqwebapp/js/base_ace.js' %}"></script>
  {% endcompress %}
{% endblock %}

{% requirejs_main 'dhis2/js/dhis2_entity_config' %}

{% block page_content %}
{% initial_page_data 'case_configs' case_configs %}

<script type="text/html" id="case_config_template">
    <fieldset>
        <div class="col-sm-8">&nbsp;</div>
        <div class="col-sm-4">
            <button type="button"
                    class="btn btn-danger"
                    data-bind="click: $root.removeCaseConfig">{% trans "Remove" %}</button>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-3 col-md-2 requiredField">
                {% trans "Case config" %}<span class="asteriskField">*</span>
            </label>
            <div class="controls col-sm-9 col-md-8 col-lg-6">
                <textarea name="caseConfig"
                          class="jsonwidget form-control"
                          required=""
                          data-bind="value: caseConfig"></textarea>
            </div>
        </div>
    </fieldset>
    <div class="spacer"></div>
</script>

<form id="dhis2-entity-config"
      class="form-horizontal"
      method="post"
      data-bind="submit: submit">
    <div data-bind="template: {
                        name: 'case_config_template',
                        foreach: caseConfigs,
                        as: 'caseConfig',
                        afterRender: initCaseConfigTemplate
                    }"></div>
    <p>
        <button type="button"
                class="btn btn-primary"
                data-bind="click: addCaseConfig">
            <i class="fa fa-plus"></i>
            {% trans "Add case config" %}
        </button>
    </p>

    <div class="form-actions">
        <div class="col-sm-offset-3 col-md-offset-2 controls col-sm-9 col-md-8 col-lg-6">
            <button type="submit" class="btn btn-primary">{% trans "Update DHIS2 Tracked Entity configuration" %}</button>
        </div>
    </div>
</form>
{% endblock %}
