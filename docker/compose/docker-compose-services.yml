postgres:
  extends:
    file: docker-compose-base.yml
    service: postgres
  ports:
    - "5432:5432"
  volumes:
    - ${DOCKER_DATA_HOME}/postgresql:/var/lib/postgresql/data

couch:
  extends:
    file: docker-compose-base.yml
    service: couch
  ports:
    - "5984:5984"
  volumes:
    - ${DOCKER_DATA_HOME}/couchdb:/usr/local/var/lib/couchdb

redis:
  extends:
    file: docker-compose-base.yml
    service: redis
  ports:
    - "6379:6379"

elasticsearch:
  extends:
    file: docker-compose-base.yml
    service: elasticsearch
  command: elasticsearch --cluster.name=${ES_CLUSTER_NAME}
  environment:
    - ES_CLUSTER_NAME
  ports:
    - "9200:9200"
  volumes:
    - ${DOCKER_DATA_HOME}/elasticsearch:/usr/share/elasticsearch/data

#zookeeper:
#  extends:
#    file: docker-compose-base.yml
#    service: zookeeper
#  ports:
#    - "2181:2181"

#kafka:
#  extends:
#    file: docker-compose-base.yml
#    service: kafka
#  environment:
#    KAFKA_ADVERTISED_HOST_NAME: 'localhost' # docker machine ip. i.e. export DOCKER_HOST_IP=`docker-machine ip $(docker-machine active)`
#    KAFKA_CREATE_TOPICS: "case:1:1,form:1:1,case-sql:1:1,form-sql:1:1,meta:1:1"
#  links: 
#    - zookeeper:zk
#  ports:
#    - "9092:9092"
#  volumes:
#    - /var/run/docker.sock:/var/run/docker.sock

rabbit:
  extends:
    file: docker-compose-base.yml
    service: rabbit
  ports:
    - "5671:5672"
    - "15672:15672"  
  volumes:
    - ${DOCKER_DATA_HOME}/rabbitmq:/var/lib/rabbitmq/mnesia
    - ${DOCKER_DATA_HOME}/rabbitmq-logs:/var/log/rabbitmq
  hostname: "rabbit"

celery:
  extends: 
    file: docker-compose-base.yml
    service: celery
  ports: 
    - "5555:5555"
  volumes:
    - ${DOCKER_DATA_HOME}/sharedfiles:/sharedfiles
  links:
    - rabbit
    - postgres
    - couch
    - redis
    - elasticsearch
