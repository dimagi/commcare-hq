#!/usr/bin/env bash

cat << "EOF" > serializer-pickle-files.lock
# This file was automatically generated by running `make serializer-pickle-files.lock`.
# The purpose of this file is to prevent people from innocently adding new usages
# of serializer='pickle' in celery @task declarations, since such usage is considered deprecated in this project.
# As we remove usages, this file will be updated to reflect that and prevent unintended backsliding.

EOF

grep -rEc "serializer=['\"]pickle['\"]" --include='*.py' . \
    | grep -Ev ':0$' \
    | cut -c3- \
    | sort \
    | awk -F: '{printf("%3i %s\n", $2, $1)}' \
    >> serializer-pickle-files.lock
