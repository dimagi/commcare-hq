{% extends "hqwebapp/base_section.html" %}
{% load i18n %}
{% load hq_shared_tags %}
{% load compress %}
{% load crispy_forms_tags %}
{% load djangular_tags %}

{% block title %}{% if current_page.title %}{{ current_page.title }} : {% endif %}{{ section.page_name }} :: {% endblock %}

{% block js %}
  {{ block.super }}
  <script src="{% static 'hqwebapp/js/pagination.ng.js' %}"></script>
{% endblock %}

{% block js-inline %}{{ block.super }}
<script>
$("#id_village_code").select2();
$("#id_awcid").select2();

(function (angular, undefined) {
    'use strict';
    var rchCasBenificiariesApp = angular.module('rchCasBenificiariesApp', ['hq.pagination']);
    rchCasBenificiariesApp.config(['$httpProvider', function($httpProvider) {
        $httpProvider.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
        $httpProvider.defaults.xsrfCookieName = 'csrftoken';
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        $httpProvider.defaults.headers.common["X-CSRFToken"] = $("#csrfTokenContainer").val();
    }]);

    rchCasBenificiariesApp.config(["djangoRMIProvider", function(djangoRMIProvider) {
        djangoRMIProvider.configure({% djng_current_rmi %});
    }]);
    rchCasBenificiariesApp.constant('paginationLimitCookieName', '{{ pagination_limit_cookie_name }}');

    rchCasBenificiariesApp.constant('paginationCustomData', {
       present_in: $("#id_present_in").val(),
       stcode: $("#id_stcode").val(),
       village_code: $("#id_village_code").val(),
       awcid: $("#id_awcid").val(),
       beneficiary_type: $("#id_beneficiary_type").val(),
       matched: $("#id_matched")[0].checked
    });
}(window.angular));
</script>
{% endblock %}

{% block page_content %}
    <div class="row">
      <div class="col-md-12">
        {% crispy filter_form %}
      </div>
    </div>
    <div ng-app="rchCasBenificiariesApp" ng-controller="PaginatedListController as paginationController">
        <div class="panel panel-default" ng-cloak>
            <div class="panel-heading">
                <h3 class="panel-title">{% trans 'Beneficiaries' %}</h3>
            </div>
            <div class="panel-body">
                <div class="alert alert-info" ng-show="!!notLoaded && !hasError">
                    <i class="fa fa-circle-o-notch fa-spin"></i>
                    {% trans "Loading Beneficiaries..." %}
                </div>
                <div class="alert alert-danger" ng-show="!!hasError">
                    {% blocktrans %}
                        <strong>There was an issue contacting the server.</strong>
                        Please check your internet connection.
                        If this issue continues, please
                        <a href="#modalReportIssue"
                           data-toggle="modal">file a bug report</a>.
                    {% endblocktrans %}
                </div>
                <div class="alert alert-info" ng-hide="paginatedItems.length > 0 || notLoaded || hasError">
                    {% blocktrans %}
                        <strong>No records. Try changing the filter.</strong>
                    {% endblocktrans %}
                </div>
                <div class="pull-right" style="clear: right;">
                    <pagination direction-links="true"
                                total-items="total"
                                items-per-page="limit"
                                previous-text="&laquo;"
                                next-text="&raquo;"
                                max-size="maxSize"
                                ng-model="currentPage"
                                ng-change="pageChanged()"
                                ng-show="paginatedItems.length > 0"></pagination>
                </div>
                {% block table_content %}
                {% endblock %}
                <div class="pull-right" style="clear: right;">
                    <pagination direction-links="true"
                                total-items="total"
                                items-per-page="limit"
                                previous-text="&laquo;"
                                next-text="&raquo;"
                                max-size="maxSize"
                                ng-model="currentPage"
                                ng-change="pageChanged()"
                                ng-show="paginatedItems.length > 0"></pagination>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
