{% extends 'logistics/config.html' %}
{% load i18n %}
{% load hq_shared_tags %}
{% block main_column %}
    {% if is_commtrack_enabled %}
        {{ block.super }}
    {% else %}
        You have to enable commtrack in order to use EWS Ghana migration.
    {% endif %}
{% endblock %}
{% block enabled_section %}
    {% if settings.source_config.enabled %}
        <div class="row-fluid">
            <div class="span12">
                <div class="btn-toolbar">
                    <button class="btn" id="migrate_email_settings">
                        {% trans "Migrate email settings" %}
                    </button>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <div class="btn-toolbar">
                    <button class="btn" id="migrate_needs_reminders_field">
                        {% trans "Migrate needs reminders field" %}
                    </button>
                </div>
            </div>
        </div>

    {% endif %}
{% endblock %}

{% block js-inline %}

    <script>
        var settings = {{ settings|JSON }};
        var _post = function (elem, url, options) {
            var options = options || {};
            var success = options.success || "{% trans "Sync Successful" %}";
            var error = options.error || "{% trans "Error!" %}";
            $(elem).prop('disabled', true).html("{% trans "Syncing..." %}");

            $.ajax({
                type: 'POST',
                url: url,
                success: function() {
                    $(elem).html(success);
                },
                error: function() {
                    $(elem).html(error).addClass("btn-danger");
                }
            });
        };
        $("#migrate_email_settings").click(function() {
            var url = '{% url 'migrate_email_settings' domain %}';
            var successMessage = "{% trans "Resync started" %}";
            _post(this, url, {success: successMessage});
        });

        $("#migrate_needs_reminders_field").click(function() {
            var url = '{% url 'migrate_needs_reminders_field' domain %}';
            var successMessage = "{% trans "Resync started" %}";
            _post(this, url, {success: successMessage});
        });

    </script>
{% endblock %}