# -*- coding: utf-8 -*-
# Generated by Django 1.11.28 on 2020-04-08 18:37
from __future__ import unicode_literals

import custom.icds_reports.models.aggregate
from django.db import migrations, models

from custom.icds_reports.utils.migrations import get_composite_primary_key_migrations
from custom.icds_reports.const import CHILD_VACCINE_TABLE


class Migration(migrations.Migration):

    dependencies = [
        ('icds_reports', '0176_kpi_api_view'),
    ]

    operations = [
        migrations.RunSQL("ALTER TABLE child_health_monthly ADD COLUMN birth_weight smallint"),
        migrations.RunSQL("ALTER TABLE child_health_monthly ADD COLUMN child_person_case_id text"),
        migrations.CreateModel(
            name='ChildVaccines',
            fields=[
                ('state_id', models.TextField(null=True)),
                ('supervisor_id', models.TextField(null=True)),
                ('child_health_case_id', models.TextField(primary_key=True, serialize=False)),
                ('month', models.DateField()),
                ('due_list_date_1g_dpt_1', models.DateField(blank=True, null=True)),
                ('due_list_date_2g_dpt_2', models.DateField(blank=True, null=True)),
                ('due_list_date_3g_dpt_3', models.DateField(blank=True, null=True)),
                ('due_list_date_5g_dpt_booster', models.DateField(blank=True, null=True)),
                ('due_list_date_5g_dpt_booster1', models.DateField(blank=True, null=True)),
                ('due_list_date_7gdpt_booster_2', models.DateField(blank=True, null=True)),
                ('due_list_date_0g_hep_b_0', models.DateField(blank=True, null=True)),
                ('due_list_date_1g_hep_b_1', models.DateField(blank=True, null=True)),
                ('due_list_date_2g_hep_b_2', models.DateField(blank=True, null=True)),
                ('due_list_date_3g_hep_b_3', models.DateField(blank=True, null=True)),
                ('due_list_date_3g_ipv', models.DateField(blank=True, null=True)),
                ('due_list_date_4g_je_1', models.DateField(blank=True, null=True)),
                ('due_list_date_5g_je_2', models.DateField(blank=True, null=True)),
                ('due_list_date_5g_measles_booster', models.DateField(blank=True, null=True)),
                ('due_list_date_4g_measles', models.DateField(blank=True, null=True)),
                ('due_list_date_0g_opv_0', models.DateField(blank=True, null=True)),
                ('due_list_date_1g_opv_1', models.DateField(blank=True, null=True)),
                ('due_list_date_2g_opv_2', models.DateField(blank=True, null=True)),
                ('due_list_date_3g_opv_3', models.DateField(blank=True, null=True)),
                ('due_list_date_5g_opv_booster', models.DateField(blank=True, null=True)),
                ('due_list_date_1g_penta_1', models.DateField(blank=True, null=True)),
                ('due_list_date_2g_penta_2', models.DateField(blank=True, null=True)),
                ('due_list_date_3g_penta_3', models.DateField(blank=True, null=True)),
                ('due_list_date_1g_rv_1', models.DateField(blank=True, null=True)),
                ('due_list_date_2g_rv_2', models.DateField(blank=True, null=True)),
                ('due_list_date_3g_rv_3', models.DateField(blank=True, null=True)),
                ('due_list_date_4g_vit_a_1', models.DateField(blank=True, null=True)),
                ('due_list_date_5g_vit_a_2', models.DateField(blank=True, null=True)),
                ('due_list_date_6g_vit_a_3', models.DateField(blank=True, null=True)),
                ('due_list_date_6g_vit_a_4', models.DateField(blank=True, null=True)),
                ('due_list_date_6g_vit_a_5', models.DateField(blank=True, null=True)),
                ('due_list_date_6g_vit_a_6', models.DateField(blank=True, null=True)),
                ('due_list_date_6g_vit_a_7', models.DateField(blank=True, null=True)),
                ('due_list_date_6g_vit_a_8', models.DateField(blank=True, null=True)),
                ('due_list_date_7g_vit_a_9', models.DateField(blank=True, null=True)),
                ('due_list_date_anc_1', models.DateField(blank=True, null=True)),
                ('due_list_date_anc_2', models.DateField(blank=True, null=True)),
                ('due_list_date_anc_3', models.DateField(blank=True, null=True)),
                ('due_list_date_anc_4', models.DateField(blank=True, null=True)),
                ('due_list_date_tt_1', models.DateField(blank=True, null=True)),
                ('due_list_date_tt_2', models.DateField(blank=True, null=True)),
                ('due_list_date_tt_booster', models.DateField(blank=True, null=True)),
                ('due_list_date_1g_bcg', models.DateField(blank=True, null=True)),
            ],
            options={
                'db_table': 'child_vaccines',
            },
            bases=(models.Model, custom.icds_reports.models.aggregate.AggregateMixin),
        ),
        migrations.AlterUniqueTogether(
            name='childvaccines',
            unique_together=set([('month', 'state_id', 'supervisor_id', 'child_health_case_id')]),
        ),
    ]

    operations.extend(get_composite_primary_key_migrations(['childvaccines']))

    operations += [
        migrations.RunSQL(f"ALTER TABLE {CHILD_VACCINE_TABLE} RENAME TO {CHILD_VACCINE_TABLE}_old"),
        migrations.RunSQL(f"CREATE TABLE {CHILD_VACCINE_TABLE} (LIKE {CHILD_VACCINE_TABLE}_old INCLUDING DEFAULTS INCLUDING CONSTRAINTS INCLUDING INDEXES) PARTITION BY LIST (month)"),
        migrations.RunSQL(f"SELECT create_distributed_table('{CHILD_VACCINE_TABLE}', 'supervisor_id')"),
        migrations.RunSQL(f"DROP TABLE {CHILD_VACCINE_TABLE}_old"),
    ]
