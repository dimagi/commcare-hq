<div class="download-directive">
    <div class="row fixes-filters">
        <div class="col-md-11">
            <span class="breadcrump-element">Export Program Area Indicators: </span>
        </div>
    </div>
    <div class="report-content">
        <div class="alert alert-info" ng-show="$ctrl.now === $ctrl.selectedMonth">
            <strong>Info!</strong> "You are downloading data for the current calendar month. Data for this report is calculated using calendar months (for example, January 1st-January 31st). Data for this month will not be complete until the end of the month."
        </div>
        <div class="alert alert-info col-md-12" ng-if="$ctrl.isChildBeneficiaryListSelected() && $ctrl.hasErrors()">
            <strong>Please make the following selections before you can export:</strong>
            <ul>
                <li ng-if="!$ctrl.isDistrictOrBelowSelected()" style="padding: 5px;">Select at least a district-level location</li>
                <li ng-if="$ctrl.selectedFilterOptions().length === 0" style="padding: 5px;">Select at least one filter</li>
            </ul>
        </div>
        <div class="form-horizontal black">
            <div class="form-group">
                <label class="control-label col-sm-2" for="indicator">Program Area: <i class="fa fa-info-circle" uib-popover="Select the program area for which you want to download a tabular report."
                       popover-placement="top-right"
                       popover-trigger="'mouseenter'"></i></label>
                <div class="col-sm-6">
                    <ui-select ng-model="$ctrl.selectedIndicator" theme="bootstrap" on-select="$ctrl.onIndicatorSelect()">
                        <ui-select-match placeholder="Program Area"><span ng-bind="$select.selected.name"></span></ui-select-match>
                        <ui-select-choices repeat="indicator.id as indicator in $ctrl.indicators | propsFilter: {name: $select.search}">
                            <div ng-bind-html="indicator.name"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="format">Format: <i class="fa fa-info-circle" uib-popover="Select the desired format of the tabular report."
                       popover-placement="top-right"
                       popover-trigger="'mouseenter'"></i></label>
                <div class="col-sm-6">
                    <ui-select ng-model="$ctrl.selectedFormat" theme="bootstrap" ng-disabled="$ctrl.isChildBeneficiaryListSelected()">
                    <ui-select-match placeholder="Format"><span ng-bind="$select.selected.name"></span></ui-select-match>
                      <ui-select-choices repeat="format.id as format in $ctrl.getFormats() | propsFilter: {name: $select.search}">
                        <div ng-bind-html="format.name"></div>
                      </ui-select-choices>
                </ui-select>
                </div>
            </div>
            <div class="form-group" style="margin-bottom: 0px !important;">
                <label class="control-label col-sm-2" for="location">Location: <i class="fa fa-info-circle" uib-popover="Select the location for which you want to view the tabular report."
                       popover-placement="top-right"
                       popover-trigger="'mouseenter'"></i></label>
                <div class="col-sm-6">
                    <div style="margin-bottom: 15px;" ng-repeat="locationTypes in $ctrl.hierarchy" ng-show="$ctrl.isVisible($index)">
                        <ui-select ng-disabled="$ctrl.disabled($index)" ng-model="$ctrl.selectedLocations[$index]" theme="bootstrap" on-select="$ctrl.onSelect($item, $index)">
                            <ui-select-match placeholder="{$ $ctrl.getPlaceholder(locationTypes) $}"><span ng-bind="$select.selected.name"></span></ui-select-match>
                              <ui-select-choices repeat="location.location_id as location in $ctrl.getLocationsForLevel($index) | propsFilter: {name: $select.search}">
                                <div ng-bind-html="location.name | highlight: $select.search"></div>
                              </ui-select-choices>
                        </ui-select>
                    </div>
                </div>
            </div>
            <div class="form-group" ng-if="!$ctrl.isChildBeneficiaryListSelected()">
                <label class="control-label col-sm-2" for="view_by">View by: <i class="fa fa-info-circle" uib-popover="Select the administrative level at which you want to view the tabular report. The tabular report will generate one row for each administrative level selected (for example, view by block would show one row for each block within the selected location)."
                       popover-placement="top-right"
                       popover-trigger="'mouseenter'"></i></label>
                <div class="col-sm-6">
                    <ui-select ng-model="$ctrl.selectedLevel" theme="bootstrap">
                        <ui-select-match placeholder="View By"><span ng-bind="$select.selected.name"></span></ui-select-match>
                        <ui-select-choices repeat="level.id as level in $ctrl.groupByLevels | propsFilter: {name: $select.search}">
                            <div ng-bind-html="level.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="month">Month: <i class="fa fa-info-circle" uib-popover="Select the calendar month for which you want to view the tabular report."
                       popover-placement="top-right"
                       popover-trigger="'mouseenter'"></i></label>
                <div class="col-sm-6">
                    <ui-select ng-model="$ctrl.selectedMonth" theme="bootstrap">
                        <ui-select-match placeholder="Month"><span ng-bind="$select.selected.name"></span></ui-select-match>
                        <ui-select-choices repeat="month.id as month in $ctrl.months | propsFilter: {name: $select.search}">
                            <div ng-bind-html="month.name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="year">Year: <i class="fa fa-info-circle" uib-popover="Select the year for which you want to view the tabular report."
                       popover-placement="top-right"
                       popover-trigger="'mouseenter'"></i></label>
                <div class="col-sm-6">
                    <ui-select ng-model="$ctrl.selectedYear" theme="bootstrap">
                        <ui-select-match placeholder="Year"><span ng-bind="$select.selected.name"></span></ui-select-match>
                        <ui-select-choices repeat="year.id as year in $ctrl.years| propsFilter: {name: $select.search}">
                            <div ng-bind-html="year.name"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>

            <div class="form-group" ng-if="$ctrl.isChildBeneficiaryListSelected()">
                <div class="row">
                    <div class="col-sm-offset-2 col-sm-6" ng-show="$ctrl.selectedFilterOptions().length === 0">
                        <span class="help-block">
                            You must choose at least one filter
                        </span>
                    </div>
                </div>
                <div class="row">
                    <label class="control-label col-sm-2" for="year">
                        Filter List By:
                        <i class="fa fa-info-circle"
                           uib-popover="Select at least one filter before you can export. The list of child beneficiaries will be filtered based on the filter(s) selected."
                           popover-placement="top-right"
                           popover-trigger="'mouseenter'"></i>
                    </label>
                    <div class="col-sm-6">
                        <div class="checkbox" ng-repeat="option in $ctrl.filterOptions">
                            <label>
                                <input ng-model="option.selected" type="checkbox">
                                {$ option.label $}
                            </label>
                        </div>
                    </div>
                </div>

            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-6">
                    <form action="{% url 'icds_export_indicator' domain %}" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="location" ng-value="$ctrl.selectedLocationId" />
                        <input type="hidden" name="aggregation_level" ng-value="$ctrl.selectedLevel" />
                        <input type="hidden" name="month" ng-value="$ctrl.selectedMonth" />
                        <input type="hidden" name="year" ng-value="$ctrl.selectedYear" />
                        <input type="hidden" name="indicator" ng-value="$ctrl.selectedIndicator" />
                        <input type="hidden" name="format" ng-value="$ctrl.selectedFormat" />
                        <input ng-if="$ctrl.isChildBeneficiaryListSelected()" type="hidden" ng-repeat="filter in $ctrl.selectedFilterOptions()" name="filter[]" ng-value="filter.id"/>
                        <button type="submit"
                                class="btn btn-default normalButton orangeButton"
                                ng-disabled="$ctrl.hasErrors()">
                            Export
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
