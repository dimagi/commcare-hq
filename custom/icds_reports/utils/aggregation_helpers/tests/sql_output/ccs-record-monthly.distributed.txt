DELETE FROM "ccs_record_monthly" WHERE month=%(month)s
{"month": "2019-01-01"}

        INSERT INTO "ccs_record_monthly" (
            awc_id, case_id, supervisor_id, month, age_in_months, ccs_status, open_in_month, alive_in_month, trimester, num_rations_distributed, thr_eligible, tetanus_complete, delivered_in_month, anc1_received_at_delivery, anc2_received_at_delivery, anc3_received_at_delivery, anc4_received_at_delivery, registration_trimester_at_delivery, using_ifa, ifa_consumed_last_seven_days, anemic_severe, anemic_moderate, anemic_normal, anemic_unknown, extra_meal, resting_during_pregnancy, bp_visited_in_month, pnc_visited_in_month, trimester_2, trimester_3, counsel_immediate_bf, counsel_bp_vid, counsel_preparation, counsel_fp_vid, counsel_immediate_conception, counsel_accessible_postpartum_fp, bp1_complete, bp2_complete, bp3_complete, pnc_complete, postnatal, has_aadhar_id, counsel_fp_methods, pregnant, pregnant_all, lactating, lactating_all, institutional_delivery_in_month, add, caste, disabled, minority, resident, valid_in_month, institutional_delivery, anc_in_month, anc_1, anc_2, anc_3, anc_4, tt_1, tt_2, tt_booster, immediate_breastfeeding, anemia, eating_extra, resting, anc_weight, anc_blood_pressure, bp_sys, bp_dia, anc_hemoglobin, bleeding, swelling, blurred_vision, convulsions, rupture, bp_date, is_ebf, breastfed_at_birth, person_name, edd, delivery_nature, mobile_number, preg_order, num_pnc_visits, last_date_thr, num_anc_complete, valid_visits, opened_on, dob, closed, anc_abnormalities, home_visit_date, date_death, person_case_id, child_name, husband_name, lmp, migration_status, where_born, num_children_del, still_live_birth, last_preg_year, complication_type, reason_no_ifa, new_ifa_tablets_total_bp, new_ifa_tablets_total_pnc, ifa_last_seven_days
        ) (SELECT
            case_list.awc_id, case_list.case_id, case_list.supervisor_id, '2019-01-01', trunc((('2019-01-31'::date - person_cases.dob)::integer / 30.4 )), CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN 'pregnant' ELSE CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date))) THEN 'lactating' ELSE 'other' END END, CASE WHEN ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) THEN 1 ELSE 0 END, CASE WHEN (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) THEN 1 ELSE 0 END, (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END), COALESCE(agg_thr.days_ration_given_mother, 0), CASE WHEN ( ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) OR ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)))) THEN 1 ELSE 0 END, CASE WHEN (((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) AND ut.tt_complete_date is not null AND ut.tt_complete_date<='2019-01-31'::date) THEN 1 ELSE 0 END, CASE WHEN (((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND (case_list.add>= '2019-01-01'::date AND case_list.add<='2019-01-31'::date) AND agg_delivery.case_id IS NOT NULL) THEN 1 ELSE 0 END, CASE WHEN (((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND (case_list.add>= '2019-01-01'::date AND case_list.add<='2019-01-31'::date) AND agg_delivery.case_id IS NOT NULL) AND case_list.anc1_received=1 THEN 1 ELSE 0 END, CASE WHEN (((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND (case_list.add>= '2019-01-01'::date AND case_list.add<='2019-01-31'::date) AND agg_delivery.case_id IS NOT NULL) AND case_list.anc2_received=1 THEN 1 ELSE 0 END, CASE WHEN (((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND (case_list.add>= '2019-01-01'::date AND case_list.add<='2019-01-31'::date) AND agg_delivery.case_id IS NOT NULL) AND case_list.anc3_received=1 THEN 1 ELSE 0 END, CASE WHEN (((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND (case_list.add>= '2019-01-01'::date AND case_list.add<='2019-01-31'::date) AND agg_delivery.case_id IS NOT NULL) AND case_list.anc4_received=1 THEN 1 ELSE 0 END, CASE WHEN (((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND (case_list.add>= '2019-01-01'::date AND case_list.add<='2019-01-31'::date) AND agg_delivery.case_id IS NOT NULL) THEN (CASE WHEN (case_list.edd-case_list.opened_on::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-case_list.opened_on::date)::integer<91THEN 3 ELSE 2 END END) ELSE null END, CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) and agg_bp.using_ifa=1 THEN 1 ELSE 0 END, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)>1 AND agg_bp.ifa_last_seven_days>=4 THEN 1 ELSE 0 END, CASE WHEN agg_bp.anemia=1 THEN 1 ELSE 0 END, CASE WHEN agg_bp.anemia=2 THEN 1 ELSE 0 END, CASE WHEN agg_bp.anemia=3 THEN 1 ELSE 0 END, CASE WHEN agg_bp.anemia is NULL THEN 1 ELSE CASE WHEN agg_bp.anemia not in (1,2,3)THEN 1 ELSE 0 END END, CASE WHEN (agg_bp.eating_extra=1 AND ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0))) THEN 1 ELSE 0 END, CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN COALESCE(agg_bp.resting, 0)ELSE 0 END , CASE WHEN date_trunc('MONTH', agg_bp.latest_time_end_processed)='2019-01-01'::date  THEN 1 ELSE 0 END, NULL, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)=2 THEN 1 ELSE 0 END, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)=3 THEN 1 ELSE 0 END, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)=3 THEN COALESCE(agg_bp.immediate_breastfeeding,0) ELSE 0 END, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)=3 THEN COALESCE(agg_bp.play_birth_preparedness_vid,0) ELSE 0 END, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)=3 THEN COALESCE(agg_bp.counsel_preparation,0) ELSE 0 END, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)=3 THEN COALESCE(agg_bp.play_family_planning_vid,0) ELSE 0 END, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)=3 THEN COALESCE(agg_bp.conceive,0) ELSE 0 END, CASE WHEN (CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN  CASE WHEN (case_list.edd-'2019-01-31'::date)::integer>=183THEN 1 ELSE CASE WHEN (case_list.edd-'2019-01-31'::date)::integer<91THEN 3 ELSE 2 END END ELSE null END)=3 THEN COALESCE(agg_bp.counsel_accessible_ppfp,0) ELSE 0 END, CASE WHEN (case_list.bp1_date <= '2019-01-31'::date) THEN 1 ELSE 0 END, CASE WHEN (case_list.bp2_date <= '2019-01-31'::date) THEN 1 ELSE 0 END, CASE WHEN (case_list.bp3_date <= '2019-01-31'::date) THEN 1 ELSE 0 END, CASE WHEN (case_list.pnc1_date is not null AND case_list.pnc1_date<'2019-01-31'::date) THEN 1 ELSE 0 END, CASE WHEN (case_list.add is not null AND ('2019-01-31'::date-case_list.add)::integer>=0 AND ('2019-01-01'::date-case_list.add)::integer<=21) THEN 1 ELSE 0 END, CASE WHEN person_cases.aadhar_date < '2019-01-31'::date THEN  1 ELSE 0 END, NULL, CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) THEN 1 ELSE 0 END, CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND  (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) THEN 1 ELSE 0 END, CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date))) THEN 1 ELSE 0 END, CASE WHEN ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND  (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) THEN 1 ELSE 0 END, CASE WHEN agg_delivery.where_born=2 AND (((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND (case_list.add>= '2019-01-01'::date AND case_list.add<='2019-01-31'::date) AND agg_delivery.case_id IS NOT NULL) THEN 1 ELSE 0 END, case_list.add, case_list.caste, case_list.disabled, case_list.minority, case_list.resident, CASE WHEN ( ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) OR ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)))) THEN 1 ELSE 0 END, case_list.institutional_delivery, ( (CASE WHEN ut.due_list_date_anc_1 BETWEEN %(start_date)s AND %(end_date)s THEN 1 ELSE 0 END) + (CASE WHEN ut.due_list_date_anc_2 BETWEEN %(start_date)s AND %(end_date)s THEN 1 ELSE 0 END) + (CASE WHEN ut.due_list_date_anc_3 BETWEEN %(start_date)s AND %(end_date)s THEN 1 ELSE 0 END) + (CASE WHEN ut.due_list_date_anc_4 BETWEEN %(start_date)s AND %(end_date)s THEN 1 ELSE 0 END) ), ut.due_list_date_anc_1, ut.due_list_date_anc_2, ut.due_list_date_anc_3, ut.due_list_date_anc_4, ut.due_list_date_tt_1, ut.due_list_date_tt_2, ut.due_list_date_tt_booster, agg_bp.immediate_breastfeeding, agg_bp.anemia, agg_bp.eating_extra, agg_bp.resting, agg_bp.anc_weight, agg_bp.anc_blood_pressure, agg_bp.bp_sys, agg_bp.bp_dia, agg_bp.anc_hemoglobin, agg_bp.bleeding, agg_bp.swelling, agg_bp.blurred_vision, agg_bp.convulsions, agg_bp.rupture, agg_bp.latest_time_end_processed::DATE, agg_pnc.is_ebf, agg_delivery.breastfed_at_birth, person_cases.name, case_list.edd, case_list.delivery_nature, person_cases.phone_number, case_list.preg_order, case_list.num_pnc_visits, case_list.last_date_thr, case_list.num_anc_complete, (COALESCE(agg_cf.valid_visits, 0) + COALESCE(agg_bp.valid_visits, 0) + COALESCE(agg_pnc.valid_visits, 0) + COALESCE(agg_delivery.valid_visits, 0)), case_list.opened_on, person_cases.dob, case_list.closed, agg_bp.anc_abnormalities, agg_bp.latest_time_end_processed, person_cases.date_death, case_list.person_case_id, case_list.child_name, person_cases.husband_name, case_list.lmp, CASE WHEN (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date) THEN 0 ELSE 1 END, agg_delivery.where_born, agg_delivery.num_children_del, agg_delivery.still_live_birth, preg.last_preg, case_list.complication_type, agg_bp.reason_no_ifa, agg_bp.new_ifa_tablets_total, agg_pnc.new_ifa_tablets_total, agg_bp.ifa_last_seven_days
            FROM "ucr_icds-cas_static-ccs_record_cases_cedcca39" case_list
            LEFT OUTER JOIN "ucr_icds-cas_static-person_cases_v3_2ae0879a" person_cases ON case_list.person_case_id = person_cases.doc_id
                AND case_list.supervisor_id = person_cases.supervisor_id
            LEFT OUTER JOIN "ucr_icds-cas_static-pregnant-tasks_cases_6c2a698f" ut ON case_list.doc_id = ut.ccs_record_case_id
                AND case_list.supervisor_id = ut.supervisor_id
            LEFT OUTER JOIN "icds_dashboard_migration_forms" agg_migration ON case_list.person_case_id = agg_migration.person_case_id
                AND agg_migration.month = %(start_date)s
                AND case_list.supervisor_id = agg_migration.supervisor_id
            LEFT OUTER JOIN "icds_dashboard_availing_service_forms" agg_availing ON case_list.person_case_id = agg_availing.person_case_id
                AND agg_availing.month = %(start_date)s
                AND case_list.supervisor_id = agg_availing.supervisor_id
            LEFT OUTER JOIN "icds_dashboard_ccs_record_thr_forms" agg_thr ON case_list.doc_id = agg_thr.case_id
                AND agg_thr.month = %(start_date)s AND ( ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) OR ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date))))
                AND case_list.supervisor_id = agg_thr.supervisor_id
            LEFT OUTER JOIN "icds_dashboard_ccs_record_bp_forms" agg_bp ON case_list.doc_id = agg_bp.case_id
                AND agg_bp.month = %(start_date)s AND ( ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) OR ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date))))
                AND case_list.supervisor_id = agg_bp.supervisor_id
            LEFT OUTER JOIN "icds_dashboard_ccs_record_postnatal_forms" agg_pnc ON case_list.doc_id = agg_pnc.case_id
                AND agg_pnc.month = %(start_date)s AND ( ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) OR ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date))))
                AND case_list.supervisor_id = agg_pnc.supervisor_id
            LEFT OUTER JOIN "icds_dashboard_ccs_record_cf_forms" agg_cf ON case_list.doc_id = agg_cf.case_id
                AND agg_cf.month = %(start_date)s AND ( ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) OR ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date))))
                AND case_list.supervisor_id = agg_cf.supervisor_id
            LEFT OUTER JOIN "icds_dashboard_ccs_record_delivery_forms" agg_delivery ON case_list.doc_id = agg_delivery.case_id
                AND agg_delivery.month = %(start_date)s AND ( ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.edd is not null and (case_list.add is null OR case_list.add>'2019-01-31'::date)) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date)) AND ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0)) OR ((('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.date_death is null OR case_list.date_death-'2019-01-01'::date>0) AND case_list.add is not null AND '2019-01-31'::date-case_list.add>=0 AND '2019-01-01'::date-case_list.add<=183) AND ((agg_availing.is_registered IS DISTINCT FROM 0 OR agg_availing.registration_date::date >= '2019-01-01'::date) AND (agg_migration.is_migrated IS DISTINCT FROM 1 OR agg_migration.migration_date::date >= '2019-01-01'::date))))
                AND case_list.supervisor_id = agg_delivery.supervisor_id
            LEFT OUTER JOIN "ucr_icds-cas_static-dashboard_add_pregnan_5d87f3b5" preg ON (
                case_list.doc_id = preg.case_load_ccs_record0 AND
                case_list.supervisor_id = preg.supervisor_id AND
                preg.timeend <= %(end_date)s
                )
            WHERE ('2019-01-31'::date - case_list.opened_on::date)::integer >= 0 AND (case_list.closed = 0 OR (case_list.closed_on::date - '2019-01-01'::date)::integer > 0) AND (case_list.add is NULL OR %(start_date)s-case_list.add<=183)
                AND case_list.supervisor_id IS NOT NULL
            ORDER BY case_list.supervisor_id, case_list.awc_id, case_list.case_id, case_list.modified_on
        )
        
{"end_date": "2019-01-01T23:59:59", "start_date": "2019-01-01T00:00:00"}
CREATE INDEX IF NOT EXISTS crm_awc_case_idx ON "ccs_record_monthly" (awc_id, case_id)
{}
CREATE INDEX IF NOT EXISTS crm_person_add_case_idx ON "ccs_record_monthly" (person_case_id, add, case_id)
{}
CREATE INDEX IF NOT EXISTS crm_supervisor_person_month_idx ON "ccs_record_monthly" (supervisor_id, month, person_case_id)
{}